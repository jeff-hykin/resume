// https://esm.sh/v135/@codemirror/state@6.4.1/denonext/state.mjs
var m = class s {
  lineAt(e7) {
    if (e7 < 0 || e7 > this.length) throw new RangeError(`Invalid position ${e7} in document of length ${this.length}`);
    return this.lineInner(e7, false, 1, 0);
  }
  line(e7) {
    if (e7 < 1 || e7 > this.lines) throw new RangeError(`Invalid line number ${e7} in ${this.lines}-line document`);
    return this.lineInner(e7, true, 1, 0);
  }
  replace(e7, t8, n14) {
    [e7, t8] = $(this, e7, t8);
    let i12 = [];
    return this.decompose(0, e7, i12, 2), n14.length && n14.decompose(0, n14.length, i12, 3), this.decompose(t8, this.length, i12, 1), N.from(i12, this.length - (t8 - e7) + n14.length);
  }
  append(e7) {
    return this.replace(this.length, this.length, e7);
  }
  slice(e7, t8 = this.length) {
    [e7, t8] = $(this, e7, t8);
    let n14 = [];
    return this.decompose(e7, t8, n14, 0), N.from(n14, t8 - e7);
  }
  eq(e7) {
    if (e7 == this) return true;
    if (e7.length != this.length || e7.lines != this.lines) return false;
    let t8 = this.scanIdentical(e7, 1), n14 = this.length - this.scanIdentical(e7, -1), i12 = new B(this), r2 = new B(e7);
    for (let l11 = t8, h3 = t8; ; ) {
      if (i12.next(l11), r2.next(l11), l11 = 0, i12.lineBreak != r2.lineBreak || i12.done != r2.done || i12.value != r2.value) return false;
      if (h3 += i12.value.length, i12.done || h3 >= n14) return true;
    }
  }
  iter(e7 = 1) {
    return new B(this, e7);
  }
  iterRange(e7, t8 = this.length) {
    return new Y(this, e7, t8);
  }
  iterLines(e7, t8) {
    let n14;
    if (e7 == null) n14 = this.iter();
    else {
      t8 == null && (t8 = this.lines + 1);
      let i12 = this.line(e7).from;
      n14 = this.iterRange(i12, Math.max(i12, t8 == this.lines + 1 ? this.length : t8 <= 1 ? 0 : this.line(t8 - 1).to));
    }
    return new _(n14);
  }
  toString() {
    return this.sliceString(0);
  }
  toJSON() {
    let e7 = [];
    return this.flatten(e7), e7;
  }
  constructor() {
  }
  static of(e7) {
    if (e7.length == 0) throw new RangeError("A document must have at least one line");
    return e7.length == 1 && !e7[0] ? s.empty : e7.length <= 32 ? new k(e7) : N.from(k.split(e7, []));
  }
};
var k = class s2 extends m {
  constructor(e7, t8 = He(e7)) {
    super(), this.text = e7, this.length = t8;
  }
  get lines() {
    return this.text.length;
  }
  get children() {
    return null;
  }
  lineInner(e7, t8, n14, i12) {
    for (let r2 = 0; ; r2++) {
      let l11 = this.text[r2], h3 = i12 + l11.length;
      if ((t8 ? n14 : h3) >= e7) return new fe(i12, h3, n14, l11);
      i12 = h3 + 1, n14++;
    }
  }
  decompose(e7, t8, n14, i12) {
    let r2 = e7 <= 0 && t8 >= this.length ? this : new s2(Ae(this.text, e7, t8), Math.min(t8, this.length) - Math.max(0, e7));
    if (i12 & 1) {
      let l11 = n14.pop(), h3 = X(r2.text, l11.text.slice(), 0, r2.length);
      if (h3.length <= 32) n14.push(new s2(h3, l11.length + r2.length));
      else {
        let a2 = h3.length >> 1;
        n14.push(new s2(h3.slice(0, a2)), new s2(h3.slice(a2)));
      }
    } else n14.push(r2);
  }
  replace(e7, t8, n14) {
    if (!(n14 instanceof s2)) return super.replace(e7, t8, n14);
    [e7, t8] = $(this, e7, t8);
    let i12 = X(this.text, X(n14.text, Ae(this.text, 0, e7)), t8), r2 = this.length + n14.length - (t8 - e7);
    return i12.length <= 32 ? new s2(i12, r2) : N.from(s2.split(i12, []), r2);
  }
  sliceString(e7, t8 = this.length, n14 = `
`) {
    [e7, t8] = $(this, e7, t8);
    let i12 = "";
    for (let r2 = 0, l11 = 0; r2 <= t8 && l11 < this.text.length; l11++) {
      let h3 = this.text[l11], a2 = r2 + h3.length;
      r2 > e7 && l11 && (i12 += n14), e7 < a2 && t8 > r2 && (i12 += h3.slice(Math.max(0, e7 - r2), t8 - r2)), r2 = a2 + 1;
    }
    return i12;
  }
  flatten(e7) {
    for (let t8 of this.text) e7.push(t8);
  }
  scanIdentical() {
    return 0;
  }
  static split(e7, t8) {
    let n14 = [], i12 = -1;
    for (let r2 of e7) n14.push(r2), i12 += r2.length + 1, n14.length == 32 && (t8.push(new s2(n14, i12)), n14 = [], i12 = -1);
    return i12 > -1 && t8.push(new s2(n14, i12)), t8;
  }
};
var N = class s3 extends m {
  constructor(e7, t8) {
    super(), this.children = e7, this.length = t8, this.lines = 0;
    for (let n14 of e7) this.lines += n14.lines;
  }
  lineInner(e7, t8, n14, i12) {
    for (let r2 = 0; ; r2++) {
      let l11 = this.children[r2], h3 = i12 + l11.length, a2 = n14 + l11.lines - 1;
      if ((t8 ? a2 : h3) >= e7) return l11.lineInner(e7, t8, n14, i12);
      i12 = h3 + 1, n14 = a2 + 1;
    }
  }
  decompose(e7, t8, n14, i12) {
    for (let r2 = 0, l11 = 0; l11 <= t8 && r2 < this.children.length; r2++) {
      let h3 = this.children[r2], a2 = l11 + h3.length;
      if (e7 <= a2 && t8 >= l11) {
        let o = i12 & ((l11 <= e7 ? 1 : 0) | (a2 >= t8 ? 2 : 0));
        l11 >= e7 && a2 <= t8 && !o ? n14.push(h3) : h3.decompose(e7 - l11, t8 - l11, n14, o);
      }
      l11 = a2 + 1;
    }
  }
  replace(e7, t8, n14) {
    if ([e7, t8] = $(this, e7, t8), n14.lines < this.lines) for (let i12 = 0, r2 = 0; i12 < this.children.length; i12++) {
      let l11 = this.children[i12], h3 = r2 + l11.length;
      if (e7 >= r2 && t8 <= h3) {
        let a2 = l11.replace(e7 - r2, t8 - r2, n14), o = this.lines - l11.lines + a2.lines;
        if (a2.lines < o >> 4 && a2.lines > o >> 6) {
          let f6 = this.children.slice();
          return f6[i12] = a2, new s3(f6, this.length - (t8 - e7) + n14.length);
        }
        return super.replace(r2, h3, a2);
      }
      r2 = h3 + 1;
    }
    return super.replace(e7, t8, n14);
  }
  sliceString(e7, t8 = this.length, n14 = `
`) {
    [e7, t8] = $(this, e7, t8);
    let i12 = "";
    for (let r2 = 0, l11 = 0; r2 < this.children.length && l11 <= t8; r2++) {
      let h3 = this.children[r2], a2 = l11 + h3.length;
      l11 > e7 && r2 && (i12 += n14), e7 < a2 && t8 > l11 && (i12 += h3.sliceString(e7 - l11, t8 - l11, n14)), l11 = a2 + 1;
    }
    return i12;
  }
  flatten(e7) {
    for (let t8 of this.children) t8.flatten(e7);
  }
  scanIdentical(e7, t8) {
    if (!(e7 instanceof s3)) return 0;
    let n14 = 0, [i12, r2, l11, h3] = t8 > 0 ? [0, 0, this.children.length, e7.children.length] : [this.children.length - 1, e7.children.length - 1, -1, -1];
    for (; ; i12 += t8, r2 += t8) {
      if (i12 == l11 || r2 == h3) return n14;
      let a2 = this.children[i12], o = e7.children[r2];
      if (a2 != o) return n14 + a2.scanIdentical(o, t8);
      n14 += a2.length + 1;
    }
  }
  static from(e7, t8 = e7.reduce((n14, i12) => n14 + i12.length + 1, -1)) {
    let n14 = 0;
    for (let c3 of e7) n14 += c3.lines;
    if (n14 < 32) {
      let c3 = [];
      for (let g8 of e7) g8.flatten(c3);
      return new k(c3, t8);
    }
    let i12 = Math.max(32, n14 >> 5), r2 = i12 << 1, l11 = i12 >> 1, h3 = [], a2 = 0, o = -1, f6 = [];
    function u3(c3) {
      let g8;
      if (c3.lines > r2 && c3 instanceof s3) for (let P23 of c3.children) u3(P23);
      else c3.lines > l11 && (a2 > l11 || !a2) ? (d4(), h3.push(c3)) : c3 instanceof k && a2 && (g8 = f6[f6.length - 1]) instanceof k && c3.lines + g8.lines <= 32 ? (a2 += c3.lines, o += c3.length + 1, f6[f6.length - 1] = new k(g8.text.concat(c3.text), g8.length + 1 + c3.length)) : (a2 + c3.lines > i12 && d4(), a2 += c3.lines, o += c3.length + 1, f6.push(c3));
    }
    function d4() {
      a2 != 0 && (h3.push(f6.length == 1 ? f6[0] : s3.from(f6, o)), o = -1, a2 = f6.length = 0);
    }
    for (let c3 of e7) u3(c3);
    return d4(), h3.length == 1 ? h3[0] : new s3(h3, t8);
  }
};
m.empty = new k([""], 0);
function He(s212) {
  let e7 = -1;
  for (let t8 of s212) e7 += t8.length + 1;
  return e7;
}
function X(s212, e7, t8 = 0, n14 = 1e9) {
  for (let i12 = 0, r2 = 0, l11 = true; r2 < s212.length && i12 <= n14; r2++) {
    let h3 = s212[r2], a2 = i12 + h3.length;
    a2 >= t8 && (a2 > n14 && (h3 = h3.slice(0, n14 - i12)), i12 < t8 && (h3 = h3.slice(t8 - i12)), l11 ? (e7[e7.length - 1] += h3, l11 = false) : e7.push(h3)), i12 = a2 + 1;
  }
  return e7;
}
function Ae(s212, e7, t8) {
  return X(s212, [""], e7, t8);
}
var B = class {
  constructor(e7, t8 = 1) {
    this.dir = t8, this.done = false, this.lineBreak = false, this.value = "", this.nodes = [e7], this.offsets = [t8 > 0 ? 1 : (e7 instanceof k ? e7.text.length : e7.children.length) << 1];
  }
  nextInner(e7, t8) {
    for (this.done = this.lineBreak = false; ; ) {
      let n14 = this.nodes.length - 1, i12 = this.nodes[n14], r2 = this.offsets[n14], l11 = r2 >> 1, h3 = i12 instanceof k ? i12.text.length : i12.children.length;
      if (l11 == (t8 > 0 ? h3 : 0)) {
        if (n14 == 0) return this.done = true, this.value = "", this;
        t8 > 0 && this.offsets[n14 - 1]++, this.nodes.pop(), this.offsets.pop();
      } else if ((r2 & 1) == (t8 > 0 ? 0 : 1)) {
        if (this.offsets[n14] += t8, e7 == 0) return this.lineBreak = true, this.value = `
`, this;
        e7--;
      } else if (i12 instanceof k) {
        let a2 = i12.text[l11 + (t8 < 0 ? -1 : 0)];
        if (this.offsets[n14] += t8, a2.length > Math.max(0, e7)) return this.value = e7 == 0 ? a2 : t8 > 0 ? a2.slice(e7) : a2.slice(0, a2.length - e7), this;
        e7 -= a2.length;
      } else {
        let a2 = i12.children[l11 + (t8 < 0 ? -1 : 0)];
        e7 > a2.length ? (e7 -= a2.length, this.offsets[n14] += t8) : (t8 < 0 && this.offsets[n14]--, this.nodes.push(a2), this.offsets.push(t8 > 0 ? 1 : (a2 instanceof k ? a2.text.length : a2.children.length) << 1));
      }
    }
  }
  next(e7 = 0) {
    return e7 < 0 && (this.nextInner(-e7, -this.dir), e7 = this.value.length), this.nextInner(e7, this.dir);
  }
};
var Y = class {
  constructor(e7, t8, n14) {
    this.value = "", this.done = false, this.cursor = new B(e7, t8 > n14 ? -1 : 1), this.pos = t8 > n14 ? e7.length : 0, this.from = Math.min(t8, n14), this.to = Math.max(t8, n14);
  }
  nextInner(e7, t8) {
    if (t8 < 0 ? this.pos <= this.from : this.pos >= this.to) return this.value = "", this.done = true, this;
    e7 += Math.max(0, t8 < 0 ? this.pos - this.to : this.from - this.pos);
    let n14 = t8 < 0 ? this.pos - this.from : this.to - this.pos;
    e7 > n14 && (e7 = n14), n14 -= e7;
    let { value: i12 } = this.cursor.next(e7);
    return this.pos += (i12.length + e7) * t8, this.value = i12.length <= n14 ? i12 : t8 < 0 ? i12.slice(i12.length - n14) : i12.slice(0, n14), this.done = !this.value, this;
  }
  next(e7 = 0) {
    return e7 < 0 ? e7 = Math.max(e7, this.from - this.pos) : e7 > 0 && (e7 = Math.min(e7, this.to - this.pos)), this.nextInner(e7, this.cursor.dir);
  }
  get lineBreak() {
    return this.cursor.lineBreak && this.value != "";
  }
};
var _ = class {
  constructor(e7) {
    this.inner = e7, this.afterBreak = true, this.value = "", this.done = false;
  }
  next(e7 = 0) {
    let { done: t8, lineBreak: n14, value: i12 } = this.inner.next(e7);
    return t8 && this.afterBreak ? (this.value = "", this.afterBreak = false) : t8 ? (this.done = true, this.value = "") : n14 ? this.afterBreak ? this.value = "" : (this.afterBreak = true, this.next()) : (this.value = i12, this.afterBreak = false), this;
  }
  get lineBreak() {
    return false;
  }
};
typeof Symbol < "u" && (m.prototype[Symbol.iterator] = function() {
  return this.iter();
}, B.prototype[Symbol.iterator] = Y.prototype[Symbol.iterator] = _.prototype[Symbol.iterator] = function() {
  return this;
});
var fe = class {
  constructor(e7, t8, n14, i12) {
    this.from = e7, this.to = t8, this.number = n14, this.text = i12;
  }
  get length() {
    return this.to - this.from;
  }
};
function $(s212, e7, t8) {
  return e7 = Math.max(0, Math.min(s212.length, e7)), [e7, Math.max(e7, Math.min(s212.length, t8))];
}
var D = "lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((s212) => s212 ? parseInt(s212, 36) : 1);
for (let s212 = 1; s212 < D.length; s212++) D[s212] += D[s212 - 1];
function Ze(s212) {
  for (let e7 = 1; e7 < D.length; e7 += 2) if (D[e7] > s212) return D[e7 - 1] <= s212;
  return false;
}
function Ee(s212) {
  return s212 >= 127462 && s212 <= 127487;
}
var be = 8205;
function ee(s212, e7, t8 = true, n14 = true) {
  return (t8 ? Fe : Ke)(s212, e7, n14);
}
function Fe(s212, e7, t8) {
  if (e7 == s212.length) return e7;
  e7 && Je(s212.charCodeAt(e7)) && Le(s212.charCodeAt(e7 - 1)) && e7--;
  let n14 = ae(s212, e7);
  for (e7 += Oe(n14); e7 < s212.length; ) {
    let i12 = ae(s212, e7);
    if (n14 == be || i12 == be || t8 && Ze(i12)) e7 += Oe(i12), n14 = i12;
    else if (Ee(i12)) {
      let r2 = 0, l11 = e7 - 2;
      for (; l11 >= 0 && Ee(ae(s212, l11)); ) r2++, l11 -= 2;
      if (r2 % 2 == 0) break;
      e7 += 2;
    } else break;
  }
  return e7;
}
function Ke(s212, e7, t8) {
  for (; e7 > 0; ) {
    let n14 = Fe(s212, e7 - 2, t8);
    if (n14 < e7) return n14;
    e7--;
  }
  return 0;
}
function Je(s212) {
  return s212 >= 56320 && s212 < 57344;
}
function Le(s212) {
  return s212 >= 55296 && s212 < 56320;
}
function ae(s212, e7) {
  let t8 = s212.charCodeAt(e7);
  if (!Le(t8) || e7 + 1 == s212.length) return t8;
  let n14 = s212.charCodeAt(e7 + 1);
  return Je(n14) ? (t8 - 55296 << 10) + (n14 - 56320) + 65536 : t8;
}
function lt(s212) {
  return s212 <= 65535 ? String.fromCharCode(s212) : (s212 -= 65536, String.fromCharCode((s212 >> 10) + 55296, (s212 & 1023) + 56320));
}
function Oe(s212) {
  return s212 < 65536 ? 1 : 2;
}
var ue = /\r\n?|\n/;
var E = function(s212) {
  return s212[s212.Simple = 0] = "Simple", s212[s212.TrackDel = 1] = "TrackDel", s212[s212.TrackBefore = 2] = "TrackBefore", s212[s212.TrackAfter = 3] = "TrackAfter", s212;
}(E || (E = {}));
var C = class s4 {
  constructor(e7) {
    this.sections = e7;
  }
  get length() {
    let e7 = 0;
    for (let t8 = 0; t8 < this.sections.length; t8 += 2) e7 += this.sections[t8];
    return e7;
  }
  get newLength() {
    let e7 = 0;
    for (let t8 = 0; t8 < this.sections.length; t8 += 2) {
      let n14 = this.sections[t8 + 1];
      e7 += n14 < 0 ? this.sections[t8] : n14;
    }
    return e7;
  }
  get empty() {
    return this.sections.length == 0 || this.sections.length == 2 && this.sections[1] < 0;
  }
  iterGaps(e7) {
    for (let t8 = 0, n14 = 0, i12 = 0; t8 < this.sections.length; ) {
      let r2 = this.sections[t8++], l11 = this.sections[t8++];
      l11 < 0 ? (e7(n14, i12, r2), i12 += r2) : i12 += l11, n14 += r2;
    }
  }
  iterChangedRanges(e7, t8 = false) {
    ce(this, e7, t8);
  }
  get invertedDesc() {
    let e7 = [];
    for (let t8 = 0; t8 < this.sections.length; ) {
      let n14 = this.sections[t8++], i12 = this.sections[t8++];
      i12 < 0 ? e7.push(n14, i12) : e7.push(i12, n14);
    }
    return new s4(e7);
  }
  composeDesc(e7) {
    return this.empty ? e7 : e7.empty ? this : Ne(this, e7);
  }
  mapDesc(e7, t8 = false) {
    return e7.empty ? this : de(this, e7, t8);
  }
  mapPos(e7, t8 = -1, n14 = E.Simple) {
    let i12 = 0, r2 = 0;
    for (let l11 = 0; l11 < this.sections.length; ) {
      let h3 = this.sections[l11++], a2 = this.sections[l11++], o = i12 + h3;
      if (a2 < 0) {
        if (o > e7) return r2 + (e7 - i12);
        r2 += h3;
      } else {
        if (n14 != E.Simple && o >= e7 && (n14 == E.TrackDel && i12 < e7 && o > e7 || n14 == E.TrackBefore && i12 < e7 || n14 == E.TrackAfter && o > e7)) return null;
        if (o > e7 || o == e7 && t8 < 0 && !h3) return e7 == i12 || t8 < 0 ? r2 : r2 + a2;
        r2 += a2;
      }
      i12 = o;
    }
    if (e7 > i12) throw new RangeError(`Position ${e7} is out of range for changeset of length ${i12}`);
    return r2;
  }
  touchesRange(e7, t8 = e7) {
    for (let n14 = 0, i12 = 0; n14 < this.sections.length && i12 <= t8; ) {
      let r2 = this.sections[n14++], l11 = this.sections[n14++], h3 = i12 + r2;
      if (l11 >= 0 && i12 <= t8 && h3 >= e7) return i12 < e7 && h3 > t8 ? "cover" : true;
      i12 = h3;
    }
    return false;
  }
  toString() {
    let e7 = "";
    for (let t8 = 0; t8 < this.sections.length; ) {
      let n14 = this.sections[t8++], i12 = this.sections[t8++];
      e7 += (e7 ? " " : "") + n14 + (i12 >= 0 ? ":" + i12 : "");
    }
    return e7;
  }
  toJSON() {
    return this.sections;
  }
  static fromJSON(e7) {
    if (!Array.isArray(e7) || e7.length % 2 || e7.some((t8) => typeof t8 != "number")) throw new RangeError("Invalid JSON representation of ChangeDesc");
    return new s4(e7);
  }
  static create(e7) {
    return new s4(e7);
  }
};
var A = class s5 extends C {
  constructor(e7, t8) {
    super(e7), this.inserted = t8;
  }
  apply(e7) {
    if (this.length != e7.length) throw new RangeError("Applying change set to a document with the wrong length");
    return ce(this, (t8, n14, i12, r2, l11) => e7 = e7.replace(i12, i12 + (n14 - t8), l11), false), e7;
  }
  mapDesc(e7, t8 = false) {
    return de(this, e7, t8, true);
  }
  invert(e7) {
    let t8 = this.sections.slice(), n14 = [];
    for (let i12 = 0, r2 = 0; i12 < t8.length; i12 += 2) {
      let l11 = t8[i12], h3 = t8[i12 + 1];
      if (h3 >= 0) {
        t8[i12] = h3, t8[i12 + 1] = l11;
        let a2 = i12 >> 1;
        for (; n14.length < a2; ) n14.push(m.empty);
        n14.push(l11 ? e7.slice(r2, r2 + l11) : m.empty);
      }
      r2 += l11;
    }
    return new s5(t8, n14);
  }
  compose(e7) {
    return this.empty ? e7 : e7.empty ? this : Ne(this, e7, true);
  }
  map(e7, t8 = false) {
    return e7.empty ? this : de(this, e7, t8, true);
  }
  iterChanges(e7, t8 = false) {
    ce(this, e7, t8);
  }
  get desc() {
    return C.create(this.sections);
  }
  filter(e7) {
    let t8 = [], n14 = [], i12 = [], r2 = new F(this);
    e: for (let l11 = 0, h3 = 0; ; ) {
      let a2 = l11 == e7.length ? 1e9 : e7[l11++];
      for (; h3 < a2 || h3 == a2 && r2.len == 0; ) {
        if (r2.done) break e;
        let f6 = Math.min(r2.len, a2 - h3);
        w(i12, f6, -1);
        let u3 = r2.ins == -1 ? -1 : r2.off == 0 ? r2.ins : 0;
        w(t8, f6, u3), u3 > 0 && b(n14, t8, r2.text), r2.forward(f6), h3 += f6;
      }
      let o = e7[l11++];
      for (; h3 < o; ) {
        if (r2.done) break e;
        let f6 = Math.min(r2.len, o - h3);
        w(t8, f6, -1), w(i12, f6, r2.ins == -1 ? -1 : r2.off == 0 ? r2.ins : 0), r2.forward(f6), h3 += f6;
      }
    }
    return { changes: new s5(t8, n14), filtered: C.create(i12) };
  }
  toJSON() {
    let e7 = [];
    for (let t8 = 0; t8 < this.sections.length; t8 += 2) {
      let n14 = this.sections[t8], i12 = this.sections[t8 + 1];
      i12 < 0 ? e7.push(n14) : i12 == 0 ? e7.push([n14]) : e7.push([n14].concat(this.inserted[t8 >> 1].toJSON()));
    }
    return e7;
  }
  static of(e7, t8, n14) {
    let i12 = [], r2 = [], l11 = 0, h3 = null;
    function a2(f6 = false) {
      if (!f6 && !i12.length) return;
      l11 < t8 && w(i12, t8 - l11, -1);
      let u3 = new s5(i12, r2);
      h3 = h3 ? h3.compose(u3.map(h3)) : u3, i12 = [], r2 = [], l11 = 0;
    }
    function o(f6) {
      if (Array.isArray(f6)) for (let u3 of f6) o(u3);
      else if (f6 instanceof s5) {
        if (f6.length != t8) throw new RangeError(`Mismatched change set length (got ${f6.length}, expected ${t8})`);
        a2(), h3 = h3 ? h3.compose(f6.map(h3)) : f6;
      } else {
        let { from: u3, to: d4 = u3, insert: c3 } = f6;
        if (u3 > d4 || u3 < 0 || d4 > t8) throw new RangeError(`Invalid change range ${u3} to ${d4} (in doc of length ${t8})`);
        let g8 = c3 ? typeof c3 == "string" ? m.of(c3.split(n14 || ue)) : c3 : m.empty, P23 = g8.length;
        if (u3 == d4 && P23 == 0) return;
        u3 < l11 && a2(), u3 > l11 && w(i12, u3 - l11, -1), w(i12, d4 - u3, P23), b(r2, i12, g8), l11 = d4;
      }
    }
    return o(e7), a2(!h3), h3;
  }
  static empty(e7) {
    return new s5(e7 ? [e7, -1] : [], []);
  }
  static fromJSON(e7) {
    if (!Array.isArray(e7)) throw new RangeError("Invalid JSON representation of ChangeSet");
    let t8 = [], n14 = [];
    for (let i12 = 0; i12 < e7.length; i12++) {
      let r2 = e7[i12];
      if (typeof r2 == "number") t8.push(r2, -1);
      else {
        if (!Array.isArray(r2) || typeof r2[0] != "number" || r2.some((l11, h3) => h3 && typeof l11 != "string")) throw new RangeError("Invalid JSON representation of ChangeSet");
        if (r2.length == 1) t8.push(r2[0], 0);
        else {
          for (; n14.length < i12; ) n14.push(m.empty);
          n14[i12] = m.of(r2.slice(1)), t8.push(r2[0], n14[i12].length);
        }
      }
    }
    return new s5(t8, n14);
  }
  static createSet(e7, t8) {
    return new s5(e7, t8);
  }
};
function w(s212, e7, t8, n14 = false) {
  if (e7 == 0 && t8 <= 0) return;
  let i12 = s212.length - 2;
  i12 >= 0 && t8 <= 0 && t8 == s212[i12 + 1] ? s212[i12] += e7 : e7 == 0 && s212[i12] == 0 ? s212[i12 + 1] += t8 : n14 ? (s212[i12] += e7, s212[i12 + 1] += t8) : s212.push(e7, t8);
}
function b(s212, e7, t8) {
  if (t8.length == 0) return;
  let n14 = e7.length - 2 >> 1;
  if (n14 < s212.length) s212[s212.length - 1] = s212[s212.length - 1].append(t8);
  else {
    for (; s212.length < n14; ) s212.push(m.empty);
    s212.push(t8);
  }
}
function ce(s212, e7, t8) {
  let n14 = s212.inserted;
  for (let i12 = 0, r2 = 0, l11 = 0; l11 < s212.sections.length; ) {
    let h3 = s212.sections[l11++], a2 = s212.sections[l11++];
    if (a2 < 0) i12 += h3, r2 += h3;
    else {
      let o = i12, f6 = r2, u3 = m.empty;
      for (; o += h3, f6 += a2, a2 && n14 && (u3 = u3.append(n14[l11 - 2 >> 1])), !(t8 || l11 == s212.sections.length || s212.sections[l11 + 1] < 0); ) h3 = s212.sections[l11++], a2 = s212.sections[l11++];
      e7(i12, o, r2, f6, u3), i12 = o, r2 = f6;
    }
  }
}
function de(s212, e7, t8, n14 = false) {
  let i12 = [], r2 = n14 ? [] : null, l11 = new F(s212), h3 = new F(e7);
  for (let a2 = -1; ; ) if (l11.ins == -1 && h3.ins == -1) {
    let o = Math.min(l11.len, h3.len);
    w(i12, o, -1), l11.forward(o), h3.forward(o);
  } else if (h3.ins >= 0 && (l11.ins < 0 || a2 == l11.i || l11.off == 0 && (h3.len < l11.len || h3.len == l11.len && !t8))) {
    let o = h3.len;
    for (w(i12, h3.ins, -1); o; ) {
      let f6 = Math.min(l11.len, o);
      l11.ins >= 0 && a2 < l11.i && l11.len <= f6 && (w(i12, 0, l11.ins), r2 && b(r2, i12, l11.text), a2 = l11.i), l11.forward(f6), o -= f6;
    }
    h3.next();
  } else if (l11.ins >= 0) {
    let o = 0, f6 = l11.len;
    for (; f6; ) if (h3.ins == -1) {
      let u3 = Math.min(f6, h3.len);
      o += u3, f6 -= u3, h3.forward(u3);
    } else if (h3.ins == 0 && h3.len < f6) f6 -= h3.len, h3.next();
    else break;
    w(i12, o, a2 < l11.i ? l11.ins : 0), r2 && a2 < l11.i && b(r2, i12, l11.text), a2 = l11.i, l11.forward(l11.len - f6);
  } else {
    if (l11.done && h3.done) return r2 ? A.createSet(i12, r2) : C.create(i12);
    throw new Error("Mismatched change set lengths");
  }
}
function Ne(s212, e7, t8 = false) {
  let n14 = [], i12 = t8 ? [] : null, r2 = new F(s212), l11 = new F(e7);
  for (let h3 = false; ; ) {
    if (r2.done && l11.done) return i12 ? A.createSet(n14, i12) : C.create(n14);
    if (r2.ins == 0) w(n14, r2.len, 0, h3), r2.next();
    else if (l11.len == 0 && !l11.done) w(n14, 0, l11.ins, h3), i12 && b(i12, n14, l11.text), l11.next();
    else {
      if (r2.done || l11.done) throw new Error("Mismatched change set lengths");
      {
        let a2 = Math.min(r2.len2, l11.len), o = n14.length;
        if (r2.ins == -1) {
          let f6 = l11.ins == -1 ? -1 : l11.off ? 0 : l11.ins;
          w(n14, a2, f6, h3), i12 && f6 && b(i12, n14, l11.text);
        } else l11.ins == -1 ? (w(n14, r2.off ? 0 : r2.len, a2, h3), i12 && b(i12, n14, r2.textBit(a2))) : (w(n14, r2.off ? 0 : r2.len, l11.off ? 0 : l11.ins, h3), i12 && !l11.off && b(i12, n14, l11.text));
        h3 = (r2.ins > a2 || l11.ins >= 0 && l11.len > a2) && (h3 || n14.length > o), r2.forward2(a2), l11.forward(a2);
      }
    }
  }
}
var F = class {
  constructor(e7) {
    this.set = e7, this.i = 0, this.next();
  }
  next() {
    let { sections: e7 } = this.set;
    this.i < e7.length ? (this.len = e7[this.i++], this.ins = e7[this.i++]) : (this.len = 0, this.ins = -2), this.off = 0;
  }
  get done() {
    return this.ins == -2;
  }
  get len2() {
    return this.ins < 0 ? this.len : this.ins;
  }
  get text() {
    let { inserted: e7 } = this.set, t8 = this.i - 2 >> 1;
    return t8 >= e7.length ? m.empty : e7[t8];
  }
  textBit(e7) {
    let { inserted: t8 } = this.set, n14 = this.i - 2 >> 1;
    return n14 >= t8.length && !e7 ? m.empty : t8[n14].slice(this.off, e7 == null ? void 0 : this.off + e7);
  }
  forward(e7) {
    e7 == this.len ? this.next() : (this.len -= e7, this.off += e7);
  }
  forward2(e7) {
    this.ins == -1 ? this.forward(e7) : e7 == this.ins ? this.next() : (this.ins -= e7, this.off += e7);
  }
};
var L = class s6 {
  constructor(e7, t8, n14) {
    this.from = e7, this.to = t8, this.flags = n14;
  }
  get anchor() {
    return this.flags & 32 ? this.to : this.from;
  }
  get head() {
    return this.flags & 32 ? this.from : this.to;
  }
  get empty() {
    return this.from == this.to;
  }
  get assoc() {
    return this.flags & 8 ? -1 : this.flags & 16 ? 1 : 0;
  }
  get bidiLevel() {
    let e7 = this.flags & 7;
    return e7 == 7 ? null : e7;
  }
  get goalColumn() {
    let e7 = this.flags >> 6;
    return e7 == 16777215 ? void 0 : e7;
  }
  map(e7, t8 = -1) {
    let n14, i12;
    return this.empty ? n14 = i12 = e7.mapPos(this.from, t8) : (n14 = e7.mapPos(this.from, 1), i12 = e7.mapPos(this.to, -1)), n14 == this.from && i12 == this.to ? this : new s6(n14, i12, this.flags);
  }
  extend(e7, t8 = e7) {
    if (e7 <= this.anchor && t8 >= this.anchor) return x.range(e7, t8);
    let n14 = Math.abs(e7 - this.anchor) > Math.abs(t8 - this.anchor) ? e7 : t8;
    return x.range(this.anchor, n14);
  }
  eq(e7, t8 = false) {
    return this.anchor == e7.anchor && this.head == e7.head && (!t8 || !this.empty || this.assoc == e7.assoc);
  }
  toJSON() {
    return { anchor: this.anchor, head: this.head };
  }
  static fromJSON(e7) {
    if (!e7 || typeof e7.anchor != "number" || typeof e7.head != "number") throw new RangeError("Invalid JSON representation for SelectionRange");
    return x.range(e7.anchor, e7.head);
  }
  static create(e7, t8, n14) {
    return new s6(e7, t8, n14);
  }
};
var x = class s7 {
  constructor(e7, t8) {
    this.ranges = e7, this.mainIndex = t8;
  }
  map(e7, t8 = -1) {
    return e7.empty ? this : s7.create(this.ranges.map((n14) => n14.map(e7, t8)), this.mainIndex);
  }
  eq(e7, t8 = false) {
    if (this.ranges.length != e7.ranges.length || this.mainIndex != e7.mainIndex) return false;
    for (let n14 = 0; n14 < this.ranges.length; n14++) if (!this.ranges[n14].eq(e7.ranges[n14], t8)) return false;
    return true;
  }
  get main() {
    return this.ranges[this.mainIndex];
  }
  asSingle() {
    return this.ranges.length == 1 ? this : new s7([this.main], 0);
  }
  addRange(e7, t8 = true) {
    return s7.create([e7].concat(this.ranges), t8 ? 0 : this.mainIndex + 1);
  }
  replaceRange(e7, t8 = this.mainIndex) {
    let n14 = this.ranges.slice();
    return n14[t8] = e7, s7.create(n14, this.mainIndex);
  }
  toJSON() {
    return { ranges: this.ranges.map((e7) => e7.toJSON()), main: this.mainIndex };
  }
  static fromJSON(e7) {
    if (!e7 || !Array.isArray(e7.ranges) || typeof e7.main != "number" || e7.main >= e7.ranges.length) throw new RangeError("Invalid JSON representation for EditorSelection");
    return new s7(e7.ranges.map((t8) => L.fromJSON(t8)), e7.main);
  }
  static single(e7, t8 = e7) {
    return new s7([s7.range(e7, t8)], 0);
  }
  static create(e7, t8 = 0) {
    if (e7.length == 0) throw new RangeError("A selection needs at least one range");
    for (let n14 = 0, i12 = 0; i12 < e7.length; i12++) {
      let r2 = e7[i12];
      if (r2.empty ? r2.from <= n14 : r2.from < n14) return s7.normalized(e7.slice(), t8);
      n14 = r2.to;
    }
    return new s7(e7, t8);
  }
  static cursor(e7, t8 = 0, n14, i12) {
    return L.create(e7, e7, (t8 == 0 ? 0 : t8 < 0 ? 8 : 16) | (n14 == null ? 7 : Math.min(6, n14)) | (i12 ?? 16777215) << 6);
  }
  static range(e7, t8, n14, i12) {
    let r2 = (n14 ?? 16777215) << 6 | (i12 == null ? 7 : Math.min(6, i12));
    return t8 < e7 ? L.create(t8, e7, 48 | r2) : L.create(e7, t8, (t8 > e7 ? 8 : 0) | r2);
  }
  static normalized(e7, t8 = 0) {
    let n14 = e7[t8];
    e7.sort((i12, r2) => i12.from - r2.from), t8 = e7.indexOf(n14);
    for (let i12 = 1; i12 < e7.length; i12++) {
      let r2 = e7[i12], l11 = e7[i12 - 1];
      if (r2.empty ? r2.from <= l11.to : r2.from < l11.to) {
        let h3 = l11.from, a2 = Math.max(r2.to, l11.to);
        i12 <= t8 && t8--, e7.splice(--i12, 2, r2.anchor > r2.head ? s7.range(a2, h3) : s7.range(h3, a2));
      }
    }
    return new s7(e7, t8);
  }
};
function De(s212, e7) {
  for (let t8 of s212.ranges) if (t8.to > e7) throw new RangeError("Selection points outside of document");
}
var Ie = 0;
var y = class s8 {
  constructor(e7, t8, n14, i12, r2) {
    this.combine = e7, this.compareInput = t8, this.compare = n14, this.isStatic = i12, this.id = Ie++, this.default = e7([]), this.extensions = typeof r2 == "function" ? r2(this) : r2;
  }
  get reader() {
    return this;
  }
  static define(e7 = {}) {
    return new s8(e7.combine || ((t8) => t8), e7.compareInput || ((t8, n14) => t8 === n14), e7.compare || (e7.combine ? (t8, n14) => t8 === n14 : Pe), !!e7.static, e7.enables);
  }
  of(e7) {
    return new V([], this, 0, e7);
  }
  compute(e7, t8) {
    if (this.isStatic) throw new Error("Can't compute a static facet");
    return new V(e7, this, 1, t8);
  }
  computeN(e7, t8) {
    if (this.isStatic) throw new Error("Can't compute a static facet");
    return new V(e7, this, 2, t8);
  }
  from(e7, t8) {
    return t8 || (t8 = (n14) => n14), this.compute([e7], (n14) => t8(n14.field(e7)));
  }
};
function Pe(s212, e7) {
  return s212 == e7 || s212.length == e7.length && s212.every((t8, n14) => t8 === e7[n14]);
}
var V = class {
  constructor(e7, t8, n14, i12) {
    this.dependencies = e7, this.facet = t8, this.type = n14, this.value = i12, this.id = Ie++;
  }
  dynamicSlot(e7) {
    var t8;
    let n14 = this.value, i12 = this.facet.compareInput, r2 = this.id, l11 = e7[r2] >> 1, h3 = this.type == 2, a2 = false, o = false, f6 = [];
    for (let u3 of this.dependencies) u3 == "doc" ? a2 = true : u3 == "selection" ? o = true : ((t8 = e7[u3.id]) !== null && t8 !== void 0 ? t8 : 1) & 1 || f6.push(e7[u3.id]);
    return { create(u3) {
      return u3.values[l11] = n14(u3), 1;
    }, update(u3, d4) {
      if (a2 && d4.docChanged || o && (d4.docChanged || d4.selection) || ge(u3, f6)) {
        let c3 = n14(u3);
        if (h3 ? !Te(c3, u3.values[l11], i12) : !i12(c3, u3.values[l11])) return u3.values[l11] = c3, 1;
      }
      return 0;
    }, reconfigure: (u3, d4) => {
      let c3, g8 = d4.config.address[r2];
      if (g8 != null) {
        let P23 = se(d4, g8);
        if (this.dependencies.every((p3) => p3 instanceof y ? d4.facet(p3) === u3.facet(p3) : p3 instanceof z ? d4.field(p3, false) == u3.field(p3, false) : true) || (h3 ? Te(c3 = n14(u3), P23, i12) : i12(c3 = n14(u3), P23))) return u3.values[l11] = P23, 0;
      } else c3 = n14(u3);
      return u3.values[l11] = c3, 1;
    } };
  }
};
function Te(s212, e7, t8) {
  if (s212.length != e7.length) return false;
  for (let n14 = 0; n14 < s212.length; n14++) if (!t8(s212[n14], e7[n14])) return false;
  return true;
}
function ge(s212, e7) {
  let t8 = false;
  for (let n14 of e7) j(s212, n14) & 1 && (t8 = true);
  return t8;
}
function Qe(s212, e7, t8) {
  let n14 = t8.map((a2) => s212[a2.id]), i12 = t8.map((a2) => a2.type), r2 = n14.filter((a2) => !(a2 & 1)), l11 = s212[e7.id] >> 1;
  function h3(a2) {
    let o = [];
    for (let f6 = 0; f6 < n14.length; f6++) {
      let u3 = se(a2, n14[f6]);
      if (i12[f6] == 2) for (let d4 of u3) o.push(d4);
      else o.push(u3);
    }
    return e7.combine(o);
  }
  return { create(a2) {
    for (let o of n14) j(a2, o);
    return a2.values[l11] = h3(a2), 1;
  }, update(a2, o) {
    if (!ge(a2, r2)) return 0;
    let f6 = h3(a2);
    return e7.compare(f6, a2.values[l11]) ? 0 : (a2.values[l11] = f6, 1);
  }, reconfigure(a2, o) {
    let f6 = ge(a2, n14), u3 = o.config.facets[e7.id], d4 = o.facet(e7);
    if (u3 && !f6 && Pe(t8, u3)) return a2.values[l11] = d4, 0;
    let c3 = h3(a2);
    return e7.compare(c3, d4) ? (a2.values[l11] = d4, 0) : (a2.values[l11] = c3, 1);
  } };
}
var Me = y.define({ static: true });
var z = class s9 {
  constructor(e7, t8, n14, i12, r2) {
    this.id = e7, this.createF = t8, this.updateF = n14, this.compareF = i12, this.spec = r2, this.provides = void 0;
  }
  static define(e7) {
    let t8 = new s9(Ie++, e7.create, e7.update, e7.compare || ((n14, i12) => n14 === i12), e7);
    return e7.provide && (t8.provides = e7.provide(t8)), t8;
  }
  create(e7) {
    let t8 = e7.facet(Me).find((n14) => n14.field == this);
    return (t8?.create || this.createF)(e7);
  }
  slot(e7) {
    let t8 = e7[this.id] >> 1;
    return { create: (n14) => (n14.values[t8] = this.create(n14), 1), update: (n14, i12) => {
      let r2 = n14.values[t8], l11 = this.updateF(r2, i12);
      return this.compareF(r2, l11) ? 0 : (n14.values[t8] = l11, 1);
    }, reconfigure: (n14, i12) => i12.config.address[this.id] != null ? (n14.values[t8] = i12.field(this), 0) : (n14.values[t8] = this.create(n14), 1) };
  }
  init(e7) {
    return [this, Me.of({ field: this, create: e7 })];
  }
  get extension() {
    return this;
  }
};
var M = { lowest: 4, low: 3, default: 2, high: 1, highest: 0 };
function U(s212) {
  return (e7) => new te(e7, s212);
}
var ht = { highest: U(M.highest), high: U(M.high), default: U(M.default), low: U(M.low), lowest: U(M.lowest) };
var te = class {
  constructor(e7, t8) {
    this.inner = e7, this.prec = t8;
  }
};
var ne = class s10 {
  of(e7) {
    return new G(this, e7);
  }
  reconfigure(e7) {
    return s10.reconfigure.of({ compartment: this, extension: e7 });
  }
  get(e7) {
    return e7.config.compartments.get(this);
  }
};
var G = class {
  constructor(e7, t8) {
    this.compartment = e7, this.inner = t8;
  }
};
var ie = class s11 {
  constructor(e7, t8, n14, i12, r2, l11) {
    for (this.base = e7, this.compartments = t8, this.dynamicSlots = n14, this.address = i12, this.staticValues = r2, this.facets = l11, this.statusTemplate = []; this.statusTemplate.length < n14.length; ) this.statusTemplate.push(0);
  }
  staticFacet(e7) {
    let t8 = this.address[e7.id];
    return t8 == null ? e7.default : this.staticValues[t8 >> 1];
  }
  static resolve(e7, t8, n14) {
    let i12 = [], r2 = /* @__PURE__ */ Object.create(null), l11 = /* @__PURE__ */ new Map();
    for (let d4 of Xe(e7, t8, l11)) d4 instanceof z ? i12.push(d4) : (r2[d4.facet.id] || (r2[d4.facet.id] = [])).push(d4);
    let h3 = /* @__PURE__ */ Object.create(null), a2 = [], o = [];
    for (let d4 of i12) h3[d4.id] = o.length << 1, o.push((c3) => d4.slot(c3));
    let f6 = n14?.config.facets;
    for (let d4 in r2) {
      let c3 = r2[d4], g8 = c3[0].facet, P23 = f6 && f6[d4] || [];
      if (c3.every((p3) => p3.type == 0)) if (h3[g8.id] = a2.length << 1 | 1, Pe(P23, c3)) a2.push(n14.facet(g8));
      else {
        let p3 = g8.combine(c3.map((he19) => he19.value));
        a2.push(n14 && g8.compare(p3, n14.facet(g8)) ? n14.facet(g8) : p3);
      }
      else {
        for (let p3 of c3) p3.type == 0 ? (h3[p3.id] = a2.length << 1 | 1, a2.push(p3.value)) : (h3[p3.id] = o.length << 1, o.push((he19) => p3.dynamicSlot(he19)));
        h3[g8.id] = o.length << 1, o.push((p3) => Qe(p3, g8, c3));
      }
    }
    let u3 = o.map((d4) => d4(h3));
    return new s11(e7, l11, u3, h3, a2, r2);
  }
};
function Xe(s212, e7, t8) {
  let n14 = [[], [], [], [], []], i12 = /* @__PURE__ */ new Map();
  function r2(l11, h3) {
    let a2 = i12.get(l11);
    if (a2 != null) {
      if (a2 <= h3) return;
      let o = n14[a2].indexOf(l11);
      o > -1 && n14[a2].splice(o, 1), l11 instanceof G && t8.delete(l11.compartment);
    }
    if (i12.set(l11, h3), Array.isArray(l11)) for (let o of l11) r2(o, h3);
    else if (l11 instanceof G) {
      if (t8.has(l11.compartment)) throw new RangeError("Duplicate use of compartment in extensions");
      let o = e7.get(l11.compartment) || l11.inner;
      t8.set(l11.compartment, o), r2(o, h3);
    } else if (l11 instanceof te) r2(l11.inner, l11.prec);
    else if (l11 instanceof z) n14[h3].push(l11), l11.provides && r2(l11.provides, h3);
    else if (l11 instanceof V) n14[h3].push(l11), l11.facet.extensions && r2(l11.facet.extensions, M.default);
    else {
      let o = l11.extension;
      if (!o) throw new Error(`Unrecognized extension value in extension set (${l11}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);
      r2(o, h3);
    }
  }
  return r2(s212, M.default), n14.reduce((l11, h3) => l11.concat(h3));
}
function j(s212, e7) {
  if (e7 & 1) return 2;
  let t8 = e7 >> 1, n14 = s212.status[t8];
  if (n14 == 4) throw new Error("Cyclic dependency between fields and/or facets");
  if (n14 & 2) return n14;
  s212.status[t8] = 4;
  let i12 = s212.computeSlot(s212, s212.config.dynamicSlots[t8]);
  return s212.status[t8] = 2 | i12;
}
function se(s212, e7) {
  return e7 & 1 ? s212.config.staticValues[e7 >> 1] : s212.values[e7 >> 1];
}
var Ve = y.define();
var pe = y.define({ combine: (s212) => s212.some((e7) => e7), static: true });
var qe = y.define({ combine: (s212) => s212.length ? s212[0] : void 0, static: true });
var $e = y.define();
var ze = y.define();
var We = y.define();
var Ue = y.define({ combine: (s212) => s212.length ? s212[0] : false });
var J = class {
  constructor(e7, t8) {
    this.type = e7, this.value = t8;
  }
  static define() {
    return new me();
  }
};
var me = class {
  of(e7) {
    return new J(this, e7);
  }
};
var we = class {
  constructor(e7) {
    this.map = e7;
  }
  of(e7) {
    return new v(this, e7);
  }
};
var v = class s12 {
  constructor(e7, t8) {
    this.type = e7, this.value = t8;
  }
  map(e7) {
    let t8 = this.type.map(this.value, e7);
    return t8 === void 0 ? void 0 : t8 == this.value ? this : new s12(this.type, t8);
  }
  is(e7) {
    return this.type == e7;
  }
  static define(e7 = {}) {
    return new we(e7.map || ((t8) => t8));
  }
  static mapEffects(e7, t8) {
    if (!e7.length) return e7;
    let n14 = [];
    for (let i12 of e7) {
      let r2 = i12.map(t8);
      r2 && n14.push(r2);
    }
    return n14;
  }
};
v.reconfigure = v.define();
v.appendConfig = v.define();
var S = class s13 {
  constructor(e7, t8, n14, i12, r2, l11) {
    this.startState = e7, this.changes = t8, this.selection = n14, this.effects = i12, this.annotations = r2, this.scrollIntoView = l11, this._doc = null, this._state = null, n14 && De(n14, t8.newLength), r2.some((h3) => h3.type == s13.time) || (this.annotations = r2.concat(s13.time.of(Date.now())));
  }
  static create(e7, t8, n14, i12, r2, l11) {
    return new s13(e7, t8, n14, i12, r2, l11);
  }
  get newDoc() {
    return this._doc || (this._doc = this.changes.apply(this.startState.doc));
  }
  get newSelection() {
    return this.selection || this.startState.selection.map(this.changes);
  }
  get state() {
    return this._state || this.startState.applyTransaction(this), this._state;
  }
  annotation(e7) {
    for (let t8 of this.annotations) if (t8.type == e7) return t8.value;
  }
  get docChanged() {
    return !this.changes.empty;
  }
  get reconfigured() {
    return this.startState.config != this.state.config;
  }
  isUserEvent(e7) {
    let t8 = this.annotation(s13.userEvent);
    return !!(t8 && (t8 == e7 || t8.length > e7.length && t8.slice(0, e7.length) == e7 && t8[e7.length] == "."));
  }
};
S.time = J.define();
S.userEvent = J.define();
S.addToHistory = J.define();
S.remote = J.define();
function Ye(s212, e7) {
  let t8 = [];
  for (let n14 = 0, i12 = 0; ; ) {
    let r2, l11;
    if (n14 < s212.length && (i12 == e7.length || e7[i12] >= s212[n14])) r2 = s212[n14++], l11 = s212[n14++];
    else if (i12 < e7.length) r2 = e7[i12++], l11 = e7[i12++];
    else return t8;
    !t8.length || t8[t8.length - 1] < r2 ? t8.push(r2, l11) : t8[t8.length - 1] < l11 && (t8[t8.length - 1] = l11);
  }
}
function je(s212, e7, t8) {
  var n14;
  let i12, r2, l11;
  return t8 ? (i12 = e7.changes, r2 = A.empty(e7.changes.length), l11 = s212.changes.compose(e7.changes)) : (i12 = e7.changes.map(s212.changes), r2 = s212.changes.mapDesc(e7.changes, true), l11 = s212.changes.compose(i12)), { changes: l11, selection: e7.selection ? e7.selection.map(r2) : (n14 = s212.selection) === null || n14 === void 0 ? void 0 : n14.map(i12), effects: v.mapEffects(s212.effects, i12).concat(v.mapEffects(e7.effects, r2)), annotations: s212.annotations.length ? s212.annotations.concat(e7.annotations) : e7.annotations, scrollIntoView: s212.scrollIntoView || e7.scrollIntoView };
}
function ve(s212, e7, t8) {
  let n14 = e7.selection, i12 = q(e7.annotations);
  return e7.userEvent && (i12 = i12.concat(S.userEvent.of(e7.userEvent))), { changes: e7.changes instanceof A ? e7.changes : A.of(e7.changes || [], t8, s212.facet(qe)), selection: n14 && (n14 instanceof x ? n14 : x.single(n14.anchor, n14.head)), effects: q(e7.effects), annotations: i12, scrollIntoView: !!e7.scrollIntoView };
}
function Ge(s212, e7, t8) {
  let n14 = ve(s212, e7.length ? e7[0] : {}, s212.doc.length);
  e7.length && e7[0].filter === false && (t8 = false);
  for (let r2 = 1; r2 < e7.length; r2++) {
    e7[r2].filter === false && (t8 = false);
    let l11 = !!e7[r2].sequential;
    n14 = je(n14, ve(s212, e7[r2], l11 ? n14.changes.newLength : s212.doc.length), l11);
  }
  let i12 = S.create(s212, n14.changes, n14.selection, n14.effects, n14.annotations, n14.scrollIntoView);
  return et(t8 ? _e(i12) : i12);
}
function _e(s212) {
  let e7 = s212.startState, t8 = true;
  for (let i12 of e7.facet($e)) {
    let r2 = i12(s212);
    if (r2 === false) {
      t8 = false;
      break;
    }
    Array.isArray(r2) && (t8 = t8 === true ? r2 : Ye(t8, r2));
  }
  if (t8 !== true) {
    let i12, r2;
    if (t8 === false) r2 = s212.changes.invertedDesc, i12 = A.empty(e7.doc.length);
    else {
      let l11 = s212.changes.filter(t8);
      i12 = l11.changes, r2 = l11.filtered.mapDesc(l11.changes).invertedDesc;
    }
    s212 = S.create(e7, i12, s212.selection && s212.selection.map(r2), v.mapEffects(s212.effects, r2), s212.annotations, s212.scrollIntoView);
  }
  let n14 = e7.facet(ze);
  for (let i12 = n14.length - 1; i12 >= 0; i12--) {
    let r2 = n14[i12](s212);
    r2 instanceof S ? s212 = r2 : Array.isArray(r2) && r2.length == 1 && r2[0] instanceof S ? s212 = r2[0] : s212 = Ge(e7, q(r2), false);
  }
  return s212;
}
function et(s212) {
  let e7 = s212.startState, t8 = e7.facet(We), n14 = s212;
  for (let i12 = t8.length - 1; i12 >= 0; i12--) {
    let r2 = t8[i12](s212);
    r2 && Object.keys(r2).length && (n14 = je(n14, ve(e7, r2, s212.changes.newLength), true));
  }
  return n14 == s212 ? s212 : S.create(e7, s212.changes, s212.selection, n14.effects, n14.annotations, n14.scrollIntoView);
}
var tt = [];
function q(s212) {
  return s212 == null ? tt : Array.isArray(s212) ? s212 : [s212];
}
var O = function(s212) {
  return s212[s212.Word = 0] = "Word", s212[s212.Space = 1] = "Space", s212[s212.Other = 2] = "Other", s212;
}(O || (O = {}));
var nt = /[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;
var xe;
try {
  xe = new RegExp("[\\p{Alphabetic}\\p{Number}_]", "u");
} catch {
}
function it(s212) {
  if (xe) return xe.test(s212);
  for (let e7 = 0; e7 < s212.length; e7++) {
    let t8 = s212[e7];
    if (/\w/.test(t8) || t8 > "Â€" && (t8.toUpperCase() != t8.toLowerCase() || nt.test(t8))) return true;
  }
  return false;
}
function st(s212) {
  return (e7) => {
    if (!/\S/.test(e7)) return O.Space;
    if (it(e7)) return O.Word;
    for (let t8 = 0; t8 < s212.length; t8++) if (e7.indexOf(s212[t8]) > -1) return O.Word;
    return O.Other;
  };
}
var I = class s14 {
  constructor(e7, t8, n14, i12, r2, l11) {
    this.config = e7, this.doc = t8, this.selection = n14, this.values = i12, this.status = e7.statusTemplate.slice(), this.computeSlot = r2, l11 && (l11._state = this);
    for (let h3 = 0; h3 < this.config.dynamicSlots.length; h3++) j(this, h3 << 1);
    this.computeSlot = null;
  }
  field(e7, t8 = true) {
    let n14 = this.config.address[e7.id];
    if (n14 == null) {
      if (t8) throw new RangeError("Field is not present in this state");
      return;
    }
    return j(this, n14), se(this, n14);
  }
  update(...e7) {
    return Ge(this, e7, true);
  }
  applyTransaction(e7) {
    let t8 = this.config, { base: n14, compartments: i12 } = t8;
    for (let h3 of e7.effects) h3.is(ne.reconfigure) ? (t8 && (i12 = /* @__PURE__ */ new Map(), t8.compartments.forEach((a2, o) => i12.set(o, a2)), t8 = null), i12.set(h3.value.compartment, h3.value.extension)) : h3.is(v.reconfigure) ? (t8 = null, n14 = h3.value) : h3.is(v.appendConfig) && (t8 = null, n14 = q(n14).concat(h3.value));
    let r2;
    t8 ? r2 = e7.startState.values.slice() : (t8 = ie.resolve(n14, i12, this), r2 = new s14(t8, this.doc, this.selection, t8.dynamicSlots.map(() => null), (a2, o) => o.reconfigure(a2, this), null).values);
    let l11 = e7.startState.facet(pe) ? e7.newSelection : e7.newSelection.asSingle();
    new s14(t8, e7.newDoc, l11, r2, (h3, a2) => a2.update(h3, e7), e7);
  }
  replaceSelection(e7) {
    return typeof e7 == "string" && (e7 = this.toText(e7)), this.changeByRange((t8) => ({ changes: { from: t8.from, to: t8.to, insert: e7 }, range: x.cursor(t8.from + e7.length) }));
  }
  changeByRange(e7) {
    let t8 = this.selection, n14 = e7(t8.ranges[0]), i12 = this.changes(n14.changes), r2 = [n14.range], l11 = q(n14.effects);
    for (let h3 = 1; h3 < t8.ranges.length; h3++) {
      let a2 = e7(t8.ranges[h3]), o = this.changes(a2.changes), f6 = o.map(i12);
      for (let d4 = 0; d4 < h3; d4++) r2[d4] = r2[d4].map(f6);
      let u3 = i12.mapDesc(o, true);
      r2.push(a2.range.map(u3)), i12 = i12.compose(f6), l11 = v.mapEffects(l11, f6).concat(v.mapEffects(q(a2.effects), u3));
    }
    return { changes: i12, selection: x.create(r2, t8.mainIndex), effects: l11 };
  }
  changes(e7 = []) {
    return e7 instanceof A ? e7 : A.of(e7, this.doc.length, this.facet(s14.lineSeparator));
  }
  toText(e7) {
    return m.of(e7.split(this.facet(s14.lineSeparator) || ue));
  }
  sliceDoc(e7 = 0, t8 = this.doc.length) {
    return this.doc.sliceString(e7, t8, this.lineBreak);
  }
  facet(e7) {
    let t8 = this.config.address[e7.id];
    return t8 == null ? e7.default : (j(this, t8), se(this, t8));
  }
  toJSON(e7) {
    let t8 = { doc: this.sliceDoc(), selection: this.selection.toJSON() };
    if (e7) for (let n14 in e7) {
      let i12 = e7[n14];
      i12 instanceof z && this.config.address[i12.id] != null && (t8[n14] = i12.spec.toJSON(this.field(e7[n14]), this));
    }
    return t8;
  }
  static fromJSON(e7, t8 = {}, n14) {
    if (!e7 || typeof e7.doc != "string") throw new RangeError("Invalid JSON representation for EditorState");
    let i12 = [];
    if (n14) {
      for (let r2 in n14) if (Object.prototype.hasOwnProperty.call(e7, r2)) {
        let l11 = n14[r2], h3 = e7[r2];
        i12.push(l11.init((a2) => l11.spec.fromJSON(h3, a2)));
      }
    }
    return s14.create({ doc: e7.doc, selection: x.fromJSON(e7.selection), extensions: t8.extensions ? i12.concat([t8.extensions]) : i12 });
  }
  static create(e7 = {}) {
    let t8 = ie.resolve(e7.extensions || [], /* @__PURE__ */ new Map()), n14 = e7.doc instanceof m ? e7.doc : m.of((e7.doc || "").split(t8.staticFacet(s14.lineSeparator) || ue)), i12 = e7.selection ? e7.selection instanceof x ? e7.selection : x.single(e7.selection.anchor, e7.selection.head) : x.single(0);
    return De(i12, n14.length), t8.staticFacet(pe) || (i12 = i12.asSingle()), new s14(t8, n14, i12, t8.dynamicSlots.map(() => null), (r2, l11) => l11.create(r2), null);
  }
  get tabSize() {
    return this.facet(s14.tabSize);
  }
  get lineBreak() {
    return this.facet(s14.lineSeparator) || `
`;
  }
  get readOnly() {
    return this.facet(Ue);
  }
  phrase(e7, ...t8) {
    for (let n14 of this.facet(s14.phrases)) if (Object.prototype.hasOwnProperty.call(n14, e7)) {
      e7 = n14[e7];
      break;
    }
    return t8.length && (e7 = e7.replace(/\$(\$|\d*)/g, (n14, i12) => {
      if (i12 == "$") return "$";
      let r2 = +(i12 || 1);
      return !r2 || r2 > t8.length ? n14 : t8[r2 - 1];
    })), e7;
  }
  languageDataAt(e7, t8, n14 = -1) {
    let i12 = [];
    for (let r2 of this.facet(Ve)) for (let l11 of r2(this, t8, n14)) Object.prototype.hasOwnProperty.call(l11, e7) && i12.push(l11[e7]);
    return i12;
  }
  charCategorizer(e7) {
    return st(this.languageDataAt("wordChars", e7).join(""));
  }
  wordAt(e7) {
    let { text: t8, from: n14, length: i12 } = this.doc.lineAt(e7), r2 = this.charCategorizer(e7), l11 = e7 - n14, h3 = e7 - n14;
    for (; l11 > 0; ) {
      let a2 = ee(t8, l11, false);
      if (r2(t8.slice(a2, l11)) != O.Word) break;
      l11 = a2;
    }
    for (; h3 < i12; ) {
      let a2 = ee(t8, h3);
      if (r2(t8.slice(h3, a2)) != O.Word) break;
      h3 = a2;
    }
    return l11 == h3 ? null : x.range(l11 + n14, h3 + n14);
  }
};
I.allowMultipleSelections = pe;
I.tabSize = y.define({ combine: (s212) => s212.length ? s212[0] : 4 });
I.lineSeparator = qe;
I.readOnly = Ue;
I.phrases = y.define({ compare(s212, e7) {
  let t8 = Object.keys(s212), n14 = Object.keys(e7);
  return t8.length == n14.length && t8.every((i12) => s212[i12] == e7[i12]);
} });
I.languageData = Ve;
I.changeFilter = $e;
I.transactionFilter = ze;
I.transactionExtender = We;
ne.reconfigure = v.define();
function at(s212, e7, t8 = {}) {
  let n14 = {};
  for (let i12 of s212) for (let r2 of Object.keys(i12)) {
    let l11 = i12[r2], h3 = n14[r2];
    if (h3 === void 0) n14[r2] = l11;
    else if (!(h3 === l11 || l11 === void 0)) if (Object.hasOwnProperty.call(t8, r2)) n14[r2] = t8[r2](h3, l11);
    else throw new Error("Config merge conflict for field " + r2);
  }
  for (let i12 in e7) n14[i12] === void 0 && (n14[i12] = e7[i12]);
  return n14;
}
var W = class {
  eq(e7) {
    return this == e7;
  }
  range(e7, t8 = e7) {
    return H.create(e7, t8, this);
  }
};
W.prototype.startSide = W.prototype.endSide = 0;
W.prototype.point = false;
W.prototype.mapMode = E.TrackDel;
var H = class s15 {
  constructor(e7, t8, n14) {
    this.from = e7, this.to = t8, this.value = n14;
  }
  static create(e7, t8, n14) {
    return new s15(e7, t8, n14);
  }
};
function ke(s212, e7) {
  return s212.from - e7.from || s212.value.startSide - e7.value.startSide;
}
var ye = class s16 {
  constructor(e7, t8, n14, i12) {
    this.from = e7, this.to = t8, this.value = n14, this.maxPoint = i12;
  }
  get length() {
    return this.to[this.to.length - 1];
  }
  findIndex(e7, t8, n14, i12 = 0) {
    let r2 = n14 ? this.to : this.from;
    for (let l11 = i12, h3 = r2.length; ; ) {
      if (l11 == h3) return l11;
      let a2 = l11 + h3 >> 1, o = r2[a2] - e7 || (n14 ? this.value[a2].endSide : this.value[a2].startSide) - t8;
      if (a2 == l11) return o >= 0 ? l11 : h3;
      o >= 0 ? h3 = a2 : l11 = a2 + 1;
    }
  }
  between(e7, t8, n14, i12) {
    for (let r2 = this.findIndex(t8, -1e9, true), l11 = this.findIndex(n14, 1e9, false, r2); r2 < l11; r2++) if (i12(this.from[r2] + e7, this.to[r2] + e7, this.value[r2]) === false) return false;
  }
  map(e7, t8) {
    let n14 = [], i12 = [], r2 = [], l11 = -1, h3 = -1;
    for (let a2 = 0; a2 < this.value.length; a2++) {
      let o = this.value[a2], f6 = this.from[a2] + e7, u3 = this.to[a2] + e7, d4, c3;
      if (f6 == u3) {
        let g8 = t8.mapPos(f6, o.startSide, o.mapMode);
        if (g8 == null || (d4 = c3 = g8, o.startSide != o.endSide && (c3 = t8.mapPos(f6, o.endSide), c3 < d4))) continue;
      } else if (d4 = t8.mapPos(f6, o.startSide), c3 = t8.mapPos(u3, o.endSide), d4 > c3 || d4 == c3 && o.startSide > 0 && o.endSide <= 0) continue;
      (c3 - d4 || o.endSide - o.startSide) < 0 || (l11 < 0 && (l11 = d4), o.point && (h3 = Math.max(h3, c3 - d4)), n14.push(o), i12.push(d4 - l11), r2.push(c3 - l11));
    }
    return { mapped: n14.length ? new s16(i12, r2, n14, h3) : null, pos: l11 };
  }
};
var T = class s17 {
  constructor(e7, t8, n14, i12) {
    this.chunkPos = e7, this.chunk = t8, this.nextLayer = n14, this.maxPoint = i12;
  }
  static create(e7, t8, n14, i12) {
    return new s17(e7, t8, n14, i12);
  }
  get length() {
    let e7 = this.chunk.length - 1;
    return e7 < 0 ? 0 : Math.max(this.chunkEnd(e7), this.nextLayer.length);
  }
  get size() {
    if (this.isEmpty) return 0;
    let e7 = this.nextLayer.size;
    for (let t8 of this.chunk) e7 += t8.value.length;
    return e7;
  }
  chunkEnd(e7) {
    return this.chunkPos[e7] + this.chunk[e7].length;
  }
  update(e7) {
    let { add: t8 = [], sort: n14 = false, filterFrom: i12 = 0, filterTo: r2 = this.length } = e7, l11 = e7.filter;
    if (t8.length == 0 && !l11) return this;
    if (n14 && (t8 = t8.slice().sort(ke)), this.isEmpty) return t8.length ? s17.of(t8) : this;
    let h3 = new le(this, null, -1).goto(0), a2 = 0, o = [], f6 = new re();
    for (; h3.value || a2 < t8.length; ) if (a2 < t8.length && (h3.from - t8[a2].from || h3.startSide - t8[a2].value.startSide) >= 0) {
      let u3 = t8[a2++];
      f6.addInner(u3.from, u3.to, u3.value) || o.push(u3);
    } else h3.rangeIndex == 1 && h3.chunkIndex < this.chunk.length && (a2 == t8.length || this.chunkEnd(h3.chunkIndex) < t8[a2].from) && (!l11 || i12 > this.chunkEnd(h3.chunkIndex) || r2 < this.chunkPos[h3.chunkIndex]) && f6.addChunk(this.chunkPos[h3.chunkIndex], this.chunk[h3.chunkIndex]) ? h3.nextChunk() : ((!l11 || i12 > h3.to || r2 < h3.from || l11(h3.from, h3.to, h3.value)) && (f6.addInner(h3.from, h3.to, h3.value) || o.push(H.create(h3.from, h3.to, h3.value))), h3.next());
    return f6.finishInner(this.nextLayer.isEmpty && !o.length ? s17.empty : this.nextLayer.update({ add: o, filter: l11, filterFrom: i12, filterTo: r2 }));
  }
  map(e7) {
    if (e7.empty || this.isEmpty) return this;
    let t8 = [], n14 = [], i12 = -1;
    for (let l11 = 0; l11 < this.chunk.length; l11++) {
      let h3 = this.chunkPos[l11], a2 = this.chunk[l11], o = e7.touchesRange(h3, h3 + a2.length);
      if (o === false) i12 = Math.max(i12, a2.maxPoint), t8.push(a2), n14.push(e7.mapPos(h3));
      else if (o === true) {
        let { mapped: f6, pos: u3 } = a2.map(h3, e7);
        f6 && (i12 = Math.max(i12, f6.maxPoint), t8.push(f6), n14.push(u3));
      }
    }
    let r2 = this.nextLayer.map(e7);
    return t8.length == 0 ? r2 : new s17(n14, t8, r2 || s17.empty, i12);
  }
  between(e7, t8, n14) {
    if (!this.isEmpty) {
      for (let i12 = 0; i12 < this.chunk.length; i12++) {
        let r2 = this.chunkPos[i12], l11 = this.chunk[i12];
        if (t8 >= r2 && e7 <= r2 + l11.length && l11.between(r2, e7 - r2, t8 - r2, n14) === false) return;
      }
      this.nextLayer.between(e7, t8, n14);
    }
  }
  iter(e7 = 0) {
    return Z.from([this]).goto(e7);
  }
  get isEmpty() {
    return this.nextLayer == this;
  }
  static iter(e7, t8 = 0) {
    return Z.from(e7).goto(t8);
  }
  static compare(e7, t8, n14, i12, r2 = -1) {
    let l11 = e7.filter((u3) => u3.maxPoint > 0 || !u3.isEmpty && u3.maxPoint >= r2), h3 = t8.filter((u3) => u3.maxPoint > 0 || !u3.isEmpty && u3.maxPoint >= r2), a2 = Re(l11, h3, n14), o = new R(l11, a2, r2), f6 = new R(h3, a2, r2);
    n14.iterGaps((u3, d4, c3) => Be(o, u3, f6, d4, c3, i12)), n14.empty && n14.length == 0 && Be(o, 0, f6, 0, 0, i12);
  }
  static eq(e7, t8, n14 = 0, i12) {
    i12 == null && (i12 = 999999999);
    let r2 = e7.filter((f6) => !f6.isEmpty && t8.indexOf(f6) < 0), l11 = t8.filter((f6) => !f6.isEmpty && e7.indexOf(f6) < 0);
    if (r2.length != l11.length) return false;
    if (!r2.length) return true;
    let h3 = Re(r2, l11), a2 = new R(r2, h3, 0).goto(n14), o = new R(l11, h3, 0).goto(n14);
    for (; ; ) {
      if (a2.to != o.to || !Se(a2.active, o.active) || a2.point && (!o.point || !a2.point.eq(o.point))) return false;
      if (a2.to > i12) return true;
      a2.next(), o.next();
    }
  }
  static spans(e7, t8, n14, i12, r2 = -1) {
    let l11 = new R(e7, null, r2).goto(t8), h3 = t8, a2 = l11.openStart;
    for (; ; ) {
      let o = Math.min(l11.to, n14);
      if (l11.point) {
        let f6 = l11.activeForPoint(l11.to), u3 = l11.pointFrom < t8 ? f6.length + 1 : l11.point.startSide < 0 ? f6.length : Math.min(f6.length, a2);
        i12.point(h3, o, l11.point, f6, u3, l11.pointRank), a2 = Math.min(l11.openEnd(o), f6.length);
      } else o > h3 && (i12.span(h3, o, l11.active, a2), a2 = l11.openEnd(o));
      if (l11.to > n14) return a2 + (l11.point && l11.to > n14 ? 1 : 0);
      h3 = l11.to, l11.next();
    }
  }
  static of(e7, t8 = false) {
    let n14 = new re();
    for (let i12 of e7 instanceof H ? [e7] : t8 ? rt(e7) : e7) n14.add(i12.from, i12.to, i12.value);
    return n14.finish();
  }
  static join(e7) {
    if (!e7.length) return s17.empty;
    let t8 = e7[e7.length - 1];
    for (let n14 = e7.length - 2; n14 >= 0; n14--) for (let i12 = e7[n14]; i12 != s17.empty; i12 = i12.nextLayer) t8 = new s17(i12.chunkPos, i12.chunk, t8, Math.max(i12.maxPoint, t8.maxPoint));
    return t8;
  }
};
T.empty = new T([], [], null, -1);
function rt(s212) {
  if (s212.length > 1) for (let e7 = s212[0], t8 = 1; t8 < s212.length; t8++) {
    let n14 = s212[t8];
    if (ke(e7, n14) > 0) return s212.slice().sort(ke);
    e7 = n14;
  }
  return s212;
}
T.empty.nextLayer = T.empty;
var re = class s18 {
  finishChunk(e7) {
    this.chunks.push(new ye(this.from, this.to, this.value, this.maxPoint)), this.chunkPos.push(this.chunkStart), this.chunkStart = -1, this.setMaxPoint = Math.max(this.setMaxPoint, this.maxPoint), this.maxPoint = -1, e7 && (this.from = [], this.to = [], this.value = []);
  }
  constructor() {
    this.chunks = [], this.chunkPos = [], this.chunkStart = -1, this.last = null, this.lastFrom = -1e9, this.lastTo = -1e9, this.from = [], this.to = [], this.value = [], this.maxPoint = -1, this.setMaxPoint = -1, this.nextLayer = null;
  }
  add(e7, t8, n14) {
    this.addInner(e7, t8, n14) || (this.nextLayer || (this.nextLayer = new s18())).add(e7, t8, n14);
  }
  addInner(e7, t8, n14) {
    let i12 = e7 - this.lastTo || n14.startSide - this.last.endSide;
    if (i12 <= 0 && (e7 - this.lastFrom || n14.startSide - this.last.startSide) < 0) throw new Error("Ranges must be added sorted by `from` position and `startSide`");
    return i12 < 0 ? false : (this.from.length == 250 && this.finishChunk(true), this.chunkStart < 0 && (this.chunkStart = e7), this.from.push(e7 - this.chunkStart), this.to.push(t8 - this.chunkStart), this.last = n14, this.lastFrom = e7, this.lastTo = t8, this.value.push(n14), n14.point && (this.maxPoint = Math.max(this.maxPoint, t8 - e7)), true);
  }
  addChunk(e7, t8) {
    if ((e7 - this.lastTo || t8.value[0].startSide - this.last.endSide) < 0) return false;
    this.from.length && this.finishChunk(true), this.setMaxPoint = Math.max(this.setMaxPoint, t8.maxPoint), this.chunks.push(t8), this.chunkPos.push(e7);
    let n14 = t8.value.length - 1;
    return this.last = t8.value[n14], this.lastFrom = t8.from[n14] + e7, this.lastTo = t8.to[n14] + e7, true;
  }
  finish() {
    return this.finishInner(T.empty);
  }
  finishInner(e7) {
    if (this.from.length && this.finishChunk(false), this.chunks.length == 0) return e7;
    let t8 = T.create(this.chunkPos, this.chunks, this.nextLayer ? this.nextLayer.finishInner(e7) : e7, this.setMaxPoint);
    return this.from = null, t8;
  }
};
function Re(s212, e7, t8) {
  let n14 = /* @__PURE__ */ new Map();
  for (let r2 of s212) for (let l11 = 0; l11 < r2.chunk.length; l11++) r2.chunk[l11].maxPoint <= 0 && n14.set(r2.chunk[l11], r2.chunkPos[l11]);
  let i12 = /* @__PURE__ */ new Set();
  for (let r2 of e7) for (let l11 = 0; l11 < r2.chunk.length; l11++) {
    let h3 = n14.get(r2.chunk[l11]);
    h3 != null && (t8 ? t8.mapPos(h3) : h3) == r2.chunkPos[l11] && !t8?.touchesRange(h3, h3 + r2.chunk[l11].length) && i12.add(r2.chunk[l11]);
  }
  return i12;
}
var le = class {
  constructor(e7, t8, n14, i12 = 0) {
    this.layer = e7, this.skip = t8, this.minPoint = n14, this.rank = i12;
  }
  get startSide() {
    return this.value ? this.value.startSide : 0;
  }
  get endSide() {
    return this.value ? this.value.endSide : 0;
  }
  goto(e7, t8 = -1e9) {
    return this.chunkIndex = this.rangeIndex = 0, this.gotoInner(e7, t8, false), this;
  }
  gotoInner(e7, t8, n14) {
    for (; this.chunkIndex < this.layer.chunk.length; ) {
      let i12 = this.layer.chunk[this.chunkIndex];
      if (!(this.skip && this.skip.has(i12) || this.layer.chunkEnd(this.chunkIndex) < e7 || i12.maxPoint < this.minPoint)) break;
      this.chunkIndex++, n14 = false;
    }
    if (this.chunkIndex < this.layer.chunk.length) {
      let i12 = this.layer.chunk[this.chunkIndex].findIndex(e7 - this.layer.chunkPos[this.chunkIndex], t8, true);
      (!n14 || this.rangeIndex < i12) && this.setRangeIndex(i12);
    }
    this.next();
  }
  forward(e7, t8) {
    (this.to - e7 || this.endSide - t8) < 0 && this.gotoInner(e7, t8, true);
  }
  next() {
    for (; ; ) if (this.chunkIndex == this.layer.chunk.length) {
      this.from = this.to = 1e9, this.value = null;
      break;
    } else {
      let e7 = this.layer.chunkPos[this.chunkIndex], t8 = this.layer.chunk[this.chunkIndex], n14 = e7 + t8.from[this.rangeIndex];
      if (this.from = n14, this.to = e7 + t8.to[this.rangeIndex], this.value = t8.value[this.rangeIndex], this.setRangeIndex(this.rangeIndex + 1), this.minPoint < 0 || this.value.point && this.to - this.from >= this.minPoint) break;
    }
  }
  setRangeIndex(e7) {
    if (e7 == this.layer.chunk[this.chunkIndex].value.length) {
      if (this.chunkIndex++, this.skip) for (; this.chunkIndex < this.layer.chunk.length && this.skip.has(this.layer.chunk[this.chunkIndex]); ) this.chunkIndex++;
      this.rangeIndex = 0;
    } else this.rangeIndex = e7;
  }
  nextChunk() {
    this.chunkIndex++, this.rangeIndex = 0, this.next();
  }
  compare(e7) {
    return this.from - e7.from || this.startSide - e7.startSide || this.rank - e7.rank || this.to - e7.to || this.endSide - e7.endSide;
  }
};
var Z = class s19 {
  constructor(e7) {
    this.heap = e7;
  }
  static from(e7, t8 = null, n14 = -1) {
    let i12 = [];
    for (let r2 = 0; r2 < e7.length; r2++) for (let l11 = e7[r2]; !l11.isEmpty; l11 = l11.nextLayer) l11.maxPoint >= n14 && i12.push(new le(l11, t8, n14, r2));
    return i12.length == 1 ? i12[0] : new s19(i12);
  }
  get startSide() {
    return this.value ? this.value.startSide : 0;
  }
  goto(e7, t8 = -1e9) {
    for (let n14 of this.heap) n14.goto(e7, t8);
    for (let n14 = this.heap.length >> 1; n14 >= 0; n14--) oe(this.heap, n14);
    return this.next(), this;
  }
  forward(e7, t8) {
    for (let n14 of this.heap) n14.forward(e7, t8);
    for (let n14 = this.heap.length >> 1; n14 >= 0; n14--) oe(this.heap, n14);
    (this.to - e7 || this.value.endSide - t8) < 0 && this.next();
  }
  next() {
    if (this.heap.length == 0) this.from = this.to = 1e9, this.value = null, this.rank = -1;
    else {
      let e7 = this.heap[0];
      this.from = e7.from, this.to = e7.to, this.value = e7.value, this.rank = e7.rank, e7.value && e7.next(), oe(this.heap, 0);
    }
  }
};
function oe(s212, e7) {
  for (let t8 = s212[e7]; ; ) {
    let n14 = (e7 << 1) + 1;
    if (n14 >= s212.length) break;
    let i12 = s212[n14];
    if (n14 + 1 < s212.length && i12.compare(s212[n14 + 1]) >= 0 && (i12 = s212[n14 + 1], n14++), t8.compare(i12) < 0) break;
    s212[n14] = t8, s212[e7] = i12, e7 = n14;
  }
}
var R = class {
  constructor(e7, t8, n14) {
    this.minPoint = n14, this.active = [], this.activeTo = [], this.activeRank = [], this.minActive = -1, this.point = null, this.pointFrom = 0, this.pointRank = 0, this.to = -1e9, this.endSide = 0, this.openStart = -1, this.cursor = Z.from(e7, t8, n14);
  }
  goto(e7, t8 = -1e9) {
    return this.cursor.goto(e7, t8), this.active.length = this.activeTo.length = this.activeRank.length = 0, this.minActive = -1, this.to = e7, this.endSide = t8, this.openStart = -1, this.next(), this;
  }
  forward(e7, t8) {
    for (; this.minActive > -1 && (this.activeTo[this.minActive] - e7 || this.active[this.minActive].endSide - t8) < 0; ) this.removeActive(this.minActive);
    this.cursor.forward(e7, t8);
  }
  removeActive(e7) {
    K(this.active, e7), K(this.activeTo, e7), K(this.activeRank, e7), this.minActive = Ce(this.active, this.activeTo);
  }
  addActive(e7) {
    let t8 = 0, { value: n14, to: i12, rank: r2 } = this.cursor;
    for (; t8 < this.activeRank.length && (r2 - this.activeRank[t8] || i12 - this.activeTo[t8]) > 0; ) t8++;
    Q(this.active, t8, n14), Q(this.activeTo, t8, i12), Q(this.activeRank, t8, r2), e7 && Q(e7, t8, this.cursor.from), this.minActive = Ce(this.active, this.activeTo);
  }
  next() {
    let e7 = this.to, t8 = this.point;
    this.point = null;
    let n14 = this.openStart < 0 ? [] : null;
    for (; ; ) {
      let i12 = this.minActive;
      if (i12 > -1 && (this.activeTo[i12] - this.cursor.from || this.active[i12].endSide - this.cursor.startSide) < 0) {
        if (this.activeTo[i12] > e7) {
          this.to = this.activeTo[i12], this.endSide = this.active[i12].endSide;
          break;
        }
        this.removeActive(i12), n14 && K(n14, i12);
      } else if (this.cursor.value) if (this.cursor.from > e7) {
        this.to = this.cursor.from, this.endSide = this.cursor.startSide;
        break;
      } else {
        let r2 = this.cursor.value;
        if (!r2.point) this.addActive(n14), this.cursor.next();
        else if (t8 && this.cursor.to == this.to && this.cursor.from < this.cursor.to) this.cursor.next();
        else {
          this.point = r2, this.pointFrom = this.cursor.from, this.pointRank = this.cursor.rank, this.to = this.cursor.to, this.endSide = r2.endSide, this.cursor.next(), this.forward(this.to, this.endSide);
          break;
        }
      }
      else {
        this.to = this.endSide = 1e9;
        break;
      }
    }
    if (n14) {
      this.openStart = 0;
      for (let i12 = n14.length - 1; i12 >= 0 && n14[i12] < e7; i12--) this.openStart++;
    }
  }
  activeForPoint(e7) {
    if (!this.active.length) return this.active;
    let t8 = [];
    for (let n14 = this.active.length - 1; n14 >= 0 && !(this.activeRank[n14] < this.pointRank); n14--) (this.activeTo[n14] > e7 || this.activeTo[n14] == e7 && this.active[n14].endSide >= this.point.endSide) && t8.push(this.active[n14]);
    return t8.reverse();
  }
  openEnd(e7) {
    let t8 = 0;
    for (let n14 = this.activeTo.length - 1; n14 >= 0 && this.activeTo[n14] > e7; n14--) t8++;
    return t8;
  }
};
function Be(s212, e7, t8, n14, i12, r2) {
  s212.goto(e7), t8.goto(n14);
  let l11 = n14 + i12, h3 = n14, a2 = n14 - e7;
  for (; ; ) {
    let o = s212.to + a2 - t8.to || s212.endSide - t8.endSide, f6 = o < 0 ? s212.to + a2 : t8.to, u3 = Math.min(f6, l11);
    if (s212.point || t8.point ? s212.point && t8.point && (s212.point == t8.point || s212.point.eq(t8.point)) && Se(s212.activeForPoint(s212.to), t8.activeForPoint(t8.to)) || r2.comparePoint(h3, u3, s212.point, t8.point) : u3 > h3 && !Se(s212.active, t8.active) && r2.compareRange(h3, u3, s212.active, t8.active), f6 > l11) break;
    h3 = f6, o <= 0 && s212.next(), o >= 0 && t8.next();
  }
}
function Se(s212, e7) {
  if (s212.length != e7.length) return false;
  for (let t8 = 0; t8 < s212.length; t8++) if (s212[t8] != e7[t8] && !s212[t8].eq(e7[t8])) return false;
  return true;
}
function K(s212, e7) {
  for (let t8 = e7, n14 = s212.length - 1; t8 < n14; t8++) s212[t8] = s212[t8 + 1];
  s212.pop();
}
function Q(s212, e7, t8) {
  for (let n14 = s212.length - 1; n14 >= e7; n14--) s212[n14 + 1] = s212[n14];
  s212[e7] = t8;
}
function Ce(s212, e7) {
  let t8 = -1, n14 = 1e9;
  for (let i12 = 0; i12 < e7.length; i12++) (e7[i12] - n14 || s212[i12].endSide - s212[t8].endSide) < 0 && (t8 = i12, n14 = e7[i12]);
  return t8;
}
function ot(s212, e7, t8 = s212.length) {
  let n14 = 0;
  for (let i12 = 0; i12 < t8; ) s212.charCodeAt(i12) == 9 ? (n14 += e7 - n14 % e7, i12++) : (n14++, i12 = ee(s212, i12));
  return n14;
}
function ft(s212, e7, t8, n14) {
  for (let i12 = 0, r2 = 0; ; ) {
    if (r2 >= e7) return i12;
    if (i12 == s212.length) break;
    r2 += s212.charCodeAt(i12) == 9 ? t8 - r2 % t8 : 1, i12 = ee(s212, i12);
  }
  return n14 === true ? -1 : s212.length;
}

// https://esm.sh/v135/style-mod@4.1.2/denonext/style-mod.mjs
var c = "Í¼";
var w2 = typeof Symbol > "u" ? "__" + c : Symbol.for(c);
var S2 = typeof Symbol > "u" ? "__styleSet" + Math.floor(Math.random() * 1e8) : Symbol("styleSet");
var T2 = typeof globalThis < "u" ? globalThis : typeof window < "u" ? window : {};
var b2 = class {
  constructor(e7, i12) {
    this.rules = [];
    let { finish: l11 } = i12 || {};
    function n14(t8) {
      return /^@/.test(t8) ? [t8] : t8.split(/,\s*/);
    }
    function s212(t8, a2, h3, f6) {
      let p3 = [], u3 = /^@(\w+)\b/.exec(t8[0]), m11 = u3 && u3[1] == "keyframes";
      if (u3 && a2 == null) return h3.push(t8[0] + ";");
      for (let o in a2) {
        let r2 = a2[o];
        if (/&/.test(o)) s212(o.split(/,\s*/).map((d4) => t8.map((y18) => d4.replace(/&/, y18))).reduce((d4, y18) => d4.concat(y18)), r2, h3);
        else if (r2 && typeof r2 == "object") {
          if (!u3) throw new RangeError("The value of a property (" + o + ") should be a primitive value.");
          s212(n14(o), r2, p3, m11);
        } else r2 != null && p3.push(o.replace(/_.*/, "").replace(/[A-Z]/g, (d4) => "-" + d4.toLowerCase()) + ": " + r2 + ";");
      }
      (p3.length || m11) && h3.push((l11 && !u3 && !f6 ? t8.map(l11) : t8).join(", ") + " {" + p3.join(" ") + "}");
    }
    for (let t8 in e7) s212(n14(t8), e7[t8], this.rules);
  }
  getRules() {
    return this.rules.join(`
`);
  }
  static newName() {
    let e7 = T2[w2] || 1;
    return T2[w2] = e7 + 1, c + e7.toString(36);
  }
  static mount(e7, i12, l11) {
    let n14 = e7[S2], s212 = l11 && l11.nonce;
    n14 ? s212 && n14.setNonce(s212) : n14 = new g(e7, s212), n14.mount(Array.isArray(i12) ? i12 : [i12], e7);
  }
};
var x2 = /* @__PURE__ */ new Map();
var g = class {
  constructor(e7, i12) {
    let l11 = e7.ownerDocument || e7, n14 = l11.defaultView;
    if (!e7.head && e7.adoptedStyleSheets && n14.CSSStyleSheet) {
      let s212 = x2.get(l11);
      if (s212) return e7[S2] = s212;
      this.sheet = new n14.CSSStyleSheet(), x2.set(l11, this);
    } else this.styleTag = l11.createElement("style"), i12 && this.styleTag.setAttribute("nonce", i12);
    this.modules = [], e7[S2] = this;
  }
  mount(e7, i12) {
    let l11 = this.sheet, n14 = 0, s212 = 0;
    for (let t8 = 0; t8 < e7.length; t8++) {
      let a2 = e7[t8], h3 = this.modules.indexOf(a2);
      if (h3 < s212 && h3 > -1 && (this.modules.splice(h3, 1), s212--, h3 = -1), h3 == -1) {
        if (this.modules.splice(s212++, 0, a2), l11) for (let f6 = 0; f6 < a2.rules.length; f6++) l11.insertRule(a2.rules[f6], n14++);
      } else {
        for (; s212 < h3; ) n14 += this.modules[s212++].rules.length;
        n14 += a2.rules.length, s212++;
      }
    }
    if (l11) i12.adoptedStyleSheets.indexOf(this.sheet) < 0 && (i12.adoptedStyleSheets = [this.sheet, ...i12.adoptedStyleSheets]);
    else {
      let t8 = "";
      for (let h3 = 0; h3 < this.modules.length; h3++) t8 += this.modules[h3].getRules() + `
`;
      this.styleTag.textContent = t8;
      let a2 = i12.head || i12;
      this.styleTag.parentNode != a2 && a2.insertBefore(this.styleTag, a2.firstChild);
    }
  }
  setNonce(e7) {
    this.styleTag && this.styleTag.getAttribute("nonce") != e7 && this.styleTag.setAttribute("nonce", e7);
  }
};

// https://esm.sh/v135/w3c-keyname@2.2.8/denonext/w3c-keyname.mjs
var t = { 8: "Backspace", 9: "Tab", 10: "Enter", 12: "NumLock", 13: "Enter", 16: "Shift", 17: "Control", 18: "Alt", 20: "CapsLock", 27: "Escape", 32: " ", 33: "PageUp", 34: "PageDown", 35: "End", 36: "Home", 37: "ArrowLeft", 38: "ArrowUp", 39: "ArrowRight", 40: "ArrowDown", 44: "PrintScreen", 45: "Insert", 46: "Delete", 59: ";", 61: "=", 91: "Meta", 92: "Meta", 106: "*", 107: "+", 108: ",", 109: "-", 110: ".", 111: "/", 144: "NumLock", 145: "ScrollLock", 160: "Shift", 161: "Shift", 162: "Control", 163: "Control", 164: "Alt", 165: "Alt", 173: "-", 186: ";", 187: "=", 188: ",", 189: "-", 190: ".", 191: "/", 192: "`", 219: "[", 220: "\\", 221: "]", 222: "'" };
var i = { 48: ")", 49: "!", 50: "@", 51: "#", 52: "$", 53: "%", 54: "^", 55: "&", 56: "*", 57: "(", 59: ":", 61: "+", 173: "_", 186: ":", 187: "+", 188: "<", 189: "_", 190: ">", 191: "?", 192: "~", 219: "{", 220: "|", 221: "}", 222: '"' };
var n = typeof navigator < "u" && /Mac/.test(navigator.platform);
var y2 = typeof navigator < "u" && /MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);
for (r = 0; r < 10; r++) t[48 + r] = t[96 + r] = String(r);
var r;
for (r = 1; r <= 24; r++) t[r + 111] = "F" + r;
var r;
for (r = 65; r <= 90; r++) t[r] = String.fromCharCode(r + 32), i[r] = String.fromCharCode(r);
var r;
for (a in t) i.hasOwnProperty(a) || (i[a] = t[a]);
var a;
function g2(o) {
  var f6 = n && o.metaKey && o.shiftKey && !o.ctrlKey && !o.altKey || y2 && o.shiftKey && o.key && o.key.length == 1 || o.key == "Unidentified", e7 = !f6 && o.key || (o.shiftKey ? i : t)[o.keyCode] || o.key || "Unidentified";
  return e7 == "Esc" && (e7 = "Escape"), e7 == "Del" && (e7 = "Delete"), e7 == "Left" && (e7 = "ArrowLeft"), e7 == "Up" && (e7 = "ArrowUp"), e7 == "Right" && (e7 = "ArrowRight"), e7 == "Down" && (e7 = "ArrowDown"), e7;
}

// https://esm.sh/v135/@codemirror/view@6.35.0/denonext/view.mjs
function jt(s212) {
  let t8;
  return s212.nodeType == 11 ? t8 = s212.getSelection ? s212 : s212.ownerDocument : t8 = s212, t8.getSelection();
}
function Xe2(s212, t8) {
  return t8 ? s212 == t8 || s212.contains(t8.nodeType != 1 ? t8.parentNode : t8) : false;
}
function ue2(s212, t8) {
  if (!t8.anchorNode) return false;
  try {
    return Xe2(s212, t8.anchorNode);
  } catch {
    return false;
  }
}
function At(s212) {
  return s212.nodeType == 3 ? pt(s212, 0, s212.nodeValue.length).getClientRects() : s212.nodeType == 1 ? s212.getClientRects() : [];
}
function Vt(s212, t8, e7, i12) {
  return e7 ? _i(s212, t8, e7, i12, -1) || _i(s212, t8, e7, i12, 1) : false;
}
function ut(s212) {
  for (var t8 = 0; ; t8++) if (s212 = s212.previousSibling, !s212) return t8;
}
function xe2(s212) {
  return s212.nodeType == 1 && /^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(s212.nodeName);
}
function _i(s212, t8, e7, i12, n14) {
  for (; ; ) {
    if (s212 == e7 && t8 == i12) return true;
    if (t8 == (n14 < 0 ? 0 : U2(s212))) {
      if (s212.nodeName == "DIV") return false;
      let o = s212.parentNode;
      if (!o || o.nodeType != 1) return false;
      t8 = ut(s212) + (n14 < 0 ? 0 : 1), s212 = o;
    } else if (s212.nodeType == 1) {
      if (s212 = s212.childNodes[t8 + (n14 < 0 ? -1 : 0)], s212.nodeType == 1 && s212.contentEditable == "false") return false;
      t8 = n14 < 0 ? U2(s212) : 0;
    } else return false;
  }
}
function U2(s212) {
  return s212.nodeType == 3 ? s212.nodeValue.length : s212.childNodes.length;
}
function te2(s212, t8) {
  let e7 = t8 ? s212.left : s212.right;
  return { left: e7, right: e7, top: s212.top, bottom: s212.bottom };
}
function to(s212) {
  let t8 = s212.visualViewport;
  return t8 ? { left: 0, right: t8.width, top: 0, bottom: t8.height } : { left: 0, right: s212.innerWidth, top: 0, bottom: s212.innerHeight };
}
function Fs(s212, t8) {
  let e7 = t8.width / s212.offsetWidth, i12 = t8.height / s212.offsetHeight;
  return (e7 > 0.995 && e7 < 1.005 || !isFinite(e7) || Math.abs(t8.width - s212.offsetWidth) < 1) && (e7 = 1), (i12 > 0.995 && i12 < 1.005 || !isFinite(i12) || Math.abs(t8.height - s212.offsetHeight) < 1) && (i12 = 1), { scaleX: e7, scaleY: i12 };
}
function eo(s212, t8, e7, i12, n14, o, r2, l11) {
  let h3 = s212.ownerDocument, c3 = h3.defaultView || window;
  for (let a2 = s212, f6 = false; a2 && !f6; ) if (a2.nodeType == 1) {
    let d4, u3 = a2 == h3.body, p3 = 1, g8 = 1;
    if (u3) d4 = to(c3);
    else {
      if (/^(fixed|sticky)$/.test(getComputedStyle(a2).position) && (f6 = true), a2.scrollHeight <= a2.clientHeight && a2.scrollWidth <= a2.clientWidth) {
        a2 = a2.assignedSlot || a2.parentNode;
        continue;
      }
      let w14 = a2.getBoundingClientRect();
      ({ scaleX: p3, scaleY: g8 } = Fs(a2, w14)), d4 = { left: w14.left, right: w14.left + a2.clientWidth * p3, top: w14.top, bottom: w14.top + a2.clientHeight * g8 };
    }
    let b12 = 0, m11 = 0;
    if (n14 == "nearest") t8.top < d4.top ? (m11 = -(d4.top - t8.top + r2), e7 > 0 && t8.bottom > d4.bottom + m11 && (m11 = t8.bottom - d4.bottom + m11 + r2)) : t8.bottom > d4.bottom && (m11 = t8.bottom - d4.bottom + r2, e7 < 0 && t8.top - m11 < d4.top && (m11 = -(d4.top + m11 - t8.top + r2)));
    else {
      let w14 = t8.bottom - t8.top, v10 = d4.bottom - d4.top;
      m11 = (n14 == "center" && w14 <= v10 ? t8.top + w14 / 2 - v10 / 2 : n14 == "start" || n14 == "center" && e7 < 0 ? t8.top - r2 : t8.bottom - v10 + r2) - d4.top;
    }
    if (i12 == "nearest" ? t8.left < d4.left ? (b12 = -(d4.left - t8.left + o), e7 > 0 && t8.right > d4.right + b12 && (b12 = t8.right - d4.right + b12 + o)) : t8.right > d4.right && (b12 = t8.right - d4.right + o, e7 < 0 && t8.left < d4.left + b12 && (b12 = -(d4.left + b12 - t8.left + o))) : b12 = (i12 == "center" ? t8.left + (t8.right - t8.left) / 2 - (d4.right - d4.left) / 2 : i12 == "start" == l11 ? t8.left - o : t8.right - (d4.right - d4.left) + o) - d4.left, b12 || m11) if (u3) c3.scrollBy(b12, m11);
    else {
      let w14 = 0, v10 = 0;
      if (m11) {
        let x11 = a2.scrollTop;
        a2.scrollTop += m11 / g8, v10 = (a2.scrollTop - x11) * g8;
      }
      if (b12) {
        let x11 = a2.scrollLeft;
        a2.scrollLeft += b12 / p3, w14 = (a2.scrollLeft - x11) * p3;
      }
      t8 = { left: t8.left - w14, top: t8.top - v10, right: t8.right - w14, bottom: t8.bottom - v10 }, w14 && Math.abs(w14 - b12) < 1 && (i12 = "nearest"), v10 && Math.abs(v10 - m11) < 1 && (n14 = "nearest");
    }
    if (u3) break;
    a2 = a2.assignedSlot || a2.parentNode;
  } else if (a2.nodeType == 11) a2 = a2.host;
  else break;
}
function io(s212) {
  let t8 = s212.ownerDocument, e7, i12;
  for (let n14 = s212.parentNode; n14 && !(n14 == t8.body || e7 && i12); ) if (n14.nodeType == 1) !i12 && n14.scrollHeight > n14.clientHeight && (i12 = n14), !e7 && n14.scrollWidth > n14.clientWidth && (e7 = n14), n14 = n14.assignedSlot || n14.parentNode;
  else if (n14.nodeType == 11) n14 = n14.host;
  else break;
  return { x: e7, y: i12 };
}
var Ge2 = class {
  constructor() {
    this.anchorNode = null, this.anchorOffset = 0, this.focusNode = null, this.focusOffset = 0;
  }
  eq(t8) {
    return this.anchorNode == t8.anchorNode && this.anchorOffset == t8.anchorOffset && this.focusNode == t8.focusNode && this.focusOffset == t8.focusOffset;
  }
  setRange(t8) {
    let { anchorNode: e7, focusNode: i12 } = t8;
    this.set(e7, Math.min(t8.anchorOffset, e7 ? U2(e7) : 0), i12, Math.min(t8.focusOffset, i12 ? U2(i12) : 0));
  }
  set(t8, e7, i12, n14) {
    this.anchorNode = t8, this.anchorOffset = e7, this.focusNode = i12, this.focusOffset = n14;
  }
};
var yt = null;
function Ws(s212) {
  if (s212.setActive) return s212.setActive();
  if (yt) return s212.focus(yt);
  let t8 = [];
  for (let e7 = s212; e7 && (t8.push(e7, e7.scrollTop, e7.scrollLeft), e7 != e7.ownerDocument); e7 = e7.parentNode) ;
  if (s212.focus(yt == null ? { get preventScroll() {
    return yt = { preventScroll: true }, true;
  } } : void 0), !yt) {
    yt = false;
    for (let e7 = 0; e7 < t8.length; ) {
      let i12 = t8[e7++], n14 = t8[e7++], o = t8[e7++];
      i12.scrollTop != n14 && (i12.scrollTop = n14), i12.scrollLeft != o && (i12.scrollLeft = o);
    }
  }
}
var Xi;
function pt(s212, t8, e7 = t8) {
  let i12 = Xi || (Xi = document.createRange());
  return i12.setEnd(s212, e7), i12.setStart(s212, t8), i12;
}
function Mt(s212, t8, e7, i12) {
  let n14 = { key: t8, code: t8, keyCode: e7, which: e7, cancelable: true };
  i12 && ({ altKey: n14.altKey, ctrlKey: n14.ctrlKey, shiftKey: n14.shiftKey, metaKey: n14.metaKey } = i12);
  let o = new KeyboardEvent("keydown", n14);
  o.synthetic = true, s212.dispatchEvent(o);
  let r2 = new KeyboardEvent("keyup", n14);
  return r2.synthetic = true, s212.dispatchEvent(r2), o.defaultPrevented || r2.defaultPrevented;
}
function so(s212) {
  for (; s212; ) {
    if (s212 && (s212.nodeType == 9 || s212.nodeType == 11 && s212.host)) return s212;
    s212 = s212.assignedSlot || s212.parentNode;
  }
  return null;
}
function zs(s212) {
  for (; s212.attributes.length; ) s212.removeAttributeNode(s212.attributes[0]);
}
function no(s212, t8) {
  let e7 = t8.focusNode, i12 = t8.focusOffset;
  if (!e7 || t8.anchorNode != e7 || t8.anchorOffset != i12) return false;
  for (i12 = Math.min(i12, U2(e7)); ; ) if (i12) {
    if (e7.nodeType != 1) return false;
    let n14 = e7.childNodes[i12 - 1];
    n14.contentEditable == "false" ? i12-- : (e7 = n14, i12 = U2(e7));
  } else {
    if (e7 == s212) return true;
    i12 = ut(e7), e7 = e7.parentNode;
  }
}
function Is(s212) {
  return s212.scrollTop > Math.max(1, s212.scrollHeight - s212.clientHeight - 4);
}
function Ks(s212, t8) {
  for (let e7 = s212, i12 = t8; ; ) {
    if (e7.nodeType == 3 && i12 > 0) return { node: e7, offset: i12 };
    if (e7.nodeType == 1 && i12 > 0) {
      if (e7.contentEditable == "false") return null;
      e7 = e7.childNodes[i12 - 1], i12 = U2(e7);
    } else if (e7.parentNode && !xe2(e7)) i12 = ut(e7), e7 = e7.parentNode;
    else return null;
  }
}
function qs(s212, t8) {
  for (let e7 = s212, i12 = t8; ; ) {
    if (e7.nodeType == 3 && i12 < e7.nodeValue.length) return { node: e7, offset: i12 };
    if (e7.nodeType == 1 && i12 < e7.childNodes.length) {
      if (e7.contentEditable == "false") return null;
      e7 = e7.childNodes[i12], i12 = 0;
    } else if (e7.parentNode && !xe2(e7)) i12 = ut(e7) + 1, e7 = e7.parentNode;
    else return null;
  }
}
var V2 = class s20 {
  constructor(t8, e7, i12 = true) {
    this.node = t8, this.offset = e7, this.precise = i12;
  }
  static before(t8, e7) {
    return new s20(t8.parentNode, ut(t8), e7);
  }
  static after(t8, e7) {
    return new s20(t8.parentNode, ut(t8) + 1, e7);
  }
};
var Fi = [];
var R2 = class s21 {
  constructor() {
    this.parent = null, this.dom = null, this.flags = 2;
  }
  get overrideDOMText() {
    return null;
  }
  get posAtStart() {
    return this.parent ? this.parent.posBefore(this) : 0;
  }
  get posAtEnd() {
    return this.posAtStart + this.length;
  }
  posBefore(t8) {
    let e7 = this.posAtStart;
    for (let i12 of this.children) {
      if (i12 == t8) return e7;
      e7 += i12.length + i12.breakAfter;
    }
    throw new RangeError("Invalid child in posBefore");
  }
  posAfter(t8) {
    return this.posBefore(t8) + t8.length;
  }
  sync(t8, e7) {
    if (this.flags & 2) {
      let i12 = this.dom, n14 = null, o;
      for (let r2 of this.children) {
        if (r2.flags & 7) {
          if (!r2.dom && (o = n14 ? n14.nextSibling : i12.firstChild)) {
            let l11 = s21.get(o);
            (!l11 || !l11.parent && l11.canReuseDOM(r2)) && r2.reuseDOM(o);
          }
          r2.sync(t8, e7), r2.flags &= -8;
        }
        if (o = n14 ? n14.nextSibling : i12.firstChild, e7 && !e7.written && e7.node == i12 && o != r2.dom && (e7.written = true), r2.dom.parentNode == i12) for (; o && o != r2.dom; ) o = Gi(o);
        else i12.insertBefore(r2.dom, o);
        n14 = r2.dom;
      }
      for (o = n14 ? n14.nextSibling : i12.firstChild, o && e7 && e7.node == i12 && (e7.written = true); o; ) o = Gi(o);
    } else if (this.flags & 1) for (let i12 of this.children) i12.flags & 7 && (i12.sync(t8, e7), i12.flags &= -8);
  }
  reuseDOM(t8) {
  }
  localPosFromDOM(t8, e7) {
    let i12;
    if (t8 == this.dom) i12 = this.dom.childNodes[e7];
    else {
      let n14 = U2(t8) == 0 ? 0 : e7 == 0 ? -1 : 1;
      for (; ; ) {
        let o = t8.parentNode;
        if (o == this.dom) break;
        n14 == 0 && o.firstChild != o.lastChild && (t8 == o.firstChild ? n14 = -1 : n14 = 1), t8 = o;
      }
      n14 < 0 ? i12 = t8 : i12 = t8.nextSibling;
    }
    if (i12 == this.dom.firstChild) return 0;
    for (; i12 && !s21.get(i12); ) i12 = i12.nextSibling;
    if (!i12) return this.length;
    for (let n14 = 0, o = 0; ; n14++) {
      let r2 = this.children[n14];
      if (r2.dom == i12) return o;
      o += r2.length + r2.breakAfter;
    }
  }
  domBoundsAround(t8, e7, i12 = 0) {
    let n14 = -1, o = -1, r2 = -1, l11 = -1;
    for (let h3 = 0, c3 = i12, a2 = i12; h3 < this.children.length; h3++) {
      let f6 = this.children[h3], d4 = c3 + f6.length;
      if (c3 < t8 && d4 > e7) return f6.domBoundsAround(t8, e7, c3);
      if (d4 >= t8 && n14 == -1 && (n14 = h3, o = c3), c3 > e7 && f6.dom.parentNode == this.dom) {
        r2 = h3, l11 = a2;
        break;
      }
      a2 = d4, c3 = d4 + f6.breakAfter;
    }
    return { from: o, to: l11 < 0 ? i12 + this.length : l11, startDOM: (n14 ? this.children[n14 - 1].dom.nextSibling : null) || this.dom.firstChild, endDOM: r2 < this.children.length && r2 >= 0 ? this.children[r2].dom : null };
  }
  markDirty(t8 = false) {
    this.flags |= 2, this.markParentsDirty(t8);
  }
  markParentsDirty(t8) {
    for (let e7 = this.parent; e7; e7 = e7.parent) {
      if (t8 && (e7.flags |= 2), e7.flags & 1) return;
      e7.flags |= 1, t8 = false;
    }
  }
  setParent(t8) {
    this.parent != t8 && (this.parent = t8, this.flags & 7 && this.markParentsDirty(true));
  }
  setDOM(t8) {
    this.dom != t8 && (this.dom && (this.dom.cmView = null), this.dom = t8, t8.cmView = this);
  }
  get rootView() {
    for (let t8 = this; ; ) {
      let e7 = t8.parent;
      if (!e7) return t8;
      t8 = e7;
    }
  }
  replaceChildren(t8, e7, i12 = Fi) {
    this.markDirty();
    for (let n14 = t8; n14 < e7; n14++) {
      let o = this.children[n14];
      o.parent == this && i12.indexOf(o) < 0 && o.destroy();
    }
    i12.length < 250 ? this.children.splice(t8, e7 - t8, ...i12) : this.children = [].concat(this.children.slice(0, t8), i12, this.children.slice(e7));
    for (let n14 = 0; n14 < i12.length; n14++) i12[n14].setParent(this);
  }
  ignoreMutation(t8) {
    return false;
  }
  ignoreEvent(t8) {
    return false;
  }
  childCursor(t8 = this.length) {
    return new ve2(this.children, t8, this.children.length);
  }
  childPos(t8, e7 = 1) {
    return this.childCursor().findPos(t8, e7);
  }
  toString() {
    let t8 = this.constructor.name.replace("View", "");
    return t8 + (this.children.length ? "(" + this.children.join() + ")" : this.length ? "[" + (t8 == "Text" ? this.text : this.length) + "]" : "") + (this.breakAfter ? "#" : "");
  }
  static get(t8) {
    return t8.cmView;
  }
  get isEditable() {
    return true;
  }
  get isWidget() {
    return false;
  }
  get isHidden() {
    return false;
  }
  merge(t8, e7, i12, n14, o, r2) {
    return false;
  }
  become(t8) {
    return false;
  }
  canReuseDOM(t8) {
    return t8.constructor == this.constructor && !((this.flags | t8.flags) & 8);
  }
  getSide() {
    return 0;
  }
  destroy() {
    for (let t8 of this.children) t8.parent == this && t8.destroy();
    this.parent = null;
  }
};
R2.prototype.breakAfter = 0;
function Gi(s212) {
  let t8 = s212.nextSibling;
  return s212.parentNode.removeChild(s212), t8;
}
var ve2 = class {
  constructor(t8, e7, i12) {
    this.children = t8, this.pos = e7, this.i = i12, this.off = 0;
  }
  findPos(t8, e7 = 1) {
    for (; ; ) {
      if (t8 > this.pos || t8 == this.pos && (e7 > 0 || this.i == 0 || this.children[this.i - 1].breakAfter)) return this.off = t8 - this.pos, this;
      let i12 = this.children[--this.i];
      this.pos -= i12.length + i12.breakAfter;
    }
  }
};
function js(s212, t8, e7, i12, n14, o, r2, l11, h3) {
  let { children: c3 } = s212, a2 = c3.length ? c3[t8] : null, f6 = o.length ? o[o.length - 1] : null, d4 = f6 ? f6.breakAfter : r2;
  if (!(t8 == i12 && a2 && !r2 && !d4 && o.length < 2 && a2.merge(e7, n14, o.length ? f6 : null, e7 == 0, l11, h3))) {
    if (i12 < c3.length) {
      let u3 = c3[i12];
      u3 && (n14 < u3.length || u3.breakAfter && f6?.breakAfter) ? (t8 == i12 && (u3 = u3.split(n14), n14 = 0), !d4 && f6 && u3.merge(0, n14, f6, true, 0, h3) ? o[o.length - 1] = u3 : ((n14 || u3.children.length && !u3.children[0].length) && u3.merge(0, n14, null, false, 0, h3), o.push(u3))) : u3?.breakAfter && (f6 ? f6.breakAfter = 1 : r2 = 1), i12++;
    }
    for (a2 && (a2.breakAfter = r2, e7 > 0 && (!r2 && o.length && a2.merge(e7, a2.length, o[0], false, l11, 0) ? a2.breakAfter = o.shift().breakAfter : (e7 < a2.length || a2.children.length && a2.children[a2.children.length - 1].length == 0) && a2.merge(e7, a2.length, null, false, l11, 0), t8++)); t8 < i12 && o.length; ) if (c3[i12 - 1].become(o[o.length - 1])) i12--, o.pop(), h3 = o.length ? 0 : l11;
    else if (c3[t8].become(o[0])) t8++, o.shift(), l11 = o.length ? 0 : h3;
    else break;
    !o.length && t8 && i12 < c3.length && !c3[t8 - 1].breakAfter && c3[i12].merge(0, 0, c3[t8 - 1], false, l11, h3) && t8--, (t8 < i12 || o.length) && s212.replaceChildren(t8, i12, o);
  }
}
function Ys(s212, t8, e7, i12, n14, o) {
  let r2 = s212.childCursor(), { i: l11, off: h3 } = r2.findPos(e7, 1), { i: c3, off: a2 } = r2.findPos(t8, -1), f6 = t8 - e7;
  for (let d4 of i12) f6 += d4.length;
  s212.length += f6, js(s212, c3, a2, l11, h3, i12, 0, n14, o);
}
var W2 = typeof navigator < "u" ? navigator : { userAgent: "", vendor: "", platform: "" };
var $e2 = typeof document < "u" ? document : { documentElement: { style: {} } };
var Ue2 = /Edge\/(\d+)/.exec(W2.userAgent);
var _s = /MSIE \d/.test(W2.userAgent);
var Qe2 = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(W2.userAgent);
var Ne2 = !!(_s || Qe2 || Ue2);
var $i = !Ne2 && /gecko\/(\d+)/i.test(W2.userAgent);
var ze2 = !Ne2 && /Chrome\/(\d+)/.exec(W2.userAgent);
var Ui = "webkitFontSmoothing" in $e2.documentElement.style;
var Xs = !Ne2 && /Apple Computer/.test(W2.vendor);
var Qi = Xs && (/Mobile\/\w+/.test(W2.userAgent) || W2.maxTouchPoints > 2);
var y3 = { mac: Qi || /Mac/.test(W2.platform), windows: /Win/.test(W2.platform), linux: /Linux|X11/.test(W2.platform), ie: Ne2, ie_version: _s ? $e2.documentMode || 6 : Qe2 ? +Qe2[1] : Ue2 ? +Ue2[1] : 0, gecko: $i, gecko_version: $i ? +(/Firefox\/(\d+)/.exec(W2.userAgent) || [0, 0])[1] : 0, chrome: !!ze2, chrome_version: ze2 ? +ze2[1] : 0, ios: Qi, android: /Android\b/.test(W2.userAgent), webkit: Ui, safari: Xs, webkit_version: Ui ? +(/\bAppleWebKit\/(\d+)/.exec(W2.userAgent) || [0, 0])[1] : 0, tabSize: $e2.documentElement.style.tabSize != null ? "tab-size" : "-moz-tab-size" };
var oo = 256;
var Q2 = class s22 extends R2 {
  constructor(t8) {
    super(), this.text = t8;
  }
  get length() {
    return this.text.length;
  }
  createDOM(t8) {
    this.setDOM(t8 || document.createTextNode(this.text));
  }
  sync(t8, e7) {
    this.dom || this.createDOM(), this.dom.nodeValue != this.text && (e7 && e7.node == this.dom && (e7.written = true), this.dom.nodeValue = this.text);
  }
  reuseDOM(t8) {
    t8.nodeType == 3 && this.createDOM(t8);
  }
  merge(t8, e7, i12) {
    return this.flags & 8 || i12 && (!(i12 instanceof s22) || this.length - (e7 - t8) + i12.length > oo || i12.flags & 8) ? false : (this.text = this.text.slice(0, t8) + (i12 ? i12.text : "") + this.text.slice(e7), this.markDirty(), true);
  }
  split(t8) {
    let e7 = new s22(this.text.slice(t8));
    return this.text = this.text.slice(0, t8), this.markDirty(), e7.flags |= this.flags & 8, e7;
  }
  localPosFromDOM(t8, e7) {
    return t8 == this.dom ? e7 : e7 ? this.text.length : 0;
  }
  domAtPos(t8) {
    return new V2(this.dom, t8);
  }
  domBoundsAround(t8, e7, i12) {
    return { from: i12, to: i12 + this.length, startDOM: this.dom, endDOM: this.dom.nextSibling };
  }
  coordsAt(t8, e7) {
    return ro(this.dom, t8, e7);
  }
};
var rt2 = class s23 extends R2 {
  constructor(t8, e7 = [], i12 = 0) {
    super(), this.mark = t8, this.children = e7, this.length = i12;
    for (let n14 of e7) n14.setParent(this);
  }
  setAttrs(t8) {
    if (zs(t8), this.mark.class && (t8.className = this.mark.class), this.mark.attrs) for (let e7 in this.mark.attrs) t8.setAttribute(e7, this.mark.attrs[e7]);
    return t8;
  }
  canReuseDOM(t8) {
    return super.canReuseDOM(t8) && !((this.flags | t8.flags) & 8);
  }
  reuseDOM(t8) {
    t8.nodeName == this.mark.tagName.toUpperCase() && (this.setDOM(t8), this.flags |= 6);
  }
  sync(t8, e7) {
    this.dom ? this.flags & 4 && this.setAttrs(this.dom) : this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))), super.sync(t8, e7);
  }
  merge(t8, e7, i12, n14, o, r2) {
    return i12 && (!(i12 instanceof s23 && i12.mark.eq(this.mark)) || t8 && o <= 0 || e7 < this.length && r2 <= 0) ? false : (Ys(this, t8, e7, i12 ? i12.children.slice() : [], o - 1, r2 - 1), this.markDirty(), true);
  }
  split(t8) {
    let e7 = [], i12 = 0, n14 = -1, o = 0;
    for (let l11 of this.children) {
      let h3 = i12 + l11.length;
      h3 > t8 && e7.push(i12 < t8 ? l11.split(t8 - i12) : l11), n14 < 0 && i12 >= t8 && (n14 = o), i12 = h3, o++;
    }
    let r2 = this.length - t8;
    return this.length = t8, n14 > -1 && (this.children.length = n14, this.markDirty()), new s23(this.mark, e7, r2);
  }
  domAtPos(t8) {
    return Gs(this, t8);
  }
  coordsAt(t8, e7) {
    return Us(this, t8, e7);
  }
};
function ro(s212, t8, e7) {
  let i12 = s212.nodeValue.length;
  t8 > i12 && (t8 = i12);
  let n14 = t8, o = t8, r2 = 0;
  t8 == 0 && e7 < 0 || t8 == i12 && e7 >= 0 ? y3.chrome || y3.gecko || (t8 ? (n14--, r2 = 1) : o < i12 && (o++, r2 = -1)) : e7 < 0 ? n14-- : o < i12 && o++;
  let l11 = pt(s212, n14, o).getClientRects();
  if (!l11.length) return null;
  let h3 = l11[(r2 ? r2 < 0 : e7 >= 0) ? 0 : l11.length - 1];
  return y3.safari && !r2 && h3.width == 0 && (h3 = Array.prototype.find.call(l11, (c3) => c3.width) || h3), r2 ? te2(h3, r2 < 0) : h3 || null;
}
var Yt = class s24 extends R2 {
  static create(t8, e7, i12) {
    return new s24(t8, e7, i12);
  }
  constructor(t8, e7, i12) {
    super(), this.widget = t8, this.length = e7, this.side = i12, this.prevWidget = null;
  }
  split(t8) {
    let e7 = s24.create(this.widget, this.length - t8, this.side);
    return this.length -= t8, e7;
  }
  sync(t8) {
    (!this.dom || !this.widget.updateDOM(this.dom, t8)) && (this.dom && this.prevWidget && this.prevWidget.destroy(this.dom), this.prevWidget = null, this.setDOM(this.widget.toDOM(t8)), this.widget.editable || (this.dom.contentEditable = "false"));
  }
  getSide() {
    return this.side;
  }
  merge(t8, e7, i12, n14, o, r2) {
    return i12 && (!(i12 instanceof s24) || !this.widget.compare(i12.widget) || t8 > 0 && o <= 0 || e7 < this.length && r2 <= 0) ? false : (this.length = t8 + (i12 ? i12.length : 0) + (this.length - e7), true);
  }
  become(t8) {
    return t8 instanceof s24 && t8.side == this.side && this.widget.constructor == t8.widget.constructor ? (this.widget.compare(t8.widget) || this.markDirty(true), this.dom && !this.prevWidget && (this.prevWidget = this.widget), this.widget = t8.widget, this.length = t8.length, true) : false;
  }
  ignoreMutation() {
    return true;
  }
  ignoreEvent(t8) {
    return this.widget.ignoreEvent(t8);
  }
  get overrideDOMText() {
    if (this.length == 0) return m.empty;
    let t8 = this;
    for (; t8.parent; ) t8 = t8.parent;
    let { view: e7 } = t8, i12 = e7 && e7.state.doc, n14 = this.posAtStart;
    return i12 ? i12.slice(n14, n14 + this.length) : m.empty;
  }
  domAtPos(t8) {
    return (this.length ? t8 == 0 : this.side > 0) ? V2.before(this.dom) : V2.after(this.dom, t8 == this.length);
  }
  domBoundsAround() {
    return null;
  }
  coordsAt(t8, e7) {
    let i12 = this.widget.coordsAt(this.dom, t8, e7);
    if (i12) return i12;
    let n14 = this.dom.getClientRects(), o = null;
    if (!n14.length) return null;
    let r2 = this.side ? this.side < 0 : t8 > 0;
    for (let l11 = r2 ? n14.length - 1 : 0; o = n14[l11], !(t8 > 0 ? l11 == 0 : l11 == n14.length - 1 || o.top < o.bottom); l11 += r2 ? -1 : 1) ;
    return te2(o, !r2);
  }
  get isEditable() {
    return false;
  }
  get isWidget() {
    return true;
  }
  get isHidden() {
    return this.widget.isHidden;
  }
  destroy() {
    super.destroy(), this.dom && this.widget.destroy(this.dom);
  }
};
var _t = class s25 extends R2 {
  constructor(t8) {
    super(), this.side = t8;
  }
  get length() {
    return 0;
  }
  merge() {
    return false;
  }
  become(t8) {
    return t8 instanceof s25 && t8.side == this.side;
  }
  split() {
    return new s25(this.side);
  }
  sync() {
    if (!this.dom) {
      let t8 = document.createElement("img");
      t8.className = "cm-widgetBuffer", t8.setAttribute("aria-hidden", "true"), this.setDOM(t8);
    }
  }
  getSide() {
    return this.side;
  }
  domAtPos(t8) {
    return this.side > 0 ? V2.before(this.dom) : V2.after(this.dom);
  }
  localPosFromDOM() {
    return 0;
  }
  domBoundsAround() {
    return null;
  }
  coordsAt(t8) {
    return this.dom.getBoundingClientRect();
  }
  get overrideDOMText() {
    return m.empty;
  }
  get isHidden() {
    return true;
  }
};
Q2.prototype.children = Yt.prototype.children = _t.prototype.children = Fi;
function Gs(s212, t8) {
  let e7 = s212.dom, { children: i12 } = s212, n14 = 0;
  for (let o = 0; n14 < i12.length; n14++) {
    let r2 = i12[n14], l11 = o + r2.length;
    if (!(l11 == o && r2.getSide() <= 0)) {
      if (t8 > o && t8 < l11 && r2.dom.parentNode == e7) return r2.domAtPos(t8 - o);
      if (t8 <= o) break;
      o = l11;
    }
  }
  for (let o = n14; o > 0; o--) {
    let r2 = i12[o - 1];
    if (r2.dom.parentNode == e7) return r2.domAtPos(r2.length);
  }
  for (let o = n14; o < i12.length; o++) {
    let r2 = i12[o];
    if (r2.dom.parentNode == e7) return r2.domAtPos(0);
  }
  return new V2(e7, 0);
}
function $s(s212, t8, e7) {
  let i12, { children: n14 } = s212;
  e7 > 0 && t8 instanceof rt2 && n14.length && (i12 = n14[n14.length - 1]) instanceof rt2 && i12.mark.eq(t8.mark) ? $s(i12, t8.children[0], e7 - 1) : (n14.push(t8), t8.setParent(s212)), s212.length += t8.length;
}
function Us(s212, t8, e7) {
  let i12 = null, n14 = -1, o = null, r2 = -1;
  function l11(c3, a2) {
    for (let f6 = 0, d4 = 0; f6 < c3.children.length && d4 <= a2; f6++) {
      let u3 = c3.children[f6], p3 = d4 + u3.length;
      p3 >= a2 && (u3.children.length ? l11(u3, a2 - d4) : (!o || o.isHidden && e7 > 0) && (p3 > a2 || d4 == p3 && u3.getSide() > 0) ? (o = u3, r2 = a2 - d4) : (d4 < a2 || d4 == p3 && u3.getSide() < 0 && !u3.isHidden) && (i12 = u3, n14 = a2 - d4)), d4 = p3;
    }
  }
  l11(s212, t8);
  let h3 = (e7 < 0 ? i12 : o) || i12 || o;
  return h3 ? h3.coordsAt(Math.max(0, h3 == i12 ? n14 : r2), e7) : lo(s212);
}
function lo(s212) {
  let t8 = s212.dom.lastChild;
  if (!t8) return s212.dom.getBoundingClientRect();
  let e7 = At(t8);
  return e7[e7.length - 1] || null;
}
function Je2(s212, t8) {
  for (let e7 in s212) e7 == "class" && t8.class ? t8.class += " " + s212.class : e7 == "style" && t8.style ? t8.style += ";" + s212.style : t8[e7] = s212[e7];
  return t8;
}
var Ji = /* @__PURE__ */ Object.create(null);
function Se2(s212, t8, e7) {
  if (s212 == t8) return true;
  s212 || (s212 = Ji), t8 || (t8 = Ji);
  let i12 = Object.keys(s212), n14 = Object.keys(t8);
  if (i12.length - (e7 && i12.indexOf(e7) > -1 ? 1 : 0) != n14.length - (e7 && n14.indexOf(e7) > -1 ? 1 : 0)) return false;
  for (let o of i12) if (o != e7 && (n14.indexOf(o) == -1 || s212[o] !== t8[o])) return false;
  return true;
}
function Ze2(s212, t8, e7) {
  let i12 = false;
  if (t8) for (let n14 in t8) e7 && n14 in e7 || (i12 = true, n14 == "style" ? s212.style.cssText = "" : s212.removeAttribute(n14));
  if (e7) for (let n14 in e7) t8 && t8[n14] == e7[n14] || (i12 = true, n14 == "style" ? s212.style.cssText = e7[n14] : s212.setAttribute(n14, e7[n14]));
  return i12;
}
function ho(s212) {
  let t8 = /* @__PURE__ */ Object.create(null);
  for (let e7 = 0; e7 < s212.attributes.length; e7++) {
    let i12 = s212.attributes[e7];
    t8[i12.name] = i12.value;
  }
  return t8;
}
var lt2 = class {
  eq(t8) {
    return false;
  }
  updateDOM(t8, e7) {
    return false;
  }
  compare(t8) {
    return this == t8 || this.constructor == t8.constructor && this.eq(t8);
  }
  get estimatedHeight() {
    return -1;
  }
  get lineBreaks() {
    return 0;
  }
  ignoreEvent(t8) {
    return true;
  }
  coordsAt(t8, e7, i12) {
    return null;
  }
  get isHidden() {
    return false;
  }
  get editable() {
    return false;
  }
  destroy(t8) {
  }
};
var F2 = function(s212) {
  return s212[s212.Text = 0] = "Text", s212[s212.WidgetBefore = 1] = "WidgetBefore", s212[s212.WidgetAfter = 2] = "WidgetAfter", s212[s212.WidgetRange = 3] = "WidgetRange", s212;
}(F2 || (F2 = {}));
var O2 = class extends W {
  constructor(t8, e7, i12, n14) {
    super(), this.startSide = t8, this.endSide = e7, this.widget = i12, this.spec = n14;
  }
  get heightRelevant() {
    return false;
  }
  static mark(t8) {
    return new Xt(t8);
  }
  static widget(t8) {
    let e7 = Math.max(-1e4, Math.min(1e4, t8.side || 0)), i12 = !!t8.block;
    return e7 += i12 && !t8.inlineOrder ? e7 > 0 ? 3e8 : -4e8 : e7 > 0 ? 1e8 : -1e8, new ht2(t8, e7, e7, i12, t8.widget || null, false);
  }
  static replace(t8) {
    let e7 = !!t8.block, i12, n14;
    if (t8.isBlockGap) i12 = -5e8, n14 = 4e8;
    else {
      let { start: o, end: r2 } = Qs(t8, e7);
      i12 = (o ? e7 ? -3e8 : -1 : 5e8) - 1, n14 = (r2 ? e7 ? 2e8 : 1 : -6e8) + 1;
    }
    return new ht2(t8, i12, n14, e7, t8.widget || null, true);
  }
  static line(t8) {
    return new Gt(t8);
  }
  static set(t8, e7 = false) {
    return T.of(t8, e7);
  }
  hasHeight() {
    return this.widget ? this.widget.estimatedHeight > -1 : false;
  }
};
O2.none = T.empty;
var Xt = class s26 extends O2 {
  constructor(t8) {
    let { start: e7, end: i12 } = Qs(t8);
    super(e7 ? -1 : 5e8, i12 ? 1 : -6e8, null, t8), this.tagName = t8.tagName || "span", this.class = t8.class || "", this.attrs = t8.attributes || null;
  }
  eq(t8) {
    var e7, i12;
    return this == t8 || t8 instanceof s26 && this.tagName == t8.tagName && (this.class || ((e7 = this.attrs) === null || e7 === void 0 ? void 0 : e7.class)) == (t8.class || ((i12 = t8.attrs) === null || i12 === void 0 ? void 0 : i12.class)) && Se2(this.attrs, t8.attrs, "class");
  }
  range(t8, e7 = t8) {
    if (t8 >= e7) throw new RangeError("Mark decorations may not be empty");
    return super.range(t8, e7);
  }
};
Xt.prototype.point = false;
var Gt = class s27 extends O2 {
  constructor(t8) {
    super(-2e8, -2e8, null, t8);
  }
  eq(t8) {
    return t8 instanceof s27 && this.spec.class == t8.spec.class && Se2(this.spec.attributes, t8.spec.attributes);
  }
  range(t8, e7 = t8) {
    if (e7 != t8) throw new RangeError("Line decoration ranges must be zero-length");
    return super.range(t8, e7);
  }
};
Gt.prototype.mapMode = E.TrackBefore;
Gt.prototype.point = true;
var ht2 = class s28 extends O2 {
  constructor(t8, e7, i12, n14, o, r2) {
    super(e7, i12, o, t8), this.block = n14, this.isReplace = r2, this.mapMode = n14 ? e7 <= 0 ? E.TrackBefore : E.TrackAfter : E.TrackDel;
  }
  get type() {
    return this.startSide != this.endSide ? F2.WidgetRange : this.startSide <= 0 ? F2.WidgetBefore : F2.WidgetAfter;
  }
  get heightRelevant() {
    return this.block || !!this.widget && (this.widget.estimatedHeight >= 5 || this.widget.lineBreaks > 0);
  }
  eq(t8) {
    return t8 instanceof s28 && ao(this.widget, t8.widget) && this.block == t8.block && this.startSide == t8.startSide && this.endSide == t8.endSide;
  }
  range(t8, e7 = t8) {
    if (this.isReplace && (t8 > e7 || t8 == e7 && this.startSide > 0 && this.endSide <= 0)) throw new RangeError("Invalid range for replacement decoration");
    if (!this.isReplace && e7 != t8) throw new RangeError("Widget decorations can only have zero-length ranges");
    return super.range(t8, e7);
  }
};
ht2.prototype.point = true;
function Qs(s212, t8 = false) {
  let { inclusiveStart: e7, inclusiveEnd: i12 } = s212;
  return e7 == null && (e7 = s212.inclusive), i12 == null && (i12 = s212.inclusive), { start: e7 ?? t8, end: i12 ?? t8 };
}
function ao(s212, t8) {
  return s212 == t8 || !!(s212 && t8 && s212.compare(t8));
}
function ti(s212, t8, e7, i12 = 0) {
  let n14 = e7.length - 1;
  n14 >= 0 && e7[n14] + i12 >= s212 ? e7[n14] = Math.max(e7[n14], t8) : e7.push(s212, t8);
}
var P = class s29 extends R2 {
  constructor() {
    super(...arguments), this.children = [], this.length = 0, this.prevAttrs = void 0, this.attrs = null, this.breakAfter = 0;
  }
  merge(t8, e7, i12, n14, o, r2) {
    if (i12) {
      if (!(i12 instanceof s29)) return false;
      this.dom || i12.transferDOM(this);
    }
    return n14 && this.setDeco(i12 ? i12.attrs : null), Ys(this, t8, e7, i12 ? i12.children.slice() : [], o, r2), true;
  }
  split(t8) {
    let e7 = new s29();
    if (e7.breakAfter = this.breakAfter, this.length == 0) return e7;
    let { i: i12, off: n14 } = this.childPos(t8);
    n14 && (e7.append(this.children[i12].split(n14), 0), this.children[i12].merge(n14, this.children[i12].length, null, false, 0, 0), i12++);
    for (let o = i12; o < this.children.length; o++) e7.append(this.children[o], 0);
    for (; i12 > 0 && this.children[i12 - 1].length == 0; ) this.children[--i12].destroy();
    return this.children.length = i12, this.markDirty(), this.length = t8, e7;
  }
  transferDOM(t8) {
    this.dom && (this.markDirty(), t8.setDOM(this.dom), t8.prevAttrs = this.prevAttrs === void 0 ? this.attrs : this.prevAttrs, this.prevAttrs = void 0, this.dom = null);
  }
  setDeco(t8) {
    Se2(this.attrs, t8) || (this.dom && (this.prevAttrs = this.attrs, this.markDirty()), this.attrs = t8);
  }
  append(t8, e7) {
    $s(this, t8, e7);
  }
  addLineDeco(t8) {
    let e7 = t8.spec.attributes, i12 = t8.spec.class;
    e7 && (this.attrs = Je2(e7, this.attrs || {})), i12 && (this.attrs = Je2({ class: i12 }, this.attrs || {}));
  }
  domAtPos(t8) {
    return Gs(this, t8);
  }
  reuseDOM(t8) {
    t8.nodeName == "DIV" && (this.setDOM(t8), this.flags |= 6);
  }
  sync(t8, e7) {
    var i12;
    this.dom ? this.flags & 4 && (zs(this.dom), this.dom.className = "cm-line", this.prevAttrs = this.attrs ? null : void 0) : (this.setDOM(document.createElement("div")), this.dom.className = "cm-line", this.prevAttrs = this.attrs ? null : void 0), this.prevAttrs !== void 0 && (Ze2(this.dom, this.prevAttrs, this.attrs), this.dom.classList.add("cm-line"), this.prevAttrs = void 0), super.sync(t8, e7);
    let n14 = this.dom.lastChild;
    for (; n14 && R2.get(n14) instanceof rt2; ) n14 = n14.lastChild;
    if (!n14 || !this.length || n14.nodeName != "BR" && ((i12 = R2.get(n14)) === null || i12 === void 0 ? void 0 : i12.isEditable) == false && (!y3.ios || !this.children.some((o) => o instanceof Q2))) {
      let o = document.createElement("BR");
      o.cmIgnore = true, this.dom.appendChild(o);
    }
  }
  measureTextSize() {
    if (this.children.length == 0 || this.length > 20) return null;
    let t8 = 0, e7;
    for (let i12 of this.children) {
      if (!(i12 instanceof Q2) || /[^ -~]/.test(i12.text)) return null;
      let n14 = At(i12.dom);
      if (n14.length != 1) return null;
      t8 += n14[0].width, e7 = n14[0].height;
    }
    return t8 ? { lineHeight: this.dom.getBoundingClientRect().height, charWidth: t8 / this.length, textHeight: e7 } : null;
  }
  coordsAt(t8, e7) {
    let i12 = Us(this, t8, e7);
    if (!this.children.length && i12 && this.parent) {
      let { heightOracle: n14 } = this.parent.view.viewState, o = i12.bottom - i12.top;
      if (Math.abs(o - n14.lineHeight) < 2 && n14.textHeight < o) {
        let r2 = (o - n14.textHeight) / 2;
        return { top: i12.top + r2, bottom: i12.bottom - r2, left: i12.left, right: i12.left };
      }
    }
    return i12;
  }
  become(t8) {
    return t8 instanceof s29 && this.children.length == 0 && t8.children.length == 0 && Se2(this.attrs, t8.attrs) && this.breakAfter == t8.breakAfter;
  }
  covers() {
    return true;
  }
  static find(t8, e7) {
    for (let i12 = 0, n14 = 0; i12 < t8.children.length; i12++) {
      let o = t8.children[i12], r2 = n14 + o.length;
      if (r2 >= e7) {
        if (o instanceof s29) return o;
        if (r2 > e7) break;
      }
      n14 = r2 + o.breakAfter;
    }
    return null;
  }
};
var dt = class s30 extends R2 {
  constructor(t8, e7, i12) {
    super(), this.widget = t8, this.length = e7, this.deco = i12, this.breakAfter = 0, this.prevWidget = null;
  }
  merge(t8, e7, i12, n14, o, r2) {
    return i12 && (!(i12 instanceof s30) || !this.widget.compare(i12.widget) || t8 > 0 && o <= 0 || e7 < this.length && r2 <= 0) ? false : (this.length = t8 + (i12 ? i12.length : 0) + (this.length - e7), true);
  }
  domAtPos(t8) {
    return t8 == 0 ? V2.before(this.dom) : V2.after(this.dom, t8 == this.length);
  }
  split(t8) {
    let e7 = this.length - t8;
    this.length = t8;
    let i12 = new s30(this.widget, e7, this.deco);
    return i12.breakAfter = this.breakAfter, i12;
  }
  get children() {
    return Fi;
  }
  sync(t8) {
    (!this.dom || !this.widget.updateDOM(this.dom, t8)) && (this.dom && this.prevWidget && this.prevWidget.destroy(this.dom), this.prevWidget = null, this.setDOM(this.widget.toDOM(t8)), this.widget.editable || (this.dom.contentEditable = "false"));
  }
  get overrideDOMText() {
    return this.parent ? this.parent.view.state.doc.slice(this.posAtStart, this.posAtEnd) : m.empty;
  }
  domBoundsAround() {
    return null;
  }
  become(t8) {
    return t8 instanceof s30 && t8.widget.constructor == this.widget.constructor ? (t8.widget.compare(this.widget) || this.markDirty(true), this.dom && !this.prevWidget && (this.prevWidget = this.widget), this.widget = t8.widget, this.length = t8.length, this.deco = t8.deco, this.breakAfter = t8.breakAfter, true) : false;
  }
  ignoreMutation() {
    return true;
  }
  ignoreEvent(t8) {
    return this.widget.ignoreEvent(t8);
  }
  get isEditable() {
    return false;
  }
  get isWidget() {
    return true;
  }
  coordsAt(t8, e7) {
    let i12 = this.widget.coordsAt(this.dom, t8, e7);
    return i12 || (this.widget instanceof $t ? null : te2(this.dom.getBoundingClientRect(), this.length ? t8 == 0 : e7 <= 0));
  }
  destroy() {
    super.destroy(), this.dom && this.widget.destroy(this.dom);
  }
  covers(t8) {
    let { startSide: e7, endSide: i12 } = this.deco;
    return e7 == i12 ? false : t8 < 0 ? e7 < 0 : i12 > 0;
  }
};
var $t = class extends lt2 {
  constructor(t8) {
    super(), this.height = t8;
  }
  toDOM() {
    let t8 = document.createElement("div");
    return t8.className = "cm-gap", this.updateDOM(t8), t8;
  }
  eq(t8) {
    return t8.height == this.height;
  }
  updateDOM(t8) {
    return t8.style.height = this.height + "px", true;
  }
  get editable() {
    return true;
  }
  get estimatedHeight() {
    return this.height;
  }
  ignoreEvent() {
    return false;
  }
};
var Ft = class s31 {
  constructor(t8, e7, i12, n14) {
    this.doc = t8, this.pos = e7, this.end = i12, this.disallowBlockEffectsFor = n14, this.content = [], this.curLine = null, this.breakAtStart = 0, this.pendingBuffer = 0, this.bufferMarks = [], this.atCursorPos = true, this.openStart = -1, this.openEnd = -1, this.text = "", this.textOff = 0, this.cursor = t8.iter(), this.skip = e7;
  }
  posCovered() {
    if (this.content.length == 0) return !this.breakAtStart && this.doc.lineAt(this.pos).from != this.pos;
    let t8 = this.content[this.content.length - 1];
    return !(t8.breakAfter || t8 instanceof dt && t8.deco.endSide < 0);
  }
  getLine() {
    return this.curLine || (this.content.push(this.curLine = new P()), this.atCursorPos = true), this.curLine;
  }
  flushBuffer(t8 = this.bufferMarks) {
    this.pendingBuffer && (this.curLine.append(ne2(new _t(-1), t8), t8.length), this.pendingBuffer = 0);
  }
  addBlockWidget(t8) {
    this.flushBuffer(), this.curLine = null, this.content.push(t8);
  }
  finish(t8) {
    this.pendingBuffer && t8 <= this.bufferMarks.length ? this.flushBuffer() : this.pendingBuffer = 0, !this.posCovered() && !(t8 && this.content.length && this.content[this.content.length - 1] instanceof dt) && this.getLine();
  }
  buildText(t8, e7, i12) {
    for (; t8 > 0; ) {
      if (this.textOff == this.text.length) {
        let { value: o, lineBreak: r2, done: l11 } = this.cursor.next(this.skip);
        if (this.skip = 0, l11) throw new Error("Ran out of text content when drawing inline views");
        if (r2) {
          this.posCovered() || this.getLine(), this.content.length ? this.content[this.content.length - 1].breakAfter = 1 : this.breakAtStart = 1, this.flushBuffer(), this.curLine = null, this.atCursorPos = true, t8--;
          continue;
        } else this.text = o, this.textOff = 0;
      }
      let n14 = Math.min(this.text.length - this.textOff, t8, 512);
      this.flushBuffer(e7.slice(e7.length - i12)), this.getLine().append(ne2(new Q2(this.text.slice(this.textOff, this.textOff + n14)), e7), i12), this.atCursorPos = true, this.textOff += n14, t8 -= n14, i12 = 0;
    }
  }
  span(t8, e7, i12, n14) {
    this.buildText(e7 - t8, i12, n14), this.pos = e7, this.openStart < 0 && (this.openStart = n14);
  }
  point(t8, e7, i12, n14, o, r2) {
    if (this.disallowBlockEffectsFor[r2] && i12 instanceof ht2) {
      if (i12.block) throw new RangeError("Block decorations may not be specified via plugins");
      if (e7 > this.doc.lineAt(this.pos).to) throw new RangeError("Decorations that replace line breaks may not be specified via plugins");
    }
    let l11 = e7 - t8;
    if (i12 instanceof ht2) if (i12.block) i12.startSide > 0 && !this.posCovered() && this.getLine(), this.addBlockWidget(new dt(i12.widget || at2.block, l11, i12));
    else {
      let h3 = Yt.create(i12.widget || at2.inline, l11, l11 ? 0 : i12.startSide), c3 = this.atCursorPos && !h3.isEditable && o <= n14.length && (t8 < e7 || i12.startSide > 0), a2 = !h3.isEditable && (t8 < e7 || o > n14.length || i12.startSide <= 0), f6 = this.getLine();
      this.pendingBuffer == 2 && !c3 && !h3.isEditable && (this.pendingBuffer = 0), this.flushBuffer(n14), c3 && (f6.append(ne2(new _t(1), n14), o), o = n14.length + Math.max(0, o - n14.length)), f6.append(ne2(h3, n14), o), this.atCursorPos = a2, this.pendingBuffer = a2 ? t8 < e7 || o > n14.length ? 1 : 2 : 0, this.pendingBuffer && (this.bufferMarks = n14.slice());
    }
    else this.doc.lineAt(this.pos).from == this.pos && this.getLine().addLineDeco(i12);
    l11 && (this.textOff + l11 <= this.text.length ? this.textOff += l11 : (this.skip += l11 - (this.text.length - this.textOff), this.text = "", this.textOff = 0), this.pos = e7), this.openStart < 0 && (this.openStart = o);
  }
  static build(t8, e7, i12, n14, o) {
    let r2 = new s31(t8, e7, i12, o);
    return r2.openEnd = T.spans(n14, e7, i12, r2), r2.openStart < 0 && (r2.openStart = r2.openEnd), r2.finish(r2.openEnd), r2;
  }
};
function ne2(s212, t8) {
  for (let e7 of t8) s212 = new rt2(e7, [s212], s212.length);
  return s212;
}
var at2 = class extends lt2 {
  constructor(t8) {
    super(), this.tag = t8;
  }
  eq(t8) {
    return t8.tag == this.tag;
  }
  toDOM() {
    return document.createElement(this.tag);
  }
  updateDOM(t8) {
    return t8.nodeName.toLowerCase() == this.tag;
  }
  get isHidden() {
    return true;
  }
};
at2.inline = new at2("span");
at2.block = new at2("div");
var L2 = function(s212) {
  return s212[s212.LTR = 0] = "LTR", s212[s212.RTL = 1] = "RTL", s212;
}(L2 || (L2 = {}));
var gt = L2.LTR;
var Wi = L2.RTL;
function Js(s212) {
  let t8 = [];
  for (let e7 = 0; e7 < s212.length; e7++) t8.push(1 << +s212[e7]);
  return t8;
}
var co = Js("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008");
var fo = Js("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333");
var ei = /* @__PURE__ */ Object.create(null);
var _2 = [];
for (let s212 of ["()", "[]", "{}"]) {
  let t8 = s212.charCodeAt(0), e7 = s212.charCodeAt(1);
  ei[t8] = e7, ei[e7] = -t8;
}
function Zs(s212) {
  return s212 <= 247 ? co[s212] : 1424 <= s212 && s212 <= 1524 ? 2 : 1536 <= s212 && s212 <= 1785 ? fo[s212 - 1536] : 1774 <= s212 && s212 <= 2220 ? 4 : 8192 <= s212 && s212 <= 8204 ? 256 : 64336 <= s212 && s212 <= 65023 ? 4 : 1;
}
var uo = /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;
var G2 = class {
  get dir() {
    return this.level % 2 ? Wi : gt;
  }
  constructor(t8, e7, i12) {
    this.from = t8, this.to = e7, this.level = i12;
  }
  side(t8, e7) {
    return this.dir == e7 == t8 ? this.to : this.from;
  }
  forward(t8, e7) {
    return t8 == (this.dir == e7);
  }
  static find(t8, e7, i12, n14) {
    let o = -1;
    for (let r2 = 0; r2 < t8.length; r2++) {
      let l11 = t8[r2];
      if (l11.from <= e7 && l11.to >= e7) {
        if (l11.level == i12) return r2;
        (o < 0 || (n14 != 0 ? n14 < 0 ? l11.from < e7 : l11.to > e7 : t8[o].level > l11.level)) && (o = r2);
      }
    }
    if (o < 0) throw new RangeError("Index out of range");
    return o;
  }
};
function tn(s212, t8) {
  if (s212.length != t8.length) return false;
  for (let e7 = 0; e7 < s212.length; e7++) {
    let i12 = s212[e7], n14 = t8[e7];
    if (i12.from != n14.from || i12.to != n14.to || i12.direction != n14.direction || !tn(i12.inner, n14.inner)) return false;
  }
  return true;
}
var D2 = [];
function po(s212, t8, e7, i12, n14) {
  for (let o = 0; o <= i12.length; o++) {
    let r2 = o ? i12[o - 1].to : t8, l11 = o < i12.length ? i12[o].from : e7, h3 = o ? 256 : n14;
    for (let c3 = r2, a2 = h3, f6 = h3; c3 < l11; c3++) {
      let d4 = Zs(s212.charCodeAt(c3));
      d4 == 512 ? d4 = a2 : d4 == 8 && f6 == 4 && (d4 = 16), D2[c3] = d4 == 4 ? 2 : d4, d4 & 7 && (f6 = d4), a2 = d4;
    }
    for (let c3 = r2, a2 = h3, f6 = h3; c3 < l11; c3++) {
      let d4 = D2[c3];
      if (d4 == 128) c3 < l11 - 1 && a2 == D2[c3 + 1] && a2 & 24 ? d4 = D2[c3] = a2 : D2[c3] = 256;
      else if (d4 == 64) {
        let u3 = c3 + 1;
        for (; u3 < l11 && D2[u3] == 64; ) u3++;
        let p3 = c3 && a2 == 8 || u3 < e7 && D2[u3] == 8 ? f6 == 1 ? 1 : 8 : 256;
        for (let g8 = c3; g8 < u3; g8++) D2[g8] = p3;
        c3 = u3 - 1;
      } else d4 == 8 && f6 == 1 && (D2[c3] = 1);
      a2 = d4, d4 & 7 && (f6 = d4);
    }
  }
}
function go(s212, t8, e7, i12, n14) {
  let o = n14 == 1 ? 2 : 1;
  for (let r2 = 0, l11 = 0, h3 = 0; r2 <= i12.length; r2++) {
    let c3 = r2 ? i12[r2 - 1].to : t8, a2 = r2 < i12.length ? i12[r2].from : e7;
    for (let f6 = c3, d4, u3, p3; f6 < a2; f6++) if (u3 = ei[d4 = s212.charCodeAt(f6)]) if (u3 < 0) {
      for (let g8 = l11 - 3; g8 >= 0; g8 -= 3) if (_2[g8 + 1] == -u3) {
        let b12 = _2[g8 + 2], m11 = b12 & 2 ? n14 : b12 & 4 ? b12 & 1 ? o : n14 : 0;
        m11 && (D2[f6] = D2[_2[g8]] = m11), l11 = g8;
        break;
      }
    } else {
      if (_2.length == 189) break;
      _2[l11++] = f6, _2[l11++] = d4, _2[l11++] = h3;
    }
    else if ((p3 = D2[f6]) == 2 || p3 == 1) {
      let g8 = p3 == n14;
      h3 = g8 ? 0 : 1;
      for (let b12 = l11 - 3; b12 >= 0; b12 -= 3) {
        let m11 = _2[b12 + 2];
        if (m11 & 2) break;
        if (g8) _2[b12 + 2] |= 2;
        else {
          if (m11 & 4) break;
          _2[b12 + 2] |= 4;
        }
      }
    }
  }
}
function mo(s212, t8, e7, i12) {
  for (let n14 = 0, o = i12; n14 <= e7.length; n14++) {
    let r2 = n14 ? e7[n14 - 1].to : s212, l11 = n14 < e7.length ? e7[n14].from : t8;
    for (let h3 = r2; h3 < l11; ) {
      let c3 = D2[h3];
      if (c3 == 256) {
        let a2 = h3 + 1;
        for (; ; ) if (a2 == l11) {
          if (n14 == e7.length) break;
          a2 = e7[n14++].to, l11 = n14 < e7.length ? e7[n14].from : t8;
        } else if (D2[a2] == 256) a2++;
        else break;
        let f6 = o == 1, d4 = (a2 < t8 ? D2[a2] : i12) == 1, u3 = f6 == d4 ? f6 ? 1 : 2 : i12;
        for (let p3 = a2, g8 = n14, b12 = g8 ? e7[g8 - 1].to : s212; p3 > h3; ) p3 == b12 && (p3 = e7[--g8].from, b12 = g8 ? e7[g8 - 1].to : s212), D2[--p3] = u3;
        h3 = a2;
      } else o = c3, h3++;
    }
  }
}
function ii(s212, t8, e7, i12, n14, o, r2) {
  let l11 = i12 % 2 ? 2 : 1;
  if (i12 % 2 == n14 % 2) for (let h3 = t8, c3 = 0; h3 < e7; ) {
    let a2 = true, f6 = false;
    if (c3 == o.length || h3 < o[c3].from) {
      let g8 = D2[h3];
      g8 != l11 && (a2 = false, f6 = g8 == 16);
    }
    let d4 = !a2 && l11 == 1 ? [] : null, u3 = a2 ? i12 : i12 + 1, p3 = h3;
    t: for (; ; ) if (c3 < o.length && p3 == o[c3].from) {
      if (f6) break t;
      let g8 = o[c3];
      if (!a2) for (let b12 = g8.to, m11 = c3 + 1; ; ) {
        if (b12 == e7) break t;
        if (m11 < o.length && o[m11].from == b12) b12 = o[m11++].to;
        else {
          if (D2[b12] == l11) break t;
          break;
        }
      }
      if (c3++, d4) d4.push(g8);
      else {
        g8.from > h3 && r2.push(new G2(h3, g8.from, u3));
        let b12 = g8.direction == gt != !(u3 % 2);
        si(s212, b12 ? i12 + 1 : i12, n14, g8.inner, g8.from, g8.to, r2), h3 = g8.to;
      }
      p3 = g8.to;
    } else {
      if (p3 == e7 || (a2 ? D2[p3] != l11 : D2[p3] == l11)) break;
      p3++;
    }
    d4 ? ii(s212, h3, p3, i12 + 1, n14, d4, r2) : h3 < p3 && r2.push(new G2(h3, p3, u3)), h3 = p3;
  }
  else for (let h3 = e7, c3 = o.length; h3 > t8; ) {
    let a2 = true, f6 = false;
    if (!c3 || h3 > o[c3 - 1].to) {
      let g8 = D2[h3 - 1];
      g8 != l11 && (a2 = false, f6 = g8 == 16);
    }
    let d4 = !a2 && l11 == 1 ? [] : null, u3 = a2 ? i12 : i12 + 1, p3 = h3;
    t: for (; ; ) if (c3 && p3 == o[c3 - 1].to) {
      if (f6) break t;
      let g8 = o[--c3];
      if (!a2) for (let b12 = g8.from, m11 = c3; ; ) {
        if (b12 == t8) break t;
        if (m11 && o[m11 - 1].to == b12) b12 = o[--m11].from;
        else {
          if (D2[b12 - 1] == l11) break t;
          break;
        }
      }
      if (d4) d4.push(g8);
      else {
        g8.to < h3 && r2.push(new G2(g8.to, h3, u3));
        let b12 = g8.direction == gt != !(u3 % 2);
        si(s212, b12 ? i12 + 1 : i12, n14, g8.inner, g8.from, g8.to, r2), h3 = g8.from;
      }
      p3 = g8.from;
    } else {
      if (p3 == t8 || (a2 ? D2[p3 - 1] != l11 : D2[p3 - 1] == l11)) break;
      p3--;
    }
    d4 ? ii(s212, p3, h3, i12 + 1, n14, d4, r2) : p3 < h3 && r2.push(new G2(p3, h3, u3)), h3 = p3;
  }
}
function si(s212, t8, e7, i12, n14, o, r2) {
  let l11 = t8 % 2 ? 2 : 1;
  po(s212, n14, o, i12, l11), go(s212, n14, o, i12, l11), mo(n14, o, i12, l11), ii(s212, n14, o, t8, e7, i12, r2);
}
function en(s212, t8, e7) {
  if (!s212) return [new G2(0, 0, t8 == Wi ? 1 : 0)];
  if (t8 == gt && !e7.length && !uo.test(s212)) return sn(s212.length);
  if (e7.length) for (; s212.length > D2.length; ) D2[D2.length] = 256;
  let i12 = [], n14 = t8 == gt ? 0 : 1;
  return si(s212, n14, n14, e7, 0, s212.length, i12), i12;
}
function sn(s212) {
  return [new G2(0, s212, 0)];
}
var nn = "";
function on(s212, t8, e7, i12, n14) {
  var o;
  let r2 = i12.head - s212.from, l11 = G2.find(t8, r2, (o = i12.bidiLevel) !== null && o !== void 0 ? o : -1, i12.assoc), h3 = t8[l11], c3 = h3.side(n14, e7);
  if (r2 == c3) {
    let d4 = l11 += n14 ? 1 : -1;
    if (d4 < 0 || d4 >= t8.length) return null;
    h3 = t8[l11 = d4], r2 = h3.side(!n14, e7), c3 = h3.side(n14, e7);
  }
  let a2 = ee(s212.text, r2, h3.forward(n14, e7));
  (a2 < h3.from || a2 > h3.to) && (a2 = c3), nn = s212.text.slice(Math.min(r2, a2), Math.max(r2, a2));
  let f6 = l11 == (n14 ? t8.length - 1 : 0) ? null : t8[l11 + (n14 ? 1 : -1)];
  return f6 && a2 == c3 && f6.level + (n14 ? 0 : 1) < h3.level ? x.cursor(f6.side(!n14, e7) + s212.from, f6.forward(n14, e7) ? 1 : -1, f6.level) : x.cursor(a2 + s212.from, h3.forward(n14, e7) ? -1 : 1, h3.level);
}
function bo(s212, t8, e7) {
  for (let i12 = t8; i12 < e7; i12++) {
    let n14 = Zs(s212.charCodeAt(i12));
    if (n14 == 1) return gt;
    if (n14 == 2 || n14 == 4) return Wi;
  }
  return gt;
}
var rn = y.define();
var ln = y.define();
var hn = y.define();
var an = y.define();
var ni = y.define();
var cn = y.define();
var fn = y.define();
var zi = y.define();
var Ii = y.define();
var dn = y.define({ combine: (s212) => s212.some((t8) => t8) });
var un = y.define({ combine: (s212) => s212.some((t8) => t8) });
var pn = y.define();
var Wt = class s32 {
  constructor(t8, e7 = "nearest", i12 = "nearest", n14 = 5, o = 5, r2 = false) {
    this.range = t8, this.y = e7, this.x = i12, this.yMargin = n14, this.xMargin = o, this.isSnapshot = r2;
  }
  map(t8) {
    return t8.empty ? this : new s32(this.range.map(t8), this.y, this.x, this.yMargin, this.xMargin, this.isSnapshot);
  }
  clip(t8) {
    return this.range.to <= t8.doc.length ? this : new s32(x.cursor(t8.doc.length), this.y, this.x, this.yMargin, this.xMargin, this.isSnapshot);
  }
};
var oe2 = v.define({ map: (s212, t8) => s212.map(t8) });
var gn = v.define();
function $2(s212, t8, e7) {
  let i12 = s212.facet(an);
  i12.length ? i12[0](t8) : window.onerror ? window.onerror(String(t8), e7, void 0, void 0, t8) : e7 ? console.error(e7 + ":", t8) : console.error(t8);
}
var st2 = y.define({ combine: (s212) => s212.length ? s212[0] : true });
var yo = 0;
var Et = y.define();
var N2 = class s33 {
  constructor(t8, e7, i12, n14, o) {
    this.id = t8, this.create = e7, this.domEventHandlers = i12, this.domEventObservers = n14, this.extension = o(this);
  }
  static define(t8, e7) {
    let { eventHandlers: i12, eventObservers: n14, provide: o, decorations: r2 } = e7 || {};
    return new s33(yo++, t8, i12, n14, (l11) => {
      let h3 = [Et.of(l11)];
      return r2 && h3.push(Ut.of((c3) => {
        let a2 = c3.plugin(l11);
        return a2 ? r2(a2) : O2.none;
      })), o && h3.push(o(l11)), h3;
    });
  }
  static fromClass(t8, e7) {
    return s33.define((i12) => new t8(i12), e7);
  }
};
var zt = class {
  constructor(t8) {
    this.spec = t8, this.mustUpdate = null, this.value = null;
  }
  update(t8) {
    if (this.value) {
      if (this.mustUpdate) {
        let e7 = this.mustUpdate;
        if (this.mustUpdate = null, this.value.update) try {
          this.value.update(e7);
        } catch (i12) {
          if ($2(e7.state, i12, "CodeMirror plugin crashed"), this.value.destroy) try {
            this.value.destroy();
          } catch {
          }
          this.deactivate();
        }
      }
    } else if (this.spec) try {
      this.value = this.spec.create(t8);
    } catch (e7) {
      $2(t8.state, e7, "CodeMirror plugin crashed"), this.deactivate();
    }
    return this;
  }
  destroy(t8) {
    var e7;
    if (!((e7 = this.value) === null || e7 === void 0) && e7.destroy) try {
      this.value.destroy();
    } catch (i12) {
      $2(t8.state, i12, "CodeMirror plugin crashed");
    }
  }
  deactivate() {
    this.spec = this.value = null;
  }
};
var mn = y.define();
var Ve2 = y.define();
var Ut = y.define();
var bn = y.define();
var Ki = y.define();
var yn = y.define();
function Zi(s212, t8) {
  let e7 = s212.state.facet(yn);
  if (!e7.length) return e7;
  let i12 = e7.map((o) => o instanceof Function ? o(s212) : o), n14 = [];
  return T.spans(i12, t8.from, t8.to, { point() {
  }, span(o, r2, l11, h3) {
    let c3 = o - t8.from, a2 = r2 - t8.from, f6 = n14;
    for (let d4 = l11.length - 1; d4 >= 0; d4--, h3--) {
      let u3 = l11[d4].spec.bidiIsolate, p3;
      if (u3 == null && (u3 = bo(t8.text, c3, a2)), h3 > 0 && f6.length && (p3 = f6[f6.length - 1]).to == c3 && p3.direction == u3) p3.to = a2, f6 = p3.inner;
      else {
        let g8 = { from: c3, to: a2, direction: u3, inner: [] };
        f6.push(g8), f6 = g8.inner;
      }
    }
  } }), n14;
}
var wn = y.define();
function qi(s212) {
  let t8 = 0, e7 = 0, i12 = 0, n14 = 0;
  for (let o of s212.state.facet(wn)) {
    let r2 = o(s212);
    r2 && (r2.left != null && (t8 = Math.max(t8, r2.left)), r2.right != null && (e7 = Math.max(e7, r2.right)), r2.top != null && (i12 = Math.max(i12, r2.top)), r2.bottom != null && (n14 = Math.max(n14, r2.bottom)));
  }
  return { left: t8, right: e7, top: i12, bottom: n14 };
}
var Lt = y.define();
var j2 = class s34 {
  constructor(t8, e7, i12, n14) {
    this.fromA = t8, this.toA = e7, this.fromB = i12, this.toB = n14;
  }
  join(t8) {
    return new s34(Math.min(this.fromA, t8.fromA), Math.max(this.toA, t8.toA), Math.min(this.fromB, t8.fromB), Math.max(this.toB, t8.toB));
  }
  addToSet(t8) {
    let e7 = t8.length, i12 = this;
    for (; e7 > 0; e7--) {
      let n14 = t8[e7 - 1];
      if (!(n14.fromA > i12.toA)) {
        if (n14.toA < i12.fromA) break;
        i12 = i12.join(n14), t8.splice(e7 - 1, 1);
      }
    }
    return t8.splice(e7, 0, i12), t8;
  }
  static extendWithRanges(t8, e7) {
    if (e7.length == 0) return t8;
    let i12 = [];
    for (let n14 = 0, o = 0, r2 = 0, l11 = 0; ; n14++) {
      let h3 = n14 == t8.length ? null : t8[n14], c3 = r2 - l11, a2 = h3 ? h3.fromB : 1e9;
      for (; o < e7.length && e7[o] < a2; ) {
        let f6 = e7[o], d4 = e7[o + 1], u3 = Math.max(l11, f6), p3 = Math.min(a2, d4);
        if (u3 <= p3 && new s34(u3 + c3, p3 + c3, u3, p3).addToSet(i12), d4 > a2) break;
        o += 2;
      }
      if (!h3) return i12;
      new s34(h3.fromA, h3.toA, h3.fromB, h3.toB).addToSet(i12), r2 = h3.toA, l11 = h3.toB;
    }
  }
};
var Ce2 = class s35 {
  constructor(t8, e7, i12) {
    this.view = t8, this.state = e7, this.transactions = i12, this.flags = 0, this.startState = t8.state, this.changes = A.empty(this.startState.doc.length);
    for (let o of i12) this.changes = this.changes.compose(o.changes);
    let n14 = [];
    this.changes.iterChangedRanges((o, r2, l11, h3) => n14.push(new j2(o, r2, l11, h3))), this.changedRanges = n14;
  }
  static create(t8, e7, i12) {
    return new s35(t8, e7, i12);
  }
  get viewportChanged() {
    return (this.flags & 4) > 0;
  }
  get heightChanged() {
    return (this.flags & 2) > 0;
  }
  get geometryChanged() {
    return this.docChanged || (this.flags & 10) > 0;
  }
  get focusChanged() {
    return (this.flags & 1) > 0;
  }
  get docChanged() {
    return !this.changes.empty;
  }
  get selectionSet() {
    return this.transactions.some((t8) => t8.selection);
  }
  get empty() {
    return this.flags == 0 && this.transactions.length == 0;
  }
};
var Me2 = class extends R2 {
  get length() {
    return this.view.state.doc.length;
  }
  constructor(t8) {
    super(), this.view = t8, this.decorations = [], this.dynamicDecorationMap = [false], this.domChanged = null, this.hasComposition = null, this.markedForComposition = /* @__PURE__ */ new Set(), this.editContextFormatting = O2.none, this.lastCompositionAfterCursor = false, this.minWidth = 0, this.minWidthFrom = 0, this.minWidthTo = 0, this.impreciseAnchor = null, this.impreciseHead = null, this.forceSelection = false, this.lastUpdate = Date.now(), this.setDOM(t8.contentDOM), this.children = [new P()], this.children[0].setParent(this), this.updateDeco(), this.updateInner([new j2(0, 0, 0, t8.state.doc.length)], 0, null);
  }
  update(t8) {
    var e7;
    let i12 = t8.changedRanges;
    this.minWidth > 0 && i12.length && (i12.every(({ fromA: c3, toA: a2 }) => a2 < this.minWidthFrom || c3 > this.minWidthTo) ? (this.minWidthFrom = t8.changes.mapPos(this.minWidthFrom, 1), this.minWidthTo = t8.changes.mapPos(this.minWidthTo, 1)) : this.minWidth = this.minWidthFrom = this.minWidthTo = 0), this.updateEditContextFormatting(t8);
    let n14 = -1;
    this.view.inputState.composing >= 0 && !this.view.observer.editContext && (!((e7 = this.domChanged) === null || e7 === void 0) && e7.newSel ? n14 = this.domChanged.newSel.head : !ko(t8.changes, this.hasComposition) && !t8.selectionSet && (n14 = t8.state.selection.main.head));
    let o = n14 > -1 ? xo(this.view, t8.changes, n14) : null;
    if (this.domChanged = null, this.hasComposition) {
      this.markedForComposition.clear();
      let { from: c3, to: a2 } = this.hasComposition;
      i12 = new j2(c3, a2, t8.changes.mapPos(c3, -1), t8.changes.mapPos(a2, 1)).addToSet(i12.slice());
    }
    this.hasComposition = o ? { from: o.range.fromB, to: o.range.toB } : null, (y3.ie || y3.chrome) && !o && t8 && t8.state.doc.lines != t8.startState.doc.lines && (this.forceSelection = true);
    let r2 = this.decorations, l11 = this.updateDeco(), h3 = Co(r2, l11, t8.changes);
    return i12 = j2.extendWithRanges(i12, h3), !(this.flags & 7) && i12.length == 0 ? false : (this.updateInner(i12, t8.startState.doc.length, o), t8.transactions.length && (this.lastUpdate = Date.now()), true);
  }
  updateInner(t8, e7, i12) {
    this.view.viewState.mustMeasureContent = true, this.updateChildren(t8, e7, i12);
    let { observer: n14 } = this.view;
    n14.ignore(() => {
      this.dom.style.height = this.view.viewState.contentHeight / this.view.scaleY + "px", this.dom.style.flexBasis = this.minWidth ? this.minWidth + "px" : "";
      let r2 = y3.chrome || y3.ios ? { node: n14.selectionRange.focusNode, written: false } : void 0;
      this.sync(this.view, r2), this.flags &= -8, r2 && (r2.written || n14.selectionRange.focusNode != r2.node) && (this.forceSelection = true), this.dom.style.height = "";
    }), this.markedForComposition.forEach((r2) => r2.flags &= -9);
    let o = [];
    if (this.view.viewport.from || this.view.viewport.to < this.view.state.doc.length) for (let r2 of this.children) r2 instanceof dt && r2.widget instanceof $t && o.push(r2.dom);
    n14.updateGaps(o);
  }
  updateChildren(t8, e7, i12) {
    let n14 = i12 ? i12.range.addToSet(t8.slice()) : t8, o = this.childCursor(e7);
    for (let r2 = n14.length - 1; ; r2--) {
      let l11 = r2 >= 0 ? n14[r2] : null;
      if (!l11) break;
      let { fromA: h3, toA: c3, fromB: a2, toB: f6 } = l11, d4, u3, p3, g8;
      if (i12 && i12.range.fromB < f6 && i12.range.toB > a2) {
        let x11 = Ft.build(this.view.state.doc, a2, i12.range.fromB, this.decorations, this.dynamicDecorationMap), S17 = Ft.build(this.view.state.doc, i12.range.toB, f6, this.decorations, this.dynamicDecorationMap);
        u3 = x11.breakAtStart, p3 = x11.openStart, g8 = S17.openEnd;
        let C11 = this.compositionView(i12);
        S17.breakAtStart ? C11.breakAfter = 1 : S17.content.length && C11.merge(C11.length, C11.length, S17.content[0], false, S17.openStart, 0) && (C11.breakAfter = S17.content[0].breakAfter, S17.content.shift()), x11.content.length && C11.merge(0, 0, x11.content[x11.content.length - 1], true, 0, x11.openEnd) && x11.content.pop(), d4 = x11.content.concat(C11).concat(S17.content);
      } else ({ content: d4, breakAtStart: u3, openStart: p3, openEnd: g8 } = Ft.build(this.view.state.doc, a2, f6, this.decorations, this.dynamicDecorationMap));
      let { i: b12, off: m11 } = o.findPos(c3, 1), { i: w14, off: v10 } = o.findPos(h3, -1);
      js(this, w14, v10, b12, m11, d4, u3, p3, g8);
    }
    i12 && this.fixCompositionDOM(i12);
  }
  updateEditContextFormatting(t8) {
    this.editContextFormatting = this.editContextFormatting.map(t8.changes);
    for (let e7 of t8.transactions) for (let i12 of e7.effects) i12.is(gn) && (this.editContextFormatting = i12.value);
  }
  compositionView(t8) {
    let e7 = new Q2(t8.text.nodeValue);
    e7.flags |= 8;
    for (let { deco: n14 } of t8.marks) e7 = new rt2(n14, [e7], e7.length);
    let i12 = new P();
    return i12.append(e7, 0), i12;
  }
  fixCompositionDOM(t8) {
    let e7 = (o, r2) => {
      r2.flags |= 8 | (r2.children.some((h3) => h3.flags & 7) ? 1 : 0), this.markedForComposition.add(r2);
      let l11 = R2.get(o);
      l11 && l11 != r2 && (l11.dom = null), r2.setDOM(o);
    }, i12 = this.childPos(t8.range.fromB, 1), n14 = this.children[i12.i];
    e7(t8.line, n14);
    for (let o = t8.marks.length - 1; o >= -1; o--) i12 = n14.childPos(i12.off, 1), n14 = n14.children[i12.i], e7(o >= 0 ? t8.marks[o].node : t8.text, n14);
  }
  updateSelection(t8 = false, e7 = false) {
    (t8 || !this.view.observer.selectionRange.focusNode) && this.view.observer.readSelectionRange();
    let i12 = this.view.root.activeElement, n14 = i12 == this.dom, o = !n14 && ue2(this.dom, this.view.observer.selectionRange) && !(i12 && this.dom.contains(i12));
    if (!(n14 || e7 || o)) return;
    let r2 = this.forceSelection;
    this.forceSelection = false;
    let l11 = this.view.state.selection.main, h3 = this.moveToLine(this.domAtPos(l11.anchor)), c3 = l11.empty ? h3 : this.moveToLine(this.domAtPos(l11.head));
    if (y3.gecko && l11.empty && !this.hasComposition && wo(h3)) {
      let f6 = document.createTextNode("");
      this.view.observer.ignore(() => h3.node.insertBefore(f6, h3.node.childNodes[h3.offset] || null)), h3 = c3 = new V2(f6, 0), r2 = true;
    }
    let a2 = this.view.observer.selectionRange;
    (r2 || !a2.focusNode || (!Vt(h3.node, h3.offset, a2.anchorNode, a2.anchorOffset) || !Vt(c3.node, c3.offset, a2.focusNode, a2.focusOffset)) && !this.suppressWidgetCursorChange(a2, l11)) && (this.view.observer.ignore(() => {
      y3.android && y3.chrome && this.dom.contains(a2.focusNode) && Mo(a2.focusNode, this.dom) && (this.dom.blur(), this.dom.focus({ preventScroll: true }));
      let f6 = jt(this.view.root);
      if (f6) if (l11.empty) {
        if (y3.gecko) {
          let d4 = vo(h3.node, h3.offset);
          if (d4 && d4 != 3) {
            let u3 = (d4 == 1 ? Ks : qs)(h3.node, h3.offset);
            u3 && (h3 = new V2(u3.node, u3.offset));
          }
        }
        f6.collapse(h3.node, h3.offset), l11.bidiLevel != null && f6.caretBidiLevel !== void 0 && (f6.caretBidiLevel = l11.bidiLevel);
      } else if (f6.extend) {
        f6.collapse(h3.node, h3.offset);
        try {
          f6.extend(c3.node, c3.offset);
        } catch {
        }
      } else {
        let d4 = document.createRange();
        l11.anchor > l11.head && ([h3, c3] = [c3, h3]), d4.setEnd(c3.node, c3.offset), d4.setStart(h3.node, h3.offset), f6.removeAllRanges(), f6.addRange(d4);
      }
      o && this.view.root.activeElement == this.dom && (this.dom.blur(), i12 && i12.focus());
    }), this.view.observer.setSelectionRange(h3, c3)), this.impreciseAnchor = h3.precise ? null : new V2(a2.anchorNode, a2.anchorOffset), this.impreciseHead = c3.precise ? null : new V2(a2.focusNode, a2.focusOffset);
  }
  suppressWidgetCursorChange(t8, e7) {
    return this.hasComposition && e7.empty && Vt(t8.focusNode, t8.focusOffset, t8.anchorNode, t8.anchorOffset) && this.posFromDOM(t8.focusNode, t8.focusOffset) == e7.head;
  }
  enforceCursorAssoc() {
    if (this.hasComposition) return;
    let { view: t8 } = this, e7 = t8.state.selection.main, i12 = jt(t8.root), { anchorNode: n14, anchorOffset: o } = t8.observer.selectionRange;
    if (!i12 || !e7.empty || !e7.assoc || !i12.modify) return;
    let r2 = P.find(this, e7.head);
    if (!r2) return;
    let l11 = r2.posAtStart;
    if (e7.head == l11 || e7.head == l11 + r2.length) return;
    let h3 = this.coordsAt(e7.head, -1), c3 = this.coordsAt(e7.head, 1);
    if (!h3 || !c3 || h3.bottom > c3.top) return;
    let a2 = this.domAtPos(e7.head + e7.assoc);
    i12.collapse(a2.node, a2.offset), i12.modify("move", e7.assoc < 0 ? "forward" : "backward", "lineboundary"), t8.observer.readSelectionRange();
    let f6 = t8.observer.selectionRange;
    t8.docView.posFromDOM(f6.anchorNode, f6.anchorOffset) != e7.from && i12.collapse(n14, o);
  }
  moveToLine(t8) {
    let e7 = this.dom, i12;
    if (t8.node != e7) return t8;
    for (let n14 = t8.offset; !i12 && n14 < e7.childNodes.length; n14++) {
      let o = R2.get(e7.childNodes[n14]);
      o instanceof P && (i12 = o.domAtPos(0));
    }
    for (let n14 = t8.offset - 1; !i12 && n14 >= 0; n14--) {
      let o = R2.get(e7.childNodes[n14]);
      o instanceof P && (i12 = o.domAtPos(o.length));
    }
    return i12 ? new V2(i12.node, i12.offset, true) : t8;
  }
  nearest(t8) {
    for (let e7 = t8; e7; ) {
      let i12 = R2.get(e7);
      if (i12 && i12.rootView == this) return i12;
      e7 = e7.parentNode;
    }
    return null;
  }
  posFromDOM(t8, e7) {
    let i12 = this.nearest(t8);
    if (!i12) throw new RangeError("Trying to find position for a DOM position outside of the document");
    return i12.localPosFromDOM(t8, e7) + i12.posAtStart;
  }
  domAtPos(t8) {
    let { i: e7, off: i12 } = this.childCursor().findPos(t8, -1);
    for (; e7 < this.children.length - 1; ) {
      let n14 = this.children[e7];
      if (i12 < n14.length || n14 instanceof P) break;
      e7++, i12 = 0;
    }
    return this.children[e7].domAtPos(i12);
  }
  coordsAt(t8, e7) {
    let i12 = null, n14 = 0;
    for (let o = this.length, r2 = this.children.length - 1; r2 >= 0; r2--) {
      let l11 = this.children[r2], h3 = o - l11.breakAfter, c3 = h3 - l11.length;
      if (h3 < t8) break;
      if (c3 <= t8 && (c3 < t8 || l11.covers(-1)) && (h3 > t8 || l11.covers(1)) && (!i12 || l11 instanceof P && !(i12 instanceof P && e7 >= 0))) i12 = l11, n14 = c3;
      else if (i12 && c3 == t8 && h3 == t8 && l11 instanceof dt && Math.abs(e7) < 2) {
        if (l11.deco.startSide < 0) break;
        r2 && (i12 = null);
      }
      o = c3;
    }
    return i12 ? i12.coordsAt(t8 - n14, e7) : null;
  }
  coordsForChar(t8) {
    let { i: e7, off: i12 } = this.childPos(t8, 1), n14 = this.children[e7];
    if (!(n14 instanceof P)) return null;
    for (; n14.children.length; ) {
      let { i: l11, off: h3 } = n14.childPos(i12, 1);
      for (; ; l11++) {
        if (l11 == n14.children.length) return null;
        if ((n14 = n14.children[l11]).length) break;
      }
      i12 = h3;
    }
    if (!(n14 instanceof Q2)) return null;
    let o = ee(n14.text, i12);
    if (o == i12) return null;
    let r2 = pt(n14.dom, i12, o).getClientRects();
    for (let l11 = 0; l11 < r2.length; l11++) {
      let h3 = r2[l11];
      if (l11 == r2.length - 1 || h3.top < h3.bottom && h3.left < h3.right) return h3;
    }
    return null;
  }
  measureVisibleLineHeights(t8) {
    let e7 = [], { from: i12, to: n14 } = t8, o = this.view.contentDOM.clientWidth, r2 = o > Math.max(this.view.scrollDOM.clientWidth, this.minWidth) + 1, l11 = -1, h3 = this.view.textDirection == L2.LTR;
    for (let c3 = 0, a2 = 0; a2 < this.children.length; a2++) {
      let f6 = this.children[a2], d4 = c3 + f6.length;
      if (d4 > n14) break;
      if (c3 >= i12) {
        let u3 = f6.dom.getBoundingClientRect();
        if (e7.push(u3.height), r2) {
          let p3 = f6.dom.lastChild, g8 = p3 ? At(p3) : [];
          if (g8.length) {
            let b12 = g8[g8.length - 1], m11 = h3 ? b12.right - u3.left : u3.right - b12.left;
            m11 > l11 && (l11 = m11, this.minWidth = o, this.minWidthFrom = c3, this.minWidthTo = d4);
          }
        }
      }
      c3 = d4 + f6.breakAfter;
    }
    return e7;
  }
  textDirectionAt(t8) {
    let { i: e7 } = this.childPos(t8, 1);
    return getComputedStyle(this.children[e7].dom).direction == "rtl" ? L2.RTL : L2.LTR;
  }
  measureTextSize() {
    for (let o of this.children) if (o instanceof P) {
      let r2 = o.measureTextSize();
      if (r2) return r2;
    }
    let t8 = document.createElement("div"), e7, i12, n14;
    return t8.className = "cm-line", t8.style.width = "99999px", t8.style.position = "absolute", t8.textContent = "abc def ghi jkl mno pqr stu", this.view.observer.ignore(() => {
      this.dom.appendChild(t8);
      let o = At(t8.firstChild)[0];
      e7 = t8.getBoundingClientRect().height, i12 = o ? o.width / 27 : 7, n14 = o ? o.height : e7, t8.remove();
    }), { lineHeight: e7, charWidth: i12, textHeight: n14 };
  }
  childCursor(t8 = this.length) {
    let e7 = this.children.length;
    return e7 && (t8 -= this.children[--e7].length), new ve2(this.children, t8, e7);
  }
  computeBlockGapDeco() {
    let t8 = [], e7 = this.view.viewState;
    for (let i12 = 0, n14 = 0; ; n14++) {
      let o = n14 == e7.viewports.length ? null : e7.viewports[n14], r2 = o ? o.from - 1 : this.length;
      if (r2 > i12) {
        let l11 = (e7.lineBlockAt(r2).bottom - e7.lineBlockAt(i12).top) / this.view.scaleY;
        t8.push(O2.replace({ widget: new $t(l11), block: true, inclusive: true, isBlockGap: true }).range(i12, r2));
      }
      if (!o) break;
      i12 = o.to + 1;
    }
    return O2.set(t8);
  }
  updateDeco() {
    let t8 = 1, e7 = this.view.state.facet(Ut).map((o) => (this.dynamicDecorationMap[t8++] = typeof o == "function") ? o(this.view) : o), i12 = false, n14 = this.view.state.facet(bn).map((o, r2) => {
      let l11 = typeof o == "function";
      return l11 && (i12 = true), l11 ? o(this.view) : o;
    });
    for (n14.length && (this.dynamicDecorationMap[t8++] = i12, e7.push(T.join(n14))), this.decorations = [this.editContextFormatting, ...e7, this.computeBlockGapDeco(), this.view.viewState.lineGapDeco]; t8 < this.decorations.length; ) this.dynamicDecorationMap[t8++] = false;
    return this.decorations;
  }
  scrollIntoView(t8) {
    if (t8.isSnapshot) {
      let c3 = this.view.viewState.lineBlockAt(t8.range.head);
      this.view.scrollDOM.scrollTop = c3.top - t8.yMargin, this.view.scrollDOM.scrollLeft = t8.xMargin;
      return;
    }
    for (let c3 of this.view.state.facet(pn)) try {
      if (c3(this.view, t8.range, t8)) return true;
    } catch (a2) {
      $2(this.view.state, a2, "scroll handler");
    }
    let { range: e7 } = t8, i12 = this.coordsAt(e7.head, e7.empty ? e7.assoc : e7.head > e7.anchor ? -1 : 1), n14;
    if (!i12) return;
    !e7.empty && (n14 = this.coordsAt(e7.anchor, e7.anchor > e7.head ? -1 : 1)) && (i12 = { left: Math.min(i12.left, n14.left), top: Math.min(i12.top, n14.top), right: Math.max(i12.right, n14.right), bottom: Math.max(i12.bottom, n14.bottom) });
    let o = qi(this.view), r2 = { left: i12.left - o.left, top: i12.top - o.top, right: i12.right + o.right, bottom: i12.bottom + o.bottom }, { offsetWidth: l11, offsetHeight: h3 } = this.view.scrollDOM;
    eo(this.view.scrollDOM, r2, e7.head < e7.anchor ? -1 : 1, t8.x, t8.y, Math.max(Math.min(t8.xMargin, l11), -l11), Math.max(Math.min(t8.yMargin, h3), -h3), this.view.textDirection == L2.LTR);
  }
};
function wo(s212) {
  return s212.node.nodeType == 1 && s212.node.firstChild && (s212.offset == 0 || s212.node.childNodes[s212.offset - 1].contentEditable == "false") && (s212.offset == s212.node.childNodes.length || s212.node.childNodes[s212.offset].contentEditable == "false");
}
function xn(s212, t8) {
  let e7 = s212.observer.selectionRange;
  if (!e7.focusNode) return null;
  let i12 = Ks(e7.focusNode, e7.focusOffset), n14 = qs(e7.focusNode, e7.focusOffset), o = i12 || n14;
  if (n14 && i12 && n14.node != i12.node) {
    let l11 = R2.get(n14.node);
    if (!l11 || l11 instanceof Q2 && l11.text != n14.node.nodeValue) o = n14;
    else if (s212.docView.lastCompositionAfterCursor) {
      let h3 = R2.get(i12.node);
      !h3 || h3 instanceof Q2 && h3.text != i12.node.nodeValue || (o = n14);
    }
  }
  if (s212.docView.lastCompositionAfterCursor = o != i12, !o) return null;
  let r2 = t8 - o.offset;
  return { from: r2, to: r2 + o.node.nodeValue.length, node: o.node };
}
function xo(s212, t8, e7) {
  let i12 = xn(s212, e7);
  if (!i12) return null;
  let { node: n14, from: o, to: r2 } = i12, l11 = n14.nodeValue;
  if (/[\n\r]/.test(l11) || s212.state.doc.sliceString(i12.from, i12.to) != l11) return null;
  let h3 = t8.invertedDesc, c3 = new j2(h3.mapPos(o), h3.mapPos(r2), o, r2), a2 = [];
  for (let f6 = n14.parentNode; ; f6 = f6.parentNode) {
    let d4 = R2.get(f6);
    if (d4 instanceof rt2) a2.push({ node: f6, deco: d4.mark });
    else {
      if (d4 instanceof P || f6.nodeName == "DIV" && f6.parentNode == s212.contentDOM) return { range: c3, text: n14, marks: a2, line: f6 };
      if (f6 != s212.contentDOM) a2.push({ node: f6, deco: new Xt({ inclusive: true, attributes: ho(f6), tagName: f6.tagName.toLowerCase() }) });
      else return null;
    }
  }
}
function vo(s212, t8) {
  return s212.nodeType != 1 ? 0 : (t8 && s212.childNodes[t8 - 1].contentEditable == "false" ? 1 : 0) | (t8 < s212.childNodes.length && s212.childNodes[t8].contentEditable == "false" ? 2 : 0);
}
var So = class {
  constructor() {
    this.changes = [];
  }
  compareRange(t8, e7) {
    ti(t8, e7, this.changes);
  }
  comparePoint(t8, e7) {
    ti(t8, e7, this.changes);
  }
};
function Co(s212, t8, e7) {
  let i12 = new So();
  return T.compare(s212, t8, e7, i12), i12.changes;
}
function Mo(s212, t8) {
  for (let e7 = s212; e7 && e7 != t8; e7 = e7.assignedSlot || e7.parentNode) if (e7.nodeType == 1 && e7.contentEditable == "false") return true;
  return false;
}
function ko(s212, t8) {
  let e7 = false;
  return t8 && s212.iterChangedRanges((i12, n14) => {
    i12 < t8.to && n14 > t8.from && (e7 = true);
  }), e7;
}
function Ao(s212, t8, e7 = 1) {
  let i12 = s212.charCategorizer(t8), n14 = s212.doc.lineAt(t8), o = t8 - n14.from;
  if (n14.length == 0) return x.cursor(t8);
  o == 0 ? e7 = 1 : o == n14.length && (e7 = -1);
  let r2 = o, l11 = o;
  e7 < 0 ? r2 = ee(n14.text, o, false) : l11 = ee(n14.text, o);
  let h3 = i12(n14.text.slice(r2, l11));
  for (; r2 > 0; ) {
    let c3 = ee(n14.text, r2, false);
    if (i12(n14.text.slice(c3, r2)) != h3) break;
    r2 = c3;
  }
  for (; l11 < n14.length; ) {
    let c3 = ee(n14.text, l11);
    if (i12(n14.text.slice(l11, c3)) != h3) break;
    l11 = c3;
  }
  return x.range(r2 + n14.from, l11 + n14.from);
}
function Do(s212, t8) {
  return t8.left > s212 ? t8.left - s212 : Math.max(0, s212 - t8.right);
}
function Oo(s212, t8) {
  return t8.top > s212 ? t8.top - s212 : Math.max(0, s212 - t8.bottom);
}
function Ie2(s212, t8) {
  return s212.top < t8.bottom - 1 && s212.bottom > t8.top + 1;
}
function ts(s212, t8) {
  return t8 < s212.top ? { top: t8, left: s212.left, right: s212.right, bottom: s212.bottom } : s212;
}
function es(s212, t8) {
  return t8 > s212.bottom ? { top: s212.top, left: s212.left, right: s212.right, bottom: t8 } : s212;
}
function oi(s212, t8, e7) {
  let i12, n14, o, r2, l11 = false, h3, c3, a2, f6;
  for (let p3 = s212.firstChild; p3; p3 = p3.nextSibling) {
    let g8 = At(p3);
    for (let b12 = 0; b12 < g8.length; b12++) {
      let m11 = g8[b12];
      n14 && Ie2(n14, m11) && (m11 = ts(es(m11, n14.bottom), n14.top));
      let w14 = Do(t8, m11), v10 = Oo(e7, m11);
      if (w14 == 0 && v10 == 0) return p3.nodeType == 3 ? is(p3, t8, e7) : oi(p3, t8, e7);
      if (!i12 || r2 > v10 || r2 == v10 && o > w14) {
        i12 = p3, n14 = m11, o = w14, r2 = v10;
        let x11 = v10 ? e7 < m11.top ? -1 : 1 : w14 ? t8 < m11.left ? -1 : 1 : 0;
        l11 = !x11 || (x11 > 0 ? b12 < g8.length - 1 : b12 > 0);
      }
      w14 == 0 ? e7 > m11.bottom && (!a2 || a2.bottom < m11.bottom) ? (h3 = p3, a2 = m11) : e7 < m11.top && (!f6 || f6.top > m11.top) && (c3 = p3, f6 = m11) : a2 && Ie2(a2, m11) ? a2 = es(a2, m11.bottom) : f6 && Ie2(f6, m11) && (f6 = ts(f6, m11.top));
    }
  }
  if (a2 && a2.bottom >= e7 ? (i12 = h3, n14 = a2) : f6 && f6.top <= e7 && (i12 = c3, n14 = f6), !i12) return { node: s212, offset: 0 };
  let d4 = Math.max(n14.left, Math.min(n14.right, t8));
  if (i12.nodeType == 3) return is(i12, d4, e7);
  if (l11 && i12.contentEditable != "false") return oi(i12, d4, e7);
  let u3 = Array.prototype.indexOf.call(s212.childNodes, i12) + (t8 >= (n14.left + n14.right) / 2 ? 1 : 0);
  return { node: s212, offset: u3 };
}
function is(s212, t8, e7) {
  let i12 = s212.nodeValue.length, n14 = -1, o = 1e9, r2 = 0;
  for (let l11 = 0; l11 < i12; l11++) {
    let h3 = pt(s212, l11, l11 + 1).getClientRects();
    for (let c3 = 0; c3 < h3.length; c3++) {
      let a2 = h3[c3];
      if (a2.top == a2.bottom) continue;
      r2 || (r2 = t8 - a2.left);
      let f6 = (a2.top > e7 ? a2.top - e7 : e7 - a2.bottom) - 1;
      if (a2.left - 1 <= t8 && a2.right + 1 >= t8 && f6 < o) {
        let d4 = t8 >= (a2.left + a2.right) / 2, u3 = d4;
        if ((y3.chrome || y3.gecko) && pt(s212, l11).getBoundingClientRect().left == a2.right && (u3 = !d4), f6 <= 0) return { node: s212, offset: l11 + (u3 ? 1 : 0) };
        n14 = l11 + (u3 ? 1 : 0), o = f6;
      }
    }
  }
  return { node: s212, offset: n14 > -1 ? n14 : r2 > 0 ? s212.nodeValue.length : 0 };
}
function vn(s212, t8, e7, i12 = -1) {
  var n14, o;
  let r2 = s212.contentDOM.getBoundingClientRect(), l11 = r2.top + s212.viewState.paddingTop, h3, { docHeight: c3 } = s212.viewState, { x: a2, y: f6 } = t8, d4 = f6 - l11;
  if (d4 < 0) return 0;
  if (d4 > c3) return s212.state.doc.length;
  for (let x11 = s212.viewState.heightOracle.textHeight / 2, S17 = false; h3 = s212.elementAtHeight(d4), h3.type != F2.Text; ) for (; d4 = i12 > 0 ? h3.bottom + x11 : h3.top - x11, !(d4 >= 0 && d4 <= c3); ) {
    if (S17) return e7 ? null : 0;
    S17 = true, i12 = -i12;
  }
  f6 = l11 + d4;
  let u3 = h3.from;
  if (u3 < s212.viewport.from) return s212.viewport.from == 0 ? 0 : e7 ? null : ss(s212, r2, h3, a2, f6);
  if (u3 > s212.viewport.to) return s212.viewport.to == s212.state.doc.length ? s212.state.doc.length : e7 ? null : ss(s212, r2, h3, a2, f6);
  let p3 = s212.dom.ownerDocument, g8 = s212.root.elementFromPoint ? s212.root : p3, b12 = g8.elementFromPoint(a2, f6);
  b12 && !s212.contentDOM.contains(b12) && (b12 = null), b12 || (a2 = Math.max(r2.left + 1, Math.min(r2.right - 1, a2)), b12 = g8.elementFromPoint(a2, f6), b12 && !s212.contentDOM.contains(b12) && (b12 = null));
  let m11, w14 = -1;
  if (b12 && ((n14 = s212.docView.nearest(b12)) === null || n14 === void 0 ? void 0 : n14.isEditable) != false) {
    if (p3.caretPositionFromPoint) {
      let x11 = p3.caretPositionFromPoint(a2, f6);
      x11 && ({ offsetNode: m11, offset: w14 } = x11);
    } else if (p3.caretRangeFromPoint) {
      let x11 = p3.caretRangeFromPoint(a2, f6);
      x11 && ({ startContainer: m11, startOffset: w14 } = x11, (!s212.contentDOM.contains(m11) || y3.safari && To(m11, w14, a2) || y3.chrome && Ro(m11, w14, a2)) && (m11 = void 0));
    }
    m11 && (w14 = Math.min(U2(m11), w14));
  }
  if (!m11 || !s212.docView.dom.contains(m11)) {
    let x11 = P.find(s212.docView, u3);
    if (!x11) return d4 > h3.top + h3.height / 2 ? h3.to : h3.from;
    ({ node: m11, offset: w14 } = oi(x11.dom, a2, f6));
  }
  let v10 = s212.docView.nearest(m11);
  if (!v10) return null;
  if (v10.isWidget && ((o = v10.dom) === null || o === void 0 ? void 0 : o.nodeType) == 1) {
    let x11 = v10.dom.getBoundingClientRect();
    return t8.y < x11.top || t8.y <= x11.bottom && t8.x <= (x11.left + x11.right) / 2 ? v10.posAtStart : v10.posAtEnd;
  } else return v10.localPosFromDOM(m11, w14) + v10.posAtStart;
}
function ss(s212, t8, e7, i12, n14) {
  let o = Math.round((i12 - t8.left) * s212.defaultCharacterWidth);
  if (s212.lineWrapping && e7.height > s212.defaultLineHeight * 1.5) {
    let l11 = s212.viewState.heightOracle.textHeight, h3 = Math.floor((n14 - e7.top - (s212.defaultLineHeight - l11) * 0.5) / l11);
    o += h3 * s212.viewState.heightOracle.lineLength;
  }
  let r2 = s212.state.sliceDoc(e7.from, e7.to);
  return e7.from + ft(r2, o, s212.state.tabSize);
}
function To(s212, t8, e7) {
  let i12;
  if (s212.nodeType != 3 || t8 != (i12 = s212.nodeValue.length)) return false;
  for (let n14 = s212.nextSibling; n14; n14 = n14.nextSibling) if (n14.nodeType != 1 || n14.nodeName != "BR") return false;
  return pt(s212, i12 - 1, i12).getBoundingClientRect().left > e7;
}
function Ro(s212, t8, e7) {
  if (t8 != 0) return false;
  for (let n14 = s212; ; ) {
    let o = n14.parentNode;
    if (!o || o.nodeType != 1 || o.firstChild != n14) return false;
    if (o.classList.contains("cm-line")) break;
    n14 = o;
  }
  let i12 = s212.nodeType == 1 ? s212.getBoundingClientRect() : pt(s212, 0, Math.max(s212.nodeValue.length, 1)).getBoundingClientRect();
  return e7 - i12.left > 5;
}
function ri(s212, t8) {
  let e7 = s212.lineBlockAt(t8);
  if (Array.isArray(e7.type)) {
    for (let i12 of e7.type) if (i12.to > t8 || i12.to == t8 && (i12.to == e7.to || i12.type == F2.Text)) return i12;
  }
  return e7;
}
function Eo(s212, t8, e7, i12) {
  let n14 = ri(s212, t8.head), o = !i12 || n14.type != F2.Text || !(s212.lineWrapping || n14.widgetLineBreaks) ? null : s212.coordsAtPos(t8.assoc < 0 && t8.head > n14.from ? t8.head - 1 : t8.head);
  if (o) {
    let r2 = s212.dom.getBoundingClientRect(), l11 = s212.textDirectionAt(n14.from), h3 = s212.posAtCoords({ x: e7 == (l11 == L2.LTR) ? r2.right - 1 : r2.left + 1, y: (o.top + o.bottom) / 2 });
    if (h3 != null) return x.cursor(h3, e7 ? -1 : 1);
  }
  return x.cursor(e7 ? n14.to : n14.from, e7 ? -1 : 1);
}
function ns(s212, t8, e7, i12) {
  let n14 = s212.state.doc.lineAt(t8.head), o = s212.bidiSpans(n14), r2 = s212.textDirectionAt(n14.from);
  for (let l11 = t8, h3 = null; ; ) {
    let c3 = on(n14, o, r2, l11, e7), a2 = nn;
    if (!c3) {
      if (n14.number == (e7 ? s212.state.doc.lines : 1)) return l11;
      a2 = `
`, n14 = s212.state.doc.line(n14.number + (e7 ? 1 : -1)), o = s212.bidiSpans(n14), c3 = s212.visualLineSide(n14, !e7);
    }
    if (h3) {
      if (!h3(a2)) return l11;
    } else {
      if (!i12) return c3;
      h3 = i12(a2);
    }
    l11 = c3;
  }
}
function Lo(s212, t8, e7) {
  let i12 = s212.state.charCategorizer(t8), n14 = i12(e7);
  return (o) => {
    let r2 = i12(o);
    return n14 == O.Space && (n14 = r2), n14 == r2;
  };
}
function Bo(s212, t8, e7, i12) {
  let n14 = t8.head, o = e7 ? 1 : -1;
  if (n14 == (e7 ? s212.state.doc.length : 0)) return x.cursor(n14, t8.assoc);
  let r2 = t8.goalColumn, l11, h3 = s212.contentDOM.getBoundingClientRect(), c3 = s212.coordsAtPos(n14, t8.assoc || -1), a2 = s212.documentTop;
  if (c3) r2 == null && (r2 = c3.left - h3.left), l11 = o < 0 ? c3.top : c3.bottom;
  else {
    let u3 = s212.viewState.lineBlockAt(n14);
    r2 == null && (r2 = Math.min(h3.right - h3.left, s212.defaultCharacterWidth * (n14 - u3.from))), l11 = (o < 0 ? u3.top : u3.bottom) + a2;
  }
  let f6 = h3.left + r2, d4 = i12 ?? s212.viewState.heightOracle.textHeight >> 1;
  for (let u3 = 0; ; u3 += 10) {
    let p3 = l11 + (d4 + u3) * o, g8 = vn(s212, { x: f6, y: p3 }, false, o);
    if (p3 < h3.top || p3 > h3.bottom || (o < 0 ? g8 < n14 : g8 > n14)) {
      let b12 = s212.docView.coordsForChar(g8), m11 = !b12 || p3 < b12.top ? -1 : 1;
      return x.cursor(g8, m11, void 0, r2);
    }
  }
}
function pe2(s212, t8, e7) {
  for (; ; ) {
    let i12 = 0;
    for (let n14 of s212) n14.between(t8 - 1, t8 + 1, (o, r2, l11) => {
      if (t8 > o && t8 < r2) {
        let h3 = i12 || e7 || (t8 - o < r2 - t8 ? -1 : 1);
        t8 = h3 < 0 ? o : r2, i12 = h3;
      }
    });
    if (!i12) return t8;
  }
}
function Ke2(s212, t8, e7) {
  let i12 = pe2(s212.state.facet(Ki).map((n14) => n14(s212)), e7.from, t8.head > e7.from ? -1 : 1);
  return i12 == e7.from ? e7 : x.cursor(i12, i12 < e7.from ? 1 : -1);
}
var Bt = "ï¿¿";
var li = class {
  constructor(t8, e7) {
    this.points = t8, this.text = "", this.lineSeparator = e7.facet(I.lineSeparator);
  }
  append(t8) {
    this.text += t8;
  }
  lineBreak() {
    this.text += Bt;
  }
  readRange(t8, e7) {
    if (!t8) return this;
    let i12 = t8.parentNode;
    for (let n14 = t8; ; ) {
      this.findPointBefore(i12, n14);
      let o = this.text.length;
      this.readNode(n14);
      let r2 = n14.nextSibling;
      if (r2 == e7) break;
      let l11 = R2.get(n14), h3 = R2.get(r2);
      (l11 && h3 ? l11.breakAfter : (l11 ? l11.breakAfter : xe2(n14)) || xe2(r2) && (n14.nodeName != "BR" || n14.cmIgnore) && this.text.length > o) && this.lineBreak(), n14 = r2;
    }
    return this.findPointBefore(i12, e7), this;
  }
  readTextNode(t8) {
    let e7 = t8.nodeValue;
    for (let i12 of this.points) i12.node == t8 && (i12.pos = this.text.length + Math.min(i12.offset, e7.length));
    for (let i12 = 0, n14 = this.lineSeparator ? null : /\r\n?|\n/g; ; ) {
      let o = -1, r2 = 1, l11;
      if (this.lineSeparator ? (o = e7.indexOf(this.lineSeparator, i12), r2 = this.lineSeparator.length) : (l11 = n14.exec(e7)) && (o = l11.index, r2 = l11[0].length), this.append(e7.slice(i12, o < 0 ? e7.length : o)), o < 0) break;
      if (this.lineBreak(), r2 > 1) for (let h3 of this.points) h3.node == t8 && h3.pos > this.text.length && (h3.pos -= r2 - 1);
      i12 = o + r2;
    }
  }
  readNode(t8) {
    if (t8.cmIgnore) return;
    let e7 = R2.get(t8), i12 = e7 && e7.overrideDOMText;
    if (i12 != null) {
      this.findPointInside(t8, i12.length);
      for (let n14 = i12.iter(); !n14.next().done; ) n14.lineBreak ? this.lineBreak() : this.append(n14.value);
    } else t8.nodeType == 3 ? this.readTextNode(t8) : t8.nodeName == "BR" ? t8.nextSibling && this.lineBreak() : t8.nodeType == 1 && this.readRange(t8.firstChild, null);
  }
  findPointBefore(t8, e7) {
    for (let i12 of this.points) i12.node == t8 && t8.childNodes[i12.offset] == e7 && (i12.pos = this.text.length);
  }
  findPointInside(t8, e7) {
    for (let i12 of this.points) (t8.nodeType == 3 ? i12.node == t8 : t8.contains(i12.node)) && (i12.pos = this.text.length + (Po(t8, i12.node, i12.offset) ? e7 : 0));
  }
};
function Po(s212, t8, e7) {
  for (; ; ) {
    if (!t8 || e7 < U2(t8)) return false;
    if (t8 == s212) return true;
    e7 = ut(t8) + 1, t8 = t8.parentNode;
  }
}
var ke2 = class {
  constructor(t8, e7) {
    this.node = t8, this.offset = e7, this.pos = -1;
  }
};
var hi = class {
  constructor(t8, e7, i12, n14) {
    this.typeOver = n14, this.bounds = null, this.text = "", this.domChanged = e7 > -1;
    let { impreciseHead: o, impreciseAnchor: r2 } = t8.docView;
    if (t8.state.readOnly && e7 > -1) this.newSel = null;
    else if (e7 > -1 && (this.bounds = t8.docView.domBoundsAround(e7, i12, 0))) {
      let l11 = o || r2 ? [] : Vo(t8), h3 = new li(l11, t8.state);
      h3.readRange(this.bounds.startDOM, this.bounds.endDOM), this.text = h3.text, this.newSel = Fo(l11, this.bounds.from);
    } else {
      let l11 = t8.observer.selectionRange, h3 = o && o.node == l11.focusNode && o.offset == l11.focusOffset || !Xe2(t8.contentDOM, l11.focusNode) ? t8.state.selection.main.head : t8.docView.posFromDOM(l11.focusNode, l11.focusOffset), c3 = r2 && r2.node == l11.anchorNode && r2.offset == l11.anchorOffset || !Xe2(t8.contentDOM, l11.anchorNode) ? t8.state.selection.main.anchor : t8.docView.posFromDOM(l11.anchorNode, l11.anchorOffset), a2 = t8.viewport;
      if ((y3.ios || y3.chrome) && t8.state.selection.main.empty && h3 != c3 && (a2.from > 0 || a2.to < t8.state.doc.length)) {
        let f6 = Math.min(h3, c3), d4 = Math.max(h3, c3), u3 = a2.from - f6, p3 = a2.to - d4;
        (u3 == 0 || u3 == 1 || f6 == 0) && (p3 == 0 || p3 == -1 || d4 == t8.state.doc.length) && (h3 = 0, c3 = t8.state.doc.length);
      }
      this.newSel = x.single(c3, h3);
    }
  }
};
function Sn(s212, t8) {
  let e7, { newSel: i12 } = t8, n14 = s212.state.selection.main, o = s212.inputState.lastKeyTime > Date.now() - 100 ? s212.inputState.lastKeyCode : -1;
  if (t8.bounds) {
    let { from: r2, to: l11 } = t8.bounds, h3 = n14.from, c3 = null;
    (o === 8 || y3.android && t8.text.length < l11 - r2) && (h3 = n14.to, c3 = "end");
    let a2 = No(s212.state.doc.sliceString(r2, l11, Bt), t8.text, h3 - r2, c3);
    a2 && (y3.chrome && o == 13 && a2.toB == a2.from + 2 && t8.text.slice(a2.from, a2.toB) == Bt + Bt && a2.toB--, e7 = { from: r2 + a2.from, to: r2 + a2.toA, insert: m.of(t8.text.slice(a2.from, a2.toB).split(Bt)) });
  } else i12 && (!s212.hasFocus && s212.state.facet(st2) || i12.main.eq(n14)) && (i12 = null);
  if (!e7 && !i12) return false;
  if (!e7 && t8.typeOver && !n14.empty && i12 && i12.main.empty ? e7 = { from: n14.from, to: n14.to, insert: s212.state.doc.slice(n14.from, n14.to) } : e7 && e7.from >= n14.from && e7.to <= n14.to && (e7.from != n14.from || e7.to != n14.to) && n14.to - n14.from - (e7.to - e7.from) <= 4 ? e7 = { from: n14.from, to: n14.to, insert: s212.state.doc.slice(n14.from, e7.from).append(e7.insert).append(s212.state.doc.slice(e7.to, n14.to)) } : (y3.mac || y3.android) && e7 && e7.from == e7.to && e7.from == n14.head - 1 && /^\. ?$/.test(e7.insert.toString()) && s212.contentDOM.getAttribute("autocorrect") == "off" ? (i12 && e7.insert.length == 2 && (i12 = x.single(i12.main.anchor - 1, i12.main.head - 1)), e7 = { from: n14.from, to: n14.to, insert: m.of([" "]) }) : y3.chrome && e7 && e7.from == e7.to && e7.from == n14.head && e7.insert.toString() == `
 ` && s212.lineWrapping && (i12 && (i12 = x.single(i12.main.anchor - 1, i12.main.head - 1)), e7 = { from: n14.from, to: n14.to, insert: m.of([" "]) }), e7) return ji(s212, e7, i12, o);
  if (i12 && !i12.main.eq(n14)) {
    let r2 = false, l11 = "select";
    return s212.inputState.lastSelectionTime > Date.now() - 50 && (s212.inputState.lastSelectionOrigin == "select" && (r2 = true), l11 = s212.inputState.lastSelectionOrigin), s212.dispatch({ selection: i12, scrollIntoView: r2, userEvent: l11 }), true;
  } else return false;
}
function ji(s212, t8, e7, i12 = -1) {
  if (y3.ios && s212.inputState.flushIOSKey(t8)) return true;
  let n14 = s212.state.selection.main;
  if (y3.android && (t8.to == n14.to && (t8.from == n14.from || t8.from == n14.from - 1 && s212.state.sliceDoc(t8.from, n14.from) == " ") && t8.insert.length == 1 && t8.insert.lines == 2 && Mt(s212.contentDOM, "Enter", 13) || (t8.from == n14.from - 1 && t8.to == n14.to && t8.insert.length == 0 || i12 == 8 && t8.insert.length < t8.to - t8.from && t8.to > n14.head) && Mt(s212.contentDOM, "Backspace", 8) || t8.from == n14.from && t8.to == n14.to + 1 && t8.insert.length == 0 && Mt(s212.contentDOM, "Delete", 46))) return true;
  let o = t8.insert.toString();
  s212.inputState.composing >= 0 && s212.inputState.composing++;
  let r2, l11 = () => r2 || (r2 = Ho(s212, t8, e7));
  return s212.state.facet(cn).some((h3) => h3(s212, t8.from, t8.to, o, l11)) || s212.dispatch(l11()), true;
}
function Ho(s212, t8, e7) {
  let i12, n14 = s212.state, o = n14.selection.main;
  if (t8.from >= o.from && t8.to <= o.to && t8.to - t8.from >= (o.to - o.from) / 3 && (!e7 || e7.main.empty && e7.main.from == t8.from + t8.insert.length) && s212.inputState.composing < 0) {
    let l11 = o.from < t8.from ? n14.sliceDoc(o.from, t8.from) : "", h3 = o.to > t8.to ? n14.sliceDoc(t8.to, o.to) : "";
    i12 = n14.replaceSelection(s212.state.toText(l11 + t8.insert.sliceString(0, void 0, s212.state.lineBreak) + h3));
  } else {
    let l11 = n14.changes(t8), h3 = e7 && e7.main.to <= l11.newLength ? e7.main : void 0;
    if (n14.selection.ranges.length > 1 && s212.inputState.composing >= 0 && t8.to <= o.to && t8.to >= o.to - 10) {
      let c3 = s212.state.sliceDoc(t8.from, t8.to), a2, f6 = e7 && xn(s212, e7.main.head);
      if (f6) {
        let p3 = t8.insert.length - (t8.to - t8.from);
        a2 = { from: f6.from, to: f6.to - p3 };
      } else a2 = s212.state.doc.lineAt(o.head);
      let d4 = o.to - t8.to, u3 = o.to - o.from;
      i12 = n14.changeByRange((p3) => {
        if (p3.from == o.from && p3.to == o.to) return { changes: l11, range: h3 || p3.map(l11) };
        let g8 = p3.to - d4, b12 = g8 - c3.length;
        if (p3.to - p3.from != u3 || s212.state.sliceDoc(b12, g8) != c3 || p3.to >= a2.from && p3.from <= a2.to) return { range: p3 };
        let m11 = n14.changes({ from: b12, to: g8, insert: t8.insert }), w14 = p3.to - o.to;
        return { changes: m11, range: h3 ? x.range(Math.max(0, h3.anchor + w14), Math.max(0, h3.head + w14)) : p3.map(m11) };
      });
    } else i12 = { changes: l11, selection: h3 && n14.selection.replaceRange(h3) };
  }
  let r2 = "input.type";
  return (s212.composing || s212.inputState.compositionPendingChange && s212.inputState.compositionEndedAt > Date.now() - 50) && (s212.inputState.compositionPendingChange = false, r2 += ".compose", s212.inputState.compositionFirstChange && (r2 += ".start", s212.inputState.compositionFirstChange = false)), n14.update(i12, { userEvent: r2, scrollIntoView: true });
}
function No(s212, t8, e7, i12) {
  let n14 = Math.min(s212.length, t8.length), o = 0;
  for (; o < n14 && s212.charCodeAt(o) == t8.charCodeAt(o); ) o++;
  if (o == n14 && s212.length == t8.length) return null;
  let r2 = s212.length, l11 = t8.length;
  for (; r2 > 0 && l11 > 0 && s212.charCodeAt(r2 - 1) == t8.charCodeAt(l11 - 1); ) r2--, l11--;
  if (i12 == "end") {
    let h3 = Math.max(0, o - Math.min(r2, l11));
    e7 -= r2 + h3 - o;
  }
  if (r2 < o && s212.length < t8.length) {
    let h3 = e7 <= o && e7 >= r2 ? o - e7 : 0;
    o -= h3, l11 = o + (l11 - r2), r2 = o;
  } else if (l11 < o) {
    let h3 = e7 <= o && e7 >= l11 ? o - e7 : 0;
    o -= h3, r2 = o + (r2 - l11), l11 = o;
  }
  return { from: o, toA: r2, toB: l11 };
}
function Vo(s212) {
  let t8 = [];
  if (s212.root.activeElement != s212.contentDOM) return t8;
  let { anchorNode: e7, anchorOffset: i12, focusNode: n14, focusOffset: o } = s212.observer.selectionRange;
  return e7 && (t8.push(new ke2(e7, i12)), (n14 != e7 || o != i12) && t8.push(new ke2(n14, o))), t8;
}
function Fo(s212, t8) {
  if (s212.length == 0) return null;
  let e7 = s212[0].pos, i12 = s212.length == 2 ? s212[1].pos : e7;
  return e7 > -1 && i12 > -1 ? x.single(e7 + t8, i12 + t8) : null;
}
var ai = class {
  setSelectionOrigin(t8) {
    this.lastSelectionOrigin = t8, this.lastSelectionTime = Date.now();
  }
  constructor(t8) {
    this.view = t8, this.lastKeyCode = 0, this.lastKeyTime = 0, this.lastTouchTime = 0, this.lastFocusTime = 0, this.lastScrollTop = 0, this.lastScrollLeft = 0, this.pendingIOSKey = void 0, this.tabFocusMode = -1, this.lastSelectionOrigin = null, this.lastSelectionTime = 0, this.lastContextMenu = 0, this.scrollHandlers = [], this.handlers = /* @__PURE__ */ Object.create(null), this.composing = -1, this.compositionFirstChange = null, this.compositionEndedAt = 0, this.compositionPendingKey = false, this.compositionPendingChange = false, this.mouseSelection = null, this.draggedContent = null, this.handleEvent = this.handleEvent.bind(this), this.notifiedFocused = t8.hasFocus, y3.safari && t8.contentDOM.addEventListener("input", () => null), y3.gecko && Zo(t8.contentDOM.ownerDocument);
  }
  handleEvent(t8) {
    !Yo(this.view, t8) || this.ignoreDuringComposition(t8) || t8.type == "keydown" && this.keydown(t8) || this.runHandlers(t8.type, t8);
  }
  runHandlers(t8, e7) {
    let i12 = this.handlers[t8];
    if (i12) {
      for (let n14 of i12.observers) n14(this.view, e7);
      for (let n14 of i12.handlers) {
        if (e7.defaultPrevented) break;
        if (n14(this.view, e7)) {
          e7.preventDefault();
          break;
        }
      }
    }
  }
  ensureHandlers(t8) {
    let e7 = Wo(t8), i12 = this.handlers, n14 = this.view.contentDOM;
    for (let o in e7) if (o != "scroll") {
      let r2 = !e7[o].handlers.length, l11 = i12[o];
      l11 && r2 != !l11.handlers.length && (n14.removeEventListener(o, this.handleEvent), l11 = null), l11 || n14.addEventListener(o, this.handleEvent, { passive: r2 });
    }
    for (let o in i12) o != "scroll" && !e7[o] && n14.removeEventListener(o, this.handleEvent);
    this.handlers = e7;
  }
  keydown(t8) {
    if (this.lastKeyCode = t8.keyCode, this.lastKeyTime = Date.now(), t8.keyCode == 9 && this.tabFocusMode > -1 && (!this.tabFocusMode || Date.now() <= this.tabFocusMode)) return true;
    if (this.tabFocusMode > 0 && t8.keyCode != 27 && Mn.indexOf(t8.keyCode) < 0 && (this.tabFocusMode = -1), y3.android && y3.chrome && !t8.synthetic && (t8.keyCode == 13 || t8.keyCode == 8)) return this.view.observer.delayAndroidKey(t8.key, t8.keyCode), true;
    let e7;
    return y3.ios && !t8.synthetic && !t8.altKey && !t8.metaKey && ((e7 = Cn.find((i12) => i12.keyCode == t8.keyCode)) && !t8.ctrlKey || zo.indexOf(t8.key) > -1 && t8.ctrlKey && !t8.shiftKey) ? (this.pendingIOSKey = e7 || t8, setTimeout(() => this.flushIOSKey(), 250), true) : (t8.keyCode != 229 && this.view.observer.forceFlush(), false);
  }
  flushIOSKey(t8) {
    let e7 = this.pendingIOSKey;
    return !e7 || e7.key == "Enter" && t8 && t8.from < t8.to && /^\S+$/.test(t8.insert.toString()) ? false : (this.pendingIOSKey = void 0, Mt(this.view.contentDOM, e7.key, e7.keyCode, e7 instanceof KeyboardEvent ? e7 : void 0));
  }
  ignoreDuringComposition(t8) {
    return /^key/.test(t8.type) ? this.composing > 0 ? true : y3.safari && !y3.ios && this.compositionPendingKey && Date.now() - this.compositionEndedAt < 100 ? (this.compositionPendingKey = false, true) : false : false;
  }
  startMouseSelection(t8) {
    this.mouseSelection && this.mouseSelection.destroy(), this.mouseSelection = t8;
  }
  update(t8) {
    this.view.observer.update(t8), this.mouseSelection && this.mouseSelection.update(t8), this.draggedContent && t8.docChanged && (this.draggedContent = this.draggedContent.map(t8.changes)), t8.transactions.length && (this.lastKeyCode = this.lastSelectionTime = 0);
  }
  destroy() {
    this.mouseSelection && this.mouseSelection.destroy();
  }
};
function os(s212, t8) {
  return (e7, i12) => {
    try {
      return t8.call(s212, i12, e7);
    } catch (n14) {
      $2(e7.state, n14);
    }
  };
}
function Wo(s212) {
  let t8 = /* @__PURE__ */ Object.create(null);
  function e7(i12) {
    return t8[i12] || (t8[i12] = { observers: [], handlers: [] });
  }
  for (let i12 of s212) {
    let n14 = i12.spec;
    if (n14 && n14.domEventHandlers) for (let o in n14.domEventHandlers) {
      let r2 = n14.domEventHandlers[o];
      r2 && e7(o).handlers.push(os(i12.value, r2));
    }
    if (n14 && n14.domEventObservers) for (let o in n14.domEventObservers) {
      let r2 = n14.domEventObservers[o];
      r2 && e7(o).observers.push(os(i12.value, r2));
    }
  }
  for (let i12 in Y2) e7(i12).handlers.push(Y2[i12]);
  for (let i12 in K2) e7(i12).observers.push(K2[i12]);
  return t8;
}
var Cn = [{ key: "Backspace", keyCode: 8, inputType: "deleteContentBackward" }, { key: "Enter", keyCode: 13, inputType: "insertParagraph" }, { key: "Enter", keyCode: 13, inputType: "insertLineBreak" }, { key: "Delete", keyCode: 46, inputType: "deleteContentForward" }];
var zo = "dthko";
var Mn = [16, 17, 18, 20, 91, 92, 224, 225];
var re2 = 6;
function le2(s212) {
  return Math.max(0, s212) * 0.7 + 8;
}
function Io(s212, t8) {
  return Math.max(Math.abs(s212.clientX - t8.clientX), Math.abs(s212.clientY - t8.clientY));
}
var ci = class {
  constructor(t8, e7, i12, n14) {
    this.view = t8, this.startEvent = e7, this.style = i12, this.mustSelect = n14, this.scrollSpeed = { x: 0, y: 0 }, this.scrolling = -1, this.lastEvent = e7, this.scrollParents = io(t8.contentDOM), this.atoms = t8.state.facet(Ki).map((r2) => r2(t8));
    let o = t8.contentDOM.ownerDocument;
    o.addEventListener("mousemove", this.move = this.move.bind(this)), o.addEventListener("mouseup", this.up = this.up.bind(this)), this.extend = e7.shiftKey, this.multiple = t8.state.facet(I.allowMultipleSelections) && Ko(t8, e7), this.dragging = jo(t8, e7) && Dn(e7) == 1 ? null : false;
  }
  start(t8) {
    this.dragging === false && this.select(t8);
  }
  move(t8) {
    if (t8.buttons == 0) return this.destroy();
    if (this.dragging || this.dragging == null && Io(this.startEvent, t8) < 10) return;
    this.select(this.lastEvent = t8);
    let e7 = 0, i12 = 0, n14 = 0, o = 0, r2 = this.view.win.innerWidth, l11 = this.view.win.innerHeight;
    this.scrollParents.x && ({ left: n14, right: r2 } = this.scrollParents.x.getBoundingClientRect()), this.scrollParents.y && ({ top: o, bottom: l11 } = this.scrollParents.y.getBoundingClientRect());
    let h3 = qi(this.view);
    t8.clientX - h3.left <= n14 + re2 ? e7 = -le2(n14 - t8.clientX) : t8.clientX + h3.right >= r2 - re2 && (e7 = le2(t8.clientX - r2)), t8.clientY - h3.top <= o + re2 ? i12 = -le2(o - t8.clientY) : t8.clientY + h3.bottom >= l11 - re2 && (i12 = le2(t8.clientY - l11)), this.setScrollSpeed(e7, i12);
  }
  up(t8) {
    this.dragging == null && this.select(this.lastEvent), this.dragging || t8.preventDefault(), this.destroy();
  }
  destroy() {
    this.setScrollSpeed(0, 0);
    let t8 = this.view.contentDOM.ownerDocument;
    t8.removeEventListener("mousemove", this.move), t8.removeEventListener("mouseup", this.up), this.view.inputState.mouseSelection = this.view.inputState.draggedContent = null;
  }
  setScrollSpeed(t8, e7) {
    this.scrollSpeed = { x: t8, y: e7 }, t8 || e7 ? this.scrolling < 0 && (this.scrolling = setInterval(() => this.scroll(), 50)) : this.scrolling > -1 && (clearInterval(this.scrolling), this.scrolling = -1);
  }
  scroll() {
    let { x: t8, y: e7 } = this.scrollSpeed;
    t8 && this.scrollParents.x && (this.scrollParents.x.scrollLeft += t8, t8 = 0), e7 && this.scrollParents.y && (this.scrollParents.y.scrollTop += e7, e7 = 0), (t8 || e7) && this.view.win.scrollBy(t8, e7), this.dragging === false && this.select(this.lastEvent);
  }
  skipAtoms(t8) {
    let e7 = null;
    for (let i12 = 0; i12 < t8.ranges.length; i12++) {
      let n14 = t8.ranges[i12], o = null;
      if (n14.empty) {
        let r2 = pe2(this.atoms, n14.from, 0);
        r2 != n14.from && (o = x.cursor(r2, -1));
      } else {
        let r2 = pe2(this.atoms, n14.from, -1), l11 = pe2(this.atoms, n14.to, 1);
        (r2 != n14.from || l11 != n14.to) && (o = x.range(n14.from == n14.anchor ? r2 : l11, n14.from == n14.head ? r2 : l11));
      }
      o && (e7 || (e7 = t8.ranges.slice()), e7[i12] = o);
    }
    return e7 ? x.create(e7, t8.mainIndex) : t8;
  }
  select(t8) {
    let { view: e7 } = this, i12 = this.skipAtoms(this.style.get(t8, this.extend, this.multiple));
    (this.mustSelect || !i12.eq(e7.state.selection, this.dragging === false)) && this.view.dispatch({ selection: i12, userEvent: "select.pointer" }), this.mustSelect = false;
  }
  update(t8) {
    t8.transactions.some((e7) => e7.isUserEvent("input.type")) ? this.destroy() : this.style.update(t8) && setTimeout(() => this.select(this.lastEvent), 20);
  }
};
function Ko(s212, t8) {
  let e7 = s212.state.facet(rn);
  return e7.length ? e7[0](t8) : y3.mac ? t8.metaKey : t8.ctrlKey;
}
function qo(s212, t8) {
  let e7 = s212.state.facet(ln);
  return e7.length ? e7[0](t8) : y3.mac ? !t8.altKey : !t8.ctrlKey;
}
function jo(s212, t8) {
  let { main: e7 } = s212.state.selection;
  if (e7.empty) return false;
  let i12 = jt(s212.root);
  if (!i12 || i12.rangeCount == 0) return true;
  let n14 = i12.getRangeAt(0).getClientRects();
  for (let o = 0; o < n14.length; o++) {
    let r2 = n14[o];
    if (r2.left <= t8.clientX && r2.right >= t8.clientX && r2.top <= t8.clientY && r2.bottom >= t8.clientY) return true;
  }
  return false;
}
function Yo(s212, t8) {
  if (!t8.bubbles) return true;
  if (t8.defaultPrevented) return false;
  for (let e7 = t8.target, i12; e7 != s212.contentDOM; e7 = e7.parentNode) if (!e7 || e7.nodeType == 11 || (i12 = R2.get(e7)) && i12.ignoreEvent(t8)) return false;
  return true;
}
var Y2 = /* @__PURE__ */ Object.create(null);
var K2 = /* @__PURE__ */ Object.create(null);
var kn = y3.ie && y3.ie_version < 15 || y3.ios && y3.webkit_version < 604;
function _o(s212) {
  let t8 = s212.dom.parentNode;
  if (!t8) return;
  let e7 = t8.appendChild(document.createElement("textarea"));
  e7.style.cssText = "position: fixed; left: -10000px; top: 10px", e7.focus(), setTimeout(() => {
    s212.focus(), e7.remove(), An(s212, e7.value);
  }, 50);
}
function Fe2(s212, t8, e7) {
  for (let i12 of s212.facet(t8)) e7 = i12(e7, s212);
  return e7;
}
function An(s212, t8) {
  t8 = Fe2(s212.state, zi, t8);
  let { state: e7 } = s212, i12, n14 = 1, o = e7.toText(t8), r2 = o.lines == e7.selection.ranges.length;
  if (fi != null && e7.selection.ranges.every((h3) => h3.empty) && fi == o.toString()) {
    let h3 = -1;
    i12 = e7.changeByRange((c3) => {
      let a2 = e7.doc.lineAt(c3.from);
      if (a2.from == h3) return { range: c3 };
      h3 = a2.from;
      let f6 = e7.toText((r2 ? o.line(n14++).text : t8) + e7.lineBreak);
      return { changes: { from: a2.from, insert: f6 }, range: x.cursor(c3.from + f6.length) };
    });
  } else r2 ? i12 = e7.changeByRange((h3) => {
    let c3 = o.line(n14++);
    return { changes: { from: h3.from, to: h3.to, insert: c3.text }, range: x.cursor(h3.from + c3.length) };
  }) : i12 = e7.replaceSelection(o);
  s212.dispatch(i12, { userEvent: "input.paste", scrollIntoView: true });
}
K2.scroll = (s212) => {
  s212.inputState.lastScrollTop = s212.scrollDOM.scrollTop, s212.inputState.lastScrollLeft = s212.scrollDOM.scrollLeft;
};
Y2.keydown = (s212, t8) => (s212.inputState.setSelectionOrigin("select"), t8.keyCode == 27 && s212.inputState.tabFocusMode != 0 && (s212.inputState.tabFocusMode = Date.now() + 2e3), false);
K2.touchstart = (s212, t8) => {
  s212.inputState.lastTouchTime = Date.now(), s212.inputState.setSelectionOrigin("select.pointer");
};
K2.touchmove = (s212) => {
  s212.inputState.setSelectionOrigin("select.pointer");
};
Y2.mousedown = (s212, t8) => {
  if (s212.observer.flush(), s212.inputState.lastTouchTime > Date.now() - 2e3) return false;
  let e7 = null;
  for (let i12 of s212.state.facet(hn)) if (e7 = i12(s212, t8), e7) break;
  if (!e7 && t8.button == 0 && (e7 = $o(s212, t8)), e7) {
    let i12 = !s212.hasFocus;
    s212.inputState.startMouseSelection(new ci(s212, t8, e7, i12)), i12 && s212.observer.ignore(() => {
      Ws(s212.contentDOM);
      let o = s212.root.activeElement;
      o && !o.contains(s212.contentDOM) && o.blur();
    });
    let n14 = s212.inputState.mouseSelection;
    if (n14) return n14.start(t8), n14.dragging === false;
  }
  return false;
};
function rs(s212, t8, e7, i12) {
  if (i12 == 1) return x.cursor(t8, e7);
  if (i12 == 2) return Ao(s212.state, t8, e7);
  {
    let n14 = P.find(s212.docView, t8), o = s212.state.doc.lineAt(n14 ? n14.posAtEnd : t8), r2 = n14 ? n14.posAtStart : o.from, l11 = n14 ? n14.posAtEnd : o.to;
    return l11 < s212.state.doc.length && l11 == o.to && l11++, x.range(r2, l11);
  }
}
var ls = (s212, t8, e7) => t8 >= e7.top && t8 <= e7.bottom && s212 >= e7.left && s212 <= e7.right;
function Xo(s212, t8, e7, i12) {
  let n14 = P.find(s212.docView, t8);
  if (!n14) return 1;
  let o = t8 - n14.posAtStart;
  if (o == 0) return 1;
  if (o == n14.length) return -1;
  let r2 = n14.coordsAt(o, -1);
  if (r2 && ls(e7, i12, r2)) return -1;
  let l11 = n14.coordsAt(o, 1);
  return l11 && ls(e7, i12, l11) ? 1 : r2 && r2.bottom >= i12 ? -1 : 1;
}
function hs(s212, t8) {
  let e7 = s212.posAtCoords({ x: t8.clientX, y: t8.clientY }, false);
  return { pos: e7, bias: Xo(s212, e7, t8.clientX, t8.clientY) };
}
var Go = y3.ie && y3.ie_version <= 11;
var as = null;
var cs = 0;
var fs = 0;
function Dn(s212) {
  if (!Go) return s212.detail;
  let t8 = as, e7 = fs;
  return as = s212, fs = Date.now(), cs = !t8 || e7 > Date.now() - 400 && Math.abs(t8.clientX - s212.clientX) < 2 && Math.abs(t8.clientY - s212.clientY) < 2 ? (cs + 1) % 3 : 1;
}
function $o(s212, t8) {
  let e7 = hs(s212, t8), i12 = Dn(t8), n14 = s212.state.selection;
  return { update(o) {
    o.docChanged && (e7.pos = o.changes.mapPos(e7.pos), n14 = n14.map(o.changes));
  }, get(o, r2, l11) {
    let h3 = hs(s212, o), c3, a2 = rs(s212, h3.pos, h3.bias, i12);
    if (e7.pos != h3.pos && !r2) {
      let f6 = rs(s212, e7.pos, e7.bias, i12), d4 = Math.min(f6.from, a2.from), u3 = Math.max(f6.to, a2.to);
      a2 = d4 < a2.from ? x.range(d4, u3) : x.range(u3, d4);
    }
    return r2 ? n14.replaceRange(n14.main.extend(a2.from, a2.to)) : l11 && i12 == 1 && n14.ranges.length > 1 && (c3 = Uo(n14, h3.pos)) ? c3 : l11 ? n14.addRange(a2) : x.create([a2]);
  } };
}
function Uo(s212, t8) {
  for (let e7 = 0; e7 < s212.ranges.length; e7++) {
    let { from: i12, to: n14 } = s212.ranges[e7];
    if (i12 <= t8 && n14 >= t8) return x.create(s212.ranges.slice(0, e7).concat(s212.ranges.slice(e7 + 1)), s212.mainIndex == e7 ? 0 : s212.mainIndex - (s212.mainIndex > e7 ? 1 : 0));
  }
  return null;
}
Y2.dragstart = (s212, t8) => {
  let { selection: { main: e7 } } = s212.state;
  if (t8.target.draggable) {
    let n14 = s212.docView.nearest(t8.target);
    if (n14 && n14.isWidget) {
      let o = n14.posAtStart, r2 = o + n14.length;
      (o >= e7.to || r2 <= e7.from) && (e7 = x.range(o, r2));
    }
  }
  let { inputState: i12 } = s212;
  return i12.mouseSelection && (i12.mouseSelection.dragging = true), i12.draggedContent = e7, t8.dataTransfer && (t8.dataTransfer.setData("Text", Fe2(s212.state, Ii, s212.state.sliceDoc(e7.from, e7.to))), t8.dataTransfer.effectAllowed = "copyMove"), false;
};
Y2.dragend = (s212) => (s212.inputState.draggedContent = null, false);
function ds(s212, t8, e7, i12) {
  if (e7 = Fe2(s212.state, zi, e7), !e7) return;
  let n14 = s212.posAtCoords({ x: t8.clientX, y: t8.clientY }, false), { draggedContent: o } = s212.inputState, r2 = i12 && o && qo(s212, t8) ? { from: o.from, to: o.to } : null, l11 = { from: n14, insert: e7 }, h3 = s212.state.changes(r2 ? [r2, l11] : l11);
  s212.focus(), s212.dispatch({ changes: h3, selection: { anchor: h3.mapPos(n14, -1), head: h3.mapPos(n14, 1) }, userEvent: r2 ? "move.drop" : "input.drop" }), s212.inputState.draggedContent = null;
}
Y2.drop = (s212, t8) => {
  if (!t8.dataTransfer) return false;
  if (s212.state.readOnly) return true;
  let e7 = t8.dataTransfer.files;
  if (e7 && e7.length) {
    let i12 = Array(e7.length), n14 = 0, o = () => {
      ++n14 == e7.length && ds(s212, t8, i12.filter((r2) => r2 != null).join(s212.state.lineBreak), false);
    };
    for (let r2 = 0; r2 < e7.length; r2++) {
      let l11 = new FileReader();
      l11.onerror = o, l11.onload = () => {
        /[\x00-\x08\x0e-\x1f]{2}/.test(l11.result) || (i12[r2] = l11.result), o();
      }, l11.readAsText(e7[r2]);
    }
    return true;
  } else {
    let i12 = t8.dataTransfer.getData("Text");
    if (i12) return ds(s212, t8, i12, true), true;
  }
  return false;
};
Y2.paste = (s212, t8) => {
  if (s212.state.readOnly) return true;
  s212.observer.flush();
  let e7 = kn ? null : t8.clipboardData;
  return e7 ? (An(s212, e7.getData("text/plain") || e7.getData("text/uri-list")), true) : (_o(s212), false);
};
function Qo(s212, t8) {
  let e7 = s212.dom.parentNode;
  if (!e7) return;
  let i12 = e7.appendChild(document.createElement("textarea"));
  i12.style.cssText = "position: fixed; left: -10000px; top: 10px", i12.value = t8, i12.focus(), i12.selectionEnd = t8.length, i12.selectionStart = 0, setTimeout(() => {
    i12.remove(), s212.focus();
  }, 50);
}
function Jo(s212) {
  let t8 = [], e7 = [], i12 = false;
  for (let n14 of s212.selection.ranges) n14.empty || (t8.push(s212.sliceDoc(n14.from, n14.to)), e7.push(n14));
  if (!t8.length) {
    let n14 = -1;
    for (let { from: o } of s212.selection.ranges) {
      let r2 = s212.doc.lineAt(o);
      r2.number > n14 && (t8.push(r2.text), e7.push({ from: r2.from, to: Math.min(s212.doc.length, r2.to + 1) })), n14 = r2.number;
    }
    i12 = true;
  }
  return { text: Fe2(s212, Ii, t8.join(s212.lineBreak)), ranges: e7, linewise: i12 };
}
var fi = null;
Y2.copy = Y2.cut = (s212, t8) => {
  let { text: e7, ranges: i12, linewise: n14 } = Jo(s212.state);
  if (!e7 && !n14) return false;
  fi = n14 ? e7 : null, t8.type == "cut" && !s212.state.readOnly && s212.dispatch({ changes: i12, scrollIntoView: true, userEvent: "delete.cut" });
  let o = kn ? null : t8.clipboardData;
  return o ? (o.clearData(), o.setData("text/plain", e7), true) : (Qo(s212, e7), false);
};
var On = J.define();
function Tn(s212, t8) {
  let e7 = [];
  for (let i12 of s212.facet(fn)) {
    let n14 = i12(s212, t8);
    n14 && e7.push(n14);
  }
  return e7 ? s212.update({ effects: e7, annotations: On.of(true) }) : null;
}
function Rn(s212) {
  setTimeout(() => {
    let t8 = s212.hasFocus;
    if (t8 != s212.inputState.notifiedFocused) {
      let e7 = Tn(s212.state, t8);
      e7 ? s212.dispatch(e7) : s212.update([]);
    }
  }, 10);
}
K2.focus = (s212) => {
  s212.inputState.lastFocusTime = Date.now(), !s212.scrollDOM.scrollTop && (s212.inputState.lastScrollTop || s212.inputState.lastScrollLeft) && (s212.scrollDOM.scrollTop = s212.inputState.lastScrollTop, s212.scrollDOM.scrollLeft = s212.inputState.lastScrollLeft), Rn(s212);
};
K2.blur = (s212) => {
  s212.observer.clearSelectionRange(), Rn(s212);
};
K2.compositionstart = K2.compositionupdate = (s212) => {
  s212.observer.editContext || (s212.inputState.compositionFirstChange == null && (s212.inputState.compositionFirstChange = true), s212.inputState.composing < 0 && (s212.inputState.composing = 0));
};
K2.compositionend = (s212) => {
  s212.observer.editContext || (s212.inputState.composing = -1, s212.inputState.compositionEndedAt = Date.now(), s212.inputState.compositionPendingKey = true, s212.inputState.compositionPendingChange = s212.observer.pendingRecords().length > 0, s212.inputState.compositionFirstChange = null, y3.chrome && y3.android ? s212.observer.flushSoon() : s212.inputState.compositionPendingChange ? Promise.resolve().then(() => s212.observer.flush()) : setTimeout(() => {
    s212.inputState.composing < 0 && s212.docView.hasComposition && s212.update([]);
  }, 50));
};
K2.contextmenu = (s212) => {
  s212.inputState.lastContextMenu = Date.now();
};
Y2.beforeinput = (s212, t8) => {
  var e7, i12;
  if (t8.inputType == "insertReplacementText" && s212.observer.editContext) {
    let o = (e7 = t8.dataTransfer) === null || e7 === void 0 ? void 0 : e7.getData("text/plain"), r2 = t8.getTargetRanges();
    if (o && r2.length) {
      let l11 = r2[0], h3 = s212.posAtDOM(l11.startContainer, l11.startOffset), c3 = s212.posAtDOM(l11.endContainer, l11.endOffset);
      return ji(s212, { from: h3, to: c3, insert: s212.state.toText(o) }, null), true;
    }
  }
  let n14;
  if (y3.chrome && y3.android && (n14 = Cn.find((o) => o.inputType == t8.inputType)) && (s212.observer.delayAndroidKey(n14.key, n14.keyCode), n14.key == "Backspace" || n14.key == "Delete")) {
    let o = ((i12 = window.visualViewport) === null || i12 === void 0 ? void 0 : i12.height) || 0;
    setTimeout(() => {
      var r2;
      (((r2 = window.visualViewport) === null || r2 === void 0 ? void 0 : r2.height) || 0) > o + 10 && s212.hasFocus && (s212.contentDOM.blur(), s212.focus());
    }, 100);
  }
  return y3.ios && t8.inputType == "deleteContentForward" && s212.observer.flushSoon(), y3.safari && t8.inputType == "insertText" && s212.inputState.composing >= 0 && setTimeout(() => K2.compositionend(s212, t8), 20), false;
};
var us = /* @__PURE__ */ new Set();
function Zo(s212) {
  us.has(s212) || (us.add(s212), s212.addEventListener("copy", () => {
  }), s212.addEventListener("cut", () => {
  }));
}
var ps = ["pre-wrap", "normal", "pre-line", "break-spaces"];
var mt = false;
function di() {
  mt = false;
}
var Ae2 = class {
  constructor(t8) {
    this.lineWrapping = t8, this.doc = m.empty, this.heightSamples = {}, this.lineHeight = 14, this.charWidth = 7, this.textHeight = 14, this.lineLength = 30;
  }
  heightForGap(t8, e7) {
    let i12 = this.doc.lineAt(e7).number - this.doc.lineAt(t8).number + 1;
    return this.lineWrapping && (i12 += Math.max(0, Math.ceil((e7 - t8 - i12 * this.lineLength * 0.5) / this.lineLength))), this.lineHeight * i12;
  }
  heightForLine(t8) {
    return this.lineWrapping ? (1 + Math.max(0, Math.ceil((t8 - this.lineLength) / (this.lineLength - 5)))) * this.lineHeight : this.lineHeight;
  }
  setDoc(t8) {
    return this.doc = t8, this;
  }
  mustRefreshForWrapping(t8) {
    return ps.indexOf(t8) > -1 != this.lineWrapping;
  }
  mustRefreshForHeights(t8) {
    let e7 = false;
    for (let i12 = 0; i12 < t8.length; i12++) {
      let n14 = t8[i12];
      n14 < 0 ? i12++ : this.heightSamples[Math.floor(n14 * 10)] || (e7 = true, this.heightSamples[Math.floor(n14 * 10)] = true);
    }
    return e7;
  }
  refresh(t8, e7, i12, n14, o, r2) {
    let l11 = ps.indexOf(t8) > -1, h3 = Math.round(e7) != Math.round(this.lineHeight) || this.lineWrapping != l11;
    if (this.lineWrapping = l11, this.lineHeight = e7, this.charWidth = i12, this.textHeight = n14, this.lineLength = o, h3) {
      this.heightSamples = {};
      for (let c3 = 0; c3 < r2.length; c3++) {
        let a2 = r2[c3];
        a2 < 0 ? c3++ : this.heightSamples[Math.floor(a2 * 10)] = true;
      }
    }
    return h3;
  }
};
var De2 = class {
  constructor(t8, e7) {
    this.from = t8, this.heights = e7, this.index = 0;
  }
  get more() {
    return this.index < this.heights.length;
  }
};
var X2 = class s36 {
  constructor(t8, e7, i12, n14, o) {
    this.from = t8, this.length = e7, this.top = i12, this.height = n14, this._content = o;
  }
  get type() {
    return typeof this._content == "number" ? F2.Text : Array.isArray(this._content) ? this._content : this._content.type;
  }
  get to() {
    return this.from + this.length;
  }
  get bottom() {
    return this.top + this.height;
  }
  get widget() {
    return this._content instanceof ht2 ? this._content.widget : null;
  }
  get widgetLineBreaks() {
    return typeof this._content == "number" ? this._content : 0;
  }
  join(t8) {
    let e7 = (Array.isArray(this._content) ? this._content : [this]).concat(Array.isArray(t8._content) ? t8._content : [t8]);
    return new s36(this.from, this.length + t8.length, this.top, this.height + t8.height, e7);
  }
};
var T3 = function(s212) {
  return s212[s212.ByPos = 0] = "ByPos", s212[s212.ByHeight = 1] = "ByHeight", s212[s212.ByPosNoHeight = 2] = "ByPosNoHeight", s212;
}(T3 || (T3 = {}));
var ge2 = 1e-3;
var z2 = class s37 {
  constructor(t8, e7, i12 = 2) {
    this.length = t8, this.height = e7, this.flags = i12;
  }
  get outdated() {
    return (this.flags & 2) > 0;
  }
  set outdated(t8) {
    this.flags = (t8 ? 2 : 0) | this.flags & -3;
  }
  setHeight(t8) {
    this.height != t8 && (Math.abs(this.height - t8) > ge2 && (mt = true), this.height = t8);
  }
  replace(t8, e7, i12) {
    return s37.of(i12);
  }
  decomposeLeft(t8, e7) {
    e7.push(this);
  }
  decomposeRight(t8, e7) {
    e7.push(this);
  }
  applyChanges(t8, e7, i12, n14) {
    let o = this, r2 = i12.doc;
    for (let l11 = n14.length - 1; l11 >= 0; l11--) {
      let { fromA: h3, toA: c3, fromB: a2, toB: f6 } = n14[l11], d4 = o.lineAt(h3, T3.ByPosNoHeight, i12.setDoc(e7), 0, 0), u3 = d4.to >= c3 ? d4 : o.lineAt(c3, T3.ByPosNoHeight, i12, 0, 0);
      for (f6 += u3.to - c3, c3 = u3.to; l11 > 0 && d4.from <= n14[l11 - 1].toA; ) h3 = n14[l11 - 1].fromA, a2 = n14[l11 - 1].fromB, l11--, h3 < d4.from && (d4 = o.lineAt(h3, T3.ByPosNoHeight, i12, 0, 0));
      a2 += d4.from - h3, h3 = d4.from;
      let p3 = pi.build(i12.setDoc(r2), t8, a2, f6);
      o = Oe2(o, o.replace(h3, c3, p3));
    }
    return o.updateHeight(i12, 0);
  }
  static empty() {
    return new I2(0, 0);
  }
  static of(t8) {
    if (t8.length == 1) return t8[0];
    let e7 = 0, i12 = t8.length, n14 = 0, o = 0;
    for (; ; ) if (e7 == i12) if (n14 > o * 2) {
      let l11 = t8[e7 - 1];
      l11.break ? t8.splice(--e7, 1, l11.left, null, l11.right) : t8.splice(--e7, 1, l11.left, l11.right), i12 += 1 + l11.break, n14 -= l11.size;
    } else if (o > n14 * 2) {
      let l11 = t8[i12];
      l11.break ? t8.splice(i12, 1, l11.left, null, l11.right) : t8.splice(i12, 1, l11.left, l11.right), i12 += 2 + l11.break, o -= l11.size;
    } else break;
    else if (n14 < o) {
      let l11 = t8[e7++];
      l11 && (n14 += l11.size);
    } else {
      let l11 = t8[--i12];
      l11 && (o += l11.size);
    }
    let r2 = 0;
    return t8[e7 - 1] == null ? (r2 = 1, e7--) : t8[e7] == null && (r2 = 1, i12++), new ui(s37.of(t8.slice(0, e7)), r2, s37.of(t8.slice(i12)));
  }
};
function Oe2(s212, t8) {
  return s212 == t8 ? s212 : (s212.constructor != t8.constructor && (mt = true), t8);
}
z2.prototype.size = 1;
var Te2 = class extends z2 {
  constructor(t8, e7, i12) {
    super(t8, e7), this.deco = i12;
  }
  blockAt(t8, e7, i12, n14) {
    return new X2(n14, this.length, i12, this.height, this.deco || 0);
  }
  lineAt(t8, e7, i12, n14, o) {
    return this.blockAt(0, i12, n14, o);
  }
  forEachLine(t8, e7, i12, n14, o, r2) {
    t8 <= o + this.length && e7 >= o && r2(this.blockAt(0, i12, n14, o));
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    return n14 && n14.from <= e7 && n14.more && this.setHeight(n14.heights[n14.index++]), this.outdated = false, this;
  }
  toString() {
    return `block(${this.length})`;
  }
};
var I2 = class s38 extends Te2 {
  constructor(t8, e7) {
    super(t8, e7, null), this.collapsed = 0, this.widgetHeight = 0, this.breaks = 0;
  }
  blockAt(t8, e7, i12, n14) {
    return new X2(n14, this.length, i12, this.height, this.breaks);
  }
  replace(t8, e7, i12) {
    let n14 = i12[0];
    return i12.length == 1 && (n14 instanceof s38 || n14 instanceof ot2 && n14.flags & 4) && Math.abs(this.length - n14.length) < 10 ? (n14 instanceof ot2 ? n14 = new s38(n14.length, this.height) : n14.height = this.height, this.outdated || (n14.outdated = false), n14) : z2.of(i12);
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    return n14 && n14.from <= e7 && n14.more ? this.setHeight(n14.heights[n14.index++]) : (i12 || this.outdated) && this.setHeight(Math.max(this.widgetHeight, t8.heightForLine(this.length - this.collapsed)) + this.breaks * t8.lineHeight), this.outdated = false, this;
  }
  toString() {
    return `line(${this.length}${this.collapsed ? -this.collapsed : ""}${this.widgetHeight ? ":" + this.widgetHeight : ""})`;
  }
};
var ot2 = class s39 extends z2 {
  constructor(t8) {
    super(t8, 0);
  }
  heightMetrics(t8, e7) {
    let i12 = t8.doc.lineAt(e7).number, n14 = t8.doc.lineAt(e7 + this.length).number, o = n14 - i12 + 1, r2, l11 = 0;
    if (t8.lineWrapping) {
      let h3 = Math.min(this.height, t8.lineHeight * o);
      r2 = h3 / o, this.length > o + 1 && (l11 = (this.height - h3) / (this.length - o - 1));
    } else r2 = this.height / o;
    return { firstLine: i12, lastLine: n14, perLine: r2, perChar: l11 };
  }
  blockAt(t8, e7, i12, n14) {
    let { firstLine: o, lastLine: r2, perLine: l11, perChar: h3 } = this.heightMetrics(e7, n14);
    if (e7.lineWrapping) {
      let c3 = n14 + (t8 < e7.lineHeight ? 0 : Math.round(Math.max(0, Math.min(1, (t8 - i12) / this.height)) * this.length)), a2 = e7.doc.lineAt(c3), f6 = l11 + a2.length * h3, d4 = Math.max(i12, t8 - f6 / 2);
      return new X2(a2.from, a2.length, d4, f6, 0);
    } else {
      let c3 = Math.max(0, Math.min(r2 - o, Math.floor((t8 - i12) / l11))), { from: a2, length: f6 } = e7.doc.line(o + c3);
      return new X2(a2, f6, i12 + l11 * c3, l11, 0);
    }
  }
  lineAt(t8, e7, i12, n14, o) {
    if (e7 == T3.ByHeight) return this.blockAt(t8, i12, n14, o);
    if (e7 == T3.ByPosNoHeight) {
      let { from: u3, to: p3 } = i12.doc.lineAt(t8);
      return new X2(u3, p3 - u3, 0, 0, 0);
    }
    let { firstLine: r2, perLine: l11, perChar: h3 } = this.heightMetrics(i12, o), c3 = i12.doc.lineAt(t8), a2 = l11 + c3.length * h3, f6 = c3.number - r2, d4 = n14 + l11 * f6 + h3 * (c3.from - o - f6);
    return new X2(c3.from, c3.length, Math.max(n14, Math.min(d4, n14 + this.height - a2)), a2, 0);
  }
  forEachLine(t8, e7, i12, n14, o, r2) {
    t8 = Math.max(t8, o), e7 = Math.min(e7, o + this.length);
    let { firstLine: l11, perLine: h3, perChar: c3 } = this.heightMetrics(i12, o);
    for (let a2 = t8, f6 = n14; a2 <= e7; ) {
      let d4 = i12.doc.lineAt(a2);
      if (a2 == t8) {
        let p3 = d4.number - l11;
        f6 += h3 * p3 + c3 * (t8 - o - p3);
      }
      let u3 = h3 + c3 * d4.length;
      r2(new X2(d4.from, d4.length, f6, u3, 0)), f6 += u3, a2 = d4.to + 1;
    }
  }
  replace(t8, e7, i12) {
    let n14 = this.length - e7;
    if (n14 > 0) {
      let o = i12[i12.length - 1];
      o instanceof s39 ? i12[i12.length - 1] = new s39(o.length + n14) : i12.push(null, new s39(n14 - 1));
    }
    if (t8 > 0) {
      let o = i12[0];
      o instanceof s39 ? i12[0] = new s39(t8 + o.length) : i12.unshift(new s39(t8 - 1), null);
    }
    return z2.of(i12);
  }
  decomposeLeft(t8, e7) {
    e7.push(new s39(t8 - 1), null);
  }
  decomposeRight(t8, e7) {
    e7.push(null, new s39(this.length - t8 - 1));
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    let o = e7 + this.length;
    if (n14 && n14.from <= e7 + this.length && n14.more) {
      let r2 = [], l11 = Math.max(e7, n14.from), h3 = -1;
      for (n14.from > e7 && r2.push(new s39(n14.from - e7 - 1).updateHeight(t8, e7)); l11 <= o && n14.more; ) {
        let a2 = t8.doc.lineAt(l11).length;
        r2.length && r2.push(null);
        let f6 = n14.heights[n14.index++];
        h3 == -1 ? h3 = f6 : Math.abs(f6 - h3) >= ge2 && (h3 = -2);
        let d4 = new I2(a2, f6);
        d4.outdated = false, r2.push(d4), l11 += a2 + 1;
      }
      l11 <= o && r2.push(null, new s39(o - l11).updateHeight(t8, l11));
      let c3 = z2.of(r2);
      return (h3 < 0 || Math.abs(c3.height - this.height) >= ge2 || Math.abs(h3 - this.heightMetrics(t8, e7).perLine) >= ge2) && (mt = true), Oe2(this, c3);
    } else (i12 || this.outdated) && (this.setHeight(t8.heightForGap(e7, e7 + this.length)), this.outdated = false);
    return this;
  }
  toString() {
    return `gap(${this.length})`;
  }
};
var ui = class extends z2 {
  constructor(t8, e7, i12) {
    super(t8.length + e7 + i12.length, t8.height + i12.height, e7 | (t8.outdated || i12.outdated ? 2 : 0)), this.left = t8, this.right = i12, this.size = t8.size + i12.size;
  }
  get break() {
    return this.flags & 1;
  }
  blockAt(t8, e7, i12, n14) {
    let o = i12 + this.left.height;
    return t8 < o ? this.left.blockAt(t8, e7, i12, n14) : this.right.blockAt(t8, e7, o, n14 + this.left.length + this.break);
  }
  lineAt(t8, e7, i12, n14, o) {
    let r2 = n14 + this.left.height, l11 = o + this.left.length + this.break, h3 = e7 == T3.ByHeight ? t8 < r2 : t8 < l11, c3 = h3 ? this.left.lineAt(t8, e7, i12, n14, o) : this.right.lineAt(t8, e7, i12, r2, l11);
    if (this.break || (h3 ? c3.to < l11 : c3.from > l11)) return c3;
    let a2 = e7 == T3.ByPosNoHeight ? T3.ByPosNoHeight : T3.ByPos;
    return h3 ? c3.join(this.right.lineAt(l11, a2, i12, r2, l11)) : this.left.lineAt(l11, a2, i12, n14, o).join(c3);
  }
  forEachLine(t8, e7, i12, n14, o, r2) {
    let l11 = n14 + this.left.height, h3 = o + this.left.length + this.break;
    if (this.break) t8 < h3 && this.left.forEachLine(t8, e7, i12, n14, o, r2), e7 >= h3 && this.right.forEachLine(t8, e7, i12, l11, h3, r2);
    else {
      let c3 = this.lineAt(h3, T3.ByPos, i12, n14, o);
      t8 < c3.from && this.left.forEachLine(t8, c3.from - 1, i12, n14, o, r2), c3.to >= t8 && c3.from <= e7 && r2(c3), e7 > c3.to && this.right.forEachLine(c3.to + 1, e7, i12, l11, h3, r2);
    }
  }
  replace(t8, e7, i12) {
    let n14 = this.left.length + this.break;
    if (e7 < n14) return this.balanced(this.left.replace(t8, e7, i12), this.right);
    if (t8 > this.left.length) return this.balanced(this.left, this.right.replace(t8 - n14, e7 - n14, i12));
    let o = [];
    t8 > 0 && this.decomposeLeft(t8, o);
    let r2 = o.length;
    for (let l11 of i12) o.push(l11);
    if (t8 > 0 && gs(o, r2 - 1), e7 < this.length) {
      let l11 = o.length;
      this.decomposeRight(e7, o), gs(o, l11);
    }
    return z2.of(o);
  }
  decomposeLeft(t8, e7) {
    let i12 = this.left.length;
    if (t8 <= i12) return this.left.decomposeLeft(t8, e7);
    e7.push(this.left), this.break && (i12++, t8 >= i12 && e7.push(null)), t8 > i12 && this.right.decomposeLeft(t8 - i12, e7);
  }
  decomposeRight(t8, e7) {
    let i12 = this.left.length, n14 = i12 + this.break;
    if (t8 >= n14) return this.right.decomposeRight(t8 - n14, e7);
    t8 < i12 && this.left.decomposeRight(t8, e7), this.break && t8 < n14 && e7.push(null), e7.push(this.right);
  }
  balanced(t8, e7) {
    return t8.size > 2 * e7.size || e7.size > 2 * t8.size ? z2.of(this.break ? [t8, null, e7] : [t8, e7]) : (this.left = Oe2(this.left, t8), this.right = Oe2(this.right, e7), this.setHeight(t8.height + e7.height), this.outdated = t8.outdated || e7.outdated, this.size = t8.size + e7.size, this.length = t8.length + this.break + e7.length, this);
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    let { left: o, right: r2 } = this, l11 = e7 + o.length + this.break, h3 = null;
    return n14 && n14.from <= e7 + o.length && n14.more ? h3 = o = o.updateHeight(t8, e7, i12, n14) : o.updateHeight(t8, e7, i12), n14 && n14.from <= l11 + r2.length && n14.more ? h3 = r2 = r2.updateHeight(t8, l11, i12, n14) : r2.updateHeight(t8, l11, i12), h3 ? this.balanced(o, r2) : (this.height = this.left.height + this.right.height, this.outdated = false, this);
  }
  toString() {
    return this.left + (this.break ? " " : "-") + this.right;
  }
};
function gs(s212, t8) {
  let e7, i12;
  s212[t8] == null && (e7 = s212[t8 - 1]) instanceof ot2 && (i12 = s212[t8 + 1]) instanceof ot2 && s212.splice(t8 - 1, 3, new ot2(e7.length + 1 + i12.length));
}
var tr = 5;
var pi = class s40 {
  constructor(t8, e7) {
    this.pos = t8, this.oracle = e7, this.nodes = [], this.lineStart = -1, this.lineEnd = -1, this.covering = null, this.writtenTo = t8;
  }
  get isCovered() {
    return this.covering && this.nodes[this.nodes.length - 1] == this.covering;
  }
  span(t8, e7) {
    if (this.lineStart > -1) {
      let i12 = Math.min(e7, this.lineEnd), n14 = this.nodes[this.nodes.length - 1];
      n14 instanceof I2 ? n14.length += i12 - this.pos : (i12 > this.pos || !this.isCovered) && this.nodes.push(new I2(i12 - this.pos, -1)), this.writtenTo = i12, e7 > i12 && (this.nodes.push(null), this.writtenTo++, this.lineStart = -1);
    }
    this.pos = e7;
  }
  point(t8, e7, i12) {
    if (t8 < e7 || i12.heightRelevant) {
      let n14 = i12.widget ? i12.widget.estimatedHeight : 0, o = i12.widget ? i12.widget.lineBreaks : 0;
      n14 < 0 && (n14 = this.oracle.lineHeight);
      let r2 = e7 - t8;
      i12.block ? this.addBlock(new Te2(r2, n14, i12)) : (r2 || o || n14 >= tr) && this.addLineDeco(n14, o, r2);
    } else e7 > t8 && this.span(t8, e7);
    this.lineEnd > -1 && this.lineEnd < this.pos && (this.lineEnd = this.oracle.doc.lineAt(this.pos).to);
  }
  enterLine() {
    if (this.lineStart > -1) return;
    let { from: t8, to: e7 } = this.oracle.doc.lineAt(this.pos);
    this.lineStart = t8, this.lineEnd = e7, this.writtenTo < t8 && ((this.writtenTo < t8 - 1 || this.nodes[this.nodes.length - 1] == null) && this.nodes.push(this.blankContent(this.writtenTo, t8 - 1)), this.nodes.push(null)), this.pos > t8 && this.nodes.push(new I2(this.pos - t8, -1)), this.writtenTo = this.pos;
  }
  blankContent(t8, e7) {
    let i12 = new ot2(e7 - t8);
    return this.oracle.doc.lineAt(t8).to == e7 && (i12.flags |= 4), i12;
  }
  ensureLine() {
    this.enterLine();
    let t8 = this.nodes.length ? this.nodes[this.nodes.length - 1] : null;
    if (t8 instanceof I2) return t8;
    let e7 = new I2(0, -1);
    return this.nodes.push(e7), e7;
  }
  addBlock(t8) {
    this.enterLine();
    let e7 = t8.deco;
    e7 && e7.startSide > 0 && !this.isCovered && this.ensureLine(), this.nodes.push(t8), this.writtenTo = this.pos = this.pos + t8.length, e7 && e7.endSide > 0 && (this.covering = t8);
  }
  addLineDeco(t8, e7, i12) {
    let n14 = this.ensureLine();
    n14.length += i12, n14.collapsed += i12, n14.widgetHeight = Math.max(n14.widgetHeight, t8), n14.breaks += e7, this.writtenTo = this.pos = this.pos + i12;
  }
  finish(t8) {
    let e7 = this.nodes.length == 0 ? null : this.nodes[this.nodes.length - 1];
    this.lineStart > -1 && !(e7 instanceof I2) && !this.isCovered ? this.nodes.push(new I2(0, -1)) : (this.writtenTo < this.pos || e7 == null) && this.nodes.push(this.blankContent(this.writtenTo, this.pos));
    let i12 = t8;
    for (let n14 of this.nodes) n14 instanceof I2 && n14.updateHeight(this.oracle, i12), i12 += n14 ? n14.length : 1;
    return this.nodes;
  }
  static build(t8, e7, i12, n14) {
    let o = new s40(i12, t8);
    return T.spans(e7, i12, n14, o, 0), o.finish(i12);
  }
};
function er(s212, t8, e7) {
  let i12 = new gi();
  return T.compare(s212, t8, e7, i12, 0), i12.changes;
}
var gi = class {
  constructor() {
    this.changes = [];
  }
  compareRange() {
  }
  comparePoint(t8, e7, i12, n14) {
    (t8 < e7 || i12 && i12.heightRelevant || n14 && n14.heightRelevant) && ti(t8, e7, this.changes, 5);
  }
};
function ir(s212, t8) {
  let e7 = s212.getBoundingClientRect(), i12 = s212.ownerDocument, n14 = i12.defaultView || window, o = Math.max(0, e7.left), r2 = Math.min(n14.innerWidth, e7.right), l11 = Math.max(0, e7.top), h3 = Math.min(n14.innerHeight, e7.bottom);
  for (let c3 = s212.parentNode; c3 && c3 != i12.body; ) if (c3.nodeType == 1) {
    let a2 = c3, f6 = window.getComputedStyle(a2);
    if ((a2.scrollHeight > a2.clientHeight || a2.scrollWidth > a2.clientWidth) && f6.overflow != "visible") {
      let d4 = a2.getBoundingClientRect();
      o = Math.max(o, d4.left), r2 = Math.min(r2, d4.right), l11 = Math.max(l11, d4.top), h3 = Math.min(c3 == s212.parentNode ? n14.innerHeight : h3, d4.bottom);
    }
    c3 = f6.position == "absolute" || f6.position == "fixed" ? a2.offsetParent : a2.parentNode;
  } else if (c3.nodeType == 11) c3 = c3.host;
  else break;
  return { left: o - e7.left, right: Math.max(o, r2) - e7.left, top: l11 - (e7.top + t8), bottom: Math.max(l11, h3) - (e7.top + t8) };
}
function sr(s212, t8) {
  let e7 = s212.getBoundingClientRect();
  return { left: 0, right: e7.right - e7.left, top: t8, bottom: e7.bottom - (e7.top + t8) };
}
var It = class {
  constructor(t8, e7, i12, n14) {
    this.from = t8, this.to = e7, this.size = i12, this.displaySize = n14;
  }
  static same(t8, e7) {
    if (t8.length != e7.length) return false;
    for (let i12 = 0; i12 < t8.length; i12++) {
      let n14 = t8[i12], o = e7[i12];
      if (n14.from != o.from || n14.to != o.to || n14.size != o.size) return false;
    }
    return true;
  }
  draw(t8, e7) {
    return O2.replace({ widget: new mi(this.displaySize * (e7 ? t8.scaleY : t8.scaleX), e7) }).range(this.from, this.to);
  }
};
var mi = class extends lt2 {
  constructor(t8, e7) {
    super(), this.size = t8, this.vertical = e7;
  }
  eq(t8) {
    return t8.size == this.size && t8.vertical == this.vertical;
  }
  toDOM() {
    let t8 = document.createElement("div");
    return this.vertical ? t8.style.height = this.size + "px" : (t8.style.width = this.size + "px", t8.style.height = "2px", t8.style.display = "inline-block"), t8;
  }
  get estimatedHeight() {
    return this.vertical ? this.size : -1;
  }
};
var Re2 = class {
  constructor(t8) {
    this.state = t8, this.pixelViewport = { left: 0, right: window.innerWidth, top: 0, bottom: 0 }, this.inView = true, this.paddingTop = 0, this.paddingBottom = 0, this.contentDOMWidth = 0, this.contentDOMHeight = 0, this.editorHeight = 0, this.editorWidth = 0, this.scrollTop = 0, this.scrolledToBottom = false, this.scaleX = 1, this.scaleY = 1, this.scrollAnchorPos = 0, this.scrollAnchorHeight = -1, this.scaler = ms, this.scrollTarget = null, this.printing = false, this.mustMeasureContent = true, this.defaultTextDirection = L2.LTR, this.visibleRanges = [], this.mustEnforceCursorAssoc = false;
    let e7 = t8.facet(Ve2).some((i12) => typeof i12 != "function" && i12.class == "cm-lineWrapping");
    this.heightOracle = new Ae2(e7), this.stateDeco = t8.facet(Ut).filter((i12) => typeof i12 != "function"), this.heightMap = z2.empty().applyChanges(this.stateDeco, m.empty, this.heightOracle.setDoc(t8.doc), [new j2(0, 0, 0, t8.doc.length)]);
    for (let i12 = 0; i12 < 2 && (this.viewport = this.getViewport(0, null), !!this.updateForViewport()); i12++) ;
    this.updateViewportLines(), this.lineGaps = this.ensureLineGaps([]), this.lineGapDeco = O2.set(this.lineGaps.map((i12) => i12.draw(this, false))), this.computeVisibleRanges();
  }
  updateForViewport() {
    let t8 = [this.viewport], { main: e7 } = this.state.selection;
    for (let i12 = 0; i12 <= 1; i12++) {
      let n14 = i12 ? e7.head : e7.anchor;
      if (!t8.some(({ from: o, to: r2 }) => n14 >= o && n14 <= r2)) {
        let { from: o, to: r2 } = this.lineBlockAt(n14);
        t8.push(new xt(o, r2));
      }
    }
    return this.viewports = t8.sort((i12, n14) => i12.from - n14.from), this.updateScaler();
  }
  updateScaler() {
    let t8 = this.scaler;
    return this.scaler = this.heightMap.height <= 7e6 ? ms : new bi(this.heightOracle, this.heightMap, this.viewports), t8.eq(this.scaler) ? 0 : 2;
  }
  updateViewportLines() {
    this.viewportLines = [], this.heightMap.forEachLine(this.viewport.from, this.viewport.to, this.heightOracle.setDoc(this.state.doc), 0, 0, (t8) => {
      this.viewportLines.push(Pt(t8, this.scaler));
    });
  }
  update(t8, e7 = null) {
    this.state = t8.state;
    let i12 = this.stateDeco;
    this.stateDeco = this.state.facet(Ut).filter((a2) => typeof a2 != "function");
    let n14 = t8.changedRanges, o = j2.extendWithRanges(n14, er(i12, this.stateDeco, t8 ? t8.changes : A.empty(this.state.doc.length))), r2 = this.heightMap.height, l11 = this.scrolledToBottom ? null : this.scrollAnchorAt(this.scrollTop);
    di(), this.heightMap = this.heightMap.applyChanges(this.stateDeco, t8.startState.doc, this.heightOracle.setDoc(this.state.doc), o), (this.heightMap.height != r2 || mt) && (t8.flags |= 2), l11 ? (this.scrollAnchorPos = t8.changes.mapPos(l11.from, -1), this.scrollAnchorHeight = l11.top) : (this.scrollAnchorPos = -1, this.scrollAnchorHeight = this.heightMap.height);
    let h3 = o.length ? this.mapViewport(this.viewport, t8.changes) : this.viewport;
    (e7 && (e7.range.head < h3.from || e7.range.head > h3.to) || !this.viewportIsAppropriate(h3)) && (h3 = this.getViewport(0, e7));
    let c3 = h3.from != this.viewport.from || h3.to != this.viewport.to;
    this.viewport = h3, t8.flags |= this.updateForViewport(), (c3 || !t8.changes.empty || t8.flags & 2) && this.updateViewportLines(), (this.lineGaps.length || this.viewport.to - this.viewport.from > 4e3) && this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps, t8.changes))), t8.flags |= this.computeVisibleRanges(), e7 && (this.scrollTarget = e7), !this.mustEnforceCursorAssoc && t8.selectionSet && t8.view.lineWrapping && t8.state.selection.main.empty && t8.state.selection.main.assoc && !t8.state.facet(un) && (this.mustEnforceCursorAssoc = true);
  }
  measure(t8) {
    let e7 = t8.contentDOM, i12 = window.getComputedStyle(e7), n14 = this.heightOracle, o = i12.whiteSpace;
    this.defaultTextDirection = i12.direction == "rtl" ? L2.RTL : L2.LTR;
    let r2 = this.heightOracle.mustRefreshForWrapping(o), l11 = e7.getBoundingClientRect(), h3 = r2 || this.mustMeasureContent || this.contentDOMHeight != l11.height;
    this.contentDOMHeight = l11.height, this.mustMeasureContent = false;
    let c3 = 0, a2 = 0;
    if (l11.width && l11.height) {
      let { scaleX: x11, scaleY: S17 } = Fs(e7, l11);
      (x11 > 5e-3 && Math.abs(this.scaleX - x11) > 5e-3 || S17 > 5e-3 && Math.abs(this.scaleY - S17) > 5e-3) && (this.scaleX = x11, this.scaleY = S17, c3 |= 8, r2 = h3 = true);
    }
    let f6 = (parseInt(i12.paddingTop) || 0) * this.scaleY, d4 = (parseInt(i12.paddingBottom) || 0) * this.scaleY;
    (this.paddingTop != f6 || this.paddingBottom != d4) && (this.paddingTop = f6, this.paddingBottom = d4, c3 |= 10), this.editorWidth != t8.scrollDOM.clientWidth && (n14.lineWrapping && (h3 = true), this.editorWidth = t8.scrollDOM.clientWidth, c3 |= 8);
    let u3 = t8.scrollDOM.scrollTop * this.scaleY;
    this.scrollTop != u3 && (this.scrollAnchorHeight = -1, this.scrollTop = u3), this.scrolledToBottom = Is(t8.scrollDOM);
    let p3 = (this.printing ? sr : ir)(e7, this.paddingTop), g8 = p3.top - this.pixelViewport.top, b12 = p3.bottom - this.pixelViewport.bottom;
    this.pixelViewport = p3;
    let m11 = this.pixelViewport.bottom > this.pixelViewport.top && this.pixelViewport.right > this.pixelViewport.left;
    if (m11 != this.inView && (this.inView = m11, m11 && (h3 = true)), !this.inView && !this.scrollTarget) return 0;
    let w14 = l11.width;
    if ((this.contentDOMWidth != w14 || this.editorHeight != t8.scrollDOM.clientHeight) && (this.contentDOMWidth = l11.width, this.editorHeight = t8.scrollDOM.clientHeight, c3 |= 8), h3) {
      let x11 = t8.docView.measureVisibleLineHeights(this.viewport);
      if (n14.mustRefreshForHeights(x11) && (r2 = true), r2 || n14.lineWrapping && Math.abs(w14 - this.contentDOMWidth) > n14.charWidth) {
        let { lineHeight: S17, charWidth: C11, textHeight: E11 } = t8.docView.measureTextSize();
        r2 = S17 > 0 && n14.refresh(o, S17, C11, E11, w14 / C11, x11), r2 && (t8.docView.minWidth = 0, c3 |= 8);
      }
      g8 > 0 && b12 > 0 ? a2 = Math.max(g8, b12) : g8 < 0 && b12 < 0 && (a2 = Math.min(g8, b12)), di();
      for (let S17 of this.viewports) {
        let C11 = S17.from == this.viewport.from ? x11 : t8.docView.measureVisibleLineHeights(S17);
        this.heightMap = (r2 ? z2.empty().applyChanges(this.stateDeco, m.empty, this.heightOracle, [new j2(0, 0, 0, t8.state.doc.length)]) : this.heightMap).updateHeight(n14, 0, r2, new De2(S17.from, C11));
      }
      mt && (c3 |= 2);
    }
    let v10 = !this.viewportIsAppropriate(this.viewport, a2) || this.scrollTarget && (this.scrollTarget.range.head < this.viewport.from || this.scrollTarget.range.head > this.viewport.to);
    return v10 && (c3 & 2 && (c3 |= this.updateScaler()), this.viewport = this.getViewport(a2, this.scrollTarget), c3 |= this.updateForViewport()), (c3 & 2 || v10) && this.updateViewportLines(), (this.lineGaps.length || this.viewport.to - this.viewport.from > 4e3) && this.updateLineGaps(this.ensureLineGaps(r2 ? [] : this.lineGaps, t8)), c3 |= this.computeVisibleRanges(), this.mustEnforceCursorAssoc && (this.mustEnforceCursorAssoc = false, t8.docView.enforceCursorAssoc()), c3;
  }
  get visibleTop() {
    return this.scaler.fromDOM(this.pixelViewport.top);
  }
  get visibleBottom() {
    return this.scaler.fromDOM(this.pixelViewport.bottom);
  }
  getViewport(t8, e7) {
    let i12 = 0.5 - Math.max(-0.5, Math.min(0.5, t8 / 1e3 / 2)), n14 = this.heightMap, o = this.heightOracle, { visibleTop: r2, visibleBottom: l11 } = this, h3 = new xt(n14.lineAt(r2 - i12 * 1e3, T3.ByHeight, o, 0, 0).from, n14.lineAt(l11 + (1 - i12) * 1e3, T3.ByHeight, o, 0, 0).to);
    if (e7) {
      let { head: c3 } = e7.range;
      if (c3 < h3.from || c3 > h3.to) {
        let a2 = Math.min(this.editorHeight, this.pixelViewport.bottom - this.pixelViewport.top), f6 = n14.lineAt(c3, T3.ByPos, o, 0, 0), d4;
        e7.y == "center" ? d4 = (f6.top + f6.bottom) / 2 - a2 / 2 : e7.y == "start" || e7.y == "nearest" && c3 < h3.from ? d4 = f6.top : d4 = f6.bottom - a2, h3 = new xt(n14.lineAt(d4 - 1e3 / 2, T3.ByHeight, o, 0, 0).from, n14.lineAt(d4 + a2 + 1e3 / 2, T3.ByHeight, o, 0, 0).to);
      }
    }
    return h3;
  }
  mapViewport(t8, e7) {
    let i12 = e7.mapPos(t8.from, -1), n14 = e7.mapPos(t8.to, 1);
    return new xt(this.heightMap.lineAt(i12, T3.ByPos, this.heightOracle, 0, 0).from, this.heightMap.lineAt(n14, T3.ByPos, this.heightOracle, 0, 0).to);
  }
  viewportIsAppropriate({ from: t8, to: e7 }, i12 = 0) {
    if (!this.inView) return true;
    let { top: n14 } = this.heightMap.lineAt(t8, T3.ByPos, this.heightOracle, 0, 0), { bottom: o } = this.heightMap.lineAt(e7, T3.ByPos, this.heightOracle, 0, 0), { visibleTop: r2, visibleBottom: l11 } = this;
    return (t8 == 0 || n14 <= r2 - Math.max(10, Math.min(-i12, 250))) && (e7 == this.state.doc.length || o >= l11 + Math.max(10, Math.min(i12, 250))) && n14 > r2 - 2 * 1e3 && o < l11 + 2 * 1e3;
  }
  mapLineGaps(t8, e7) {
    if (!t8.length || e7.empty) return t8;
    let i12 = [];
    for (let n14 of t8) e7.touchesRange(n14.from, n14.to) || i12.push(new It(e7.mapPos(n14.from), e7.mapPos(n14.to), n14.size, n14.displaySize));
    return i12;
  }
  ensureLineGaps(t8, e7) {
    let i12 = this.heightOracle.lineWrapping, n14 = i12 ? 1e4 : 2e3, o = n14 >> 1, r2 = n14 << 1;
    if (this.defaultTextDirection != L2.LTR && !i12) return [];
    let l11 = [], h3 = (a2, f6, d4, u3) => {
      if (f6 - a2 < o) return;
      let p3 = this.state.selection.main, g8 = [p3.from];
      p3.empty || g8.push(p3.to);
      for (let m11 of g8) if (m11 > a2 && m11 < f6) {
        h3(a2, m11 - 10, d4, u3), h3(m11 + 10, f6, d4, u3);
        return;
      }
      let b12 = or(t8, (m11) => m11.from >= d4.from && m11.to <= d4.to && Math.abs(m11.from - a2) < o && Math.abs(m11.to - f6) < o && !g8.some((w14) => m11.from < w14 && m11.to > w14));
      if (!b12) {
        if (f6 < d4.to && e7 && i12 && e7.visibleRanges.some((v10) => v10.from <= f6 && v10.to >= f6)) {
          let v10 = e7.moveToLineBoundary(x.cursor(f6), false, true).head;
          v10 > a2 && (f6 = v10);
        }
        let m11 = this.gapSize(d4, a2, f6, u3), w14 = i12 || m11 < 2e6 ? m11 : 2e6;
        b12 = new It(a2, f6, m11, w14);
      }
      l11.push(b12);
    }, c3 = (a2) => {
      if (a2.length < r2 || a2.type != F2.Text) return;
      let f6 = nr(a2.from, a2.to, this.stateDeco);
      if (f6.total < r2) return;
      let d4 = this.scrollTarget ? this.scrollTarget.range.head : null, u3, p3;
      if (i12) {
        let g8 = n14 / this.heightOracle.lineLength * this.heightOracle.lineHeight, b12, m11;
        if (d4 != null) {
          let w14 = ae2(f6, d4), v10 = ((this.visibleBottom - this.visibleTop) / 2 + g8) / a2.height;
          b12 = w14 - v10, m11 = w14 + v10;
        } else b12 = (this.visibleTop - a2.top - g8) / a2.height, m11 = (this.visibleBottom - a2.top + g8) / a2.height;
        u3 = he(f6, b12), p3 = he(f6, m11);
      } else {
        let g8 = f6.total * this.heightOracle.charWidth, b12 = n14 * this.heightOracle.charWidth, m11 = 0;
        if (g8 > 2e6) for (let C11 of t8) C11.from >= a2.from && C11.from < a2.to && C11.size != C11.displaySize && C11.from * this.heightOracle.charWidth + m11 < this.pixelViewport.left && (m11 = C11.size - C11.displaySize);
        let w14 = this.pixelViewport.left + m11, v10 = this.pixelViewport.right + m11, x11, S17;
        if (d4 != null) {
          let C11 = ae2(f6, d4), E11 = ((v10 - w14) / 2 + b12) / g8;
          x11 = C11 - E11, S17 = C11 + E11;
        } else x11 = (w14 - b12) / g8, S17 = (v10 + b12) / g8;
        u3 = he(f6, x11), p3 = he(f6, S17);
      }
      u3 > a2.from && h3(a2.from, u3, a2, f6), p3 < a2.to && h3(p3, a2.to, a2, f6);
    };
    for (let a2 of this.viewportLines) Array.isArray(a2.type) ? a2.type.forEach(c3) : c3(a2);
    return l11;
  }
  gapSize(t8, e7, i12, n14) {
    let o = ae2(n14, i12) - ae2(n14, e7);
    return this.heightOracle.lineWrapping ? t8.height * o : n14.total * this.heightOracle.charWidth * o;
  }
  updateLineGaps(t8) {
    It.same(t8, this.lineGaps) || (this.lineGaps = t8, this.lineGapDeco = O2.set(t8.map((e7) => e7.draw(this, this.heightOracle.lineWrapping))));
  }
  computeVisibleRanges() {
    let t8 = this.stateDeco;
    this.lineGaps.length && (t8 = t8.concat(this.lineGapDeco));
    let e7 = [];
    T.spans(t8, this.viewport.from, this.viewport.to, { span(n14, o) {
      e7.push({ from: n14, to: o });
    }, point() {
    } }, 20);
    let i12 = e7.length != this.visibleRanges.length || this.visibleRanges.some((n14, o) => n14.from != e7[o].from || n14.to != e7[o].to);
    return this.visibleRanges = e7, i12 ? 4 : 0;
  }
  lineBlockAt(t8) {
    return t8 >= this.viewport.from && t8 <= this.viewport.to && this.viewportLines.find((e7) => e7.from <= t8 && e7.to >= t8) || Pt(this.heightMap.lineAt(t8, T3.ByPos, this.heightOracle, 0, 0), this.scaler);
  }
  lineBlockAtHeight(t8) {
    return t8 >= this.viewportLines[0].top && t8 <= this.viewportLines[this.viewportLines.length - 1].bottom && this.viewportLines.find((e7) => e7.top <= t8 && e7.bottom >= t8) || Pt(this.heightMap.lineAt(this.scaler.fromDOM(t8), T3.ByHeight, this.heightOracle, 0, 0), this.scaler);
  }
  scrollAnchorAt(t8) {
    let e7 = this.lineBlockAtHeight(t8 + 8);
    return e7.from >= this.viewport.from || this.viewportLines[0].top - t8 > 200 ? e7 : this.viewportLines[0];
  }
  elementAtHeight(t8) {
    return Pt(this.heightMap.blockAt(this.scaler.fromDOM(t8), this.heightOracle, 0, 0), this.scaler);
  }
  get docHeight() {
    return this.scaler.toDOM(this.heightMap.height);
  }
  get contentHeight() {
    return this.docHeight + this.paddingTop + this.paddingBottom;
  }
};
var xt = class {
  constructor(t8, e7) {
    this.from = t8, this.to = e7;
  }
};
function nr(s212, t8, e7) {
  let i12 = [], n14 = s212, o = 0;
  return T.spans(e7, s212, t8, { span() {
  }, point(r2, l11) {
    r2 > n14 && (i12.push({ from: n14, to: r2 }), o += r2 - n14), n14 = l11;
  } }, 20), n14 < t8 && (i12.push({ from: n14, to: t8 }), o += t8 - n14), { total: o, ranges: i12 };
}
function he({ total: s212, ranges: t8 }, e7) {
  if (e7 <= 0) return t8[0].from;
  if (e7 >= 1) return t8[t8.length - 1].to;
  let i12 = Math.floor(s212 * e7);
  for (let n14 = 0; ; n14++) {
    let { from: o, to: r2 } = t8[n14], l11 = r2 - o;
    if (i12 <= l11) return o + i12;
    i12 -= l11;
  }
}
function ae2(s212, t8) {
  let e7 = 0;
  for (let { from: i12, to: n14 } of s212.ranges) {
    if (t8 <= n14) {
      e7 += t8 - i12;
      break;
    }
    e7 += n14 - i12;
  }
  return e7 / s212.total;
}
function or(s212, t8) {
  for (let e7 of s212) if (t8(e7)) return e7;
}
var ms = { toDOM(s212) {
  return s212;
}, fromDOM(s212) {
  return s212;
}, scale: 1, eq(s212) {
  return s212 == this;
} };
var bi = class s41 {
  constructor(t8, e7, i12) {
    let n14 = 0, o = 0, r2 = 0;
    this.viewports = i12.map(({ from: l11, to: h3 }) => {
      let c3 = e7.lineAt(l11, T3.ByPos, t8, 0, 0).top, a2 = e7.lineAt(h3, T3.ByPos, t8, 0, 0).bottom;
      return n14 += a2 - c3, { from: l11, to: h3, top: c3, bottom: a2, domTop: 0, domBottom: 0 };
    }), this.scale = (7e6 - n14) / (e7.height - n14);
    for (let l11 of this.viewports) l11.domTop = r2 + (l11.top - o) * this.scale, r2 = l11.domBottom = l11.domTop + (l11.bottom - l11.top), o = l11.bottom;
  }
  toDOM(t8) {
    for (let e7 = 0, i12 = 0, n14 = 0; ; e7++) {
      let o = e7 < this.viewports.length ? this.viewports[e7] : null;
      if (!o || t8 < o.top) return n14 + (t8 - i12) * this.scale;
      if (t8 <= o.bottom) return o.domTop + (t8 - o.top);
      i12 = o.bottom, n14 = o.domBottom;
    }
  }
  fromDOM(t8) {
    for (let e7 = 0, i12 = 0, n14 = 0; ; e7++) {
      let o = e7 < this.viewports.length ? this.viewports[e7] : null;
      if (!o || t8 < o.domTop) return i12 + (t8 - n14) / this.scale;
      if (t8 <= o.domBottom) return o.top + (t8 - o.domTop);
      i12 = o.bottom, n14 = o.domBottom;
    }
  }
  eq(t8) {
    return t8 instanceof s41 ? this.scale == t8.scale && this.viewports.length == t8.viewports.length && this.viewports.every((e7, i12) => e7.from == t8.viewports[i12].from && e7.to == t8.viewports[i12].to) : false;
  }
};
function Pt(s212, t8) {
  if (t8.scale == 1) return s212;
  let e7 = t8.toDOM(s212.top), i12 = t8.toDOM(s212.bottom);
  return new X2(s212.from, s212.length, e7, i12 - e7, Array.isArray(s212._content) ? s212._content.map((n14) => Pt(n14, t8)) : s212._content);
}
var ce2 = y.define({ combine: (s212) => s212.join(" ") });
var yi = y.define({ combine: (s212) => s212.indexOf(true) > -1 });
var wi = b2.newName();
var En = b2.newName();
var Ln = b2.newName();
var Bn = { "&light": "." + En, "&dark": "." + Ln };
function xi(s212, t8, e7) {
  return new b2(t8, { finish(i12) {
    return /&/.test(i12) ? i12.replace(/&\w*/, (n14) => {
      if (n14 == "&") return s212;
      if (!e7 || !e7[n14]) throw new RangeError(`Unsupported selector: ${n14}`);
      return e7[n14];
    }) : s212 + " " + i12;
  } });
}
var rr = xi("." + wi, { "&": { position: "relative !important", boxSizing: "border-box", "&.cm-focused": { outline: "1px dotted #212121" }, display: "flex !important", flexDirection: "column" }, ".cm-scroller": { display: "flex !important", alignItems: "flex-start !important", fontFamily: "monospace", lineHeight: 1.4, height: "100%", overflowX: "auto", position: "relative", zIndex: 0, overflowAnchor: "none" }, ".cm-content": { margin: 0, flexGrow: 2, flexShrink: 0, display: "block", whiteSpace: "pre", wordWrap: "normal", boxSizing: "border-box", minHeight: "100%", padding: "4px 0", outline: "none", "&[contenteditable=true]": { WebkitUserModify: "read-write-plaintext-only" } }, ".cm-lineWrapping": { whiteSpace_fallback: "pre-wrap", whiteSpace: "break-spaces", wordBreak: "break-word", overflowWrap: "anywhere", flexShrink: 1 }, "&light .cm-content": { caretColor: "black" }, "&dark .cm-content": { caretColor: "white" }, ".cm-line": { display: "block", padding: "0 2px 0 6px" }, ".cm-layer": { position: "absolute", left: 0, top: 0, contain: "size style", "& > *": { position: "absolute" } }, "&light .cm-selectionBackground": { background: "#d9d9d9" }, "&dark .cm-selectionBackground": { background: "#222" }, "&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground": { background: "#d7d4f0" }, "&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground": { background: "#233" }, ".cm-cursorLayer": { pointerEvents: "none" }, "&.cm-focused > .cm-scroller > .cm-cursorLayer": { animation: "steps(1) cm-blink 1.2s infinite" }, "@keyframes cm-blink": { "0%": {}, "50%": { opacity: 0 }, "100%": {} }, "@keyframes cm-blink2": { "0%": {}, "50%": { opacity: 0 }, "100%": {} }, ".cm-cursor, .cm-dropCursor": { borderLeft: "1.2px solid black", marginLeft: "-0.6px", pointerEvents: "none" }, ".cm-cursor": { display: "none" }, "&dark .cm-cursor": { borderLeftColor: "#ddd" }, ".cm-dropCursor": { position: "absolute" }, "&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor": { display: "block" }, ".cm-iso": { unicodeBidi: "isolate" }, ".cm-announced": { position: "fixed", top: "-10000px" }, "@media print": { ".cm-announced": { display: "none" } }, "&light .cm-activeLine": { backgroundColor: "#cceeff44" }, "&dark .cm-activeLine": { backgroundColor: "#99eeff33" }, "&light .cm-specialChar": { color: "red" }, "&dark .cm-specialChar": { color: "#f78" }, ".cm-gutters": { flexShrink: 0, display: "flex", height: "100%", boxSizing: "border-box", insetInlineStart: 0, zIndex: 200 }, "&light .cm-gutters": { backgroundColor: "#f5f5f5", color: "#6c6c6c", borderRight: "1px solid #ddd" }, "&dark .cm-gutters": { backgroundColor: "#333338", color: "#ccc" }, ".cm-gutter": { display: "flex !important", flexDirection: "column", flexShrink: 0, boxSizing: "border-box", minHeight: "100%", overflow: "hidden" }, ".cm-gutterElement": { boxSizing: "border-box" }, ".cm-lineNumbers .cm-gutterElement": { padding: "0 3px 0 5px", minWidth: "20px", textAlign: "right", whiteSpace: "nowrap" }, "&light .cm-activeLineGutter": { backgroundColor: "#e2f2ff" }, "&dark .cm-activeLineGutter": { backgroundColor: "#222227" }, ".cm-panels": { boxSizing: "border-box", position: "sticky", left: 0, right: 0, zIndex: 300 }, "&light .cm-panels": { backgroundColor: "#f5f5f5", color: "black" }, "&light .cm-panels-top": { borderBottom: "1px solid #ddd" }, "&light .cm-panels-bottom": { borderTop: "1px solid #ddd" }, "&dark .cm-panels": { backgroundColor: "#333338", color: "white" }, ".cm-tab": { display: "inline-block", overflow: "hidden", verticalAlign: "bottom" }, ".cm-widgetBuffer": { verticalAlign: "text-top", height: "1em", width: 0, display: "inline" }, ".cm-placeholder": { color: "#888", display: "inline-block", verticalAlign: "top" }, ".cm-highlightSpace": { backgroundImage: "radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)", backgroundPosition: "center" }, ".cm-highlightTab": { backgroundImage: `url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`, backgroundSize: "auto 100%", backgroundPosition: "right 90%", backgroundRepeat: "no-repeat" }, ".cm-trailingSpace": { backgroundColor: "#ff332255" }, ".cm-button": { verticalAlign: "middle", color: "inherit", fontSize: "70%", padding: ".2em 1em", borderRadius: "1px" }, "&light .cm-button": { backgroundImage: "linear-gradient(#eff1f5, #d9d9df)", border: "1px solid #888", "&:active": { backgroundImage: "linear-gradient(#b4b4b4, #d0d3d6)" } }, "&dark .cm-button": { backgroundImage: "linear-gradient(#393939, #111)", border: "1px solid #888", "&:active": { backgroundImage: "linear-gradient(#111, #333)" } }, ".cm-textfield": { verticalAlign: "middle", color: "inherit", fontSize: "70%", border: "1px solid silver", padding: ".2em .5em" }, "&light .cm-textfield": { backgroundColor: "white" }, "&dark .cm-textfield": { border: "1px solid #555", backgroundColor: "inherit" } }, Bn);
var lr = { childList: true, characterData: true, subtree: true, attributes: true, characterDataOldValue: true };
var qe2 = y3.ie && y3.ie_version <= 11;
var vi = class {
  constructor(t8) {
    this.view = t8, this.active = false, this.editContext = null, this.selectionRange = new Ge2(), this.selectionChanged = false, this.delayedFlush = -1, this.resizeTimeout = -1, this.queue = [], this.delayedAndroidKey = null, this.flushingAndroidKey = -1, this.lastChange = 0, this.scrollTargets = [], this.intersection = null, this.resizeScroll = null, this.intersecting = false, this.gapIntersection = null, this.gaps = [], this.printQuery = null, this.parentCheck = -1, this.dom = t8.contentDOM, this.observer = new MutationObserver((e7) => {
      for (let i12 of e7) this.queue.push(i12);
      (y3.ie && y3.ie_version <= 11 || y3.ios && t8.composing) && e7.some((i12) => i12.type == "childList" && i12.removedNodes.length || i12.type == "characterData" && i12.oldValue.length > i12.target.nodeValue.length) ? this.flushSoon() : this.flush();
    }), window.EditContext && t8.constructor.EDIT_CONTEXT !== false && !(y3.chrome && y3.chrome_version < 126) && (this.editContext = new Si(t8), t8.state.facet(st2) && (t8.contentDOM.editContext = this.editContext.editContext)), qe2 && (this.onCharData = (e7) => {
      this.queue.push({ target: e7.target, type: "characterData", oldValue: e7.prevValue }), this.flushSoon();
    }), this.onSelectionChange = this.onSelectionChange.bind(this), this.onResize = this.onResize.bind(this), this.onPrint = this.onPrint.bind(this), this.onScroll = this.onScroll.bind(this), window.matchMedia && (this.printQuery = window.matchMedia("print")), typeof ResizeObserver == "function" && (this.resizeScroll = new ResizeObserver(() => {
      var e7;
      ((e7 = this.view.docView) === null || e7 === void 0 ? void 0 : e7.lastUpdate) < Date.now() - 75 && this.onResize();
    }), this.resizeScroll.observe(t8.scrollDOM)), this.addWindowListeners(this.win = t8.win), this.start(), typeof IntersectionObserver == "function" && (this.intersection = new IntersectionObserver((e7) => {
      this.parentCheck < 0 && (this.parentCheck = setTimeout(this.listenForScroll.bind(this), 1e3)), e7.length > 0 && e7[e7.length - 1].intersectionRatio > 0 != this.intersecting && (this.intersecting = !this.intersecting, this.intersecting != this.view.inView && this.onScrollChanged(document.createEvent("Event")));
    }, { threshold: [0, 1e-3] }), this.intersection.observe(this.dom), this.gapIntersection = new IntersectionObserver((e7) => {
      e7.length > 0 && e7[e7.length - 1].intersectionRatio > 0 && this.onScrollChanged(document.createEvent("Event"));
    }, {})), this.listenForScroll(), this.readSelectionRange();
  }
  onScrollChanged(t8) {
    this.view.inputState.runHandlers("scroll", t8), this.intersecting && this.view.measure();
  }
  onScroll(t8) {
    this.intersecting && this.flush(false), this.editContext && this.view.requestMeasure(this.editContext.measureReq), this.onScrollChanged(t8);
  }
  onResize() {
    this.resizeTimeout < 0 && (this.resizeTimeout = setTimeout(() => {
      this.resizeTimeout = -1, this.view.requestMeasure();
    }, 50));
  }
  onPrint(t8) {
    (t8.type == "change" || !t8.type) && !t8.matches || (this.view.viewState.printing = true, this.view.measure(), setTimeout(() => {
      this.view.viewState.printing = false, this.view.requestMeasure();
    }, 500));
  }
  updateGaps(t8) {
    if (this.gapIntersection && (t8.length != this.gaps.length || this.gaps.some((e7, i12) => e7 != t8[i12]))) {
      this.gapIntersection.disconnect();
      for (let e7 of t8) this.gapIntersection.observe(e7);
      this.gaps = t8;
    }
  }
  onSelectionChange(t8) {
    let e7 = this.selectionChanged;
    if (!this.readSelectionRange() || this.delayedAndroidKey) return;
    let { view: i12 } = this, n14 = this.selectionRange;
    if (i12.state.facet(st2) ? i12.root.activeElement != this.dom : !ue2(this.dom, n14)) return;
    let o = n14.anchorNode && i12.docView.nearest(n14.anchorNode);
    if (o && o.ignoreEvent(t8)) {
      e7 || (this.selectionChanged = false);
      return;
    }
    (y3.ie && y3.ie_version <= 11 || y3.android && y3.chrome) && !i12.state.selection.main.empty && n14.focusNode && Vt(n14.focusNode, n14.focusOffset, n14.anchorNode, n14.anchorOffset) ? this.flushSoon() : this.flush(false);
  }
  readSelectionRange() {
    let { view: t8 } = this, e7 = jt(t8.root);
    if (!e7) return false;
    let i12 = y3.safari && t8.root.nodeType == 11 && t8.root.activeElement == this.dom && hr(this.view, e7) || e7;
    if (!i12 || this.selectionRange.eq(i12)) return false;
    let n14 = ue2(this.dom, i12);
    return n14 && !this.selectionChanged && t8.inputState.lastFocusTime > Date.now() - 200 && t8.inputState.lastTouchTime < Date.now() - 300 && no(this.dom, i12) ? (this.view.inputState.lastFocusTime = 0, t8.docView.updateSelection(), false) : (this.selectionRange.setRange(i12), n14 && (this.selectionChanged = true), true);
  }
  setSelectionRange(t8, e7) {
    this.selectionRange.set(t8.node, t8.offset, e7.node, e7.offset), this.selectionChanged = false;
  }
  clearSelectionRange() {
    this.selectionRange.set(null, 0, null, 0);
  }
  listenForScroll() {
    this.parentCheck = -1;
    let t8 = 0, e7 = null;
    for (let i12 = this.dom; i12; ) if (i12.nodeType == 1) !e7 && t8 < this.scrollTargets.length && this.scrollTargets[t8] == i12 ? t8++ : e7 || (e7 = this.scrollTargets.slice(0, t8)), e7 && e7.push(i12), i12 = i12.assignedSlot || i12.parentNode;
    else if (i12.nodeType == 11) i12 = i12.host;
    else break;
    if (t8 < this.scrollTargets.length && !e7 && (e7 = this.scrollTargets.slice(0, t8)), e7) {
      for (let i12 of this.scrollTargets) i12.removeEventListener("scroll", this.onScroll);
      for (let i12 of this.scrollTargets = e7) i12.addEventListener("scroll", this.onScroll);
    }
  }
  ignore(t8) {
    if (!this.active) return t8();
    try {
      return this.stop(), t8();
    } finally {
      this.start(), this.clear();
    }
  }
  start() {
    this.active || (this.observer.observe(this.dom, lr), qe2 && this.dom.addEventListener("DOMCharacterDataModified", this.onCharData), this.active = true);
  }
  stop() {
    this.active && (this.active = false, this.observer.disconnect(), qe2 && this.dom.removeEventListener("DOMCharacterDataModified", this.onCharData));
  }
  clear() {
    this.processRecords(), this.queue.length = 0, this.selectionChanged = false;
  }
  delayAndroidKey(t8, e7) {
    var i12;
    if (!this.delayedAndroidKey) {
      let n14 = () => {
        let o = this.delayedAndroidKey;
        o && (this.clearDelayedAndroidKey(), this.view.inputState.lastKeyCode = o.keyCode, this.view.inputState.lastKeyTime = Date.now(), !this.flush() && o.force && Mt(this.dom, o.key, o.keyCode));
      };
      this.flushingAndroidKey = this.view.win.requestAnimationFrame(n14);
    }
    (!this.delayedAndroidKey || t8 == "Enter") && (this.delayedAndroidKey = { key: t8, keyCode: e7, force: this.lastChange < Date.now() - 50 || !!(!((i12 = this.delayedAndroidKey) === null || i12 === void 0) && i12.force) });
  }
  clearDelayedAndroidKey() {
    this.win.cancelAnimationFrame(this.flushingAndroidKey), this.delayedAndroidKey = null, this.flushingAndroidKey = -1;
  }
  flushSoon() {
    this.delayedFlush < 0 && (this.delayedFlush = this.view.win.requestAnimationFrame(() => {
      this.delayedFlush = -1, this.flush();
    }));
  }
  forceFlush() {
    this.delayedFlush >= 0 && (this.view.win.cancelAnimationFrame(this.delayedFlush), this.delayedFlush = -1), this.flush();
  }
  pendingRecords() {
    for (let t8 of this.observer.takeRecords()) this.queue.push(t8);
    return this.queue;
  }
  processRecords() {
    let t8 = this.pendingRecords();
    t8.length && (this.queue = []);
    let e7 = -1, i12 = -1, n14 = false;
    for (let o of t8) {
      let r2 = this.readMutation(o);
      r2 && (r2.typeOver && (n14 = true), e7 == -1 ? { from: e7, to: i12 } = r2 : (e7 = Math.min(r2.from, e7), i12 = Math.max(r2.to, i12)));
    }
    return { from: e7, to: i12, typeOver: n14 };
  }
  readChange() {
    let { from: t8, to: e7, typeOver: i12 } = this.processRecords(), n14 = this.selectionChanged && ue2(this.dom, this.selectionRange);
    if (t8 < 0 && !n14) return null;
    t8 > -1 && (this.lastChange = Date.now()), this.view.inputState.lastFocusTime = 0, this.selectionChanged = false;
    let o = new hi(this.view, t8, e7, i12);
    return this.view.docView.domChanged = { newSel: o.newSel ? o.newSel.main : null }, o;
  }
  flush(t8 = true) {
    if (this.delayedFlush >= 0 || this.delayedAndroidKey) return false;
    t8 && this.readSelectionRange();
    let e7 = this.readChange();
    if (!e7) return this.view.requestMeasure(), false;
    let i12 = this.view.state, n14 = Sn(this.view, e7);
    return this.view.state == i12 && (e7.domChanged || e7.newSel && !e7.newSel.main.eq(this.view.state.selection.main)) && this.view.update([]), n14;
  }
  readMutation(t8) {
    let e7 = this.view.docView.nearest(t8.target);
    if (!e7 || e7.ignoreMutation(t8)) return null;
    if (e7.markDirty(t8.type == "attributes"), t8.type == "attributes" && (e7.flags |= 4), t8.type == "childList") {
      let i12 = bs(e7, t8.previousSibling || t8.target.previousSibling, -1), n14 = bs(e7, t8.nextSibling || t8.target.nextSibling, 1);
      return { from: i12 ? e7.posAfter(i12) : e7.posAtStart, to: n14 ? e7.posBefore(n14) : e7.posAtEnd, typeOver: false };
    } else return t8.type == "characterData" ? { from: e7.posAtStart, to: e7.posAtEnd, typeOver: t8.target.nodeValue == t8.oldValue } : null;
  }
  setWindow(t8) {
    t8 != this.win && (this.removeWindowListeners(this.win), this.win = t8, this.addWindowListeners(this.win));
  }
  addWindowListeners(t8) {
    t8.addEventListener("resize", this.onResize), this.printQuery ? this.printQuery.addEventListener ? this.printQuery.addEventListener("change", this.onPrint) : this.printQuery.addListener(this.onPrint) : t8.addEventListener("beforeprint", this.onPrint), t8.addEventListener("scroll", this.onScroll), t8.document.addEventListener("selectionchange", this.onSelectionChange);
  }
  removeWindowListeners(t8) {
    t8.removeEventListener("scroll", this.onScroll), t8.removeEventListener("resize", this.onResize), this.printQuery ? this.printQuery.removeEventListener ? this.printQuery.removeEventListener("change", this.onPrint) : this.printQuery.removeListener(this.onPrint) : t8.removeEventListener("beforeprint", this.onPrint), t8.document.removeEventListener("selectionchange", this.onSelectionChange);
  }
  update(t8) {
    this.editContext && (this.editContext.update(t8), t8.startState.facet(st2) != t8.state.facet(st2) && (t8.view.contentDOM.editContext = t8.state.facet(st2) ? this.editContext.editContext : null));
  }
  destroy() {
    var t8, e7, i12;
    this.stop(), (t8 = this.intersection) === null || t8 === void 0 || t8.disconnect(), (e7 = this.gapIntersection) === null || e7 === void 0 || e7.disconnect(), (i12 = this.resizeScroll) === null || i12 === void 0 || i12.disconnect();
    for (let n14 of this.scrollTargets) n14.removeEventListener("scroll", this.onScroll);
    this.removeWindowListeners(this.win), clearTimeout(this.parentCheck), clearTimeout(this.resizeTimeout), this.win.cancelAnimationFrame(this.delayedFlush), this.win.cancelAnimationFrame(this.flushingAndroidKey), this.editContext && (this.view.contentDOM.editContext = null, this.editContext.destroy());
  }
};
function bs(s212, t8, e7) {
  for (; t8; ) {
    let i12 = R2.get(t8);
    if (i12 && i12.parent == s212) return i12;
    let n14 = t8.parentNode;
    t8 = n14 != s212.dom ? n14 : e7 > 0 ? t8.nextSibling : t8.previousSibling;
  }
  return null;
}
function ys(s212, t8) {
  let e7 = t8.startContainer, i12 = t8.startOffset, n14 = t8.endContainer, o = t8.endOffset, r2 = s212.docView.domAtPos(s212.state.selection.main.anchor);
  return Vt(r2.node, r2.offset, n14, o) && ([e7, i12, n14, o] = [n14, o, e7, i12]), { anchorNode: e7, anchorOffset: i12, focusNode: n14, focusOffset: o };
}
function hr(s212, t8) {
  if (t8.getComposedRanges) {
    let n14 = t8.getComposedRanges(s212.root)[0];
    if (n14) return ys(s212, n14);
  }
  let e7 = null;
  function i12(n14) {
    n14.preventDefault(), n14.stopImmediatePropagation(), e7 = n14.getTargetRanges()[0];
  }
  return s212.contentDOM.addEventListener("beforeinput", i12, true), s212.dom.ownerDocument.execCommand("indent"), s212.contentDOM.removeEventListener("beforeinput", i12, true), e7 ? ys(s212, e7) : null;
}
var Si = class {
  constructor(t8) {
    this.from = 0, this.to = 0, this.pendingContextChange = null, this.handlers = /* @__PURE__ */ Object.create(null), this.composing = null, this.resetRange(t8.state);
    let e7 = this.editContext = new window.EditContext({ text: t8.state.doc.sliceString(this.from, this.to), selectionStart: this.toContextPos(Math.max(this.from, Math.min(this.to, t8.state.selection.main.anchor))), selectionEnd: this.toContextPos(t8.state.selection.main.head) });
    this.handlers.textupdate = (i12) => {
      let { anchor: n14 } = t8.state.selection.main, o = this.toEditorPos(i12.updateRangeStart), r2 = this.toEditorPos(i12.updateRangeEnd);
      t8.inputState.composing >= 0 && !this.composing && (this.composing = { contextBase: i12.updateRangeStart, editorBase: o, drifted: false });
      let l11 = { from: o, to: r2, insert: m.of(i12.text.split(`
`)) };
      l11.from == this.from && n14 < this.from ? l11.from = n14 : l11.to == this.to && n14 > this.to && (l11.to = n14), !(l11.from == l11.to && !l11.insert.length) && (this.pendingContextChange = l11, t8.state.readOnly || ji(t8, l11, x.single(this.toEditorPos(i12.selectionStart), this.toEditorPos(i12.selectionEnd))), this.pendingContextChange && (this.revertPending(t8.state), this.setSelection(t8.state)));
    }, this.handlers.characterboundsupdate = (i12) => {
      let n14 = [], o = null;
      for (let r2 = this.toEditorPos(i12.rangeStart), l11 = this.toEditorPos(i12.rangeEnd); r2 < l11; r2++) {
        let h3 = t8.coordsForChar(r2);
        o = h3 && new DOMRect(h3.left, h3.top, h3.right - h3.left, h3.bottom - h3.top) || o || new DOMRect(), n14.push(o);
      }
      e7.updateCharacterBounds(i12.rangeStart, n14);
    }, this.handlers.textformatupdate = (i12) => {
      let n14 = [];
      for (let o of i12.getTextFormats()) {
        let r2 = o.underlineStyle, l11 = o.underlineThickness;
        if (r2 != "None" && l11 != "None") {
          let h3 = `text-decoration: underline ${r2 == "Dashed" ? "dashed " : r2 == "Squiggle" ? "wavy " : ""}${l11 == "Thin" ? 1 : 2}px`;
          n14.push(O2.mark({ attributes: { style: h3 } }).range(this.toEditorPos(o.rangeStart), this.toEditorPos(o.rangeEnd)));
        }
      }
      t8.dispatch({ effects: gn.of(O2.set(n14)) });
    }, this.handlers.compositionstart = () => {
      t8.inputState.composing < 0 && (t8.inputState.composing = 0, t8.inputState.compositionFirstChange = true);
    }, this.handlers.compositionend = () => {
      if (t8.inputState.composing = -1, t8.inputState.compositionFirstChange = null, this.composing) {
        let { drifted: i12 } = this.composing;
        this.composing = null, i12 && this.reset(t8.state);
      }
    };
    for (let i12 in this.handlers) e7.addEventListener(i12, this.handlers[i12]);
    this.measureReq = { read: (i12) => {
      this.editContext.updateControlBounds(i12.contentDOM.getBoundingClientRect());
      let n14 = jt(i12.root);
      n14 && n14.rangeCount && this.editContext.updateSelectionBounds(n14.getRangeAt(0).getBoundingClientRect());
    } };
  }
  applyEdits(t8) {
    let e7 = 0, i12 = false, n14 = this.pendingContextChange;
    return t8.changes.iterChanges((o, r2, l11, h3, c3) => {
      if (i12) return;
      let a2 = c3.length - (r2 - o);
      if (n14 && r2 >= n14.to) if (n14.from == o && n14.to == r2 && n14.insert.eq(c3)) {
        n14 = this.pendingContextChange = null, e7 += a2, this.to += a2;
        return;
      } else n14 = null, this.revertPending(t8.state);
      if (o += e7, r2 += e7, r2 <= this.from) this.from += a2, this.to += a2;
      else if (o < this.to) {
        if (o < this.from || r2 > this.to || this.to - this.from + c3.length > 3e4) {
          i12 = true;
          return;
        }
        this.editContext.updateText(this.toContextPos(o), this.toContextPos(r2), c3.toString()), this.to += a2;
      }
      e7 += a2;
    }), n14 && !i12 && this.revertPending(t8.state), !i12;
  }
  update(t8) {
    let e7 = this.pendingContextChange;
    this.composing && (this.composing.drifted || t8.transactions.some((i12) => !i12.isUserEvent("input.type") && i12.changes.touchesRange(this.from, this.to))) ? (this.composing.drifted = true, this.composing.editorBase = t8.changes.mapPos(this.composing.editorBase)) : !this.applyEdits(t8) || !this.rangeIsValid(t8.state) ? (this.pendingContextChange = null, this.reset(t8.state)) : (t8.docChanged || t8.selectionSet || e7) && this.setSelection(t8.state), (t8.geometryChanged || t8.docChanged || t8.selectionSet) && t8.view.requestMeasure(this.measureReq);
  }
  resetRange(t8) {
    let { head: e7 } = t8.selection.main;
    this.from = Math.max(0, e7 - 1e4), this.to = Math.min(t8.doc.length, e7 + 1e4);
  }
  reset(t8) {
    this.resetRange(t8), this.editContext.updateText(0, this.editContext.text.length, t8.doc.sliceString(this.from, this.to)), this.setSelection(t8);
  }
  revertPending(t8) {
    let e7 = this.pendingContextChange;
    this.pendingContextChange = null, this.editContext.updateText(this.toContextPos(e7.from), this.toContextPos(e7.from + e7.insert.length), t8.doc.sliceString(e7.from, e7.to));
  }
  setSelection(t8) {
    let { main: e7 } = t8.selection, i12 = this.toContextPos(Math.max(this.from, Math.min(this.to, e7.anchor))), n14 = this.toContextPos(e7.head);
    (this.editContext.selectionStart != i12 || this.editContext.selectionEnd != n14) && this.editContext.updateSelection(i12, n14);
  }
  rangeIsValid(t8) {
    let { head: e7 } = t8.selection.main;
    return !(this.from > 0 && e7 - this.from < 500 || this.to < t8.doc.length && this.to - e7 < 500 || this.to - this.from > 1e4 * 3);
  }
  toEditorPos(t8) {
    let e7 = this.composing;
    return e7 && e7.drifted ? e7.editorBase + (t8 - e7.contextBase) : t8 + this.from;
  }
  toContextPos(t8) {
    let e7 = this.composing;
    return e7 && e7.drifted ? e7.contextBase + (t8 - e7.editorBase) : t8 - this.from;
  }
  destroy() {
    for (let t8 in this.handlers) this.editContext.removeEventListener(t8, this.handlers[t8]);
  }
};
var A2 = class s42 {
  get state() {
    return this.viewState.state;
  }
  get viewport() {
    return this.viewState.viewport;
  }
  get visibleRanges() {
    return this.viewState.visibleRanges;
  }
  get inView() {
    return this.viewState.inView;
  }
  get composing() {
    return this.inputState.composing > 0;
  }
  get compositionStarted() {
    return this.inputState.composing >= 0;
  }
  get root() {
    return this._root;
  }
  get win() {
    return this.dom.ownerDocument.defaultView || window;
  }
  constructor(t8 = {}) {
    var e7;
    this.plugins = [], this.pluginMap = /* @__PURE__ */ new Map(), this.editorAttrs = {}, this.contentAttrs = {}, this.bidiCache = [], this.destroyed = false, this.updateState = 2, this.measureScheduled = -1, this.measureRequests = [], this.contentDOM = document.createElement("div"), this.scrollDOM = document.createElement("div"), this.scrollDOM.tabIndex = -1, this.scrollDOM.className = "cm-scroller", this.scrollDOM.appendChild(this.contentDOM), this.announceDOM = document.createElement("div"), this.announceDOM.className = "cm-announced", this.announceDOM.setAttribute("aria-live", "polite"), this.dom = document.createElement("div"), this.dom.appendChild(this.announceDOM), this.dom.appendChild(this.scrollDOM), t8.parent && t8.parent.appendChild(this.dom);
    let { dispatch: i12 } = t8;
    this.dispatchTransactions = t8.dispatchTransactions || i12 && ((n14) => n14.forEach((o) => i12(o, this))) || ((n14) => this.update(n14)), this.dispatch = this.dispatch.bind(this), this._root = t8.root || so(t8.parent) || document, this.viewState = new Re2(t8.state || I.create(t8)), t8.scrollTo && t8.scrollTo.is(oe2) && (this.viewState.scrollTarget = t8.scrollTo.value.clip(this.viewState.state)), this.plugins = this.state.facet(Et).map((n14) => new zt(n14));
    for (let n14 of this.plugins) n14.update(this);
    this.observer = new vi(this), this.inputState = new ai(this), this.inputState.ensureHandlers(this.plugins), this.docView = new Me2(this), this.mountStyles(), this.updateAttrs(), this.updateState = 0, this.requestMeasure(), !((e7 = document.fonts) === null || e7 === void 0) && e7.ready && document.fonts.ready.then(() => this.requestMeasure());
  }
  dispatch(...t8) {
    let e7 = t8.length == 1 && t8[0] instanceof S ? t8 : t8.length == 1 && Array.isArray(t8[0]) ? t8[0] : [this.state.update(...t8)];
    this.dispatchTransactions(e7, this);
  }
  update(t8) {
    if (this.updateState != 0) throw new Error("Calls to EditorView.update are not allowed while an update is in progress");
    let e7 = false, i12 = false, n14, o = this.state;
    for (let d4 of t8) {
      if (d4.startState != o) throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");
      o = d4.state;
    }
    if (this.destroyed) {
      this.viewState.state = o;
      return;
    }
    let r2 = this.hasFocus, l11 = 0, h3 = null;
    t8.some((d4) => d4.annotation(On)) ? (this.inputState.notifiedFocused = r2, l11 = 1) : r2 != this.inputState.notifiedFocused && (this.inputState.notifiedFocused = r2, h3 = Tn(o, r2), h3 || (l11 = 1));
    let c3 = this.observer.delayedAndroidKey, a2 = null;
    if (c3 ? (this.observer.clearDelayedAndroidKey(), a2 = this.observer.readChange(), (a2 && !this.state.doc.eq(o.doc) || !this.state.selection.eq(o.selection)) && (a2 = null)) : this.observer.clear(), o.facet(I.phrases) != this.state.facet(I.phrases)) return this.setState(o);
    n14 = Ce2.create(this, o, t8), n14.flags |= l11;
    let f6 = this.viewState.scrollTarget;
    try {
      this.updateState = 2;
      for (let d4 of t8) {
        if (f6 && (f6 = f6.map(d4.changes)), d4.scrollIntoView) {
          let { main: u3 } = d4.state.selection;
          f6 = new Wt(u3.empty ? u3 : x.cursor(u3.head, u3.head > u3.anchor ? -1 : 1));
        }
        for (let u3 of d4.effects) u3.is(oe2) && (f6 = u3.value.clip(this.state));
      }
      this.viewState.update(n14, f6), this.bidiCache = Ee2.update(this.bidiCache, n14.changes), n14.empty || (this.updatePlugins(n14), this.inputState.update(n14)), e7 = this.docView.update(n14), this.state.facet(Lt) != this.styleModules && this.mountStyles(), i12 = this.updateAttrs(), this.showAnnouncements(t8), this.docView.updateSelection(e7, t8.some((d4) => d4.isUserEvent("select.pointer")));
    } finally {
      this.updateState = 0;
    }
    if (n14.startState.facet(ce2) != n14.state.facet(ce2) && (this.viewState.mustMeasureContent = true), (e7 || i12 || f6 || this.viewState.mustEnforceCursorAssoc || this.viewState.mustMeasureContent) && this.requestMeasure(), e7 && this.docViewUpdate(), !n14.empty) for (let d4 of this.state.facet(ni)) try {
      d4(n14);
    } catch (u3) {
      $2(this.state, u3, "update listener");
    }
    (h3 || a2) && Promise.resolve().then(() => {
      h3 && this.state == h3.startState && this.dispatch(h3), a2 && !Sn(this, a2) && c3.force && Mt(this.contentDOM, c3.key, c3.keyCode);
    });
  }
  setState(t8) {
    if (this.updateState != 0) throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");
    if (this.destroyed) {
      this.viewState.state = t8;
      return;
    }
    this.updateState = 2;
    let e7 = this.hasFocus;
    try {
      for (let i12 of this.plugins) i12.destroy(this);
      this.viewState = new Re2(t8), this.plugins = t8.facet(Et).map((i12) => new zt(i12)), this.pluginMap.clear();
      for (let i12 of this.plugins) i12.update(this);
      this.docView.destroy(), this.docView = new Me2(this), this.inputState.ensureHandlers(this.plugins), this.mountStyles(), this.updateAttrs(), this.bidiCache = [];
    } finally {
      this.updateState = 0;
    }
    e7 && this.focus(), this.requestMeasure();
  }
  updatePlugins(t8) {
    let e7 = t8.startState.facet(Et), i12 = t8.state.facet(Et);
    if (e7 != i12) {
      let n14 = [];
      for (let o of i12) {
        let r2 = e7.indexOf(o);
        if (r2 < 0) n14.push(new zt(o));
        else {
          let l11 = this.plugins[r2];
          l11.mustUpdate = t8, n14.push(l11);
        }
      }
      for (let o of this.plugins) o.mustUpdate != t8 && o.destroy(this);
      this.plugins = n14, this.pluginMap.clear();
    } else for (let n14 of this.plugins) n14.mustUpdate = t8;
    for (let n14 = 0; n14 < this.plugins.length; n14++) this.plugins[n14].update(this);
    e7 != i12 && this.inputState.ensureHandlers(this.plugins);
  }
  docViewUpdate() {
    for (let t8 of this.plugins) {
      let e7 = t8.value;
      if (e7 && e7.docViewUpdate) try {
        e7.docViewUpdate(this);
      } catch (i12) {
        $2(this.state, i12, "doc view update listener");
      }
    }
  }
  measure(t8 = true) {
    if (this.destroyed) return;
    if (this.measureScheduled > -1 && this.win.cancelAnimationFrame(this.measureScheduled), this.observer.delayedAndroidKey) {
      this.measureScheduled = -1, this.requestMeasure();
      return;
    }
    this.measureScheduled = 0, t8 && this.observer.forceFlush();
    let e7 = null, i12 = this.scrollDOM, n14 = i12.scrollTop * this.scaleY, { scrollAnchorPos: o, scrollAnchorHeight: r2 } = this.viewState;
    Math.abs(n14 - this.viewState.scrollTop) > 1 && (r2 = -1), this.viewState.scrollAnchorHeight = -1;
    try {
      for (let l11 = 0; ; l11++) {
        if (r2 < 0) if (Is(i12)) o = -1, r2 = this.viewState.heightMap.height;
        else {
          let u3 = this.viewState.scrollAnchorAt(n14);
          o = u3.from, r2 = u3.top;
        }
        this.updateState = 1;
        let h3 = this.viewState.measure(this);
        if (!h3 && !this.measureRequests.length && this.viewState.scrollTarget == null) break;
        if (l11 > 5) {
          console.warn(this.measureRequests.length ? "Measure loop restarted more than 5 times" : "Viewport failed to stabilize");
          break;
        }
        let c3 = [];
        h3 & 4 || ([this.measureRequests, c3] = [c3, this.measureRequests]);
        let a2 = c3.map((u3) => {
          try {
            return u3.read(this);
          } catch (p3) {
            return $2(this.state, p3), ws;
          }
        }), f6 = Ce2.create(this, this.state, []), d4 = false;
        f6.flags |= h3, e7 ? e7.flags |= h3 : e7 = f6, this.updateState = 2, f6.empty || (this.updatePlugins(f6), this.inputState.update(f6), this.updateAttrs(), d4 = this.docView.update(f6), d4 && this.docViewUpdate());
        for (let u3 = 0; u3 < c3.length; u3++) if (a2[u3] != ws) try {
          let p3 = c3[u3];
          p3.write && p3.write(a2[u3], this);
        } catch (p3) {
          $2(this.state, p3);
        }
        if (d4 && this.docView.updateSelection(true), !f6.viewportChanged && this.measureRequests.length == 0) {
          if (this.viewState.editorHeight) if (this.viewState.scrollTarget) {
            this.docView.scrollIntoView(this.viewState.scrollTarget), this.viewState.scrollTarget = null, r2 = -1;
            continue;
          } else {
            let p3 = (o < 0 ? this.viewState.heightMap.height : this.viewState.lineBlockAt(o).top) - r2;
            if (p3 > 1 || p3 < -1) {
              n14 = n14 + p3, i12.scrollTop = n14 / this.scaleY, r2 = -1;
              continue;
            }
          }
          break;
        }
      }
    } finally {
      this.updateState = 0, this.measureScheduled = -1;
    }
    if (e7 && !e7.empty) for (let l11 of this.state.facet(ni)) l11(e7);
  }
  get themeClasses() {
    return wi + " " + (this.state.facet(yi) ? Ln : En) + " " + this.state.facet(ce2);
  }
  updateAttrs() {
    let t8 = xs(this, mn, { class: "cm-editor" + (this.hasFocus ? " cm-focused " : " ") + this.themeClasses }), e7 = { spellcheck: "false", autocorrect: "off", autocapitalize: "off", translate: "no", contenteditable: this.state.facet(st2) ? "true" : "false", class: "cm-content", style: `${y3.tabSize}: ${this.state.tabSize}`, role: "textbox", "aria-multiline": "true" };
    this.state.readOnly && (e7["aria-readonly"] = "true"), xs(this, Ve2, e7);
    let i12 = this.observer.ignore(() => {
      let n14 = Ze2(this.contentDOM, this.contentAttrs, e7), o = Ze2(this.dom, this.editorAttrs, t8);
      return n14 || o;
    });
    return this.editorAttrs = t8, this.contentAttrs = e7, i12;
  }
  showAnnouncements(t8) {
    let e7 = true;
    for (let i12 of t8) for (let n14 of i12.effects) if (n14.is(s42.announce)) {
      e7 && (this.announceDOM.textContent = ""), e7 = false;
      let o = this.announceDOM.appendChild(document.createElement("div"));
      o.textContent = n14.value;
    }
  }
  mountStyles() {
    this.styleModules = this.state.facet(Lt);
    let t8 = this.state.facet(s42.cspNonce);
    b2.mount(this.root, this.styleModules.concat(rr).reverse(), t8 ? { nonce: t8 } : void 0);
  }
  readMeasured() {
    if (this.updateState == 2) throw new Error("Reading the editor layout isn't allowed during an update");
    this.updateState == 0 && this.measureScheduled > -1 && this.measure(false);
  }
  requestMeasure(t8) {
    if (this.measureScheduled < 0 && (this.measureScheduled = this.win.requestAnimationFrame(() => this.measure())), t8) {
      if (this.measureRequests.indexOf(t8) > -1) return;
      if (t8.key != null) {
        for (let e7 = 0; e7 < this.measureRequests.length; e7++) if (this.measureRequests[e7].key === t8.key) {
          this.measureRequests[e7] = t8;
          return;
        }
      }
      this.measureRequests.push(t8);
    }
  }
  plugin(t8) {
    let e7 = this.pluginMap.get(t8);
    return (e7 === void 0 || e7 && e7.spec != t8) && this.pluginMap.set(t8, e7 = this.plugins.find((i12) => i12.spec == t8) || null), e7 && e7.update(this).value;
  }
  get documentTop() {
    return this.contentDOM.getBoundingClientRect().top + this.viewState.paddingTop;
  }
  get documentPadding() {
    return { top: this.viewState.paddingTop, bottom: this.viewState.paddingBottom };
  }
  get scaleX() {
    return this.viewState.scaleX;
  }
  get scaleY() {
    return this.viewState.scaleY;
  }
  elementAtHeight(t8) {
    return this.readMeasured(), this.viewState.elementAtHeight(t8);
  }
  lineBlockAtHeight(t8) {
    return this.readMeasured(), this.viewState.lineBlockAtHeight(t8);
  }
  get viewportLineBlocks() {
    return this.viewState.viewportLines;
  }
  lineBlockAt(t8) {
    return this.viewState.lineBlockAt(t8);
  }
  get contentHeight() {
    return this.viewState.contentHeight;
  }
  moveByChar(t8, e7, i12) {
    return Ke2(this, t8, ns(this, t8, e7, i12));
  }
  moveByGroup(t8, e7) {
    return Ke2(this, t8, ns(this, t8, e7, (i12) => Lo(this, t8.head, i12)));
  }
  visualLineSide(t8, e7) {
    let i12 = this.bidiSpans(t8), n14 = this.textDirectionAt(t8.from), o = i12[e7 ? i12.length - 1 : 0];
    return x.cursor(o.side(e7, n14) + t8.from, o.forward(!e7, n14) ? 1 : -1);
  }
  moveToLineBoundary(t8, e7, i12 = true) {
    return Eo(this, t8, e7, i12);
  }
  moveVertically(t8, e7, i12) {
    return Ke2(this, t8, Bo(this, t8, e7, i12));
  }
  domAtPos(t8) {
    return this.docView.domAtPos(t8);
  }
  posAtDOM(t8, e7 = 0) {
    return this.docView.posFromDOM(t8, e7);
  }
  posAtCoords(t8, e7 = true) {
    return this.readMeasured(), vn(this, t8, e7);
  }
  coordsAtPos(t8, e7 = 1) {
    this.readMeasured();
    let i12 = this.docView.coordsAt(t8, e7);
    if (!i12 || i12.left == i12.right) return i12;
    let n14 = this.state.doc.lineAt(t8), o = this.bidiSpans(n14), r2 = o[G2.find(o, t8 - n14.from, -1, e7)];
    return te2(i12, r2.dir == L2.LTR == e7 > 0);
  }
  coordsForChar(t8) {
    return this.readMeasured(), this.docView.coordsForChar(t8);
  }
  get defaultCharacterWidth() {
    return this.viewState.heightOracle.charWidth;
  }
  get defaultLineHeight() {
    return this.viewState.heightOracle.lineHeight;
  }
  get textDirection() {
    return this.viewState.defaultTextDirection;
  }
  textDirectionAt(t8) {
    return !this.state.facet(dn) || t8 < this.viewport.from || t8 > this.viewport.to ? this.textDirection : (this.readMeasured(), this.docView.textDirectionAt(t8));
  }
  get lineWrapping() {
    return this.viewState.heightOracle.lineWrapping;
  }
  bidiSpans(t8) {
    if (t8.length > ar) return sn(t8.length);
    let e7 = this.textDirectionAt(t8.from), i12;
    for (let o of this.bidiCache) if (o.from == t8.from && o.dir == e7 && (o.fresh || tn(o.isolates, i12 = Zi(this, t8)))) return o.order;
    i12 || (i12 = Zi(this, t8));
    let n14 = en(t8.text, e7, i12);
    return this.bidiCache.push(new Ee2(t8.from, t8.to, e7, i12, true, n14)), n14;
  }
  get hasFocus() {
    var t8;
    return (this.dom.ownerDocument.hasFocus() || y3.safari && ((t8 = this.inputState) === null || t8 === void 0 ? void 0 : t8.lastContextMenu) > Date.now() - 3e4) && this.root.activeElement == this.contentDOM;
  }
  focus() {
    this.observer.ignore(() => {
      Ws(this.contentDOM), this.docView.updateSelection();
    });
  }
  setRoot(t8) {
    this._root != t8 && (this._root = t8, this.observer.setWindow((t8.nodeType == 9 ? t8 : t8.ownerDocument).defaultView || window), this.mountStyles());
  }
  destroy() {
    this.root.activeElement == this.contentDOM && this.contentDOM.blur();
    for (let t8 of this.plugins) t8.destroy(this);
    this.plugins = [], this.inputState.destroy(), this.docView.destroy(), this.dom.remove(), this.observer.destroy(), this.measureScheduled > -1 && this.win.cancelAnimationFrame(this.measureScheduled), this.destroyed = true;
  }
  static scrollIntoView(t8, e7 = {}) {
    return oe2.of(new Wt(typeof t8 == "number" ? x.cursor(t8) : t8, e7.y, e7.x, e7.yMargin, e7.xMargin));
  }
  scrollSnapshot() {
    let { scrollTop: t8, scrollLeft: e7 } = this.scrollDOM, i12 = this.viewState.scrollAnchorAt(t8);
    return oe2.of(new Wt(x.cursor(i12.from), "start", "start", i12.top - t8, e7, true));
  }
  setTabFocusMode(t8) {
    t8 == null ? this.inputState.tabFocusMode = this.inputState.tabFocusMode < 0 ? 0 : -1 : typeof t8 == "boolean" ? this.inputState.tabFocusMode = t8 ? 0 : -1 : this.inputState.tabFocusMode != 0 && (this.inputState.tabFocusMode = Date.now() + t8);
  }
  static domEventHandlers(t8) {
    return N2.define(() => ({}), { eventHandlers: t8 });
  }
  static domEventObservers(t8) {
    return N2.define(() => ({}), { eventObservers: t8 });
  }
  static theme(t8, e7) {
    let i12 = b2.newName(), n14 = [ce2.of(i12), Lt.of(xi(`.${i12}`, t8))];
    return e7 && e7.dark && n14.push(yi.of(true)), n14;
  }
  static baseTheme(t8) {
    return ht.lowest(Lt.of(xi("." + wi, t8, Bn)));
  }
  static findFromDOM(t8) {
    var e7;
    let i12 = t8.querySelector(".cm-content"), n14 = i12 && R2.get(i12) || R2.get(t8);
    return ((e7 = n14?.rootView) === null || e7 === void 0 ? void 0 : e7.view) || null;
  }
};
A2.styleModule = Lt;
A2.inputHandler = cn;
A2.clipboardInputFilter = zi;
A2.clipboardOutputFilter = Ii;
A2.scrollHandler = pn;
A2.focusChangeEffect = fn;
A2.perLineTextDirection = dn;
A2.exceptionSink = an;
A2.updateListener = ni;
A2.editable = st2;
A2.mouseSelectionStyle = hn;
A2.dragMovesSelection = ln;
A2.clickAddsSelectionRange = rn;
A2.decorations = Ut;
A2.outerDecorations = bn;
A2.atomicRanges = Ki;
A2.bidiIsolatedRanges = yn;
A2.scrollMargins = wn;
A2.darkTheme = yi;
A2.cspNonce = y.define({ combine: (s212) => s212.length ? s212[0] : "" });
A2.contentAttributes = Ve2;
A2.editorAttributes = mn;
A2.lineWrapping = A2.contentAttributes.of({ class: "cm-lineWrapping" });
A2.announce = v.define();
var ar = 4096;
var ws = {};
var Ee2 = class s43 {
  constructor(t8, e7, i12, n14, o, r2) {
    this.from = t8, this.to = e7, this.dir = i12, this.isolates = n14, this.fresh = o, this.order = r2;
  }
  static update(t8, e7) {
    if (e7.empty && !t8.some((o) => o.fresh)) return t8;
    let i12 = [], n14 = t8.length ? t8[t8.length - 1].dir : L2.LTR;
    for (let o = Math.max(0, t8.length - 10); o < t8.length; o++) {
      let r2 = t8[o];
      r2.dir == n14 && !e7.touchesRange(r2.from, r2.to) && i12.push(new s43(e7.mapPos(r2.from, 1), e7.mapPos(r2.to, -1), r2.dir, r2.isolates, false, r2.order));
    }
    return i12;
  }
};
function xs(s212, t8, e7) {
  for (let i12 = s212.state.facet(t8), n14 = i12.length - 1; n14 >= 0; n14--) {
    let o = i12[n14], r2 = typeof o == "function" ? o(s212) : o;
    r2 && Je2(r2, e7);
  }
  return e7;
}
var cr = y3.mac ? "mac" : y3.windows ? "win" : y3.linux ? "linux" : "key";
function fr(s212, t8) {
  let e7 = s212.split(/-(?!$)/), i12 = e7[e7.length - 1];
  i12 == "Space" && (i12 = " ");
  let n14, o, r2, l11;
  for (let h3 = 0; h3 < e7.length - 1; ++h3) {
    let c3 = e7[h3];
    if (/^(cmd|meta|m)$/i.test(c3)) l11 = true;
    else if (/^a(lt)?$/i.test(c3)) n14 = true;
    else if (/^(c|ctrl|control)$/i.test(c3)) o = true;
    else if (/^s(hift)?$/i.test(c3)) r2 = true;
    else if (/^mod$/i.test(c3)) t8 == "mac" ? l11 = true : o = true;
    else throw new Error("Unrecognized modifier name: " + c3);
  }
  return n14 && (i12 = "Alt-" + i12), o && (i12 = "Ctrl-" + i12), l11 && (i12 = "Meta-" + i12), r2 && (i12 = "Shift-" + i12), i12;
}
function fe2(s212, t8, e7) {
  return t8.altKey && (s212 = "Alt-" + s212), t8.ctrlKey && (s212 = "Ctrl-" + s212), t8.metaKey && (s212 = "Meta-" + s212), e7 !== false && t8.shiftKey && (s212 = "Shift-" + s212), s212;
}
var dr = ht.default(A2.domEventHandlers({ keydown(s212, t8) {
  return Hn(Pn(t8.state), s212, t8, "editor");
} }));
var ur = y.define({ enables: dr });
var vs = /* @__PURE__ */ new WeakMap();
function Pn(s212) {
  let t8 = s212.facet(ur), e7 = vs.get(t8);
  return e7 || vs.set(t8, e7 = gr(t8.reduce((i12, n14) => i12.concat(n14), []))), e7;
}
function ol(s212, t8, e7) {
  return Hn(Pn(s212.state), t8, s212, e7);
}
var nt2 = null;
var pr = 4e3;
function gr(s212, t8 = cr) {
  let e7 = /* @__PURE__ */ Object.create(null), i12 = /* @__PURE__ */ Object.create(null), n14 = (r2, l11) => {
    let h3 = i12[r2];
    if (h3 == null) i12[r2] = l11;
    else if (h3 != l11) throw new Error("Key binding " + r2 + " is used both as a regular binding and as a multi-stroke prefix");
  }, o = (r2, l11, h3, c3, a2) => {
    var f6, d4;
    let u3 = e7[r2] || (e7[r2] = /* @__PURE__ */ Object.create(null)), p3 = l11.split(/ (?!$)/).map((m11) => fr(m11, t8));
    for (let m11 = 1; m11 < p3.length; m11++) {
      let w14 = p3.slice(0, m11).join(" ");
      n14(w14, true), u3[w14] || (u3[w14] = { preventDefault: true, stopPropagation: false, run: [(v10) => {
        let x11 = nt2 = { view: v10, prefix: w14, scope: r2 };
        return setTimeout(() => {
          nt2 == x11 && (nt2 = null);
        }, pr), true;
      }] });
    }
    let g8 = p3.join(" ");
    n14(g8, false);
    let b12 = u3[g8] || (u3[g8] = { preventDefault: false, stopPropagation: false, run: ((d4 = (f6 = u3._any) === null || f6 === void 0 ? void 0 : f6.run) === null || d4 === void 0 ? void 0 : d4.slice()) || [] });
    h3 && b12.run.push(h3), c3 && (b12.preventDefault = true), a2 && (b12.stopPropagation = true);
  };
  for (let r2 of s212) {
    let l11 = r2.scope ? r2.scope.split(" ") : ["editor"];
    if (r2.any) for (let c3 of l11) {
      let a2 = e7[c3] || (e7[c3] = /* @__PURE__ */ Object.create(null));
      a2._any || (a2._any = { preventDefault: false, stopPropagation: false, run: [] });
      let { any: f6 } = r2;
      for (let d4 in a2) a2[d4].run.push((u3) => f6(u3, Ci));
    }
    let h3 = r2[t8] || r2.key;
    if (h3) for (let c3 of l11) o(c3, h3, r2.run, r2.preventDefault, r2.stopPropagation), r2.shift && o(c3, "Shift-" + h3, r2.shift, r2.preventDefault, r2.stopPropagation);
  }
  return e7;
}
var Ci = null;
function Hn(s212, t8, e7, i12) {
  Ci = t8;
  let n14 = g2(t8), o = ae(n14, 0), r2 = Oe(o) == n14.length && n14 != " ", l11 = "", h3 = false, c3 = false, a2 = false;
  nt2 && nt2.view == e7 && nt2.scope == i12 && (l11 = nt2.prefix + " ", Mn.indexOf(t8.keyCode) < 0 && (c3 = true, nt2 = null));
  let f6 = /* @__PURE__ */ new Set(), d4 = (b12) => {
    if (b12) {
      for (let m11 of b12.run) if (!f6.has(m11) && (f6.add(m11), m11(e7))) return b12.stopPropagation && (a2 = true), true;
      b12.preventDefault && (b12.stopPropagation && (a2 = true), c3 = true);
    }
    return false;
  }, u3 = s212[i12], p3, g8;
  return u3 && (d4(u3[l11 + fe2(n14, t8, !r2)]) ? h3 = true : r2 && (t8.altKey || t8.metaKey || t8.ctrlKey) && !(y3.windows && t8.ctrlKey && t8.altKey) && (p3 = t[t8.keyCode]) && p3 != n14 ? (d4(u3[l11 + fe2(p3, t8, true)]) || t8.shiftKey && (g8 = i[t8.keyCode]) != n14 && g8 != p3 && d4(u3[l11 + fe2(g8, t8, false)])) && (h3 = true) : r2 && t8.shiftKey && d4(u3[l11 + fe2(n14, t8, true)]) && (h3 = true), !h3 && d4(u3._any) && (h3 = true)), c3 && (h3 = true), h3 && a2 && t8.stopPropagation(), Ci = null, h3;
}
var Qt = class s44 {
  constructor(t8, e7, i12, n14, o) {
    this.className = t8, this.left = e7, this.top = i12, this.width = n14, this.height = o;
  }
  draw() {
    let t8 = document.createElement("div");
    return t8.className = this.className, this.adjust(t8), t8;
  }
  update(t8, e7) {
    return e7.className != this.className ? false : (this.adjust(t8), true);
  }
  adjust(t8) {
    t8.style.left = this.left + "px", t8.style.top = this.top + "px", this.width != null && (t8.style.width = this.width + "px"), t8.style.height = this.height + "px";
  }
  eq(t8) {
    return this.left == t8.left && this.top == t8.top && this.width == t8.width && this.height == t8.height && this.className == t8.className;
  }
  static forRange(t8, e7, i12) {
    if (i12.empty) {
      let n14 = t8.coordsAtPos(i12.head, i12.assoc || 1);
      if (!n14) return [];
      let o = Nn(t8);
      return [new s44(e7, n14.left - o.left, n14.top - o.top, null, n14.bottom - n14.top)];
    } else return mr(t8, e7, i12);
  }
};
function Nn(s212) {
  let t8 = s212.scrollDOM.getBoundingClientRect();
  return { left: (s212.textDirection == L2.LTR ? t8.left : t8.right - s212.scrollDOM.clientWidth * s212.scaleX) - s212.scrollDOM.scrollLeft * s212.scaleX, top: t8.top - s212.scrollDOM.scrollTop * s212.scaleY };
}
function Ss(s212, t8, e7, i12) {
  let n14 = s212.coordsAtPos(t8, e7 * 2);
  if (!n14) return i12;
  let o = s212.dom.getBoundingClientRect(), r2 = (n14.top + n14.bottom) / 2, l11 = s212.posAtCoords({ x: o.left + 1, y: r2 }), h3 = s212.posAtCoords({ x: o.right - 1, y: r2 });
  return l11 == null || h3 == null ? i12 : { from: Math.max(i12.from, Math.min(l11, h3)), to: Math.min(i12.to, Math.max(l11, h3)) };
}
function mr(s212, t8, e7) {
  if (e7.to <= s212.viewport.from || e7.from >= s212.viewport.to) return [];
  let i12 = Math.max(e7.from, s212.viewport.from), n14 = Math.min(e7.to, s212.viewport.to), o = s212.textDirection == L2.LTR, r2 = s212.contentDOM, l11 = r2.getBoundingClientRect(), h3 = Nn(s212), c3 = r2.querySelector(".cm-line"), a2 = c3 && window.getComputedStyle(c3), f6 = l11.left + (a2 ? parseInt(a2.paddingLeft) + Math.min(0, parseInt(a2.textIndent)) : 0), d4 = l11.right - (a2 ? parseInt(a2.paddingRight) : 0), u3 = ri(s212, i12), p3 = ri(s212, n14), g8 = u3.type == F2.Text ? u3 : null, b12 = p3.type == F2.Text ? p3 : null;
  if (g8 && (s212.lineWrapping || u3.widgetLineBreaks) && (g8 = Ss(s212, i12, 1, g8)), b12 && (s212.lineWrapping || p3.widgetLineBreaks) && (b12 = Ss(s212, n14, -1, b12)), g8 && b12 && g8.from == b12.from && g8.to == b12.to) return w14(v10(e7.from, e7.to, g8));
  {
    let S17 = g8 ? v10(e7.from, null, g8) : x11(u3, false), C11 = b12 ? v10(null, e7.to, b12) : x11(p3, true), E11 = [];
    return (g8 || u3).to < (b12 || p3).from - (g8 && b12 ? 1 : 0) || u3.widgetLineBreaks > 1 && S17.bottom + s212.defaultLineHeight / 2 < C11.top ? E11.push(m11(f6, S17.bottom, d4, C11.top)) : S17.bottom < C11.top && s212.elementAtHeight((S17.bottom + C11.top) / 2).type == F2.Text && (S17.bottom = C11.top = (S17.bottom + C11.top) / 2), w14(S17).concat(E11).concat(w14(C11));
  }
  function m11(S17, C11, E11, B15) {
    return new Qt(t8, S17 - h3.left, C11 - h3.top - 0.01, E11 - S17, B15 - C11 + 0.01);
  }
  function w14({ top: S17, bottom: C11, horizontal: E11 }) {
    let B15 = [];
    for (let et13 = 0; et13 < E11.length; et13 += 2) B15.push(m11(E11[et13], S17, E11[et13 + 1], C11));
    return B15;
  }
  function v10(S17, C11, E11) {
    let B15 = 1e9, et13 = -1e9, ee13 = [];
    function Yi5(ct8, it12, bt5, ft8, Tt6) {
      let Z21 = s212.coordsAtPos(ct8, ct8 == E11.to ? -2 : 2), tt10 = s212.coordsAtPos(bt5, bt5 == E11.from ? 2 : -2);
      !Z21 || !tt10 || (B15 = Math.min(Z21.top, tt10.top, B15), et13 = Math.max(Z21.bottom, tt10.bottom, et13), Tt6 == L2.LTR ? ee13.push(o && it12 ? f6 : Z21.left, o && ft8 ? d4 : tt10.right) : ee13.push(!o && ft8 ? f6 : tt10.left, !o && it12 ? d4 : Z21.right));
    }
    let ie12 = S17 ?? E11.from, se15 = C11 ?? E11.to;
    for (let ct8 of s212.visibleRanges) if (ct8.to > ie12 && ct8.from < se15) for (let it12 = Math.max(ct8.from, ie12), bt5 = Math.min(ct8.to, se15); ; ) {
      let ft8 = s212.state.doc.lineAt(it12);
      for (let Tt6 of s212.bidiSpans(ft8)) {
        let Z21 = Tt6.from + ft8.from, tt10 = Tt6.to + ft8.from;
        if (Z21 >= bt5) break;
        tt10 > it12 && Yi5(Math.max(Z21, it12), S17 == null && Z21 <= ie12, Math.min(tt10, bt5), C11 == null && tt10 >= se15, Tt6.dir);
      }
      if (it12 = ft8.to + 1, it12 >= bt5) break;
    }
    return ee13.length == 0 && Yi5(ie12, S17 == null, se15, C11 == null, s212.textDirection), { top: B15, bottom: et13, horizontal: ee13 };
  }
  function x11(S17, C11) {
    let E11 = l11.top + (C11 ? S17.top : S17.bottom);
    return { top: E11, bottom: E11, horizontal: [] };
  }
}
function br(s212, t8) {
  return s212.constructor == t8.constructor && s212.eq(t8);
}
var Mi = class {
  constructor(t8, e7) {
    this.view = t8, this.layer = e7, this.drawn = [], this.scaleX = 1, this.scaleY = 1, this.measureReq = { read: this.measure.bind(this), write: this.draw.bind(this) }, this.dom = t8.scrollDOM.appendChild(document.createElement("div")), this.dom.classList.add("cm-layer"), e7.above && this.dom.classList.add("cm-layer-above"), e7.class && this.dom.classList.add(e7.class), this.scale(), this.dom.setAttribute("aria-hidden", "true"), this.setOrder(t8.state), t8.requestMeasure(this.measureReq), e7.mount && e7.mount(this.dom, t8);
  }
  update(t8) {
    t8.startState.facet(me2) != t8.state.facet(me2) && this.setOrder(t8.state), (this.layer.update(t8, this.dom) || t8.geometryChanged) && (this.scale(), t8.view.requestMeasure(this.measureReq));
  }
  docViewUpdate(t8) {
    this.layer.updateOnDocViewUpdate !== false && t8.requestMeasure(this.measureReq);
  }
  setOrder(t8) {
    let e7 = 0, i12 = t8.facet(me2);
    for (; e7 < i12.length && i12[e7] != this.layer; ) e7++;
    this.dom.style.zIndex = String((this.layer.above ? 150 : -1) - e7);
  }
  measure() {
    return this.layer.markers(this.view);
  }
  scale() {
    let { scaleX: t8, scaleY: e7 } = this.view;
    (t8 != this.scaleX || e7 != this.scaleY) && (this.scaleX = t8, this.scaleY = e7, this.dom.style.transform = `scale(${1 / t8}, ${1 / e7})`);
  }
  draw(t8) {
    if (t8.length != this.drawn.length || t8.some((e7, i12) => !br(e7, this.drawn[i12]))) {
      let e7 = this.dom.firstChild, i12 = 0;
      for (let n14 of t8) n14.update && e7 && n14.constructor && this.drawn[i12].constructor && n14.update(e7, this.drawn[i12]) ? (e7 = e7.nextSibling, i12++) : this.dom.insertBefore(n14.draw(), e7);
      for (; e7; ) {
        let n14 = e7.nextSibling;
        e7.remove(), e7 = n14;
      }
      this.drawn = t8;
    }
  }
  destroy() {
    this.layer.destroy && this.layer.destroy(this.dom, this.view), this.dom.remove();
  }
};
var me2 = y.define();
function Vn(s212) {
  return [N2.define((t8) => new Mi(t8, s212)), me2.of(s212)];
}
var Fn = !y3.ios;
var Dt = y.define({ combine(s212) {
  return at(s212, { cursorBlinkRate: 1200, drawRangeCursor: true }, { cursorBlinkRate: (t8, e7) => Math.min(t8, e7), drawRangeCursor: (t8, e7) => t8 || e7 });
} });
function Wn(s212) {
  return s212.startState.facet(Dt) != s212.state.facet(Dt);
}
var yr = Vn({ above: true, markers(s212) {
  let { state: t8 } = s212, e7 = t8.facet(Dt), i12 = [];
  for (let n14 of t8.selection.ranges) {
    let o = n14 == t8.selection.main;
    if (n14.empty ? !o || Fn : e7.drawRangeCursor) {
      let r2 = o ? "cm-cursor cm-cursor-primary" : "cm-cursor cm-cursor-secondary", l11 = n14.empty ? n14 : x.cursor(n14.head, n14.head > n14.anchor ? -1 : 1);
      for (let h3 of Qt.forRange(s212, r2, l11)) i12.push(h3);
    }
  }
  return i12;
}, update(s212, t8) {
  s212.transactions.some((i12) => i12.selection) && (t8.style.animationName = t8.style.animationName == "cm-blink" ? "cm-blink2" : "cm-blink");
  let e7 = Wn(s212);
  return e7 && Cs(s212.state, t8), s212.docChanged || s212.selectionSet || e7;
}, mount(s212, t8) {
  Cs(t8.state, s212);
}, class: "cm-cursorLayer" });
function Cs(s212, t8) {
  t8.style.animationDuration = s212.facet(Dt).cursorBlinkRate + "ms";
}
var wr = Vn({ above: false, markers(s212) {
  return s212.state.selection.ranges.map((t8) => t8.empty ? [] : Qt.forRange(s212, "cm-selectionBackground", t8)).reduce((t8, e7) => t8.concat(e7));
}, update(s212, t8) {
  return s212.docChanged || s212.selectionSet || s212.viewportChanged || Wn(s212);
}, class: "cm-selectionLayer" });
var ki = { ".cm-line": { "& ::selection, &::selection": { backgroundColor: "transparent !important" } }, ".cm-content": { "& :focus": { caretColor: "initial !important", "&::selection, & ::selection": { backgroundColor: "Highlight !important" } } } };
Fn && (ki[".cm-line"].caretColor = ki[".cm-content"].caretColor = "transparent !important");
var xr = ht.highest(A2.theme(ki));
var zn = v.define({ map(s212, t8) {
  return s212 == null ? null : t8.mapPos(s212);
} });
var Ht = z.define({ create() {
  return null;
}, update(s212, t8) {
  return s212 != null && (s212 = t8.changes.mapPos(s212)), t8.effects.reduce((e7, i12) => i12.is(zn) ? i12.value : e7, s212);
} });
var vr = N2.fromClass(class {
  constructor(s212) {
    this.view = s212, this.cursor = null, this.measureReq = { read: this.readPos.bind(this), write: this.drawCursor.bind(this) };
  }
  update(s212) {
    var t8;
    let e7 = s212.state.field(Ht);
    e7 == null ? this.cursor != null && ((t8 = this.cursor) === null || t8 === void 0 || t8.remove(), this.cursor = null) : (this.cursor || (this.cursor = this.view.scrollDOM.appendChild(document.createElement("div")), this.cursor.className = "cm-dropCursor"), (s212.startState.field(Ht) != e7 || s212.docChanged || s212.geometryChanged) && this.view.requestMeasure(this.measureReq));
  }
  readPos() {
    let { view: s212 } = this, t8 = s212.state.field(Ht), e7 = t8 != null && s212.coordsAtPos(t8);
    if (!e7) return null;
    let i12 = s212.scrollDOM.getBoundingClientRect();
    return { left: e7.left - i12.left + s212.scrollDOM.scrollLeft * s212.scaleX, top: e7.top - i12.top + s212.scrollDOM.scrollTop * s212.scaleY, height: e7.bottom - e7.top };
  }
  drawCursor(s212) {
    if (this.cursor) {
      let { scaleX: t8, scaleY: e7 } = this.view;
      s212 ? (this.cursor.style.left = s212.left / t8 + "px", this.cursor.style.top = s212.top / e7 + "px", this.cursor.style.height = s212.height / e7 + "px") : this.cursor.style.left = "-100000px";
    }
  }
  destroy() {
    this.cursor && this.cursor.remove();
  }
  setDropPos(s212) {
    this.view.state.field(Ht) != s212 && this.view.dispatch({ effects: zn.of(s212) });
  }
}, { eventObservers: { dragover(s212) {
  this.setDropPos(this.view.posAtCoords({ x: s212.clientX, y: s212.clientY }));
}, dragleave(s212) {
  (s212.target == this.view.contentDOM || !this.view.contentDOM.contains(s212.relatedTarget)) && this.setDropPos(null);
}, dragend() {
  this.setDropPos(null);
}, drop() {
  this.setDropPos(null);
} } });
function Ms(s212, t8, e7, i12, n14) {
  t8.lastIndex = 0;
  for (let o = s212.iterRange(e7, i12), r2 = e7, l11; !o.next().done; r2 += o.value.length) if (!o.lineBreak) for (; l11 = t8.exec(o.value); ) n14(r2 + l11.index, l11);
}
function Sr(s212, t8) {
  let e7 = s212.visibleRanges;
  if (e7.length == 1 && e7[0].from == s212.viewport.from && e7[0].to == s212.viewport.to) return e7;
  let i12 = [];
  for (let { from: n14, to: o } of e7) n14 = Math.max(s212.state.doc.lineAt(n14).from, n14 - t8), o = Math.min(s212.state.doc.lineAt(o).to, o + t8), i12.length && i12[i12.length - 1].to >= n14 ? i12[i12.length - 1].to = o : i12.push({ from: n14, to: o });
  return i12;
}
var Jt = class {
  constructor(t8) {
    let { regexp: e7, decoration: i12, decorate: n14, boundary: o, maxLength: r2 = 1e3 } = t8;
    if (!e7.global) throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");
    if (this.regexp = e7, n14) this.addMatch = (l11, h3, c3, a2) => n14(a2, c3, c3 + l11[0].length, l11, h3);
    else if (typeof i12 == "function") this.addMatch = (l11, h3, c3, a2) => {
      let f6 = i12(l11, h3, c3);
      f6 && a2(c3, c3 + l11[0].length, f6);
    };
    else if (i12) this.addMatch = (l11, h3, c3, a2) => a2(c3, c3 + l11[0].length, i12);
    else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");
    this.boundary = o, this.maxLength = r2;
  }
  createDeco(t8) {
    let e7 = new re(), i12 = e7.add.bind(e7);
    for (let { from: n14, to: o } of Sr(t8, this.maxLength)) Ms(t8.state.doc, this.regexp, n14, o, (r2, l11) => this.addMatch(l11, t8, r2, i12));
    return e7.finish();
  }
  updateDeco(t8, e7) {
    let i12 = 1e9, n14 = -1;
    return t8.docChanged && t8.changes.iterChanges((o, r2, l11, h3) => {
      h3 > t8.view.viewport.from && l11 < t8.view.viewport.to && (i12 = Math.min(l11, i12), n14 = Math.max(h3, n14));
    }), t8.viewportChanged || n14 - i12 > 1e3 ? this.createDeco(t8.view) : n14 > -1 ? this.updateRange(t8.view, e7.map(t8.changes), i12, n14) : e7;
  }
  updateRange(t8, e7, i12, n14) {
    for (let o of t8.visibleRanges) {
      let r2 = Math.max(o.from, i12), l11 = Math.min(o.to, n14);
      if (l11 > r2) {
        let h3 = t8.state.doc.lineAt(r2), c3 = h3.to < l11 ? t8.state.doc.lineAt(l11) : h3, a2 = Math.max(o.from, h3.from), f6 = Math.min(o.to, c3.to);
        if (this.boundary) {
          for (; r2 > h3.from; r2--) if (this.boundary.test(h3.text[r2 - 1 - h3.from])) {
            a2 = r2;
            break;
          }
          for (; l11 < c3.to; l11++) if (this.boundary.test(c3.text[l11 - c3.from])) {
            f6 = l11;
            break;
          }
        }
        let d4 = [], u3, p3 = (g8, b12, m11) => d4.push(m11.range(g8, b12));
        if (h3 == c3) for (this.regexp.lastIndex = a2 - h3.from; (u3 = this.regexp.exec(h3.text)) && u3.index < f6 - h3.from; ) this.addMatch(u3, t8, u3.index + h3.from, p3);
        else Ms(t8.state.doc, this.regexp, a2, f6, (g8, b12) => this.addMatch(b12, t8, g8, p3));
        e7 = e7.update({ filterFrom: a2, filterTo: f6, filter: (g8, b12) => g8 < a2 || b12 > f6, add: d4 });
      }
    }
    return e7;
  }
};
var Ai = /x/.unicode != null ? "gu" : "g";
var Cr = new RegExp(`[\0-\b
--ÂŸÂ­Øœâ€‹â€Žâ€\u2028\u2029â€­â€®â¦â§â©\uFEFFï¿¹-ï¿¼]`, Ai);
var je2 = null;
function kr() {
  var s212;
  if (je2 == null && typeof document < "u" && document.body) {
    let t8 = document.body.style;
    je2 = ((s212 = t8.tabSize) !== null && s212 !== void 0 ? s212 : t8.MozTabSize) != null;
  }
  return je2 || false;
}
var be2 = y.define({ combine(s212) {
  let t8 = at(s212, { render: null, specialChars: Cr, addSpecialChars: null });
  return (t8.replaceTabs = !kr()) && (t8.specialChars = new RegExp("	|" + t8.specialChars.source, Ai)), t8.addSpecialChars && (t8.specialChars = new RegExp(t8.specialChars.source + "|" + t8.addSpecialChars.source, Ai)), t8;
} });
var As = N2.fromClass(class {
  constructor() {
    this.height = 1e3, this.attrs = { style: "padding-bottom: 1000px" };
  }
  update(s212) {
    let { view: t8 } = s212, e7 = t8.viewState.editorHeight - t8.defaultLineHeight - t8.documentPadding.top - 0.5;
    e7 >= 0 && e7 != this.height && (this.height = e7, this.attrs = { style: `padding-bottom: ${e7}px` });
  }
});
var Tr = O2.line({ class: "cm-activeLine" });
var Rr = N2.fromClass(class {
  constructor(s212) {
    this.decorations = this.getDeco(s212);
  }
  update(s212) {
    (s212.docChanged || s212.selectionSet) && (this.decorations = this.getDeco(s212.view));
  }
  getDeco(s212) {
    let t8 = -1, e7 = [];
    for (let i12 of s212.state.selection.ranges) {
      let n14 = s212.lineBlockAt(i12.head);
      n14.from > t8 && (e7.push(Tr.range(n14.from)), t8 = n14.from);
    }
    return O2.set(e7);
  }
}, { decorations: (s212) => s212.decorations });
var Rt = "-10000px";
var Le2 = class {
  constructor(t8, e7, i12, n14) {
    this.facet = e7, this.createTooltipView = i12, this.removeTooltipView = n14, this.input = t8.state.facet(e7), this.tooltips = this.input.filter((r2) => r2);
    let o = null;
    this.tooltipViews = this.tooltips.map((r2) => o = i12(r2, o));
  }
  update(t8, e7) {
    var i12;
    let n14 = t8.state.facet(this.facet), o = n14.filter((h3) => h3);
    if (n14 === this.input) {
      for (let h3 of this.tooltipViews) h3.update && h3.update(t8);
      return false;
    }
    let r2 = [], l11 = e7 ? [] : null;
    for (let h3 = 0; h3 < o.length; h3++) {
      let c3 = o[h3], a2 = -1;
      if (c3) {
        for (let f6 = 0; f6 < this.tooltips.length; f6++) {
          let d4 = this.tooltips[f6];
          d4 && d4.create == c3.create && (a2 = f6);
        }
        if (a2 < 0) r2[h3] = this.createTooltipView(c3, h3 ? r2[h3 - 1] : null), l11 && (l11[h3] = !!c3.above);
        else {
          let f6 = r2[h3] = this.tooltipViews[a2];
          l11 && (l11[h3] = e7[a2]), f6.update && f6.update(t8);
        }
      }
    }
    for (let h3 of this.tooltipViews) r2.indexOf(h3) < 0 && (this.removeTooltipView(h3), (i12 = h3.destroy) === null || i12 === void 0 || i12.call(h3));
    return e7 && (l11.forEach((h3, c3) => e7[c3] = h3), e7.length = l11.length), this.input = n14, this.tooltips = o, this.tooltipViews = r2, true;
  }
};
function Nr(s212) {
  let { win: t8 } = s212;
  return { top: 0, left: 0, bottom: t8.innerHeight, right: t8.innerWidth };
}
var ye2 = y.define({ combine: (s212) => {
  var t8, e7, i12;
  return { position: y3.ios ? "absolute" : ((t8 = s212.find((n14) => n14.position)) === null || t8 === void 0 ? void 0 : t8.position) || "fixed", parent: ((e7 = s212.find((n14) => n14.parent)) === null || e7 === void 0 ? void 0 : e7.parent) || null, tooltipSpace: ((i12 = s212.find((n14) => n14.tooltipSpace)) === null || i12 === void 0 ? void 0 : i12.tooltipSpace) || Nr };
} });
var Os = /* @__PURE__ */ new WeakMap();
var We2 = N2.fromClass(class {
  constructor(s212) {
    this.view = s212, this.above = [], this.inView = true, this.madeAbsolute = false, this.lastTransaction = 0, this.measureTimeout = -1;
    let t8 = s212.state.facet(ye2);
    this.position = t8.position, this.parent = t8.parent, this.classes = s212.themeClasses, this.createContainer(), this.measureReq = { read: this.readMeasure.bind(this), write: this.writeMeasure.bind(this), key: this }, this.resizeObserver = typeof ResizeObserver == "function" ? new ResizeObserver(() => this.measureSoon()) : null, this.manager = new Le2(s212, In, (e7, i12) => this.createTooltip(e7, i12), (e7) => {
      this.resizeObserver && this.resizeObserver.unobserve(e7.dom), e7.dom.remove();
    }), this.above = this.manager.tooltips.map((e7) => !!e7.above), this.intersectionObserver = typeof IntersectionObserver == "function" ? new IntersectionObserver((e7) => {
      Date.now() > this.lastTransaction - 50 && e7.length > 0 && e7[e7.length - 1].intersectionRatio < 1 && this.measureSoon();
    }, { threshold: [1] }) : null, this.observeIntersection(), s212.win.addEventListener("resize", this.measureSoon = this.measureSoon.bind(this)), this.maybeMeasure();
  }
  createContainer() {
    this.parent ? (this.container = document.createElement("div"), this.container.style.position = "relative", this.container.className = this.view.themeClasses, this.parent.appendChild(this.container)) : this.container = this.view.dom;
  }
  observeIntersection() {
    if (this.intersectionObserver) {
      this.intersectionObserver.disconnect();
      for (let s212 of this.manager.tooltipViews) this.intersectionObserver.observe(s212.dom);
    }
  }
  measureSoon() {
    this.measureTimeout < 0 && (this.measureTimeout = setTimeout(() => {
      this.measureTimeout = -1, this.maybeMeasure();
    }, 50));
  }
  update(s212) {
    s212.transactions.length && (this.lastTransaction = Date.now());
    let t8 = this.manager.update(s212, this.above);
    t8 && this.observeIntersection();
    let e7 = t8 || s212.geometryChanged, i12 = s212.state.facet(ye2);
    if (i12.position != this.position && !this.madeAbsolute) {
      this.position = i12.position;
      for (let n14 of this.manager.tooltipViews) n14.dom.style.position = this.position;
      e7 = true;
    }
    if (i12.parent != this.parent) {
      this.parent && this.container.remove(), this.parent = i12.parent, this.createContainer();
      for (let n14 of this.manager.tooltipViews) this.container.appendChild(n14.dom);
      e7 = true;
    } else this.parent && this.view.themeClasses != this.classes && (this.classes = this.container.className = this.view.themeClasses);
    e7 && this.maybeMeasure();
  }
  createTooltip(s212, t8) {
    let e7 = s212.create(this.view), i12 = t8 ? t8.dom : null;
    if (e7.dom.classList.add("cm-tooltip"), s212.arrow && !e7.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")) {
      let n14 = document.createElement("div");
      n14.className = "cm-tooltip-arrow", e7.dom.appendChild(n14);
    }
    return e7.dom.style.position = this.position, e7.dom.style.top = Rt, e7.dom.style.left = "0px", this.container.insertBefore(e7.dom, i12), e7.mount && e7.mount(this.view), this.resizeObserver && this.resizeObserver.observe(e7.dom), e7;
  }
  destroy() {
    var s212, t8, e7;
    this.view.win.removeEventListener("resize", this.measureSoon);
    for (let i12 of this.manager.tooltipViews) i12.dom.remove(), (s212 = i12.destroy) === null || s212 === void 0 || s212.call(i12);
    this.parent && this.container.remove(), (t8 = this.resizeObserver) === null || t8 === void 0 || t8.disconnect(), (e7 = this.intersectionObserver) === null || e7 === void 0 || e7.disconnect(), clearTimeout(this.measureTimeout);
  }
  readMeasure() {
    let s212 = 1, t8 = 1, e7 = false;
    if (this.position == "fixed" && this.manager.tooltipViews.length) {
      let { dom: o } = this.manager.tooltipViews[0];
      if (y3.gecko) e7 = o.offsetParent != this.container.ownerDocument.body;
      else if (o.style.top == Rt && o.style.left == "0px") {
        let r2 = o.getBoundingClientRect();
        e7 = Math.abs(r2.top + 1e4) > 1 || Math.abs(r2.left) > 1;
      }
    }
    if (e7 || this.position == "absolute") if (this.parent) {
      let o = this.parent.getBoundingClientRect();
      o.width && o.height && (s212 = o.width / this.parent.offsetWidth, t8 = o.height / this.parent.offsetHeight);
    } else ({ scaleX: s212, scaleY: t8 } = this.view.viewState);
    let i12 = this.view.scrollDOM.getBoundingClientRect(), n14 = qi(this.view);
    return { visible: { left: i12.left + n14.left, top: i12.top + n14.top, right: i12.right - n14.right, bottom: i12.bottom - n14.bottom }, parent: this.parent ? this.container.getBoundingClientRect() : this.view.dom.getBoundingClientRect(), pos: this.manager.tooltips.map((o, r2) => {
      let l11 = this.manager.tooltipViews[r2];
      return l11.getCoords ? l11.getCoords(o.pos) : this.view.coordsAtPos(o.pos);
    }), size: this.manager.tooltipViews.map(({ dom: o }) => o.getBoundingClientRect()), space: this.view.state.facet(ye2).tooltipSpace(this.view), scaleX: s212, scaleY: t8, makeAbsolute: e7 };
  }
  writeMeasure(s212) {
    var t8;
    if (s212.makeAbsolute) {
      this.madeAbsolute = true, this.position = "absolute";
      for (let l11 of this.manager.tooltipViews) l11.dom.style.position = "absolute";
    }
    let { visible: e7, space: i12, scaleX: n14, scaleY: o } = s212, r2 = [];
    for (let l11 = 0; l11 < this.manager.tooltips.length; l11++) {
      let h3 = this.manager.tooltips[l11], c3 = this.manager.tooltipViews[l11], { dom: a2 } = c3, f6 = s212.pos[l11], d4 = s212.size[l11];
      if (!f6 || h3.clip !== false && (f6.bottom <= Math.max(e7.top, i12.top) || f6.top >= Math.min(e7.bottom, i12.bottom) || f6.right < Math.max(e7.left, i12.left) - 0.1 || f6.left > Math.min(e7.right, i12.right) + 0.1)) {
        a2.style.top = Rt;
        continue;
      }
      let u3 = h3.arrow ? c3.dom.querySelector(".cm-tooltip-arrow") : null, p3 = u3 ? 7 : 0, g8 = d4.right - d4.left, b12 = (t8 = Os.get(c3)) !== null && t8 !== void 0 ? t8 : d4.bottom - d4.top, m11 = c3.offset || Fr, w14 = this.view.textDirection == L2.LTR, v10 = d4.width > i12.right - i12.left ? w14 ? i12.left : i12.right - d4.width : w14 ? Math.max(i12.left, Math.min(f6.left - (u3 ? 14 : 0) + m11.x, i12.right - g8)) : Math.min(Math.max(i12.left, f6.left - g8 + (u3 ? 14 : 0) - m11.x), i12.right - g8), x11 = this.above[l11];
      !h3.strictSide && (x11 ? f6.top - b12 - p3 - m11.y < i12.top : f6.bottom + b12 + p3 + m11.y > i12.bottom) && x11 == i12.bottom - f6.bottom > f6.top - i12.top && (x11 = this.above[l11] = !x11);
      let S17 = (x11 ? f6.top - i12.top : i12.bottom - f6.bottom) - p3;
      if (S17 < b12 && c3.resize !== false) {
        if (S17 < this.view.defaultLineHeight) {
          a2.style.top = Rt;
          continue;
        }
        Os.set(c3, b12), a2.style.height = (b12 = S17) / o + "px";
      } else a2.style.height && (a2.style.height = "");
      let C11 = x11 ? f6.top - b12 - p3 - m11.y : f6.bottom + p3 + m11.y, E11 = v10 + g8;
      if (c3.overlap !== true) for (let B15 of r2) B15.left < E11 && B15.right > v10 && B15.top < C11 + b12 && B15.bottom > C11 && (C11 = x11 ? B15.top - b12 - 2 - p3 : B15.bottom + p3 + 2);
      if (this.position == "absolute" ? (a2.style.top = (C11 - s212.parent.top) / o + "px", a2.style.left = (v10 - s212.parent.left) / n14 + "px") : (a2.style.top = C11 / o + "px", a2.style.left = v10 / n14 + "px"), u3) {
        let B15 = f6.left + (w14 ? m11.x : -m11.x) - (v10 + 14 - 7);
        u3.style.left = B15 / n14 + "px";
      }
      c3.overlap !== true && r2.push({ left: v10, top: C11, right: E11, bottom: C11 + b12 }), a2.classList.toggle("cm-tooltip-above", x11), a2.classList.toggle("cm-tooltip-below", !x11), c3.positioned && c3.positioned(s212.space);
    }
  }
  maybeMeasure() {
    if (this.manager.tooltips.length && (this.view.inView && this.view.requestMeasure(this.measureReq), this.inView != this.view.inView && (this.inView = this.view.inView, !this.inView))) for (let s212 of this.manager.tooltipViews) s212.dom.style.top = Rt;
  }
}, { eventObservers: { scroll() {
  this.maybeMeasure();
} } });
var Vr = A2.baseTheme({ ".cm-tooltip": { zIndex: 500, boxSizing: "border-box" }, "&light .cm-tooltip": { border: "1px solid #bbb", backgroundColor: "#f5f5f5" }, "&light .cm-tooltip-section:not(:first-child)": { borderTop: "1px solid #bbb" }, "&dark .cm-tooltip": { backgroundColor: "#333338", color: "white" }, ".cm-tooltip-arrow": { height: "7px", width: `${7 * 2}px`, position: "absolute", zIndex: -1, overflow: "hidden", "&:before, &:after": { content: "''", position: "absolute", width: 0, height: 0, borderLeft: "7px solid transparent", borderRight: "7px solid transparent" }, ".cm-tooltip-above &": { bottom: "-7px", "&:before": { borderTop: "7px solid #bbb" }, "&:after": { borderTop: "7px solid #f5f5f5", bottom: "1px" } }, ".cm-tooltip-below &": { top: "-7px", "&:before": { borderBottom: "7px solid #bbb" }, "&:after": { borderBottom: "7px solid #f5f5f5", top: "1px" } } }, "&dark .cm-tooltip .cm-tooltip-arrow": { "&:before": { borderTopColor: "#333338", borderBottomColor: "#333338" }, "&:after": { borderTopColor: "transparent", borderBottomColor: "transparent" } } });
var Fr = { x: 0, y: 0 };
var In = y.define({ enables: [We2, Vr] });
var Zt = y.define({ combine: (s212) => s212.reduce((t8, e7) => t8.concat(e7), []) });
var Be2 = class s45 {
  static create(t8) {
    return new s45(t8);
  }
  constructor(t8) {
    this.view = t8, this.mounted = false, this.dom = document.createElement("div"), this.dom.classList.add("cm-tooltip-hover"), this.manager = new Le2(t8, Zt, (e7, i12) => this.createHostedView(e7, i12), (e7) => e7.dom.remove());
  }
  createHostedView(t8, e7) {
    let i12 = t8.create(this.view);
    return i12.dom.classList.add("cm-tooltip-section"), this.dom.insertBefore(i12.dom, e7 ? e7.dom.nextSibling : this.dom.firstChild), this.mounted && i12.mount && i12.mount(this.view), i12;
  }
  mount(t8) {
    for (let e7 of this.manager.tooltipViews) e7.mount && e7.mount(t8);
    this.mounted = true;
  }
  positioned(t8) {
    for (let e7 of this.manager.tooltipViews) e7.positioned && e7.positioned(t8);
  }
  update(t8) {
    this.manager.update(t8);
  }
  destroy() {
    var t8;
    for (let e7 of this.manager.tooltipViews) (t8 = e7.destroy) === null || t8 === void 0 || t8.call(e7);
  }
  passProp(t8) {
    let e7;
    for (let i12 of this.manager.tooltipViews) {
      let n14 = i12[t8];
      if (n14 !== void 0) {
        if (e7 === void 0) e7 = n14;
        else if (e7 !== n14) return;
      }
    }
    return e7;
  }
  get offset() {
    return this.passProp("offset");
  }
  get getCoords() {
    return this.passProp("getCoords");
  }
  get overlap() {
    return this.passProp("overlap");
  }
  get resize() {
    return this.passProp("resize");
  }
};
var Wr = In.compute([Zt], (s212) => {
  let t8 = s212.facet(Zt);
  return t8.length === 0 ? null : { pos: Math.min(...t8.map((e7) => e7.pos)), end: Math.max(...t8.map((e7) => {
    var i12;
    return (i12 = e7.end) !== null && i12 !== void 0 ? i12 : e7.pos;
  })), create: Be2.create, above: t8[0].above, arrow: t8.some((e7) => e7.arrow) };
});
var Ei = class {
  constructor(t8, e7, i12, n14, o) {
    this.view = t8, this.source = e7, this.field = i12, this.setHover = n14, this.hoverTime = o, this.hoverTimeout = -1, this.restartTimeout = -1, this.pending = null, this.lastMove = { x: 0, y: 0, target: t8.dom, time: 0 }, this.checkHover = this.checkHover.bind(this), t8.dom.addEventListener("mouseleave", this.mouseleave = this.mouseleave.bind(this)), t8.dom.addEventListener("mousemove", this.mousemove = this.mousemove.bind(this));
  }
  update() {
    this.pending && (this.pending = null, clearTimeout(this.restartTimeout), this.restartTimeout = setTimeout(() => this.startHover(), 20));
  }
  get active() {
    return this.view.state.field(this.field);
  }
  checkHover() {
    if (this.hoverTimeout = -1, this.active.length) return;
    let t8 = Date.now() - this.lastMove.time;
    t8 < this.hoverTime ? this.hoverTimeout = setTimeout(this.checkHover, this.hoverTime - t8) : this.startHover();
  }
  startHover() {
    clearTimeout(this.restartTimeout);
    let { view: t8, lastMove: e7 } = this, i12 = t8.docView.nearest(e7.target);
    if (!i12) return;
    let n14, o = 1;
    if (i12 instanceof Yt) n14 = i12.posAtStart;
    else {
      if (n14 = t8.posAtCoords(e7), n14 == null) return;
      let l11 = t8.coordsAtPos(n14);
      if (!l11 || e7.y < l11.top || e7.y > l11.bottom || e7.x < l11.left - t8.defaultCharacterWidth || e7.x > l11.right + t8.defaultCharacterWidth) return;
      let h3 = t8.bidiSpans(t8.state.doc.lineAt(n14)).find((a2) => a2.from <= n14 && a2.to >= n14), c3 = h3 && h3.dir == L2.RTL ? -1 : 1;
      o = e7.x < l11.left ? -c3 : c3;
    }
    let r2 = this.source(t8, n14, o);
    if (r2?.then) {
      let l11 = this.pending = { pos: n14 };
      r2.then((h3) => {
        this.pending == l11 && (this.pending = null, h3 && !(Array.isArray(h3) && !h3.length) && t8.dispatch({ effects: this.setHover.of(Array.isArray(h3) ? h3 : [h3]) }));
      }, (h3) => $2(t8.state, h3, "hover tooltip"));
    } else r2 && !(Array.isArray(r2) && !r2.length) && t8.dispatch({ effects: this.setHover.of(Array.isArray(r2) ? r2 : [r2]) });
  }
  get tooltip() {
    let t8 = this.view.plugin(We2), e7 = t8 ? t8.manager.tooltips.findIndex((i12) => i12.create == Be2.create) : -1;
    return e7 > -1 ? t8.manager.tooltipViews[e7] : null;
  }
  mousemove(t8) {
    var e7, i12;
    this.lastMove = { x: t8.clientX, y: t8.clientY, target: t8.target, time: Date.now() }, this.hoverTimeout < 0 && (this.hoverTimeout = setTimeout(this.checkHover, this.hoverTime));
    let { active: n14, tooltip: o } = this;
    if (n14.length && o && !zr(o.dom, t8) || this.pending) {
      let { pos: r2 } = n14[0] || this.pending, l11 = (i12 = (e7 = n14[0]) === null || e7 === void 0 ? void 0 : e7.end) !== null && i12 !== void 0 ? i12 : r2;
      (r2 == l11 ? this.view.posAtCoords(this.lastMove) != r2 : !Ir(this.view, r2, l11, t8.clientX, t8.clientY)) && (this.view.dispatch({ effects: this.setHover.of([]) }), this.pending = null);
    }
  }
  mouseleave(t8) {
    clearTimeout(this.hoverTimeout), this.hoverTimeout = -1;
    let { active: e7 } = this;
    if (e7.length) {
      let { tooltip: i12 } = this;
      i12 && i12.dom.contains(t8.relatedTarget) ? this.watchTooltipLeave(i12.dom) : this.view.dispatch({ effects: this.setHover.of([]) });
    }
  }
  watchTooltipLeave(t8) {
    let e7 = (i12) => {
      t8.removeEventListener("mouseleave", e7), this.active.length && !this.view.dom.contains(i12.relatedTarget) && this.view.dispatch({ effects: this.setHover.of([]) });
    };
    t8.addEventListener("mouseleave", e7);
  }
  destroy() {
    clearTimeout(this.hoverTimeout), this.view.dom.removeEventListener("mouseleave", this.mouseleave), this.view.dom.removeEventListener("mousemove", this.mousemove);
  }
};
var de2 = 4;
function zr(s212, t8) {
  let { left: e7, right: i12, top: n14, bottom: o } = s212.getBoundingClientRect(), r2;
  if (r2 = s212.querySelector(".cm-tooltip-arrow")) {
    let l11 = r2.getBoundingClientRect();
    n14 = Math.min(l11.top, n14), o = Math.max(l11.bottom, o);
  }
  return t8.clientX >= e7 - de2 && t8.clientX <= i12 + de2 && t8.clientY >= n14 - de2 && t8.clientY <= o + de2;
}
function Ir(s212, t8, e7, i12, n14, o) {
  let r2 = s212.scrollDOM.getBoundingClientRect(), l11 = s212.documentTop + s212.documentPadding.top + s212.contentHeight;
  if (r2.left > i12 || r2.right < i12 || r2.top > n14 || Math.min(r2.bottom, l11) < n14) return false;
  let h3 = s212.posAtCoords({ x: i12, y: n14 }, false);
  return h3 >= t8 && h3 <= e7;
}
function ml(s212, t8 = {}) {
  let e7 = v.define(), i12 = z.define({ create() {
    return [];
  }, update(n14, o) {
    if (n14.length && (t8.hideOnChange && (o.docChanged || o.selection) ? n14 = [] : t8.hideOn && (n14 = n14.filter((r2) => !t8.hideOn(o, r2))), o.docChanged)) {
      let r2 = [];
      for (let l11 of n14) {
        let h3 = o.changes.mapPos(l11.pos, -1, E.TrackDel);
        if (h3 != null) {
          let c3 = Object.assign(/* @__PURE__ */ Object.create(null), l11);
          c3.pos = h3, c3.end != null && (c3.end = o.changes.mapPos(c3.end)), r2.push(c3);
        }
      }
      n14 = r2;
    }
    for (let r2 of o.effects) r2.is(e7) && (n14 = r2.value), r2.is(Kn) && (n14 = []);
    return n14;
  }, provide: (n14) => Zt.from(n14) });
  return { active: i12, extension: [i12, N2.define((n14) => new Ei(n14, s212, i12, e7, t8.hoverTime || 300)), Wr] };
}
var Kn = v.define();
var wl = Kn.of(null);
var Li = y.define({ combine(s212) {
  let t8, e7;
  for (let i12 of s212) t8 = t8 || i12.topContainer, e7 = e7 || i12.bottomContainer;
  return { topContainer: t8, bottomContainer: e7 };
} });
function Sl(s212, t8) {
  let e7 = s212.plugin(qn), i12 = e7 ? e7.specs.indexOf(t8) : -1;
  return i12 > -1 ? e7.panels[i12] : null;
}
var qn = N2.fromClass(class {
  constructor(s212) {
    this.input = s212.state.facet(Rs), this.specs = this.input.filter((e7) => e7), this.panels = this.specs.map((e7) => e7(s212));
    let t8 = s212.state.facet(Li);
    this.top = new vt(s212, true, t8.topContainer), this.bottom = new vt(s212, false, t8.bottomContainer), this.top.sync(this.panels.filter((e7) => e7.top)), this.bottom.sync(this.panels.filter((e7) => !e7.top));
    for (let e7 of this.panels) e7.dom.classList.add("cm-panel"), e7.mount && e7.mount();
  }
  update(s212) {
    let t8 = s212.state.facet(Li);
    this.top.container != t8.topContainer && (this.top.sync([]), this.top = new vt(s212.view, true, t8.topContainer)), this.bottom.container != t8.bottomContainer && (this.bottom.sync([]), this.bottom = new vt(s212.view, false, t8.bottomContainer)), this.top.syncClasses(), this.bottom.syncClasses();
    let e7 = s212.state.facet(Rs);
    if (e7 != this.input) {
      let i12 = e7.filter((h3) => h3), n14 = [], o = [], r2 = [], l11 = [];
      for (let h3 of i12) {
        let c3 = this.specs.indexOf(h3), a2;
        c3 < 0 ? (a2 = h3(s212.view), l11.push(a2)) : (a2 = this.panels[c3], a2.update && a2.update(s212)), n14.push(a2), (a2.top ? o : r2).push(a2);
      }
      this.specs = i12, this.panels = n14, this.top.sync(o), this.bottom.sync(r2);
      for (let h3 of l11) h3.dom.classList.add("cm-panel"), h3.mount && h3.mount();
    } else for (let i12 of this.panels) i12.update && i12.update(s212);
  }
  destroy() {
    this.top.sync([]), this.bottom.sync([]);
  }
}, { provide: (s212) => A2.scrollMargins.of((t8) => {
  let e7 = t8.plugin(s212);
  return e7 && { top: e7.top.scrollMargin(), bottom: e7.bottom.scrollMargin() };
}) });
var vt = class {
  constructor(t8, e7, i12) {
    this.view = t8, this.top = e7, this.container = i12, this.dom = void 0, this.classes = "", this.panels = [], this.syncClasses();
  }
  sync(t8) {
    for (let e7 of this.panels) e7.destroy && t8.indexOf(e7) < 0 && e7.destroy();
    this.panels = t8, this.syncDOM();
  }
  syncDOM() {
    if (this.panels.length == 0) {
      this.dom && (this.dom.remove(), this.dom = void 0);
      return;
    }
    if (!this.dom) {
      this.dom = document.createElement("div"), this.dom.className = this.top ? "cm-panels cm-panels-top" : "cm-panels cm-panels-bottom", this.dom.style[this.top ? "top" : "bottom"] = "0";
      let e7 = this.container || this.view.dom;
      e7.insertBefore(this.dom, this.top ? e7.firstChild : null);
    }
    let t8 = this.dom.firstChild;
    for (let e7 of this.panels) if (e7.dom.parentNode == this.dom) {
      for (; t8 != e7.dom; ) t8 = Ts(t8);
      t8 = t8.nextSibling;
    } else this.dom.insertBefore(e7.dom, t8);
    for (; t8; ) t8 = Ts(t8);
  }
  scrollMargin() {
    return !this.dom || this.container ? 0 : Math.max(0, this.top ? this.dom.getBoundingClientRect().bottom - Math.max(0, this.view.scrollDOM.getBoundingClientRect().top) : Math.min(innerHeight, this.view.scrollDOM.getBoundingClientRect().bottom) - this.dom.getBoundingClientRect().top);
  }
  syncClasses() {
    if (!(!this.container || this.classes == this.view.themeClasses)) {
      for (let t8 of this.classes.split(" ")) t8 && this.container.classList.remove(t8);
      for (let t8 of (this.classes = this.view.themeClasses).split(" ")) t8 && this.container.classList.add(t8);
    }
  }
};
function Ts(s212) {
  let t8 = s212.nextSibling;
  return s212.remove(), t8;
}
var Rs = y.define({ enables: qn });
var J2 = class extends W {
  compare(t8) {
    return this == t8 || this.constructor == t8.constructor && this.eq(t8);
  }
  eq(t8) {
    return false;
  }
  destroy(t8) {
  }
};
J2.prototype.elementClass = "";
J2.prototype.toDOM = void 0;
J2.prototype.mapMode = E.TrackBefore;
J2.prototype.startSide = J2.prototype.endSide = -1;
J2.prototype.point = true;
var we2 = y.define();
var Kr = y.define();
var qr = { class: "", renderEmptyElements: false, elementStyle: "", markers: () => T.empty, lineMarker: () => null, widgetMarker: () => null, lineMarkerChange: null, initialSpacer: null, updateSpacer: null, domEventHandlers: {} };
var Kt = y.define();
function Cl(s212) {
  return [jn(), Kt.of(Object.assign(Object.assign({}, qr), s212))];
}
var Bi = y.define({ combine: (s212) => s212.some((t8) => t8) });
function jn(s212) {
  let t8 = [jr];
  return s212 && s212.fixed === false && t8.push(Bi.of(true)), t8;
}
var jr = N2.fromClass(class {
  constructor(s212) {
    this.view = s212, this.prevViewport = s212.viewport, this.dom = document.createElement("div"), this.dom.className = "cm-gutters", this.dom.setAttribute("aria-hidden", "true"), this.dom.style.minHeight = this.view.contentHeight / this.view.scaleY + "px", this.gutters = s212.state.facet(Kt).map((t8) => new Pe2(s212, t8));
    for (let t8 of this.gutters) this.dom.appendChild(t8.dom);
    this.fixed = !s212.state.facet(Bi), this.fixed && (this.dom.style.position = "sticky"), this.syncGutters(false), s212.scrollDOM.insertBefore(this.dom, s212.contentDOM);
  }
  update(s212) {
    if (this.updateGutters(s212)) {
      let t8 = this.prevViewport, e7 = s212.view.viewport, i12 = Math.min(t8.to, e7.to) - Math.max(t8.from, e7.from);
      this.syncGutters(i12 < (e7.to - e7.from) * 0.8);
    }
    s212.geometryChanged && (this.dom.style.minHeight = this.view.contentHeight / this.view.scaleY + "px"), this.view.state.facet(Bi) != !this.fixed && (this.fixed = !this.fixed, this.dom.style.position = this.fixed ? "sticky" : ""), this.prevViewport = s212.view.viewport;
  }
  syncGutters(s212) {
    let t8 = this.dom.nextSibling;
    s212 && this.dom.remove();
    let e7 = T.iter(this.view.state.facet(we2), this.view.viewport.from), i12 = [], n14 = this.gutters.map((o) => new Hi(o, this.view.viewport, -this.view.documentPadding.top));
    for (let o of this.view.viewportLineBlocks) if (i12.length && (i12 = []), Array.isArray(o.type)) {
      let r2 = true;
      for (let l11 of o.type) if (l11.type == F2.Text && r2) {
        Pi(e7, i12, l11.from);
        for (let h3 of n14) h3.line(this.view, l11, i12);
        r2 = false;
      } else if (l11.widget) for (let h3 of n14) h3.widget(this.view, l11);
    } else if (o.type == F2.Text) {
      Pi(e7, i12, o.from);
      for (let r2 of n14) r2.line(this.view, o, i12);
    } else if (o.widget) for (let r2 of n14) r2.widget(this.view, o);
    for (let o of n14) o.finish();
    s212 && this.view.scrollDOM.insertBefore(this.dom, t8);
  }
  updateGutters(s212) {
    let t8 = s212.startState.facet(Kt), e7 = s212.state.facet(Kt), i12 = s212.docChanged || s212.heightChanged || s212.viewportChanged || !T.eq(s212.startState.facet(we2), s212.state.facet(we2), s212.view.viewport.from, s212.view.viewport.to);
    if (t8 == e7) for (let n14 of this.gutters) n14.update(s212) && (i12 = true);
    else {
      i12 = true;
      let n14 = [];
      for (let o of e7) {
        let r2 = t8.indexOf(o);
        r2 < 0 ? n14.push(new Pe2(this.view, o)) : (this.gutters[r2].update(s212), n14.push(this.gutters[r2]));
      }
      for (let o of this.gutters) o.dom.remove(), n14.indexOf(o) < 0 && o.destroy();
      for (let o of n14) this.dom.appendChild(o.dom);
      this.gutters = n14;
    }
    return i12;
  }
  destroy() {
    for (let s212 of this.gutters) s212.destroy();
    this.dom.remove();
  }
}, { provide: (s212) => A2.scrollMargins.of((t8) => {
  let e7 = t8.plugin(s212);
  return !e7 || e7.gutters.length == 0 || !e7.fixed ? null : t8.textDirection == L2.LTR ? { left: e7.dom.offsetWidth * t8.scaleX } : { right: e7.dom.offsetWidth * t8.scaleX };
}) });
function Es(s212) {
  return Array.isArray(s212) ? s212 : [s212];
}
function Pi(s212, t8, e7) {
  for (; s212.value && s212.from <= e7; ) s212.from == e7 && t8.push(s212.value), s212.next();
}
var Hi = class {
  constructor(t8, e7, i12) {
    this.gutter = t8, this.height = i12, this.i = 0, this.cursor = T.iter(t8.markers, e7.from);
  }
  addElement(t8, e7, i12) {
    let { gutter: n14 } = this, o = (e7.top - this.height) / t8.scaleY, r2 = e7.height / t8.scaleY;
    if (this.i == n14.elements.length) {
      let l11 = new He2(t8, r2, o, i12);
      n14.elements.push(l11), n14.dom.appendChild(l11.dom);
    } else n14.elements[this.i].update(t8, r2, o, i12);
    this.height = e7.bottom, this.i++;
  }
  line(t8, e7, i12) {
    let n14 = [];
    Pi(this.cursor, n14, e7.from), i12.length && (n14 = n14.concat(i12));
    let o = this.gutter.config.lineMarker(t8, e7, n14);
    o && n14.unshift(o);
    let r2 = this.gutter;
    n14.length == 0 && !r2.config.renderEmptyElements || this.addElement(t8, e7, n14);
  }
  widget(t8, e7) {
    let i12 = this.gutter.config.widgetMarker(t8, e7.widget, e7), n14 = i12 ? [i12] : null;
    for (let o of t8.state.facet(Kr)) {
      let r2 = o(t8, e7.widget, e7);
      r2 && (n14 || (n14 = [])).push(r2);
    }
    n14 && this.addElement(t8, e7, n14);
  }
  finish() {
    let t8 = this.gutter;
    for (; t8.elements.length > this.i; ) {
      let e7 = t8.elements.pop();
      t8.dom.removeChild(e7.dom), e7.destroy();
    }
  }
};
var Pe2 = class {
  constructor(t8, e7) {
    this.view = t8, this.config = e7, this.elements = [], this.spacer = null, this.dom = document.createElement("div"), this.dom.className = "cm-gutter" + (this.config.class ? " " + this.config.class : "");
    for (let i12 in e7.domEventHandlers) this.dom.addEventListener(i12, (n14) => {
      let o = n14.target, r2;
      if (o != this.dom && this.dom.contains(o)) {
        for (; o.parentNode != this.dom; ) o = o.parentNode;
        let h3 = o.getBoundingClientRect();
        r2 = (h3.top + h3.bottom) / 2;
      } else r2 = n14.clientY;
      let l11 = t8.lineBlockAtHeight(r2 - t8.documentTop);
      e7.domEventHandlers[i12](t8, l11, n14) && n14.preventDefault();
    });
    this.markers = Es(e7.markers(t8)), e7.initialSpacer && (this.spacer = new He2(t8, 0, 0, [e7.initialSpacer(t8)]), this.dom.appendChild(this.spacer.dom), this.spacer.dom.style.cssText += "visibility: hidden; pointer-events: none");
  }
  update(t8) {
    let e7 = this.markers;
    if (this.markers = Es(this.config.markers(t8.view)), this.spacer && this.config.updateSpacer) {
      let n14 = this.config.updateSpacer(this.spacer.markers[0], t8);
      n14 != this.spacer.markers[0] && this.spacer.update(t8.view, 0, 0, [n14]);
    }
    let i12 = t8.view.viewport;
    return !T.eq(this.markers, e7, i12.from, i12.to) || (this.config.lineMarkerChange ? this.config.lineMarkerChange(t8) : false);
  }
  destroy() {
    for (let t8 of this.elements) t8.destroy();
  }
};
var He2 = class {
  constructor(t8, e7, i12, n14) {
    this.height = -1, this.above = 0, this.markers = [], this.dom = document.createElement("div"), this.dom.className = "cm-gutterElement", this.update(t8, e7, i12, n14);
  }
  update(t8, e7, i12, n14) {
    this.height != e7 && (this.height = e7, this.dom.style.height = e7 + "px"), this.above != i12 && (this.dom.style.marginTop = (this.above = i12) ? i12 + "px" : ""), Yr(this.markers, n14) || this.setMarkers(t8, n14);
  }
  setMarkers(t8, e7) {
    let i12 = "cm-gutterElement", n14 = this.dom.firstChild;
    for (let o = 0, r2 = 0; ; ) {
      let l11 = r2, h3 = o < e7.length ? e7[o++] : null, c3 = false;
      if (h3) {
        let a2 = h3.elementClass;
        a2 && (i12 += " " + a2);
        for (let f6 = r2; f6 < this.markers.length; f6++) if (this.markers[f6].compare(h3)) {
          l11 = f6, c3 = true;
          break;
        }
      } else l11 = this.markers.length;
      for (; r2 < l11; ) {
        let a2 = this.markers[r2++];
        if (a2.toDOM) {
          a2.destroy(n14);
          let f6 = n14.nextSibling;
          n14.remove(), n14 = f6;
        }
      }
      if (!h3) break;
      h3.toDOM && (c3 ? n14 = n14.nextSibling : this.dom.insertBefore(h3.toDOM(t8), n14)), c3 && r2++;
    }
    this.dom.className = i12, this.markers = e7;
  }
  destroy() {
    this.setMarkers(null, []);
  }
};
function Yr(s212, t8) {
  if (s212.length != t8.length) return false;
  for (let e7 = 0; e7 < s212.length; e7++) if (!s212[e7].compare(t8[e7])) return false;
  return true;
}
var _r = y.define();
var Xr = y.define();
var St = y.define({ combine(s212) {
  return at(s212, { formatNumber: String, domEventHandlers: {} }, { domEventHandlers(t8, e7) {
    let i12 = Object.assign({}, t8);
    for (let n14 in e7) {
      let o = i12[n14], r2 = e7[n14];
      i12[n14] = o ? (l11, h3, c3) => o(l11, h3, c3) || r2(l11, h3, c3) : r2;
    }
    return i12;
  } });
} });
var qt = class extends J2 {
  constructor(t8) {
    super(), this.number = t8;
  }
  eq(t8) {
    return this.number == t8.number;
  }
  toDOM() {
    return document.createTextNode(this.number);
  }
};
function Ye2(s212, t8) {
  return s212.state.facet(St).formatNumber(t8, s212.state);
}
var Gr = Kt.compute([St], (s212) => ({ class: "cm-lineNumbers", renderEmptyElements: false, markers(t8) {
  return t8.state.facet(_r);
}, lineMarker(t8, e7, i12) {
  return i12.some((n14) => n14.toDOM) ? null : new qt(Ye2(t8, t8.state.doc.lineAt(e7.from).number));
}, widgetMarker: (t8, e7, i12) => {
  for (let n14 of t8.state.facet(Xr)) {
    let o = n14(t8, e7, i12);
    if (o) return o;
  }
  return null;
}, lineMarkerChange: (t8) => t8.startState.facet(St) != t8.state.facet(St), initialSpacer(t8) {
  return new qt(Ye2(t8, Ls(t8.state.doc.lines)));
}, updateSpacer(t8, e7) {
  let i12 = Ye2(e7.view, Ls(e7.view.state.doc.lines));
  return i12 == t8.number ? t8 : new qt(i12);
}, domEventHandlers: s212.facet(St).domEventHandlers }));
function Ls(s212) {
  let t8 = 9;
  for (; t8 < s212; ) t8 = t8 * 10 + 9;
  return t8;
}
var $r = new class extends J2 {
  constructor() {
    super(...arguments), this.elementClass = "cm-activeLineGutter";
  }
}();
var Ur = we2.compute(["selection"], (s212) => {
  let t8 = [], e7 = -1;
  for (let i12 of s212.selection.ranges) {
    let n14 = s212.doc.lineAt(i12.head).from;
    n14 > e7 && (e7 = n14, t8.push($r.range(n14)));
  }
  return T.of(t8);
});
function Yn(s212) {
  return N2.define((t8) => ({ decorations: s212.createDeco(t8), update(e7) {
    this.decorations = s212.updateDeco(e7, this.decorations);
  } }), { decorations: (t8) => t8.decorations });
}
var Qr = O2.mark({ class: "cm-highlightTab" });
var Jr = O2.mark({ class: "cm-highlightSpace" });
var Zr = Yn(new Jt({ regexp: /\t| /g, decoration: (s212) => s212[0] == "	" ? Qr : Jr, boundary: /\S/ }));
var tl = Yn(new Jt({ regexp: /\s+$/g, decoration: O2.mark({ class: "cm-trailingSpace" }), boundary: /\S/ }));

// https://esm.sh/v135/@lezer/common@1.2.1/denonext/common.mjs
var Be3 = 0;
var z3 = class {
  constructor(e7, t8) {
    this.from = e7, this.to = t8;
  }
};
var v2 = class {
  constructor(e7 = {}) {
    this.id = Be3++, this.perNode = !!e7.perNode, this.deserialize = e7.deserialize || (() => {
      throw new Error("This node type doesn't define a deserialize function");
    });
  }
  add(e7) {
    if (this.perNode) throw new RangeError("Can't add per-node props to node types");
    return typeof e7 != "function" && (e7 = F3.match(e7)), (t8) => {
      let r2 = e7(t8);
      return r2 === void 0 ? null : [this, r2];
    };
  }
};
v2.closedBy = new v2({ deserialize: (s212) => s212.split(" ") });
v2.openedBy = new v2({ deserialize: (s212) => s212.split(" ") });
v2.group = new v2({ deserialize: (s212) => s212.split(" ") });
v2.isolate = new v2({ deserialize: (s212) => {
  if (s212 && s212 != "rtl" && s212 != "ltr" && s212 != "auto") throw new RangeError("Invalid value for isolate: " + s212);
  return s212 || "auto";
} });
v2.contextHash = new v2({ perNode: true });
v2.lookAhead = new v2({ perNode: true });
v2.mounted = new v2({ perNode: true });
var V3 = class {
  constructor(e7, t8, r2) {
    this.tree = e7, this.overlay = t8, this.parser = r2;
  }
  static get(e7) {
    return e7 && e7.props && e7.props[v2.mounted.id];
  }
};
var ze3 = /* @__PURE__ */ Object.create(null);
var F3 = class s46 {
  constructor(e7, t8, r2, i12 = 0) {
    this.name = e7, this.props = t8, this.id = r2, this.flags = i12;
  }
  static define(e7) {
    let t8 = e7.props && e7.props.length ? /* @__PURE__ */ Object.create(null) : ze3, r2 = (e7.top ? 1 : 0) | (e7.skipped ? 2 : 0) | (e7.error ? 4 : 0) | (e7.name == null ? 8 : 0), i12 = new s46(e7.name || "", t8, e7.id, r2);
    if (e7.props) {
      for (let n14 of e7.props) if (Array.isArray(n14) || (n14 = n14(i12)), n14) {
        if (n14[0].perNode) throw new RangeError("Can't store a per-node prop on a node type");
        t8[n14[0].id] = n14[1];
      }
    }
    return i12;
  }
  prop(e7) {
    return this.props[e7.id];
  }
  get isTop() {
    return (this.flags & 1) > 0;
  }
  get isSkipped() {
    return (this.flags & 2) > 0;
  }
  get isError() {
    return (this.flags & 4) > 0;
  }
  get isAnonymous() {
    return (this.flags & 8) > 0;
  }
  is(e7) {
    if (typeof e7 == "string") {
      if (this.name == e7) return true;
      let t8 = this.prop(v2.group);
      return t8 ? t8.indexOf(e7) > -1 : false;
    }
    return this.id == e7;
  }
  static match(e7) {
    let t8 = /* @__PURE__ */ Object.create(null);
    for (let r2 in e7) for (let i12 of r2.split(" ")) t8[i12] = e7[r2];
    return (r2) => {
      for (let i12 = r2.prop(v2.group), n14 = -1; n14 < (i12 ? i12.length : 0); n14++) {
        let l11 = t8[n14 < 0 ? r2.name : i12[n14]];
        if (l11) return l11;
      }
    };
  }
};
F3.none = new F3("", /* @__PURE__ */ Object.create(null), 0, 8);
var ye3 = class s47 {
  constructor(e7) {
    this.types = e7;
    for (let t8 = 0; t8 < e7.length; t8++) if (e7[t8].id != t8) throw new RangeError("Node type ids should correspond to array positions when creating a node set");
  }
  extend(...e7) {
    let t8 = [];
    for (let r2 of this.types) {
      let i12 = null;
      for (let n14 of e7) {
        let l11 = n14(r2);
        l11 && (i12 || (i12 = Object.assign({}, r2.props)), i12[l11[0].id] = l11[1]);
      }
      t8.push(i12 ? new F3(r2.name, i12, r2.id, r2.flags) : r2);
    }
    return new s47(t8);
  }
};
var Y3 = /* @__PURE__ */ new WeakMap();
var xe3 = /* @__PURE__ */ new WeakMap();
var S3;
(function(s212) {
  s212[s212.ExcludeBuffers = 1] = "ExcludeBuffers", s212[s212.IncludeAnonymous = 2] = "IncludeAnonymous", s212[s212.IgnoreMounts = 4] = "IgnoreMounts", s212[s212.IgnoreOverlays = 8] = "IgnoreOverlays";
})(S3 || (S3 = {}));
var O3 = class s48 {
  constructor(e7, t8, r2, i12, n14) {
    if (this.type = e7, this.children = t8, this.positions = r2, this.length = i12, this.props = null, n14 && n14.length) {
      this.props = /* @__PURE__ */ Object.create(null);
      for (let [l11, h3] of n14) this.props[typeof l11 == "number" ? l11 : l11.id] = h3;
    }
  }
  toString() {
    let e7 = V3.get(this);
    if (e7 && !e7.overlay) return e7.tree.toString();
    let t8 = "";
    for (let r2 of this.children) {
      let i12 = r2.toString();
      i12 && (t8 && (t8 += ","), t8 += i12);
    }
    return this.type.name ? (/\W/.test(this.type.name) && !this.type.isError ? JSON.stringify(this.type.name) : this.type.name) + (t8.length ? "(" + t8 + ")" : "") : t8;
  }
  cursor(e7 = 0) {
    return new K3(this.topNode, e7);
  }
  cursorAt(e7, t8 = 0, r2 = 0) {
    let i12 = Y3.get(this) || this.topNode, n14 = new K3(i12);
    return n14.moveTo(e7, t8), Y3.set(this, n14._tree), n14;
  }
  get topNode() {
    return new P2(this, 0, 0, null);
  }
  resolve(e7, t8 = 0) {
    let r2 = Q3(Y3.get(this) || this.topNode, e7, t8, false);
    return Y3.set(this, r2), r2;
  }
  resolveInner(e7, t8 = 0) {
    let r2 = Q3(xe3.get(this) || this.topNode, e7, t8, true);
    return xe3.set(this, r2), r2;
  }
  resolveStack(e7, t8 = 0) {
    return Pe3(this, e7, t8);
  }
  iterate(e7) {
    let { enter: t8, leave: r2, from: i12 = 0, to: n14 = this.length } = e7, l11 = e7.mode || 0, h3 = (l11 & S3.IncludeAnonymous) > 0;
    for (let f6 = this.cursor(l11 | S3.IncludeAnonymous); ; ) {
      let a2 = false;
      if (f6.from <= n14 && f6.to >= i12 && (!h3 && f6.type.isAnonymous || t8(f6) !== false)) {
        if (f6.firstChild()) continue;
        a2 = true;
      }
      for (; a2 && r2 && (h3 || !f6.type.isAnonymous) && r2(f6), !f6.nextSibling(); ) {
        if (!f6.parent()) return;
        a2 = true;
      }
    }
  }
  prop(e7) {
    return e7.perNode ? this.props ? this.props[e7.id] : void 0 : this.type.prop(e7);
  }
  get propValues() {
    let e7 = [];
    if (this.props) for (let t8 in this.props) e7.push([+t8, this.props[t8]]);
    return e7;
  }
  balance(e7 = {}) {
    return this.children.length <= 8 ? this : ce3(F3.none, this.children, this.positions, 0, this.children.length, 0, this.length, (t8, r2, i12) => new s48(this.type, t8, r2, i12, this.propValues), e7.makeTree || ((t8, r2, i12) => new s48(F3.none, t8, r2, i12)));
  }
  static build(e7) {
    return Ee3(e7);
  }
};
O3.empty = new O3(F3.none, [], [], 0);
var ne3 = class s49 {
  constructor(e7, t8) {
    this.buffer = e7, this.index = t8;
  }
  get id() {
    return this.buffer[this.index - 4];
  }
  get start() {
    return this.buffer[this.index - 3];
  }
  get end() {
    return this.buffer[this.index - 2];
  }
  get size() {
    return this.buffer[this.index - 1];
  }
  get pos() {
    return this.index;
  }
  next() {
    this.index -= 4;
  }
  fork() {
    return new s49(this.buffer, this.index);
  }
};
var U3 = class s50 {
  constructor(e7, t8, r2) {
    this.buffer = e7, this.length = t8, this.set = r2;
  }
  get type() {
    return F3.none;
  }
  toString() {
    let e7 = [];
    for (let t8 = 0; t8 < this.buffer.length; ) e7.push(this.childString(t8)), t8 = this.buffer[t8 + 3];
    return e7.join(",");
  }
  childString(e7) {
    let t8 = this.buffer[e7], r2 = this.buffer[e7 + 3], i12 = this.set.types[t8], n14 = i12.name;
    if (/\W/.test(n14) && !i12.isError && (n14 = JSON.stringify(n14)), e7 += 4, r2 == e7) return n14;
    let l11 = [];
    for (; e7 < r2; ) l11.push(this.childString(e7)), e7 = this.buffer[e7 + 3];
    return n14 + "(" + l11.join(",") + ")";
  }
  findChild(e7, t8, r2, i12, n14) {
    let { buffer: l11 } = this, h3 = -1;
    for (let f6 = e7; f6 != t8 && !(Ie3(n14, i12, l11[f6 + 1], l11[f6 + 2]) && (h3 = f6, r2 > 0)); f6 = l11[f6 + 3]) ;
    return h3;
  }
  slice(e7, t8, r2) {
    let i12 = this.buffer, n14 = new Uint16Array(t8 - e7), l11 = 0;
    for (let h3 = e7, f6 = 0; h3 < t8; ) {
      n14[f6++] = i12[h3++], n14[f6++] = i12[h3++] - r2;
      let a2 = n14[f6++] = i12[h3++] - r2;
      n14[f6++] = i12[h3++] - e7, l11 = Math.max(l11, a2);
    }
    return new s50(n14, l11, this.set);
  }
};
function Ie3(s212, e7, t8, r2) {
  switch (s212) {
    case -2:
      return t8 < e7;
    case -1:
      return r2 >= e7 && t8 < e7;
    case 0:
      return t8 < e7 && r2 > e7;
    case 1:
      return t8 <= e7 && r2 > e7;
    case 2:
      return r2 > e7;
    case 4:
      return true;
  }
}
function Q3(s212, e7, t8, r2) {
  for (var i12; s212.from == s212.to || (t8 < 1 ? s212.from >= e7 : s212.from > e7) || (t8 > -1 ? s212.to <= e7 : s212.to < e7); ) {
    let l11 = !r2 && s212 instanceof P2 && s212.index < 0 ? null : s212.parent;
    if (!l11) return s212;
    s212 = l11;
  }
  let n14 = r2 ? 0 : S3.IgnoreOverlays;
  if (r2) for (let l11 = s212, h3 = l11.parent; h3; l11 = h3, h3 = l11.parent) l11 instanceof P2 && l11.index < 0 && ((i12 = h3.enter(e7, t8, n14)) === null || i12 === void 0 ? void 0 : i12.from) != l11.from && (s212 = h3);
  for (; ; ) {
    let l11 = s212.enter(e7, t8, n14);
    if (!l11) return s212;
    s212 = l11;
  }
}
var ee2 = class {
  cursor(e7 = 0) {
    return new K3(this, e7);
  }
  getChild(e7, t8 = null, r2 = null) {
    let i12 = be3(this, e7, t8, r2);
    return i12.length ? i12[0] : null;
  }
  getChildren(e7, t8 = null, r2 = null) {
    return be3(this, e7, t8, r2);
  }
  resolve(e7, t8 = 0) {
    return Q3(this, e7, t8, false);
  }
  resolveInner(e7, t8 = 0) {
    return Q3(this, e7, t8, true);
  }
  matchContext(e7) {
    return se2(this, e7);
  }
  enterUnfinishedNodesBefore(e7) {
    let t8 = this.childBefore(e7), r2 = this;
    for (; t8; ) {
      let i12 = t8.lastChild;
      if (!i12 || i12.to != t8.to) break;
      i12.type.isError && i12.from == i12.to ? (r2 = t8, t8 = i12.prevSibling) : t8 = i12;
    }
    return r2;
  }
  get node() {
    return this;
  }
  get next() {
    return this.parent;
  }
};
var P2 = class s51 extends ee2 {
  constructor(e7, t8, r2, i12) {
    super(), this._tree = e7, this.from = t8, this.index = r2, this._parent = i12;
  }
  get type() {
    return this._tree.type;
  }
  get name() {
    return this._tree.type.name;
  }
  get to() {
    return this.from + this._tree.length;
  }
  nextChild(e7, t8, r2, i12, n14 = 0) {
    for (let l11 = this; ; ) {
      for (let { children: h3, positions: f6 } = l11._tree, a2 = t8 > 0 ? h3.length : -1; e7 != a2; e7 += t8) {
        let o = h3[e7], d4 = f6[e7] + l11.from;
        if (Ie3(i12, r2, d4, d4 + o.length)) {
          if (o instanceof U3) {
            if (n14 & S3.ExcludeBuffers) continue;
            let p3 = o.findChild(0, o.buffer.length, t8, r2 - d4, i12);
            if (p3 > -1) return new G3(new le3(l11, o, e7, d4), null, p3);
          } else if (n14 & S3.IncludeAnonymous || !o.type.isAnonymous || de3(o)) {
            let p3;
            if (!(n14 & S3.IgnoreMounts) && (p3 = V3.get(o)) && !p3.overlay) return new s51(p3.tree, d4, e7, l11);
            let x11 = new s51(o, d4, e7, l11);
            return n14 & S3.IncludeAnonymous || !x11.type.isAnonymous ? x11 : x11.nextChild(t8 < 0 ? o.children.length - 1 : 0, t8, r2, i12);
          }
        }
      }
      if (n14 & S3.IncludeAnonymous || !l11.type.isAnonymous || (l11.index >= 0 ? e7 = l11.index + t8 : e7 = t8 < 0 ? -1 : l11._parent._tree.children.length, l11 = l11._parent, !l11)) return null;
    }
  }
  get firstChild() {
    return this.nextChild(0, 1, 0, 4);
  }
  get lastChild() {
    return this.nextChild(this._tree.children.length - 1, -1, 0, 4);
  }
  childAfter(e7) {
    return this.nextChild(0, 1, e7, 2);
  }
  childBefore(e7) {
    return this.nextChild(this._tree.children.length - 1, -1, e7, -2);
  }
  enter(e7, t8, r2 = 0) {
    let i12;
    if (!(r2 & S3.IgnoreOverlays) && (i12 = V3.get(this._tree)) && i12.overlay) {
      let n14 = e7 - this.from;
      for (let { from: l11, to: h3 } of i12.overlay) if ((t8 > 0 ? l11 <= n14 : l11 < n14) && (t8 < 0 ? h3 >= n14 : h3 > n14)) return new s51(i12.tree, i12.overlay[0].from + this.from, -1, this);
    }
    return this.nextChild(0, 1, e7, t8, r2);
  }
  nextSignificantParent() {
    let e7 = this;
    for (; e7.type.isAnonymous && e7._parent; ) e7 = e7._parent;
    return e7;
  }
  get parent() {
    return this._parent ? this._parent.nextSignificantParent() : null;
  }
  get nextSibling() {
    return this._parent && this.index >= 0 ? this._parent.nextChild(this.index + 1, 1, 0, 4) : null;
  }
  get prevSibling() {
    return this._parent && this.index >= 0 ? this._parent.nextChild(this.index - 1, -1, 0, 4) : null;
  }
  get tree() {
    return this._tree;
  }
  toTree() {
    return this._tree;
  }
  toString() {
    return this._tree.toString();
  }
};
function be3(s212, e7, t8, r2) {
  let i12 = s212.cursor(), n14 = [];
  if (!i12.firstChild()) return n14;
  if (t8 != null) {
    for (let l11 = false; !l11; ) if (l11 = i12.type.is(t8), !i12.nextSibling()) return n14;
  }
  for (; ; ) {
    if (r2 != null && i12.type.is(r2)) return n14;
    if (i12.type.is(e7) && n14.push(i12.node), !i12.nextSibling()) return r2 == null ? n14 : [];
  }
}
function se2(s212, e7, t8 = e7.length - 1) {
  for (let r2 = s212.parent; t8 >= 0; r2 = r2.parent) {
    if (!r2) return false;
    if (!r2.type.isAnonymous) {
      if (e7[t8] && e7[t8] != r2.name) return false;
      t8--;
    }
  }
  return true;
}
var le3 = class {
  constructor(e7, t8, r2, i12) {
    this.parent = e7, this.buffer = t8, this.index = r2, this.start = i12;
  }
};
var G3 = class s52 extends ee2 {
  get name() {
    return this.type.name;
  }
  get from() {
    return this.context.start + this.context.buffer.buffer[this.index + 1];
  }
  get to() {
    return this.context.start + this.context.buffer.buffer[this.index + 2];
  }
  constructor(e7, t8, r2) {
    super(), this.context = e7, this._parent = t8, this.index = r2, this.type = e7.buffer.set.types[e7.buffer.buffer[r2]];
  }
  child(e7, t8, r2) {
    let { buffer: i12 } = this.context, n14 = i12.findChild(this.index + 4, i12.buffer[this.index + 3], e7, t8 - this.context.start, r2);
    return n14 < 0 ? null : new s52(this.context, this, n14);
  }
  get firstChild() {
    return this.child(1, 0, 4);
  }
  get lastChild() {
    return this.child(-1, 0, 4);
  }
  childAfter(e7) {
    return this.child(1, e7, 2);
  }
  childBefore(e7) {
    return this.child(-1, e7, -2);
  }
  enter(e7, t8, r2 = 0) {
    if (r2 & S3.ExcludeBuffers) return null;
    let { buffer: i12 } = this.context, n14 = i12.findChild(this.index + 4, i12.buffer[this.index + 3], t8 > 0 ? 1 : -1, e7 - this.context.start, t8);
    return n14 < 0 ? null : new s52(this.context, this, n14);
  }
  get parent() {
    return this._parent || this.context.parent.nextSignificantParent();
  }
  externalSibling(e7) {
    return this._parent ? null : this.context.parent.nextChild(this.context.index + e7, e7, 0, 4);
  }
  get nextSibling() {
    let { buffer: e7 } = this.context, t8 = e7.buffer[this.index + 3];
    return t8 < (this._parent ? e7.buffer[this._parent.index + 3] : e7.buffer.length) ? new s52(this.context, this._parent, t8) : this.externalSibling(1);
  }
  get prevSibling() {
    let { buffer: e7 } = this.context, t8 = this._parent ? this._parent.index + 4 : 0;
    return this.index == t8 ? this.externalSibling(-1) : new s52(this.context, this._parent, e7.findChild(t8, this.index, -1, 0, 4));
  }
  get tree() {
    return null;
  }
  toTree() {
    let e7 = [], t8 = [], { buffer: r2 } = this.context, i12 = this.index + 4, n14 = r2.buffer[this.index + 3];
    if (n14 > i12) {
      let l11 = r2.buffer[this.index + 1];
      e7.push(r2.slice(i12, n14, l11)), t8.push(0);
    }
    return new O3(this.type, e7, t8, this.to - this.from);
  }
  toString() {
    return this.context.buffer.childString(this.index);
  }
};
function Ne3(s212) {
  if (!s212.length) return null;
  let e7 = 0, t8 = s212[0];
  for (let n14 = 1; n14 < s212.length; n14++) {
    let l11 = s212[n14];
    (l11.from > t8.from || l11.to < t8.to) && (t8 = l11, e7 = n14);
  }
  let r2 = t8 instanceof P2 && t8.index < 0 ? null : t8.parent, i12 = s212.slice();
  return r2 ? i12[e7] = r2 : i12.splice(e7, 1), new he2(i12, t8);
}
var he2 = class {
  constructor(e7, t8) {
    this.heads = e7, this.node = t8;
  }
  get next() {
    return Ne3(this.heads);
  }
};
function Pe3(s212, e7, t8) {
  let r2 = s212.resolveInner(e7, t8), i12 = null;
  for (let n14 = r2 instanceof P2 ? r2 : r2.context.parent; n14; n14 = n14.parent) if (n14.index < 0) {
    let l11 = n14.parent;
    (i12 || (i12 = [r2])).push(l11.resolve(e7, t8)), n14 = l11;
  } else {
    let l11 = V3.get(n14.tree);
    if (l11 && l11.overlay && l11.overlay[0].from <= e7 && l11.overlay[l11.overlay.length - 1].to >= e7) {
      let h3 = new P2(l11.tree, l11.overlay[0].from + n14.from, -1, n14);
      (i12 || (i12 = [r2])).push(Q3(h3, e7, t8, false));
    }
  }
  return i12 ? Ne3(i12) : r2;
}
var K3 = class {
  get name() {
    return this.type.name;
  }
  constructor(e7, t8 = 0) {
    if (this.mode = t8, this.buffer = null, this.stack = [], this.index = 0, this.bufferNode = null, e7 instanceof P2) this.yieldNode(e7);
    else {
      this._tree = e7.context.parent, this.buffer = e7.context;
      for (let r2 = e7._parent; r2; r2 = r2._parent) this.stack.unshift(r2.index);
      this.bufferNode = e7, this.yieldBuf(e7.index);
    }
  }
  yieldNode(e7) {
    return e7 ? (this._tree = e7, this.type = e7.type, this.from = e7.from, this.to = e7.to, true) : false;
  }
  yieldBuf(e7, t8) {
    this.index = e7;
    let { start: r2, buffer: i12 } = this.buffer;
    return this.type = t8 || i12.set.types[i12.buffer[e7]], this.from = r2 + i12.buffer[e7 + 1], this.to = r2 + i12.buffer[e7 + 2], true;
  }
  yield(e7) {
    return e7 ? e7 instanceof P2 ? (this.buffer = null, this.yieldNode(e7)) : (this.buffer = e7.context, this.yieldBuf(e7.index, e7.type)) : false;
  }
  toString() {
    return this.buffer ? this.buffer.buffer.childString(this.index) : this._tree.toString();
  }
  enterChild(e7, t8, r2) {
    if (!this.buffer) return this.yield(this._tree.nextChild(e7 < 0 ? this._tree._tree.children.length - 1 : 0, e7, t8, r2, this.mode));
    let { buffer: i12 } = this.buffer, n14 = i12.findChild(this.index + 4, i12.buffer[this.index + 3], e7, t8 - this.buffer.start, r2);
    return n14 < 0 ? false : (this.stack.push(this.index), this.yieldBuf(n14));
  }
  firstChild() {
    return this.enterChild(1, 0, 4);
  }
  lastChild() {
    return this.enterChild(-1, 0, 4);
  }
  childAfter(e7) {
    return this.enterChild(1, e7, 2);
  }
  childBefore(e7) {
    return this.enterChild(-1, e7, -2);
  }
  enter(e7, t8, r2 = this.mode) {
    return this.buffer ? r2 & S3.ExcludeBuffers ? false : this.enterChild(1, e7, t8) : this.yield(this._tree.enter(e7, t8, r2));
  }
  parent() {
    if (!this.buffer) return this.yieldNode(this.mode & S3.IncludeAnonymous ? this._tree._parent : this._tree.parent);
    if (this.stack.length) return this.yieldBuf(this.stack.pop());
    let e7 = this.mode & S3.IncludeAnonymous ? this.buffer.parent : this.buffer.parent.nextSignificantParent();
    return this.buffer = null, this.yieldNode(e7);
  }
  sibling(e7) {
    if (!this.buffer) return this._tree._parent ? this.yield(this._tree.index < 0 ? null : this._tree._parent.nextChild(this._tree.index + e7, e7, 0, 4, this.mode)) : false;
    let { buffer: t8 } = this.buffer, r2 = this.stack.length - 1;
    if (e7 < 0) {
      let i12 = r2 < 0 ? 0 : this.stack[r2] + 4;
      if (this.index != i12) return this.yieldBuf(t8.findChild(i12, this.index, -1, 0, 4));
    } else {
      let i12 = t8.buffer[this.index + 3];
      if (i12 < (r2 < 0 ? t8.buffer.length : t8.buffer[this.stack[r2] + 3])) return this.yieldBuf(i12);
    }
    return r2 < 0 ? this.yield(this.buffer.parent.nextChild(this.buffer.index + e7, e7, 0, 4, this.mode)) : false;
  }
  nextSibling() {
    return this.sibling(1);
  }
  prevSibling() {
    return this.sibling(-1);
  }
  atLastNode(e7) {
    let t8, r2, { buffer: i12 } = this;
    if (i12) {
      if (e7 > 0) {
        if (this.index < i12.buffer.buffer.length) return false;
      } else for (let n14 = 0; n14 < this.index; n14++) if (i12.buffer.buffer[n14 + 3] < this.index) return false;
      ({ index: t8, parent: r2 } = i12);
    } else ({ index: t8, _parent: r2 } = this._tree);
    for (; r2; { index: t8, _parent: r2 } = r2) if (t8 > -1) for (let n14 = t8 + e7, l11 = e7 < 0 ? -1 : r2._tree.children.length; n14 != l11; n14 += e7) {
      let h3 = r2._tree.children[n14];
      if (this.mode & S3.IncludeAnonymous || h3 instanceof U3 || !h3.type.isAnonymous || de3(h3)) return false;
    }
    return true;
  }
  move(e7, t8) {
    if (t8 && this.enterChild(e7, 0, 4)) return true;
    for (; ; ) {
      if (this.sibling(e7)) return true;
      if (this.atLastNode(e7) || !this.parent()) return false;
    }
  }
  next(e7 = true) {
    return this.move(1, e7);
  }
  prev(e7 = true) {
    return this.move(-1, e7);
  }
  moveTo(e7, t8 = 0) {
    for (; (this.from == this.to || (t8 < 1 ? this.from >= e7 : this.from > e7) || (t8 > -1 ? this.to <= e7 : this.to < e7)) && this.parent(); ) ;
    for (; this.enterChild(1, e7, t8); ) ;
    return this;
  }
  get node() {
    if (!this.buffer) return this._tree;
    let e7 = this.bufferNode, t8 = null, r2 = 0;
    if (e7 && e7.context == this.buffer) e: for (let i12 = this.index, n14 = this.stack.length; n14 >= 0; ) {
      for (let l11 = e7; l11; l11 = l11._parent) if (l11.index == i12) {
        if (i12 == this.index) return l11;
        t8 = l11, r2 = n14 + 1;
        break e;
      }
      i12 = this.stack[--n14];
    }
    for (let i12 = r2; i12 < this.stack.length; i12++) t8 = new G3(this.buffer, t8, this.stack[i12]);
    return this.bufferNode = new G3(this.buffer, t8, this.index);
  }
  get tree() {
    return this.buffer ? null : this._tree._tree;
  }
  iterate(e7, t8) {
    for (let r2 = 0; ; ) {
      let i12 = false;
      if (this.type.isAnonymous || e7(this) !== false) {
        if (this.firstChild()) {
          r2++;
          continue;
        }
        this.type.isAnonymous || (i12 = true);
      }
      for (; i12 && t8 && t8(this), i12 = this.type.isAnonymous, !this.nextSibling(); ) {
        if (!r2) return;
        this.parent(), r2--, i12 = true;
      }
    }
  }
  matchContext(e7) {
    if (!this.buffer) return se2(this.node, e7);
    let { buffer: t8 } = this.buffer, { types: r2 } = t8.set;
    for (let i12 = e7.length - 1, n14 = this.stack.length - 1; i12 >= 0; n14--) {
      if (n14 < 0) return se2(this.node, e7, i12);
      let l11 = r2[t8.buffer[this.stack[n14]]];
      if (!l11.isAnonymous) {
        if (e7[i12] && e7[i12] != l11.name) return false;
        i12--;
      }
    }
    return true;
  }
};
function de3(s212) {
  return s212.children.some((e7) => e7 instanceof U3 || !e7.type.isAnonymous || de3(e7));
}
function Ee3(s212) {
  var e7;
  let { buffer: t8, nodeSet: r2, maxBufferLength: i12 = 1024, reused: n14 = [], minRepeatType: l11 = r2.types.length } = s212, h3 = Array.isArray(t8) ? new ne3(t8, t8.length) : t8, f6 = r2.types, a2 = 0, o = 0;
  function d4(y18, w14, u3, A18, b12, m11) {
    let { id: c3, start: g8, end: C11, size: k16 } = h3, B15 = o;
    for (; k16 < 0; ) if (h3.next(), k16 == -1) {
      let L19 = n14[c3];
      u3.push(L19), A18.push(g8 - y18);
      return;
    } else if (k16 == -3) {
      a2 = c3;
      return;
    } else if (k16 == -4) {
      o = c3;
      return;
    } else throw new RangeError(`Unrecognized record size: ${k16}`);
    let W15 = f6[c3], $18, H12, ge20 = g8 - y18;
    if (C11 - g8 <= i12 && (H12 = T22(h3.pos - w14, b12))) {
      let L19 = new Uint16Array(H12.size - H12.skip), M12 = h3.pos - H12.size, D14 = L19.length;
      for (; h3.pos > M12; ) D14 = j19(H12.start, L19, D14);
      $18 = new U3(L19, C11 - H12.start, r2), ge20 = H12.start - y18;
    } else {
      let L19 = h3.pos - k16;
      h3.next();
      let M12 = [], D14 = [], J15 = c3 >= l11 ? c3 : -1, q17 = 0, X19 = C11;
      for (; h3.pos > L19; ) J15 >= 0 && h3.id == J15 && h3.size >= 0 ? (h3.end <= X19 - i12 && (_18(M12, D14, g8, q17, h3.end, X19, J15, B15), q17 = M12.length, X19 = h3.end), h3.next()) : m11 > 2500 ? p3(g8, L19, M12, D14) : d4(g8, L19, M12, D14, J15, m11 + 1);
      if (J15 >= 0 && q17 > 0 && q17 < M12.length && _18(M12, D14, g8, q17, g8, X19, J15, B15), M12.reverse(), D14.reverse(), J15 > -1 && q17 > 0) {
        let me19 = x11(W15);
        $18 = ce3(W15, M12, D14, 0, M12.length, 0, C11 - g8, me19, me19);
      } else $18 = N23(W15, M12, D14, C11 - g8, B15 - C11);
    }
    u3.push($18), A18.push(ge20);
  }
  function p3(y18, w14, u3, A18) {
    let b12 = [], m11 = 0, c3 = -1;
    for (; h3.pos > w14; ) {
      let { id: g8, start: C11, end: k16, size: B15 } = h3;
      if (B15 > 4) h3.next();
      else {
        if (c3 > -1 && C11 < c3) break;
        c3 < 0 && (c3 = k16 - i12), b12.push(g8, C11, k16), m11++, h3.next();
      }
    }
    if (m11) {
      let g8 = new Uint16Array(m11 * 4), C11 = b12[b12.length - 2];
      for (let k16 = b12.length - 3, B15 = 0; k16 >= 0; k16 -= 3) g8[B15++] = b12[k16], g8[B15++] = b12[k16 + 1] - C11, g8[B15++] = b12[k16 + 2] - C11, g8[B15++] = B15;
      u3.push(new U3(g8, b12[2] - C11, r2)), A18.push(C11 - y18);
    }
  }
  function x11(y18) {
    return (w14, u3, A18) => {
      let b12 = 0, m11 = w14.length - 1, c3, g8;
      if (m11 >= 0 && (c3 = w14[m11]) instanceof O3) {
        if (!m11 && c3.type == y18 && c3.length == A18) return c3;
        (g8 = c3.prop(v2.lookAhead)) && (b12 = u3[m11] + c3.length + g8);
      }
      return N23(y18, w14, u3, A18, b12);
    };
  }
  function _18(y18, w14, u3, A18, b12, m11, c3, g8) {
    let C11 = [], k16 = [];
    for (; y18.length > A18; ) C11.push(y18.pop()), k16.push(w14.pop() + u3 - b12);
    y18.push(N23(r2.types[c3], C11, k16, m11 - b12, g8 - m11)), w14.push(b12 - u3);
  }
  function N23(y18, w14, u3, A18, b12 = 0, m11) {
    if (a2) {
      let c3 = [v2.contextHash, a2];
      m11 = m11 ? [c3].concat(m11) : [c3];
    }
    if (b12 > 25) {
      let c3 = [v2.lookAhead, b12];
      m11 = m11 ? [c3].concat(m11) : [c3];
    }
    return new O3(y18, w14, u3, A18, m11);
  }
  function T22(y18, w14) {
    let u3 = h3.fork(), A18 = 0, b12 = 0, m11 = 0, c3 = u3.end - i12, g8 = { size: 0, start: 0, skip: 0 };
    e: for (let C11 = u3.pos - y18; u3.pos > C11; ) {
      let k16 = u3.size;
      if (u3.id == w14 && k16 >= 0) {
        g8.size = A18, g8.start = b12, g8.skip = m11, m11 += 4, A18 += 4, u3.next();
        continue;
      }
      let B15 = u3.pos - k16;
      if (k16 < 0 || B15 < C11 || u3.start < c3) break;
      let W15 = u3.id >= l11 ? 4 : 0, $18 = u3.start;
      for (u3.next(); u3.pos > B15; ) {
        if (u3.size < 0) if (u3.size == -3) W15 += 4;
        else break e;
        else u3.id >= l11 && (W15 += 4);
        u3.next();
      }
      b12 = $18, A18 += k16, m11 += W15;
    }
    return (w14 < 0 || A18 == y18) && (g8.size = A18, g8.start = b12, g8.skip = m11), g8.size > 4 ? g8 : void 0;
  }
  function j19(y18, w14, u3) {
    let { id: A18, start: b12, end: m11, size: c3 } = h3;
    if (h3.next(), c3 >= 0 && A18 < l11) {
      let g8 = u3;
      if (c3 > 4) {
        let C11 = h3.pos - (c3 - 4);
        for (; h3.pos > C11; ) u3 = j19(y18, w14, u3);
      }
      w14[--u3] = g8, w14[--u3] = m11 - y18, w14[--u3] = b12 - y18, w14[--u3] = A18;
    } else c3 == -3 ? a2 = A18 : c3 == -4 && (o = A18);
    return u3;
  }
  let E11 = [], I22 = [];
  for (; h3.pos > 0; ) d4(s212.start || 0, s212.bufferStart || 0, E11, I22, -1, 0);
  let R19 = (e7 = s212.length) !== null && e7 !== void 0 ? e7 : E11.length ? I22[0] + E11[0].length : 0;
  return new O3(f6[s212.topID], E11.reverse(), I22.reverse(), R19);
}
var we3 = /* @__PURE__ */ new WeakMap();
function Z2(s212, e7) {
  if (!s212.isAnonymous || e7 instanceof U3 || e7.type != s212) return 1;
  let t8 = we3.get(e7);
  if (t8 == null) {
    t8 = 1;
    for (let r2 of e7.children) {
      if (r2.type != s212 || !(r2 instanceof O3)) {
        t8 = 1;
        break;
      }
      t8 += Z2(s212, r2);
    }
    we3.set(e7, t8);
  }
  return t8;
}
function ce3(s212, e7, t8, r2, i12, n14, l11, h3, f6) {
  let a2 = 0;
  for (let _18 = r2; _18 < i12; _18++) a2 += Z2(s212, e7[_18]);
  let o = Math.ceil(a2 * 1.5 / 8), d4 = [], p3 = [];
  function x11(_18, N23, T22, j19, E11) {
    for (let I22 = T22; I22 < j19; ) {
      let R19 = I22, y18 = N23[I22], w14 = Z2(s212, _18[I22]);
      for (I22++; I22 < j19; I22++) {
        let u3 = Z2(s212, _18[I22]);
        if (w14 + u3 >= o) break;
        w14 += u3;
      }
      if (I22 == R19 + 1) {
        if (w14 > o) {
          let u3 = _18[R19];
          x11(u3.children, u3.positions, 0, u3.children.length, N23[R19] + E11);
          continue;
        }
        d4.push(_18[R19]);
      } else {
        let u3 = N23[I22 - 1] + _18[I22 - 1].length - y18;
        d4.push(ce3(s212, _18, N23, R19, I22, y18, u3, null, f6));
      }
      p3.push(y18 + E11 - n14);
    }
  }
  return x11(e7, t8, r2, i12, 0), (h3 || f6)(d4, p3, l11);
}
var te3 = class s53 {
  constructor(e7, t8, r2, i12, n14 = false, l11 = false) {
    this.from = e7, this.to = t8, this.tree = r2, this.offset = i12, this.open = (n14 ? 1 : 0) | (l11 ? 2 : 0);
  }
  get openStart() {
    return (this.open & 1) > 0;
  }
  get openEnd() {
    return (this.open & 2) > 0;
  }
  static addTree(e7, t8 = [], r2 = false) {
    let i12 = [new s53(0, e7.length, e7, 0, false, r2)];
    for (let n14 of t8) n14.to > e7.length && i12.push(n14);
    return i12;
  }
  static applyChanges(e7, t8, r2 = 128) {
    if (!t8.length) return e7;
    let i12 = [], n14 = 1, l11 = e7.length ? e7[0] : null;
    for (let h3 = 0, f6 = 0, a2 = 0; ; h3++) {
      let o = h3 < t8.length ? t8[h3] : null, d4 = o ? o.fromA : 1e9;
      if (d4 - f6 >= r2) for (; l11 && l11.from < d4; ) {
        let p3 = l11;
        if (f6 >= p3.from || d4 <= p3.to || a2) {
          let x11 = Math.max(p3.from, f6) - a2, _18 = Math.min(p3.to, d4) - a2;
          p3 = x11 >= _18 ? null : new s53(x11, _18, p3.tree, p3.offset + a2, h3 > 0, !!o);
        }
        if (p3 && i12.push(p3), l11.to > d4) break;
        l11 = n14 < e7.length ? e7[n14++] : null;
      }
      if (!o) break;
      f6 = o.toA, a2 = o.toA - o.toB;
    }
    return i12;
  }
};
var ke3 = class {
  startParse(e7, t8, r2) {
    return typeof e7 == "string" && (e7 = new fe3(e7)), r2 = r2 ? r2.length ? r2.map((i12) => new z3(i12.from, i12.to)) : [new z3(0, 0)] : [new z3(0, e7.length)], this.createParse(e7, t8 || [], r2);
  }
  parse(e7, t8, r2) {
    let i12 = this.startParse(e7, t8, r2);
    for (; ; ) {
      let n14 = i12.advance();
      if (n14) return n14;
    }
  }
};
var fe3 = class {
  constructor(e7) {
    this.string = e7;
  }
  get length() {
    return this.string.length;
  }
  chunk(e7) {
    return this.string.slice(e7);
  }
  get lineChunks() {
    return false;
  }
  read(e7, t8) {
    return this.string.slice(e7, t8);
  }
};
var ue3 = new v2({ perNode: true });

// https://esm.sh/v135/@codemirror/view@6.33.0/denonext/view.mjs
function jt2(s212) {
  let t8;
  return s212.nodeType == 11 ? t8 = s212.getSelection ? s212 : s212.ownerDocument : t8 = s212, t8.getSelection();
}
function Xe3(s212, t8) {
  return t8 ? s212 == t8 || s212.contains(t8.nodeType != 1 ? t8.parentNode : t8) : false;
}
function eo2(s212) {
  let t8 = s212.activeElement;
  for (; t8 && t8.shadowRoot; ) t8 = t8.shadowRoot.activeElement;
  return t8;
}
function ue4(s212, t8) {
  if (!t8.anchorNode) return false;
  try {
    return Xe3(s212, t8.anchorNode);
  } catch {
    return false;
  }
}
function At2(s212) {
  return s212.nodeType == 3 ? pt2(s212, 0, s212.nodeValue.length).getClientRects() : s212.nodeType == 1 ? s212.getClientRects() : [];
}
function Vt2(s212, t8, e7, i12) {
  return e7 ? Yi(s212, t8, e7, i12, -1) || Yi(s212, t8, e7, i12, 1) : false;
}
function ut2(s212) {
  for (var t8 = 0; ; t8++) if (s212 = s212.previousSibling, !s212) return t8;
}
function xe4(s212) {
  return s212.nodeType == 1 && /^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(s212.nodeName);
}
function Yi(s212, t8, e7, i12, n14) {
  for (; ; ) {
    if (s212 == e7 && t8 == i12) return true;
    if (t8 == (n14 < 0 ? 0 : tt2(s212))) {
      if (s212.nodeName == "DIV") return false;
      let o = s212.parentNode;
      if (!o || o.nodeType != 1) return false;
      t8 = ut2(s212) + (n14 < 0 ? 0 : 1), s212 = o;
    } else if (s212.nodeType == 1) {
      if (s212 = s212.childNodes[t8 + (n14 < 0 ? -1 : 0)], s212.nodeType == 1 && s212.contentEditable == "false") return false;
      t8 = n14 < 0 ? tt2(s212) : 0;
    } else return false;
  }
}
function tt2(s212) {
  return s212.nodeType == 3 ? s212.nodeValue.length : s212.childNodes.length;
}
function te4(s212, t8) {
  let e7 = t8 ? s212.left : s212.right;
  return { left: e7, right: e7, top: s212.top, bottom: s212.bottom };
}
function io2(s212) {
  let t8 = s212.visualViewport;
  return t8 ? { left: 0, right: t8.width, top: 0, bottom: t8.height } : { left: 0, right: s212.innerWidth, top: 0, bottom: s212.innerHeight };
}
function Fs2(s212, t8) {
  let e7 = t8.width / s212.offsetWidth, i12 = t8.height / s212.offsetHeight;
  return (e7 > 0.995 && e7 < 1.005 || !isFinite(e7) || Math.abs(t8.width - s212.offsetWidth) < 1) && (e7 = 1), (i12 > 0.995 && i12 < 1.005 || !isFinite(i12) || Math.abs(t8.height - s212.offsetHeight) < 1) && (i12 = 1), { scaleX: e7, scaleY: i12 };
}
function so2(s212, t8, e7, i12, n14, o, r2, l11) {
  let h3 = s212.ownerDocument, c3 = h3.defaultView || window;
  for (let a2 = s212, f6 = false; a2 && !f6; ) if (a2.nodeType == 1) {
    let d4, u3 = a2 == h3.body, p3 = 1, g8 = 1;
    if (u3) d4 = io2(c3);
    else {
      if (/^(fixed|sticky)$/.test(getComputedStyle(a2).position) && (f6 = true), a2.scrollHeight <= a2.clientHeight && a2.scrollWidth <= a2.clientWidth) {
        a2 = a2.assignedSlot || a2.parentNode;
        continue;
      }
      let w14 = a2.getBoundingClientRect();
      ({ scaleX: p3, scaleY: g8 } = Fs2(a2, w14)), d4 = { left: w14.left, right: w14.left + a2.clientWidth * p3, top: w14.top, bottom: w14.top + a2.clientHeight * g8 };
    }
    let b12 = 0, m11 = 0;
    if (n14 == "nearest") t8.top < d4.top ? (m11 = -(d4.top - t8.top + r2), e7 > 0 && t8.bottom > d4.bottom + m11 && (m11 = t8.bottom - d4.bottom + m11 + r2)) : t8.bottom > d4.bottom && (m11 = t8.bottom - d4.bottom + r2, e7 < 0 && t8.top - m11 < d4.top && (m11 = -(d4.top + m11 - t8.top + r2)));
    else {
      let w14 = t8.bottom - t8.top, v10 = d4.bottom - d4.top;
      m11 = (n14 == "center" && w14 <= v10 ? t8.top + w14 / 2 - v10 / 2 : n14 == "start" || n14 == "center" && e7 < 0 ? t8.top - r2 : t8.bottom - v10 + r2) - d4.top;
    }
    if (i12 == "nearest" ? t8.left < d4.left ? (b12 = -(d4.left - t8.left + o), e7 > 0 && t8.right > d4.right + b12 && (b12 = t8.right - d4.right + b12 + o)) : t8.right > d4.right && (b12 = t8.right - d4.right + o, e7 < 0 && t8.left < d4.left + b12 && (b12 = -(d4.left + b12 - t8.left + o))) : b12 = (i12 == "center" ? t8.left + (t8.right - t8.left) / 2 - (d4.right - d4.left) / 2 : i12 == "start" == l11 ? t8.left - o : t8.right - (d4.right - d4.left) + o) - d4.left, b12 || m11) if (u3) c3.scrollBy(b12, m11);
    else {
      let w14 = 0, v10 = 0;
      if (m11) {
        let x11 = a2.scrollTop;
        a2.scrollTop += m11 / g8, v10 = (a2.scrollTop - x11) * g8;
      }
      if (b12) {
        let x11 = a2.scrollLeft;
        a2.scrollLeft += b12 / p3, w14 = (a2.scrollLeft - x11) * p3;
      }
      t8 = { left: t8.left - w14, top: t8.top - v10, right: t8.right - w14, bottom: t8.bottom - v10 }, w14 && Math.abs(w14 - b12) < 1 && (i12 = "nearest"), v10 && Math.abs(v10 - m11) < 1 && (n14 = "nearest");
    }
    if (u3) break;
    a2 = a2.assignedSlot || a2.parentNode;
  } else if (a2.nodeType == 11) a2 = a2.host;
  else break;
}
function no2(s212) {
  let t8 = s212.ownerDocument, e7, i12;
  for (let n14 = s212.parentNode; n14 && !(n14 == t8.body || e7 && i12); ) if (n14.nodeType == 1) !i12 && n14.scrollHeight > n14.clientHeight && (i12 = n14), !e7 && n14.scrollWidth > n14.clientWidth && (e7 = n14), n14 = n14.assignedSlot || n14.parentNode;
  else if (n14.nodeType == 11) n14 = n14.host;
  else break;
  return { x: e7, y: i12 };
}
var Ge3 = class {
  constructor() {
    this.anchorNode = null, this.anchorOffset = 0, this.focusNode = null, this.focusOffset = 0;
  }
  eq(t8) {
    return this.anchorNode == t8.anchorNode && this.anchorOffset == t8.anchorOffset && this.focusNode == t8.focusNode && this.focusOffset == t8.focusOffset;
  }
  setRange(t8) {
    let { anchorNode: e7, focusNode: i12 } = t8;
    this.set(e7, Math.min(t8.anchorOffset, e7 ? tt2(e7) : 0), i12, Math.min(t8.focusOffset, i12 ? tt2(i12) : 0));
  }
  set(t8, e7, i12, n14) {
    this.anchorNode = t8, this.anchorOffset = e7, this.focusNode = i12, this.focusOffset = n14;
  }
};
var yt2 = null;
function Ws2(s212) {
  if (s212.setActive) return s212.setActive();
  if (yt2) return s212.focus(yt2);
  let t8 = [];
  for (let e7 = s212; e7 && (t8.push(e7, e7.scrollTop, e7.scrollLeft), e7 != e7.ownerDocument); e7 = e7.parentNode) ;
  if (s212.focus(yt2 == null ? { get preventScroll() {
    return yt2 = { preventScroll: true }, true;
  } } : void 0), !yt2) {
    yt2 = false;
    for (let e7 = 0; e7 < t8.length; ) {
      let i12 = t8[e7++], n14 = t8[e7++], o = t8[e7++];
      i12.scrollTop != n14 && (i12.scrollTop = n14), i12.scrollLeft != o && (i12.scrollLeft = o);
    }
  }
}
var _i2;
function pt2(s212, t8, e7 = t8) {
  let i12 = _i2 || (_i2 = document.createRange());
  return i12.setEnd(s212, e7), i12.setStart(s212, t8), i12;
}
function Mt2(s212, t8, e7, i12) {
  let n14 = { key: t8, code: t8, keyCode: e7, which: e7, cancelable: true };
  i12 && ({ altKey: n14.altKey, ctrlKey: n14.ctrlKey, shiftKey: n14.shiftKey, metaKey: n14.metaKey } = i12);
  let o = new KeyboardEvent("keydown", n14);
  o.synthetic = true, s212.dispatchEvent(o);
  let r2 = new KeyboardEvent("keyup", n14);
  return r2.synthetic = true, s212.dispatchEvent(r2), o.defaultPrevented || r2.defaultPrevented;
}
function oo2(s212) {
  for (; s212; ) {
    if (s212 && (s212.nodeType == 9 || s212.nodeType == 11 && s212.host)) return s212;
    s212 = s212.assignedSlot || s212.parentNode;
  }
  return null;
}
function zs2(s212) {
  for (; s212.attributes.length; ) s212.removeAttributeNode(s212.attributes[0]);
}
function ro2(s212, t8) {
  let e7 = t8.focusNode, i12 = t8.focusOffset;
  if (!e7 || t8.anchorNode != e7 || t8.anchorOffset != i12) return false;
  for (i12 = Math.min(i12, tt2(e7)); ; ) if (i12) {
    if (e7.nodeType != 1) return false;
    let n14 = e7.childNodes[i12 - 1];
    n14.contentEditable == "false" ? i12-- : (e7 = n14, i12 = tt2(e7));
  } else {
    if (e7 == s212) return true;
    i12 = ut2(e7), e7 = e7.parentNode;
  }
}
function Is2(s212) {
  return s212.scrollTop > Math.max(1, s212.scrollHeight - s212.clientHeight - 4);
}
function Ks2(s212, t8) {
  for (let e7 = s212, i12 = t8; ; ) {
    if (e7.nodeType == 3 && i12 > 0) return { node: e7, offset: i12 };
    if (e7.nodeType == 1 && i12 > 0) {
      if (e7.contentEditable == "false") return null;
      e7 = e7.childNodes[i12 - 1], i12 = tt2(e7);
    } else if (e7.parentNode && !xe4(e7)) i12 = ut2(e7), e7 = e7.parentNode;
    else return null;
  }
}
function qs2(s212, t8) {
  for (let e7 = s212, i12 = t8; ; ) {
    if (e7.nodeType == 3 && i12 < e7.nodeValue.length) return { node: e7, offset: i12 };
    if (e7.nodeType == 1 && i12 < e7.childNodes.length) {
      if (e7.contentEditable == "false") return null;
      e7 = e7.childNodes[i12], i12 = 0;
    } else if (e7.parentNode && !xe4(e7)) i12 = ut2(e7) + 1, e7 = e7.parentNode;
    else return null;
  }
}
var V4 = class s54 {
  constructor(t8, e7, i12 = true) {
    this.node = t8, this.offset = e7, this.precise = i12;
  }
  static before(t8, e7) {
    return new s54(t8.parentNode, ut2(t8), e7);
  }
  static after(t8, e7) {
    return new s54(t8.parentNode, ut2(t8) + 1, e7);
  }
};
var Fi2 = [];
var T4 = class s55 {
  constructor() {
    this.parent = null, this.dom = null, this.flags = 2;
  }
  get overrideDOMText() {
    return null;
  }
  get posAtStart() {
    return this.parent ? this.parent.posBefore(this) : 0;
  }
  get posAtEnd() {
    return this.posAtStart + this.length;
  }
  posBefore(t8) {
    let e7 = this.posAtStart;
    for (let i12 of this.children) {
      if (i12 == t8) return e7;
      e7 += i12.length + i12.breakAfter;
    }
    throw new RangeError("Invalid child in posBefore");
  }
  posAfter(t8) {
    return this.posBefore(t8) + t8.length;
  }
  sync(t8, e7) {
    if (this.flags & 2) {
      let i12 = this.dom, n14 = null, o;
      for (let r2 of this.children) {
        if (r2.flags & 7) {
          if (!r2.dom && (o = n14 ? n14.nextSibling : i12.firstChild)) {
            let l11 = s55.get(o);
            (!l11 || !l11.parent && l11.canReuseDOM(r2)) && r2.reuseDOM(o);
          }
          r2.sync(t8, e7), r2.flags &= -8;
        }
        if (o = n14 ? n14.nextSibling : i12.firstChild, e7 && !e7.written && e7.node == i12 && o != r2.dom && (e7.written = true), r2.dom.parentNode == i12) for (; o && o != r2.dom; ) o = Xi2(o);
        else i12.insertBefore(r2.dom, o);
        n14 = r2.dom;
      }
      for (o = n14 ? n14.nextSibling : i12.firstChild, o && e7 && e7.node == i12 && (e7.written = true); o; ) o = Xi2(o);
    } else if (this.flags & 1) for (let i12 of this.children) i12.flags & 7 && (i12.sync(t8, e7), i12.flags &= -8);
  }
  reuseDOM(t8) {
  }
  localPosFromDOM(t8, e7) {
    let i12;
    if (t8 == this.dom) i12 = this.dom.childNodes[e7];
    else {
      let n14 = tt2(t8) == 0 ? 0 : e7 == 0 ? -1 : 1;
      for (; ; ) {
        let o = t8.parentNode;
        if (o == this.dom) break;
        n14 == 0 && o.firstChild != o.lastChild && (t8 == o.firstChild ? n14 = -1 : n14 = 1), t8 = o;
      }
      n14 < 0 ? i12 = t8 : i12 = t8.nextSibling;
    }
    if (i12 == this.dom.firstChild) return 0;
    for (; i12 && !s55.get(i12); ) i12 = i12.nextSibling;
    if (!i12) return this.length;
    for (let n14 = 0, o = 0; ; n14++) {
      let r2 = this.children[n14];
      if (r2.dom == i12) return o;
      o += r2.length + r2.breakAfter;
    }
  }
  domBoundsAround(t8, e7, i12 = 0) {
    let n14 = -1, o = -1, r2 = -1, l11 = -1;
    for (let h3 = 0, c3 = i12, a2 = i12; h3 < this.children.length; h3++) {
      let f6 = this.children[h3], d4 = c3 + f6.length;
      if (c3 < t8 && d4 > e7) return f6.domBoundsAround(t8, e7, c3);
      if (d4 >= t8 && n14 == -1 && (n14 = h3, o = c3), c3 > e7 && f6.dom.parentNode == this.dom) {
        r2 = h3, l11 = a2;
        break;
      }
      a2 = d4, c3 = d4 + f6.breakAfter;
    }
    return { from: o, to: l11 < 0 ? i12 + this.length : l11, startDOM: (n14 ? this.children[n14 - 1].dom.nextSibling : null) || this.dom.firstChild, endDOM: r2 < this.children.length && r2 >= 0 ? this.children[r2].dom : null };
  }
  markDirty(t8 = false) {
    this.flags |= 2, this.markParentsDirty(t8);
  }
  markParentsDirty(t8) {
    for (let e7 = this.parent; e7; e7 = e7.parent) {
      if (t8 && (e7.flags |= 2), e7.flags & 1) return;
      e7.flags |= 1, t8 = false;
    }
  }
  setParent(t8) {
    this.parent != t8 && (this.parent = t8, this.flags & 7 && this.markParentsDirty(true));
  }
  setDOM(t8) {
    this.dom != t8 && (this.dom && (this.dom.cmView = null), this.dom = t8, t8.cmView = this);
  }
  get rootView() {
    for (let t8 = this; ; ) {
      let e7 = t8.parent;
      if (!e7) return t8;
      t8 = e7;
    }
  }
  replaceChildren(t8, e7, i12 = Fi2) {
    this.markDirty();
    for (let n14 = t8; n14 < e7; n14++) {
      let o = this.children[n14];
      o.parent == this && i12.indexOf(o) < 0 && o.destroy();
    }
    this.children.splice(t8, e7 - t8, ...i12);
    for (let n14 = 0; n14 < i12.length; n14++) i12[n14].setParent(this);
  }
  ignoreMutation(t8) {
    return false;
  }
  ignoreEvent(t8) {
    return false;
  }
  childCursor(t8 = this.length) {
    return new ve3(this.children, t8, this.children.length);
  }
  childPos(t8, e7 = 1) {
    return this.childCursor().findPos(t8, e7);
  }
  toString() {
    let t8 = this.constructor.name.replace("View", "");
    return t8 + (this.children.length ? "(" + this.children.join() + ")" : this.length ? "[" + (t8 == "Text" ? this.text : this.length) + "]" : "") + (this.breakAfter ? "#" : "");
  }
  static get(t8) {
    return t8.cmView;
  }
  get isEditable() {
    return true;
  }
  get isWidget() {
    return false;
  }
  get isHidden() {
    return false;
  }
  merge(t8, e7, i12, n14, o, r2) {
    return false;
  }
  become(t8) {
    return false;
  }
  canReuseDOM(t8) {
    return t8.constructor == this.constructor && !((this.flags | t8.flags) & 8);
  }
  getSide() {
    return 0;
  }
  destroy() {
    for (let t8 of this.children) t8.parent == this && t8.destroy();
    this.parent = null;
  }
};
T4.prototype.breakAfter = 0;
function Xi2(s212) {
  let t8 = s212.nextSibling;
  return s212.parentNode.removeChild(s212), t8;
}
var ve3 = class {
  constructor(t8, e7, i12) {
    this.children = t8, this.pos = e7, this.i = i12, this.off = 0;
  }
  findPos(t8, e7 = 1) {
    for (; ; ) {
      if (t8 > this.pos || t8 == this.pos && (e7 > 0 || this.i == 0 || this.children[this.i - 1].breakAfter)) return this.off = t8 - this.pos, this;
      let i12 = this.children[--this.i];
      this.pos -= i12.length + i12.breakAfter;
    }
  }
};
function js2(s212, t8, e7, i12, n14, o, r2, l11, h3) {
  let { children: c3 } = s212, a2 = c3.length ? c3[t8] : null, f6 = o.length ? o[o.length - 1] : null, d4 = f6 ? f6.breakAfter : r2;
  if (!(t8 == i12 && a2 && !r2 && !d4 && o.length < 2 && a2.merge(e7, n14, o.length ? f6 : null, e7 == 0, l11, h3))) {
    if (i12 < c3.length) {
      let u3 = c3[i12];
      u3 && (n14 < u3.length || u3.breakAfter && f6?.breakAfter) ? (t8 == i12 && (u3 = u3.split(n14), n14 = 0), !d4 && f6 && u3.merge(0, n14, f6, true, 0, h3) ? o[o.length - 1] = u3 : ((n14 || u3.children.length && !u3.children[0].length) && u3.merge(0, n14, null, false, 0, h3), o.push(u3))) : u3?.breakAfter && (f6 ? f6.breakAfter = 1 : r2 = 1), i12++;
    }
    for (a2 && (a2.breakAfter = r2, e7 > 0 && (!r2 && o.length && a2.merge(e7, a2.length, o[0], false, l11, 0) ? a2.breakAfter = o.shift().breakAfter : (e7 < a2.length || a2.children.length && a2.children[a2.children.length - 1].length == 0) && a2.merge(e7, a2.length, null, false, l11, 0), t8++)); t8 < i12 && o.length; ) if (c3[i12 - 1].become(o[o.length - 1])) i12--, o.pop(), h3 = o.length ? 0 : l11;
    else if (c3[t8].become(o[0])) t8++, o.shift(), l11 = o.length ? 0 : h3;
    else break;
    !o.length && t8 && i12 < c3.length && !c3[t8 - 1].breakAfter && c3[i12].merge(0, 0, c3[t8 - 1], false, l11, h3) && t8--, (t8 < i12 || o.length) && s212.replaceChildren(t8, i12, o);
  }
}
function Ys2(s212, t8, e7, i12, n14, o) {
  let r2 = s212.childCursor(), { i: l11, off: h3 } = r2.findPos(e7, 1), { i: c3, off: a2 } = r2.findPos(t8, -1), f6 = t8 - e7;
  for (let d4 of i12) f6 += d4.length;
  s212.length += f6, js2(s212, c3, a2, l11, h3, i12, 0, n14, o);
}
var W3 = typeof navigator < "u" ? navigator : { userAgent: "", vendor: "", platform: "" };
var $e3 = typeof document < "u" ? document : { documentElement: { style: {} } };
var Ue3 = /Edge\/(\d+)/.exec(W3.userAgent);
var _s2 = /MSIE \d/.test(W3.userAgent);
var Qe3 = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(W3.userAgent);
var Ne4 = !!(_s2 || Qe3 || Ue3);
var Gi2 = !Ne4 && /gecko\/(\d+)/i.test(W3.userAgent);
var ze4 = !Ne4 && /Chrome\/(\d+)/.exec(W3.userAgent);
var $i2 = "webkitFontSmoothing" in $e3.documentElement.style;
var Xs2 = !Ne4 && /Apple Computer/.test(W3.vendor);
var Ui2 = Xs2 && (/Mobile\/\w+/.test(W3.userAgent) || W3.maxTouchPoints > 2);
var y4 = { mac: Ui2 || /Mac/.test(W3.platform), windows: /Win/.test(W3.platform), linux: /Linux|X11/.test(W3.platform), ie: Ne4, ie_version: _s2 ? $e3.documentMode || 6 : Qe3 ? +Qe3[1] : Ue3 ? +Ue3[1] : 0, gecko: Gi2, gecko_version: Gi2 ? +(/Firefox\/(\d+)/.exec(W3.userAgent) || [0, 0])[1] : 0, chrome: !!ze4, chrome_version: ze4 ? +ze4[1] : 0, ios: Ui2, android: /Android\b/.test(W3.userAgent), webkit: $i2, safari: Xs2, webkit_version: $i2 ? +(/\bAppleWebKit\/(\d+)/.exec(W3.userAgent) || [0, 0])[1] : 0, tabSize: $e3.documentElement.style.tabSize != null ? "tab-size" : "-moz-tab-size" };
var lo2 = 256;
var U4 = class s56 extends T4 {
  constructor(t8) {
    super(), this.text = t8;
  }
  get length() {
    return this.text.length;
  }
  createDOM(t8) {
    this.setDOM(t8 || document.createTextNode(this.text));
  }
  sync(t8, e7) {
    this.dom || this.createDOM(), this.dom.nodeValue != this.text && (e7 && e7.node == this.dom && (e7.written = true), this.dom.nodeValue = this.text);
  }
  reuseDOM(t8) {
    t8.nodeType == 3 && this.createDOM(t8);
  }
  merge(t8, e7, i12) {
    return this.flags & 8 || i12 && (!(i12 instanceof s56) || this.length - (e7 - t8) + i12.length > lo2 || i12.flags & 8) ? false : (this.text = this.text.slice(0, t8) + (i12 ? i12.text : "") + this.text.slice(e7), this.markDirty(), true);
  }
  split(t8) {
    let e7 = new s56(this.text.slice(t8));
    return this.text = this.text.slice(0, t8), this.markDirty(), e7.flags |= this.flags & 8, e7;
  }
  localPosFromDOM(t8, e7) {
    return t8 == this.dom ? e7 : e7 ? this.text.length : 0;
  }
  domAtPos(t8) {
    return new V4(this.dom, t8);
  }
  domBoundsAround(t8, e7, i12) {
    return { from: i12, to: i12 + this.length, startDOM: this.dom, endDOM: this.dom.nextSibling };
  }
  coordsAt(t8, e7) {
    return ho2(this.dom, t8, e7);
  }
};
var rt3 = class s57 extends T4 {
  constructor(t8, e7 = [], i12 = 0) {
    super(), this.mark = t8, this.children = e7, this.length = i12;
    for (let n14 of e7) n14.setParent(this);
  }
  setAttrs(t8) {
    if (zs2(t8), this.mark.class && (t8.className = this.mark.class), this.mark.attrs) for (let e7 in this.mark.attrs) t8.setAttribute(e7, this.mark.attrs[e7]);
    return t8;
  }
  canReuseDOM(t8) {
    return super.canReuseDOM(t8) && !((this.flags | t8.flags) & 8);
  }
  reuseDOM(t8) {
    t8.nodeName == this.mark.tagName.toUpperCase() && (this.setDOM(t8), this.flags |= 6);
  }
  sync(t8, e7) {
    this.dom ? this.flags & 4 && this.setAttrs(this.dom) : this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))), super.sync(t8, e7);
  }
  merge(t8, e7, i12, n14, o, r2) {
    return i12 && (!(i12 instanceof s57 && i12.mark.eq(this.mark)) || t8 && o <= 0 || e7 < this.length && r2 <= 0) ? false : (Ys2(this, t8, e7, i12 ? i12.children.slice() : [], o - 1, r2 - 1), this.markDirty(), true);
  }
  split(t8) {
    let e7 = [], i12 = 0, n14 = -1, o = 0;
    for (let l11 of this.children) {
      let h3 = i12 + l11.length;
      h3 > t8 && e7.push(i12 < t8 ? l11.split(t8 - i12) : l11), n14 < 0 && i12 >= t8 && (n14 = o), i12 = h3, o++;
    }
    let r2 = this.length - t8;
    return this.length = t8, n14 > -1 && (this.children.length = n14, this.markDirty()), new s57(this.mark, e7, r2);
  }
  domAtPos(t8) {
    return Gs2(this, t8);
  }
  coordsAt(t8, e7) {
    return Us2(this, t8, e7);
  }
};
function ho2(s212, t8, e7) {
  let i12 = s212.nodeValue.length;
  t8 > i12 && (t8 = i12);
  let n14 = t8, o = t8, r2 = 0;
  t8 == 0 && e7 < 0 || t8 == i12 && e7 >= 0 ? y4.chrome || y4.gecko || (t8 ? (n14--, r2 = 1) : o < i12 && (o++, r2 = -1)) : e7 < 0 ? n14-- : o < i12 && o++;
  let l11 = pt2(s212, n14, o).getClientRects();
  if (!l11.length) return null;
  let h3 = l11[(r2 ? r2 < 0 : e7 >= 0) ? 0 : l11.length - 1];
  return y4.safari && !r2 && h3.width == 0 && (h3 = Array.prototype.find.call(l11, (c3) => c3.width) || h3), r2 ? te4(h3, r2 < 0) : h3 || null;
}
var Yt2 = class s58 extends T4 {
  static create(t8, e7, i12) {
    return new s58(t8, e7, i12);
  }
  constructor(t8, e7, i12) {
    super(), this.widget = t8, this.length = e7, this.side = i12, this.prevWidget = null;
  }
  split(t8) {
    let e7 = s58.create(this.widget, this.length - t8, this.side);
    return this.length -= t8, e7;
  }
  sync(t8) {
    (!this.dom || !this.widget.updateDOM(this.dom, t8)) && (this.dom && this.prevWidget && this.prevWidget.destroy(this.dom), this.prevWidget = null, this.setDOM(this.widget.toDOM(t8)), this.widget.editable || (this.dom.contentEditable = "false"));
  }
  getSide() {
    return this.side;
  }
  merge(t8, e7, i12, n14, o, r2) {
    return i12 && (!(i12 instanceof s58) || !this.widget.compare(i12.widget) || t8 > 0 && o <= 0 || e7 < this.length && r2 <= 0) ? false : (this.length = t8 + (i12 ? i12.length : 0) + (this.length - e7), true);
  }
  become(t8) {
    return t8 instanceof s58 && t8.side == this.side && this.widget.constructor == t8.widget.constructor ? (this.widget.compare(t8.widget) || this.markDirty(true), this.dom && !this.prevWidget && (this.prevWidget = this.widget), this.widget = t8.widget, this.length = t8.length, true) : false;
  }
  ignoreMutation() {
    return true;
  }
  ignoreEvent(t8) {
    return this.widget.ignoreEvent(t8);
  }
  get overrideDOMText() {
    if (this.length == 0) return m.empty;
    let t8 = this;
    for (; t8.parent; ) t8 = t8.parent;
    let { view: e7 } = t8, i12 = e7 && e7.state.doc, n14 = this.posAtStart;
    return i12 ? i12.slice(n14, n14 + this.length) : m.empty;
  }
  domAtPos(t8) {
    return (this.length ? t8 == 0 : this.side > 0) ? V4.before(this.dom) : V4.after(this.dom, t8 == this.length);
  }
  domBoundsAround() {
    return null;
  }
  coordsAt(t8, e7) {
    let i12 = this.widget.coordsAt(this.dom, t8, e7);
    if (i12) return i12;
    let n14 = this.dom.getClientRects(), o = null;
    if (!n14.length) return null;
    let r2 = this.side ? this.side < 0 : t8 > 0;
    for (let l11 = r2 ? n14.length - 1 : 0; o = n14[l11], !(t8 > 0 ? l11 == 0 : l11 == n14.length - 1 || o.top < o.bottom); l11 += r2 ? -1 : 1) ;
    return te4(o, !r2);
  }
  get isEditable() {
    return false;
  }
  get isWidget() {
    return true;
  }
  get isHidden() {
    return this.widget.isHidden;
  }
  destroy() {
    super.destroy(), this.dom && this.widget.destroy(this.dom);
  }
};
var _t2 = class s59 extends T4 {
  constructor(t8) {
    super(), this.side = t8;
  }
  get length() {
    return 0;
  }
  merge() {
    return false;
  }
  become(t8) {
    return t8 instanceof s59 && t8.side == this.side;
  }
  split() {
    return new s59(this.side);
  }
  sync() {
    if (!this.dom) {
      let t8 = document.createElement("img");
      t8.className = "cm-widgetBuffer", t8.setAttribute("aria-hidden", "true"), this.setDOM(t8);
    }
  }
  getSide() {
    return this.side;
  }
  domAtPos(t8) {
    return this.side > 0 ? V4.before(this.dom) : V4.after(this.dom);
  }
  localPosFromDOM() {
    return 0;
  }
  domBoundsAround() {
    return null;
  }
  coordsAt(t8) {
    return this.dom.getBoundingClientRect();
  }
  get overrideDOMText() {
    return m.empty;
  }
  get isHidden() {
    return true;
  }
};
U4.prototype.children = Yt2.prototype.children = _t2.prototype.children = Fi2;
function Gs2(s212, t8) {
  let e7 = s212.dom, { children: i12 } = s212, n14 = 0;
  for (let o = 0; n14 < i12.length; n14++) {
    let r2 = i12[n14], l11 = o + r2.length;
    if (!(l11 == o && r2.getSide() <= 0)) {
      if (t8 > o && t8 < l11 && r2.dom.parentNode == e7) return r2.domAtPos(t8 - o);
      if (t8 <= o) break;
      o = l11;
    }
  }
  for (let o = n14; o > 0; o--) {
    let r2 = i12[o - 1];
    if (r2.dom.parentNode == e7) return r2.domAtPos(r2.length);
  }
  for (let o = n14; o < i12.length; o++) {
    let r2 = i12[o];
    if (r2.dom.parentNode == e7) return r2.domAtPos(0);
  }
  return new V4(e7, 0);
}
function $s2(s212, t8, e7) {
  let i12, { children: n14 } = s212;
  e7 > 0 && t8 instanceof rt3 && n14.length && (i12 = n14[n14.length - 1]) instanceof rt3 && i12.mark.eq(t8.mark) ? $s2(i12, t8.children[0], e7 - 1) : (n14.push(t8), t8.setParent(s212)), s212.length += t8.length;
}
function Us2(s212, t8, e7) {
  let i12 = null, n14 = -1, o = null, r2 = -1;
  function l11(c3, a2) {
    for (let f6 = 0, d4 = 0; f6 < c3.children.length && d4 <= a2; f6++) {
      let u3 = c3.children[f6], p3 = d4 + u3.length;
      p3 >= a2 && (u3.children.length ? l11(u3, a2 - d4) : (!o || o.isHidden && e7 > 0) && (p3 > a2 || d4 == p3 && u3.getSide() > 0) ? (o = u3, r2 = a2 - d4) : (d4 < a2 || d4 == p3 && u3.getSide() < 0 && !u3.isHidden) && (i12 = u3, n14 = a2 - d4)), d4 = p3;
    }
  }
  l11(s212, t8);
  let h3 = (e7 < 0 ? i12 : o) || i12 || o;
  return h3 ? h3.coordsAt(Math.max(0, h3 == i12 ? n14 : r2), e7) : ao2(s212);
}
function ao2(s212) {
  let t8 = s212.dom.lastChild;
  if (!t8) return s212.dom.getBoundingClientRect();
  let e7 = At2(t8);
  return e7[e7.length - 1] || null;
}
function Je3(s212, t8) {
  for (let e7 in s212) e7 == "class" && t8.class ? t8.class += " " + s212.class : e7 == "style" && t8.style ? t8.style += ";" + s212.style : t8[e7] = s212[e7];
  return t8;
}
var Qi2 = /* @__PURE__ */ Object.create(null);
function Se3(s212, t8, e7) {
  if (s212 == t8) return true;
  s212 || (s212 = Qi2), t8 || (t8 = Qi2);
  let i12 = Object.keys(s212), n14 = Object.keys(t8);
  if (i12.length - (e7 && i12.indexOf(e7) > -1 ? 1 : 0) != n14.length - (e7 && n14.indexOf(e7) > -1 ? 1 : 0)) return false;
  for (let o of i12) if (o != e7 && (n14.indexOf(o) == -1 || s212[o] !== t8[o])) return false;
  return true;
}
function Ze3(s212, t8, e7) {
  let i12 = false;
  if (t8) for (let n14 in t8) e7 && n14 in e7 || (i12 = true, n14 == "style" ? s212.style.cssText = "" : s212.removeAttribute(n14));
  if (e7) for (let n14 in e7) t8 && t8[n14] == e7[n14] || (i12 = true, n14 == "style" ? s212.style.cssText = e7[n14] : s212.setAttribute(n14, e7[n14]));
  return i12;
}
function co2(s212) {
  let t8 = /* @__PURE__ */ Object.create(null);
  for (let e7 = 0; e7 < s212.attributes.length; e7++) {
    let i12 = s212.attributes[e7];
    t8[i12.name] = i12.value;
  }
  return t8;
}
var lt3 = class {
  eq(t8) {
    return false;
  }
  updateDOM(t8, e7) {
    return false;
  }
  compare(t8) {
    return this == t8 || this.constructor == t8.constructor && this.eq(t8);
  }
  get estimatedHeight() {
    return -1;
  }
  get lineBreaks() {
    return 0;
  }
  ignoreEvent(t8) {
    return true;
  }
  coordsAt(t8, e7, i12) {
    return null;
  }
  get isHidden() {
    return false;
  }
  get editable() {
    return false;
  }
  destroy(t8) {
  }
};
var F4 = function(s212) {
  return s212[s212.Text = 0] = "Text", s212[s212.WidgetBefore = 1] = "WidgetBefore", s212[s212.WidgetAfter = 2] = "WidgetAfter", s212[s212.WidgetRange = 3] = "WidgetRange", s212;
}(F4 || (F4 = {}));
var R3 = class extends W {
  constructor(t8, e7, i12, n14) {
    super(), this.startSide = t8, this.endSide = e7, this.widget = i12, this.spec = n14;
  }
  get heightRelevant() {
    return false;
  }
  static mark(t8) {
    return new Xt2(t8);
  }
  static widget(t8) {
    let e7 = Math.max(-1e4, Math.min(1e4, t8.side || 0)), i12 = !!t8.block;
    return e7 += i12 && !t8.inlineOrder ? e7 > 0 ? 3e8 : -4e8 : e7 > 0 ? 1e8 : -1e8, new ht3(t8, e7, e7, i12, t8.widget || null, false);
  }
  static replace(t8) {
    let e7 = !!t8.block, i12, n14;
    if (t8.isBlockGap) i12 = -5e8, n14 = 4e8;
    else {
      let { start: o, end: r2 } = Qs2(t8, e7);
      i12 = (o ? e7 ? -3e8 : -1 : 5e8) - 1, n14 = (r2 ? e7 ? 2e8 : 1 : -6e8) + 1;
    }
    return new ht3(t8, i12, n14, e7, t8.widget || null, true);
  }
  static line(t8) {
    return new Gt2(t8);
  }
  static set(t8, e7 = false) {
    return T.of(t8, e7);
  }
  hasHeight() {
    return this.widget ? this.widget.estimatedHeight > -1 : false;
  }
};
R3.none = T.empty;
var Xt2 = class s60 extends R3 {
  constructor(t8) {
    let { start: e7, end: i12 } = Qs2(t8);
    super(e7 ? -1 : 5e8, i12 ? 1 : -6e8, null, t8), this.tagName = t8.tagName || "span", this.class = t8.class || "", this.attrs = t8.attributes || null;
  }
  eq(t8) {
    var e7, i12;
    return this == t8 || t8 instanceof s60 && this.tagName == t8.tagName && (this.class || ((e7 = this.attrs) === null || e7 === void 0 ? void 0 : e7.class)) == (t8.class || ((i12 = t8.attrs) === null || i12 === void 0 ? void 0 : i12.class)) && Se3(this.attrs, t8.attrs, "class");
  }
  range(t8, e7 = t8) {
    if (t8 >= e7) throw new RangeError("Mark decorations may not be empty");
    return super.range(t8, e7);
  }
};
Xt2.prototype.point = false;
var Gt2 = class s61 extends R3 {
  constructor(t8) {
    super(-2e8, -2e8, null, t8);
  }
  eq(t8) {
    return t8 instanceof s61 && this.spec.class == t8.spec.class && Se3(this.spec.attributes, t8.spec.attributes);
  }
  range(t8, e7 = t8) {
    if (e7 != t8) throw new RangeError("Line decoration ranges must be zero-length");
    return super.range(t8, e7);
  }
};
Gt2.prototype.mapMode = E.TrackBefore;
Gt2.prototype.point = true;
var ht3 = class s62 extends R3 {
  constructor(t8, e7, i12, n14, o, r2) {
    super(e7, i12, o, t8), this.block = n14, this.isReplace = r2, this.mapMode = n14 ? e7 <= 0 ? E.TrackBefore : E.TrackAfter : E.TrackDel;
  }
  get type() {
    return this.startSide != this.endSide ? F4.WidgetRange : this.startSide <= 0 ? F4.WidgetBefore : F4.WidgetAfter;
  }
  get heightRelevant() {
    return this.block || !!this.widget && (this.widget.estimatedHeight >= 5 || this.widget.lineBreaks > 0);
  }
  eq(t8) {
    return t8 instanceof s62 && fo2(this.widget, t8.widget) && this.block == t8.block && this.startSide == t8.startSide && this.endSide == t8.endSide;
  }
  range(t8, e7 = t8) {
    if (this.isReplace && (t8 > e7 || t8 == e7 && this.startSide > 0 && this.endSide <= 0)) throw new RangeError("Invalid range for replacement decoration");
    if (!this.isReplace && e7 != t8) throw new RangeError("Widget decorations can only have zero-length ranges");
    return super.range(t8, e7);
  }
};
ht3.prototype.point = true;
function Qs2(s212, t8 = false) {
  let { inclusiveStart: e7, inclusiveEnd: i12 } = s212;
  return e7 == null && (e7 = s212.inclusive), i12 == null && (i12 = s212.inclusive), { start: e7 ?? t8, end: i12 ?? t8 };
}
function fo2(s212, t8) {
  return s212 == t8 || !!(s212 && t8 && s212.compare(t8));
}
function ti2(s212, t8, e7, i12 = 0) {
  let n14 = e7.length - 1;
  n14 >= 0 && e7[n14] + i12 >= s212 ? e7[n14] = Math.max(e7[n14], t8) : e7.push(s212, t8);
}
var P3 = class s63 extends T4 {
  constructor() {
    super(...arguments), this.children = [], this.length = 0, this.prevAttrs = void 0, this.attrs = null, this.breakAfter = 0;
  }
  merge(t8, e7, i12, n14, o, r2) {
    if (i12) {
      if (!(i12 instanceof s63)) return false;
      this.dom || i12.transferDOM(this);
    }
    return n14 && this.setDeco(i12 ? i12.attrs : null), Ys2(this, t8, e7, i12 ? i12.children.slice() : [], o, r2), true;
  }
  split(t8) {
    let e7 = new s63();
    if (e7.breakAfter = this.breakAfter, this.length == 0) return e7;
    let { i: i12, off: n14 } = this.childPos(t8);
    n14 && (e7.append(this.children[i12].split(n14), 0), this.children[i12].merge(n14, this.children[i12].length, null, false, 0, 0), i12++);
    for (let o = i12; o < this.children.length; o++) e7.append(this.children[o], 0);
    for (; i12 > 0 && this.children[i12 - 1].length == 0; ) this.children[--i12].destroy();
    return this.children.length = i12, this.markDirty(), this.length = t8, e7;
  }
  transferDOM(t8) {
    this.dom && (this.markDirty(), t8.setDOM(this.dom), t8.prevAttrs = this.prevAttrs === void 0 ? this.attrs : this.prevAttrs, this.prevAttrs = void 0, this.dom = null);
  }
  setDeco(t8) {
    Se3(this.attrs, t8) || (this.dom && (this.prevAttrs = this.attrs, this.markDirty()), this.attrs = t8);
  }
  append(t8, e7) {
    $s2(this, t8, e7);
  }
  addLineDeco(t8) {
    let e7 = t8.spec.attributes, i12 = t8.spec.class;
    e7 && (this.attrs = Je3(e7, this.attrs || {})), i12 && (this.attrs = Je3({ class: i12 }, this.attrs || {}));
  }
  domAtPos(t8) {
    return Gs2(this, t8);
  }
  reuseDOM(t8) {
    t8.nodeName == "DIV" && (this.setDOM(t8), this.flags |= 6);
  }
  sync(t8, e7) {
    var i12;
    this.dom ? this.flags & 4 && (zs2(this.dom), this.dom.className = "cm-line", this.prevAttrs = this.attrs ? null : void 0) : (this.setDOM(document.createElement("div")), this.dom.className = "cm-line", this.prevAttrs = this.attrs ? null : void 0), this.prevAttrs !== void 0 && (Ze3(this.dom, this.prevAttrs, this.attrs), this.dom.classList.add("cm-line"), this.prevAttrs = void 0), super.sync(t8, e7);
    let n14 = this.dom.lastChild;
    for (; n14 && T4.get(n14) instanceof rt3; ) n14 = n14.lastChild;
    if (!n14 || !this.length || n14.nodeName != "BR" && ((i12 = T4.get(n14)) === null || i12 === void 0 ? void 0 : i12.isEditable) == false && (!y4.ios || !this.children.some((o) => o instanceof U4))) {
      let o = document.createElement("BR");
      o.cmIgnore = true, this.dom.appendChild(o);
    }
  }
  measureTextSize() {
    if (this.children.length == 0 || this.length > 20) return null;
    let t8 = 0, e7;
    for (let i12 of this.children) {
      if (!(i12 instanceof U4) || /[^ -~]/.test(i12.text)) return null;
      let n14 = At2(i12.dom);
      if (n14.length != 1) return null;
      t8 += n14[0].width, e7 = n14[0].height;
    }
    return t8 ? { lineHeight: this.dom.getBoundingClientRect().height, charWidth: t8 / this.length, textHeight: e7 } : null;
  }
  coordsAt(t8, e7) {
    let i12 = Us2(this, t8, e7);
    if (!this.children.length && i12 && this.parent) {
      let { heightOracle: n14 } = this.parent.view.viewState, o = i12.bottom - i12.top;
      if (Math.abs(o - n14.lineHeight) < 2 && n14.textHeight < o) {
        let r2 = (o - n14.textHeight) / 2;
        return { top: i12.top + r2, bottom: i12.bottom - r2, left: i12.left, right: i12.left };
      }
    }
    return i12;
  }
  become(t8) {
    return t8 instanceof s63 && this.children.length == 0 && t8.children.length == 0 && Se3(this.attrs, t8.attrs) && this.breakAfter == t8.breakAfter;
  }
  covers() {
    return true;
  }
  static find(t8, e7) {
    for (let i12 = 0, n14 = 0; i12 < t8.children.length; i12++) {
      let o = t8.children[i12], r2 = n14 + o.length;
      if (r2 >= e7) {
        if (o instanceof s63) return o;
        if (r2 > e7) break;
      }
      n14 = r2 + o.breakAfter;
    }
    return null;
  }
};
var dt2 = class s64 extends T4 {
  constructor(t8, e7, i12) {
    super(), this.widget = t8, this.length = e7, this.deco = i12, this.breakAfter = 0, this.prevWidget = null;
  }
  merge(t8, e7, i12, n14, o, r2) {
    return i12 && (!(i12 instanceof s64) || !this.widget.compare(i12.widget) || t8 > 0 && o <= 0 || e7 < this.length && r2 <= 0) ? false : (this.length = t8 + (i12 ? i12.length : 0) + (this.length - e7), true);
  }
  domAtPos(t8) {
    return t8 == 0 ? V4.before(this.dom) : V4.after(this.dom, t8 == this.length);
  }
  split(t8) {
    let e7 = this.length - t8;
    this.length = t8;
    let i12 = new s64(this.widget, e7, this.deco);
    return i12.breakAfter = this.breakAfter, i12;
  }
  get children() {
    return Fi2;
  }
  sync(t8) {
    (!this.dom || !this.widget.updateDOM(this.dom, t8)) && (this.dom && this.prevWidget && this.prevWidget.destroy(this.dom), this.prevWidget = null, this.setDOM(this.widget.toDOM(t8)), this.widget.editable || (this.dom.contentEditable = "false"));
  }
  get overrideDOMText() {
    return this.parent ? this.parent.view.state.doc.slice(this.posAtStart, this.posAtEnd) : m.empty;
  }
  domBoundsAround() {
    return null;
  }
  become(t8) {
    return t8 instanceof s64 && t8.widget.constructor == this.widget.constructor ? (t8.widget.compare(this.widget) || this.markDirty(true), this.dom && !this.prevWidget && (this.prevWidget = this.widget), this.widget = t8.widget, this.length = t8.length, this.deco = t8.deco, this.breakAfter = t8.breakAfter, true) : false;
  }
  ignoreMutation() {
    return true;
  }
  ignoreEvent(t8) {
    return this.widget.ignoreEvent(t8);
  }
  get isEditable() {
    return false;
  }
  get isWidget() {
    return true;
  }
  coordsAt(t8, e7) {
    let i12 = this.widget.coordsAt(this.dom, t8, e7);
    return i12 || (this.widget instanceof $t2 ? null : te4(this.dom.getBoundingClientRect(), this.length ? t8 == 0 : e7 <= 0));
  }
  destroy() {
    super.destroy(), this.dom && this.widget.destroy(this.dom);
  }
  covers(t8) {
    let { startSide: e7, endSide: i12 } = this.deco;
    return e7 == i12 ? false : t8 < 0 ? e7 < 0 : i12 > 0;
  }
};
var $t2 = class extends lt3 {
  constructor(t8) {
    super(), this.height = t8;
  }
  toDOM() {
    let t8 = document.createElement("div");
    return t8.className = "cm-gap", this.updateDOM(t8), t8;
  }
  eq(t8) {
    return t8.height == this.height;
  }
  updateDOM(t8) {
    return t8.style.height = this.height + "px", true;
  }
  get editable() {
    return true;
  }
  get estimatedHeight() {
    return this.height;
  }
  ignoreEvent() {
    return false;
  }
};
var Ft2 = class s65 {
  constructor(t8, e7, i12, n14) {
    this.doc = t8, this.pos = e7, this.end = i12, this.disallowBlockEffectsFor = n14, this.content = [], this.curLine = null, this.breakAtStart = 0, this.pendingBuffer = 0, this.bufferMarks = [], this.atCursorPos = true, this.openStart = -1, this.openEnd = -1, this.text = "", this.textOff = 0, this.cursor = t8.iter(), this.skip = e7;
  }
  posCovered() {
    if (this.content.length == 0) return !this.breakAtStart && this.doc.lineAt(this.pos).from != this.pos;
    let t8 = this.content[this.content.length - 1];
    return !(t8.breakAfter || t8 instanceof dt2 && t8.deco.endSide < 0);
  }
  getLine() {
    return this.curLine || (this.content.push(this.curLine = new P3()), this.atCursorPos = true), this.curLine;
  }
  flushBuffer(t8 = this.bufferMarks) {
    this.pendingBuffer && (this.curLine.append(ne4(new _t2(-1), t8), t8.length), this.pendingBuffer = 0);
  }
  addBlockWidget(t8) {
    this.flushBuffer(), this.curLine = null, this.content.push(t8);
  }
  finish(t8) {
    this.pendingBuffer && t8 <= this.bufferMarks.length ? this.flushBuffer() : this.pendingBuffer = 0, !this.posCovered() && !(t8 && this.content.length && this.content[this.content.length - 1] instanceof dt2) && this.getLine();
  }
  buildText(t8, e7, i12) {
    for (; t8 > 0; ) {
      if (this.textOff == this.text.length) {
        let { value: o, lineBreak: r2, done: l11 } = this.cursor.next(this.skip);
        if (this.skip = 0, l11) throw new Error("Ran out of text content when drawing inline views");
        if (r2) {
          this.posCovered() || this.getLine(), this.content.length ? this.content[this.content.length - 1].breakAfter = 1 : this.breakAtStart = 1, this.flushBuffer(), this.curLine = null, this.atCursorPos = true, t8--;
          continue;
        } else this.text = o, this.textOff = 0;
      }
      let n14 = Math.min(this.text.length - this.textOff, t8, 512);
      this.flushBuffer(e7.slice(e7.length - i12)), this.getLine().append(ne4(new U4(this.text.slice(this.textOff, this.textOff + n14)), e7), i12), this.atCursorPos = true, this.textOff += n14, t8 -= n14, i12 = 0;
    }
  }
  span(t8, e7, i12, n14) {
    this.buildText(e7 - t8, i12, n14), this.pos = e7, this.openStart < 0 && (this.openStart = n14);
  }
  point(t8, e7, i12, n14, o, r2) {
    if (this.disallowBlockEffectsFor[r2] && i12 instanceof ht3) {
      if (i12.block) throw new RangeError("Block decorations may not be specified via plugins");
      if (e7 > this.doc.lineAt(this.pos).to) throw new RangeError("Decorations that replace line breaks may not be specified via plugins");
    }
    let l11 = e7 - t8;
    if (i12 instanceof ht3) if (i12.block) i12.startSide > 0 && !this.posCovered() && this.getLine(), this.addBlockWidget(new dt2(i12.widget || at3.block, l11, i12));
    else {
      let h3 = Yt2.create(i12.widget || at3.inline, l11, l11 ? 0 : i12.startSide), c3 = this.atCursorPos && !h3.isEditable && o <= n14.length && (t8 < e7 || i12.startSide > 0), a2 = !h3.isEditable && (t8 < e7 || o > n14.length || i12.startSide <= 0), f6 = this.getLine();
      this.pendingBuffer == 2 && !c3 && !h3.isEditable && (this.pendingBuffer = 0), this.flushBuffer(n14), c3 && (f6.append(ne4(new _t2(1), n14), o), o = n14.length + Math.max(0, o - n14.length)), f6.append(ne4(h3, n14), o), this.atCursorPos = a2, this.pendingBuffer = a2 ? t8 < e7 || o > n14.length ? 1 : 2 : 0, this.pendingBuffer && (this.bufferMarks = n14.slice());
    }
    else this.doc.lineAt(this.pos).from == this.pos && this.getLine().addLineDeco(i12);
    l11 && (this.textOff + l11 <= this.text.length ? this.textOff += l11 : (this.skip += l11 - (this.text.length - this.textOff), this.text = "", this.textOff = 0), this.pos = e7), this.openStart < 0 && (this.openStart = o);
  }
  static build(t8, e7, i12, n14, o) {
    let r2 = new s65(t8, e7, i12, o);
    return r2.openEnd = T.spans(n14, e7, i12, r2), r2.openStart < 0 && (r2.openStart = r2.openEnd), r2.finish(r2.openEnd), r2;
  }
};
function ne4(s212, t8) {
  for (let e7 of t8) s212 = new rt3(e7, [s212], s212.length);
  return s212;
}
var at3 = class extends lt3 {
  constructor(t8) {
    super(), this.tag = t8;
  }
  eq(t8) {
    return t8.tag == this.tag;
  }
  toDOM() {
    return document.createElement(this.tag);
  }
  updateDOM(t8) {
    return t8.nodeName.toLowerCase() == this.tag;
  }
  get isHidden() {
    return true;
  }
};
at3.inline = new at3("span");
at3.block = new at3("div");
var L3 = function(s212) {
  return s212[s212.LTR = 0] = "LTR", s212[s212.RTL = 1] = "RTL", s212;
}(L3 || (L3 = {}));
var gt2 = L3.LTR;
var Wi2 = L3.RTL;
function Js2(s212) {
  let t8 = [];
  for (let e7 = 0; e7 < s212.length; e7++) t8.push(1 << +s212[e7]);
  return t8;
}
var uo2 = Js2("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008");
var po2 = Js2("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333");
var ei2 = /* @__PURE__ */ Object.create(null);
var _3 = [];
for (let s212 of ["()", "[]", "{}"]) {
  let t8 = s212.charCodeAt(0), e7 = s212.charCodeAt(1);
  ei2[t8] = e7, ei2[e7] = -t8;
}
function Zs2(s212) {
  return s212 <= 247 ? uo2[s212] : 1424 <= s212 && s212 <= 1524 ? 2 : 1536 <= s212 && s212 <= 1785 ? po2[s212 - 1536] : 1774 <= s212 && s212 <= 2220 ? 4 : 8192 <= s212 && s212 <= 8204 ? 256 : 64336 <= s212 && s212 <= 65023 ? 4 : 1;
}
var go2 = /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;
var G4 = class {
  get dir() {
    return this.level % 2 ? Wi2 : gt2;
  }
  constructor(t8, e7, i12) {
    this.from = t8, this.to = e7, this.level = i12;
  }
  side(t8, e7) {
    return this.dir == e7 == t8 ? this.to : this.from;
  }
  forward(t8, e7) {
    return t8 == (this.dir == e7);
  }
  static find(t8, e7, i12, n14) {
    let o = -1;
    for (let r2 = 0; r2 < t8.length; r2++) {
      let l11 = t8[r2];
      if (l11.from <= e7 && l11.to >= e7) {
        if (l11.level == i12) return r2;
        (o < 0 || (n14 != 0 ? n14 < 0 ? l11.from < e7 : l11.to > e7 : t8[o].level > l11.level)) && (o = r2);
      }
    }
    if (o < 0) throw new RangeError("Index out of range");
    return o;
  }
};
function tn2(s212, t8) {
  if (s212.length != t8.length) return false;
  for (let e7 = 0; e7 < s212.length; e7++) {
    let i12 = s212[e7], n14 = t8[e7];
    if (i12.from != n14.from || i12.to != n14.to || i12.direction != n14.direction || !tn2(i12.inner, n14.inner)) return false;
  }
  return true;
}
var D3 = [];
function mo2(s212, t8, e7, i12, n14) {
  for (let o = 0; o <= i12.length; o++) {
    let r2 = o ? i12[o - 1].to : t8, l11 = o < i12.length ? i12[o].from : e7, h3 = o ? 256 : n14;
    for (let c3 = r2, a2 = h3, f6 = h3; c3 < l11; c3++) {
      let d4 = Zs2(s212.charCodeAt(c3));
      d4 == 512 ? d4 = a2 : d4 == 8 && f6 == 4 && (d4 = 16), D3[c3] = d4 == 4 ? 2 : d4, d4 & 7 && (f6 = d4), a2 = d4;
    }
    for (let c3 = r2, a2 = h3, f6 = h3; c3 < l11; c3++) {
      let d4 = D3[c3];
      if (d4 == 128) c3 < l11 - 1 && a2 == D3[c3 + 1] && a2 & 24 ? d4 = D3[c3] = a2 : D3[c3] = 256;
      else if (d4 == 64) {
        let u3 = c3 + 1;
        for (; u3 < l11 && D3[u3] == 64; ) u3++;
        let p3 = c3 && a2 == 8 || u3 < e7 && D3[u3] == 8 ? f6 == 1 ? 1 : 8 : 256;
        for (let g8 = c3; g8 < u3; g8++) D3[g8] = p3;
        c3 = u3 - 1;
      } else d4 == 8 && f6 == 1 && (D3[c3] = 1);
      a2 = d4, d4 & 7 && (f6 = d4);
    }
  }
}
function bo2(s212, t8, e7, i12, n14) {
  let o = n14 == 1 ? 2 : 1;
  for (let r2 = 0, l11 = 0, h3 = 0; r2 <= i12.length; r2++) {
    let c3 = r2 ? i12[r2 - 1].to : t8, a2 = r2 < i12.length ? i12[r2].from : e7;
    for (let f6 = c3, d4, u3, p3; f6 < a2; f6++) if (u3 = ei2[d4 = s212.charCodeAt(f6)]) if (u3 < 0) {
      for (let g8 = l11 - 3; g8 >= 0; g8 -= 3) if (_3[g8 + 1] == -u3) {
        let b12 = _3[g8 + 2], m11 = b12 & 2 ? n14 : b12 & 4 ? b12 & 1 ? o : n14 : 0;
        m11 && (D3[f6] = D3[_3[g8]] = m11), l11 = g8;
        break;
      }
    } else {
      if (_3.length == 189) break;
      _3[l11++] = f6, _3[l11++] = d4, _3[l11++] = h3;
    }
    else if ((p3 = D3[f6]) == 2 || p3 == 1) {
      let g8 = p3 == n14;
      h3 = g8 ? 0 : 1;
      for (let b12 = l11 - 3; b12 >= 0; b12 -= 3) {
        let m11 = _3[b12 + 2];
        if (m11 & 2) break;
        if (g8) _3[b12 + 2] |= 2;
        else {
          if (m11 & 4) break;
          _3[b12 + 2] |= 4;
        }
      }
    }
  }
}
function yo2(s212, t8, e7, i12) {
  for (let n14 = 0, o = i12; n14 <= e7.length; n14++) {
    let r2 = n14 ? e7[n14 - 1].to : s212, l11 = n14 < e7.length ? e7[n14].from : t8;
    for (let h3 = r2; h3 < l11; ) {
      let c3 = D3[h3];
      if (c3 == 256) {
        let a2 = h3 + 1;
        for (; ; ) if (a2 == l11) {
          if (n14 == e7.length) break;
          a2 = e7[n14++].to, l11 = n14 < e7.length ? e7[n14].from : t8;
        } else if (D3[a2] == 256) a2++;
        else break;
        let f6 = o == 1, d4 = (a2 < t8 ? D3[a2] : i12) == 1, u3 = f6 == d4 ? f6 ? 1 : 2 : i12;
        for (let p3 = a2, g8 = n14, b12 = g8 ? e7[g8 - 1].to : s212; p3 > h3; ) p3 == b12 && (p3 = e7[--g8].from, b12 = g8 ? e7[g8 - 1].to : s212), D3[--p3] = u3;
        h3 = a2;
      } else o = c3, h3++;
    }
  }
}
function ii2(s212, t8, e7, i12, n14, o, r2) {
  let l11 = i12 % 2 ? 2 : 1;
  if (i12 % 2 == n14 % 2) for (let h3 = t8, c3 = 0; h3 < e7; ) {
    let a2 = true, f6 = false;
    if (c3 == o.length || h3 < o[c3].from) {
      let g8 = D3[h3];
      g8 != l11 && (a2 = false, f6 = g8 == 16);
    }
    let d4 = !a2 && l11 == 1 ? [] : null, u3 = a2 ? i12 : i12 + 1, p3 = h3;
    t: for (; ; ) if (c3 < o.length && p3 == o[c3].from) {
      if (f6) break t;
      let g8 = o[c3];
      if (!a2) for (let b12 = g8.to, m11 = c3 + 1; ; ) {
        if (b12 == e7) break t;
        if (m11 < o.length && o[m11].from == b12) b12 = o[m11++].to;
        else {
          if (D3[b12] == l11) break t;
          break;
        }
      }
      if (c3++, d4) d4.push(g8);
      else {
        g8.from > h3 && r2.push(new G4(h3, g8.from, u3));
        let b12 = g8.direction == gt2 != !(u3 % 2);
        si2(s212, b12 ? i12 + 1 : i12, n14, g8.inner, g8.from, g8.to, r2), h3 = g8.to;
      }
      p3 = g8.to;
    } else {
      if (p3 == e7 || (a2 ? D3[p3] != l11 : D3[p3] == l11)) break;
      p3++;
    }
    d4 ? ii2(s212, h3, p3, i12 + 1, n14, d4, r2) : h3 < p3 && r2.push(new G4(h3, p3, u3)), h3 = p3;
  }
  else for (let h3 = e7, c3 = o.length; h3 > t8; ) {
    let a2 = true, f6 = false;
    if (!c3 || h3 > o[c3 - 1].to) {
      let g8 = D3[h3 - 1];
      g8 != l11 && (a2 = false, f6 = g8 == 16);
    }
    let d4 = !a2 && l11 == 1 ? [] : null, u3 = a2 ? i12 : i12 + 1, p3 = h3;
    t: for (; ; ) if (c3 && p3 == o[c3 - 1].to) {
      if (f6) break t;
      let g8 = o[--c3];
      if (!a2) for (let b12 = g8.from, m11 = c3; ; ) {
        if (b12 == t8) break t;
        if (m11 && o[m11 - 1].to == b12) b12 = o[--m11].from;
        else {
          if (D3[b12 - 1] == l11) break t;
          break;
        }
      }
      if (d4) d4.push(g8);
      else {
        g8.to < h3 && r2.push(new G4(g8.to, h3, u3));
        let b12 = g8.direction == gt2 != !(u3 % 2);
        si2(s212, b12 ? i12 + 1 : i12, n14, g8.inner, g8.from, g8.to, r2), h3 = g8.from;
      }
      p3 = g8.from;
    } else {
      if (p3 == t8 || (a2 ? D3[p3 - 1] != l11 : D3[p3 - 1] == l11)) break;
      p3--;
    }
    d4 ? ii2(s212, p3, h3, i12 + 1, n14, d4, r2) : p3 < h3 && r2.push(new G4(p3, h3, u3)), h3 = p3;
  }
}
function si2(s212, t8, e7, i12, n14, o, r2) {
  let l11 = t8 % 2 ? 2 : 1;
  mo2(s212, n14, o, i12, l11), bo2(s212, n14, o, i12, l11), yo2(n14, o, i12, l11), ii2(s212, n14, o, t8, e7, i12, r2);
}
function en2(s212, t8, e7) {
  if (!s212) return [new G4(0, 0, t8 == Wi2 ? 1 : 0)];
  if (t8 == gt2 && !e7.length && !go2.test(s212)) return sn2(s212.length);
  if (e7.length) for (; s212.length > D3.length; ) D3[D3.length] = 256;
  let i12 = [], n14 = t8 == gt2 ? 0 : 1;
  return si2(s212, n14, n14, e7, 0, s212.length, i12), i12;
}
function sn2(s212) {
  return [new G4(0, s212, 0)];
}
var nn2 = "";
function on2(s212, t8, e7, i12, n14) {
  var o;
  let r2 = i12.head - s212.from, l11 = G4.find(t8, r2, (o = i12.bidiLevel) !== null && o !== void 0 ? o : -1, i12.assoc), h3 = t8[l11], c3 = h3.side(n14, e7);
  if (r2 == c3) {
    let d4 = l11 += n14 ? 1 : -1;
    if (d4 < 0 || d4 >= t8.length) return null;
    h3 = t8[l11 = d4], r2 = h3.side(!n14, e7), c3 = h3.side(n14, e7);
  }
  let a2 = ee(s212.text, r2, h3.forward(n14, e7));
  (a2 < h3.from || a2 > h3.to) && (a2 = c3), nn2 = s212.text.slice(Math.min(r2, a2), Math.max(r2, a2));
  let f6 = l11 == (n14 ? t8.length - 1 : 0) ? null : t8[l11 + (n14 ? 1 : -1)];
  return f6 && a2 == c3 && f6.level + (n14 ? 0 : 1) < h3.level ? x.cursor(f6.side(!n14, e7) + s212.from, f6.forward(n14, e7) ? 1 : -1, f6.level) : x.cursor(a2 + s212.from, h3.forward(n14, e7) ? -1 : 1, h3.level);
}
function wo2(s212, t8, e7) {
  for (let i12 = t8; i12 < e7; i12++) {
    let n14 = Zs2(s212.charCodeAt(i12));
    if (n14 == 1) return gt2;
    if (n14 == 2 || n14 == 4) return Wi2;
  }
  return gt2;
}
var rn2 = y.define();
var ln2 = y.define();
var hn2 = y.define();
var an2 = y.define();
var ni2 = y.define();
var cn2 = y.define();
var fn2 = y.define();
var zi2 = y.define();
var Ii2 = y.define();
var dn2 = y.define({ combine: (s212) => s212.some((t8) => t8) });
var un2 = y.define({ combine: (s212) => s212.some((t8) => t8) });
var pn2 = y.define();
var Wt2 = class s66 {
  constructor(t8, e7 = "nearest", i12 = "nearest", n14 = 5, o = 5, r2 = false) {
    this.range = t8, this.y = e7, this.x = i12, this.yMargin = n14, this.xMargin = o, this.isSnapshot = r2;
  }
  map(t8) {
    return t8.empty ? this : new s66(this.range.map(t8), this.y, this.x, this.yMargin, this.xMargin, this.isSnapshot);
  }
  clip(t8) {
    return this.range.to <= t8.doc.length ? this : new s66(x.cursor(t8.doc.length), this.y, this.x, this.yMargin, this.xMargin, this.isSnapshot);
  }
};
var oe3 = v.define({ map: (s212, t8) => s212.map(t8) });
var gn2 = v.define();
function $3(s212, t8, e7) {
  let i12 = s212.facet(an2);
  i12.length ? i12[0](t8) : window.onerror ? window.onerror(String(t8), e7, void 0, void 0, t8) : e7 ? console.error(e7 + ":", t8) : console.error(t8);
}
var st3 = y.define({ combine: (s212) => s212.length ? s212[0] : true });
var xo2 = 0;
var Et2 = y.define();
var N3 = class s67 {
  constructor(t8, e7, i12, n14, o) {
    this.id = t8, this.create = e7, this.domEventHandlers = i12, this.domEventObservers = n14, this.extension = o(this);
  }
  static define(t8, e7) {
    let { eventHandlers: i12, eventObservers: n14, provide: o, decorations: r2 } = e7 || {};
    return new s67(xo2++, t8, i12, n14, (l11) => {
      let h3 = [Et2.of(l11)];
      return r2 && h3.push(Ut2.of((c3) => {
        let a2 = c3.plugin(l11);
        return a2 ? r2(a2) : R3.none;
      })), o && h3.push(o(l11)), h3;
    });
  }
  static fromClass(t8, e7) {
    return s67.define((i12) => new t8(i12), e7);
  }
};
var zt2 = class {
  constructor(t8) {
    this.spec = t8, this.mustUpdate = null, this.value = null;
  }
  update(t8) {
    if (this.value) {
      if (this.mustUpdate) {
        let e7 = this.mustUpdate;
        if (this.mustUpdate = null, this.value.update) try {
          this.value.update(e7);
        } catch (i12) {
          if ($3(e7.state, i12, "CodeMirror plugin crashed"), this.value.destroy) try {
            this.value.destroy();
          } catch {
          }
          this.deactivate();
        }
      }
    } else if (this.spec) try {
      this.value = this.spec.create(t8);
    } catch (e7) {
      $3(t8.state, e7, "CodeMirror plugin crashed"), this.deactivate();
    }
    return this;
  }
  destroy(t8) {
    var e7;
    if (!((e7 = this.value) === null || e7 === void 0) && e7.destroy) try {
      this.value.destroy();
    } catch (i12) {
      $3(t8.state, i12, "CodeMirror plugin crashed");
    }
  }
  deactivate() {
    this.spec = this.value = null;
  }
};
var mn2 = y.define();
var Ve3 = y.define();
var Ut2 = y.define();
var bn2 = y.define();
var Ki2 = y.define();
var yn2 = y.define();
function Ji2(s212, t8) {
  let e7 = s212.state.facet(yn2);
  if (!e7.length) return e7;
  let i12 = e7.map((o) => o instanceof Function ? o(s212) : o), n14 = [];
  return T.spans(i12, t8.from, t8.to, { point() {
  }, span(o, r2, l11, h3) {
    let c3 = o - t8.from, a2 = r2 - t8.from, f6 = n14;
    for (let d4 = l11.length - 1; d4 >= 0; d4--, h3--) {
      let u3 = l11[d4].spec.bidiIsolate, p3;
      if (u3 == null && (u3 = wo2(t8.text, c3, a2)), h3 > 0 && f6.length && (p3 = f6[f6.length - 1]).to == c3 && p3.direction == u3) p3.to = a2, f6 = p3.inner;
      else {
        let g8 = { from: c3, to: a2, direction: u3, inner: [] };
        f6.push(g8), f6 = g8.inner;
      }
    }
  } }), n14;
}
var wn2 = y.define();
function xn2(s212) {
  let t8 = 0, e7 = 0, i12 = 0, n14 = 0;
  for (let o of s212.state.facet(wn2)) {
    let r2 = o(s212);
    r2 && (r2.left != null && (t8 = Math.max(t8, r2.left)), r2.right != null && (e7 = Math.max(e7, r2.right)), r2.top != null && (i12 = Math.max(i12, r2.top)), r2.bottom != null && (n14 = Math.max(n14, r2.bottom)));
  }
  return { left: t8, right: e7, top: i12, bottom: n14 };
}
var Lt2 = y.define();
var j3 = class s68 {
  constructor(t8, e7, i12, n14) {
    this.fromA = t8, this.toA = e7, this.fromB = i12, this.toB = n14;
  }
  join(t8) {
    return new s68(Math.min(this.fromA, t8.fromA), Math.max(this.toA, t8.toA), Math.min(this.fromB, t8.fromB), Math.max(this.toB, t8.toB));
  }
  addToSet(t8) {
    let e7 = t8.length, i12 = this;
    for (; e7 > 0; e7--) {
      let n14 = t8[e7 - 1];
      if (!(n14.fromA > i12.toA)) {
        if (n14.toA < i12.fromA) break;
        i12 = i12.join(n14), t8.splice(e7 - 1, 1);
      }
    }
    return t8.splice(e7, 0, i12), t8;
  }
  static extendWithRanges(t8, e7) {
    if (e7.length == 0) return t8;
    let i12 = [];
    for (let n14 = 0, o = 0, r2 = 0, l11 = 0; ; n14++) {
      let h3 = n14 == t8.length ? null : t8[n14], c3 = r2 - l11, a2 = h3 ? h3.fromB : 1e9;
      for (; o < e7.length && e7[o] < a2; ) {
        let f6 = e7[o], d4 = e7[o + 1], u3 = Math.max(l11, f6), p3 = Math.min(a2, d4);
        if (u3 <= p3 && new s68(u3 + c3, p3 + c3, u3, p3).addToSet(i12), d4 > a2) break;
        o += 2;
      }
      if (!h3) return i12;
      new s68(h3.fromA, h3.toA, h3.fromB, h3.toB).addToSet(i12), r2 = h3.toA, l11 = h3.toB;
    }
  }
};
var Ce3 = class s69 {
  constructor(t8, e7, i12) {
    this.view = t8, this.state = e7, this.transactions = i12, this.flags = 0, this.startState = t8.state, this.changes = A.empty(this.startState.doc.length);
    for (let o of i12) this.changes = this.changes.compose(o.changes);
    let n14 = [];
    this.changes.iterChangedRanges((o, r2, l11, h3) => n14.push(new j3(o, r2, l11, h3))), this.changedRanges = n14;
  }
  static create(t8, e7, i12) {
    return new s69(t8, e7, i12);
  }
  get viewportChanged() {
    return (this.flags & 4) > 0;
  }
  get heightChanged() {
    return (this.flags & 2) > 0;
  }
  get geometryChanged() {
    return this.docChanged || (this.flags & 10) > 0;
  }
  get focusChanged() {
    return (this.flags & 1) > 0;
  }
  get docChanged() {
    return !this.changes.empty;
  }
  get selectionSet() {
    return this.transactions.some((t8) => t8.selection);
  }
  get empty() {
    return this.flags == 0 && this.transactions.length == 0;
  }
};
var Me3 = class extends T4 {
  get length() {
    return this.view.state.doc.length;
  }
  constructor(t8) {
    super(), this.view = t8, this.decorations = [], this.dynamicDecorationMap = [false], this.domChanged = null, this.hasComposition = null, this.markedForComposition = /* @__PURE__ */ new Set(), this.editContextFormatting = R3.none, this.lastCompositionAfterCursor = false, this.minWidth = 0, this.minWidthFrom = 0, this.minWidthTo = 0, this.impreciseAnchor = null, this.impreciseHead = null, this.forceSelection = false, this.lastUpdate = Date.now(), this.setDOM(t8.contentDOM), this.children = [new P3()], this.children[0].setParent(this), this.updateDeco(), this.updateInner([new j3(0, 0, 0, t8.state.doc.length)], 0, null);
  }
  update(t8) {
    var e7;
    let i12 = t8.changedRanges;
    this.minWidth > 0 && i12.length && (i12.every(({ fromA: c3, toA: a2 }) => a2 < this.minWidthFrom || c3 > this.minWidthTo) ? (this.minWidthFrom = t8.changes.mapPos(this.minWidthFrom, 1), this.minWidthTo = t8.changes.mapPos(this.minWidthTo, 1)) : this.minWidth = this.minWidthFrom = this.minWidthTo = 0), this.updateEditContextFormatting(t8);
    let n14 = -1;
    this.view.inputState.composing >= 0 && !this.view.observer.editContext && (!((e7 = this.domChanged) === null || e7 === void 0) && e7.newSel ? n14 = this.domChanged.newSel.head : !Do2(t8.changes, this.hasComposition) && !t8.selectionSet && (n14 = t8.state.selection.main.head));
    let o = n14 > -1 ? So2(this.view, t8.changes, n14) : null;
    if (this.domChanged = null, this.hasComposition) {
      this.markedForComposition.clear();
      let { from: c3, to: a2 } = this.hasComposition;
      i12 = new j3(c3, a2, t8.changes.mapPos(c3, -1), t8.changes.mapPos(a2, 1)).addToSet(i12.slice());
    }
    this.hasComposition = o ? { from: o.range.fromB, to: o.range.toB } : null, (y4.ie || y4.chrome) && !o && t8 && t8.state.doc.lines != t8.startState.doc.lines && (this.forceSelection = true);
    let r2 = this.decorations, l11 = this.updateDeco(), h3 = ko2(r2, l11, t8.changes);
    return i12 = j3.extendWithRanges(i12, h3), !(this.flags & 7) && i12.length == 0 ? false : (this.updateInner(i12, t8.startState.doc.length, o), t8.transactions.length && (this.lastUpdate = Date.now()), true);
  }
  updateInner(t8, e7, i12) {
    this.view.viewState.mustMeasureContent = true, this.updateChildren(t8, e7, i12);
    let { observer: n14 } = this.view;
    n14.ignore(() => {
      this.dom.style.height = this.view.viewState.contentHeight / this.view.scaleY + "px", this.dom.style.flexBasis = this.minWidth ? this.minWidth + "px" : "";
      let r2 = y4.chrome || y4.ios ? { node: n14.selectionRange.focusNode, written: false } : void 0;
      this.sync(this.view, r2), this.flags &= -8, r2 && (r2.written || n14.selectionRange.focusNode != r2.node) && (this.forceSelection = true), this.dom.style.height = "";
    }), this.markedForComposition.forEach((r2) => r2.flags &= -9);
    let o = [];
    if (this.view.viewport.from || this.view.viewport.to < this.view.state.doc.length) for (let r2 of this.children) r2 instanceof dt2 && r2.widget instanceof $t2 && o.push(r2.dom);
    n14.updateGaps(o);
  }
  updateChildren(t8, e7, i12) {
    let n14 = i12 ? i12.range.addToSet(t8.slice()) : t8, o = this.childCursor(e7);
    for (let r2 = n14.length - 1; ; r2--) {
      let l11 = r2 >= 0 ? n14[r2] : null;
      if (!l11) break;
      let { fromA: h3, toA: c3, fromB: a2, toB: f6 } = l11, d4, u3, p3, g8;
      if (i12 && i12.range.fromB < f6 && i12.range.toB > a2) {
        let x11 = Ft2.build(this.view.state.doc, a2, i12.range.fromB, this.decorations, this.dynamicDecorationMap), S17 = Ft2.build(this.view.state.doc, i12.range.toB, f6, this.decorations, this.dynamicDecorationMap);
        u3 = x11.breakAtStart, p3 = x11.openStart, g8 = S17.openEnd;
        let C11 = this.compositionView(i12);
        S17.breakAtStart ? C11.breakAfter = 1 : S17.content.length && C11.merge(C11.length, C11.length, S17.content[0], false, S17.openStart, 0) && (C11.breakAfter = S17.content[0].breakAfter, S17.content.shift()), x11.content.length && C11.merge(0, 0, x11.content[x11.content.length - 1], true, 0, x11.openEnd) && x11.content.pop(), d4 = x11.content.concat(C11).concat(S17.content);
      } else ({ content: d4, breakAtStart: u3, openStart: p3, openEnd: g8 } = Ft2.build(this.view.state.doc, a2, f6, this.decorations, this.dynamicDecorationMap));
      let { i: b12, off: m11 } = o.findPos(c3, 1), { i: w14, off: v10 } = o.findPos(h3, -1);
      js2(this, w14, v10, b12, m11, d4, u3, p3, g8);
    }
    i12 && this.fixCompositionDOM(i12);
  }
  updateEditContextFormatting(t8) {
    this.editContextFormatting = this.editContextFormatting.map(t8.changes);
    for (let e7 of t8.transactions) for (let i12 of e7.effects) i12.is(gn2) && (this.editContextFormatting = i12.value);
  }
  compositionView(t8) {
    let e7 = new U4(t8.text.nodeValue);
    e7.flags |= 8;
    for (let { deco: n14 } of t8.marks) e7 = new rt3(n14, [e7], e7.length);
    let i12 = new P3();
    return i12.append(e7, 0), i12;
  }
  fixCompositionDOM(t8) {
    let e7 = (o, r2) => {
      r2.flags |= 8 | (r2.children.some((h3) => h3.flags & 7) ? 1 : 0), this.markedForComposition.add(r2);
      let l11 = T4.get(o);
      l11 && l11 != r2 && (l11.dom = null), r2.setDOM(o);
    }, i12 = this.childPos(t8.range.fromB, 1), n14 = this.children[i12.i];
    e7(t8.line, n14);
    for (let o = t8.marks.length - 1; o >= -1; o--) i12 = n14.childPos(i12.off, 1), n14 = n14.children[i12.i], e7(o >= 0 ? t8.marks[o].node : t8.text, n14);
  }
  updateSelection(t8 = false, e7 = false) {
    (t8 || !this.view.observer.selectionRange.focusNode) && this.view.observer.readSelectionRange();
    let i12 = this.view.root.activeElement, n14 = i12 == this.dom, o = !n14 && ue4(this.dom, this.view.observer.selectionRange) && !(i12 && this.dom.contains(i12));
    if (!(n14 || e7 || o)) return;
    let r2 = this.forceSelection;
    this.forceSelection = false;
    let l11 = this.view.state.selection.main, h3 = this.moveToLine(this.domAtPos(l11.anchor)), c3 = l11.empty ? h3 : this.moveToLine(this.domAtPos(l11.head));
    if (y4.gecko && l11.empty && !this.hasComposition && vo2(h3)) {
      let f6 = document.createTextNode("");
      this.view.observer.ignore(() => h3.node.insertBefore(f6, h3.node.childNodes[h3.offset] || null)), h3 = c3 = new V4(f6, 0), r2 = true;
    }
    let a2 = this.view.observer.selectionRange;
    (r2 || !a2.focusNode || (!Vt2(h3.node, h3.offset, a2.anchorNode, a2.anchorOffset) || !Vt2(c3.node, c3.offset, a2.focusNode, a2.focusOffset)) && !this.suppressWidgetCursorChange(a2, l11)) && (this.view.observer.ignore(() => {
      y4.android && y4.chrome && this.dom.contains(a2.focusNode) && Ao2(a2.focusNode, this.dom) && (this.dom.blur(), this.dom.focus({ preventScroll: true }));
      let f6 = jt2(this.view.root);
      if (f6) if (l11.empty) {
        if (y4.gecko) {
          let d4 = Co2(h3.node, h3.offset);
          if (d4 && d4 != 3) {
            let u3 = (d4 == 1 ? Ks2 : qs2)(h3.node, h3.offset);
            u3 && (h3 = new V4(u3.node, u3.offset));
          }
        }
        f6.collapse(h3.node, h3.offset), l11.bidiLevel != null && f6.caretBidiLevel !== void 0 && (f6.caretBidiLevel = l11.bidiLevel);
      } else if (f6.extend) {
        f6.collapse(h3.node, h3.offset);
        try {
          f6.extend(c3.node, c3.offset);
        } catch {
        }
      } else {
        let d4 = document.createRange();
        l11.anchor > l11.head && ([h3, c3] = [c3, h3]), d4.setEnd(c3.node, c3.offset), d4.setStart(h3.node, h3.offset), f6.removeAllRanges(), f6.addRange(d4);
      }
      o && this.view.root.activeElement == this.dom && (this.dom.blur(), i12 && i12.focus());
    }), this.view.observer.setSelectionRange(h3, c3)), this.impreciseAnchor = h3.precise ? null : new V4(a2.anchorNode, a2.anchorOffset), this.impreciseHead = c3.precise ? null : new V4(a2.focusNode, a2.focusOffset);
  }
  suppressWidgetCursorChange(t8, e7) {
    return this.hasComposition && e7.empty && Vt2(t8.focusNode, t8.focusOffset, t8.anchorNode, t8.anchorOffset) && this.posFromDOM(t8.focusNode, t8.focusOffset) == e7.head;
  }
  enforceCursorAssoc() {
    if (this.hasComposition) return;
    let { view: t8 } = this, e7 = t8.state.selection.main, i12 = jt2(t8.root), { anchorNode: n14, anchorOffset: o } = t8.observer.selectionRange;
    if (!i12 || !e7.empty || !e7.assoc || !i12.modify) return;
    let r2 = P3.find(this, e7.head);
    if (!r2) return;
    let l11 = r2.posAtStart;
    if (e7.head == l11 || e7.head == l11 + r2.length) return;
    let h3 = this.coordsAt(e7.head, -1), c3 = this.coordsAt(e7.head, 1);
    if (!h3 || !c3 || h3.bottom > c3.top) return;
    let a2 = this.domAtPos(e7.head + e7.assoc);
    i12.collapse(a2.node, a2.offset), i12.modify("move", e7.assoc < 0 ? "forward" : "backward", "lineboundary"), t8.observer.readSelectionRange();
    let f6 = t8.observer.selectionRange;
    t8.docView.posFromDOM(f6.anchorNode, f6.anchorOffset) != e7.from && i12.collapse(n14, o);
  }
  moveToLine(t8) {
    let e7 = this.dom, i12;
    if (t8.node != e7) return t8;
    for (let n14 = t8.offset; !i12 && n14 < e7.childNodes.length; n14++) {
      let o = T4.get(e7.childNodes[n14]);
      o instanceof P3 && (i12 = o.domAtPos(0));
    }
    for (let n14 = t8.offset - 1; !i12 && n14 >= 0; n14--) {
      let o = T4.get(e7.childNodes[n14]);
      o instanceof P3 && (i12 = o.domAtPos(o.length));
    }
    return i12 ? new V4(i12.node, i12.offset, true) : t8;
  }
  nearest(t8) {
    for (let e7 = t8; e7; ) {
      let i12 = T4.get(e7);
      if (i12 && i12.rootView == this) return i12;
      e7 = e7.parentNode;
    }
    return null;
  }
  posFromDOM(t8, e7) {
    let i12 = this.nearest(t8);
    if (!i12) throw new RangeError("Trying to find position for a DOM position outside of the document");
    return i12.localPosFromDOM(t8, e7) + i12.posAtStart;
  }
  domAtPos(t8) {
    let { i: e7, off: i12 } = this.childCursor().findPos(t8, -1);
    for (; e7 < this.children.length - 1; ) {
      let n14 = this.children[e7];
      if (i12 < n14.length || n14 instanceof P3) break;
      e7++, i12 = 0;
    }
    return this.children[e7].domAtPos(i12);
  }
  coordsAt(t8, e7) {
    let i12 = null, n14 = 0;
    for (let o = this.length, r2 = this.children.length - 1; r2 >= 0; r2--) {
      let l11 = this.children[r2], h3 = o - l11.breakAfter, c3 = h3 - l11.length;
      if (h3 < t8) break;
      if (c3 <= t8 && (c3 < t8 || l11.covers(-1)) && (h3 > t8 || l11.covers(1)) && (!i12 || l11 instanceof P3 && !(i12 instanceof P3 && e7 >= 0))) i12 = l11, n14 = c3;
      else if (i12 && c3 == t8 && h3 == t8 && l11 instanceof dt2 && Math.abs(e7) < 2) {
        if (l11.deco.startSide < 0) break;
        r2 && (i12 = null);
      }
      o = c3;
    }
    return i12 ? i12.coordsAt(t8 - n14, e7) : null;
  }
  coordsForChar(t8) {
    let { i: e7, off: i12 } = this.childPos(t8, 1), n14 = this.children[e7];
    if (!(n14 instanceof P3)) return null;
    for (; n14.children.length; ) {
      let { i: l11, off: h3 } = n14.childPos(i12, 1);
      for (; ; l11++) {
        if (l11 == n14.children.length) return null;
        if ((n14 = n14.children[l11]).length) break;
      }
      i12 = h3;
    }
    if (!(n14 instanceof U4)) return null;
    let o = ee(n14.text, i12);
    if (o == i12) return null;
    let r2 = pt2(n14.dom, i12, o).getClientRects();
    for (let l11 = 0; l11 < r2.length; l11++) {
      let h3 = r2[l11];
      if (l11 == r2.length - 1 || h3.top < h3.bottom && h3.left < h3.right) return h3;
    }
    return null;
  }
  measureVisibleLineHeights(t8) {
    let e7 = [], { from: i12, to: n14 } = t8, o = this.view.contentDOM.clientWidth, r2 = o > Math.max(this.view.scrollDOM.clientWidth, this.minWidth) + 1, l11 = -1, h3 = this.view.textDirection == L3.LTR;
    for (let c3 = 0, a2 = 0; a2 < this.children.length; a2++) {
      let f6 = this.children[a2], d4 = c3 + f6.length;
      if (d4 > n14) break;
      if (c3 >= i12) {
        let u3 = f6.dom.getBoundingClientRect();
        if (e7.push(u3.height), r2) {
          let p3 = f6.dom.lastChild, g8 = p3 ? At2(p3) : [];
          if (g8.length) {
            let b12 = g8[g8.length - 1], m11 = h3 ? b12.right - u3.left : u3.right - b12.left;
            m11 > l11 && (l11 = m11, this.minWidth = o, this.minWidthFrom = c3, this.minWidthTo = d4);
          }
        }
      }
      c3 = d4 + f6.breakAfter;
    }
    return e7;
  }
  textDirectionAt(t8) {
    let { i: e7 } = this.childPos(t8, 1);
    return getComputedStyle(this.children[e7].dom).direction == "rtl" ? L3.RTL : L3.LTR;
  }
  measureTextSize() {
    for (let o of this.children) if (o instanceof P3) {
      let r2 = o.measureTextSize();
      if (r2) return r2;
    }
    let t8 = document.createElement("div"), e7, i12, n14;
    return t8.className = "cm-line", t8.style.width = "99999px", t8.style.position = "absolute", t8.textContent = "abc def ghi jkl mno pqr stu", this.view.observer.ignore(() => {
      this.dom.appendChild(t8);
      let o = At2(t8.firstChild)[0];
      e7 = t8.getBoundingClientRect().height, i12 = o ? o.width / 27 : 7, n14 = o ? o.height : e7, t8.remove();
    }), { lineHeight: e7, charWidth: i12, textHeight: n14 };
  }
  childCursor(t8 = this.length) {
    let e7 = this.children.length;
    return e7 && (t8 -= this.children[--e7].length), new ve3(this.children, t8, e7);
  }
  computeBlockGapDeco() {
    let t8 = [], e7 = this.view.viewState;
    for (let i12 = 0, n14 = 0; ; n14++) {
      let o = n14 == e7.viewports.length ? null : e7.viewports[n14], r2 = o ? o.from - 1 : this.length;
      if (r2 > i12) {
        let l11 = (e7.lineBlockAt(r2).bottom - e7.lineBlockAt(i12).top) / this.view.scaleY;
        t8.push(R3.replace({ widget: new $t2(l11), block: true, inclusive: true, isBlockGap: true }).range(i12, r2));
      }
      if (!o) break;
      i12 = o.to + 1;
    }
    return R3.set(t8);
  }
  updateDeco() {
    let t8 = 1, e7 = this.view.state.facet(Ut2).map((o) => (this.dynamicDecorationMap[t8++] = typeof o == "function") ? o(this.view) : o), i12 = false, n14 = this.view.state.facet(bn2).map((o, r2) => {
      let l11 = typeof o == "function";
      return l11 && (i12 = true), l11 ? o(this.view) : o;
    });
    for (n14.length && (this.dynamicDecorationMap[t8++] = i12, e7.push(T.join(n14))), this.decorations = [this.editContextFormatting, ...e7, this.computeBlockGapDeco(), this.view.viewState.lineGapDeco]; t8 < this.decorations.length; ) this.dynamicDecorationMap[t8++] = false;
    return this.decorations;
  }
  scrollIntoView(t8) {
    if (t8.isSnapshot) {
      let c3 = this.view.viewState.lineBlockAt(t8.range.head);
      this.view.scrollDOM.scrollTop = c3.top - t8.yMargin, this.view.scrollDOM.scrollLeft = t8.xMargin;
      return;
    }
    for (let c3 of this.view.state.facet(pn2)) try {
      if (c3(this.view, t8.range, t8)) return true;
    } catch (a2) {
      $3(this.view.state, a2, "scroll handler");
    }
    let { range: e7 } = t8, i12 = this.coordsAt(e7.head, e7.empty ? e7.assoc : e7.head > e7.anchor ? -1 : 1), n14;
    if (!i12) return;
    !e7.empty && (n14 = this.coordsAt(e7.anchor, e7.anchor > e7.head ? -1 : 1)) && (i12 = { left: Math.min(i12.left, n14.left), top: Math.min(i12.top, n14.top), right: Math.max(i12.right, n14.right), bottom: Math.max(i12.bottom, n14.bottom) });
    let o = xn2(this.view), r2 = { left: i12.left - o.left, top: i12.top - o.top, right: i12.right + o.right, bottom: i12.bottom + o.bottom }, { offsetWidth: l11, offsetHeight: h3 } = this.view.scrollDOM;
    so2(this.view.scrollDOM, r2, e7.head < e7.anchor ? -1 : 1, t8.x, t8.y, Math.max(Math.min(t8.xMargin, l11), -l11), Math.max(Math.min(t8.yMargin, h3), -h3), this.view.textDirection == L3.LTR);
  }
};
function vo2(s212) {
  return s212.node.nodeType == 1 && s212.node.firstChild && (s212.offset == 0 || s212.node.childNodes[s212.offset - 1].contentEditable == "false") && (s212.offset == s212.node.childNodes.length || s212.node.childNodes[s212.offset].contentEditable == "false");
}
function vn2(s212, t8) {
  let e7 = s212.observer.selectionRange;
  if (!e7.focusNode) return null;
  let i12 = Ks2(e7.focusNode, e7.focusOffset), n14 = qs2(e7.focusNode, e7.focusOffset), o = i12 || n14;
  if (n14 && i12 && n14.node != i12.node) {
    let l11 = T4.get(n14.node);
    if (!l11 || l11 instanceof U4 && l11.text != n14.node.nodeValue) o = n14;
    else if (s212.docView.lastCompositionAfterCursor) {
      let h3 = T4.get(i12.node);
      !h3 || h3 instanceof U4 && h3.text != i12.node.nodeValue || (o = n14);
    }
  }
  if (s212.docView.lastCompositionAfterCursor = o != i12, !o) return null;
  let r2 = t8 - o.offset;
  return { from: r2, to: r2 + o.node.nodeValue.length, node: o.node };
}
function So2(s212, t8, e7) {
  let i12 = vn2(s212, e7);
  if (!i12) return null;
  let { node: n14, from: o, to: r2 } = i12, l11 = n14.nodeValue;
  if (/[\n\r]/.test(l11) || s212.state.doc.sliceString(i12.from, i12.to) != l11) return null;
  let h3 = t8.invertedDesc, c3 = new j3(h3.mapPos(o), h3.mapPos(r2), o, r2), a2 = [];
  for (let f6 = n14.parentNode; ; f6 = f6.parentNode) {
    let d4 = T4.get(f6);
    if (d4 instanceof rt3) a2.push({ node: f6, deco: d4.mark });
    else {
      if (d4 instanceof P3 || f6.nodeName == "DIV" && f6.parentNode == s212.contentDOM) return { range: c3, text: n14, marks: a2, line: f6 };
      if (f6 != s212.contentDOM) a2.push({ node: f6, deco: new Xt2({ inclusive: true, attributes: co2(f6), tagName: f6.tagName.toLowerCase() }) });
      else return null;
    }
  }
}
function Co2(s212, t8) {
  return s212.nodeType != 1 ? 0 : (t8 && s212.childNodes[t8 - 1].contentEditable == "false" ? 1 : 0) | (t8 < s212.childNodes.length && s212.childNodes[t8].contentEditable == "false" ? 2 : 0);
}
var Mo2 = class {
  constructor() {
    this.changes = [];
  }
  compareRange(t8, e7) {
    ti2(t8, e7, this.changes);
  }
  comparePoint(t8, e7) {
    ti2(t8, e7, this.changes);
  }
};
function ko2(s212, t8, e7) {
  let i12 = new Mo2();
  return T.compare(s212, t8, e7, i12), i12.changes;
}
function Ao2(s212, t8) {
  for (let e7 = s212; e7 && e7 != t8; e7 = e7.assignedSlot || e7.parentNode) if (e7.nodeType == 1 && e7.contentEditable == "false") return true;
  return false;
}
function Do2(s212, t8) {
  let e7 = false;
  return t8 && s212.iterChangedRanges((i12, n14) => {
    i12 < t8.to && n14 > t8.from && (e7 = true);
  }), e7;
}
function Oo2(s212, t8, e7 = 1) {
  let i12 = s212.charCategorizer(t8), n14 = s212.doc.lineAt(t8), o = t8 - n14.from;
  if (n14.length == 0) return x.cursor(t8);
  o == 0 ? e7 = 1 : o == n14.length && (e7 = -1);
  let r2 = o, l11 = o;
  e7 < 0 ? r2 = ee(n14.text, o, false) : l11 = ee(n14.text, o);
  let h3 = i12(n14.text.slice(r2, l11));
  for (; r2 > 0; ) {
    let c3 = ee(n14.text, r2, false);
    if (i12(n14.text.slice(c3, r2)) != h3) break;
    r2 = c3;
  }
  for (; l11 < n14.length; ) {
    let c3 = ee(n14.text, l11);
    if (i12(n14.text.slice(l11, c3)) != h3) break;
    l11 = c3;
  }
  return x.range(r2 + n14.from, l11 + n14.from);
}
function To2(s212, t8) {
  return t8.left > s212 ? t8.left - s212 : Math.max(0, s212 - t8.right);
}
function Ro2(s212, t8) {
  return t8.top > s212 ? t8.top - s212 : Math.max(0, s212 - t8.bottom);
}
function Ie4(s212, t8) {
  return s212.top < t8.bottom - 1 && s212.bottom > t8.top + 1;
}
function Zi2(s212, t8) {
  return t8 < s212.top ? { top: t8, left: s212.left, right: s212.right, bottom: s212.bottom } : s212;
}
function ts2(s212, t8) {
  return t8 > s212.bottom ? { top: s212.top, left: s212.left, right: s212.right, bottom: t8 } : s212;
}
function oi2(s212, t8, e7) {
  let i12, n14, o, r2, l11 = false, h3, c3, a2, f6;
  for (let p3 = s212.firstChild; p3; p3 = p3.nextSibling) {
    let g8 = At2(p3);
    for (let b12 = 0; b12 < g8.length; b12++) {
      let m11 = g8[b12];
      n14 && Ie4(n14, m11) && (m11 = Zi2(ts2(m11, n14.bottom), n14.top));
      let w14 = To2(t8, m11), v10 = Ro2(e7, m11);
      if (w14 == 0 && v10 == 0) return p3.nodeType == 3 ? es2(p3, t8, e7) : oi2(p3, t8, e7);
      if (!i12 || r2 > v10 || r2 == v10 && o > w14) {
        i12 = p3, n14 = m11, o = w14, r2 = v10;
        let x11 = v10 ? e7 < m11.top ? -1 : 1 : w14 ? t8 < m11.left ? -1 : 1 : 0;
        l11 = !x11 || (x11 > 0 ? b12 < g8.length - 1 : b12 > 0);
      }
      w14 == 0 ? e7 > m11.bottom && (!a2 || a2.bottom < m11.bottom) ? (h3 = p3, a2 = m11) : e7 < m11.top && (!f6 || f6.top > m11.top) && (c3 = p3, f6 = m11) : a2 && Ie4(a2, m11) ? a2 = ts2(a2, m11.bottom) : f6 && Ie4(f6, m11) && (f6 = Zi2(f6, m11.top));
    }
  }
  if (a2 && a2.bottom >= e7 ? (i12 = h3, n14 = a2) : f6 && f6.top <= e7 && (i12 = c3, n14 = f6), !i12) return { node: s212, offset: 0 };
  let d4 = Math.max(n14.left, Math.min(n14.right, t8));
  if (i12.nodeType == 3) return es2(i12, d4, e7);
  if (l11 && i12.contentEditable != "false") return oi2(i12, d4, e7);
  let u3 = Array.prototype.indexOf.call(s212.childNodes, i12) + (t8 >= (n14.left + n14.right) / 2 ? 1 : 0);
  return { node: s212, offset: u3 };
}
function es2(s212, t8, e7) {
  let i12 = s212.nodeValue.length, n14 = -1, o = 1e9, r2 = 0;
  for (let l11 = 0; l11 < i12; l11++) {
    let h3 = pt2(s212, l11, l11 + 1).getClientRects();
    for (let c3 = 0; c3 < h3.length; c3++) {
      let a2 = h3[c3];
      if (a2.top == a2.bottom) continue;
      r2 || (r2 = t8 - a2.left);
      let f6 = (a2.top > e7 ? a2.top - e7 : e7 - a2.bottom) - 1;
      if (a2.left - 1 <= t8 && a2.right + 1 >= t8 && f6 < o) {
        let d4 = t8 >= (a2.left + a2.right) / 2, u3 = d4;
        if ((y4.chrome || y4.gecko) && pt2(s212, l11).getBoundingClientRect().left == a2.right && (u3 = !d4), f6 <= 0) return { node: s212, offset: l11 + (u3 ? 1 : 0) };
        n14 = l11 + (u3 ? 1 : 0), o = f6;
      }
    }
  }
  return { node: s212, offset: n14 > -1 ? n14 : r2 > 0 ? s212.nodeValue.length : 0 };
}
function Sn2(s212, t8, e7, i12 = -1) {
  var n14, o;
  let r2 = s212.contentDOM.getBoundingClientRect(), l11 = r2.top + s212.viewState.paddingTop, h3, { docHeight: c3 } = s212.viewState, { x: a2, y: f6 } = t8, d4 = f6 - l11;
  if (d4 < 0) return 0;
  if (d4 > c3) return s212.state.doc.length;
  for (let x11 = s212.viewState.heightOracle.textHeight / 2, S17 = false; h3 = s212.elementAtHeight(d4), h3.type != F4.Text; ) for (; d4 = i12 > 0 ? h3.bottom + x11 : h3.top - x11, !(d4 >= 0 && d4 <= c3); ) {
    if (S17) return e7 ? null : 0;
    S17 = true, i12 = -i12;
  }
  f6 = l11 + d4;
  let u3 = h3.from;
  if (u3 < s212.viewport.from) return s212.viewport.from == 0 ? 0 : e7 ? null : is2(s212, r2, h3, a2, f6);
  if (u3 > s212.viewport.to) return s212.viewport.to == s212.state.doc.length ? s212.state.doc.length : e7 ? null : is2(s212, r2, h3, a2, f6);
  let p3 = s212.dom.ownerDocument, g8 = s212.root.elementFromPoint ? s212.root : p3, b12 = g8.elementFromPoint(a2, f6);
  b12 && !s212.contentDOM.contains(b12) && (b12 = null), b12 || (a2 = Math.max(r2.left + 1, Math.min(r2.right - 1, a2)), b12 = g8.elementFromPoint(a2, f6), b12 && !s212.contentDOM.contains(b12) && (b12 = null));
  let m11, w14 = -1;
  if (b12 && ((n14 = s212.docView.nearest(b12)) === null || n14 === void 0 ? void 0 : n14.isEditable) != false) {
    if (p3.caretPositionFromPoint) {
      let x11 = p3.caretPositionFromPoint(a2, f6);
      x11 && ({ offsetNode: m11, offset: w14 } = x11);
    } else if (p3.caretRangeFromPoint) {
      let x11 = p3.caretRangeFromPoint(a2, f6);
      x11 && ({ startContainer: m11, startOffset: w14 } = x11, (!s212.contentDOM.contains(m11) || y4.safari && Eo2(m11, w14, a2) || y4.chrome && Lo2(m11, w14, a2)) && (m11 = void 0));
    }
  }
  if (!m11 || !s212.docView.dom.contains(m11)) {
    let x11 = P3.find(s212.docView, u3);
    if (!x11) return d4 > h3.top + h3.height / 2 ? h3.to : h3.from;
    ({ node: m11, offset: w14 } = oi2(x11.dom, a2, f6));
  }
  let v10 = s212.docView.nearest(m11);
  if (!v10) return null;
  if (v10.isWidget && ((o = v10.dom) === null || o === void 0 ? void 0 : o.nodeType) == 1) {
    let x11 = v10.dom.getBoundingClientRect();
    return t8.y < x11.top || t8.y <= x11.bottom && t8.x <= (x11.left + x11.right) / 2 ? v10.posAtStart : v10.posAtEnd;
  } else return v10.localPosFromDOM(m11, w14) + v10.posAtStart;
}
function is2(s212, t8, e7, i12, n14) {
  let o = Math.round((i12 - t8.left) * s212.defaultCharacterWidth);
  if (s212.lineWrapping && e7.height > s212.defaultLineHeight * 1.5) {
    let l11 = s212.viewState.heightOracle.textHeight, h3 = Math.floor((n14 - e7.top - (s212.defaultLineHeight - l11) * 0.5) / l11);
    o += h3 * s212.viewState.heightOracle.lineLength;
  }
  let r2 = s212.state.sliceDoc(e7.from, e7.to);
  return e7.from + ft(r2, o, s212.state.tabSize);
}
function Eo2(s212, t8, e7) {
  let i12;
  if (s212.nodeType != 3 || t8 != (i12 = s212.nodeValue.length)) return false;
  for (let n14 = s212.nextSibling; n14; n14 = n14.nextSibling) if (n14.nodeType != 1 || n14.nodeName != "BR") return false;
  return pt2(s212, i12 - 1, i12).getBoundingClientRect().left > e7;
}
function Lo2(s212, t8, e7) {
  if (t8 != 0) return false;
  for (let n14 = s212; ; ) {
    let o = n14.parentNode;
    if (!o || o.nodeType != 1 || o.firstChild != n14) return false;
    if (o.classList.contains("cm-line")) break;
    n14 = o;
  }
  let i12 = s212.nodeType == 1 ? s212.getBoundingClientRect() : pt2(s212, 0, Math.max(s212.nodeValue.length, 1)).getBoundingClientRect();
  return e7 - i12.left > 5;
}
function ri2(s212, t8) {
  let e7 = s212.lineBlockAt(t8);
  if (Array.isArray(e7.type)) {
    for (let i12 of e7.type) if (i12.to > t8 || i12.to == t8 && (i12.to == e7.to || i12.type == F4.Text)) return i12;
  }
  return e7;
}
function Bo2(s212, t8, e7, i12) {
  let n14 = ri2(s212, t8.head), o = !i12 || n14.type != F4.Text || !(s212.lineWrapping || n14.widgetLineBreaks) ? null : s212.coordsAtPos(t8.assoc < 0 && t8.head > n14.from ? t8.head - 1 : t8.head);
  if (o) {
    let r2 = s212.dom.getBoundingClientRect(), l11 = s212.textDirectionAt(n14.from), h3 = s212.posAtCoords({ x: e7 == (l11 == L3.LTR) ? r2.right - 1 : r2.left + 1, y: (o.top + o.bottom) / 2 });
    if (h3 != null) return x.cursor(h3, e7 ? -1 : 1);
  }
  return x.cursor(e7 ? n14.to : n14.from, e7 ? -1 : 1);
}
function ss2(s212, t8, e7, i12) {
  let n14 = s212.state.doc.lineAt(t8.head), o = s212.bidiSpans(n14), r2 = s212.textDirectionAt(n14.from);
  for (let l11 = t8, h3 = null; ; ) {
    let c3 = on2(n14, o, r2, l11, e7), a2 = nn2;
    if (!c3) {
      if (n14.number == (e7 ? s212.state.doc.lines : 1)) return l11;
      a2 = `
`, n14 = s212.state.doc.line(n14.number + (e7 ? 1 : -1)), o = s212.bidiSpans(n14), c3 = s212.visualLineSide(n14, !e7);
    }
    if (h3) {
      if (!h3(a2)) return l11;
    } else {
      if (!i12) return c3;
      h3 = i12(a2);
    }
    l11 = c3;
  }
}
function Po2(s212, t8, e7) {
  let i12 = s212.state.charCategorizer(t8), n14 = i12(e7);
  return (o) => {
    let r2 = i12(o);
    return n14 == O.Space && (n14 = r2), n14 == r2;
  };
}
function Ho2(s212, t8, e7, i12) {
  let n14 = t8.head, o = e7 ? 1 : -1;
  if (n14 == (e7 ? s212.state.doc.length : 0)) return x.cursor(n14, t8.assoc);
  let r2 = t8.goalColumn, l11, h3 = s212.contentDOM.getBoundingClientRect(), c3 = s212.coordsAtPos(n14, t8.assoc || -1), a2 = s212.documentTop;
  if (c3) r2 == null && (r2 = c3.left - h3.left), l11 = o < 0 ? c3.top : c3.bottom;
  else {
    let u3 = s212.viewState.lineBlockAt(n14);
    r2 == null && (r2 = Math.min(h3.right - h3.left, s212.defaultCharacterWidth * (n14 - u3.from))), l11 = (o < 0 ? u3.top : u3.bottom) + a2;
  }
  let f6 = h3.left + r2, d4 = i12 ?? s212.viewState.heightOracle.textHeight >> 1;
  for (let u3 = 0; ; u3 += 10) {
    let p3 = l11 + (d4 + u3) * o, g8 = Sn2(s212, { x: f6, y: p3 }, false, o);
    if (p3 < h3.top || p3 > h3.bottom || (o < 0 ? g8 < n14 : g8 > n14)) {
      let b12 = s212.docView.coordsForChar(g8), m11 = !b12 || p3 < b12.top ? -1 : 1;
      return x.cursor(g8, m11, void 0, r2);
    }
  }
}
function pe3(s212, t8, e7) {
  for (; ; ) {
    let i12 = 0;
    for (let n14 of s212) n14.between(t8 - 1, t8 + 1, (o, r2, l11) => {
      if (t8 > o && t8 < r2) {
        let h3 = i12 || e7 || (t8 - o < r2 - t8 ? -1 : 1);
        t8 = h3 < 0 ? o : r2, i12 = h3;
      }
    });
    if (!i12) return t8;
  }
}
function Ke3(s212, t8, e7) {
  let i12 = pe3(s212.state.facet(Ki2).map((n14) => n14(s212)), e7.from, t8.head > e7.from ? -1 : 1);
  return i12 == e7.from ? e7 : x.cursor(i12, i12 < e7.from ? 1 : -1);
}
var Bt2 = "ï¿¿";
var li2 = class {
  constructor(t8, e7) {
    this.points = t8, this.text = "", this.lineSeparator = e7.facet(I.lineSeparator);
  }
  append(t8) {
    this.text += t8;
  }
  lineBreak() {
    this.text += Bt2;
  }
  readRange(t8, e7) {
    if (!t8) return this;
    let i12 = t8.parentNode;
    for (let n14 = t8; ; ) {
      this.findPointBefore(i12, n14);
      let o = this.text.length;
      this.readNode(n14);
      let r2 = n14.nextSibling;
      if (r2 == e7) break;
      let l11 = T4.get(n14), h3 = T4.get(r2);
      (l11 && h3 ? l11.breakAfter : (l11 ? l11.breakAfter : xe4(n14)) || xe4(r2) && (n14.nodeName != "BR" || n14.cmIgnore) && this.text.length > o) && this.lineBreak(), n14 = r2;
    }
    return this.findPointBefore(i12, e7), this;
  }
  readTextNode(t8) {
    let e7 = t8.nodeValue;
    for (let i12 of this.points) i12.node == t8 && (i12.pos = this.text.length + Math.min(i12.offset, e7.length));
    for (let i12 = 0, n14 = this.lineSeparator ? null : /\r\n?|\n/g; ; ) {
      let o = -1, r2 = 1, l11;
      if (this.lineSeparator ? (o = e7.indexOf(this.lineSeparator, i12), r2 = this.lineSeparator.length) : (l11 = n14.exec(e7)) && (o = l11.index, r2 = l11[0].length), this.append(e7.slice(i12, o < 0 ? e7.length : o)), o < 0) break;
      if (this.lineBreak(), r2 > 1) for (let h3 of this.points) h3.node == t8 && h3.pos > this.text.length && (h3.pos -= r2 - 1);
      i12 = o + r2;
    }
  }
  readNode(t8) {
    if (t8.cmIgnore) return;
    let e7 = T4.get(t8), i12 = e7 && e7.overrideDOMText;
    if (i12 != null) {
      this.findPointInside(t8, i12.length);
      for (let n14 = i12.iter(); !n14.next().done; ) n14.lineBreak ? this.lineBreak() : this.append(n14.value);
    } else t8.nodeType == 3 ? this.readTextNode(t8) : t8.nodeName == "BR" ? t8.nextSibling && this.lineBreak() : t8.nodeType == 1 && this.readRange(t8.firstChild, null);
  }
  findPointBefore(t8, e7) {
    for (let i12 of this.points) i12.node == t8 && t8.childNodes[i12.offset] == e7 && (i12.pos = this.text.length);
  }
  findPointInside(t8, e7) {
    for (let i12 of this.points) (t8.nodeType == 3 ? i12.node == t8 : t8.contains(i12.node)) && (i12.pos = this.text.length + (No2(t8, i12.node, i12.offset) ? e7 : 0));
  }
};
function No2(s212, t8, e7) {
  for (; ; ) {
    if (!t8 || e7 < tt2(t8)) return false;
    if (t8 == s212) return true;
    e7 = ut2(t8) + 1, t8 = t8.parentNode;
  }
}
var ke4 = class {
  constructor(t8, e7) {
    this.node = t8, this.offset = e7, this.pos = -1;
  }
};
var hi2 = class {
  constructor(t8, e7, i12, n14) {
    this.typeOver = n14, this.bounds = null, this.text = "", this.domChanged = e7 > -1;
    let { impreciseHead: o, impreciseAnchor: r2 } = t8.docView;
    if (t8.state.readOnly && e7 > -1) this.newSel = null;
    else if (e7 > -1 && (this.bounds = t8.docView.domBoundsAround(e7, i12, 0))) {
      let l11 = o || r2 ? [] : Wo2(t8), h3 = new li2(l11, t8.state);
      h3.readRange(this.bounds.startDOM, this.bounds.endDOM), this.text = h3.text, this.newSel = zo2(l11, this.bounds.from);
    } else {
      let l11 = t8.observer.selectionRange, h3 = o && o.node == l11.focusNode && o.offset == l11.focusOffset || !Xe3(t8.contentDOM, l11.focusNode) ? t8.state.selection.main.head : t8.docView.posFromDOM(l11.focusNode, l11.focusOffset), c3 = r2 && r2.node == l11.anchorNode && r2.offset == l11.anchorOffset || !Xe3(t8.contentDOM, l11.anchorNode) ? t8.state.selection.main.anchor : t8.docView.posFromDOM(l11.anchorNode, l11.anchorOffset), a2 = t8.viewport;
      if ((y4.ios || y4.chrome) && t8.state.selection.main.empty && h3 != c3 && (a2.from > 0 || a2.to < t8.state.doc.length)) {
        let f6 = Math.min(h3, c3), d4 = Math.max(h3, c3), u3 = a2.from - f6, p3 = a2.to - d4;
        (u3 == 0 || u3 == 1 || f6 == 0) && (p3 == 0 || p3 == -1 || d4 == t8.state.doc.length) && (h3 = 0, c3 = t8.state.doc.length);
      }
      this.newSel = x.single(c3, h3);
    }
  }
};
function Cn2(s212, t8) {
  let e7, { newSel: i12 } = t8, n14 = s212.state.selection.main, o = s212.inputState.lastKeyTime > Date.now() - 100 ? s212.inputState.lastKeyCode : -1;
  if (t8.bounds) {
    let { from: r2, to: l11 } = t8.bounds, h3 = n14.from, c3 = null;
    (o === 8 || y4.android && t8.text.length < l11 - r2) && (h3 = n14.to, c3 = "end");
    let a2 = Fo2(s212.state.doc.sliceString(r2, l11, Bt2), t8.text, h3 - r2, c3);
    a2 && (y4.chrome && o == 13 && a2.toB == a2.from + 2 && t8.text.slice(a2.from, a2.toB) == Bt2 + Bt2 && a2.toB--, e7 = { from: r2 + a2.from, to: r2 + a2.toA, insert: m.of(t8.text.slice(a2.from, a2.toB).split(Bt2)) });
  } else i12 && (!s212.hasFocus && s212.state.facet(st3) || i12.main.eq(n14)) && (i12 = null);
  if (!e7 && !i12) return false;
  if (!e7 && t8.typeOver && !n14.empty && i12 && i12.main.empty ? e7 = { from: n14.from, to: n14.to, insert: s212.state.doc.slice(n14.from, n14.to) } : e7 && e7.from >= n14.from && e7.to <= n14.to && (e7.from != n14.from || e7.to != n14.to) && n14.to - n14.from - (e7.to - e7.from) <= 4 ? e7 = { from: n14.from, to: n14.to, insert: s212.state.doc.slice(n14.from, e7.from).append(e7.insert).append(s212.state.doc.slice(e7.to, n14.to)) } : (y4.mac || y4.android) && e7 && e7.from == e7.to && e7.from == n14.head - 1 && /^\. ?$/.test(e7.insert.toString()) && s212.contentDOM.getAttribute("autocorrect") == "off" ? (i12 && e7.insert.length == 2 && (i12 = x.single(i12.main.anchor - 1, i12.main.head - 1)), e7 = { from: n14.from, to: n14.to, insert: m.of([" "]) }) : y4.chrome && e7 && e7.from == e7.to && e7.from == n14.head && e7.insert.toString() == `
 ` && s212.lineWrapping && (i12 && (i12 = x.single(i12.main.anchor - 1, i12.main.head - 1)), e7 = { from: n14.from, to: n14.to, insert: m.of([" "]) }), e7) return qi2(s212, e7, i12, o);
  if (i12 && !i12.main.eq(n14)) {
    let r2 = false, l11 = "select";
    return s212.inputState.lastSelectionTime > Date.now() - 50 && (s212.inputState.lastSelectionOrigin == "select" && (r2 = true), l11 = s212.inputState.lastSelectionOrigin), s212.dispatch({ selection: i12, scrollIntoView: r2, userEvent: l11 }), true;
  } else return false;
}
function qi2(s212, t8, e7, i12 = -1) {
  if (y4.ios && s212.inputState.flushIOSKey(t8)) return true;
  let n14 = s212.state.selection.main;
  if (y4.android && (t8.to == n14.to && (t8.from == n14.from || t8.from == n14.from - 1 && s212.state.sliceDoc(t8.from, n14.from) == " ") && t8.insert.length == 1 && t8.insert.lines == 2 && Mt2(s212.contentDOM, "Enter", 13) || (t8.from == n14.from - 1 && t8.to == n14.to && t8.insert.length == 0 || i12 == 8 && t8.insert.length < t8.to - t8.from && t8.to > n14.head) && Mt2(s212.contentDOM, "Backspace", 8) || t8.from == n14.from && t8.to == n14.to + 1 && t8.insert.length == 0 && Mt2(s212.contentDOM, "Delete", 46))) return true;
  let o = t8.insert.toString();
  s212.inputState.composing >= 0 && s212.inputState.composing++;
  let r2, l11 = () => r2 || (r2 = Vo2(s212, t8, e7));
  return s212.state.facet(cn2).some((h3) => h3(s212, t8.from, t8.to, o, l11)) || s212.dispatch(l11()), true;
}
function Vo2(s212, t8, e7) {
  let i12, n14 = s212.state, o = n14.selection.main;
  if (t8.from >= o.from && t8.to <= o.to && t8.to - t8.from >= (o.to - o.from) / 3 && (!e7 || e7.main.empty && e7.main.from == t8.from + t8.insert.length) && s212.inputState.composing < 0) {
    let l11 = o.from < t8.from ? n14.sliceDoc(o.from, t8.from) : "", h3 = o.to > t8.to ? n14.sliceDoc(t8.to, o.to) : "";
    i12 = n14.replaceSelection(s212.state.toText(l11 + t8.insert.sliceString(0, void 0, s212.state.lineBreak) + h3));
  } else {
    let l11 = n14.changes(t8), h3 = e7 && e7.main.to <= l11.newLength ? e7.main : void 0;
    if (n14.selection.ranges.length > 1 && s212.inputState.composing >= 0 && t8.to <= o.to && t8.to >= o.to - 10) {
      let c3 = s212.state.sliceDoc(t8.from, t8.to), a2, f6 = e7 && vn2(s212, e7.main.head);
      if (f6) {
        let p3 = t8.insert.length - (t8.to - t8.from);
        a2 = { from: f6.from, to: f6.to - p3 };
      } else a2 = s212.state.doc.lineAt(o.head);
      let d4 = o.to - t8.to, u3 = o.to - o.from;
      i12 = n14.changeByRange((p3) => {
        if (p3.from == o.from && p3.to == o.to) return { changes: l11, range: h3 || p3.map(l11) };
        let g8 = p3.to - d4, b12 = g8 - c3.length;
        if (p3.to - p3.from != u3 || s212.state.sliceDoc(b12, g8) != c3 || p3.to >= a2.from && p3.from <= a2.to) return { range: p3 };
        let m11 = n14.changes({ from: b12, to: g8, insert: t8.insert }), w14 = p3.to - o.to;
        return { changes: m11, range: h3 ? x.range(Math.max(0, h3.anchor + w14), Math.max(0, h3.head + w14)) : p3.map(m11) };
      });
    } else i12 = { changes: l11, selection: h3 && n14.selection.replaceRange(h3) };
  }
  let r2 = "input.type";
  return (s212.composing || s212.inputState.compositionPendingChange && s212.inputState.compositionEndedAt > Date.now() - 50) && (s212.inputState.compositionPendingChange = false, r2 += ".compose", s212.inputState.compositionFirstChange && (r2 += ".start", s212.inputState.compositionFirstChange = false)), n14.update(i12, { userEvent: r2, scrollIntoView: true });
}
function Fo2(s212, t8, e7, i12) {
  let n14 = Math.min(s212.length, t8.length), o = 0;
  for (; o < n14 && s212.charCodeAt(o) == t8.charCodeAt(o); ) o++;
  if (o == n14 && s212.length == t8.length) return null;
  let r2 = s212.length, l11 = t8.length;
  for (; r2 > 0 && l11 > 0 && s212.charCodeAt(r2 - 1) == t8.charCodeAt(l11 - 1); ) r2--, l11--;
  if (i12 == "end") {
    let h3 = Math.max(0, o - Math.min(r2, l11));
    e7 -= r2 + h3 - o;
  }
  if (r2 < o && s212.length < t8.length) {
    let h3 = e7 <= o && e7 >= r2 ? o - e7 : 0;
    o -= h3, l11 = o + (l11 - r2), r2 = o;
  } else if (l11 < o) {
    let h3 = e7 <= o && e7 >= l11 ? o - e7 : 0;
    o -= h3, r2 = o + (r2 - l11), l11 = o;
  }
  return { from: o, toA: r2, toB: l11 };
}
function Wo2(s212) {
  let t8 = [];
  if (s212.root.activeElement != s212.contentDOM) return t8;
  let { anchorNode: e7, anchorOffset: i12, focusNode: n14, focusOffset: o } = s212.observer.selectionRange;
  return e7 && (t8.push(new ke4(e7, i12)), (n14 != e7 || o != i12) && t8.push(new ke4(n14, o))), t8;
}
function zo2(s212, t8) {
  if (s212.length == 0) return null;
  let e7 = s212[0].pos, i12 = s212.length == 2 ? s212[1].pos : e7;
  return e7 > -1 && i12 > -1 ? x.single(e7 + t8, i12 + t8) : null;
}
var ai2 = class {
  setSelectionOrigin(t8) {
    this.lastSelectionOrigin = t8, this.lastSelectionTime = Date.now();
  }
  constructor(t8) {
    this.view = t8, this.lastKeyCode = 0, this.lastKeyTime = 0, this.lastTouchTime = 0, this.lastFocusTime = 0, this.lastScrollTop = 0, this.lastScrollLeft = 0, this.pendingIOSKey = void 0, this.tabFocusMode = -1, this.lastSelectionOrigin = null, this.lastSelectionTime = 0, this.lastContextMenu = 0, this.scrollHandlers = [], this.handlers = /* @__PURE__ */ Object.create(null), this.composing = -1, this.compositionFirstChange = null, this.compositionEndedAt = 0, this.compositionPendingKey = false, this.compositionPendingChange = false, this.mouseSelection = null, this.draggedContent = null, this.handleEvent = this.handleEvent.bind(this), this.notifiedFocused = t8.hasFocus, y4.safari && t8.contentDOM.addEventListener("input", () => null), y4.gecko && er2(t8.contentDOM.ownerDocument);
  }
  handleEvent(t8) {
    !Xo2(this.view, t8) || this.ignoreDuringComposition(t8) || t8.type == "keydown" && this.keydown(t8) || this.runHandlers(t8.type, t8);
  }
  runHandlers(t8, e7) {
    let i12 = this.handlers[t8];
    if (i12) {
      for (let n14 of i12.observers) n14(this.view, e7);
      for (let n14 of i12.handlers) {
        if (e7.defaultPrevented) break;
        if (n14(this.view, e7)) {
          e7.preventDefault();
          break;
        }
      }
    }
  }
  ensureHandlers(t8) {
    let e7 = Io2(t8), i12 = this.handlers, n14 = this.view.contentDOM;
    for (let o in e7) if (o != "scroll") {
      let r2 = !e7[o].handlers.length, l11 = i12[o];
      l11 && r2 != !l11.handlers.length && (n14.removeEventListener(o, this.handleEvent), l11 = null), l11 || n14.addEventListener(o, this.handleEvent, { passive: r2 });
    }
    for (let o in i12) o != "scroll" && !e7[o] && n14.removeEventListener(o, this.handleEvent);
    this.handlers = e7;
  }
  keydown(t8) {
    if (this.lastKeyCode = t8.keyCode, this.lastKeyTime = Date.now(), t8.keyCode == 9 && this.tabFocusMode > -1 && (!this.tabFocusMode || Date.now() <= this.tabFocusMode)) return true;
    if (this.tabFocusMode > 0 && t8.keyCode != 27 && kn2.indexOf(t8.keyCode) < 0 && (this.tabFocusMode = -1), y4.android && y4.chrome && !t8.synthetic && (t8.keyCode == 13 || t8.keyCode == 8)) return this.view.observer.delayAndroidKey(t8.key, t8.keyCode), true;
    let e7;
    return y4.ios && !t8.synthetic && !t8.altKey && !t8.metaKey && ((e7 = Mn2.find((i12) => i12.keyCode == t8.keyCode)) && !t8.ctrlKey || Ko2.indexOf(t8.key) > -1 && t8.ctrlKey && !t8.shiftKey) ? (this.pendingIOSKey = e7 || t8, setTimeout(() => this.flushIOSKey(), 250), true) : (t8.keyCode != 229 && this.view.observer.forceFlush(), false);
  }
  flushIOSKey(t8) {
    let e7 = this.pendingIOSKey;
    return !e7 || e7.key == "Enter" && t8 && t8.from < t8.to && /^\S+$/.test(t8.insert.toString()) ? false : (this.pendingIOSKey = void 0, Mt2(this.view.contentDOM, e7.key, e7.keyCode, e7 instanceof KeyboardEvent ? e7 : void 0));
  }
  ignoreDuringComposition(t8) {
    return /^key/.test(t8.type) ? this.composing > 0 ? true : y4.safari && !y4.ios && this.compositionPendingKey && Date.now() - this.compositionEndedAt < 100 ? (this.compositionPendingKey = false, true) : false : false;
  }
  startMouseSelection(t8) {
    this.mouseSelection && this.mouseSelection.destroy(), this.mouseSelection = t8;
  }
  update(t8) {
    this.view.observer.update(t8), this.mouseSelection && this.mouseSelection.update(t8), this.draggedContent && t8.docChanged && (this.draggedContent = this.draggedContent.map(t8.changes)), t8.transactions.length && (this.lastKeyCode = this.lastSelectionTime = 0);
  }
  destroy() {
    this.mouseSelection && this.mouseSelection.destroy();
  }
};
function ns2(s212, t8) {
  return (e7, i12) => {
    try {
      return t8.call(s212, i12, e7);
    } catch (n14) {
      $3(e7.state, n14);
    }
  };
}
function Io2(s212) {
  let t8 = /* @__PURE__ */ Object.create(null);
  function e7(i12) {
    return t8[i12] || (t8[i12] = { observers: [], handlers: [] });
  }
  for (let i12 of s212) {
    let n14 = i12.spec;
    if (n14 && n14.domEventHandlers) for (let o in n14.domEventHandlers) {
      let r2 = n14.domEventHandlers[o];
      r2 && e7(o).handlers.push(ns2(i12.value, r2));
    }
    if (n14 && n14.domEventObservers) for (let o in n14.domEventObservers) {
      let r2 = n14.domEventObservers[o];
      r2 && e7(o).observers.push(ns2(i12.value, r2));
    }
  }
  for (let i12 in Y4) e7(i12).handlers.push(Y4[i12]);
  for (let i12 in K4) e7(i12).observers.push(K4[i12]);
  return t8;
}
var Mn2 = [{ key: "Backspace", keyCode: 8, inputType: "deleteContentBackward" }, { key: "Enter", keyCode: 13, inputType: "insertParagraph" }, { key: "Enter", keyCode: 13, inputType: "insertLineBreak" }, { key: "Delete", keyCode: 46, inputType: "deleteContentForward" }];
var Ko2 = "dthko";
var kn2 = [16, 17, 18, 20, 91, 92, 224, 225];
var re3 = 6;
function le4(s212) {
  return Math.max(0, s212) * 0.7 + 8;
}
function qo2(s212, t8) {
  return Math.max(Math.abs(s212.clientX - t8.clientX), Math.abs(s212.clientY - t8.clientY));
}
var ci2 = class {
  constructor(t8, e7, i12, n14) {
    this.view = t8, this.startEvent = e7, this.style = i12, this.mustSelect = n14, this.scrollSpeed = { x: 0, y: 0 }, this.scrolling = -1, this.lastEvent = e7, this.scrollParents = no2(t8.contentDOM), this.atoms = t8.state.facet(Ki2).map((r2) => r2(t8));
    let o = t8.contentDOM.ownerDocument;
    o.addEventListener("mousemove", this.move = this.move.bind(this)), o.addEventListener("mouseup", this.up = this.up.bind(this)), this.extend = e7.shiftKey, this.multiple = t8.state.facet(I.allowMultipleSelections) && jo2(t8, e7), this.dragging = _o2(t8, e7) && On2(e7) == 1 ? null : false;
  }
  start(t8) {
    this.dragging === false && this.select(t8);
  }
  move(t8) {
    if (t8.buttons == 0) return this.destroy();
    if (this.dragging || this.dragging == null && qo2(this.startEvent, t8) < 10) return;
    this.select(this.lastEvent = t8);
    let e7 = 0, i12 = 0, n14 = 0, o = 0, r2 = this.view.win.innerWidth, l11 = this.view.win.innerHeight;
    this.scrollParents.x && ({ left: n14, right: r2 } = this.scrollParents.x.getBoundingClientRect()), this.scrollParents.y && ({ top: o, bottom: l11 } = this.scrollParents.y.getBoundingClientRect());
    let h3 = xn2(this.view);
    t8.clientX - h3.left <= n14 + re3 ? e7 = -le4(n14 - t8.clientX) : t8.clientX + h3.right >= r2 - re3 && (e7 = le4(t8.clientX - r2)), t8.clientY - h3.top <= o + re3 ? i12 = -le4(o - t8.clientY) : t8.clientY + h3.bottom >= l11 - re3 && (i12 = le4(t8.clientY - l11)), this.setScrollSpeed(e7, i12);
  }
  up(t8) {
    this.dragging == null && this.select(this.lastEvent), this.dragging || t8.preventDefault(), this.destroy();
  }
  destroy() {
    this.setScrollSpeed(0, 0);
    let t8 = this.view.contentDOM.ownerDocument;
    t8.removeEventListener("mousemove", this.move), t8.removeEventListener("mouseup", this.up), this.view.inputState.mouseSelection = this.view.inputState.draggedContent = null;
  }
  setScrollSpeed(t8, e7) {
    this.scrollSpeed = { x: t8, y: e7 }, t8 || e7 ? this.scrolling < 0 && (this.scrolling = setInterval(() => this.scroll(), 50)) : this.scrolling > -1 && (clearInterval(this.scrolling), this.scrolling = -1);
  }
  scroll() {
    let { x: t8, y: e7 } = this.scrollSpeed;
    t8 && this.scrollParents.x && (this.scrollParents.x.scrollLeft += t8, t8 = 0), e7 && this.scrollParents.y && (this.scrollParents.y.scrollTop += e7, e7 = 0), (t8 || e7) && this.view.win.scrollBy(t8, e7), this.dragging === false && this.select(this.lastEvent);
  }
  skipAtoms(t8) {
    let e7 = null;
    for (let i12 = 0; i12 < t8.ranges.length; i12++) {
      let n14 = t8.ranges[i12], o = null;
      if (n14.empty) {
        let r2 = pe3(this.atoms, n14.from, 0);
        r2 != n14.from && (o = x.cursor(r2, -1));
      } else {
        let r2 = pe3(this.atoms, n14.from, -1), l11 = pe3(this.atoms, n14.to, 1);
        (r2 != n14.from || l11 != n14.to) && (o = x.range(n14.from == n14.anchor ? r2 : l11, n14.from == n14.head ? r2 : l11));
      }
      o && (e7 || (e7 = t8.ranges.slice()), e7[i12] = o);
    }
    return e7 ? x.create(e7, t8.mainIndex) : t8;
  }
  select(t8) {
    let { view: e7 } = this, i12 = this.skipAtoms(this.style.get(t8, this.extend, this.multiple));
    (this.mustSelect || !i12.eq(e7.state.selection, this.dragging === false)) && this.view.dispatch({ selection: i12, userEvent: "select.pointer" }), this.mustSelect = false;
  }
  update(t8) {
    t8.transactions.some((e7) => e7.isUserEvent("input.type")) ? this.destroy() : this.style.update(t8) && setTimeout(() => this.select(this.lastEvent), 20);
  }
};
function jo2(s212, t8) {
  let e7 = s212.state.facet(rn2);
  return e7.length ? e7[0](t8) : y4.mac ? t8.metaKey : t8.ctrlKey;
}
function Yo2(s212, t8) {
  let e7 = s212.state.facet(ln2);
  return e7.length ? e7[0](t8) : y4.mac ? !t8.altKey : !t8.ctrlKey;
}
function _o2(s212, t8) {
  let { main: e7 } = s212.state.selection;
  if (e7.empty) return false;
  let i12 = jt2(s212.root);
  if (!i12 || i12.rangeCount == 0) return true;
  let n14 = i12.getRangeAt(0).getClientRects();
  for (let o = 0; o < n14.length; o++) {
    let r2 = n14[o];
    if (r2.left <= t8.clientX && r2.right >= t8.clientX && r2.top <= t8.clientY && r2.bottom >= t8.clientY) return true;
  }
  return false;
}
function Xo2(s212, t8) {
  if (!t8.bubbles) return true;
  if (t8.defaultPrevented) return false;
  for (let e7 = t8.target, i12; e7 != s212.contentDOM; e7 = e7.parentNode) if (!e7 || e7.nodeType == 11 || (i12 = T4.get(e7)) && i12.ignoreEvent(t8)) return false;
  return true;
}
var Y4 = /* @__PURE__ */ Object.create(null);
var K4 = /* @__PURE__ */ Object.create(null);
var An2 = y4.ie && y4.ie_version < 15 || y4.ios && y4.webkit_version < 604;
function Go2(s212) {
  let t8 = s212.dom.parentNode;
  if (!t8) return;
  let e7 = t8.appendChild(document.createElement("textarea"));
  e7.style.cssText = "position: fixed; left: -10000px; top: 10px", e7.focus(), setTimeout(() => {
    s212.focus(), e7.remove(), Dn2(s212, e7.value);
  }, 50);
}
function Fe3(s212, t8, e7) {
  for (let i12 of s212.facet(t8)) e7 = i12(e7, s212);
  return e7;
}
function Dn2(s212, t8) {
  t8 = Fe3(s212.state, zi2, t8);
  let { state: e7 } = s212, i12, n14 = 1, o = e7.toText(t8), r2 = o.lines == e7.selection.ranges.length;
  if (fi2 != null && e7.selection.ranges.every((h3) => h3.empty) && fi2 == o.toString()) {
    let h3 = -1;
    i12 = e7.changeByRange((c3) => {
      let a2 = e7.doc.lineAt(c3.from);
      if (a2.from == h3) return { range: c3 };
      h3 = a2.from;
      let f6 = e7.toText((r2 ? o.line(n14++).text : t8) + e7.lineBreak);
      return { changes: { from: a2.from, insert: f6 }, range: x.cursor(c3.from + f6.length) };
    });
  } else r2 ? i12 = e7.changeByRange((h3) => {
    let c3 = o.line(n14++);
    return { changes: { from: h3.from, to: h3.to, insert: c3.text }, range: x.cursor(h3.from + c3.length) };
  }) : i12 = e7.replaceSelection(o);
  s212.dispatch(i12, { userEvent: "input.paste", scrollIntoView: true });
}
K4.scroll = (s212) => {
  s212.inputState.lastScrollTop = s212.scrollDOM.scrollTop, s212.inputState.lastScrollLeft = s212.scrollDOM.scrollLeft;
};
Y4.keydown = (s212, t8) => (s212.inputState.setSelectionOrigin("select"), t8.keyCode == 27 && s212.inputState.tabFocusMode != 0 && (s212.inputState.tabFocusMode = Date.now() + 2e3), false);
K4.touchstart = (s212, t8) => {
  s212.inputState.lastTouchTime = Date.now(), s212.inputState.setSelectionOrigin("select.pointer");
};
K4.touchmove = (s212) => {
  s212.inputState.setSelectionOrigin("select.pointer");
};
Y4.mousedown = (s212, t8) => {
  if (s212.observer.flush(), s212.inputState.lastTouchTime > Date.now() - 2e3) return false;
  let e7 = null;
  for (let i12 of s212.state.facet(hn2)) if (e7 = i12(s212, t8), e7) break;
  if (!e7 && t8.button == 0 && (e7 = Qo2(s212, t8)), e7) {
    let i12 = !s212.hasFocus;
    s212.inputState.startMouseSelection(new ci2(s212, t8, e7, i12)), i12 && s212.observer.ignore(() => {
      Ws2(s212.contentDOM);
      let o = s212.root.activeElement;
      o && !o.contains(s212.contentDOM) && o.blur();
    });
    let n14 = s212.inputState.mouseSelection;
    if (n14) return n14.start(t8), n14.dragging === false;
  }
  return false;
};
function os2(s212, t8, e7, i12) {
  if (i12 == 1) return x.cursor(t8, e7);
  if (i12 == 2) return Oo2(s212.state, t8, e7);
  {
    let n14 = P3.find(s212.docView, t8), o = s212.state.doc.lineAt(n14 ? n14.posAtEnd : t8), r2 = n14 ? n14.posAtStart : o.from, l11 = n14 ? n14.posAtEnd : o.to;
    return l11 < s212.state.doc.length && l11 == o.to && l11++, x.range(r2, l11);
  }
}
var rs2 = (s212, t8, e7) => t8 >= e7.top && t8 <= e7.bottom && s212 >= e7.left && s212 <= e7.right;
function $o2(s212, t8, e7, i12) {
  let n14 = P3.find(s212.docView, t8);
  if (!n14) return 1;
  let o = t8 - n14.posAtStart;
  if (o == 0) return 1;
  if (o == n14.length) return -1;
  let r2 = n14.coordsAt(o, -1);
  if (r2 && rs2(e7, i12, r2)) return -1;
  let l11 = n14.coordsAt(o, 1);
  return l11 && rs2(e7, i12, l11) ? 1 : r2 && r2.bottom >= i12 ? -1 : 1;
}
function ls2(s212, t8) {
  let e7 = s212.posAtCoords({ x: t8.clientX, y: t8.clientY }, false);
  return { pos: e7, bias: $o2(s212, e7, t8.clientX, t8.clientY) };
}
var Uo2 = y4.ie && y4.ie_version <= 11;
var hs2 = null;
var as2 = 0;
var cs2 = 0;
function On2(s212) {
  if (!Uo2) return s212.detail;
  let t8 = hs2, e7 = cs2;
  return hs2 = s212, cs2 = Date.now(), as2 = !t8 || e7 > Date.now() - 400 && Math.abs(t8.clientX - s212.clientX) < 2 && Math.abs(t8.clientY - s212.clientY) < 2 ? (as2 + 1) % 3 : 1;
}
function Qo2(s212, t8) {
  let e7 = ls2(s212, t8), i12 = On2(t8), n14 = s212.state.selection;
  return { update(o) {
    o.docChanged && (e7.pos = o.changes.mapPos(e7.pos), n14 = n14.map(o.changes));
  }, get(o, r2, l11) {
    let h3 = ls2(s212, o), c3, a2 = os2(s212, h3.pos, h3.bias, i12);
    if (e7.pos != h3.pos && !r2) {
      let f6 = os2(s212, e7.pos, e7.bias, i12), d4 = Math.min(f6.from, a2.from), u3 = Math.max(f6.to, a2.to);
      a2 = d4 < a2.from ? x.range(d4, u3) : x.range(u3, d4);
    }
    return r2 ? n14.replaceRange(n14.main.extend(a2.from, a2.to)) : l11 && i12 == 1 && n14.ranges.length > 1 && (c3 = Jo2(n14, h3.pos)) ? c3 : l11 ? n14.addRange(a2) : x.create([a2]);
  } };
}
function Jo2(s212, t8) {
  for (let e7 = 0; e7 < s212.ranges.length; e7++) {
    let { from: i12, to: n14 } = s212.ranges[e7];
    if (i12 <= t8 && n14 >= t8) return x.create(s212.ranges.slice(0, e7).concat(s212.ranges.slice(e7 + 1)), s212.mainIndex == e7 ? 0 : s212.mainIndex - (s212.mainIndex > e7 ? 1 : 0));
  }
  return null;
}
Y4.dragstart = (s212, t8) => {
  let { selection: { main: e7 } } = s212.state;
  if (t8.target.draggable) {
    let n14 = s212.docView.nearest(t8.target);
    if (n14 && n14.isWidget) {
      let o = n14.posAtStart, r2 = o + n14.length;
      (o >= e7.to || r2 <= e7.from) && (e7 = x.range(o, r2));
    }
  }
  let { inputState: i12 } = s212;
  return i12.mouseSelection && (i12.mouseSelection.dragging = true), i12.draggedContent = e7, t8.dataTransfer && (t8.dataTransfer.setData("Text", Fe3(s212.state, Ii2, s212.state.sliceDoc(e7.from, e7.to))), t8.dataTransfer.effectAllowed = "copyMove"), false;
};
Y4.dragend = (s212) => (s212.inputState.draggedContent = null, false);
function fs2(s212, t8, e7, i12) {
  if (e7 = Fe3(s212.state, zi2, e7), !e7) return;
  let n14 = s212.posAtCoords({ x: t8.clientX, y: t8.clientY }, false), { draggedContent: o } = s212.inputState, r2 = i12 && o && Yo2(s212, t8) ? { from: o.from, to: o.to } : null, l11 = { from: n14, insert: e7 }, h3 = s212.state.changes(r2 ? [r2, l11] : l11);
  s212.focus(), s212.dispatch({ changes: h3, selection: { anchor: h3.mapPos(n14, -1), head: h3.mapPos(n14, 1) }, userEvent: r2 ? "move.drop" : "input.drop" }), s212.inputState.draggedContent = null;
}
Y4.drop = (s212, t8) => {
  if (!t8.dataTransfer) return false;
  if (s212.state.readOnly) return true;
  let e7 = t8.dataTransfer.files;
  if (e7 && e7.length) {
    let i12 = Array(e7.length), n14 = 0, o = () => {
      ++n14 == e7.length && fs2(s212, t8, i12.filter((r2) => r2 != null).join(s212.state.lineBreak), false);
    };
    for (let r2 = 0; r2 < e7.length; r2++) {
      let l11 = new FileReader();
      l11.onerror = o, l11.onload = () => {
        /[\x00-\x08\x0e-\x1f]{2}/.test(l11.result) || (i12[r2] = l11.result), o();
      }, l11.readAsText(e7[r2]);
    }
    return true;
  } else {
    let i12 = t8.dataTransfer.getData("Text");
    if (i12) return fs2(s212, t8, i12, true), true;
  }
  return false;
};
Y4.paste = (s212, t8) => {
  if (s212.state.readOnly) return true;
  s212.observer.flush();
  let e7 = An2 ? null : t8.clipboardData;
  return e7 ? (Dn2(s212, e7.getData("text/plain") || e7.getData("text/uri-list")), true) : (Go2(s212), false);
};
function Zo2(s212, t8) {
  let e7 = s212.dom.parentNode;
  if (!e7) return;
  let i12 = e7.appendChild(document.createElement("textarea"));
  i12.style.cssText = "position: fixed; left: -10000px; top: 10px", i12.value = t8, i12.focus(), i12.selectionEnd = t8.length, i12.selectionStart = 0, setTimeout(() => {
    i12.remove(), s212.focus();
  }, 50);
}
function tr2(s212) {
  let t8 = [], e7 = [], i12 = false;
  for (let n14 of s212.selection.ranges) n14.empty || (t8.push(s212.sliceDoc(n14.from, n14.to)), e7.push(n14));
  if (!t8.length) {
    let n14 = -1;
    for (let { from: o } of s212.selection.ranges) {
      let r2 = s212.doc.lineAt(o);
      r2.number > n14 && (t8.push(r2.text), e7.push({ from: r2.from, to: Math.min(s212.doc.length, r2.to + 1) })), n14 = r2.number;
    }
    i12 = true;
  }
  return { text: Fe3(s212, Ii2, t8.join(s212.lineBreak)), ranges: e7, linewise: i12 };
}
var fi2 = null;
Y4.copy = Y4.cut = (s212, t8) => {
  let { text: e7, ranges: i12, linewise: n14 } = tr2(s212.state);
  if (!e7 && !n14) return false;
  fi2 = n14 ? e7 : null, t8.type == "cut" && !s212.state.readOnly && s212.dispatch({ changes: i12, scrollIntoView: true, userEvent: "delete.cut" });
  let o = An2 ? null : t8.clipboardData;
  return o ? (o.clearData(), o.setData("text/plain", e7), true) : (Zo2(s212, e7), false);
};
var Tn2 = J.define();
function Rn2(s212, t8) {
  let e7 = [];
  for (let i12 of s212.facet(fn2)) {
    let n14 = i12(s212, t8);
    n14 && e7.push(n14);
  }
  return e7 ? s212.update({ effects: e7, annotations: Tn2.of(true) }) : null;
}
function En2(s212) {
  setTimeout(() => {
    let t8 = s212.hasFocus;
    if (t8 != s212.inputState.notifiedFocused) {
      let e7 = Rn2(s212.state, t8);
      e7 ? s212.dispatch(e7) : s212.update([]);
    }
  }, 10);
}
K4.focus = (s212) => {
  s212.inputState.lastFocusTime = Date.now(), !s212.scrollDOM.scrollTop && (s212.inputState.lastScrollTop || s212.inputState.lastScrollLeft) && (s212.scrollDOM.scrollTop = s212.inputState.lastScrollTop, s212.scrollDOM.scrollLeft = s212.inputState.lastScrollLeft), En2(s212);
};
K4.blur = (s212) => {
  s212.observer.clearSelectionRange(), En2(s212);
};
K4.compositionstart = K4.compositionupdate = (s212) => {
  s212.observer.editContext || (s212.inputState.compositionFirstChange == null && (s212.inputState.compositionFirstChange = true), s212.inputState.composing < 0 && (s212.inputState.composing = 0));
};
K4.compositionend = (s212) => {
  s212.observer.editContext || (s212.inputState.composing = -1, s212.inputState.compositionEndedAt = Date.now(), s212.inputState.compositionPendingKey = true, s212.inputState.compositionPendingChange = s212.observer.pendingRecords().length > 0, s212.inputState.compositionFirstChange = null, y4.chrome && y4.android ? s212.observer.flushSoon() : s212.inputState.compositionPendingChange ? Promise.resolve().then(() => s212.observer.flush()) : setTimeout(() => {
    s212.inputState.composing < 0 && s212.docView.hasComposition && s212.update([]);
  }, 50));
};
K4.contextmenu = (s212) => {
  s212.inputState.lastContextMenu = Date.now();
};
Y4.beforeinput = (s212, t8) => {
  var e7, i12;
  if (t8.inputType == "insertReplacementText" && s212.observer.editContext) {
    let o = (e7 = t8.dataTransfer) === null || e7 === void 0 ? void 0 : e7.getData("text/plain"), r2 = t8.getTargetRanges();
    if (o && r2.length) {
      let l11 = r2[0], h3 = s212.posAtDOM(l11.startContainer, l11.startOffset), c3 = s212.posAtDOM(l11.endContainer, l11.endOffset);
      return qi2(s212, { from: h3, to: c3, insert: s212.state.toText(o) }, null), true;
    }
  }
  let n14;
  if (y4.chrome && y4.android && (n14 = Mn2.find((o) => o.inputType == t8.inputType)) && (s212.observer.delayAndroidKey(n14.key, n14.keyCode), n14.key == "Backspace" || n14.key == "Delete")) {
    let o = ((i12 = window.visualViewport) === null || i12 === void 0 ? void 0 : i12.height) || 0;
    setTimeout(() => {
      var r2;
      (((r2 = window.visualViewport) === null || r2 === void 0 ? void 0 : r2.height) || 0) > o + 10 && s212.hasFocus && (s212.contentDOM.blur(), s212.focus());
    }, 100);
  }
  return y4.ios && t8.inputType == "deleteContentForward" && s212.observer.flushSoon(), y4.safari && t8.inputType == "insertText" && s212.inputState.composing >= 0 && setTimeout(() => K4.compositionend(s212, t8), 20), false;
};
var ds2 = /* @__PURE__ */ new Set();
function er2(s212) {
  ds2.has(s212) || (ds2.add(s212), s212.addEventListener("copy", () => {
  }), s212.addEventListener("cut", () => {
  }));
}
var us2 = ["pre-wrap", "normal", "pre-line", "break-spaces"];
var mt2 = false;
function di2() {
  mt2 = false;
}
var Ae3 = class {
  constructor(t8) {
    this.lineWrapping = t8, this.doc = m.empty, this.heightSamples = {}, this.lineHeight = 14, this.charWidth = 7, this.textHeight = 14, this.lineLength = 30;
  }
  heightForGap(t8, e7) {
    let i12 = this.doc.lineAt(e7).number - this.doc.lineAt(t8).number + 1;
    return this.lineWrapping && (i12 += Math.max(0, Math.ceil((e7 - t8 - i12 * this.lineLength * 0.5) / this.lineLength))), this.lineHeight * i12;
  }
  heightForLine(t8) {
    return this.lineWrapping ? (1 + Math.max(0, Math.ceil((t8 - this.lineLength) / (this.lineLength - 5)))) * this.lineHeight : this.lineHeight;
  }
  setDoc(t8) {
    return this.doc = t8, this;
  }
  mustRefreshForWrapping(t8) {
    return us2.indexOf(t8) > -1 != this.lineWrapping;
  }
  mustRefreshForHeights(t8) {
    let e7 = false;
    for (let i12 = 0; i12 < t8.length; i12++) {
      let n14 = t8[i12];
      n14 < 0 ? i12++ : this.heightSamples[Math.floor(n14 * 10)] || (e7 = true, this.heightSamples[Math.floor(n14 * 10)] = true);
    }
    return e7;
  }
  refresh(t8, e7, i12, n14, o, r2) {
    let l11 = us2.indexOf(t8) > -1, h3 = Math.round(e7) != Math.round(this.lineHeight) || this.lineWrapping != l11;
    if (this.lineWrapping = l11, this.lineHeight = e7, this.charWidth = i12, this.textHeight = n14, this.lineLength = o, h3) {
      this.heightSamples = {};
      for (let c3 = 0; c3 < r2.length; c3++) {
        let a2 = r2[c3];
        a2 < 0 ? c3++ : this.heightSamples[Math.floor(a2 * 10)] = true;
      }
    }
    return h3;
  }
};
var De3 = class {
  constructor(t8, e7) {
    this.from = t8, this.heights = e7, this.index = 0;
  }
  get more() {
    return this.index < this.heights.length;
  }
};
var X3 = class s70 {
  constructor(t8, e7, i12, n14, o) {
    this.from = t8, this.length = e7, this.top = i12, this.height = n14, this._content = o;
  }
  get type() {
    return typeof this._content == "number" ? F4.Text : Array.isArray(this._content) ? this._content : this._content.type;
  }
  get to() {
    return this.from + this.length;
  }
  get bottom() {
    return this.top + this.height;
  }
  get widget() {
    return this._content instanceof ht3 ? this._content.widget : null;
  }
  get widgetLineBreaks() {
    return typeof this._content == "number" ? this._content : 0;
  }
  join(t8) {
    let e7 = (Array.isArray(this._content) ? this._content : [this]).concat(Array.isArray(t8._content) ? t8._content : [t8]);
    return new s70(this.from, this.length + t8.length, this.top, this.height + t8.height, e7);
  }
};
var O4 = function(s212) {
  return s212[s212.ByPos = 0] = "ByPos", s212[s212.ByHeight = 1] = "ByHeight", s212[s212.ByPosNoHeight = 2] = "ByPosNoHeight", s212;
}(O4 || (O4 = {}));
var ge3 = 1e-3;
var z4 = class s71 {
  constructor(t8, e7, i12 = 2) {
    this.length = t8, this.height = e7, this.flags = i12;
  }
  get outdated() {
    return (this.flags & 2) > 0;
  }
  set outdated(t8) {
    this.flags = (t8 ? 2 : 0) | this.flags & -3;
  }
  setHeight(t8) {
    this.height != t8 && (Math.abs(this.height - t8) > ge3 && (mt2 = true), this.height = t8);
  }
  replace(t8, e7, i12) {
    return s71.of(i12);
  }
  decomposeLeft(t8, e7) {
    e7.push(this);
  }
  decomposeRight(t8, e7) {
    e7.push(this);
  }
  applyChanges(t8, e7, i12, n14) {
    let o = this, r2 = i12.doc;
    for (let l11 = n14.length - 1; l11 >= 0; l11--) {
      let { fromA: h3, toA: c3, fromB: a2, toB: f6 } = n14[l11], d4 = o.lineAt(h3, O4.ByPosNoHeight, i12.setDoc(e7), 0, 0), u3 = d4.to >= c3 ? d4 : o.lineAt(c3, O4.ByPosNoHeight, i12, 0, 0);
      for (f6 += u3.to - c3, c3 = u3.to; l11 > 0 && d4.from <= n14[l11 - 1].toA; ) h3 = n14[l11 - 1].fromA, a2 = n14[l11 - 1].fromB, l11--, h3 < d4.from && (d4 = o.lineAt(h3, O4.ByPosNoHeight, i12, 0, 0));
      a2 += d4.from - h3, h3 = d4.from;
      let p3 = pi2.build(i12.setDoc(r2), t8, a2, f6);
      o = Oe3(o, o.replace(h3, c3, p3));
    }
    return o.updateHeight(i12, 0);
  }
  static empty() {
    return new I3(0, 0);
  }
  static of(t8) {
    if (t8.length == 1) return t8[0];
    let e7 = 0, i12 = t8.length, n14 = 0, o = 0;
    for (; ; ) if (e7 == i12) if (n14 > o * 2) {
      let l11 = t8[e7 - 1];
      l11.break ? t8.splice(--e7, 1, l11.left, null, l11.right) : t8.splice(--e7, 1, l11.left, l11.right), i12 += 1 + l11.break, n14 -= l11.size;
    } else if (o > n14 * 2) {
      let l11 = t8[i12];
      l11.break ? t8.splice(i12, 1, l11.left, null, l11.right) : t8.splice(i12, 1, l11.left, l11.right), i12 += 2 + l11.break, o -= l11.size;
    } else break;
    else if (n14 < o) {
      let l11 = t8[e7++];
      l11 && (n14 += l11.size);
    } else {
      let l11 = t8[--i12];
      l11 && (o += l11.size);
    }
    let r2 = 0;
    return t8[e7 - 1] == null ? (r2 = 1, e7--) : t8[e7] == null && (r2 = 1, i12++), new ui2(s71.of(t8.slice(0, e7)), r2, s71.of(t8.slice(i12)));
  }
};
function Oe3(s212, t8) {
  return s212 == t8 ? s212 : (s212.constructor != t8.constructor && (mt2 = true), t8);
}
z4.prototype.size = 1;
var Te3 = class extends z4 {
  constructor(t8, e7, i12) {
    super(t8, e7), this.deco = i12;
  }
  blockAt(t8, e7, i12, n14) {
    return new X3(n14, this.length, i12, this.height, this.deco || 0);
  }
  lineAt(t8, e7, i12, n14, o) {
    return this.blockAt(0, i12, n14, o);
  }
  forEachLine(t8, e7, i12, n14, o, r2) {
    t8 <= o + this.length && e7 >= o && r2(this.blockAt(0, i12, n14, o));
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    return n14 && n14.from <= e7 && n14.more && this.setHeight(n14.heights[n14.index++]), this.outdated = false, this;
  }
  toString() {
    return `block(${this.length})`;
  }
};
var I3 = class s72 extends Te3 {
  constructor(t8, e7) {
    super(t8, e7, null), this.collapsed = 0, this.widgetHeight = 0, this.breaks = 0;
  }
  blockAt(t8, e7, i12, n14) {
    return new X3(n14, this.length, i12, this.height, this.breaks);
  }
  replace(t8, e7, i12) {
    let n14 = i12[0];
    return i12.length == 1 && (n14 instanceof s72 || n14 instanceof ot3 && n14.flags & 4) && Math.abs(this.length - n14.length) < 10 ? (n14 instanceof ot3 ? n14 = new s72(n14.length, this.height) : n14.height = this.height, this.outdated || (n14.outdated = false), n14) : z4.of(i12);
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    return n14 && n14.from <= e7 && n14.more ? this.setHeight(n14.heights[n14.index++]) : (i12 || this.outdated) && this.setHeight(Math.max(this.widgetHeight, t8.heightForLine(this.length - this.collapsed)) + this.breaks * t8.lineHeight), this.outdated = false, this;
  }
  toString() {
    return `line(${this.length}${this.collapsed ? -this.collapsed : ""}${this.widgetHeight ? ":" + this.widgetHeight : ""})`;
  }
};
var ot3 = class s73 extends z4 {
  constructor(t8) {
    super(t8, 0);
  }
  heightMetrics(t8, e7) {
    let i12 = t8.doc.lineAt(e7).number, n14 = t8.doc.lineAt(e7 + this.length).number, o = n14 - i12 + 1, r2, l11 = 0;
    if (t8.lineWrapping) {
      let h3 = Math.min(this.height, t8.lineHeight * o);
      r2 = h3 / o, this.length > o + 1 && (l11 = (this.height - h3) / (this.length - o - 1));
    } else r2 = this.height / o;
    return { firstLine: i12, lastLine: n14, perLine: r2, perChar: l11 };
  }
  blockAt(t8, e7, i12, n14) {
    let { firstLine: o, lastLine: r2, perLine: l11, perChar: h3 } = this.heightMetrics(e7, n14);
    if (e7.lineWrapping) {
      let c3 = n14 + (t8 < e7.lineHeight ? 0 : Math.round(Math.max(0, Math.min(1, (t8 - i12) / this.height)) * this.length)), a2 = e7.doc.lineAt(c3), f6 = l11 + a2.length * h3, d4 = Math.max(i12, t8 - f6 / 2);
      return new X3(a2.from, a2.length, d4, f6, 0);
    } else {
      let c3 = Math.max(0, Math.min(r2 - o, Math.floor((t8 - i12) / l11))), { from: a2, length: f6 } = e7.doc.line(o + c3);
      return new X3(a2, f6, i12 + l11 * c3, l11, 0);
    }
  }
  lineAt(t8, e7, i12, n14, o) {
    if (e7 == O4.ByHeight) return this.blockAt(t8, i12, n14, o);
    if (e7 == O4.ByPosNoHeight) {
      let { from: u3, to: p3 } = i12.doc.lineAt(t8);
      return new X3(u3, p3 - u3, 0, 0, 0);
    }
    let { firstLine: r2, perLine: l11, perChar: h3 } = this.heightMetrics(i12, o), c3 = i12.doc.lineAt(t8), a2 = l11 + c3.length * h3, f6 = c3.number - r2, d4 = n14 + l11 * f6 + h3 * (c3.from - o - f6);
    return new X3(c3.from, c3.length, Math.max(n14, Math.min(d4, n14 + this.height - a2)), a2, 0);
  }
  forEachLine(t8, e7, i12, n14, o, r2) {
    t8 = Math.max(t8, o), e7 = Math.min(e7, o + this.length);
    let { firstLine: l11, perLine: h3, perChar: c3 } = this.heightMetrics(i12, o);
    for (let a2 = t8, f6 = n14; a2 <= e7; ) {
      let d4 = i12.doc.lineAt(a2);
      if (a2 == t8) {
        let p3 = d4.number - l11;
        f6 += h3 * p3 + c3 * (t8 - o - p3);
      }
      let u3 = h3 + c3 * d4.length;
      r2(new X3(d4.from, d4.length, f6, u3, 0)), f6 += u3, a2 = d4.to + 1;
    }
  }
  replace(t8, e7, i12) {
    let n14 = this.length - e7;
    if (n14 > 0) {
      let o = i12[i12.length - 1];
      o instanceof s73 ? i12[i12.length - 1] = new s73(o.length + n14) : i12.push(null, new s73(n14 - 1));
    }
    if (t8 > 0) {
      let o = i12[0];
      o instanceof s73 ? i12[0] = new s73(t8 + o.length) : i12.unshift(new s73(t8 - 1), null);
    }
    return z4.of(i12);
  }
  decomposeLeft(t8, e7) {
    e7.push(new s73(t8 - 1), null);
  }
  decomposeRight(t8, e7) {
    e7.push(null, new s73(this.length - t8 - 1));
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    let o = e7 + this.length;
    if (n14 && n14.from <= e7 + this.length && n14.more) {
      let r2 = [], l11 = Math.max(e7, n14.from), h3 = -1;
      for (n14.from > e7 && r2.push(new s73(n14.from - e7 - 1).updateHeight(t8, e7)); l11 <= o && n14.more; ) {
        let a2 = t8.doc.lineAt(l11).length;
        r2.length && r2.push(null);
        let f6 = n14.heights[n14.index++];
        h3 == -1 ? h3 = f6 : Math.abs(f6 - h3) >= ge3 && (h3 = -2);
        let d4 = new I3(a2, f6);
        d4.outdated = false, r2.push(d4), l11 += a2 + 1;
      }
      l11 <= o && r2.push(null, new s73(o - l11).updateHeight(t8, l11));
      let c3 = z4.of(r2);
      return (h3 < 0 || Math.abs(c3.height - this.height) >= ge3 || Math.abs(h3 - this.heightMetrics(t8, e7).perLine) >= ge3) && (mt2 = true), Oe3(this, c3);
    } else (i12 || this.outdated) && (this.setHeight(t8.heightForGap(e7, e7 + this.length)), this.outdated = false);
    return this;
  }
  toString() {
    return `gap(${this.length})`;
  }
};
var ui2 = class extends z4 {
  constructor(t8, e7, i12) {
    super(t8.length + e7 + i12.length, t8.height + i12.height, e7 | (t8.outdated || i12.outdated ? 2 : 0)), this.left = t8, this.right = i12, this.size = t8.size + i12.size;
  }
  get break() {
    return this.flags & 1;
  }
  blockAt(t8, e7, i12, n14) {
    let o = i12 + this.left.height;
    return t8 < o ? this.left.blockAt(t8, e7, i12, n14) : this.right.blockAt(t8, e7, o, n14 + this.left.length + this.break);
  }
  lineAt(t8, e7, i12, n14, o) {
    let r2 = n14 + this.left.height, l11 = o + this.left.length + this.break, h3 = e7 == O4.ByHeight ? t8 < r2 : t8 < l11, c3 = h3 ? this.left.lineAt(t8, e7, i12, n14, o) : this.right.lineAt(t8, e7, i12, r2, l11);
    if (this.break || (h3 ? c3.to < l11 : c3.from > l11)) return c3;
    let a2 = e7 == O4.ByPosNoHeight ? O4.ByPosNoHeight : O4.ByPos;
    return h3 ? c3.join(this.right.lineAt(l11, a2, i12, r2, l11)) : this.left.lineAt(l11, a2, i12, n14, o).join(c3);
  }
  forEachLine(t8, e7, i12, n14, o, r2) {
    let l11 = n14 + this.left.height, h3 = o + this.left.length + this.break;
    if (this.break) t8 < h3 && this.left.forEachLine(t8, e7, i12, n14, o, r2), e7 >= h3 && this.right.forEachLine(t8, e7, i12, l11, h3, r2);
    else {
      let c3 = this.lineAt(h3, O4.ByPos, i12, n14, o);
      t8 < c3.from && this.left.forEachLine(t8, c3.from - 1, i12, n14, o, r2), c3.to >= t8 && c3.from <= e7 && r2(c3), e7 > c3.to && this.right.forEachLine(c3.to + 1, e7, i12, l11, h3, r2);
    }
  }
  replace(t8, e7, i12) {
    let n14 = this.left.length + this.break;
    if (e7 < n14) return this.balanced(this.left.replace(t8, e7, i12), this.right);
    if (t8 > this.left.length) return this.balanced(this.left, this.right.replace(t8 - n14, e7 - n14, i12));
    let o = [];
    t8 > 0 && this.decomposeLeft(t8, o);
    let r2 = o.length;
    for (let l11 of i12) o.push(l11);
    if (t8 > 0 && ps2(o, r2 - 1), e7 < this.length) {
      let l11 = o.length;
      this.decomposeRight(e7, o), ps2(o, l11);
    }
    return z4.of(o);
  }
  decomposeLeft(t8, e7) {
    let i12 = this.left.length;
    if (t8 <= i12) return this.left.decomposeLeft(t8, e7);
    e7.push(this.left), this.break && (i12++, t8 >= i12 && e7.push(null)), t8 > i12 && this.right.decomposeLeft(t8 - i12, e7);
  }
  decomposeRight(t8, e7) {
    let i12 = this.left.length, n14 = i12 + this.break;
    if (t8 >= n14) return this.right.decomposeRight(t8 - n14, e7);
    t8 < i12 && this.left.decomposeRight(t8, e7), this.break && t8 < n14 && e7.push(null), e7.push(this.right);
  }
  balanced(t8, e7) {
    return t8.size > 2 * e7.size || e7.size > 2 * t8.size ? z4.of(this.break ? [t8, null, e7] : [t8, e7]) : (this.left = Oe3(this.left, t8), this.right = Oe3(this.right, e7), this.setHeight(t8.height + e7.height), this.outdated = t8.outdated || e7.outdated, this.size = t8.size + e7.size, this.length = t8.length + this.break + e7.length, this);
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    let { left: o, right: r2 } = this, l11 = e7 + o.length + this.break, h3 = null;
    return n14 && n14.from <= e7 + o.length && n14.more ? h3 = o = o.updateHeight(t8, e7, i12, n14) : o.updateHeight(t8, e7, i12), n14 && n14.from <= l11 + r2.length && n14.more ? h3 = r2 = r2.updateHeight(t8, l11, i12, n14) : r2.updateHeight(t8, l11, i12), h3 ? this.balanced(o, r2) : (this.height = this.left.height + this.right.height, this.outdated = false, this);
  }
  toString() {
    return this.left + (this.break ? " " : "-") + this.right;
  }
};
function ps2(s212, t8) {
  let e7, i12;
  s212[t8] == null && (e7 = s212[t8 - 1]) instanceof ot3 && (i12 = s212[t8 + 1]) instanceof ot3 && s212.splice(t8 - 1, 3, new ot3(e7.length + 1 + i12.length));
}
var ir2 = 5;
var pi2 = class s74 {
  constructor(t8, e7) {
    this.pos = t8, this.oracle = e7, this.nodes = [], this.lineStart = -1, this.lineEnd = -1, this.covering = null, this.writtenTo = t8;
  }
  get isCovered() {
    return this.covering && this.nodes[this.nodes.length - 1] == this.covering;
  }
  span(t8, e7) {
    if (this.lineStart > -1) {
      let i12 = Math.min(e7, this.lineEnd), n14 = this.nodes[this.nodes.length - 1];
      n14 instanceof I3 ? n14.length += i12 - this.pos : (i12 > this.pos || !this.isCovered) && this.nodes.push(new I3(i12 - this.pos, -1)), this.writtenTo = i12, e7 > i12 && (this.nodes.push(null), this.writtenTo++, this.lineStart = -1);
    }
    this.pos = e7;
  }
  point(t8, e7, i12) {
    if (t8 < e7 || i12.heightRelevant) {
      let n14 = i12.widget ? i12.widget.estimatedHeight : 0, o = i12.widget ? i12.widget.lineBreaks : 0;
      n14 < 0 && (n14 = this.oracle.lineHeight);
      let r2 = e7 - t8;
      i12.block ? this.addBlock(new Te3(r2, n14, i12)) : (r2 || o || n14 >= ir2) && this.addLineDeco(n14, o, r2);
    } else e7 > t8 && this.span(t8, e7);
    this.lineEnd > -1 && this.lineEnd < this.pos && (this.lineEnd = this.oracle.doc.lineAt(this.pos).to);
  }
  enterLine() {
    if (this.lineStart > -1) return;
    let { from: t8, to: e7 } = this.oracle.doc.lineAt(this.pos);
    this.lineStart = t8, this.lineEnd = e7, this.writtenTo < t8 && ((this.writtenTo < t8 - 1 || this.nodes[this.nodes.length - 1] == null) && this.nodes.push(this.blankContent(this.writtenTo, t8 - 1)), this.nodes.push(null)), this.pos > t8 && this.nodes.push(new I3(this.pos - t8, -1)), this.writtenTo = this.pos;
  }
  blankContent(t8, e7) {
    let i12 = new ot3(e7 - t8);
    return this.oracle.doc.lineAt(t8).to == e7 && (i12.flags |= 4), i12;
  }
  ensureLine() {
    this.enterLine();
    let t8 = this.nodes.length ? this.nodes[this.nodes.length - 1] : null;
    if (t8 instanceof I3) return t8;
    let e7 = new I3(0, -1);
    return this.nodes.push(e7), e7;
  }
  addBlock(t8) {
    this.enterLine();
    let e7 = t8.deco;
    e7 && e7.startSide > 0 && !this.isCovered && this.ensureLine(), this.nodes.push(t8), this.writtenTo = this.pos = this.pos + t8.length, e7 && e7.endSide > 0 && (this.covering = t8);
  }
  addLineDeco(t8, e7, i12) {
    let n14 = this.ensureLine();
    n14.length += i12, n14.collapsed += i12, n14.widgetHeight = Math.max(n14.widgetHeight, t8), n14.breaks += e7, this.writtenTo = this.pos = this.pos + i12;
  }
  finish(t8) {
    let e7 = this.nodes.length == 0 ? null : this.nodes[this.nodes.length - 1];
    this.lineStart > -1 && !(e7 instanceof I3) && !this.isCovered ? this.nodes.push(new I3(0, -1)) : (this.writtenTo < this.pos || e7 == null) && this.nodes.push(this.blankContent(this.writtenTo, this.pos));
    let i12 = t8;
    for (let n14 of this.nodes) n14 instanceof I3 && n14.updateHeight(this.oracle, i12), i12 += n14 ? n14.length : 1;
    return this.nodes;
  }
  static build(t8, e7, i12, n14) {
    let o = new s74(i12, t8);
    return T.spans(e7, i12, n14, o, 0), o.finish(i12);
  }
};
function sr2(s212, t8, e7) {
  let i12 = new gi2();
  return T.compare(s212, t8, e7, i12, 0), i12.changes;
}
var gi2 = class {
  constructor() {
    this.changes = [];
  }
  compareRange() {
  }
  comparePoint(t8, e7, i12, n14) {
    (t8 < e7 || i12 && i12.heightRelevant || n14 && n14.heightRelevant) && ti2(t8, e7, this.changes, 5);
  }
};
function nr2(s212, t8) {
  let e7 = s212.getBoundingClientRect(), i12 = s212.ownerDocument, n14 = i12.defaultView || window, o = Math.max(0, e7.left), r2 = Math.min(n14.innerWidth, e7.right), l11 = Math.max(0, e7.top), h3 = Math.min(n14.innerHeight, e7.bottom);
  for (let c3 = s212.parentNode; c3 && c3 != i12.body; ) if (c3.nodeType == 1) {
    let a2 = c3, f6 = window.getComputedStyle(a2);
    if ((a2.scrollHeight > a2.clientHeight || a2.scrollWidth > a2.clientWidth) && f6.overflow != "visible") {
      let d4 = a2.getBoundingClientRect();
      o = Math.max(o, d4.left), r2 = Math.min(r2, d4.right), l11 = Math.max(l11, d4.top), h3 = Math.min(c3 == s212.parentNode ? n14.innerHeight : h3, d4.bottom);
    }
    c3 = f6.position == "absolute" || f6.position == "fixed" ? a2.offsetParent : a2.parentNode;
  } else if (c3.nodeType == 11) c3 = c3.host;
  else break;
  return { left: o - e7.left, right: Math.max(o, r2) - e7.left, top: l11 - (e7.top + t8), bottom: Math.max(l11, h3) - (e7.top + t8) };
}
function or2(s212, t8) {
  let e7 = s212.getBoundingClientRect();
  return { left: 0, right: e7.right - e7.left, top: t8, bottom: e7.bottom - (e7.top + t8) };
}
var It2 = class {
  constructor(t8, e7, i12) {
    this.from = t8, this.to = e7, this.size = i12;
  }
  static same(t8, e7) {
    if (t8.length != e7.length) return false;
    for (let i12 = 0; i12 < t8.length; i12++) {
      let n14 = t8[i12], o = e7[i12];
      if (n14.from != o.from || n14.to != o.to || n14.size != o.size) return false;
    }
    return true;
  }
  draw(t8, e7) {
    return R3.replace({ widget: new mi2(this.size * (e7 ? t8.scaleY : t8.scaleX), e7) }).range(this.from, this.to);
  }
};
var mi2 = class extends lt3 {
  constructor(t8, e7) {
    super(), this.size = t8, this.vertical = e7;
  }
  eq(t8) {
    return t8.size == this.size && t8.vertical == this.vertical;
  }
  toDOM() {
    let t8 = document.createElement("div");
    return this.vertical ? t8.style.height = this.size + "px" : (t8.style.width = this.size + "px", t8.style.height = "2px", t8.style.display = "inline-block"), t8;
  }
  get estimatedHeight() {
    return this.vertical ? this.size : -1;
  }
};
var Re3 = class {
  constructor(t8) {
    this.state = t8, this.pixelViewport = { left: 0, right: window.innerWidth, top: 0, bottom: 0 }, this.inView = true, this.paddingTop = 0, this.paddingBottom = 0, this.contentDOMWidth = 0, this.contentDOMHeight = 0, this.editorHeight = 0, this.editorWidth = 0, this.scrollTop = 0, this.scrolledToBottom = false, this.scaleX = 1, this.scaleY = 1, this.scrollAnchorPos = 0, this.scrollAnchorHeight = -1, this.scaler = gs2, this.scrollTarget = null, this.printing = false, this.mustMeasureContent = true, this.defaultTextDirection = L3.LTR, this.visibleRanges = [], this.mustEnforceCursorAssoc = false;
    let e7 = t8.facet(Ve3).some((i12) => typeof i12 != "function" && i12.class == "cm-lineWrapping");
    this.heightOracle = new Ae3(e7), this.stateDeco = t8.facet(Ut2).filter((i12) => typeof i12 != "function"), this.heightMap = z4.empty().applyChanges(this.stateDeco, m.empty, this.heightOracle.setDoc(t8.doc), [new j3(0, 0, 0, t8.doc.length)]);
    for (let i12 = 0; i12 < 2 && (this.viewport = this.getViewport(0, null), !!this.updateForViewport()); i12++) ;
    this.updateViewportLines(), this.lineGaps = this.ensureLineGaps([]), this.lineGapDeco = R3.set(this.lineGaps.map((i12) => i12.draw(this, false))), this.computeVisibleRanges();
  }
  updateForViewport() {
    let t8 = [this.viewport], { main: e7 } = this.state.selection;
    for (let i12 = 0; i12 <= 1; i12++) {
      let n14 = i12 ? e7.head : e7.anchor;
      if (!t8.some(({ from: o, to: r2 }) => n14 >= o && n14 <= r2)) {
        let { from: o, to: r2 } = this.lineBlockAt(n14);
        t8.push(new xt2(o, r2));
      }
    }
    return this.viewports = t8.sort((i12, n14) => i12.from - n14.from), this.updateScaler();
  }
  updateScaler() {
    let t8 = this.scaler;
    return this.scaler = this.heightMap.height <= 7e6 ? gs2 : new bi2(this.heightOracle, this.heightMap, this.viewports), t8.eq(this.scaler) ? 0 : 2;
  }
  updateViewportLines() {
    this.viewportLines = [], this.heightMap.forEachLine(this.viewport.from, this.viewport.to, this.heightOracle.setDoc(this.state.doc), 0, 0, (t8) => {
      this.viewportLines.push(Pt2(t8, this.scaler));
    });
  }
  update(t8, e7 = null) {
    this.state = t8.state;
    let i12 = this.stateDeco;
    this.stateDeco = this.state.facet(Ut2).filter((a2) => typeof a2 != "function");
    let n14 = t8.changedRanges, o = j3.extendWithRanges(n14, sr2(i12, this.stateDeco, t8 ? t8.changes : A.empty(this.state.doc.length))), r2 = this.heightMap.height, l11 = this.scrolledToBottom ? null : this.scrollAnchorAt(this.scrollTop);
    di2(), this.heightMap = this.heightMap.applyChanges(this.stateDeco, t8.startState.doc, this.heightOracle.setDoc(this.state.doc), o), (this.heightMap.height != r2 || mt2) && (t8.flags |= 2), l11 ? (this.scrollAnchorPos = t8.changes.mapPos(l11.from, -1), this.scrollAnchorHeight = l11.top) : (this.scrollAnchorPos = -1, this.scrollAnchorHeight = this.heightMap.height);
    let h3 = o.length ? this.mapViewport(this.viewport, t8.changes) : this.viewport;
    (e7 && (e7.range.head < h3.from || e7.range.head > h3.to) || !this.viewportIsAppropriate(h3)) && (h3 = this.getViewport(0, e7));
    let c3 = h3.from != this.viewport.from || h3.to != this.viewport.to;
    this.viewport = h3, t8.flags |= this.updateForViewport(), (c3 || !t8.changes.empty || t8.flags & 2) && this.updateViewportLines(), (this.lineGaps.length || this.viewport.to - this.viewport.from > 4e3) && this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps, t8.changes))), t8.flags |= this.computeVisibleRanges(), e7 && (this.scrollTarget = e7), !this.mustEnforceCursorAssoc && t8.selectionSet && t8.view.lineWrapping && t8.state.selection.main.empty && t8.state.selection.main.assoc && !t8.state.facet(un2) && (this.mustEnforceCursorAssoc = true);
  }
  measure(t8) {
    let e7 = t8.contentDOM, i12 = window.getComputedStyle(e7), n14 = this.heightOracle, o = i12.whiteSpace;
    this.defaultTextDirection = i12.direction == "rtl" ? L3.RTL : L3.LTR;
    let r2 = this.heightOracle.mustRefreshForWrapping(o), l11 = e7.getBoundingClientRect(), h3 = r2 || this.mustMeasureContent || this.contentDOMHeight != l11.height;
    this.contentDOMHeight = l11.height, this.mustMeasureContent = false;
    let c3 = 0, a2 = 0;
    if (l11.width && l11.height) {
      let { scaleX: x11, scaleY: S17 } = Fs2(e7, l11);
      (x11 > 5e-3 && Math.abs(this.scaleX - x11) > 5e-3 || S17 > 5e-3 && Math.abs(this.scaleY - S17) > 5e-3) && (this.scaleX = x11, this.scaleY = S17, c3 |= 8, r2 = h3 = true);
    }
    let f6 = (parseInt(i12.paddingTop) || 0) * this.scaleY, d4 = (parseInt(i12.paddingBottom) || 0) * this.scaleY;
    (this.paddingTop != f6 || this.paddingBottom != d4) && (this.paddingTop = f6, this.paddingBottom = d4, c3 |= 10), this.editorWidth != t8.scrollDOM.clientWidth && (n14.lineWrapping && (h3 = true), this.editorWidth = t8.scrollDOM.clientWidth, c3 |= 8);
    let u3 = t8.scrollDOM.scrollTop * this.scaleY;
    this.scrollTop != u3 && (this.scrollAnchorHeight = -1, this.scrollTop = u3), this.scrolledToBottom = Is2(t8.scrollDOM);
    let p3 = (this.printing ? or2 : nr2)(e7, this.paddingTop), g8 = p3.top - this.pixelViewport.top, b12 = p3.bottom - this.pixelViewport.bottom;
    this.pixelViewport = p3;
    let m11 = this.pixelViewport.bottom > this.pixelViewport.top && this.pixelViewport.right > this.pixelViewport.left;
    if (m11 != this.inView && (this.inView = m11, m11 && (h3 = true)), !this.inView && !this.scrollTarget) return 0;
    let w14 = l11.width;
    if ((this.contentDOMWidth != w14 || this.editorHeight != t8.scrollDOM.clientHeight) && (this.contentDOMWidth = l11.width, this.editorHeight = t8.scrollDOM.clientHeight, c3 |= 8), h3) {
      let x11 = t8.docView.measureVisibleLineHeights(this.viewport);
      if (n14.mustRefreshForHeights(x11) && (r2 = true), r2 || n14.lineWrapping && Math.abs(w14 - this.contentDOMWidth) > n14.charWidth) {
        let { lineHeight: S17, charWidth: C11, textHeight: E11 } = t8.docView.measureTextSize();
        r2 = S17 > 0 && n14.refresh(o, S17, C11, E11, w14 / C11, x11), r2 && (t8.docView.minWidth = 0, c3 |= 8);
      }
      g8 > 0 && b12 > 0 ? a2 = Math.max(g8, b12) : g8 < 0 && b12 < 0 && (a2 = Math.min(g8, b12)), di2();
      for (let S17 of this.viewports) {
        let C11 = S17.from == this.viewport.from ? x11 : t8.docView.measureVisibleLineHeights(S17);
        this.heightMap = (r2 ? z4.empty().applyChanges(this.stateDeco, m.empty, this.heightOracle, [new j3(0, 0, 0, t8.state.doc.length)]) : this.heightMap).updateHeight(n14, 0, r2, new De3(S17.from, C11));
      }
      mt2 && (c3 |= 2);
    }
    let v10 = !this.viewportIsAppropriate(this.viewport, a2) || this.scrollTarget && (this.scrollTarget.range.head < this.viewport.from || this.scrollTarget.range.head > this.viewport.to);
    return v10 && (c3 & 2 && (c3 |= this.updateScaler()), this.viewport = this.getViewport(a2, this.scrollTarget), c3 |= this.updateForViewport()), (c3 & 2 || v10) && this.updateViewportLines(), (this.lineGaps.length || this.viewport.to - this.viewport.from > 4e3) && this.updateLineGaps(this.ensureLineGaps(r2 ? [] : this.lineGaps, t8)), c3 |= this.computeVisibleRanges(), this.mustEnforceCursorAssoc && (this.mustEnforceCursorAssoc = false, t8.docView.enforceCursorAssoc()), c3;
  }
  get visibleTop() {
    return this.scaler.fromDOM(this.pixelViewport.top);
  }
  get visibleBottom() {
    return this.scaler.fromDOM(this.pixelViewport.bottom);
  }
  getViewport(t8, e7) {
    let i12 = 0.5 - Math.max(-0.5, Math.min(0.5, t8 / 1e3 / 2)), n14 = this.heightMap, o = this.heightOracle, { visibleTop: r2, visibleBottom: l11 } = this, h3 = new xt2(n14.lineAt(r2 - i12 * 1e3, O4.ByHeight, o, 0, 0).from, n14.lineAt(l11 + (1 - i12) * 1e3, O4.ByHeight, o, 0, 0).to);
    if (e7) {
      let { head: c3 } = e7.range;
      if (c3 < h3.from || c3 > h3.to) {
        let a2 = Math.min(this.editorHeight, this.pixelViewport.bottom - this.pixelViewport.top), f6 = n14.lineAt(c3, O4.ByPos, o, 0, 0), d4;
        e7.y == "center" ? d4 = (f6.top + f6.bottom) / 2 - a2 / 2 : e7.y == "start" || e7.y == "nearest" && c3 < h3.from ? d4 = f6.top : d4 = f6.bottom - a2, h3 = new xt2(n14.lineAt(d4 - 1e3 / 2, O4.ByHeight, o, 0, 0).from, n14.lineAt(d4 + a2 + 1e3 / 2, O4.ByHeight, o, 0, 0).to);
      }
    }
    return h3;
  }
  mapViewport(t8, e7) {
    let i12 = e7.mapPos(t8.from, -1), n14 = e7.mapPos(t8.to, 1);
    return new xt2(this.heightMap.lineAt(i12, O4.ByPos, this.heightOracle, 0, 0).from, this.heightMap.lineAt(n14, O4.ByPos, this.heightOracle, 0, 0).to);
  }
  viewportIsAppropriate({ from: t8, to: e7 }, i12 = 0) {
    if (!this.inView) return true;
    let { top: n14 } = this.heightMap.lineAt(t8, O4.ByPos, this.heightOracle, 0, 0), { bottom: o } = this.heightMap.lineAt(e7, O4.ByPos, this.heightOracle, 0, 0), { visibleTop: r2, visibleBottom: l11 } = this;
    return (t8 == 0 || n14 <= r2 - Math.max(10, Math.min(-i12, 250))) && (e7 == this.state.doc.length || o >= l11 + Math.max(10, Math.min(i12, 250))) && n14 > r2 - 2 * 1e3 && o < l11 + 2 * 1e3;
  }
  mapLineGaps(t8, e7) {
    if (!t8.length || e7.empty) return t8;
    let i12 = [];
    for (let n14 of t8) e7.touchesRange(n14.from, n14.to) || i12.push(new It2(e7.mapPos(n14.from), e7.mapPos(n14.to), n14.size));
    return i12;
  }
  ensureLineGaps(t8, e7) {
    let i12 = this.heightOracle.lineWrapping, n14 = i12 ? 1e4 : 2e3, o = n14 >> 1, r2 = n14 << 1;
    if (this.defaultTextDirection != L3.LTR && !i12) return [];
    let l11 = [], h3 = (a2, f6, d4, u3) => {
      if (f6 - a2 < o) return;
      let p3 = this.state.selection.main, g8 = [p3.from];
      p3.empty || g8.push(p3.to);
      for (let m11 of g8) if (m11 > a2 && m11 < f6) {
        h3(a2, m11 - 10, d4, u3), h3(m11 + 10, f6, d4, u3);
        return;
      }
      let b12 = lr2(t8, (m11) => m11.from >= d4.from && m11.to <= d4.to && Math.abs(m11.from - a2) < o && Math.abs(m11.to - f6) < o && !g8.some((w14) => m11.from < w14 && m11.to > w14));
      if (!b12) {
        if (f6 < d4.to && e7 && i12 && e7.visibleRanges.some((m11) => m11.from <= f6 && m11.to >= f6)) {
          let m11 = e7.moveToLineBoundary(x.cursor(f6), false, true).head;
          m11 > a2 && (f6 = m11);
        }
        b12 = new It2(a2, f6, this.gapSize(d4, a2, f6, u3));
      }
      l11.push(b12);
    }, c3 = (a2) => {
      if (a2.length < r2 || a2.type != F4.Text) return;
      let f6 = rr2(a2.from, a2.to, this.stateDeco);
      if (f6.total < r2) return;
      let d4 = this.scrollTarget ? this.scrollTarget.range.head : null, u3, p3;
      if (i12) {
        let g8 = n14 / this.heightOracle.lineLength * this.heightOracle.lineHeight, b12, m11;
        if (d4 != null) {
          let w14 = ae3(f6, d4), v10 = ((this.visibleBottom - this.visibleTop) / 2 + g8) / a2.height;
          b12 = w14 - v10, m11 = w14 + v10;
        } else b12 = (this.visibleTop - a2.top - g8) / a2.height, m11 = (this.visibleBottom - a2.top + g8) / a2.height;
        u3 = he3(f6, b12), p3 = he3(f6, m11);
      } else {
        let g8 = f6.total * this.heightOracle.charWidth, b12 = n14 * this.heightOracle.charWidth, m11, w14;
        if (d4 != null) {
          let v10 = ae3(f6, d4), x11 = ((this.pixelViewport.right - this.pixelViewport.left) / 2 + b12) / g8;
          m11 = v10 - x11, w14 = v10 + x11;
        } else m11 = (this.pixelViewport.left - b12) / g8, w14 = (this.pixelViewport.right + b12) / g8;
        u3 = he3(f6, m11), p3 = he3(f6, w14);
      }
      u3 > a2.from && h3(a2.from, u3, a2, f6), p3 < a2.to && h3(p3, a2.to, a2, f6);
    };
    for (let a2 of this.viewportLines) Array.isArray(a2.type) ? a2.type.forEach(c3) : c3(a2);
    return l11;
  }
  gapSize(t8, e7, i12, n14) {
    let o = ae3(n14, i12) - ae3(n14, e7);
    return this.heightOracle.lineWrapping ? t8.height * o : n14.total * this.heightOracle.charWidth * o;
  }
  updateLineGaps(t8) {
    It2.same(t8, this.lineGaps) || (this.lineGaps = t8, this.lineGapDeco = R3.set(t8.map((e7) => e7.draw(this, this.heightOracle.lineWrapping))));
  }
  computeVisibleRanges() {
    let t8 = this.stateDeco;
    this.lineGaps.length && (t8 = t8.concat(this.lineGapDeco));
    let e7 = [];
    T.spans(t8, this.viewport.from, this.viewport.to, { span(n14, o) {
      e7.push({ from: n14, to: o });
    }, point() {
    } }, 20);
    let i12 = e7.length != this.visibleRanges.length || this.visibleRanges.some((n14, o) => n14.from != e7[o].from || n14.to != e7[o].to);
    return this.visibleRanges = e7, i12 ? 4 : 0;
  }
  lineBlockAt(t8) {
    return t8 >= this.viewport.from && t8 <= this.viewport.to && this.viewportLines.find((e7) => e7.from <= t8 && e7.to >= t8) || Pt2(this.heightMap.lineAt(t8, O4.ByPos, this.heightOracle, 0, 0), this.scaler);
  }
  lineBlockAtHeight(t8) {
    return t8 >= this.viewportLines[0].top && t8 <= this.viewportLines[this.viewportLines.length - 1].bottom && this.viewportLines.find((e7) => e7.top <= t8 && e7.bottom >= t8) || Pt2(this.heightMap.lineAt(this.scaler.fromDOM(t8), O4.ByHeight, this.heightOracle, 0, 0), this.scaler);
  }
  scrollAnchorAt(t8) {
    let e7 = this.lineBlockAtHeight(t8 + 8);
    return e7.from >= this.viewport.from || this.viewportLines[0].top - t8 > 200 ? e7 : this.viewportLines[0];
  }
  elementAtHeight(t8) {
    return Pt2(this.heightMap.blockAt(this.scaler.fromDOM(t8), this.heightOracle, 0, 0), this.scaler);
  }
  get docHeight() {
    return this.scaler.toDOM(this.heightMap.height);
  }
  get contentHeight() {
    return this.docHeight + this.paddingTop + this.paddingBottom;
  }
};
var xt2 = class {
  constructor(t8, e7) {
    this.from = t8, this.to = e7;
  }
};
function rr2(s212, t8, e7) {
  let i12 = [], n14 = s212, o = 0;
  return T.spans(e7, s212, t8, { span() {
  }, point(r2, l11) {
    r2 > n14 && (i12.push({ from: n14, to: r2 }), o += r2 - n14), n14 = l11;
  } }, 20), n14 < t8 && (i12.push({ from: n14, to: t8 }), o += t8 - n14), { total: o, ranges: i12 };
}
function he3({ total: s212, ranges: t8 }, e7) {
  if (e7 <= 0) return t8[0].from;
  if (e7 >= 1) return t8[t8.length - 1].to;
  let i12 = Math.floor(s212 * e7);
  for (let n14 = 0; ; n14++) {
    let { from: o, to: r2 } = t8[n14], l11 = r2 - o;
    if (i12 <= l11) return o + i12;
    i12 -= l11;
  }
}
function ae3(s212, t8) {
  let e7 = 0;
  for (let { from: i12, to: n14 } of s212.ranges) {
    if (t8 <= n14) {
      e7 += t8 - i12;
      break;
    }
    e7 += n14 - i12;
  }
  return e7 / s212.total;
}
function lr2(s212, t8) {
  for (let e7 of s212) if (t8(e7)) return e7;
}
var gs2 = { toDOM(s212) {
  return s212;
}, fromDOM(s212) {
  return s212;
}, scale: 1, eq(s212) {
  return s212 == this;
} };
var bi2 = class s75 {
  constructor(t8, e7, i12) {
    let n14 = 0, o = 0, r2 = 0;
    this.viewports = i12.map(({ from: l11, to: h3 }) => {
      let c3 = e7.lineAt(l11, O4.ByPos, t8, 0, 0).top, a2 = e7.lineAt(h3, O4.ByPos, t8, 0, 0).bottom;
      return n14 += a2 - c3, { from: l11, to: h3, top: c3, bottom: a2, domTop: 0, domBottom: 0 };
    }), this.scale = (7e6 - n14) / (e7.height - n14);
    for (let l11 of this.viewports) l11.domTop = r2 + (l11.top - o) * this.scale, r2 = l11.domBottom = l11.domTop + (l11.bottom - l11.top), o = l11.bottom;
  }
  toDOM(t8) {
    for (let e7 = 0, i12 = 0, n14 = 0; ; e7++) {
      let o = e7 < this.viewports.length ? this.viewports[e7] : null;
      if (!o || t8 < o.top) return n14 + (t8 - i12) * this.scale;
      if (t8 <= o.bottom) return o.domTop + (t8 - o.top);
      i12 = o.bottom, n14 = o.domBottom;
    }
  }
  fromDOM(t8) {
    for (let e7 = 0, i12 = 0, n14 = 0; ; e7++) {
      let o = e7 < this.viewports.length ? this.viewports[e7] : null;
      if (!o || t8 < o.domTop) return i12 + (t8 - n14) / this.scale;
      if (t8 <= o.domBottom) return o.top + (t8 - o.domTop);
      i12 = o.bottom, n14 = o.domBottom;
    }
  }
  eq(t8) {
    return t8 instanceof s75 ? this.scale == t8.scale && this.viewports.length == t8.viewports.length && this.viewports.every((e7, i12) => e7.from == t8.viewports[i12].from && e7.to == t8.viewports[i12].to) : false;
  }
};
function Pt2(s212, t8) {
  if (t8.scale == 1) return s212;
  let e7 = t8.toDOM(s212.top), i12 = t8.toDOM(s212.bottom);
  return new X3(s212.from, s212.length, e7, i12 - e7, Array.isArray(s212._content) ? s212._content.map((n14) => Pt2(n14, t8)) : s212._content);
}
var ce4 = y.define({ combine: (s212) => s212.join(" ") });
var yi2 = y.define({ combine: (s212) => s212.indexOf(true) > -1 });
var wi2 = b2.newName();
var Ln2 = b2.newName();
var Bn2 = b2.newName();
var Pn2 = { "&light": "." + Ln2, "&dark": "." + Bn2 };
function xi2(s212, t8, e7) {
  return new b2(t8, { finish(i12) {
    return /&/.test(i12) ? i12.replace(/&\w*/, (n14) => {
      if (n14 == "&") return s212;
      if (!e7 || !e7[n14]) throw new RangeError(`Unsupported selector: ${n14}`);
      return e7[n14];
    }) : s212 + " " + i12;
  } });
}
var hr2 = xi2("." + wi2, { "&": { position: "relative !important", boxSizing: "border-box", "&.cm-focused": { outline: "1px dotted #212121" }, display: "flex !important", flexDirection: "column" }, ".cm-scroller": { display: "flex !important", alignItems: "flex-start !important", fontFamily: "monospace", lineHeight: 1.4, height: "100%", overflowX: "auto", position: "relative", zIndex: 0, overflowAnchor: "none" }, ".cm-content": { margin: 0, flexGrow: 2, flexShrink: 0, display: "block", whiteSpace: "pre", wordWrap: "normal", boxSizing: "border-box", minHeight: "100%", padding: "4px 0", outline: "none", "&[contenteditable=true]": { WebkitUserModify: "read-write-plaintext-only" } }, ".cm-lineWrapping": { whiteSpace_fallback: "pre-wrap", whiteSpace: "break-spaces", wordBreak: "break-word", overflowWrap: "anywhere", flexShrink: 1 }, "&light .cm-content": { caretColor: "black" }, "&dark .cm-content": { caretColor: "white" }, ".cm-line": { display: "block", padding: "0 2px 0 6px" }, ".cm-layer": { position: "absolute", left: 0, top: 0, contain: "size style", "& > *": { position: "absolute" } }, "&light .cm-selectionBackground": { background: "#d9d9d9" }, "&dark .cm-selectionBackground": { background: "#222" }, "&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground": { background: "#d7d4f0" }, "&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground": { background: "#233" }, ".cm-cursorLayer": { pointerEvents: "none" }, "&.cm-focused > .cm-scroller > .cm-cursorLayer": { animation: "steps(1) cm-blink 1.2s infinite" }, "@keyframes cm-blink": { "0%": {}, "50%": { opacity: 0 }, "100%": {} }, "@keyframes cm-blink2": { "0%": {}, "50%": { opacity: 0 }, "100%": {} }, ".cm-cursor, .cm-dropCursor": { borderLeft: "1.2px solid black", marginLeft: "-0.6px", pointerEvents: "none" }, ".cm-cursor": { display: "none" }, "&dark .cm-cursor": { borderLeftColor: "#444" }, ".cm-dropCursor": { position: "absolute" }, "&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor": { display: "block" }, ".cm-iso": { unicodeBidi: "isolate" }, ".cm-announced": { position: "fixed", top: "-10000px" }, "@media print": { ".cm-announced": { display: "none" } }, "&light .cm-activeLine": { backgroundColor: "#cceeff44" }, "&dark .cm-activeLine": { backgroundColor: "#99eeff33" }, "&light .cm-specialChar": { color: "red" }, "&dark .cm-specialChar": { color: "#f78" }, ".cm-gutters": { flexShrink: 0, display: "flex", height: "100%", boxSizing: "border-box", insetInlineStart: 0, zIndex: 200 }, "&light .cm-gutters": { backgroundColor: "#f5f5f5", color: "#6c6c6c", borderRight: "1px solid #ddd" }, "&dark .cm-gutters": { backgroundColor: "#333338", color: "#ccc" }, ".cm-gutter": { display: "flex !important", flexDirection: "column", flexShrink: 0, boxSizing: "border-box", minHeight: "100%", overflow: "hidden" }, ".cm-gutterElement": { boxSizing: "border-box" }, ".cm-lineNumbers .cm-gutterElement": { padding: "0 3px 0 5px", minWidth: "20px", textAlign: "right", whiteSpace: "nowrap" }, "&light .cm-activeLineGutter": { backgroundColor: "#e2f2ff" }, "&dark .cm-activeLineGutter": { backgroundColor: "#222227" }, ".cm-panels": { boxSizing: "border-box", position: "sticky", left: 0, right: 0, zIndex: 300 }, "&light .cm-panels": { backgroundColor: "#f5f5f5", color: "black" }, "&light .cm-panels-top": { borderBottom: "1px solid #ddd" }, "&light .cm-panels-bottom": { borderTop: "1px solid #ddd" }, "&dark .cm-panels": { backgroundColor: "#333338", color: "white" }, ".cm-tab": { display: "inline-block", overflow: "hidden", verticalAlign: "bottom" }, ".cm-widgetBuffer": { verticalAlign: "text-top", height: "1em", width: 0, display: "inline" }, ".cm-placeholder": { color: "#888", display: "inline-block", verticalAlign: "top" }, ".cm-highlightSpace:before": { content: "attr(data-display)", position: "absolute", pointerEvents: "none", color: "#888" }, ".cm-highlightTab": { backgroundImage: `url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`, backgroundSize: "auto 100%", backgroundPosition: "right 90%", backgroundRepeat: "no-repeat" }, ".cm-trailingSpace": { backgroundColor: "#ff332255" }, ".cm-button": { verticalAlign: "middle", color: "inherit", fontSize: "70%", padding: ".2em 1em", borderRadius: "1px" }, "&light .cm-button": { backgroundImage: "linear-gradient(#eff1f5, #d9d9df)", border: "1px solid #888", "&:active": { backgroundImage: "linear-gradient(#b4b4b4, #d0d3d6)" } }, "&dark .cm-button": { backgroundImage: "linear-gradient(#393939, #111)", border: "1px solid #888", "&:active": { backgroundImage: "linear-gradient(#111, #333)" } }, ".cm-textfield": { verticalAlign: "middle", color: "inherit", fontSize: "70%", border: "1px solid silver", padding: ".2em .5em" }, "&light .cm-textfield": { backgroundColor: "white" }, "&dark .cm-textfield": { border: "1px solid #555", backgroundColor: "inherit" } }, Pn2);
var ar2 = { childList: true, characterData: true, subtree: true, attributes: true, characterDataOldValue: true };
var qe3 = y4.ie && y4.ie_version <= 11;
var vi2 = class {
  constructor(t8) {
    this.view = t8, this.active = false, this.editContext = null, this.selectionRange = new Ge3(), this.selectionChanged = false, this.delayedFlush = -1, this.resizeTimeout = -1, this.queue = [], this.delayedAndroidKey = null, this.flushingAndroidKey = -1, this.lastChange = 0, this.scrollTargets = [], this.intersection = null, this.resizeScroll = null, this.intersecting = false, this.gapIntersection = null, this.gaps = [], this.printQuery = null, this.parentCheck = -1, this.dom = t8.contentDOM, this.observer = new MutationObserver((e7) => {
      for (let i12 of e7) this.queue.push(i12);
      (y4.ie && y4.ie_version <= 11 || y4.ios && t8.composing) && e7.some((i12) => i12.type == "childList" && i12.removedNodes.length || i12.type == "characterData" && i12.oldValue.length > i12.target.nodeValue.length) ? this.flushSoon() : this.flush();
    }), window.EditContext && t8.constructor.EDIT_CONTEXT !== false && !(y4.chrome && y4.chrome_version < 126) && (this.editContext = new Si2(t8), t8.state.facet(st3) && (t8.contentDOM.editContext = this.editContext.editContext)), qe3 && (this.onCharData = (e7) => {
      this.queue.push({ target: e7.target, type: "characterData", oldValue: e7.prevValue }), this.flushSoon();
    }), this.onSelectionChange = this.onSelectionChange.bind(this), this.onResize = this.onResize.bind(this), this.onPrint = this.onPrint.bind(this), this.onScroll = this.onScroll.bind(this), window.matchMedia && (this.printQuery = window.matchMedia("print")), typeof ResizeObserver == "function" && (this.resizeScroll = new ResizeObserver(() => {
      var e7;
      ((e7 = this.view.docView) === null || e7 === void 0 ? void 0 : e7.lastUpdate) < Date.now() - 75 && this.onResize();
    }), this.resizeScroll.observe(t8.scrollDOM)), this.addWindowListeners(this.win = t8.win), this.start(), typeof IntersectionObserver == "function" && (this.intersection = new IntersectionObserver((e7) => {
      this.parentCheck < 0 && (this.parentCheck = setTimeout(this.listenForScroll.bind(this), 1e3)), e7.length > 0 && e7[e7.length - 1].intersectionRatio > 0 != this.intersecting && (this.intersecting = !this.intersecting, this.intersecting != this.view.inView && this.onScrollChanged(document.createEvent("Event")));
    }, { threshold: [0, 1e-3] }), this.intersection.observe(this.dom), this.gapIntersection = new IntersectionObserver((e7) => {
      e7.length > 0 && e7[e7.length - 1].intersectionRatio > 0 && this.onScrollChanged(document.createEvent("Event"));
    }, {})), this.listenForScroll(), this.readSelectionRange();
  }
  onScrollChanged(t8) {
    this.view.inputState.runHandlers("scroll", t8), this.intersecting && this.view.measure();
  }
  onScroll(t8) {
    this.intersecting && this.flush(false), this.editContext && this.view.requestMeasure(this.editContext.measureReq), this.onScrollChanged(t8);
  }
  onResize() {
    this.resizeTimeout < 0 && (this.resizeTimeout = setTimeout(() => {
      this.resizeTimeout = -1, this.view.requestMeasure();
    }, 50));
  }
  onPrint(t8) {
    (t8.type == "change" || !t8.type) && !t8.matches || (this.view.viewState.printing = true, this.view.measure(), setTimeout(() => {
      this.view.viewState.printing = false, this.view.requestMeasure();
    }, 500));
  }
  updateGaps(t8) {
    if (this.gapIntersection && (t8.length != this.gaps.length || this.gaps.some((e7, i12) => e7 != t8[i12]))) {
      this.gapIntersection.disconnect();
      for (let e7 of t8) this.gapIntersection.observe(e7);
      this.gaps = t8;
    }
  }
  onSelectionChange(t8) {
    let e7 = this.selectionChanged;
    if (!this.readSelectionRange() || this.delayedAndroidKey) return;
    let { view: i12 } = this, n14 = this.selectionRange;
    if (i12.state.facet(st3) ? i12.root.activeElement != this.dom : !ue4(i12.dom, n14)) return;
    let o = n14.anchorNode && i12.docView.nearest(n14.anchorNode);
    if (o && o.ignoreEvent(t8)) {
      e7 || (this.selectionChanged = false);
      return;
    }
    (y4.ie && y4.ie_version <= 11 || y4.android && y4.chrome) && !i12.state.selection.main.empty && n14.focusNode && Vt2(n14.focusNode, n14.focusOffset, n14.anchorNode, n14.anchorOffset) ? this.flushSoon() : this.flush(false);
  }
  readSelectionRange() {
    let { view: t8 } = this, e7 = jt2(t8.root);
    if (!e7) return false;
    let i12 = y4.safari && t8.root.nodeType == 11 && eo2(this.dom.ownerDocument) == this.dom && cr2(this.view, e7) || e7;
    if (!i12 || this.selectionRange.eq(i12)) return false;
    let n14 = ue4(this.dom, i12);
    return n14 && !this.selectionChanged && t8.inputState.lastFocusTime > Date.now() - 200 && t8.inputState.lastTouchTime < Date.now() - 300 && ro2(this.dom, i12) ? (this.view.inputState.lastFocusTime = 0, t8.docView.updateSelection(), false) : (this.selectionRange.setRange(i12), n14 && (this.selectionChanged = true), true);
  }
  setSelectionRange(t8, e7) {
    this.selectionRange.set(t8.node, t8.offset, e7.node, e7.offset), this.selectionChanged = false;
  }
  clearSelectionRange() {
    this.selectionRange.set(null, 0, null, 0);
  }
  listenForScroll() {
    this.parentCheck = -1;
    let t8 = 0, e7 = null;
    for (let i12 = this.dom; i12; ) if (i12.nodeType == 1) !e7 && t8 < this.scrollTargets.length && this.scrollTargets[t8] == i12 ? t8++ : e7 || (e7 = this.scrollTargets.slice(0, t8)), e7 && e7.push(i12), i12 = i12.assignedSlot || i12.parentNode;
    else if (i12.nodeType == 11) i12 = i12.host;
    else break;
    if (t8 < this.scrollTargets.length && !e7 && (e7 = this.scrollTargets.slice(0, t8)), e7) {
      for (let i12 of this.scrollTargets) i12.removeEventListener("scroll", this.onScroll);
      for (let i12 of this.scrollTargets = e7) i12.addEventListener("scroll", this.onScroll);
    }
  }
  ignore(t8) {
    if (!this.active) return t8();
    try {
      return this.stop(), t8();
    } finally {
      this.start(), this.clear();
    }
  }
  start() {
    this.active || (this.observer.observe(this.dom, ar2), qe3 && this.dom.addEventListener("DOMCharacterDataModified", this.onCharData), this.active = true);
  }
  stop() {
    this.active && (this.active = false, this.observer.disconnect(), qe3 && this.dom.removeEventListener("DOMCharacterDataModified", this.onCharData));
  }
  clear() {
    this.processRecords(), this.queue.length = 0, this.selectionChanged = false;
  }
  delayAndroidKey(t8, e7) {
    var i12;
    if (!this.delayedAndroidKey) {
      let n14 = () => {
        let o = this.delayedAndroidKey;
        o && (this.clearDelayedAndroidKey(), this.view.inputState.lastKeyCode = o.keyCode, this.view.inputState.lastKeyTime = Date.now(), !this.flush() && o.force && Mt2(this.dom, o.key, o.keyCode));
      };
      this.flushingAndroidKey = this.view.win.requestAnimationFrame(n14);
    }
    (!this.delayedAndroidKey || t8 == "Enter") && (this.delayedAndroidKey = { key: t8, keyCode: e7, force: this.lastChange < Date.now() - 50 || !!(!((i12 = this.delayedAndroidKey) === null || i12 === void 0) && i12.force) });
  }
  clearDelayedAndroidKey() {
    this.win.cancelAnimationFrame(this.flushingAndroidKey), this.delayedAndroidKey = null, this.flushingAndroidKey = -1;
  }
  flushSoon() {
    this.delayedFlush < 0 && (this.delayedFlush = this.view.win.requestAnimationFrame(() => {
      this.delayedFlush = -1, this.flush();
    }));
  }
  forceFlush() {
    this.delayedFlush >= 0 && (this.view.win.cancelAnimationFrame(this.delayedFlush), this.delayedFlush = -1), this.flush();
  }
  pendingRecords() {
    for (let t8 of this.observer.takeRecords()) this.queue.push(t8);
    return this.queue;
  }
  processRecords() {
    let t8 = this.pendingRecords();
    t8.length && (this.queue = []);
    let e7 = -1, i12 = -1, n14 = false;
    for (let o of t8) {
      let r2 = this.readMutation(o);
      r2 && (r2.typeOver && (n14 = true), e7 == -1 ? { from: e7, to: i12 } = r2 : (e7 = Math.min(r2.from, e7), i12 = Math.max(r2.to, i12)));
    }
    return { from: e7, to: i12, typeOver: n14 };
  }
  readChange() {
    let { from: t8, to: e7, typeOver: i12 } = this.processRecords(), n14 = this.selectionChanged && ue4(this.dom, this.selectionRange);
    if (t8 < 0 && !n14) return null;
    t8 > -1 && (this.lastChange = Date.now()), this.view.inputState.lastFocusTime = 0, this.selectionChanged = false;
    let o = new hi2(this.view, t8, e7, i12);
    return this.view.docView.domChanged = { newSel: o.newSel ? o.newSel.main : null }, o;
  }
  flush(t8 = true) {
    if (this.delayedFlush >= 0 || this.delayedAndroidKey) return false;
    t8 && this.readSelectionRange();
    let e7 = this.readChange();
    if (!e7) return this.view.requestMeasure(), false;
    let i12 = this.view.state, n14 = Cn2(this.view, e7);
    return this.view.state == i12 && (e7.domChanged || e7.newSel && !e7.newSel.main.eq(this.view.state.selection.main)) && this.view.update([]), n14;
  }
  readMutation(t8) {
    let e7 = this.view.docView.nearest(t8.target);
    if (!e7 || e7.ignoreMutation(t8)) return null;
    if (e7.markDirty(t8.type == "attributes"), t8.type == "attributes" && (e7.flags |= 4), t8.type == "childList") {
      let i12 = ms2(e7, t8.previousSibling || t8.target.previousSibling, -1), n14 = ms2(e7, t8.nextSibling || t8.target.nextSibling, 1);
      return { from: i12 ? e7.posAfter(i12) : e7.posAtStart, to: n14 ? e7.posBefore(n14) : e7.posAtEnd, typeOver: false };
    } else return t8.type == "characterData" ? { from: e7.posAtStart, to: e7.posAtEnd, typeOver: t8.target.nodeValue == t8.oldValue } : null;
  }
  setWindow(t8) {
    t8 != this.win && (this.removeWindowListeners(this.win), this.win = t8, this.addWindowListeners(this.win));
  }
  addWindowListeners(t8) {
    t8.addEventListener("resize", this.onResize), this.printQuery ? this.printQuery.addEventListener ? this.printQuery.addEventListener("change", this.onPrint) : this.printQuery.addListener(this.onPrint) : t8.addEventListener("beforeprint", this.onPrint), t8.addEventListener("scroll", this.onScroll), t8.document.addEventListener("selectionchange", this.onSelectionChange);
  }
  removeWindowListeners(t8) {
    t8.removeEventListener("scroll", this.onScroll), t8.removeEventListener("resize", this.onResize), this.printQuery ? this.printQuery.removeEventListener ? this.printQuery.removeEventListener("change", this.onPrint) : this.printQuery.removeListener(this.onPrint) : t8.removeEventListener("beforeprint", this.onPrint), t8.document.removeEventListener("selectionchange", this.onSelectionChange);
  }
  update(t8) {
    this.editContext && (this.editContext.update(t8), t8.startState.facet(st3) != t8.state.facet(st3) && (t8.view.contentDOM.editContext = t8.state.facet(st3) ? this.editContext.editContext : null));
  }
  destroy() {
    var t8, e7, i12;
    this.stop(), (t8 = this.intersection) === null || t8 === void 0 || t8.disconnect(), (e7 = this.gapIntersection) === null || e7 === void 0 || e7.disconnect(), (i12 = this.resizeScroll) === null || i12 === void 0 || i12.disconnect();
    for (let n14 of this.scrollTargets) n14.removeEventListener("scroll", this.onScroll);
    this.removeWindowListeners(this.win), clearTimeout(this.parentCheck), clearTimeout(this.resizeTimeout), this.win.cancelAnimationFrame(this.delayedFlush), this.win.cancelAnimationFrame(this.flushingAndroidKey), this.editContext && (this.view.contentDOM.editContext = null, this.editContext.destroy());
  }
};
function ms2(s212, t8, e7) {
  for (; t8; ) {
    let i12 = T4.get(t8);
    if (i12 && i12.parent == s212) return i12;
    let n14 = t8.parentNode;
    t8 = n14 != s212.dom ? n14 : e7 > 0 ? t8.nextSibling : t8.previousSibling;
  }
  return null;
}
function bs2(s212, t8) {
  let e7 = t8.startContainer, i12 = t8.startOffset, n14 = t8.endContainer, o = t8.endOffset, r2 = s212.docView.domAtPos(s212.state.selection.main.anchor);
  return Vt2(r2.node, r2.offset, n14, o) && ([e7, i12, n14, o] = [n14, o, e7, i12]), { anchorNode: e7, anchorOffset: i12, focusNode: n14, focusOffset: o };
}
function cr2(s212, t8) {
  if (t8.getComposedRanges) {
    let n14 = t8.getComposedRanges(s212.root)[0];
    if (n14) return bs2(s212, n14);
  }
  let e7 = null;
  function i12(n14) {
    n14.preventDefault(), n14.stopImmediatePropagation(), e7 = n14.getTargetRanges()[0];
  }
  return s212.contentDOM.addEventListener("beforeinput", i12, true), s212.dom.ownerDocument.execCommand("indent"), s212.contentDOM.removeEventListener("beforeinput", i12, true), e7 ? bs2(s212, e7) : null;
}
var Si2 = class {
  constructor(t8) {
    this.from = 0, this.to = 0, this.pendingContextChange = null, this.handlers = /* @__PURE__ */ Object.create(null), this.resetRange(t8.state);
    let e7 = this.editContext = new window.EditContext({ text: t8.state.doc.sliceString(this.from, this.to), selectionStart: this.toContextPos(Math.max(this.from, Math.min(this.to, t8.state.selection.main.anchor))), selectionEnd: this.toContextPos(t8.state.selection.main.head) });
    this.handlers.textupdate = (i12) => {
      let { anchor: n14 } = t8.state.selection.main, o = { from: this.toEditorPos(i12.updateRangeStart), to: this.toEditorPos(i12.updateRangeEnd), insert: m.of(i12.text.split(`
`)) };
      o.from == this.from && n14 < this.from ? o.from = n14 : o.to == this.to && n14 > this.to && (o.to = n14), !(o.from == o.to && !o.insert.length) && (this.pendingContextChange = o, t8.state.readOnly || qi2(t8, o, x.single(this.toEditorPos(i12.selectionStart), this.toEditorPos(i12.selectionEnd))), this.pendingContextChange && (this.revertPending(t8.state), this.setSelection(t8.state)));
    }, this.handlers.characterboundsupdate = (i12) => {
      let n14 = [], o = null;
      for (let r2 = this.toEditorPos(i12.rangeStart), l11 = this.toEditorPos(i12.rangeEnd); r2 < l11; r2++) {
        let h3 = t8.coordsForChar(r2);
        o = h3 && new DOMRect(h3.left, h3.top, h3.right - h3.left, h3.bottom - h3.top) || o || new DOMRect(), n14.push(o);
      }
      e7.updateCharacterBounds(i12.rangeStart, n14);
    }, this.handlers.textformatupdate = (i12) => {
      let n14 = [];
      for (let o of i12.getTextFormats()) {
        let r2 = o.underlineStyle, l11 = o.underlineThickness;
        if (r2 != "None" && l11 != "None") {
          let h3 = `text-decoration: underline ${r2 == "Dashed" ? "dashed " : r2 == "Squiggle" ? "wavy " : ""}${l11 == "Thin" ? 1 : 2}px`;
          n14.push(R3.mark({ attributes: { style: h3 } }).range(this.toEditorPos(o.rangeStart), this.toEditorPos(o.rangeEnd)));
        }
      }
      t8.dispatch({ effects: gn2.of(R3.set(n14)) });
    }, this.handlers.compositionstart = () => {
      t8.inputState.composing < 0 && (t8.inputState.composing = 0, t8.inputState.compositionFirstChange = true);
    }, this.handlers.compositionend = () => {
      t8.inputState.composing = -1, t8.inputState.compositionFirstChange = null;
    };
    for (let i12 in this.handlers) e7.addEventListener(i12, this.handlers[i12]);
    this.measureReq = { read: (i12) => {
      this.editContext.updateControlBounds(i12.contentDOM.getBoundingClientRect());
      let n14 = jt2(i12.root);
      n14 && n14.rangeCount && this.editContext.updateSelectionBounds(n14.getRangeAt(0).getBoundingClientRect());
    } };
  }
  applyEdits(t8) {
    let e7 = 0, i12 = false, n14 = this.pendingContextChange;
    return t8.changes.iterChanges((o, r2, l11, h3, c3) => {
      if (i12) return;
      let a2 = c3.length - (r2 - o);
      if (n14 && r2 >= n14.to) if (n14.from == o && n14.to == r2 && n14.insert.eq(c3)) {
        n14 = this.pendingContextChange = null, e7 += a2, this.to += a2;
        return;
      } else n14 = null, this.revertPending(t8.state);
      if (o += e7, r2 += e7, r2 <= this.from) this.from += a2, this.to += a2;
      else if (o < this.to) {
        if (o < this.from || r2 > this.to || this.to - this.from + c3.length > 3e4) {
          i12 = true;
          return;
        }
        this.editContext.updateText(this.toContextPos(o), this.toContextPos(r2), c3.toString()), this.to += a2;
      }
      e7 += a2;
    }), n14 && !i12 && this.revertPending(t8.state), !i12;
  }
  update(t8) {
    let e7 = this.pendingContextChange;
    !this.applyEdits(t8) || !this.rangeIsValid(t8.state) ? (this.pendingContextChange = null, this.resetRange(t8.state), this.editContext.updateText(0, this.editContext.text.length, t8.state.doc.sliceString(this.from, this.to)), this.setSelection(t8.state)) : (t8.docChanged || t8.selectionSet || e7) && this.setSelection(t8.state), (t8.geometryChanged || t8.docChanged || t8.selectionSet) && t8.view.requestMeasure(this.measureReq);
  }
  resetRange(t8) {
    let { head: e7 } = t8.selection.main;
    this.from = Math.max(0, e7 - 1e4), this.to = Math.min(t8.doc.length, e7 + 1e4);
  }
  revertPending(t8) {
    let e7 = this.pendingContextChange;
    this.pendingContextChange = null, this.editContext.updateText(this.toContextPos(e7.from), this.toContextPos(e7.from + e7.insert.length), t8.doc.sliceString(e7.from, e7.to));
  }
  setSelection(t8) {
    let { main: e7 } = t8.selection, i12 = this.toContextPos(Math.max(this.from, Math.min(this.to, e7.anchor))), n14 = this.toContextPos(e7.head);
    (this.editContext.selectionStart != i12 || this.editContext.selectionEnd != n14) && this.editContext.updateSelection(i12, n14);
  }
  rangeIsValid(t8) {
    let { head: e7 } = t8.selection.main;
    return !(this.from > 0 && e7 - this.from < 500 || this.to < t8.doc.length && this.to - e7 < 500 || this.to - this.from > 1e4 * 3);
  }
  toEditorPos(t8) {
    return t8 + this.from;
  }
  toContextPos(t8) {
    return t8 - this.from;
  }
  destroy() {
    for (let t8 in this.handlers) this.editContext.removeEventListener(t8, this.handlers[t8]);
  }
};
var A3 = class s76 {
  get state() {
    return this.viewState.state;
  }
  get viewport() {
    return this.viewState.viewport;
  }
  get visibleRanges() {
    return this.viewState.visibleRanges;
  }
  get inView() {
    return this.viewState.inView;
  }
  get composing() {
    return this.inputState.composing > 0;
  }
  get compositionStarted() {
    return this.inputState.composing >= 0;
  }
  get root() {
    return this._root;
  }
  get win() {
    return this.dom.ownerDocument.defaultView || window;
  }
  constructor(t8 = {}) {
    var e7;
    this.plugins = [], this.pluginMap = /* @__PURE__ */ new Map(), this.editorAttrs = {}, this.contentAttrs = {}, this.bidiCache = [], this.destroyed = false, this.updateState = 2, this.measureScheduled = -1, this.measureRequests = [], this.contentDOM = document.createElement("div"), this.scrollDOM = document.createElement("div"), this.scrollDOM.tabIndex = -1, this.scrollDOM.className = "cm-scroller", this.scrollDOM.appendChild(this.contentDOM), this.announceDOM = document.createElement("div"), this.announceDOM.className = "cm-announced", this.announceDOM.setAttribute("aria-live", "polite"), this.dom = document.createElement("div"), this.dom.appendChild(this.announceDOM), this.dom.appendChild(this.scrollDOM), t8.parent && t8.parent.appendChild(this.dom);
    let { dispatch: i12 } = t8;
    this.dispatchTransactions = t8.dispatchTransactions || i12 && ((n14) => n14.forEach((o) => i12(o, this))) || ((n14) => this.update(n14)), this.dispatch = this.dispatch.bind(this), this._root = t8.root || oo2(t8.parent) || document, this.viewState = new Re3(t8.state || I.create(t8)), t8.scrollTo && t8.scrollTo.is(oe3) && (this.viewState.scrollTarget = t8.scrollTo.value.clip(this.viewState.state)), this.plugins = this.state.facet(Et2).map((n14) => new zt2(n14));
    for (let n14 of this.plugins) n14.update(this);
    this.observer = new vi2(this), this.inputState = new ai2(this), this.inputState.ensureHandlers(this.plugins), this.docView = new Me3(this), this.mountStyles(), this.updateAttrs(), this.updateState = 0, this.requestMeasure(), !((e7 = document.fonts) === null || e7 === void 0) && e7.ready && document.fonts.ready.then(() => this.requestMeasure());
  }
  dispatch(...t8) {
    let e7 = t8.length == 1 && t8[0] instanceof S ? t8 : t8.length == 1 && Array.isArray(t8[0]) ? t8[0] : [this.state.update(...t8)];
    this.dispatchTransactions(e7, this);
  }
  update(t8) {
    if (this.updateState != 0) throw new Error("Calls to EditorView.update are not allowed while an update is in progress");
    let e7 = false, i12 = false, n14, o = this.state;
    for (let d4 of t8) {
      if (d4.startState != o) throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");
      o = d4.state;
    }
    if (this.destroyed) {
      this.viewState.state = o;
      return;
    }
    let r2 = this.hasFocus, l11 = 0, h3 = null;
    t8.some((d4) => d4.annotation(Tn2)) ? (this.inputState.notifiedFocused = r2, l11 = 1) : r2 != this.inputState.notifiedFocused && (this.inputState.notifiedFocused = r2, h3 = Rn2(o, r2), h3 || (l11 = 1));
    let c3 = this.observer.delayedAndroidKey, a2 = null;
    if (c3 ? (this.observer.clearDelayedAndroidKey(), a2 = this.observer.readChange(), (a2 && !this.state.doc.eq(o.doc) || !this.state.selection.eq(o.selection)) && (a2 = null)) : this.observer.clear(), o.facet(I.phrases) != this.state.facet(I.phrases)) return this.setState(o);
    n14 = Ce3.create(this, o, t8), n14.flags |= l11;
    let f6 = this.viewState.scrollTarget;
    try {
      this.updateState = 2;
      for (let d4 of t8) {
        if (f6 && (f6 = f6.map(d4.changes)), d4.scrollIntoView) {
          let { main: u3 } = d4.state.selection;
          f6 = new Wt2(u3.empty ? u3 : x.cursor(u3.head, u3.head > u3.anchor ? -1 : 1));
        }
        for (let u3 of d4.effects) u3.is(oe3) && (f6 = u3.value.clip(this.state));
      }
      this.viewState.update(n14, f6), this.bidiCache = Ee4.update(this.bidiCache, n14.changes), n14.empty || (this.updatePlugins(n14), this.inputState.update(n14)), e7 = this.docView.update(n14), this.state.facet(Lt2) != this.styleModules && this.mountStyles(), i12 = this.updateAttrs(), this.showAnnouncements(t8), this.docView.updateSelection(e7, t8.some((d4) => d4.isUserEvent("select.pointer")));
    } finally {
      this.updateState = 0;
    }
    if (n14.startState.facet(ce4) != n14.state.facet(ce4) && (this.viewState.mustMeasureContent = true), (e7 || i12 || f6 || this.viewState.mustEnforceCursorAssoc || this.viewState.mustMeasureContent) && this.requestMeasure(), e7 && this.docViewUpdate(), !n14.empty) for (let d4 of this.state.facet(ni2)) try {
      d4(n14);
    } catch (u3) {
      $3(this.state, u3, "update listener");
    }
    (h3 || a2) && Promise.resolve().then(() => {
      h3 && this.state == h3.startState && this.dispatch(h3), a2 && !Cn2(this, a2) && c3.force && Mt2(this.contentDOM, c3.key, c3.keyCode);
    });
  }
  setState(t8) {
    if (this.updateState != 0) throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");
    if (this.destroyed) {
      this.viewState.state = t8;
      return;
    }
    this.updateState = 2;
    let e7 = this.hasFocus;
    try {
      for (let i12 of this.plugins) i12.destroy(this);
      this.viewState = new Re3(t8), this.plugins = t8.facet(Et2).map((i12) => new zt2(i12)), this.pluginMap.clear();
      for (let i12 of this.plugins) i12.update(this);
      this.docView.destroy(), this.docView = new Me3(this), this.inputState.ensureHandlers(this.plugins), this.mountStyles(), this.updateAttrs(), this.bidiCache = [];
    } finally {
      this.updateState = 0;
    }
    e7 && this.focus(), this.requestMeasure();
  }
  updatePlugins(t8) {
    let e7 = t8.startState.facet(Et2), i12 = t8.state.facet(Et2);
    if (e7 != i12) {
      let n14 = [];
      for (let o of i12) {
        let r2 = e7.indexOf(o);
        if (r2 < 0) n14.push(new zt2(o));
        else {
          let l11 = this.plugins[r2];
          l11.mustUpdate = t8, n14.push(l11);
        }
      }
      for (let o of this.plugins) o.mustUpdate != t8 && o.destroy(this);
      this.plugins = n14, this.pluginMap.clear();
    } else for (let n14 of this.plugins) n14.mustUpdate = t8;
    for (let n14 = 0; n14 < this.plugins.length; n14++) this.plugins[n14].update(this);
    e7 != i12 && this.inputState.ensureHandlers(this.plugins);
  }
  docViewUpdate() {
    for (let t8 of this.plugins) {
      let e7 = t8.value;
      if (e7 && e7.docViewUpdate) try {
        e7.docViewUpdate(this);
      } catch (i12) {
        $3(this.state, i12, "doc view update listener");
      }
    }
  }
  measure(t8 = true) {
    if (this.destroyed) return;
    if (this.measureScheduled > -1 && this.win.cancelAnimationFrame(this.measureScheduled), this.observer.delayedAndroidKey) {
      this.measureScheduled = -1, this.requestMeasure();
      return;
    }
    this.measureScheduled = 0, t8 && this.observer.forceFlush();
    let e7 = null, i12 = this.scrollDOM, n14 = i12.scrollTop * this.scaleY, { scrollAnchorPos: o, scrollAnchorHeight: r2 } = this.viewState;
    Math.abs(n14 - this.viewState.scrollTop) > 1 && (r2 = -1), this.viewState.scrollAnchorHeight = -1;
    try {
      for (let l11 = 0; ; l11++) {
        if (r2 < 0) if (Is2(i12)) o = -1, r2 = this.viewState.heightMap.height;
        else {
          let u3 = this.viewState.scrollAnchorAt(n14);
          o = u3.from, r2 = u3.top;
        }
        this.updateState = 1;
        let h3 = this.viewState.measure(this);
        if (!h3 && !this.measureRequests.length && this.viewState.scrollTarget == null) break;
        if (l11 > 5) {
          console.warn(this.measureRequests.length ? "Measure loop restarted more than 5 times" : "Viewport failed to stabilize");
          break;
        }
        let c3 = [];
        h3 & 4 || ([this.measureRequests, c3] = [c3, this.measureRequests]);
        let a2 = c3.map((u3) => {
          try {
            return u3.read(this);
          } catch (p3) {
            return $3(this.state, p3), ys2;
          }
        }), f6 = Ce3.create(this, this.state, []), d4 = false;
        f6.flags |= h3, e7 ? e7.flags |= h3 : e7 = f6, this.updateState = 2, f6.empty || (this.updatePlugins(f6), this.inputState.update(f6), this.updateAttrs(), d4 = this.docView.update(f6), d4 && this.docViewUpdate());
        for (let u3 = 0; u3 < c3.length; u3++) if (a2[u3] != ys2) try {
          let p3 = c3[u3];
          p3.write && p3.write(a2[u3], this);
        } catch (p3) {
          $3(this.state, p3);
        }
        if (d4 && this.docView.updateSelection(true), !f6.viewportChanged && this.measureRequests.length == 0) {
          if (this.viewState.editorHeight) if (this.viewState.scrollTarget) {
            this.docView.scrollIntoView(this.viewState.scrollTarget), this.viewState.scrollTarget = null, r2 = -1;
            continue;
          } else {
            let p3 = (o < 0 ? this.viewState.heightMap.height : this.viewState.lineBlockAt(o).top) - r2;
            if (p3 > 1 || p3 < -1) {
              n14 = n14 + p3, i12.scrollTop = n14 / this.scaleY, r2 = -1;
              continue;
            }
          }
          break;
        }
      }
    } finally {
      this.updateState = 0, this.measureScheduled = -1;
    }
    if (e7 && !e7.empty) for (let l11 of this.state.facet(ni2)) l11(e7);
  }
  get themeClasses() {
    return wi2 + " " + (this.state.facet(yi2) ? Bn2 : Ln2) + " " + this.state.facet(ce4);
  }
  updateAttrs() {
    let t8 = ws2(this, mn2, { class: "cm-editor" + (this.hasFocus ? " cm-focused " : " ") + this.themeClasses }), e7 = { spellcheck: "false", autocorrect: "off", autocapitalize: "off", translate: "no", contenteditable: this.state.facet(st3) ? "true" : "false", class: "cm-content", style: `${y4.tabSize}: ${this.state.tabSize}`, role: "textbox", "aria-multiline": "true" };
    this.state.readOnly && (e7["aria-readonly"] = "true"), ws2(this, Ve3, e7);
    let i12 = this.observer.ignore(() => {
      let n14 = Ze3(this.contentDOM, this.contentAttrs, e7), o = Ze3(this.dom, this.editorAttrs, t8);
      return n14 || o;
    });
    return this.editorAttrs = t8, this.contentAttrs = e7, i12;
  }
  showAnnouncements(t8) {
    let e7 = true;
    for (let i12 of t8) for (let n14 of i12.effects) if (n14.is(s76.announce)) {
      e7 && (this.announceDOM.textContent = ""), e7 = false;
      let o = this.announceDOM.appendChild(document.createElement("div"));
      o.textContent = n14.value;
    }
  }
  mountStyles() {
    this.styleModules = this.state.facet(Lt2);
    let t8 = this.state.facet(s76.cspNonce);
    b2.mount(this.root, this.styleModules.concat(hr2).reverse(), t8 ? { nonce: t8 } : void 0);
  }
  readMeasured() {
    if (this.updateState == 2) throw new Error("Reading the editor layout isn't allowed during an update");
    this.updateState == 0 && this.measureScheduled > -1 && this.measure(false);
  }
  requestMeasure(t8) {
    if (this.measureScheduled < 0 && (this.measureScheduled = this.win.requestAnimationFrame(() => this.measure())), t8) {
      if (this.measureRequests.indexOf(t8) > -1) return;
      if (t8.key != null) {
        for (let e7 = 0; e7 < this.measureRequests.length; e7++) if (this.measureRequests[e7].key === t8.key) {
          this.measureRequests[e7] = t8;
          return;
        }
      }
      this.measureRequests.push(t8);
    }
  }
  plugin(t8) {
    let e7 = this.pluginMap.get(t8);
    return (e7 === void 0 || e7 && e7.spec != t8) && this.pluginMap.set(t8, e7 = this.plugins.find((i12) => i12.spec == t8) || null), e7 && e7.update(this).value;
  }
  get documentTop() {
    return this.contentDOM.getBoundingClientRect().top + this.viewState.paddingTop;
  }
  get documentPadding() {
    return { top: this.viewState.paddingTop, bottom: this.viewState.paddingBottom };
  }
  get scaleX() {
    return this.viewState.scaleX;
  }
  get scaleY() {
    return this.viewState.scaleY;
  }
  elementAtHeight(t8) {
    return this.readMeasured(), this.viewState.elementAtHeight(t8);
  }
  lineBlockAtHeight(t8) {
    return this.readMeasured(), this.viewState.lineBlockAtHeight(t8);
  }
  get viewportLineBlocks() {
    return this.viewState.viewportLines;
  }
  lineBlockAt(t8) {
    return this.viewState.lineBlockAt(t8);
  }
  get contentHeight() {
    return this.viewState.contentHeight;
  }
  moveByChar(t8, e7, i12) {
    return Ke3(this, t8, ss2(this, t8, e7, i12));
  }
  moveByGroup(t8, e7) {
    return Ke3(this, t8, ss2(this, t8, e7, (i12) => Po2(this, t8.head, i12)));
  }
  visualLineSide(t8, e7) {
    let i12 = this.bidiSpans(t8), n14 = this.textDirectionAt(t8.from), o = i12[e7 ? i12.length - 1 : 0];
    return x.cursor(o.side(e7, n14) + t8.from, o.forward(!e7, n14) ? 1 : -1);
  }
  moveToLineBoundary(t8, e7, i12 = true) {
    return Bo2(this, t8, e7, i12);
  }
  moveVertically(t8, e7, i12) {
    return Ke3(this, t8, Ho2(this, t8, e7, i12));
  }
  domAtPos(t8) {
    return this.docView.domAtPos(t8);
  }
  posAtDOM(t8, e7 = 0) {
    return this.docView.posFromDOM(t8, e7);
  }
  posAtCoords(t8, e7 = true) {
    return this.readMeasured(), Sn2(this, t8, e7);
  }
  coordsAtPos(t8, e7 = 1) {
    this.readMeasured();
    let i12 = this.docView.coordsAt(t8, e7);
    if (!i12 || i12.left == i12.right) return i12;
    let n14 = this.state.doc.lineAt(t8), o = this.bidiSpans(n14), r2 = o[G4.find(o, t8 - n14.from, -1, e7)];
    return te4(i12, r2.dir == L3.LTR == e7 > 0);
  }
  coordsForChar(t8) {
    return this.readMeasured(), this.docView.coordsForChar(t8);
  }
  get defaultCharacterWidth() {
    return this.viewState.heightOracle.charWidth;
  }
  get defaultLineHeight() {
    return this.viewState.heightOracle.lineHeight;
  }
  get textDirection() {
    return this.viewState.defaultTextDirection;
  }
  textDirectionAt(t8) {
    return !this.state.facet(dn2) || t8 < this.viewport.from || t8 > this.viewport.to ? this.textDirection : (this.readMeasured(), this.docView.textDirectionAt(t8));
  }
  get lineWrapping() {
    return this.viewState.heightOracle.lineWrapping;
  }
  bidiSpans(t8) {
    if (t8.length > fr2) return sn2(t8.length);
    let e7 = this.textDirectionAt(t8.from), i12;
    for (let o of this.bidiCache) if (o.from == t8.from && o.dir == e7 && (o.fresh || tn2(o.isolates, i12 = Ji2(this, t8)))) return o.order;
    i12 || (i12 = Ji2(this, t8));
    let n14 = en2(t8.text, e7, i12);
    return this.bidiCache.push(new Ee4(t8.from, t8.to, e7, i12, true, n14)), n14;
  }
  get hasFocus() {
    var t8;
    return (this.dom.ownerDocument.hasFocus() || y4.safari && ((t8 = this.inputState) === null || t8 === void 0 ? void 0 : t8.lastContextMenu) > Date.now() - 3e4) && this.root.activeElement == this.contentDOM;
  }
  focus() {
    this.observer.ignore(() => {
      Ws2(this.contentDOM), this.docView.updateSelection();
    });
  }
  setRoot(t8) {
    this._root != t8 && (this._root = t8, this.observer.setWindow((t8.nodeType == 9 ? t8 : t8.ownerDocument).defaultView || window), this.mountStyles());
  }
  destroy() {
    this.root.activeElement == this.contentDOM && this.contentDOM.blur();
    for (let t8 of this.plugins) t8.destroy(this);
    this.plugins = [], this.inputState.destroy(), this.docView.destroy(), this.dom.remove(), this.observer.destroy(), this.measureScheduled > -1 && this.win.cancelAnimationFrame(this.measureScheduled), this.destroyed = true;
  }
  static scrollIntoView(t8, e7 = {}) {
    return oe3.of(new Wt2(typeof t8 == "number" ? x.cursor(t8) : t8, e7.y, e7.x, e7.yMargin, e7.xMargin));
  }
  scrollSnapshot() {
    let { scrollTop: t8, scrollLeft: e7 } = this.scrollDOM, i12 = this.viewState.scrollAnchorAt(t8);
    return oe3.of(new Wt2(x.cursor(i12.from), "start", "start", i12.top - t8, e7, true));
  }
  setTabFocusMode(t8) {
    t8 == null ? this.inputState.tabFocusMode = this.inputState.tabFocusMode < 0 ? 0 : -1 : typeof t8 == "boolean" ? this.inputState.tabFocusMode = t8 ? 0 : -1 : this.inputState.tabFocusMode != 0 && (this.inputState.tabFocusMode = Date.now() + t8);
  }
  static domEventHandlers(t8) {
    return N3.define(() => ({}), { eventHandlers: t8 });
  }
  static domEventObservers(t8) {
    return N3.define(() => ({}), { eventObservers: t8 });
  }
  static theme(t8, e7) {
    let i12 = b2.newName(), n14 = [ce4.of(i12), Lt2.of(xi2(`.${i12}`, t8))];
    return e7 && e7.dark && n14.push(yi2.of(true)), n14;
  }
  static baseTheme(t8) {
    return ht.lowest(Lt2.of(xi2("." + wi2, t8, Pn2)));
  }
  static findFromDOM(t8) {
    var e7;
    let i12 = t8.querySelector(".cm-content"), n14 = i12 && T4.get(i12) || T4.get(t8);
    return ((e7 = n14?.rootView) === null || e7 === void 0 ? void 0 : e7.view) || null;
  }
};
A3.styleModule = Lt2;
A3.inputHandler = cn2;
A3.clipboardInputFilter = zi2;
A3.clipboardOutputFilter = Ii2;
A3.scrollHandler = pn2;
A3.focusChangeEffect = fn2;
A3.perLineTextDirection = dn2;
A3.exceptionSink = an2;
A3.updateListener = ni2;
A3.editable = st3;
A3.mouseSelectionStyle = hn2;
A3.dragMovesSelection = ln2;
A3.clickAddsSelectionRange = rn2;
A3.decorations = Ut2;
A3.outerDecorations = bn2;
A3.atomicRanges = Ki2;
A3.bidiIsolatedRanges = yn2;
A3.scrollMargins = wn2;
A3.darkTheme = yi2;
A3.cspNonce = y.define({ combine: (s212) => s212.length ? s212[0] : "" });
A3.contentAttributes = Ve3;
A3.editorAttributes = mn2;
A3.lineWrapping = A3.contentAttributes.of({ class: "cm-lineWrapping" });
A3.announce = v.define();
var fr2 = 4096;
var ys2 = {};
var Ee4 = class s77 {
  constructor(t8, e7, i12, n14, o, r2) {
    this.from = t8, this.to = e7, this.dir = i12, this.isolates = n14, this.fresh = o, this.order = r2;
  }
  static update(t8, e7) {
    if (e7.empty && !t8.some((o) => o.fresh)) return t8;
    let i12 = [], n14 = t8.length ? t8[t8.length - 1].dir : L3.LTR;
    for (let o = Math.max(0, t8.length - 10); o < t8.length; o++) {
      let r2 = t8[o];
      r2.dir == n14 && !e7.touchesRange(r2.from, r2.to) && i12.push(new s77(e7.mapPos(r2.from, 1), e7.mapPos(r2.to, -1), r2.dir, r2.isolates, false, r2.order));
    }
    return i12;
  }
};
function ws2(s212, t8, e7) {
  for (let i12 = s212.state.facet(t8), n14 = i12.length - 1; n14 >= 0; n14--) {
    let o = i12[n14], r2 = typeof o == "function" ? o(s212) : o;
    r2 && Je3(r2, e7);
  }
  return e7;
}
var dr2 = y4.mac ? "mac" : y4.windows ? "win" : y4.linux ? "linux" : "key";
function ur2(s212, t8) {
  let e7 = s212.split(/-(?!$)/), i12 = e7[e7.length - 1];
  i12 == "Space" && (i12 = " ");
  let n14, o, r2, l11;
  for (let h3 = 0; h3 < e7.length - 1; ++h3) {
    let c3 = e7[h3];
    if (/^(cmd|meta|m)$/i.test(c3)) l11 = true;
    else if (/^a(lt)?$/i.test(c3)) n14 = true;
    else if (/^(c|ctrl|control)$/i.test(c3)) o = true;
    else if (/^s(hift)?$/i.test(c3)) r2 = true;
    else if (/^mod$/i.test(c3)) t8 == "mac" ? l11 = true : o = true;
    else throw new Error("Unrecognized modifier name: " + c3);
  }
  return n14 && (i12 = "Alt-" + i12), o && (i12 = "Ctrl-" + i12), l11 && (i12 = "Meta-" + i12), r2 && (i12 = "Shift-" + i12), i12;
}
function fe4(s212, t8, e7) {
  return t8.altKey && (s212 = "Alt-" + s212), t8.ctrlKey && (s212 = "Ctrl-" + s212), t8.metaKey && (s212 = "Meta-" + s212), e7 !== false && t8.shiftKey && (s212 = "Shift-" + s212), s212;
}
var pr2 = ht.default(A3.domEventHandlers({ keydown(s212, t8) {
  return Nn2(Hn2(t8.state), s212, t8, "editor");
} }));
var gr2 = y.define({ enables: pr2 });
var xs2 = /* @__PURE__ */ new WeakMap();
function Hn2(s212) {
  let t8 = s212.facet(gr2), e7 = xs2.get(t8);
  return e7 || xs2.set(t8, e7 = br2(t8.reduce((i12, n14) => i12.concat(n14), []))), e7;
}
var nt3 = null;
var mr2 = 4e3;
function br2(s212, t8 = dr2) {
  let e7 = /* @__PURE__ */ Object.create(null), i12 = /* @__PURE__ */ Object.create(null), n14 = (r2, l11) => {
    let h3 = i12[r2];
    if (h3 == null) i12[r2] = l11;
    else if (h3 != l11) throw new Error("Key binding " + r2 + " is used both as a regular binding and as a multi-stroke prefix");
  }, o = (r2, l11, h3, c3, a2) => {
    var f6, d4;
    let u3 = e7[r2] || (e7[r2] = /* @__PURE__ */ Object.create(null)), p3 = l11.split(/ (?!$)/).map((m11) => ur2(m11, t8));
    for (let m11 = 1; m11 < p3.length; m11++) {
      let w14 = p3.slice(0, m11).join(" ");
      n14(w14, true), u3[w14] || (u3[w14] = { preventDefault: true, stopPropagation: false, run: [(v10) => {
        let x11 = nt3 = { view: v10, prefix: w14, scope: r2 };
        return setTimeout(() => {
          nt3 == x11 && (nt3 = null);
        }, mr2), true;
      }] });
    }
    let g8 = p3.join(" ");
    n14(g8, false);
    let b12 = u3[g8] || (u3[g8] = { preventDefault: false, stopPropagation: false, run: ((d4 = (f6 = u3._any) === null || f6 === void 0 ? void 0 : f6.run) === null || d4 === void 0 ? void 0 : d4.slice()) || [] });
    h3 && b12.run.push(h3), c3 && (b12.preventDefault = true), a2 && (b12.stopPropagation = true);
  };
  for (let r2 of s212) {
    let l11 = r2.scope ? r2.scope.split(" ") : ["editor"];
    if (r2.any) for (let c3 of l11) {
      let a2 = e7[c3] || (e7[c3] = /* @__PURE__ */ Object.create(null));
      a2._any || (a2._any = { preventDefault: false, stopPropagation: false, run: [] });
      let { any: f6 } = r2;
      for (let d4 in a2) a2[d4].run.push((u3) => f6(u3, Ci2));
    }
    let h3 = r2[t8] || r2.key;
    if (h3) for (let c3 of l11) o(c3, h3, r2.run, r2.preventDefault, r2.stopPropagation), r2.shift && o(c3, "Shift-" + h3, r2.shift, r2.preventDefault, r2.stopPropagation);
  }
  return e7;
}
var Ci2 = null;
function Nn2(s212, t8, e7, i12) {
  Ci2 = t8;
  let n14 = g2(t8), o = ae(n14, 0), r2 = Oe(o) == n14.length && n14 != " ", l11 = "", h3 = false, c3 = false, a2 = false;
  nt3 && nt3.view == e7 && nt3.scope == i12 && (l11 = nt3.prefix + " ", kn2.indexOf(t8.keyCode) < 0 && (c3 = true, nt3 = null));
  let f6 = /* @__PURE__ */ new Set(), d4 = (b12) => {
    if (b12) {
      for (let m11 of b12.run) if (!f6.has(m11) && (f6.add(m11), m11(e7))) return b12.stopPropagation && (a2 = true), true;
      b12.preventDefault && (b12.stopPropagation && (a2 = true), c3 = true);
    }
    return false;
  }, u3 = s212[i12], p3, g8;
  return u3 && (d4(u3[l11 + fe4(n14, t8, !r2)]) ? h3 = true : r2 && (t8.altKey || t8.metaKey || t8.ctrlKey) && !(y4.windows && t8.ctrlKey && t8.altKey) && (p3 = t[t8.keyCode]) && p3 != n14 ? (d4(u3[l11 + fe4(p3, t8, true)]) || t8.shiftKey && (g8 = i[t8.keyCode]) != n14 && g8 != p3 && d4(u3[l11 + fe4(g8, t8, false)])) && (h3 = true) : r2 && t8.shiftKey && d4(u3[l11 + fe4(n14, t8, true)]) && (h3 = true), !h3 && d4(u3._any) && (h3 = true)), c3 && (h3 = true), h3 && a2 && t8.stopPropagation(), Ci2 = null, h3;
}
var Qt2 = class s78 {
  constructor(t8, e7, i12, n14, o) {
    this.className = t8, this.left = e7, this.top = i12, this.width = n14, this.height = o;
  }
  draw() {
    let t8 = document.createElement("div");
    return t8.className = this.className, this.adjust(t8), t8;
  }
  update(t8, e7) {
    return e7.className != this.className ? false : (this.adjust(t8), true);
  }
  adjust(t8) {
    t8.style.left = this.left + "px", t8.style.top = this.top + "px", this.width != null && (t8.style.width = this.width + "px"), t8.style.height = this.height + "px";
  }
  eq(t8) {
    return this.left == t8.left && this.top == t8.top && this.width == t8.width && this.height == t8.height && this.className == t8.className;
  }
  static forRange(t8, e7, i12) {
    if (i12.empty) {
      let n14 = t8.coordsAtPos(i12.head, i12.assoc || 1);
      if (!n14) return [];
      let o = Vn2(t8);
      return [new s78(e7, n14.left - o.left, n14.top - o.top, null, n14.bottom - n14.top)];
    } else return yr2(t8, e7, i12);
  }
};
function Vn2(s212) {
  let t8 = s212.scrollDOM.getBoundingClientRect();
  return { left: (s212.textDirection == L3.LTR ? t8.left : t8.right - s212.scrollDOM.clientWidth * s212.scaleX) - s212.scrollDOM.scrollLeft * s212.scaleX, top: t8.top - s212.scrollDOM.scrollTop * s212.scaleY };
}
function vs2(s212, t8, e7, i12) {
  let n14 = s212.coordsAtPos(t8, e7 * 2);
  if (!n14) return i12;
  let o = s212.dom.getBoundingClientRect(), r2 = (n14.top + n14.bottom) / 2, l11 = s212.posAtCoords({ x: o.left + 1, y: r2 }), h3 = s212.posAtCoords({ x: o.right - 1, y: r2 });
  return l11 == null || h3 == null ? i12 : { from: Math.max(i12.from, Math.min(l11, h3)), to: Math.min(i12.to, Math.max(l11, h3)) };
}
function yr2(s212, t8, e7) {
  if (e7.to <= s212.viewport.from || e7.from >= s212.viewport.to) return [];
  let i12 = Math.max(e7.from, s212.viewport.from), n14 = Math.min(e7.to, s212.viewport.to), o = s212.textDirection == L3.LTR, r2 = s212.contentDOM, l11 = r2.getBoundingClientRect(), h3 = Vn2(s212), c3 = r2.querySelector(".cm-line"), a2 = c3 && window.getComputedStyle(c3), f6 = l11.left + (a2 ? parseInt(a2.paddingLeft) + Math.min(0, parseInt(a2.textIndent)) : 0), d4 = l11.right - (a2 ? parseInt(a2.paddingRight) : 0), u3 = ri2(s212, i12), p3 = ri2(s212, n14), g8 = u3.type == F4.Text ? u3 : null, b12 = p3.type == F4.Text ? p3 : null;
  if (g8 && (s212.lineWrapping || u3.widgetLineBreaks) && (g8 = vs2(s212, i12, 1, g8)), b12 && (s212.lineWrapping || p3.widgetLineBreaks) && (b12 = vs2(s212, n14, -1, b12)), g8 && b12 && g8.from == b12.from && g8.to == b12.to) return w14(v10(e7.from, e7.to, g8));
  {
    let S17 = g8 ? v10(e7.from, null, g8) : x11(u3, false), C11 = b12 ? v10(null, e7.to, b12) : x11(p3, true), E11 = [];
    return (g8 || u3).to < (b12 || p3).from - (g8 && b12 ? 1 : 0) || u3.widgetLineBreaks > 1 && S17.bottom + s212.defaultLineHeight / 2 < C11.top ? E11.push(m11(f6, S17.bottom, d4, C11.top)) : S17.bottom < C11.top && s212.elementAtHeight((S17.bottom + C11.top) / 2).type == F4.Text && (S17.bottom = C11.top = (S17.bottom + C11.top) / 2), w14(S17).concat(E11).concat(w14(C11));
  }
  function m11(S17, C11, E11, B15) {
    return new Qt2(t8, S17 - h3.left, C11 - h3.top - 0.01, E11 - S17, B15 - C11 + 0.01);
  }
  function w14({ top: S17, bottom: C11, horizontal: E11 }) {
    let B15 = [];
    for (let et13 = 0; et13 < E11.length; et13 += 2) B15.push(m11(E11[et13], S17, E11[et13 + 1], C11));
    return B15;
  }
  function v10(S17, C11, E11) {
    let B15 = 1e9, et13 = -1e9, ee13 = [];
    function ji3(ct8, it12, bt5, ft8, Tt6) {
      let J15 = s212.coordsAtPos(ct8, ct8 == E11.to ? -2 : 2), Z21 = s212.coordsAtPos(bt5, bt5 == E11.from ? 2 : -2);
      !J15 || !Z21 || (B15 = Math.min(J15.top, Z21.top, B15), et13 = Math.max(J15.bottom, Z21.bottom, et13), Tt6 == L3.LTR ? ee13.push(o && it12 ? f6 : J15.left, o && ft8 ? d4 : Z21.right) : ee13.push(!o && ft8 ? f6 : Z21.left, !o && it12 ? d4 : J15.right));
    }
    let ie12 = S17 ?? E11.from, se15 = C11 ?? E11.to;
    for (let ct8 of s212.visibleRanges) if (ct8.to > ie12 && ct8.from < se15) for (let it12 = Math.max(ct8.from, ie12), bt5 = Math.min(ct8.to, se15); ; ) {
      let ft8 = s212.state.doc.lineAt(it12);
      for (let Tt6 of s212.bidiSpans(ft8)) {
        let J15 = Tt6.from + ft8.from, Z21 = Tt6.to + ft8.from;
        if (J15 >= bt5) break;
        Z21 > it12 && ji3(Math.max(J15, it12), S17 == null && J15 <= ie12, Math.min(Z21, bt5), C11 == null && Z21 >= se15, Tt6.dir);
      }
      if (it12 = ft8.to + 1, it12 >= bt5) break;
    }
    return ee13.length == 0 && ji3(ie12, S17 == null, se15, C11 == null, s212.textDirection), { top: B15, bottom: et13, horizontal: ee13 };
  }
  function x11(S17, C11) {
    let E11 = l11.top + (C11 ? S17.top : S17.bottom);
    return { top: E11, bottom: E11, horizontal: [] };
  }
}
function wr2(s212, t8) {
  return s212.constructor == t8.constructor && s212.eq(t8);
}
var Mi2 = class {
  constructor(t8, e7) {
    this.view = t8, this.layer = e7, this.drawn = [], this.scaleX = 1, this.scaleY = 1, this.measureReq = { read: this.measure.bind(this), write: this.draw.bind(this) }, this.dom = t8.scrollDOM.appendChild(document.createElement("div")), this.dom.classList.add("cm-layer"), e7.above && this.dom.classList.add("cm-layer-above"), e7.class && this.dom.classList.add(e7.class), this.scale(), this.dom.setAttribute("aria-hidden", "true"), this.setOrder(t8.state), t8.requestMeasure(this.measureReq), e7.mount && e7.mount(this.dom, t8);
  }
  update(t8) {
    t8.startState.facet(me3) != t8.state.facet(me3) && this.setOrder(t8.state), (this.layer.update(t8, this.dom) || t8.geometryChanged) && (this.scale(), t8.view.requestMeasure(this.measureReq));
  }
  docViewUpdate(t8) {
    this.layer.updateOnDocViewUpdate !== false && t8.requestMeasure(this.measureReq);
  }
  setOrder(t8) {
    let e7 = 0, i12 = t8.facet(me3);
    for (; e7 < i12.length && i12[e7] != this.layer; ) e7++;
    this.dom.style.zIndex = String((this.layer.above ? 150 : -1) - e7);
  }
  measure() {
    return this.layer.markers(this.view);
  }
  scale() {
    let { scaleX: t8, scaleY: e7 } = this.view;
    (t8 != this.scaleX || e7 != this.scaleY) && (this.scaleX = t8, this.scaleY = e7, this.dom.style.transform = `scale(${1 / t8}, ${1 / e7})`);
  }
  draw(t8) {
    if (t8.length != this.drawn.length || t8.some((e7, i12) => !wr2(e7, this.drawn[i12]))) {
      let e7 = this.dom.firstChild, i12 = 0;
      for (let n14 of t8) n14.update && e7 && n14.constructor && this.drawn[i12].constructor && n14.update(e7, this.drawn[i12]) ? (e7 = e7.nextSibling, i12++) : this.dom.insertBefore(n14.draw(), e7);
      for (; e7; ) {
        let n14 = e7.nextSibling;
        e7.remove(), e7 = n14;
      }
      this.drawn = t8;
    }
  }
  destroy() {
    this.layer.destroy && this.layer.destroy(this.dom, this.view), this.dom.remove();
  }
};
var me3 = y.define();
function Fn2(s212) {
  return [N3.define((t8) => new Mi2(t8, s212)), me3.of(s212)];
}
var Wn2 = !y4.ios;
var Dt2 = y.define({ combine(s212) {
  return at(s212, { cursorBlinkRate: 1200, drawRangeCursor: true }, { cursorBlinkRate: (t8, e7) => Math.min(t8, e7), drawRangeCursor: (t8, e7) => t8 || e7 });
} });
function zn2(s212) {
  return s212.startState.facet(Dt2) != s212.state.facet(Dt2);
}
var xr2 = Fn2({ above: true, markers(s212) {
  let { state: t8 } = s212, e7 = t8.facet(Dt2), i12 = [];
  for (let n14 of t8.selection.ranges) {
    let o = n14 == t8.selection.main;
    if (n14.empty ? !o || Wn2 : e7.drawRangeCursor) {
      let r2 = o ? "cm-cursor cm-cursor-primary" : "cm-cursor cm-cursor-secondary", l11 = n14.empty ? n14 : x.cursor(n14.head, n14.head > n14.anchor ? -1 : 1);
      for (let h3 of Qt2.forRange(s212, r2, l11)) i12.push(h3);
    }
  }
  return i12;
}, update(s212, t8) {
  s212.transactions.some((i12) => i12.selection) && (t8.style.animationName = t8.style.animationName == "cm-blink" ? "cm-blink2" : "cm-blink");
  let e7 = zn2(s212);
  return e7 && Ss2(s212.state, t8), s212.docChanged || s212.selectionSet || e7;
}, mount(s212, t8) {
  Ss2(t8.state, s212);
}, class: "cm-cursorLayer" });
function Ss2(s212, t8) {
  t8.style.animationDuration = s212.facet(Dt2).cursorBlinkRate + "ms";
}
var vr2 = Fn2({ above: false, markers(s212) {
  return s212.state.selection.ranges.map((t8) => t8.empty ? [] : Qt2.forRange(s212, "cm-selectionBackground", t8)).reduce((t8, e7) => t8.concat(e7));
}, update(s212, t8) {
  return s212.docChanged || s212.selectionSet || s212.viewportChanged || zn2(s212);
}, class: "cm-selectionLayer" });
var ki2 = { ".cm-line": { "& ::selection, &::selection": { backgroundColor: "transparent !important" } }, ".cm-content": { "& :focus": { caretColor: "initial !important", "&::selection, & ::selection": { backgroundColor: "Highlight !important" } } } };
Wn2 && (ki2[".cm-line"].caretColor = ki2[".cm-content"].caretColor = "transparent !important");
var Sr2 = ht.highest(A3.theme(ki2));
var In2 = v.define({ map(s212, t8) {
  return s212 == null ? null : t8.mapPos(s212);
} });
var Ht2 = z.define({ create() {
  return null;
}, update(s212, t8) {
  return s212 != null && (s212 = t8.changes.mapPos(s212)), t8.effects.reduce((e7, i12) => i12.is(In2) ? i12.value : e7, s212);
} });
var Cr2 = N3.fromClass(class {
  constructor(s212) {
    this.view = s212, this.cursor = null, this.measureReq = { read: this.readPos.bind(this), write: this.drawCursor.bind(this) };
  }
  update(s212) {
    var t8;
    let e7 = s212.state.field(Ht2);
    e7 == null ? this.cursor != null && ((t8 = this.cursor) === null || t8 === void 0 || t8.remove(), this.cursor = null) : (this.cursor || (this.cursor = this.view.scrollDOM.appendChild(document.createElement("div")), this.cursor.className = "cm-dropCursor"), (s212.startState.field(Ht2) != e7 || s212.docChanged || s212.geometryChanged) && this.view.requestMeasure(this.measureReq));
  }
  readPos() {
    let { view: s212 } = this, t8 = s212.state.field(Ht2), e7 = t8 != null && s212.coordsAtPos(t8);
    if (!e7) return null;
    let i12 = s212.scrollDOM.getBoundingClientRect();
    return { left: e7.left - i12.left + s212.scrollDOM.scrollLeft * s212.scaleX, top: e7.top - i12.top + s212.scrollDOM.scrollTop * s212.scaleY, height: e7.bottom - e7.top };
  }
  drawCursor(s212) {
    if (this.cursor) {
      let { scaleX: t8, scaleY: e7 } = this.view;
      s212 ? (this.cursor.style.left = s212.left / t8 + "px", this.cursor.style.top = s212.top / e7 + "px", this.cursor.style.height = s212.height / e7 + "px") : this.cursor.style.left = "-100000px";
    }
  }
  destroy() {
    this.cursor && this.cursor.remove();
  }
  setDropPos(s212) {
    this.view.state.field(Ht2) != s212 && this.view.dispatch({ effects: In2.of(s212) });
  }
}, { eventObservers: { dragover(s212) {
  this.setDropPos(this.view.posAtCoords({ x: s212.clientX, y: s212.clientY }));
}, dragleave(s212) {
  (s212.target == this.view.contentDOM || !this.view.contentDOM.contains(s212.relatedTarget)) && this.setDropPos(null);
}, dragend() {
  this.setDropPos(null);
}, drop() {
  this.setDropPos(null);
} } });
function Cs2(s212, t8, e7, i12, n14) {
  t8.lastIndex = 0;
  for (let o = s212.iterRange(e7, i12), r2 = e7, l11; !o.next().done; r2 += o.value.length) if (!o.lineBreak) for (; l11 = t8.exec(o.value); ) n14(r2 + l11.index, l11);
}
function Mr(s212, t8) {
  let e7 = s212.visibleRanges;
  if (e7.length == 1 && e7[0].from == s212.viewport.from && e7[0].to == s212.viewport.to) return e7;
  let i12 = [];
  for (let { from: n14, to: o } of e7) n14 = Math.max(s212.state.doc.lineAt(n14).from, n14 - t8), o = Math.min(s212.state.doc.lineAt(o).to, o + t8), i12.length && i12[i12.length - 1].to >= n14 ? i12[i12.length - 1].to = o : i12.push({ from: n14, to: o });
  return i12;
}
var Jt2 = class {
  constructor(t8) {
    let { regexp: e7, decoration: i12, decorate: n14, boundary: o, maxLength: r2 = 1e3 } = t8;
    if (!e7.global) throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");
    if (this.regexp = e7, n14) this.addMatch = (l11, h3, c3, a2) => n14(a2, c3, c3 + l11[0].length, l11, h3);
    else if (typeof i12 == "function") this.addMatch = (l11, h3, c3, a2) => {
      let f6 = i12(l11, h3, c3);
      f6 && a2(c3, c3 + l11[0].length, f6);
    };
    else if (i12) this.addMatch = (l11, h3, c3, a2) => a2(c3, c3 + l11[0].length, i12);
    else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");
    this.boundary = o, this.maxLength = r2;
  }
  createDeco(t8) {
    let e7 = new re(), i12 = e7.add.bind(e7);
    for (let { from: n14, to: o } of Mr(t8, this.maxLength)) Cs2(t8.state.doc, this.regexp, n14, o, (r2, l11) => this.addMatch(l11, t8, r2, i12));
    return e7.finish();
  }
  updateDeco(t8, e7) {
    let i12 = 1e9, n14 = -1;
    return t8.docChanged && t8.changes.iterChanges((o, r2, l11, h3) => {
      h3 > t8.view.viewport.from && l11 < t8.view.viewport.to && (i12 = Math.min(l11, i12), n14 = Math.max(h3, n14));
    }), t8.viewportChanged || n14 - i12 > 1e3 ? this.createDeco(t8.view) : n14 > -1 ? this.updateRange(t8.view, e7.map(t8.changes), i12, n14) : e7;
  }
  updateRange(t8, e7, i12, n14) {
    for (let o of t8.visibleRanges) {
      let r2 = Math.max(o.from, i12), l11 = Math.min(o.to, n14);
      if (l11 > r2) {
        let h3 = t8.state.doc.lineAt(r2), c3 = h3.to < l11 ? t8.state.doc.lineAt(l11) : h3, a2 = Math.max(o.from, h3.from), f6 = Math.min(o.to, c3.to);
        if (this.boundary) {
          for (; r2 > h3.from; r2--) if (this.boundary.test(h3.text[r2 - 1 - h3.from])) {
            a2 = r2;
            break;
          }
          for (; l11 < c3.to; l11++) if (this.boundary.test(c3.text[l11 - c3.from])) {
            f6 = l11;
            break;
          }
        }
        let d4 = [], u3, p3 = (g8, b12, m11) => d4.push(m11.range(g8, b12));
        if (h3 == c3) for (this.regexp.lastIndex = a2 - h3.from; (u3 = this.regexp.exec(h3.text)) && u3.index < f6 - h3.from; ) this.addMatch(u3, t8, u3.index + h3.from, p3);
        else Cs2(t8.state.doc, this.regexp, a2, f6, (g8, b12) => this.addMatch(b12, t8, g8, p3));
        e7 = e7.update({ filterFrom: a2, filterTo: f6, filter: (g8, b12) => g8 < a2 || b12 > f6, add: d4 });
      }
    }
    return e7;
  }
};
var Ai2 = /x/.unicode != null ? "gu" : "g";
var kr2 = new RegExp(`[\0-\b
--ÂŸÂ­Øœâ€‹â€Žâ€\u2028\u2029â€­â€®â¦â§â©\uFEFFï¿¹-ï¿¼]`, Ai2);
var je3 = null;
function Dr() {
  var s212;
  if (je3 == null && typeof document < "u" && document.body) {
    let t8 = document.body.style;
    je3 = ((s212 = t8.tabSize) !== null && s212 !== void 0 ? s212 : t8.MozTabSize) != null;
  }
  return je3 || false;
}
var be4 = y.define({ combine(s212) {
  let t8 = at(s212, { render: null, specialChars: kr2, addSpecialChars: null });
  return (t8.replaceTabs = !Dr()) && (t8.specialChars = new RegExp("	|" + t8.specialChars.source, Ai2)), t8.addSpecialChars && (t8.specialChars = new RegExp(t8.specialChars.source + "|" + t8.addSpecialChars.source, Ai2)), t8;
} });
var ks = N3.fromClass(class {
  constructor() {
    this.height = 1e3, this.attrs = { style: "padding-bottom: 1000px" };
  }
  update(s212) {
    let { view: t8 } = s212, e7 = t8.viewState.editorHeight - t8.defaultLineHeight - t8.documentPadding.top - 0.5;
    e7 >= 0 && e7 != this.height && (this.height = e7, this.attrs = { style: `padding-bottom: ${e7}px` });
  }
});
var Er = R3.line({ class: "cm-activeLine" });
var Lr = N3.fromClass(class {
  constructor(s212) {
    this.decorations = this.getDeco(s212);
  }
  update(s212) {
    (s212.docChanged || s212.selectionSet) && (this.decorations = this.getDeco(s212.view));
  }
  getDeco(s212) {
    let t8 = -1, e7 = [];
    for (let i12 of s212.state.selection.ranges) {
      let n14 = s212.lineBlockAt(i12.head);
      n14.from > t8 && (e7.push(Er.range(n14.from)), t8 = n14.from);
    }
    return R3.set(e7);
  }
}, { decorations: (s212) => s212.decorations });
var Rt2 = "-10000px";
var Le3 = class {
  constructor(t8, e7, i12, n14) {
    this.facet = e7, this.createTooltipView = i12, this.removeTooltipView = n14, this.input = t8.state.facet(e7), this.tooltips = this.input.filter((r2) => r2);
    let o = null;
    this.tooltipViews = this.tooltips.map((r2) => o = i12(r2, o));
  }
  update(t8, e7) {
    var i12;
    let n14 = t8.state.facet(this.facet), o = n14.filter((h3) => h3);
    if (n14 === this.input) {
      for (let h3 of this.tooltipViews) h3.update && h3.update(t8);
      return false;
    }
    let r2 = [], l11 = e7 ? [] : null;
    for (let h3 = 0; h3 < o.length; h3++) {
      let c3 = o[h3], a2 = -1;
      if (c3) {
        for (let f6 = 0; f6 < this.tooltips.length; f6++) {
          let d4 = this.tooltips[f6];
          d4 && d4.create == c3.create && (a2 = f6);
        }
        if (a2 < 0) r2[h3] = this.createTooltipView(c3, h3 ? r2[h3 - 1] : null), l11 && (l11[h3] = !!c3.above);
        else {
          let f6 = r2[h3] = this.tooltipViews[a2];
          l11 && (l11[h3] = e7[a2]), f6.update && f6.update(t8);
        }
      }
    }
    for (let h3 of this.tooltipViews) r2.indexOf(h3) < 0 && (this.removeTooltipView(h3), (i12 = h3.destroy) === null || i12 === void 0 || i12.call(h3));
    return e7 && (l11.forEach((h3, c3) => e7[c3] = h3), e7.length = l11.length), this.input = n14, this.tooltips = o, this.tooltipViews = r2, true;
  }
};
function Fr2(s212) {
  let { win: t8 } = s212;
  return { top: 0, left: 0, bottom: t8.innerHeight, right: t8.innerWidth };
}
var ye4 = y.define({ combine: (s212) => {
  var t8, e7, i12;
  return { position: y4.ios ? "absolute" : ((t8 = s212.find((n14) => n14.position)) === null || t8 === void 0 ? void 0 : t8.position) || "fixed", parent: ((e7 = s212.find((n14) => n14.parent)) === null || e7 === void 0 ? void 0 : e7.parent) || null, tooltipSpace: ((i12 = s212.find((n14) => n14.tooltipSpace)) === null || i12 === void 0 ? void 0 : i12.tooltipSpace) || Fr2 };
} });
var Ds = /* @__PURE__ */ new WeakMap();
var We3 = N3.fromClass(class {
  constructor(s212) {
    this.view = s212, this.above = [], this.inView = true, this.madeAbsolute = false, this.lastTransaction = 0, this.measureTimeout = -1;
    let t8 = s212.state.facet(ye4);
    this.position = t8.position, this.parent = t8.parent, this.classes = s212.themeClasses, this.createContainer(), this.measureReq = { read: this.readMeasure.bind(this), write: this.writeMeasure.bind(this), key: this }, this.resizeObserver = typeof ResizeObserver == "function" ? new ResizeObserver(() => this.measureSoon()) : null, this.manager = new Le3(s212, Kn2, (e7, i12) => this.createTooltip(e7, i12), (e7) => {
      this.resizeObserver && this.resizeObserver.unobserve(e7.dom), e7.dom.remove();
    }), this.above = this.manager.tooltips.map((e7) => !!e7.above), this.intersectionObserver = typeof IntersectionObserver == "function" ? new IntersectionObserver((e7) => {
      Date.now() > this.lastTransaction - 50 && e7.length > 0 && e7[e7.length - 1].intersectionRatio < 1 && this.measureSoon();
    }, { threshold: [1] }) : null, this.observeIntersection(), s212.win.addEventListener("resize", this.measureSoon = this.measureSoon.bind(this)), this.maybeMeasure();
  }
  createContainer() {
    this.parent ? (this.container = document.createElement("div"), this.container.style.position = "relative", this.container.className = this.view.themeClasses, this.parent.appendChild(this.container)) : this.container = this.view.dom;
  }
  observeIntersection() {
    if (this.intersectionObserver) {
      this.intersectionObserver.disconnect();
      for (let s212 of this.manager.tooltipViews) this.intersectionObserver.observe(s212.dom);
    }
  }
  measureSoon() {
    this.measureTimeout < 0 && (this.measureTimeout = setTimeout(() => {
      this.measureTimeout = -1, this.maybeMeasure();
    }, 50));
  }
  update(s212) {
    s212.transactions.length && (this.lastTransaction = Date.now());
    let t8 = this.manager.update(s212, this.above);
    t8 && this.observeIntersection();
    let e7 = t8 || s212.geometryChanged, i12 = s212.state.facet(ye4);
    if (i12.position != this.position && !this.madeAbsolute) {
      this.position = i12.position;
      for (let n14 of this.manager.tooltipViews) n14.dom.style.position = this.position;
      e7 = true;
    }
    if (i12.parent != this.parent) {
      this.parent && this.container.remove(), this.parent = i12.parent, this.createContainer();
      for (let n14 of this.manager.tooltipViews) this.container.appendChild(n14.dom);
      e7 = true;
    } else this.parent && this.view.themeClasses != this.classes && (this.classes = this.container.className = this.view.themeClasses);
    e7 && this.maybeMeasure();
  }
  createTooltip(s212, t8) {
    let e7 = s212.create(this.view), i12 = t8 ? t8.dom : null;
    if (e7.dom.classList.add("cm-tooltip"), s212.arrow && !e7.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")) {
      let n14 = document.createElement("div");
      n14.className = "cm-tooltip-arrow", e7.dom.appendChild(n14);
    }
    return e7.dom.style.position = this.position, e7.dom.style.top = Rt2, e7.dom.style.left = "0px", this.container.insertBefore(e7.dom, i12), e7.mount && e7.mount(this.view), this.resizeObserver && this.resizeObserver.observe(e7.dom), e7;
  }
  destroy() {
    var s212, t8, e7;
    this.view.win.removeEventListener("resize", this.measureSoon);
    for (let i12 of this.manager.tooltipViews) i12.dom.remove(), (s212 = i12.destroy) === null || s212 === void 0 || s212.call(i12);
    this.parent && this.container.remove(), (t8 = this.resizeObserver) === null || t8 === void 0 || t8.disconnect(), (e7 = this.intersectionObserver) === null || e7 === void 0 || e7.disconnect(), clearTimeout(this.measureTimeout);
  }
  readMeasure() {
    let s212 = this.view.dom.getBoundingClientRect(), t8 = 1, e7 = 1, i12 = false;
    if (this.position == "fixed" && this.manager.tooltipViews.length) {
      let { dom: n14 } = this.manager.tooltipViews[0];
      if (y4.gecko) i12 = n14.offsetParent != this.container.ownerDocument.body;
      else if (n14.style.top == Rt2 && n14.style.left == "0px") {
        let o = n14.getBoundingClientRect();
        i12 = Math.abs(o.top + 1e4) > 1 || Math.abs(o.left) > 1;
      }
    }
    if (i12 || this.position == "absolute") if (this.parent) {
      let n14 = this.parent.getBoundingClientRect();
      n14.width && n14.height && (t8 = n14.width / this.parent.offsetWidth, e7 = n14.height / this.parent.offsetHeight);
    } else ({ scaleX: t8, scaleY: e7 } = this.view.viewState);
    return { editor: s212, parent: this.parent ? this.container.getBoundingClientRect() : s212, pos: this.manager.tooltips.map((n14, o) => {
      let r2 = this.manager.tooltipViews[o];
      return r2.getCoords ? r2.getCoords(n14.pos) : this.view.coordsAtPos(n14.pos);
    }), size: this.manager.tooltipViews.map(({ dom: n14 }) => n14.getBoundingClientRect()), space: this.view.state.facet(ye4).tooltipSpace(this.view), scaleX: t8, scaleY: e7, makeAbsolute: i12 };
  }
  writeMeasure(s212) {
    var t8;
    if (s212.makeAbsolute) {
      this.madeAbsolute = true, this.position = "absolute";
      for (let l11 of this.manager.tooltipViews) l11.dom.style.position = "absolute";
    }
    let { editor: e7, space: i12, scaleX: n14, scaleY: o } = s212, r2 = [];
    for (let l11 = 0; l11 < this.manager.tooltips.length; l11++) {
      let h3 = this.manager.tooltips[l11], c3 = this.manager.tooltipViews[l11], { dom: a2 } = c3, f6 = s212.pos[l11], d4 = s212.size[l11];
      if (!f6 || f6.bottom <= Math.max(e7.top, i12.top) || f6.top >= Math.min(e7.bottom, i12.bottom) || f6.right < Math.max(e7.left, i12.left) - 0.1 || f6.left > Math.min(e7.right, i12.right) + 0.1) {
        a2.style.top = Rt2;
        continue;
      }
      let u3 = h3.arrow ? c3.dom.querySelector(".cm-tooltip-arrow") : null, p3 = u3 ? 7 : 0, g8 = d4.right - d4.left, b12 = (t8 = Ds.get(c3)) !== null && t8 !== void 0 ? t8 : d4.bottom - d4.top, m11 = c3.offset || zr2, w14 = this.view.textDirection == L3.LTR, v10 = d4.width > i12.right - i12.left ? w14 ? i12.left : i12.right - d4.width : w14 ? Math.max(i12.left, Math.min(f6.left - (u3 ? 14 : 0) + m11.x, i12.right - g8)) : Math.min(Math.max(i12.left, f6.left - g8 + (u3 ? 14 : 0) - m11.x), i12.right - g8), x11 = this.above[l11];
      !h3.strictSide && (x11 ? f6.top - (d4.bottom - d4.top) - m11.y < i12.top : f6.bottom + (d4.bottom - d4.top) + m11.y > i12.bottom) && x11 == i12.bottom - f6.bottom > f6.top - i12.top && (x11 = this.above[l11] = !x11);
      let S17 = (x11 ? f6.top - i12.top : i12.bottom - f6.bottom) - p3;
      if (S17 < b12 && c3.resize !== false) {
        if (S17 < this.view.defaultLineHeight) {
          a2.style.top = Rt2;
          continue;
        }
        Ds.set(c3, b12), a2.style.height = (b12 = S17) / o + "px";
      } else a2.style.height && (a2.style.height = "");
      let C11 = x11 ? f6.top - b12 - p3 - m11.y : f6.bottom + p3 + m11.y, E11 = v10 + g8;
      if (c3.overlap !== true) for (let B15 of r2) B15.left < E11 && B15.right > v10 && B15.top < C11 + b12 && B15.bottom > C11 && (C11 = x11 ? B15.top - b12 - 2 - p3 : B15.bottom + p3 + 2);
      if (this.position == "absolute" ? (a2.style.top = (C11 - s212.parent.top) / o + "px", a2.style.left = (v10 - s212.parent.left) / n14 + "px") : (a2.style.top = C11 / o + "px", a2.style.left = v10 / n14 + "px"), u3) {
        let B15 = f6.left + (w14 ? m11.x : -m11.x) - (v10 + 14 - 7);
        u3.style.left = B15 / n14 + "px";
      }
      c3.overlap !== true && r2.push({ left: v10, top: C11, right: E11, bottom: C11 + b12 }), a2.classList.toggle("cm-tooltip-above", x11), a2.classList.toggle("cm-tooltip-below", !x11), c3.positioned && c3.positioned(s212.space);
    }
  }
  maybeMeasure() {
    if (this.manager.tooltips.length && (this.view.inView && this.view.requestMeasure(this.measureReq), this.inView != this.view.inView && (this.inView = this.view.inView, !this.inView))) for (let s212 of this.manager.tooltipViews) s212.dom.style.top = Rt2;
  }
}, { eventObservers: { scroll() {
  this.maybeMeasure();
} } });
var Wr2 = A3.baseTheme({ ".cm-tooltip": { zIndex: 100, boxSizing: "border-box" }, "&light .cm-tooltip": { border: "1px solid #bbb", backgroundColor: "#f5f5f5" }, "&light .cm-tooltip-section:not(:first-child)": { borderTop: "1px solid #bbb" }, "&dark .cm-tooltip": { backgroundColor: "#333338", color: "white" }, ".cm-tooltip-arrow": { height: "7px", width: `${7 * 2}px`, position: "absolute", zIndex: -1, overflow: "hidden", "&:before, &:after": { content: "''", position: "absolute", width: 0, height: 0, borderLeft: "7px solid transparent", borderRight: "7px solid transparent" }, ".cm-tooltip-above &": { bottom: "-7px", "&:before": { borderTop: "7px solid #bbb" }, "&:after": { borderTop: "7px solid #f5f5f5", bottom: "1px" } }, ".cm-tooltip-below &": { top: "-7px", "&:before": { borderBottom: "7px solid #bbb" }, "&:after": { borderBottom: "7px solid #f5f5f5", top: "1px" } } }, "&dark .cm-tooltip .cm-tooltip-arrow": { "&:before": { borderTopColor: "#333338", borderBottomColor: "#333338" }, "&:after": { borderTopColor: "transparent", borderBottomColor: "transparent" } } });
var zr2 = { x: 0, y: 0 };
var Kn2 = y.define({ enables: [We3, Wr2] });
var Zt2 = y.define({ combine: (s212) => s212.reduce((t8, e7) => t8.concat(e7), []) });
var Be4 = class s79 {
  static create(t8) {
    return new s79(t8);
  }
  constructor(t8) {
    this.view = t8, this.mounted = false, this.dom = document.createElement("div"), this.dom.classList.add("cm-tooltip-hover"), this.manager = new Le3(t8, Zt2, (e7, i12) => this.createHostedView(e7, i12), (e7) => e7.dom.remove());
  }
  createHostedView(t8, e7) {
    let i12 = t8.create(this.view);
    return i12.dom.classList.add("cm-tooltip-section"), this.dom.insertBefore(i12.dom, e7 ? e7.dom.nextSibling : this.dom.firstChild), this.mounted && i12.mount && i12.mount(this.view), i12;
  }
  mount(t8) {
    for (let e7 of this.manager.tooltipViews) e7.mount && e7.mount(t8);
    this.mounted = true;
  }
  positioned(t8) {
    for (let e7 of this.manager.tooltipViews) e7.positioned && e7.positioned(t8);
  }
  update(t8) {
    this.manager.update(t8);
  }
  destroy() {
    var t8;
    for (let e7 of this.manager.tooltipViews) (t8 = e7.destroy) === null || t8 === void 0 || t8.call(e7);
  }
  passProp(t8) {
    let e7;
    for (let i12 of this.manager.tooltipViews) {
      let n14 = i12[t8];
      if (n14 !== void 0) {
        if (e7 === void 0) e7 = n14;
        else if (e7 !== n14) return;
      }
    }
    return e7;
  }
  get offset() {
    return this.passProp("offset");
  }
  get getCoords() {
    return this.passProp("getCoords");
  }
  get overlap() {
    return this.passProp("overlap");
  }
  get resize() {
    return this.passProp("resize");
  }
};
var Ir2 = Kn2.compute([Zt2], (s212) => {
  let t8 = s212.facet(Zt2);
  return t8.length === 0 ? null : { pos: Math.min(...t8.map((e7) => e7.pos)), end: Math.max(...t8.map((e7) => {
    var i12;
    return (i12 = e7.end) !== null && i12 !== void 0 ? i12 : e7.pos;
  })), create: Be4.create, above: t8[0].above, arrow: t8.some((e7) => e7.arrow) };
});
var qn2 = v.define();
var xl = qn2.of(null);
var Li2 = y.define({ combine(s212) {
  let t8, e7;
  for (let i12 of s212) t8 = t8 || i12.topContainer, e7 = e7 || i12.bottomContainer;
  return { topContainer: t8, bottomContainer: e7 };
} });
var jn2 = N3.fromClass(class {
  constructor(s212) {
    this.input = s212.state.facet(Ts2), this.specs = this.input.filter((e7) => e7), this.panels = this.specs.map((e7) => e7(s212));
    let t8 = s212.state.facet(Li2);
    this.top = new vt2(s212, true, t8.topContainer), this.bottom = new vt2(s212, false, t8.bottomContainer), this.top.sync(this.panels.filter((e7) => e7.top)), this.bottom.sync(this.panels.filter((e7) => !e7.top));
    for (let e7 of this.panels) e7.dom.classList.add("cm-panel"), e7.mount && e7.mount();
  }
  update(s212) {
    let t8 = s212.state.facet(Li2);
    this.top.container != t8.topContainer && (this.top.sync([]), this.top = new vt2(s212.view, true, t8.topContainer)), this.bottom.container != t8.bottomContainer && (this.bottom.sync([]), this.bottom = new vt2(s212.view, false, t8.bottomContainer)), this.top.syncClasses(), this.bottom.syncClasses();
    let e7 = s212.state.facet(Ts2);
    if (e7 != this.input) {
      let i12 = e7.filter((h3) => h3), n14 = [], o = [], r2 = [], l11 = [];
      for (let h3 of i12) {
        let c3 = this.specs.indexOf(h3), a2;
        c3 < 0 ? (a2 = h3(s212.view), l11.push(a2)) : (a2 = this.panels[c3], a2.update && a2.update(s212)), n14.push(a2), (a2.top ? o : r2).push(a2);
      }
      this.specs = i12, this.panels = n14, this.top.sync(o), this.bottom.sync(r2);
      for (let h3 of l11) h3.dom.classList.add("cm-panel"), h3.mount && h3.mount();
    } else for (let i12 of this.panels) i12.update && i12.update(s212);
  }
  destroy() {
    this.top.sync([]), this.bottom.sync([]);
  }
}, { provide: (s212) => A3.scrollMargins.of((t8) => {
  let e7 = t8.plugin(s212);
  return e7 && { top: e7.top.scrollMargin(), bottom: e7.bottom.scrollMargin() };
}) });
var vt2 = class {
  constructor(t8, e7, i12) {
    this.view = t8, this.top = e7, this.container = i12, this.dom = void 0, this.classes = "", this.panels = [], this.syncClasses();
  }
  sync(t8) {
    for (let e7 of this.panels) e7.destroy && t8.indexOf(e7) < 0 && e7.destroy();
    this.panels = t8, this.syncDOM();
  }
  syncDOM() {
    if (this.panels.length == 0) {
      this.dom && (this.dom.remove(), this.dom = void 0);
      return;
    }
    if (!this.dom) {
      this.dom = document.createElement("div"), this.dom.className = this.top ? "cm-panels cm-panels-top" : "cm-panels cm-panels-bottom", this.dom.style[this.top ? "top" : "bottom"] = "0";
      let e7 = this.container || this.view.dom;
      e7.insertBefore(this.dom, this.top ? e7.firstChild : null);
    }
    let t8 = this.dom.firstChild;
    for (let e7 of this.panels) if (e7.dom.parentNode == this.dom) {
      for (; t8 != e7.dom; ) t8 = Os2(t8);
      t8 = t8.nextSibling;
    } else this.dom.insertBefore(e7.dom, t8);
    for (; t8; ) t8 = Os2(t8);
  }
  scrollMargin() {
    return !this.dom || this.container ? 0 : Math.max(0, this.top ? this.dom.getBoundingClientRect().bottom - Math.max(0, this.view.scrollDOM.getBoundingClientRect().top) : Math.min(innerHeight, this.view.scrollDOM.getBoundingClientRect().bottom) - this.dom.getBoundingClientRect().top);
  }
  syncClasses() {
    if (!(!this.container || this.classes == this.view.themeClasses)) {
      for (let t8 of this.classes.split(" ")) t8 && this.container.classList.remove(t8);
      for (let t8 of (this.classes = this.view.themeClasses).split(" ")) t8 && this.container.classList.add(t8);
    }
  }
};
function Os2(s212) {
  let t8 = s212.nextSibling;
  return s212.remove(), t8;
}
var Ts2 = y.define({ enables: jn2 });
var Q4 = class extends W {
  compare(t8) {
    return this == t8 || this.constructor == t8.constructor && this.eq(t8);
  }
  eq(t8) {
    return false;
  }
  destroy(t8) {
  }
};
Q4.prototype.elementClass = "";
Q4.prototype.toDOM = void 0;
Q4.prototype.mapMode = E.TrackBefore;
Q4.prototype.startSide = Q4.prototype.endSide = -1;
Q4.prototype.point = true;
var we4 = y.define();
var jr2 = y.define();
var Kt2 = y.define();
var Bi2 = y.define({ combine: (s212) => s212.some((t8) => t8) });
var _r2 = N3.fromClass(class {
  constructor(s212) {
    this.view = s212, this.prevViewport = s212.viewport, this.dom = document.createElement("div"), this.dom.className = "cm-gutters", this.dom.setAttribute("aria-hidden", "true"), this.dom.style.minHeight = this.view.contentHeight / this.view.scaleY + "px", this.gutters = s212.state.facet(Kt2).map((t8) => new Pe4(s212, t8));
    for (let t8 of this.gutters) this.dom.appendChild(t8.dom);
    this.fixed = !s212.state.facet(Bi2), this.fixed && (this.dom.style.position = "sticky"), this.syncGutters(false), s212.scrollDOM.insertBefore(this.dom, s212.contentDOM);
  }
  update(s212) {
    if (this.updateGutters(s212)) {
      let t8 = this.prevViewport, e7 = s212.view.viewport, i12 = Math.min(t8.to, e7.to) - Math.max(t8.from, e7.from);
      this.syncGutters(i12 < (e7.to - e7.from) * 0.8);
    }
    s212.geometryChanged && (this.dom.style.minHeight = this.view.contentHeight / this.view.scaleY + "px"), this.view.state.facet(Bi2) != !this.fixed && (this.fixed = !this.fixed, this.dom.style.position = this.fixed ? "sticky" : ""), this.prevViewport = s212.view.viewport;
  }
  syncGutters(s212) {
    let t8 = this.dom.nextSibling;
    s212 && this.dom.remove();
    let e7 = T.iter(this.view.state.facet(we4), this.view.viewport.from), i12 = [], n14 = this.gutters.map((o) => new Hi2(o, this.view.viewport, -this.view.documentPadding.top));
    for (let o of this.view.viewportLineBlocks) if (i12.length && (i12 = []), Array.isArray(o.type)) {
      let r2 = true;
      for (let l11 of o.type) if (l11.type == F4.Text && r2) {
        Pi2(e7, i12, l11.from);
        for (let h3 of n14) h3.line(this.view, l11, i12);
        r2 = false;
      } else if (l11.widget) for (let h3 of n14) h3.widget(this.view, l11);
    } else if (o.type == F4.Text) {
      Pi2(e7, i12, o.from);
      for (let r2 of n14) r2.line(this.view, o, i12);
    } else if (o.widget) for (let r2 of n14) r2.widget(this.view, o);
    for (let o of n14) o.finish();
    s212 && this.view.scrollDOM.insertBefore(this.dom, t8);
  }
  updateGutters(s212) {
    let t8 = s212.startState.facet(Kt2), e7 = s212.state.facet(Kt2), i12 = s212.docChanged || s212.heightChanged || s212.viewportChanged || !T.eq(s212.startState.facet(we4), s212.state.facet(we4), s212.view.viewport.from, s212.view.viewport.to);
    if (t8 == e7) for (let n14 of this.gutters) n14.update(s212) && (i12 = true);
    else {
      i12 = true;
      let n14 = [];
      for (let o of e7) {
        let r2 = t8.indexOf(o);
        r2 < 0 ? n14.push(new Pe4(this.view, o)) : (this.gutters[r2].update(s212), n14.push(this.gutters[r2]));
      }
      for (let o of this.gutters) o.dom.remove(), n14.indexOf(o) < 0 && o.destroy();
      for (let o of n14) this.dom.appendChild(o.dom);
      this.gutters = n14;
    }
    return i12;
  }
  destroy() {
    for (let s212 of this.gutters) s212.destroy();
    this.dom.remove();
  }
}, { provide: (s212) => A3.scrollMargins.of((t8) => {
  let e7 = t8.plugin(s212);
  return !e7 || e7.gutters.length == 0 || !e7.fixed ? null : t8.textDirection == L3.LTR ? { left: e7.dom.offsetWidth * t8.scaleX } : { right: e7.dom.offsetWidth * t8.scaleX };
}) });
function Rs2(s212) {
  return Array.isArray(s212) ? s212 : [s212];
}
function Pi2(s212, t8, e7) {
  for (; s212.value && s212.from <= e7; ) s212.from == e7 && t8.push(s212.value), s212.next();
}
var Hi2 = class {
  constructor(t8, e7, i12) {
    this.gutter = t8, this.height = i12, this.i = 0, this.cursor = T.iter(t8.markers, e7.from);
  }
  addElement(t8, e7, i12) {
    let { gutter: n14 } = this, o = (e7.top - this.height) / t8.scaleY, r2 = e7.height / t8.scaleY;
    if (this.i == n14.elements.length) {
      let l11 = new He3(t8, r2, o, i12);
      n14.elements.push(l11), n14.dom.appendChild(l11.dom);
    } else n14.elements[this.i].update(t8, r2, o, i12);
    this.height = e7.bottom, this.i++;
  }
  line(t8, e7, i12) {
    let n14 = [];
    Pi2(this.cursor, n14, e7.from), i12.length && (n14 = n14.concat(i12));
    let o = this.gutter.config.lineMarker(t8, e7, n14);
    o && n14.unshift(o);
    let r2 = this.gutter;
    n14.length == 0 && !r2.config.renderEmptyElements || this.addElement(t8, e7, n14);
  }
  widget(t8, e7) {
    let i12 = this.gutter.config.widgetMarker(t8, e7.widget, e7), n14 = i12 ? [i12] : null;
    for (let o of t8.state.facet(jr2)) {
      let r2 = o(t8, e7.widget, e7);
      r2 && (n14 || (n14 = [])).push(r2);
    }
    n14 && this.addElement(t8, e7, n14);
  }
  finish() {
    let t8 = this.gutter;
    for (; t8.elements.length > this.i; ) {
      let e7 = t8.elements.pop();
      t8.dom.removeChild(e7.dom), e7.destroy();
    }
  }
};
var Pe4 = class {
  constructor(t8, e7) {
    this.view = t8, this.config = e7, this.elements = [], this.spacer = null, this.dom = document.createElement("div"), this.dom.className = "cm-gutter" + (this.config.class ? " " + this.config.class : "");
    for (let i12 in e7.domEventHandlers) this.dom.addEventListener(i12, (n14) => {
      let o = n14.target, r2;
      if (o != this.dom && this.dom.contains(o)) {
        for (; o.parentNode != this.dom; ) o = o.parentNode;
        let h3 = o.getBoundingClientRect();
        r2 = (h3.top + h3.bottom) / 2;
      } else r2 = n14.clientY;
      let l11 = t8.lineBlockAtHeight(r2 - t8.documentTop);
      e7.domEventHandlers[i12](t8, l11, n14) && n14.preventDefault();
    });
    this.markers = Rs2(e7.markers(t8)), e7.initialSpacer && (this.spacer = new He3(t8, 0, 0, [e7.initialSpacer(t8)]), this.dom.appendChild(this.spacer.dom), this.spacer.dom.style.cssText += "visibility: hidden; pointer-events: none");
  }
  update(t8) {
    let e7 = this.markers;
    if (this.markers = Rs2(this.config.markers(t8.view)), this.spacer && this.config.updateSpacer) {
      let n14 = this.config.updateSpacer(this.spacer.markers[0], t8);
      n14 != this.spacer.markers[0] && this.spacer.update(t8.view, 0, 0, [n14]);
    }
    let i12 = t8.view.viewport;
    return !T.eq(this.markers, e7, i12.from, i12.to) || (this.config.lineMarkerChange ? this.config.lineMarkerChange(t8) : false);
  }
  destroy() {
    for (let t8 of this.elements) t8.destroy();
  }
};
var He3 = class {
  constructor(t8, e7, i12, n14) {
    this.height = -1, this.above = 0, this.markers = [], this.dom = document.createElement("div"), this.dom.className = "cm-gutterElement", this.update(t8, e7, i12, n14);
  }
  update(t8, e7, i12, n14) {
    this.height != e7 && (this.height = e7, this.dom.style.height = e7 + "px"), this.above != i12 && (this.dom.style.marginTop = (this.above = i12) ? i12 + "px" : ""), Xr2(this.markers, n14) || this.setMarkers(t8, n14);
  }
  setMarkers(t8, e7) {
    let i12 = "cm-gutterElement", n14 = this.dom.firstChild;
    for (let o = 0, r2 = 0; ; ) {
      let l11 = r2, h3 = o < e7.length ? e7[o++] : null, c3 = false;
      if (h3) {
        let a2 = h3.elementClass;
        a2 && (i12 += " " + a2);
        for (let f6 = r2; f6 < this.markers.length; f6++) if (this.markers[f6].compare(h3)) {
          l11 = f6, c3 = true;
          break;
        }
      } else l11 = this.markers.length;
      for (; r2 < l11; ) {
        let a2 = this.markers[r2++];
        if (a2.toDOM) {
          a2.destroy(n14);
          let f6 = n14.nextSibling;
          n14.remove(), n14 = f6;
        }
      }
      if (!h3) break;
      h3.toDOM && (c3 ? n14 = n14.nextSibling : this.dom.insertBefore(h3.toDOM(t8), n14)), c3 && r2++;
    }
    this.dom.className = i12, this.markers = e7;
  }
  destroy() {
    this.setMarkers(null, []);
  }
};
function Xr2(s212, t8) {
  if (s212.length != t8.length) return false;
  for (let e7 = 0; e7 < s212.length; e7++) if (!s212[e7].compare(t8[e7])) return false;
  return true;
}
var Gr2 = y.define();
var $r2 = y.define();
var St2 = y.define({ combine(s212) {
  return at(s212, { formatNumber: String, domEventHandlers: {} }, { domEventHandlers(t8, e7) {
    let i12 = Object.assign({}, t8);
    for (let n14 in e7) {
      let o = i12[n14], r2 = e7[n14];
      i12[n14] = o ? (l11, h3, c3) => o(l11, h3, c3) || r2(l11, h3, c3) : r2;
    }
    return i12;
  } });
} });
var qt2 = class extends Q4 {
  constructor(t8) {
    super(), this.number = t8;
  }
  eq(t8) {
    return this.number == t8.number;
  }
  toDOM() {
    return document.createTextNode(this.number);
  }
};
function Ye3(s212, t8) {
  return s212.state.facet(St2).formatNumber(t8, s212.state);
}
var Ur2 = Kt2.compute([St2], (s212) => ({ class: "cm-lineNumbers", renderEmptyElements: false, markers(t8) {
  return t8.state.facet(Gr2);
}, lineMarker(t8, e7, i12) {
  return i12.some((n14) => n14.toDOM) ? null : new qt2(Ye3(t8, t8.state.doc.lineAt(e7.from).number));
}, widgetMarker: (t8, e7, i12) => {
  for (let n14 of t8.state.facet($r2)) {
    let o = n14(t8, e7, i12);
    if (o) return o;
  }
  return null;
}, lineMarkerChange: (t8) => t8.startState.facet(St2) != t8.state.facet(St2), initialSpacer(t8) {
  return new qt2(Ye3(t8, Es2(t8.state.doc.lines)));
}, updateSpacer(t8, e7) {
  let i12 = Ye3(e7.view, Es2(e7.view.state.doc.lines));
  return i12 == t8.number ? t8 : new qt2(i12);
}, domEventHandlers: s212.facet(St2).domEventHandlers }));
function Es2(s212) {
  let t8 = 9;
  for (; t8 < s212; ) t8 = t8 * 10 + 9;
  return t8;
}
var Qr2 = new class extends Q4 {
  constructor() {
    super(...arguments), this.elementClass = "cm-activeLineGutter";
  }
}();
var Jr2 = we4.compute(["selection"], (s212) => {
  let t8 = [], e7 = -1;
  for (let i12 of s212.selection.ranges) {
    let n14 = s212.doc.lineAt(i12.head).from;
    n14 > e7 && (e7 = n14, t8.push(Qr2.range(n14)));
  }
  return T.of(t8);
});
var Ls2 = /* @__PURE__ */ new Map();
function Zr2(s212) {
  let t8 = Ls2.get(s212);
  return t8 || Ls2.set(s212, t8 = R3.mark({ attributes: s212 === "	" ? { class: "cm-highlightTab" } : { class: "cm-highlightSpace", "data-display": s212.replace(/ /g, "Â·") } })), t8;
}
function _n(s212) {
  return N3.define((t8) => ({ decorations: s212.createDeco(t8), update(e7) {
    this.decorations = s212.updateDeco(e7, this.decorations);
  } }), { decorations: (t8) => t8.decorations });
}
var tl2 = _n(new Jt2({ regexp: /\t| +/g, decoration: (s212) => Zr2(s212[0]), boundary: /\S/ }));
var el = _n(new Jt2({ regexp: /\s+$/g, decoration: R3.mark({ class: "cm-trailingSpace" }), boundary: /\S/ }));

// https://esm.sh/v135/@lezer/highlight@1.2.1/denonext/highlight.mjs
var G5 = 0;
var p = class s80 {
  constructor(t8, a2, i12, n14) {
    this.name = t8, this.set = a2, this.base = i12, this.modified = n14, this.id = G5++;
  }
  toString() {
    let { name: t8 } = this;
    for (let a2 of this.modified) a2.name && (t8 = `${a2.name}(${t8})`);
    return t8;
  }
  static define(t8, a2) {
    let i12 = typeof t8 == "string" ? t8 : "?";
    if (t8 instanceof s80 && (a2 = t8), a2?.base) throw new Error("Can not derive from a modified tag");
    let n14 = new s80(i12, [], null, []);
    if (n14.set.push(n14), a2) for (let o of a2.set) n14.set.push(o);
    return n14;
  }
  static defineModifier(t8) {
    let a2 = new E2(t8);
    return (i12) => i12.modified.indexOf(a2) > -1 ? i12 : E2.get(i12.base || i12, i12.modified.concat(a2).sort((n14, o) => n14.id - o.id));
  }
};
var L4 = 0;
var E2 = class s81 {
  constructor(t8) {
    this.name = t8, this.instances = [], this.id = L4++;
  }
  static get(t8, a2) {
    if (!a2.length) return t8;
    let i12 = a2[0].instances.find((r2) => r2.base == t8 && P4(a2, r2.modified));
    if (i12) return i12;
    let n14 = [], o = new p(t8.name, n14, t8, a2);
    for (let r2 of a2) r2.instances.push(o);
    let g8 = Q5(a2);
    for (let r2 of t8.set) if (!r2.modified.length) for (let d4 of g8) n14.push(s81.get(r2, d4));
    return o;
  }
};
function P4(s212, t8) {
  return s212.length == t8.length && s212.every((a2, i12) => a2 == t8[i12]);
}
function Q5(s212) {
  let t8 = [[]];
  for (let a2 = 0; a2 < s212.length; a2++) for (let i12 = 0, n14 = t8.length; i12 < n14; i12++) t8.push(t8[i12].concat(s212[a2]));
  return t8.sort((a2, i12) => i12.length - a2.length);
}
function _4(s212) {
  let t8 = /* @__PURE__ */ Object.create(null);
  for (let a2 in s212) {
    let i12 = s212[a2];
    Array.isArray(i12) || (i12 = [i12]);
    for (let n14 of a2.split(" ")) if (n14) {
      let o = [], g8 = 2, r2 = n14;
      for (let h3 = 0; ; ) {
        if (r2 == "..." && h3 > 0 && h3 + 3 == n14.length) {
          g8 = 1;
          break;
        }
        let f6 = /^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(r2);
        if (!f6) throw new RangeError("Invalid path: " + n14);
        if (o.push(f6[0] == "*" ? "" : f6[0][0] == '"' ? JSON.parse(f6[0]) : f6[0]), h3 += f6[0].length, h3 == n14.length) break;
        let m11 = n14[h3++];
        if (h3 == n14.length && m11 == "!") {
          g8 = 0;
          break;
        }
        if (m11 != "/") throw new RangeError("Invalid path: " + n14);
        r2 = n14.slice(h3);
      }
      let d4 = o.length - 1, c3 = o[d4];
      if (!c3) throw new RangeError("Invalid path: " + n14);
      let b12 = new M2(i12, g8, d4 > 0 ? o.slice(0, d4) : null);
      t8[c3] = b12.sort(t8[c3]);
    }
  }
  return z5.add(t8);
}
var z5 = new v2();
var M2 = class {
  constructor(t8, a2, i12, n14) {
    this.tags = t8, this.mode = a2, this.context = i12, this.next = n14;
  }
  get opaque() {
    return this.mode == 0;
  }
  get inherit() {
    return this.mode == 1;
  }
  sort(t8) {
    return !t8 || t8.depth < this.depth ? (this.next = t8, this) : (t8.next = this.sort(t8.next), t8);
  }
  get depth() {
    return this.context ? this.context.length : 0;
  }
};
M2.empty = new M2([], 2, null);
function U5(s212, t8) {
  let a2 = /* @__PURE__ */ Object.create(null);
  for (let o of s212) if (!Array.isArray(o.tag)) a2[o.tag.id] = o.class;
  else for (let g8 of o.tag) a2[g8.id] = o.class;
  let { scope: i12, all: n14 = null } = t8 || {};
  return { style: (o) => {
    let g8 = n14;
    for (let r2 of o) for (let d4 of r2.set) {
      let c3 = a2[d4.id];
      if (c3) {
        g8 = g8 ? g8 + " " + c3 : c3;
        break;
      }
    }
    return g8;
  }, scope: i12 };
}
function W4(s212, t8) {
  let a2 = null;
  for (let i12 of s212) {
    let n14 = i12.style(t8);
    n14 && (a2 = a2 ? a2 + " " + n14 : n14);
  }
  return a2;
}
function X4(s212, t8, a2, i12 = 0, n14 = s212.length) {
  let o = new B2(i12, Array.isArray(t8) ? t8 : [t8], a2);
  o.highlightRange(s212.cursor(), i12, n14, "", o.highlighters), o.flush(n14);
}
var B2 = class {
  constructor(t8, a2, i12) {
    this.at = t8, this.highlighters = a2, this.span = i12, this.class = "";
  }
  startSpan(t8, a2) {
    a2 != this.class && (this.flush(t8), t8 > this.at && (this.at = t8), this.class = a2);
  }
  flush(t8) {
    t8 > this.at && this.class && this.span(this.at, t8, this.class);
  }
  highlightRange(t8, a2, i12, n14, o) {
    let { type: g8, from: r2, to: d4 } = t8;
    if (r2 >= i12 || d4 <= a2) return;
    g8.isTop && (o = this.highlighters.filter((m11) => !m11.scope || m11.scope(g8)));
    let c3 = n14, b12 = Y5(t8) || M2.empty, h3 = W4(o, b12.tags);
    if (h3 && (c3 && (c3 += " "), c3 += h3, b12.mode == 1 && (n14 += (n14 ? " " : "") + h3)), this.startSpan(Math.max(a2, r2), c3), b12.opaque) return;
    let f6 = t8.tree && t8.tree.prop(v2.mounted);
    if (f6 && f6.overlay) {
      let m11 = t8.node.enter(f6.overlay[0].from + r2, 1), R19 = this.highlighters.filter((v10) => !v10.scope || v10.scope(f6.tree.type)), H12 = t8.firstChild();
      for (let v10 = 0, S17 = r2; ; v10++) {
        let O18 = v10 < f6.overlay.length ? f6.overlay[v10] : null, K16 = O18 ? O18.from + r2 : d4, $18 = Math.max(a2, S17), T22 = Math.min(i12, K16);
        if ($18 < T22 && H12) for (; t8.from < T22 && (this.highlightRange(t8, $18, T22, n14, o), this.startSpan(Math.min(T22, t8.to), c3), !(t8.to >= K16 || !t8.nextSibling())); ) ;
        if (!O18 || K16 > i12) break;
        S17 = O18.to + r2, S17 > a2 && (this.highlightRange(m11.cursor(), Math.max(a2, O18.from + r2), Math.min(i12, S17), "", R19), this.startSpan(Math.min(i12, S17), c3));
      }
      H12 && t8.parent();
    } else if (t8.firstChild()) {
      f6 && (n14 = "");
      do
        if (!(t8.to <= a2)) {
          if (t8.from >= i12) break;
          this.highlightRange(t8, a2, i12, n14, o), this.startSpan(Math.min(i12, t8.to), c3);
        }
      while (t8.nextSibling());
      t8.parent();
    }
  }
};
function Y5(s212) {
  let t8 = s212.type.prop(z5);
  for (; t8 && t8.context && !s212.matchContext(t8.context); ) t8 = t8.next;
  return t8 || null;
}
var e = p.define;
var C2 = e();
var N4 = e();
var F5 = e(N4);
var J3 = e(N4);
var x3 = e();
var I4 = e(x3);
var j4 = e(x3);
var y5 = e();
var w3 = e(y5);
var u = e();
var k2 = e();
var D4 = e();
var A4 = e(D4);
var q2 = e();
var l = { comment: C2, lineComment: e(C2), blockComment: e(C2), docComment: e(C2), name: N4, variableName: e(N4), typeName: F5, tagName: e(F5), propertyName: J3, attributeName: e(J3), className: e(N4), labelName: e(N4), namespace: e(N4), macroName: e(N4), literal: x3, string: I4, docString: e(I4), character: e(I4), attributeValue: e(I4), number: j4, integer: e(j4), float: e(j4), bool: e(x3), regexp: e(x3), escape: e(x3), color: e(x3), url: e(x3), keyword: u, self: e(u), null: e(u), atom: e(u), unit: e(u), modifier: e(u), operatorKeyword: e(u), controlKeyword: e(u), definitionKeyword: e(u), moduleKeyword: e(u), operator: k2, derefOperator: e(k2), arithmeticOperator: e(k2), logicOperator: e(k2), bitwiseOperator: e(k2), compareOperator: e(k2), updateOperator: e(k2), definitionOperator: e(k2), typeOperator: e(k2), controlOperator: e(k2), punctuation: D4, separator: e(D4), bracket: A4, angleBracket: e(A4), squareBracket: e(A4), paren: e(A4), brace: e(A4), content: y5, heading: w3, heading1: e(w3), heading2: e(w3), heading3: e(w3), heading4: e(w3), heading5: e(w3), heading6: e(w3), contentSeparator: e(y5), list: e(y5), quote: e(y5), emphasis: e(y5), strong: e(y5), link: e(y5), monospace: e(y5), strikethrough: e(y5), inserted: e(), deleted: e(), changed: e(), invalid: e(), meta: q2, documentMeta: e(q2), annotation: e(q2), processingInstruction: e(q2), definition: p.defineModifier("definition"), constant: p.defineModifier("constant"), function: p.defineModifier("function"), standard: p.defineModifier("standard"), local: p.defineModifier("local"), special: p.defineModifier("special") };
for (let s212 in l) {
  let t8 = l[s212];
  t8 instanceof p && (t8.name = s212);
}
var et2 = U5([{ tag: l.link, class: "tok-link" }, { tag: l.heading, class: "tok-heading" }, { tag: l.emphasis, class: "tok-emphasis" }, { tag: l.strong, class: "tok-strong" }, { tag: l.keyword, class: "tok-keyword" }, { tag: l.atom, class: "tok-atom" }, { tag: l.bool, class: "tok-bool" }, { tag: l.url, class: "tok-url" }, { tag: l.labelName, class: "tok-labelName" }, { tag: l.inserted, class: "tok-inserted" }, { tag: l.deleted, class: "tok-deleted" }, { tag: l.literal, class: "tok-literal" }, { tag: l.string, class: "tok-string" }, { tag: l.number, class: "tok-number" }, { tag: [l.regexp, l.escape, l.special(l.string)], class: "tok-string2" }, { tag: l.variableName, class: "tok-variableName" }, { tag: l.local(l.variableName), class: "tok-variableName tok-local" }, { tag: l.definition(l.variableName), class: "tok-variableName tok-definition" }, { tag: l.special(l.variableName), class: "tok-variableName2" }, { tag: l.definition(l.propertyName), class: "tok-propertyName tok-definition" }, { tag: l.typeName, class: "tok-typeName" }, { tag: l.namespace, class: "tok-namespace" }, { tag: l.className, class: "tok-className" }, { tag: l.macroName, class: "tok-macroName" }, { tag: l.propertyName, class: "tok-propertyName" }, { tag: l.operator, class: "tok-operator" }, { tag: l.comment, class: "tok-comment" }, { tag: l.meta, class: "tok-meta" }, { tag: l.invalid, class: "tok-invalid" }, { tag: l.punctuation, class: "tok-punctuation" }]);

// https://esm.sh/v135/@codemirror/language@6.10.3/denonext/language.mjs
var X5;
var P5 = new v2();
var ce5 = new v2();
var d = class {
  constructor(t8, e7, r2 = [], i12 = "") {
    this.data = t8, this.name = i12, I.prototype.hasOwnProperty("tree") || Object.defineProperty(I.prototype, "tree", { get() {
      return k3(this);
    } }), this.parser = e7, this.extension = [S4.of(this), I.languageData.of((s212, o, l11) => {
      let a2 = kt(s212, o, l11), f6 = a2.type.prop(P5);
      if (!f6) return [];
      let h3 = s212.facet(f6), c3 = a2.type.prop(ce5);
      if (c3) {
        let g8 = a2.resolve(o - a2.from, l11);
        for (let p3 of c3) if (p3.test(g8, s212)) {
          let x11 = s212.facet(p3.facet);
          return p3.type == "replace" ? x11 : x11.concat(h3);
        }
      }
      return h3;
    })].concat(r2);
  }
  isActiveAt(t8, e7, r2 = -1) {
    return kt(t8, e7, r2).type.prop(P5) == this.data;
  }
  findRegions(t8) {
    let e7 = t8.facet(S4);
    if (e7?.data == this.data) return [{ from: 0, to: t8.doc.length }];
    if (!e7 || !e7.allowsNesting) return [];
    let r2 = [], i12 = (s212, o) => {
      if (s212.prop(P5) == this.data) {
        r2.push({ from: o, to: o + s212.length });
        return;
      }
      let l11 = s212.prop(v2.mounted);
      if (l11) {
        if (l11.tree.prop(P5) == this.data) {
          if (l11.overlay) for (let a2 of l11.overlay) r2.push({ from: a2.from + o, to: a2.to + o });
          else r2.push({ from: o, to: o + s212.length });
          return;
        } else if (l11.overlay) {
          let a2 = r2.length;
          if (i12(l11.tree, l11.overlay[0].from + o), r2.length > a2) return;
        }
      }
      for (let a2 = 0; a2 < s212.children.length; a2++) {
        let f6 = s212.children[a2];
        f6 instanceof O3 && i12(f6, s212.positions[a2] + o);
      }
    };
    return i12(k3(t8), 0), r2;
  }
  get allowsNesting() {
    return true;
  }
};
d.setState = v.define();
function kt(n14, t8, e7) {
  let r2 = n14.facet(S4), i12 = k3(n14).topNode;
  if (!r2 || r2.allowsNesting) for (let s212 = i12; s212; s212 = s212.enter(t8, e7, S3.ExcludeBuffers)) s212.type.isTop && (i12 = s212);
  return i12;
}
function k3(n14) {
  let t8 = n14.field(d.state, false);
  return t8 ? t8.tree : O3.empty;
}
var tt3 = class {
  constructor(t8) {
    this.doc = t8, this.cursorPos = 0, this.string = "", this.cursor = t8.iter();
  }
  get length() {
    return this.doc.length;
  }
  syncTo(t8) {
    return this.string = this.cursor.next(t8 - this.cursorPos).value, this.cursorPos = t8 + this.string.length, this.cursorPos - this.string.length;
  }
  chunk(t8) {
    return this.syncTo(t8), this.string;
  }
  get lineChunks() {
    return true;
  }
  read(t8, e7) {
    let r2 = this.cursorPos - this.string.length;
    return t8 < r2 || e7 >= this.cursorPos ? this.doc.sliceString(t8, e7) : this.string.slice(t8 - r2, e7 - r2);
  }
};
var I5 = null;
var M3 = class n2 {
  constructor(t8, e7, r2 = [], i12, s212, o, l11, a2) {
    this.parser = t8, this.state = e7, this.fragments = r2, this.tree = i12, this.treeLen = s212, this.viewport = o, this.skipped = l11, this.scheduleOn = a2, this.parse = null, this.tempSkipped = [];
  }
  static create(t8, e7, r2) {
    return new n2(t8, e7, [], O3.empty, 0, r2, [], null);
  }
  startParse() {
    return this.parser.startParse(new tt3(this.state.doc), this.fragments);
  }
  work(t8, e7) {
    return e7 != null && e7 >= this.state.doc.length && (e7 = void 0), this.tree != O3.empty && this.isDone(e7 ?? this.state.doc.length) ? (this.takeTree(), true) : this.withContext(() => {
      var r2;
      if (typeof t8 == "number") {
        let i12 = Date.now() + t8;
        t8 = () => Date.now() > i12;
      }
      for (this.parse || (this.parse = this.startParse()), e7 != null && (this.parse.stoppedAt == null || this.parse.stoppedAt > e7) && e7 < this.state.doc.length && this.parse.stopAt(e7); ; ) {
        let i12 = this.parse.advance();
        if (i12) if (this.fragments = this.withoutTempSkipped(te3.addTree(i12, this.fragments, this.parse.stoppedAt != null)), this.treeLen = (r2 = this.parse.stoppedAt) !== null && r2 !== void 0 ? r2 : this.state.doc.length, this.tree = i12, this.parse = null, this.treeLen < (e7 ?? this.state.doc.length)) this.parse = this.startParse();
        else return true;
        if (t8()) return false;
      }
    });
  }
  takeTree() {
    let t8, e7;
    this.parse && (t8 = this.parse.parsedPos) >= this.treeLen && ((this.parse.stoppedAt == null || this.parse.stoppedAt > t8) && this.parse.stopAt(t8), this.withContext(() => {
      for (; !(e7 = this.parse.advance()); ) ;
    }), this.treeLen = t8, this.tree = e7, this.fragments = this.withoutTempSkipped(te3.addTree(this.tree, this.fragments, true)), this.parse = null);
  }
  withContext(t8) {
    let e7 = I5;
    I5 = this;
    try {
      return t8();
    } finally {
      I5 = e7;
    }
  }
  withoutTempSkipped(t8) {
    for (let e7; e7 = this.tempSkipped.pop(); ) t8 = wt(t8, e7.from, e7.to);
    return t8;
  }
  changes(t8, e7) {
    let { fragments: r2, tree: i12, treeLen: s212, viewport: o, skipped: l11 } = this;
    if (this.takeTree(), !t8.empty) {
      let a2 = [];
      if (t8.iterChangedRanges((f6, h3, c3, g8) => a2.push({ fromA: f6, toA: h3, fromB: c3, toB: g8 })), r2 = te3.applyChanges(r2, a2), i12 = O3.empty, s212 = 0, o = { from: t8.mapPos(o.from, -1), to: t8.mapPos(o.to, 1) }, this.skipped.length) {
        l11 = [];
        for (let f6 of this.skipped) {
          let h3 = t8.mapPos(f6.from, 1), c3 = t8.mapPos(f6.to, -1);
          h3 < c3 && l11.push({ from: h3, to: c3 });
        }
      }
    }
    return new n2(this.parser, e7, r2, i12, s212, o, l11, this.scheduleOn);
  }
  updateViewport(t8) {
    if (this.viewport.from == t8.from && this.viewport.to == t8.to) return false;
    this.viewport = t8;
    let e7 = this.skipped.length;
    for (let r2 = 0; r2 < this.skipped.length; r2++) {
      let { from: i12, to: s212 } = this.skipped[r2];
      i12 < t8.to && s212 > t8.from && (this.fragments = wt(this.fragments, i12, s212), this.skipped.splice(r2--, 1));
    }
    return this.skipped.length >= e7 ? false : (this.reset(), true);
  }
  reset() {
    this.parse && (this.takeTree(), this.parse = null);
  }
  skipUntilInView(t8, e7) {
    this.skipped.push({ from: t8, to: e7 });
  }
  static getSkippingParser(t8) {
    return new class extends ke3 {
      createParse(e7, r2, i12) {
        let s212 = i12[0].from, o = i12[i12.length - 1].to;
        return { parsedPos: s212, advance() {
          let a2 = I5;
          if (a2) {
            for (let f6 of i12) a2.tempSkipped.push(f6);
            t8 && (a2.scheduleOn = a2.scheduleOn ? Promise.all([a2.scheduleOn, t8]) : t8);
          }
          return this.parsedPos = o, new O3(F3.none, [], [], o - s212);
        }, stoppedAt: null, stopAt() {
        } };
      }
    }();
  }
  isDone(t8) {
    t8 = Math.min(t8, this.state.doc.length);
    let e7 = this.fragments;
    return this.treeLen >= t8 && e7.length && e7[0].from == 0 && e7[0].to >= t8;
  }
  static get() {
    return I5;
  }
};
function wt(n14, t8, e7) {
  return te3.applyChanges(n14, [{ fromA: t8, toA: e7, fromB: t8, toB: e7 }]);
}
var N5 = class n3 {
  constructor(t8) {
    this.context = t8, this.tree = t8.tree;
  }
  apply(t8) {
    if (!t8.docChanged && this.tree == this.context.tree) return this;
    let e7 = this.context.changes(t8.changes, t8.state), r2 = this.context.treeLen == t8.startState.doc.length ? void 0 : Math.max(t8.changes.mapPos(this.context.treeLen), e7.viewport.to);
    return e7.work(20, r2) || e7.takeTree(), new n3(e7);
  }
  static init(t8) {
    let e7 = Math.min(3e3, t8.doc.length), r2 = M3.create(t8.facet(S4).parser, t8, { from: 0, to: e7 });
    return r2.work(20, e7) || r2.takeTree(), new n3(r2);
  }
};
d.state = z.define({ create: N5.init, update(n14, t8) {
  for (let e7 of t8.effects) if (e7.is(d.setState)) return e7.value;
  return t8.startState.facet(S4) != t8.state.facet(S4) ? N5.init(t8.state) : n14.apply(t8);
} });
var Rt3 = (n14) => {
  let t8 = setTimeout(() => n14(), 500);
  return () => clearTimeout(t8);
};
typeof requestIdleCallback < "u" && (Rt3 = (n14) => {
  let t8 = -1, e7 = setTimeout(() => {
    t8 = requestIdleCallback(n14, { timeout: 400 });
  }, 100);
  return () => t8 < 0 ? clearTimeout(e7) : cancelIdleCallback(t8);
});
var Y6 = typeof navigator < "u" && (!((X5 = navigator.scheduling) === null || X5 === void 0) && X5.isInputPending) ? () => navigator.scheduling.isInputPending() : null;
var Et3 = N3.fromClass(class {
  constructor(t8) {
    this.view = t8, this.working = null, this.workScheduled = 0, this.chunkEnd = -1, this.chunkBudget = -1, this.work = this.work.bind(this), this.scheduleWork();
  }
  update(t8) {
    let e7 = this.view.state.field(d.state).context;
    (e7.updateViewport(t8.view.viewport) || this.view.viewport.to > e7.treeLen) && this.scheduleWork(), (t8.docChanged || t8.selectionSet) && (this.view.hasFocus && (this.chunkBudget += 50), this.scheduleWork()), this.checkAsyncSchedule(e7);
  }
  scheduleWork() {
    if (this.working) return;
    let { state: t8 } = this.view, e7 = t8.field(d.state);
    (e7.tree != e7.context.tree || !e7.context.isDone(t8.doc.length)) && (this.working = Rt3(this.work));
  }
  work(t8) {
    this.working = null;
    let e7 = Date.now();
    if (this.chunkEnd < e7 && (this.chunkEnd < 0 || this.view.hasFocus) && (this.chunkEnd = e7 + 3e4, this.chunkBudget = 3e3), this.chunkBudget <= 0) return;
    let { state: r2, viewport: { to: i12 } } = this.view, s212 = r2.field(d.state);
    if (s212.tree == s212.context.tree && s212.context.isDone(i12 + 1e5)) return;
    let o = Date.now() + Math.min(this.chunkBudget, 100, t8 && !Y6 ? Math.max(25, t8.timeRemaining() - 5) : 1e9), l11 = s212.context.treeLen < i12 && r2.doc.length > i12 + 1e3, a2 = s212.context.work(() => Y6 && Y6() || Date.now() > o, i12 + (l11 ? 0 : 1e5));
    this.chunkBudget -= Date.now() - e7, (a2 || this.chunkBudget <= 0) && (s212.context.takeTree(), this.view.dispatch({ effects: d.setState.of(new N5(s212.context)) })), this.chunkBudget > 0 && !(a2 && !l11) && this.scheduleWork(), this.checkAsyncSchedule(s212.context);
  }
  checkAsyncSchedule(t8) {
    t8.scheduleOn && (this.workScheduled++, t8.scheduleOn.then(() => this.scheduleWork()).catch((e7) => $3(this.view.state, e7)).then(() => this.workScheduled--), t8.scheduleOn = null);
  }
  destroy() {
    this.working && this.working();
  }
  isWorking() {
    return !!(this.working || this.workScheduled > 0);
  }
}, { eventHandlers: { focus() {
  this.scheduleWork();
} } });
var S4 = y.define({ combine(n14) {
  return n14.length ? n14[0] : null;
}, enables: (n14) => [d.state, Et3, A3.contentAttributes.compute([n14], (t8) => {
  let e7 = t8.facet(n14);
  return e7 && e7.name ? { "data-language": e7.name } : {};
})] });
var Ft3 = y.define();
var Ut3 = y.define({ combine: (n14) => {
  if (!n14.length) return "  ";
  let t8 = n14[0];
  if (!t8 || /\S/.test(t8) || Array.from(t8).some((e7) => e7 != t8[0])) throw new Error("Invalid indent unit: " + JSON.stringify(n14[0]));
  return t8;
} });
function V5(n14) {
  let t8 = n14.facet(Ut3);
  return t8.charCodeAt(0) == 9 ? n14.tabSize * t8.length : t8.length;
}
function Wt3(n14, t8) {
  let e7 = "", r2 = n14.tabSize, i12 = n14.facet(Ut3)[0];
  if (i12 == "	") {
    for (; t8 >= r2; ) e7 += "	", t8 -= r2;
    i12 = " ";
  }
  for (let s212 = 0; s212 < t8; s212++) e7 += i12;
  return e7;
}
function jt3(n14, t8) {
  n14 instanceof I && (n14 = new B3(n14));
  for (let r2 of n14.state.facet(Ft3)) {
    let i12 = r2(n14, t8);
    if (i12 !== void 0) return i12;
  }
  let e7 = k3(n14.state);
  return e7.length >= t8 ? me4(n14, e7, t8) : null;
}
var B3 = class {
  constructor(t8, e7 = {}) {
    this.state = t8, this.options = e7, this.unit = V5(t8);
  }
  lineAt(t8, e7 = 1) {
    let r2 = this.state.doc.lineAt(t8), { simulateBreak: i12, simulateDoubleBreak: s212 } = this.options;
    return i12 != null && i12 >= r2.from && i12 <= r2.to ? s212 && i12 == t8 ? { text: "", from: t8 } : (e7 < 0 ? i12 < t8 : i12 <= t8) ? { text: r2.text.slice(i12 - r2.from), from: i12 } : { text: r2.text.slice(0, i12 - r2.from), from: r2.from } : r2;
  }
  textAfterPos(t8, e7 = 1) {
    if (this.options.simulateDoubleBreak && t8 == this.options.simulateBreak) return "";
    let { text: r2, from: i12 } = this.lineAt(t8, e7);
    return r2.slice(t8 - i12, Math.min(r2.length, t8 + 100 - i12));
  }
  column(t8, e7 = 1) {
    let { text: r2, from: i12 } = this.lineAt(t8, e7), s212 = this.countColumn(r2, t8 - i12), o = this.options.overrideIndentation ? this.options.overrideIndentation(i12) : -1;
    return o > -1 && (s212 += o - this.countColumn(r2, r2.search(/\S|$/))), s212;
  }
  countColumn(t8, e7 = t8.length) {
    return ot(t8, this.state.tabSize, e7);
  }
  lineIndent(t8, e7 = 1) {
    let { text: r2, from: i12 } = this.lineAt(t8, e7), s212 = this.options.overrideIndentation;
    if (s212) {
      let o = s212(i12);
      if (o > -1) return o;
    }
    return this.countColumn(r2, r2.search(/\S|$/));
  }
  get simulatedBreak() {
    return this.options.simulateBreak || null;
  }
};
var pe4 = new v2();
function me4(n14, t8, e7) {
  let r2 = t8.resolveStack(e7), i12 = r2.node.enterUnfinishedNodesBefore(e7);
  if (i12 != r2.node) {
    let s212 = [];
    for (let o = i12; o != r2.node; o = o.parent) s212.push(o);
    for (let o = s212.length - 1; o >= 0; o--) r2 = { node: s212[o], next: r2 };
  }
  return Ht3(r2, n14, e7);
}
function Ht3(n14, t8, e7) {
  for (let r2 = n14; r2; r2 = r2.next) {
    let i12 = ke5(r2.node);
    if (i12) return i12(et3.create(t8, e7, r2));
  }
  return 0;
}
function ge4(n14) {
  return n14.pos == n14.options.simulateBreak && n14.options.simulateDoubleBreak;
}
function ke5(n14) {
  let t8 = n14.type.prop(pe4);
  if (t8) return t8;
  let e7 = n14.firstChild, r2;
  if (e7 && (r2 = e7.type.prop(v2.closedBy))) {
    let i12 = n14.lastChild, s212 = i12 && r2.indexOf(i12.name) > -1;
    return (o) => Vt3(o, true, 1, void 0, s212 && !ge4(o) ? i12.from : void 0);
  }
  return n14.parent == null ? be5 : null;
}
function be5() {
  return 0;
}
var et3 = class n4 extends B3 {
  constructor(t8, e7, r2) {
    super(t8.state, t8.options), this.base = t8, this.pos = e7, this.context = r2;
  }
  get node() {
    return this.context.node;
  }
  static create(t8, e7, r2) {
    return new n4(t8, e7, r2);
  }
  get textAfter() {
    return this.textAfterPos(this.pos);
  }
  get baseIndent() {
    return this.baseIndentFor(this.node);
  }
  baseIndentFor(t8) {
    let e7 = this.state.doc.lineAt(t8.from);
    for (; ; ) {
      let r2 = t8.resolve(e7.from);
      for (; r2.parent && r2.parent.from == r2.from; ) r2 = r2.parent;
      if (we5(r2, t8)) break;
      e7 = this.state.doc.lineAt(r2.from);
    }
    return this.lineIndent(e7.from);
  }
  continue() {
    return Ht3(this.context.next, this.base, this.pos);
  }
};
function we5(n14, t8) {
  for (let e7 = t8; e7; e7 = e7.parent) if (n14 == e7) return true;
  return false;
}
function ye5(n14) {
  let t8 = n14.node, e7 = t8.childAfter(t8.from), r2 = t8.lastChild;
  if (!e7) return null;
  let i12 = n14.options.simulateBreak, s212 = n14.state.doc.lineAt(e7.from), o = i12 == null || i12 <= s212.from ? s212.to : Math.min(s212.to, i12);
  for (let l11 = e7.to; ; ) {
    let a2 = t8.childAfter(l11);
    if (!a2 || a2 == r2) return null;
    if (!a2.type.isSkipped) {
      if (a2.from >= o) return null;
      let f6 = /^ */.exec(s212.text.slice(e7.to - s212.from))[0].length;
      return { from: e7.from, to: e7.to + f6 };
    }
    l11 = a2.to;
  }
}
function Vt3(n14, t8, e7, r2, i12) {
  let s212 = n14.textAfter, o = s212.match(/^\s*/)[0].length, l11 = r2 && s212.slice(o, o + r2.length) == r2 || i12 == n14.pos + o, a2 = t8 ? ye5(n14) : null;
  return a2 ? l11 ? n14.column(a2.from) : n14.column(a2.to) : n14.baseIndent + (l11 ? 0 : n14.unit * e7);
}
var xe5 = y.define();
var Se4 = new v2();
function $t3(n14, t8) {
  let e7 = t8.mapPos(n14.from, 1), r2 = t8.mapPos(n14.to, -1);
  return e7 >= r2 ? void 0 : { from: e7, to: r2 };
}
var F6 = v.define({ map: $t3 });
var C3 = v.define({ map: $t3 });
var T5 = z.define({ create() {
  return R3.none;
}, update(n14, t8) {
  n14 = n14.map(t8.changes);
  for (let e7 of t8.effects) if (e7.is(F6) && !Ae4(n14, e7.value.from, e7.value.to)) {
    let { preparePlaceholder: r2 } = t8.state.facet(dt3), i12 = r2 ? R3.replace({ widget: new nt4(r2(t8.state, e7.value)) }) : xt3;
    n14 = n14.update({ add: [i12.range(e7.value.from, e7.value.to)] });
  } else e7.is(C3) && (n14 = n14.update({ filter: (r2, i12) => e7.value.from != r2 || e7.value.to != i12, filterFrom: e7.value.from, filterTo: e7.value.to }));
  if (t8.selection) {
    let e7 = false, { head: r2 } = t8.selection.main;
    n14.between(r2, r2, (i12, s212) => {
      i12 < r2 && s212 > r2 && (e7 = true);
    }), e7 && (n14 = n14.update({ filterFrom: r2, filterTo: r2, filter: (i12, s212) => s212 <= r2 || i12 >= r2 }));
  }
  return n14;
}, provide: (n14) => A3.decorations.from(n14), toJSON(n14, t8) {
  let e7 = [];
  return n14.between(0, t8.doc.length, (r2, i12) => {
    e7.push(r2, i12);
  }), e7;
}, fromJSON(n14) {
  if (!Array.isArray(n14) || n14.length % 2) throw new RangeError("Invalid JSON for fold state");
  let t8 = [];
  for (let e7 = 0; e7 < n14.length; ) {
    let r2 = n14[e7++], i12 = n14[e7++];
    if (typeof r2 != "number" || typeof i12 != "number") throw new RangeError("Invalid JSON for fold state");
    t8.push(xt3.range(r2, i12));
  }
  return R3.set(t8, true);
} });
function R4(n14, t8, e7) {
  var r2;
  let i12 = null;
  return (r2 = n14.field(T5, false)) === null || r2 === void 0 || r2.between(t8, e7, (s212, o) => {
    (!i12 || i12.from > s212) && (i12 = { from: s212, to: o });
  }), i12;
}
function Ae4(n14, t8, e7) {
  let r2 = false;
  return n14.between(t8, t8, (i12, s212) => {
    i12 == t8 && s212 == e7 && (r2 = true);
  }), r2;
}
var Ne5 = { placeholderDOM: null, preparePlaceholder: null, placeholderText: "â€¦" };
var dt3 = y.define({ combine(n14) {
  return at(n14, Ne5);
} });
function zt3(n14, t8) {
  let { state: e7 } = n14, r2 = e7.facet(dt3), i12 = (o) => {
    let l11 = n14.lineBlockAt(n14.posAtDOM(o.target)), a2 = R4(n14.state, l11.from, l11.to);
    a2 && n14.dispatch({ effects: C3.of(a2) }), o.preventDefault();
  };
  if (r2.placeholderDOM) return r2.placeholderDOM(n14, i12, t8);
  let s212 = document.createElement("span");
  return s212.textContent = r2.placeholderText, s212.setAttribute("aria-label", e7.phrase("folded code")), s212.title = e7.phrase("unfold"), s212.className = "cm-foldPlaceholder", s212.onclick = i12, s212;
}
var xt3 = R3.replace({ widget: new class extends lt3 {
  toDOM(n14) {
    return zt3(n14, null);
  }
}() });
var nt4 = class extends lt3 {
  constructor(t8) {
    super(), this.value = t8;
  }
  eq(t8) {
    return this.value == t8.value;
  }
  toDOM(t8) {
    return zt3(t8, this.value);
  }
};
var Le4 = A3.baseTheme({ ".cm-foldPlaceholder": { backgroundColor: "#eee", border: "1px solid #ddd", color: "#888", borderRadius: ".2em", margin: "0 1px", padding: "0 1px", cursor: "pointer" }, ".cm-foldGutter span": { padding: "0 1px", cursor: "pointer" } });
var q3 = class n5 {
  constructor(t8, e7) {
    this.specs = t8;
    let r2;
    function i12(l11) {
      let a2 = b2.newName();
      return (r2 || (r2 = /* @__PURE__ */ Object.create(null)))["." + a2] = l11, a2;
    }
    let s212 = typeof e7.all == "string" ? e7.all : e7.all ? i12(e7.all) : void 0, o = e7.scope;
    this.scope = o instanceof d ? (l11) => l11.prop(P5) == o.data : o ? (l11) => l11 == o : void 0, this.style = U5(t8.map((l11) => ({ tag: l11.tag, class: l11.class || i12(Object.assign({}, l11, { tag: null })) })), { all: s212 }).style, this.module = r2 ? new b2(r2) : null, this.themeType = e7.themeType;
  }
  static define(t8, e7) {
    return new n5(t8, e7 || {});
  }
};
var rt4 = y.define();
var Gt3 = y.define({ combine(n14) {
  return n14.length ? [n14[0]] : null;
} });
function j5(n14) {
  let t8 = n14.facet(rt4);
  return t8.length ? t8 : n14.facet(Gt3);
}
var it2 = class {
  constructor(t8) {
    this.markCache = /* @__PURE__ */ Object.create(null), this.tree = k3(t8.state), this.decorations = this.buildDeco(t8, j5(t8.state)), this.decoratedTo = t8.viewport.to;
  }
  update(t8) {
    let e7 = k3(t8.state), r2 = j5(t8.state), i12 = r2 != j5(t8.startState), { viewport: s212 } = t8.view, o = t8.changes.mapPos(this.decoratedTo, 1);
    e7.length < s212.to && !i12 && e7.type == this.tree.type && o >= s212.to ? (this.decorations = this.decorations.map(t8.changes), this.decoratedTo = o) : (e7 != this.tree || t8.viewportChanged || i12) && (this.tree = e7, this.decorations = this.buildDeco(t8.view, r2), this.decoratedTo = s212.to);
  }
  buildDeco(t8, e7) {
    if (!e7 || !this.tree.length) return R3.none;
    let r2 = new re();
    for (let { from: i12, to: s212 } of t8.visibleRanges) X4(this.tree, e7, (o, l11, a2) => {
      r2.add(o, l11, this.markCache[a2] || (this.markCache[a2] = R3.mark({ class: a2 })));
    }, i12, s212);
    return r2.finish();
  }
};
var Re4 = ht.high(N3.fromClass(it2, { decorations: (n14) => n14.decorations }));
var Sn3 = q3.define([{ tag: l.meta, color: "#404740" }, { tag: l.link, textDecoration: "underline" }, { tag: l.heading, textDecoration: "underline", fontWeight: "bold" }, { tag: l.emphasis, fontStyle: "italic" }, { tag: l.strong, fontWeight: "bold" }, { tag: l.strikethrough, textDecoration: "line-through" }, { tag: l.keyword, color: "#708" }, { tag: [l.atom, l.bool, l.url, l.contentSeparator, l.labelName], color: "#219" }, { tag: [l.literal, l.inserted], color: "#164" }, { tag: [l.string, l.deleted], color: "#a11" }, { tag: [l.regexp, l.escape, l.special(l.string)], color: "#e40" }, { tag: l.definition(l.variableName), color: "#00f" }, { tag: l.local(l.variableName), color: "#30a" }, { tag: [l.typeName, l.namespace], color: "#085" }, { tag: l.className, color: "#167" }, { tag: [l.special(l.variableName), l.macroName], color: "#256" }, { tag: l.definition(l.propertyName), color: "#00c" }, { tag: l.comment, color: "#940" }, { tag: l.invalid, color: "#f00" }]);
var Ee5 = A3.baseTheme({ "&.cm-focused .cm-matchingBracket": { backgroundColor: "#328c8252" }, "&.cm-focused .cm-nonmatchingBracket": { backgroundColor: "#bb555544" } });
var Jt3 = 1e4;
var _t3 = "()[]{}";
var Kt3 = y.define({ combine(n14) {
  return at(n14, { afterCursor: true, brackets: _t3, maxScanDistance: Jt3, renderMatch: We4 });
} });
var Fe4 = R3.mark({ class: "cm-matchingBracket" });
var Ue4 = R3.mark({ class: "cm-nonmatchingBracket" });
function We4(n14) {
  let t8 = [], e7 = n14.matched ? Fe4 : Ue4;
  return t8.push(e7.range(n14.start.from, n14.start.to)), n14.end && t8.push(e7.range(n14.end.from, n14.end.to)), t8;
}
var je4 = z.define({ create() {
  return R3.none;
}, update(n14, t8) {
  if (!t8.docChanged && !t8.selection) return n14;
  let e7 = [], r2 = t8.state.facet(Kt3);
  for (let i12 of t8.state.selection.ranges) {
    if (!i12.empty) continue;
    let s212 = U6(t8.state, i12.head, -1, r2) || i12.head > 0 && U6(t8.state, i12.head - 1, 1, r2) || r2.afterCursor && (U6(t8.state, i12.head, 1, r2) || i12.head < t8.state.doc.length && U6(t8.state, i12.head + 1, -1, r2));
    s212 && (e7 = e7.concat(r2.renderMatch(s212, t8.state)));
  }
  return R3.set(e7, true);
}, provide: (n14) => A3.decorations.from(n14) });
var Ve4 = new v2();
function st4(n14, t8, e7) {
  let r2 = n14.prop(t8 < 0 ? v2.openedBy : v2.closedBy);
  if (r2) return r2;
  if (n14.name.length == 1) {
    let i12 = e7.indexOf(n14.name);
    if (i12 > -1 && i12 % 2 == (t8 < 0 ? 1 : 0)) return [e7[i12 + t8]];
  }
  return null;
}
function ot4(n14) {
  let t8 = n14.type.prop(Ve4);
  return t8 ? t8(n14.node) : n14;
}
function U6(n14, t8, e7, r2 = {}) {
  let i12 = r2.maxScanDistance || Jt3, s212 = r2.brackets || _t3, o = k3(n14), l11 = o.resolveInner(t8, e7);
  for (let a2 = l11; a2; a2 = a2.parent) {
    let f6 = st4(a2.type, e7, s212);
    if (f6 && a2.from < a2.to) {
      let h3 = ot4(a2);
      if (h3 && (e7 > 0 ? t8 >= h3.from && t8 < h3.to : t8 > h3.from && t8 <= h3.to)) return $e4(n14, t8, e7, a2, h3, f6, s212);
    }
  }
  return qe4(n14, t8, e7, o, l11.type, i12, s212);
}
function $e4(n14, t8, e7, r2, i12, s212, o) {
  let l11 = r2.parent, a2 = { from: i12.from, to: i12.to }, f6 = 0, h3 = l11?.cursor();
  if (h3 && (e7 < 0 ? h3.childBefore(r2.from) : h3.childAfter(r2.to))) do
    if (e7 < 0 ? h3.to <= r2.from : h3.from >= r2.to) {
      if (f6 == 0 && s212.indexOf(h3.type.name) > -1 && h3.from < h3.to) {
        let c3 = ot4(h3);
        return { start: a2, end: c3 ? { from: c3.from, to: c3.to } : void 0, matched: true };
      } else if (st4(h3.type, e7, o)) f6++;
      else if (st4(h3.type, -e7, o)) {
        if (f6 == 0) {
          let c3 = ot4(h3);
          return { start: a2, end: c3 && c3.from < c3.to ? { from: c3.from, to: c3.to } : void 0, matched: false };
        }
        f6--;
      }
    }
  while (e7 < 0 ? h3.prevSibling() : h3.nextSibling());
  return { start: a2, matched: false };
}
function qe4(n14, t8, e7, r2, i12, s212, o) {
  let l11 = e7 < 0 ? n14.sliceDoc(t8 - 1, t8) : n14.sliceDoc(t8, t8 + 1), a2 = o.indexOf(l11);
  if (a2 < 0 || a2 % 2 == 0 != e7 > 0) return null;
  let f6 = { from: e7 < 0 ? t8 - 1 : t8, to: e7 > 0 ? t8 + 1 : t8 }, h3 = n14.doc.iterRange(t8, e7 > 0 ? n14.doc.length : 0), c3 = 0;
  for (let g8 = 0; !h3.next().done && g8 <= s212; ) {
    let p3 = h3.value;
    e7 < 0 && (g8 += p3.length);
    let x11 = t8 + g8 * e7;
    for (let A18 = e7 > 0 ? 0 : p3.length - 1, ne15 = e7 > 0 ? p3.length : -1; A18 != ne15; A18 += e7) {
      let Q20 = o.indexOf(p3[A18]);
      if (!(Q20 < 0 || r2.resolveInner(x11 + A18, 1).type != i12)) if (Q20 % 2 == 0 == e7 > 0) c3++;
      else {
        if (c3 == 1) return { start: f6, end: { from: x11 + A18, to: x11 + A18 + 1 }, matched: Q20 >> 1 == a2 >> 1 };
        c3--;
      }
    }
    e7 > 0 && (g8 += p3.length);
  }
  return h3.done ? { start: f6, matched: false } : null;
}
var mt3 = /* @__PURE__ */ Object.create(null);
var E3 = [F3.none];
var _e2 = new ye3(E3);
var At3 = [];
var Ct = /* @__PURE__ */ Object.create(null);
var Yt3 = /* @__PURE__ */ Object.create(null);
for (let [n14, t8] of [["variable", "variableName"], ["variable-2", "variableName.special"], ["string-2", "string.special"], ["def", "variableName.definition"], ["tag", "tagName"], ["attribute", "attributeName"], ["type", "typeName"], ["builtin", "variableName.standard"], ["qualifier", "modifier"], ["error", "invalid"], ["header", "heading"], ["property", "propertyName"]]) Yt3[n14] = Zt3(mt3, t8);
var G6 = class {
  constructor(t8) {
    this.extra = t8, this.table = Object.assign(/* @__PURE__ */ Object.create(null), Yt3);
  }
  resolve(t8) {
    return t8 ? this.table[t8] || (this.table[t8] = Zt3(this.extra, t8)) : 0;
  }
};
var Ke4 = new G6(mt3);
function Z3(n14, t8) {
  At3.indexOf(n14) > -1 || (At3.push(n14), console.warn(t8));
}
function Zt3(n14, t8) {
  let e7 = [];
  for (let l11 of t8.split(" ")) {
    let a2 = [];
    for (let f6 of l11.split(".")) {
      let h3 = n14[f6] || l[f6];
      h3 ? typeof h3 == "function" ? a2.length ? a2 = a2.map(h3) : Z3(f6, `Modifier ${f6} used at start of tag`) : a2.length ? Z3(f6, `Tag ${f6} used as modifier`) : a2 = Array.isArray(h3) ? h3 : [h3] : Z3(f6, `Unknown highlighting tag ${f6}`);
    }
    for (let f6 of a2) e7.push(f6);
  }
  if (!e7.length) return 0;
  let r2 = t8.replace(/ /g, "_"), i12 = r2 + " " + e7.map((l11) => l11.id), s212 = Ct[i12];
  if (s212) return s212.id;
  let o = Ct[i12] = F3.define({ id: E3.length, name: r2, props: [_4({ [r2]: e7 })] });
  return E3.push(o), o.id;
}
function te5(n14) {
  return n14.length <= 4096 && /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/.test(n14);
}
function ee3(n14) {
  for (let t8 = n14.iter(); !t8.next().done; ) if (te5(t8.value)) return true;
  return false;
}
function Xe4(n14) {
  let t8 = false;
  return n14.iterChanges((e7, r2, i12, s212, o) => {
    !t8 && ee3(o) && (t8 = true);
  }), t8;
}
var at4 = y.define({ combine: (n14) => n14.some((t8) => t8) });
var Ye4 = N3.fromClass(class {
  constructor(n14) {
    this.always = n14.state.facet(at4) || n14.textDirection != L3.LTR || n14.state.facet(A3.perLineTextDirection), this.hasRTL = !this.always && ee3(n14.state.doc), this.tree = k3(n14.state), this.decorations = this.always || this.hasRTL ? It3(n14, this.tree, this.always) : R3.none;
  }
  update(n14) {
    let t8 = n14.state.facet(at4) || n14.view.textDirection != L3.LTR || n14.state.facet(A3.perLineTextDirection);
    if (!t8 && !this.hasRTL && Xe4(n14.changes) && (this.hasRTL = true), !t8 && !this.hasRTL) return;
    let e7 = k3(n14.state);
    (t8 != this.always || e7 != this.tree || n14.docChanged || n14.viewportChanged) && (this.tree = e7, this.always = t8, this.decorations = It3(n14.view, e7, t8));
  }
}, { provide: (n14) => {
  function t8(e7) {
    var r2, i12;
    return (i12 = (r2 = e7.plugin(n14)) === null || r2 === void 0 ? void 0 : r2.decorations) !== null && i12 !== void 0 ? i12 : R3.none;
  }
  return [A3.outerDecorations.of(t8), ht.lowest(A3.bidiIsolatedRanges.of(t8))];
} });
function It3(n14, t8, e7) {
  let r2 = new re(), i12 = n14.visibleRanges;
  e7 || (i12 = Ze4(i12, n14.state.doc));
  for (let { from: s212, to: o } of i12) t8.iterate({ enter: (l11) => {
    let a2 = l11.type.prop(v2.isolate);
    a2 && r2.add(l11.from, l11.to, tn3[a2]);
  }, from: s212, to: o });
  return r2.finish();
}
function Ze4(n14, t8) {
  let e7 = t8.iter(), r2 = 0, i12 = [], s212 = null;
  for (let { from: o, to: l11 } of n14) if (!(s212 && s212.to > o && (o = s212.to, o >= l11))) for (r2 + e7.value.length < o && (e7.next(o - (r2 + e7.value.length)), r2 = o); ; ) {
    let a2 = r2, f6 = r2 + e7.value.length;
    if (!e7.lineBreak && te5(e7.value) && (s212 && s212.to > a2 - 10 ? s212.to = Math.min(l11, f6) : i12.push(s212 = { from: a2, to: Math.min(l11, f6) })), f6 >= l11) break;
    r2 = f6, e7.next();
  }
  return i12;
}
var tn3 = { rtl: R3.mark({ class: "cm-iso", inclusive: true, attributes: { dir: "rtl" }, bidiIsolate: L3.RTL }), ltr: R3.mark({ class: "cm-iso", inclusive: true, attributes: { dir: "ltr" }, bidiIsolate: L3.LTR }), auto: R3.mark({ class: "cm-iso", inclusive: true, attributes: { dir: "auto" }, bidiIsolate: null }) };

// https://esm.sh/v135/@codemirror/view@6.34.1/denonext/view.mjs
function jt4(s212) {
  let t8;
  return s212.nodeType == 11 ? t8 = s212.getSelection ? s212 : s212.ownerDocument : t8 = s212, t8.getSelection();
}
function Xe5(s212, t8) {
  return t8 ? s212 == t8 || s212.contains(t8.nodeType != 1 ? t8.parentNode : t8) : false;
}
function ue5(s212, t8) {
  if (!t8.anchorNode) return false;
  try {
    return Xe5(s212, t8.anchorNode);
  } catch {
    return false;
  }
}
function At4(s212) {
  return s212.nodeType == 3 ? pt3(s212, 0, s212.nodeValue.length).getClientRects() : s212.nodeType == 1 ? s212.getClientRects() : [];
}
function Vt4(s212, t8, e7, i12) {
  return e7 ? Yi2(s212, t8, e7, i12, -1) || Yi2(s212, t8, e7, i12, 1) : false;
}
function ut3(s212) {
  for (var t8 = 0; ; t8++) if (s212 = s212.previousSibling, !s212) return t8;
}
function xe6(s212) {
  return s212.nodeType == 1 && /^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(s212.nodeName);
}
function Yi2(s212, t8, e7, i12, n14) {
  for (; ; ) {
    if (s212 == e7 && t8 == i12) return true;
    if (t8 == (n14 < 0 ? 0 : U7(s212))) {
      if (s212.nodeName == "DIV") return false;
      let o = s212.parentNode;
      if (!o || o.nodeType != 1) return false;
      t8 = ut3(s212) + (n14 < 0 ? 0 : 1), s212 = o;
    } else if (s212.nodeType == 1) {
      if (s212 = s212.childNodes[t8 + (n14 < 0 ? -1 : 0)], s212.nodeType == 1 && s212.contentEditable == "false") return false;
      t8 = n14 < 0 ? U7(s212) : 0;
    } else return false;
  }
}
function U7(s212) {
  return s212.nodeType == 3 ? s212.nodeValue.length : s212.childNodes.length;
}
function te6(s212, t8) {
  let e7 = t8 ? s212.left : s212.right;
  return { left: e7, right: e7, top: s212.top, bottom: s212.bottom };
}
function to2(s212) {
  let t8 = s212.visualViewport;
  return t8 ? { left: 0, right: t8.width, top: 0, bottom: t8.height } : { left: 0, right: s212.innerWidth, top: 0, bottom: s212.innerHeight };
}
function Vs(s212, t8) {
  let e7 = t8.width / s212.offsetWidth, i12 = t8.height / s212.offsetHeight;
  return (e7 > 0.995 && e7 < 1.005 || !isFinite(e7) || Math.abs(t8.width - s212.offsetWidth) < 1) && (e7 = 1), (i12 > 0.995 && i12 < 1.005 || !isFinite(i12) || Math.abs(t8.height - s212.offsetHeight) < 1) && (i12 = 1), { scaleX: e7, scaleY: i12 };
}
function eo3(s212, t8, e7, i12, n14, o, r2, l11) {
  let h3 = s212.ownerDocument, c3 = h3.defaultView || window;
  for (let a2 = s212, f6 = false; a2 && !f6; ) if (a2.nodeType == 1) {
    let d4, u3 = a2 == h3.body, p3 = 1, g8 = 1;
    if (u3) d4 = to2(c3);
    else {
      if (/^(fixed|sticky)$/.test(getComputedStyle(a2).position) && (f6 = true), a2.scrollHeight <= a2.clientHeight && a2.scrollWidth <= a2.clientWidth) {
        a2 = a2.assignedSlot || a2.parentNode;
        continue;
      }
      let w14 = a2.getBoundingClientRect();
      ({ scaleX: p3, scaleY: g8 } = Vs(a2, w14)), d4 = { left: w14.left, right: w14.left + a2.clientWidth * p3, top: w14.top, bottom: w14.top + a2.clientHeight * g8 };
    }
    let b12 = 0, m11 = 0;
    if (n14 == "nearest") t8.top < d4.top ? (m11 = -(d4.top - t8.top + r2), e7 > 0 && t8.bottom > d4.bottom + m11 && (m11 = t8.bottom - d4.bottom + m11 + r2)) : t8.bottom > d4.bottom && (m11 = t8.bottom - d4.bottom + r2, e7 < 0 && t8.top - m11 < d4.top && (m11 = -(d4.top + m11 - t8.top + r2)));
    else {
      let w14 = t8.bottom - t8.top, v10 = d4.bottom - d4.top;
      m11 = (n14 == "center" && w14 <= v10 ? t8.top + w14 / 2 - v10 / 2 : n14 == "start" || n14 == "center" && e7 < 0 ? t8.top - r2 : t8.bottom - v10 + r2) - d4.top;
    }
    if (i12 == "nearest" ? t8.left < d4.left ? (b12 = -(d4.left - t8.left + o), e7 > 0 && t8.right > d4.right + b12 && (b12 = t8.right - d4.right + b12 + o)) : t8.right > d4.right && (b12 = t8.right - d4.right + o, e7 < 0 && t8.left < d4.left + b12 && (b12 = -(d4.left + b12 - t8.left + o))) : b12 = (i12 == "center" ? t8.left + (t8.right - t8.left) / 2 - (d4.right - d4.left) / 2 : i12 == "start" == l11 ? t8.left - o : t8.right - (d4.right - d4.left) + o) - d4.left, b12 || m11) if (u3) c3.scrollBy(b12, m11);
    else {
      let w14 = 0, v10 = 0;
      if (m11) {
        let x11 = a2.scrollTop;
        a2.scrollTop += m11 / g8, v10 = (a2.scrollTop - x11) * g8;
      }
      if (b12) {
        let x11 = a2.scrollLeft;
        a2.scrollLeft += b12 / p3, w14 = (a2.scrollLeft - x11) * p3;
      }
      t8 = { left: t8.left - w14, top: t8.top - v10, right: t8.right - w14, bottom: t8.bottom - v10 }, w14 && Math.abs(w14 - b12) < 1 && (i12 = "nearest"), v10 && Math.abs(v10 - m11) < 1 && (n14 = "nearest");
    }
    if (u3) break;
    a2 = a2.assignedSlot || a2.parentNode;
  } else if (a2.nodeType == 11) a2 = a2.host;
  else break;
}
function io3(s212) {
  let t8 = s212.ownerDocument, e7, i12;
  for (let n14 = s212.parentNode; n14 && !(n14 == t8.body || e7 && i12); ) if (n14.nodeType == 1) !i12 && n14.scrollHeight > n14.clientHeight && (i12 = n14), !e7 && n14.scrollWidth > n14.clientWidth && (e7 = n14), n14 = n14.assignedSlot || n14.parentNode;
  else if (n14.nodeType == 11) n14 = n14.host;
  else break;
  return { x: e7, y: i12 };
}
var Ge4 = class {
  constructor() {
    this.anchorNode = null, this.anchorOffset = 0, this.focusNode = null, this.focusOffset = 0;
  }
  eq(t8) {
    return this.anchorNode == t8.anchorNode && this.anchorOffset == t8.anchorOffset && this.focusNode == t8.focusNode && this.focusOffset == t8.focusOffset;
  }
  setRange(t8) {
    let { anchorNode: e7, focusNode: i12 } = t8;
    this.set(e7, Math.min(t8.anchorOffset, e7 ? U7(e7) : 0), i12, Math.min(t8.focusOffset, i12 ? U7(i12) : 0));
  }
  set(t8, e7, i12, n14) {
    this.anchorNode = t8, this.anchorOffset = e7, this.focusNode = i12, this.focusOffset = n14;
  }
};
var yt3 = null;
function Fs3(s212) {
  if (s212.setActive) return s212.setActive();
  if (yt3) return s212.focus(yt3);
  let t8 = [];
  for (let e7 = s212; e7 && (t8.push(e7, e7.scrollTop, e7.scrollLeft), e7 != e7.ownerDocument); e7 = e7.parentNode) ;
  if (s212.focus(yt3 == null ? { get preventScroll() {
    return yt3 = { preventScroll: true }, true;
  } } : void 0), !yt3) {
    yt3 = false;
    for (let e7 = 0; e7 < t8.length; ) {
      let i12 = t8[e7++], n14 = t8[e7++], o = t8[e7++];
      i12.scrollTop != n14 && (i12.scrollTop = n14), i12.scrollLeft != o && (i12.scrollLeft = o);
    }
  }
}
var _i3;
function pt3(s212, t8, e7 = t8) {
  let i12 = _i3 || (_i3 = document.createRange());
  return i12.setEnd(s212, e7), i12.setStart(s212, t8), i12;
}
function Mt3(s212, t8, e7, i12) {
  let n14 = { key: t8, code: t8, keyCode: e7, which: e7, cancelable: true };
  i12 && ({ altKey: n14.altKey, ctrlKey: n14.ctrlKey, shiftKey: n14.shiftKey, metaKey: n14.metaKey } = i12);
  let o = new KeyboardEvent("keydown", n14);
  o.synthetic = true, s212.dispatchEvent(o);
  let r2 = new KeyboardEvent("keyup", n14);
  return r2.synthetic = true, s212.dispatchEvent(r2), o.defaultPrevented || r2.defaultPrevented;
}
function so3(s212) {
  for (; s212; ) {
    if (s212 && (s212.nodeType == 9 || s212.nodeType == 11 && s212.host)) return s212;
    s212 = s212.assignedSlot || s212.parentNode;
  }
  return null;
}
function Ws3(s212) {
  for (; s212.attributes.length; ) s212.removeAttributeNode(s212.attributes[0]);
}
function no3(s212, t8) {
  let e7 = t8.focusNode, i12 = t8.focusOffset;
  if (!e7 || t8.anchorNode != e7 || t8.anchorOffset != i12) return false;
  for (i12 = Math.min(i12, U7(e7)); ; ) if (i12) {
    if (e7.nodeType != 1) return false;
    let n14 = e7.childNodes[i12 - 1];
    n14.contentEditable == "false" ? i12-- : (e7 = n14, i12 = U7(e7));
  } else {
    if (e7 == s212) return true;
    i12 = ut3(e7), e7 = e7.parentNode;
  }
}
function zs3(s212) {
  return s212.scrollTop > Math.max(1, s212.scrollHeight - s212.clientHeight - 4);
}
function Is3(s212, t8) {
  for (let e7 = s212, i12 = t8; ; ) {
    if (e7.nodeType == 3 && i12 > 0) return { node: e7, offset: i12 };
    if (e7.nodeType == 1 && i12 > 0) {
      if (e7.contentEditable == "false") return null;
      e7 = e7.childNodes[i12 - 1], i12 = U7(e7);
    } else if (e7.parentNode && !xe6(e7)) i12 = ut3(e7), e7 = e7.parentNode;
    else return null;
  }
}
function Ks3(s212, t8) {
  for (let e7 = s212, i12 = t8; ; ) {
    if (e7.nodeType == 3 && i12 < e7.nodeValue.length) return { node: e7, offset: i12 };
    if (e7.nodeType == 1 && i12 < e7.childNodes.length) {
      if (e7.contentEditable == "false") return null;
      e7 = e7.childNodes[i12], i12 = 0;
    } else if (e7.parentNode && !xe6(e7)) i12 = ut3(e7) + 1, e7 = e7.parentNode;
    else return null;
  }
}
var V6 = class s82 {
  constructor(t8, e7, i12 = true) {
    this.node = t8, this.offset = e7, this.precise = i12;
  }
  static before(t8, e7) {
    return new s82(t8.parentNode, ut3(t8), e7);
  }
  static after(t8, e7) {
    return new s82(t8.parentNode, ut3(t8) + 1, e7);
  }
};
var Fi3 = [];
var R5 = class s83 {
  constructor() {
    this.parent = null, this.dom = null, this.flags = 2;
  }
  get overrideDOMText() {
    return null;
  }
  get posAtStart() {
    return this.parent ? this.parent.posBefore(this) : 0;
  }
  get posAtEnd() {
    return this.posAtStart + this.length;
  }
  posBefore(t8) {
    let e7 = this.posAtStart;
    for (let i12 of this.children) {
      if (i12 == t8) return e7;
      e7 += i12.length + i12.breakAfter;
    }
    throw new RangeError("Invalid child in posBefore");
  }
  posAfter(t8) {
    return this.posBefore(t8) + t8.length;
  }
  sync(t8, e7) {
    if (this.flags & 2) {
      let i12 = this.dom, n14 = null, o;
      for (let r2 of this.children) {
        if (r2.flags & 7) {
          if (!r2.dom && (o = n14 ? n14.nextSibling : i12.firstChild)) {
            let l11 = s83.get(o);
            (!l11 || !l11.parent && l11.canReuseDOM(r2)) && r2.reuseDOM(o);
          }
          r2.sync(t8, e7), r2.flags &= -8;
        }
        if (o = n14 ? n14.nextSibling : i12.firstChild, e7 && !e7.written && e7.node == i12 && o != r2.dom && (e7.written = true), r2.dom.parentNode == i12) for (; o && o != r2.dom; ) o = Xi3(o);
        else i12.insertBefore(r2.dom, o);
        n14 = r2.dom;
      }
      for (o = n14 ? n14.nextSibling : i12.firstChild, o && e7 && e7.node == i12 && (e7.written = true); o; ) o = Xi3(o);
    } else if (this.flags & 1) for (let i12 of this.children) i12.flags & 7 && (i12.sync(t8, e7), i12.flags &= -8);
  }
  reuseDOM(t8) {
  }
  localPosFromDOM(t8, e7) {
    let i12;
    if (t8 == this.dom) i12 = this.dom.childNodes[e7];
    else {
      let n14 = U7(t8) == 0 ? 0 : e7 == 0 ? -1 : 1;
      for (; ; ) {
        let o = t8.parentNode;
        if (o == this.dom) break;
        n14 == 0 && o.firstChild != o.lastChild && (t8 == o.firstChild ? n14 = -1 : n14 = 1), t8 = o;
      }
      n14 < 0 ? i12 = t8 : i12 = t8.nextSibling;
    }
    if (i12 == this.dom.firstChild) return 0;
    for (; i12 && !s83.get(i12); ) i12 = i12.nextSibling;
    if (!i12) return this.length;
    for (let n14 = 0, o = 0; ; n14++) {
      let r2 = this.children[n14];
      if (r2.dom == i12) return o;
      o += r2.length + r2.breakAfter;
    }
  }
  domBoundsAround(t8, e7, i12 = 0) {
    let n14 = -1, o = -1, r2 = -1, l11 = -1;
    for (let h3 = 0, c3 = i12, a2 = i12; h3 < this.children.length; h3++) {
      let f6 = this.children[h3], d4 = c3 + f6.length;
      if (c3 < t8 && d4 > e7) return f6.domBoundsAround(t8, e7, c3);
      if (d4 >= t8 && n14 == -1 && (n14 = h3, o = c3), c3 > e7 && f6.dom.parentNode == this.dom) {
        r2 = h3, l11 = a2;
        break;
      }
      a2 = d4, c3 = d4 + f6.breakAfter;
    }
    return { from: o, to: l11 < 0 ? i12 + this.length : l11, startDOM: (n14 ? this.children[n14 - 1].dom.nextSibling : null) || this.dom.firstChild, endDOM: r2 < this.children.length && r2 >= 0 ? this.children[r2].dom : null };
  }
  markDirty(t8 = false) {
    this.flags |= 2, this.markParentsDirty(t8);
  }
  markParentsDirty(t8) {
    for (let e7 = this.parent; e7; e7 = e7.parent) {
      if (t8 && (e7.flags |= 2), e7.flags & 1) return;
      e7.flags |= 1, t8 = false;
    }
  }
  setParent(t8) {
    this.parent != t8 && (this.parent = t8, this.flags & 7 && this.markParentsDirty(true));
  }
  setDOM(t8) {
    this.dom != t8 && (this.dom && (this.dom.cmView = null), this.dom = t8, t8.cmView = this);
  }
  get rootView() {
    for (let t8 = this; ; ) {
      let e7 = t8.parent;
      if (!e7) return t8;
      t8 = e7;
    }
  }
  replaceChildren(t8, e7, i12 = Fi3) {
    this.markDirty();
    for (let n14 = t8; n14 < e7; n14++) {
      let o = this.children[n14];
      o.parent == this && i12.indexOf(o) < 0 && o.destroy();
    }
    i12.length < 250 ? this.children.splice(t8, e7 - t8, ...i12) : this.children = [].concat(this.children.slice(0, t8), i12, this.children.slice(e7));
    for (let n14 = 0; n14 < i12.length; n14++) i12[n14].setParent(this);
  }
  ignoreMutation(t8) {
    return false;
  }
  ignoreEvent(t8) {
    return false;
  }
  childCursor(t8 = this.length) {
    return new ve4(this.children, t8, this.children.length);
  }
  childPos(t8, e7 = 1) {
    return this.childCursor().findPos(t8, e7);
  }
  toString() {
    let t8 = this.constructor.name.replace("View", "");
    return t8 + (this.children.length ? "(" + this.children.join() + ")" : this.length ? "[" + (t8 == "Text" ? this.text : this.length) + "]" : "") + (this.breakAfter ? "#" : "");
  }
  static get(t8) {
    return t8.cmView;
  }
  get isEditable() {
    return true;
  }
  get isWidget() {
    return false;
  }
  get isHidden() {
    return false;
  }
  merge(t8, e7, i12, n14, o, r2) {
    return false;
  }
  become(t8) {
    return false;
  }
  canReuseDOM(t8) {
    return t8.constructor == this.constructor && !((this.flags | t8.flags) & 8);
  }
  getSide() {
    return 0;
  }
  destroy() {
    for (let t8 of this.children) t8.parent == this && t8.destroy();
    this.parent = null;
  }
};
R5.prototype.breakAfter = 0;
function Xi3(s212) {
  let t8 = s212.nextSibling;
  return s212.parentNode.removeChild(s212), t8;
}
var ve4 = class {
  constructor(t8, e7, i12) {
    this.children = t8, this.pos = e7, this.i = i12, this.off = 0;
  }
  findPos(t8, e7 = 1) {
    for (; ; ) {
      if (t8 > this.pos || t8 == this.pos && (e7 > 0 || this.i == 0 || this.children[this.i - 1].breakAfter)) return this.off = t8 - this.pos, this;
      let i12 = this.children[--this.i];
      this.pos -= i12.length + i12.breakAfter;
    }
  }
};
function qs3(s212, t8, e7, i12, n14, o, r2, l11, h3) {
  let { children: c3 } = s212, a2 = c3.length ? c3[t8] : null, f6 = o.length ? o[o.length - 1] : null, d4 = f6 ? f6.breakAfter : r2;
  if (!(t8 == i12 && a2 && !r2 && !d4 && o.length < 2 && a2.merge(e7, n14, o.length ? f6 : null, e7 == 0, l11, h3))) {
    if (i12 < c3.length) {
      let u3 = c3[i12];
      u3 && (n14 < u3.length || u3.breakAfter && f6?.breakAfter) ? (t8 == i12 && (u3 = u3.split(n14), n14 = 0), !d4 && f6 && u3.merge(0, n14, f6, true, 0, h3) ? o[o.length - 1] = u3 : ((n14 || u3.children.length && !u3.children[0].length) && u3.merge(0, n14, null, false, 0, h3), o.push(u3))) : u3?.breakAfter && (f6 ? f6.breakAfter = 1 : r2 = 1), i12++;
    }
    for (a2 && (a2.breakAfter = r2, e7 > 0 && (!r2 && o.length && a2.merge(e7, a2.length, o[0], false, l11, 0) ? a2.breakAfter = o.shift().breakAfter : (e7 < a2.length || a2.children.length && a2.children[a2.children.length - 1].length == 0) && a2.merge(e7, a2.length, null, false, l11, 0), t8++)); t8 < i12 && o.length; ) if (c3[i12 - 1].become(o[o.length - 1])) i12--, o.pop(), h3 = o.length ? 0 : l11;
    else if (c3[t8].become(o[0])) t8++, o.shift(), l11 = o.length ? 0 : h3;
    else break;
    !o.length && t8 && i12 < c3.length && !c3[t8 - 1].breakAfter && c3[i12].merge(0, 0, c3[t8 - 1], false, l11, h3) && t8--, (t8 < i12 || o.length) && s212.replaceChildren(t8, i12, o);
  }
}
function js3(s212, t8, e7, i12, n14, o) {
  let r2 = s212.childCursor(), { i: l11, off: h3 } = r2.findPos(e7, 1), { i: c3, off: a2 } = r2.findPos(t8, -1), f6 = t8 - e7;
  for (let d4 of i12) f6 += d4.length;
  s212.length += f6, qs3(s212, c3, a2, l11, h3, i12, 0, n14, o);
}
var W5 = typeof navigator < "u" ? navigator : { userAgent: "", vendor: "", platform: "" };
var $e5 = typeof document < "u" ? document : { documentElement: { style: {} } };
var Ue5 = /Edge\/(\d+)/.exec(W5.userAgent);
var Ys3 = /MSIE \d/.test(W5.userAgent);
var Qe4 = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(W5.userAgent);
var Ne6 = !!(Ys3 || Qe4 || Ue5);
var Gi3 = !Ne6 && /gecko\/(\d+)/i.test(W5.userAgent);
var ze5 = !Ne6 && /Chrome\/(\d+)/.exec(W5.userAgent);
var $i3 = "webkitFontSmoothing" in $e5.documentElement.style;
var _s3 = !Ne6 && /Apple Computer/.test(W5.vendor);
var Ui3 = _s3 && (/Mobile\/\w+/.test(W5.userAgent) || W5.maxTouchPoints > 2);
var y6 = { mac: Ui3 || /Mac/.test(W5.platform), windows: /Win/.test(W5.platform), linux: /Linux|X11/.test(W5.platform), ie: Ne6, ie_version: Ys3 ? $e5.documentMode || 6 : Qe4 ? +Qe4[1] : Ue5 ? +Ue5[1] : 0, gecko: Gi3, gecko_version: Gi3 ? +(/Firefox\/(\d+)/.exec(W5.userAgent) || [0, 0])[1] : 0, chrome: !!ze5, chrome_version: ze5 ? +ze5[1] : 0, ios: Ui3, android: /Android\b/.test(W5.userAgent), webkit: $i3, safari: _s3, webkit_version: $i3 ? +(/\bAppleWebKit\/(\d+)/.exec(W5.userAgent) || [0, 0])[1] : 0, tabSize: $e5.documentElement.style.tabSize != null ? "tab-size" : "-moz-tab-size" };
var oo3 = 256;
var Q6 = class s84 extends R5 {
  constructor(t8) {
    super(), this.text = t8;
  }
  get length() {
    return this.text.length;
  }
  createDOM(t8) {
    this.setDOM(t8 || document.createTextNode(this.text));
  }
  sync(t8, e7) {
    this.dom || this.createDOM(), this.dom.nodeValue != this.text && (e7 && e7.node == this.dom && (e7.written = true), this.dom.nodeValue = this.text);
  }
  reuseDOM(t8) {
    t8.nodeType == 3 && this.createDOM(t8);
  }
  merge(t8, e7, i12) {
    return this.flags & 8 || i12 && (!(i12 instanceof s84) || this.length - (e7 - t8) + i12.length > oo3 || i12.flags & 8) ? false : (this.text = this.text.slice(0, t8) + (i12 ? i12.text : "") + this.text.slice(e7), this.markDirty(), true);
  }
  split(t8) {
    let e7 = new s84(this.text.slice(t8));
    return this.text = this.text.slice(0, t8), this.markDirty(), e7.flags |= this.flags & 8, e7;
  }
  localPosFromDOM(t8, e7) {
    return t8 == this.dom ? e7 : e7 ? this.text.length : 0;
  }
  domAtPos(t8) {
    return new V6(this.dom, t8);
  }
  domBoundsAround(t8, e7, i12) {
    return { from: i12, to: i12 + this.length, startDOM: this.dom, endDOM: this.dom.nextSibling };
  }
  coordsAt(t8, e7) {
    return ro3(this.dom, t8, e7);
  }
};
var rt5 = class s85 extends R5 {
  constructor(t8, e7 = [], i12 = 0) {
    super(), this.mark = t8, this.children = e7, this.length = i12;
    for (let n14 of e7) n14.setParent(this);
  }
  setAttrs(t8) {
    if (Ws3(t8), this.mark.class && (t8.className = this.mark.class), this.mark.attrs) for (let e7 in this.mark.attrs) t8.setAttribute(e7, this.mark.attrs[e7]);
    return t8;
  }
  canReuseDOM(t8) {
    return super.canReuseDOM(t8) && !((this.flags | t8.flags) & 8);
  }
  reuseDOM(t8) {
    t8.nodeName == this.mark.tagName.toUpperCase() && (this.setDOM(t8), this.flags |= 6);
  }
  sync(t8, e7) {
    this.dom ? this.flags & 4 && this.setAttrs(this.dom) : this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))), super.sync(t8, e7);
  }
  merge(t8, e7, i12, n14, o, r2) {
    return i12 && (!(i12 instanceof s85 && i12.mark.eq(this.mark)) || t8 && o <= 0 || e7 < this.length && r2 <= 0) ? false : (js3(this, t8, e7, i12 ? i12.children.slice() : [], o - 1, r2 - 1), this.markDirty(), true);
  }
  split(t8) {
    let e7 = [], i12 = 0, n14 = -1, o = 0;
    for (let l11 of this.children) {
      let h3 = i12 + l11.length;
      h3 > t8 && e7.push(i12 < t8 ? l11.split(t8 - i12) : l11), n14 < 0 && i12 >= t8 && (n14 = o), i12 = h3, o++;
    }
    let r2 = this.length - t8;
    return this.length = t8, n14 > -1 && (this.children.length = n14, this.markDirty()), new s85(this.mark, e7, r2);
  }
  domAtPos(t8) {
    return Xs3(this, t8);
  }
  coordsAt(t8, e7) {
    return $s3(this, t8, e7);
  }
};
function ro3(s212, t8, e7) {
  let i12 = s212.nodeValue.length;
  t8 > i12 && (t8 = i12);
  let n14 = t8, o = t8, r2 = 0;
  t8 == 0 && e7 < 0 || t8 == i12 && e7 >= 0 ? y6.chrome || y6.gecko || (t8 ? (n14--, r2 = 1) : o < i12 && (o++, r2 = -1)) : e7 < 0 ? n14-- : o < i12 && o++;
  let l11 = pt3(s212, n14, o).getClientRects();
  if (!l11.length) return null;
  let h3 = l11[(r2 ? r2 < 0 : e7 >= 0) ? 0 : l11.length - 1];
  return y6.safari && !r2 && h3.width == 0 && (h3 = Array.prototype.find.call(l11, (c3) => c3.width) || h3), r2 ? te6(h3, r2 < 0) : h3 || null;
}
var Yt4 = class s86 extends R5 {
  static create(t8, e7, i12) {
    return new s86(t8, e7, i12);
  }
  constructor(t8, e7, i12) {
    super(), this.widget = t8, this.length = e7, this.side = i12, this.prevWidget = null;
  }
  split(t8) {
    let e7 = s86.create(this.widget, this.length - t8, this.side);
    return this.length -= t8, e7;
  }
  sync(t8) {
    (!this.dom || !this.widget.updateDOM(this.dom, t8)) && (this.dom && this.prevWidget && this.prevWidget.destroy(this.dom), this.prevWidget = null, this.setDOM(this.widget.toDOM(t8)), this.widget.editable || (this.dom.contentEditable = "false"));
  }
  getSide() {
    return this.side;
  }
  merge(t8, e7, i12, n14, o, r2) {
    return i12 && (!(i12 instanceof s86) || !this.widget.compare(i12.widget) || t8 > 0 && o <= 0 || e7 < this.length && r2 <= 0) ? false : (this.length = t8 + (i12 ? i12.length : 0) + (this.length - e7), true);
  }
  become(t8) {
    return t8 instanceof s86 && t8.side == this.side && this.widget.constructor == t8.widget.constructor ? (this.widget.compare(t8.widget) || this.markDirty(true), this.dom && !this.prevWidget && (this.prevWidget = this.widget), this.widget = t8.widget, this.length = t8.length, true) : false;
  }
  ignoreMutation() {
    return true;
  }
  ignoreEvent(t8) {
    return this.widget.ignoreEvent(t8);
  }
  get overrideDOMText() {
    if (this.length == 0) return m.empty;
    let t8 = this;
    for (; t8.parent; ) t8 = t8.parent;
    let { view: e7 } = t8, i12 = e7 && e7.state.doc, n14 = this.posAtStart;
    return i12 ? i12.slice(n14, n14 + this.length) : m.empty;
  }
  domAtPos(t8) {
    return (this.length ? t8 == 0 : this.side > 0) ? V6.before(this.dom) : V6.after(this.dom, t8 == this.length);
  }
  domBoundsAround() {
    return null;
  }
  coordsAt(t8, e7) {
    let i12 = this.widget.coordsAt(this.dom, t8, e7);
    if (i12) return i12;
    let n14 = this.dom.getClientRects(), o = null;
    if (!n14.length) return null;
    let r2 = this.side ? this.side < 0 : t8 > 0;
    for (let l11 = r2 ? n14.length - 1 : 0; o = n14[l11], !(t8 > 0 ? l11 == 0 : l11 == n14.length - 1 || o.top < o.bottom); l11 += r2 ? -1 : 1) ;
    return te6(o, !r2);
  }
  get isEditable() {
    return false;
  }
  get isWidget() {
    return true;
  }
  get isHidden() {
    return this.widget.isHidden;
  }
  destroy() {
    super.destroy(), this.dom && this.widget.destroy(this.dom);
  }
};
var _t4 = class s87 extends R5 {
  constructor(t8) {
    super(), this.side = t8;
  }
  get length() {
    return 0;
  }
  merge() {
    return false;
  }
  become(t8) {
    return t8 instanceof s87 && t8.side == this.side;
  }
  split() {
    return new s87(this.side);
  }
  sync() {
    if (!this.dom) {
      let t8 = document.createElement("img");
      t8.className = "cm-widgetBuffer", t8.setAttribute("aria-hidden", "true"), this.setDOM(t8);
    }
  }
  getSide() {
    return this.side;
  }
  domAtPos(t8) {
    return this.side > 0 ? V6.before(this.dom) : V6.after(this.dom);
  }
  localPosFromDOM() {
    return 0;
  }
  domBoundsAround() {
    return null;
  }
  coordsAt(t8) {
    return this.dom.getBoundingClientRect();
  }
  get overrideDOMText() {
    return m.empty;
  }
  get isHidden() {
    return true;
  }
};
Q6.prototype.children = Yt4.prototype.children = _t4.prototype.children = Fi3;
function Xs3(s212, t8) {
  let e7 = s212.dom, { children: i12 } = s212, n14 = 0;
  for (let o = 0; n14 < i12.length; n14++) {
    let r2 = i12[n14], l11 = o + r2.length;
    if (!(l11 == o && r2.getSide() <= 0)) {
      if (t8 > o && t8 < l11 && r2.dom.parentNode == e7) return r2.domAtPos(t8 - o);
      if (t8 <= o) break;
      o = l11;
    }
  }
  for (let o = n14; o > 0; o--) {
    let r2 = i12[o - 1];
    if (r2.dom.parentNode == e7) return r2.domAtPos(r2.length);
  }
  for (let o = n14; o < i12.length; o++) {
    let r2 = i12[o];
    if (r2.dom.parentNode == e7) return r2.domAtPos(0);
  }
  return new V6(e7, 0);
}
function Gs3(s212, t8, e7) {
  let i12, { children: n14 } = s212;
  e7 > 0 && t8 instanceof rt5 && n14.length && (i12 = n14[n14.length - 1]) instanceof rt5 && i12.mark.eq(t8.mark) ? Gs3(i12, t8.children[0], e7 - 1) : (n14.push(t8), t8.setParent(s212)), s212.length += t8.length;
}
function $s3(s212, t8, e7) {
  let i12 = null, n14 = -1, o = null, r2 = -1;
  function l11(c3, a2) {
    for (let f6 = 0, d4 = 0; f6 < c3.children.length && d4 <= a2; f6++) {
      let u3 = c3.children[f6], p3 = d4 + u3.length;
      p3 >= a2 && (u3.children.length ? l11(u3, a2 - d4) : (!o || o.isHidden && e7 > 0) && (p3 > a2 || d4 == p3 && u3.getSide() > 0) ? (o = u3, r2 = a2 - d4) : (d4 < a2 || d4 == p3 && u3.getSide() < 0 && !u3.isHidden) && (i12 = u3, n14 = a2 - d4)), d4 = p3;
    }
  }
  l11(s212, t8);
  let h3 = (e7 < 0 ? i12 : o) || i12 || o;
  return h3 ? h3.coordsAt(Math.max(0, h3 == i12 ? n14 : r2), e7) : lo3(s212);
}
function lo3(s212) {
  let t8 = s212.dom.lastChild;
  if (!t8) return s212.dom.getBoundingClientRect();
  let e7 = At4(t8);
  return e7[e7.length - 1] || null;
}
function Je4(s212, t8) {
  for (let e7 in s212) e7 == "class" && t8.class ? t8.class += " " + s212.class : e7 == "style" && t8.style ? t8.style += ";" + s212.style : t8[e7] = s212[e7];
  return t8;
}
var Qi3 = /* @__PURE__ */ Object.create(null);
function Se5(s212, t8, e7) {
  if (s212 == t8) return true;
  s212 || (s212 = Qi3), t8 || (t8 = Qi3);
  let i12 = Object.keys(s212), n14 = Object.keys(t8);
  if (i12.length - (e7 && i12.indexOf(e7) > -1 ? 1 : 0) != n14.length - (e7 && n14.indexOf(e7) > -1 ? 1 : 0)) return false;
  for (let o of i12) if (o != e7 && (n14.indexOf(o) == -1 || s212[o] !== t8[o])) return false;
  return true;
}
function Ze5(s212, t8, e7) {
  let i12 = false;
  if (t8) for (let n14 in t8) e7 && n14 in e7 || (i12 = true, n14 == "style" ? s212.style.cssText = "" : s212.removeAttribute(n14));
  if (e7) for (let n14 in e7) t8 && t8[n14] == e7[n14] || (i12 = true, n14 == "style" ? s212.style.cssText = e7[n14] : s212.setAttribute(n14, e7[n14]));
  return i12;
}
function ho3(s212) {
  let t8 = /* @__PURE__ */ Object.create(null);
  for (let e7 = 0; e7 < s212.attributes.length; e7++) {
    let i12 = s212.attributes[e7];
    t8[i12.name] = i12.value;
  }
  return t8;
}
var lt4 = class {
  eq(t8) {
    return false;
  }
  updateDOM(t8, e7) {
    return false;
  }
  compare(t8) {
    return this == t8 || this.constructor == t8.constructor && this.eq(t8);
  }
  get estimatedHeight() {
    return -1;
  }
  get lineBreaks() {
    return 0;
  }
  ignoreEvent(t8) {
    return true;
  }
  coordsAt(t8, e7, i12) {
    return null;
  }
  get isHidden() {
    return false;
  }
  get editable() {
    return false;
  }
  destroy(t8) {
  }
};
var F7 = function(s212) {
  return s212[s212.Text = 0] = "Text", s212[s212.WidgetBefore = 1] = "WidgetBefore", s212[s212.WidgetAfter = 2] = "WidgetAfter", s212[s212.WidgetRange = 3] = "WidgetRange", s212;
}(F7 || (F7 = {}));
var O5 = class extends W {
  constructor(t8, e7, i12, n14) {
    super(), this.startSide = t8, this.endSide = e7, this.widget = i12, this.spec = n14;
  }
  get heightRelevant() {
    return false;
  }
  static mark(t8) {
    return new Xt3(t8);
  }
  static widget(t8) {
    let e7 = Math.max(-1e4, Math.min(1e4, t8.side || 0)), i12 = !!t8.block;
    return e7 += i12 && !t8.inlineOrder ? e7 > 0 ? 3e8 : -4e8 : e7 > 0 ? 1e8 : -1e8, new ht4(t8, e7, e7, i12, t8.widget || null, false);
  }
  static replace(t8) {
    let e7 = !!t8.block, i12, n14;
    if (t8.isBlockGap) i12 = -5e8, n14 = 4e8;
    else {
      let { start: o, end: r2 } = Us3(t8, e7);
      i12 = (o ? e7 ? -3e8 : -1 : 5e8) - 1, n14 = (r2 ? e7 ? 2e8 : 1 : -6e8) + 1;
    }
    return new ht4(t8, i12, n14, e7, t8.widget || null, true);
  }
  static line(t8) {
    return new Gt4(t8);
  }
  static set(t8, e7 = false) {
    return T.of(t8, e7);
  }
  hasHeight() {
    return this.widget ? this.widget.estimatedHeight > -1 : false;
  }
};
O5.none = T.empty;
var Xt3 = class s88 extends O5 {
  constructor(t8) {
    let { start: e7, end: i12 } = Us3(t8);
    super(e7 ? -1 : 5e8, i12 ? 1 : -6e8, null, t8), this.tagName = t8.tagName || "span", this.class = t8.class || "", this.attrs = t8.attributes || null;
  }
  eq(t8) {
    var e7, i12;
    return this == t8 || t8 instanceof s88 && this.tagName == t8.tagName && (this.class || ((e7 = this.attrs) === null || e7 === void 0 ? void 0 : e7.class)) == (t8.class || ((i12 = t8.attrs) === null || i12 === void 0 ? void 0 : i12.class)) && Se5(this.attrs, t8.attrs, "class");
  }
  range(t8, e7 = t8) {
    if (t8 >= e7) throw new RangeError("Mark decorations may not be empty");
    return super.range(t8, e7);
  }
};
Xt3.prototype.point = false;
var Gt4 = class s89 extends O5 {
  constructor(t8) {
    super(-2e8, -2e8, null, t8);
  }
  eq(t8) {
    return t8 instanceof s89 && this.spec.class == t8.spec.class && Se5(this.spec.attributes, t8.spec.attributes);
  }
  range(t8, e7 = t8) {
    if (e7 != t8) throw new RangeError("Line decoration ranges must be zero-length");
    return super.range(t8, e7);
  }
};
Gt4.prototype.mapMode = E.TrackBefore;
Gt4.prototype.point = true;
var ht4 = class s90 extends O5 {
  constructor(t8, e7, i12, n14, o, r2) {
    super(e7, i12, o, t8), this.block = n14, this.isReplace = r2, this.mapMode = n14 ? e7 <= 0 ? E.TrackBefore : E.TrackAfter : E.TrackDel;
  }
  get type() {
    return this.startSide != this.endSide ? F7.WidgetRange : this.startSide <= 0 ? F7.WidgetBefore : F7.WidgetAfter;
  }
  get heightRelevant() {
    return this.block || !!this.widget && (this.widget.estimatedHeight >= 5 || this.widget.lineBreaks > 0);
  }
  eq(t8) {
    return t8 instanceof s90 && ao3(this.widget, t8.widget) && this.block == t8.block && this.startSide == t8.startSide && this.endSide == t8.endSide;
  }
  range(t8, e7 = t8) {
    if (this.isReplace && (t8 > e7 || t8 == e7 && this.startSide > 0 && this.endSide <= 0)) throw new RangeError("Invalid range for replacement decoration");
    if (!this.isReplace && e7 != t8) throw new RangeError("Widget decorations can only have zero-length ranges");
    return super.range(t8, e7);
  }
};
ht4.prototype.point = true;
function Us3(s212, t8 = false) {
  let { inclusiveStart: e7, inclusiveEnd: i12 } = s212;
  return e7 == null && (e7 = s212.inclusive), i12 == null && (i12 = s212.inclusive), { start: e7 ?? t8, end: i12 ?? t8 };
}
function ao3(s212, t8) {
  return s212 == t8 || !!(s212 && t8 && s212.compare(t8));
}
function ti3(s212, t8, e7, i12 = 0) {
  let n14 = e7.length - 1;
  n14 >= 0 && e7[n14] + i12 >= s212 ? e7[n14] = Math.max(e7[n14], t8) : e7.push(s212, t8);
}
var P6 = class s91 extends R5 {
  constructor() {
    super(...arguments), this.children = [], this.length = 0, this.prevAttrs = void 0, this.attrs = null, this.breakAfter = 0;
  }
  merge(t8, e7, i12, n14, o, r2) {
    if (i12) {
      if (!(i12 instanceof s91)) return false;
      this.dom || i12.transferDOM(this);
    }
    return n14 && this.setDeco(i12 ? i12.attrs : null), js3(this, t8, e7, i12 ? i12.children.slice() : [], o, r2), true;
  }
  split(t8) {
    let e7 = new s91();
    if (e7.breakAfter = this.breakAfter, this.length == 0) return e7;
    let { i: i12, off: n14 } = this.childPos(t8);
    n14 && (e7.append(this.children[i12].split(n14), 0), this.children[i12].merge(n14, this.children[i12].length, null, false, 0, 0), i12++);
    for (let o = i12; o < this.children.length; o++) e7.append(this.children[o], 0);
    for (; i12 > 0 && this.children[i12 - 1].length == 0; ) this.children[--i12].destroy();
    return this.children.length = i12, this.markDirty(), this.length = t8, e7;
  }
  transferDOM(t8) {
    this.dom && (this.markDirty(), t8.setDOM(this.dom), t8.prevAttrs = this.prevAttrs === void 0 ? this.attrs : this.prevAttrs, this.prevAttrs = void 0, this.dom = null);
  }
  setDeco(t8) {
    Se5(this.attrs, t8) || (this.dom && (this.prevAttrs = this.attrs, this.markDirty()), this.attrs = t8);
  }
  append(t8, e7) {
    Gs3(this, t8, e7);
  }
  addLineDeco(t8) {
    let e7 = t8.spec.attributes, i12 = t8.spec.class;
    e7 && (this.attrs = Je4(e7, this.attrs || {})), i12 && (this.attrs = Je4({ class: i12 }, this.attrs || {}));
  }
  domAtPos(t8) {
    return Xs3(this, t8);
  }
  reuseDOM(t8) {
    t8.nodeName == "DIV" && (this.setDOM(t8), this.flags |= 6);
  }
  sync(t8, e7) {
    var i12;
    this.dom ? this.flags & 4 && (Ws3(this.dom), this.dom.className = "cm-line", this.prevAttrs = this.attrs ? null : void 0) : (this.setDOM(document.createElement("div")), this.dom.className = "cm-line", this.prevAttrs = this.attrs ? null : void 0), this.prevAttrs !== void 0 && (Ze5(this.dom, this.prevAttrs, this.attrs), this.dom.classList.add("cm-line"), this.prevAttrs = void 0), super.sync(t8, e7);
    let n14 = this.dom.lastChild;
    for (; n14 && R5.get(n14) instanceof rt5; ) n14 = n14.lastChild;
    if (!n14 || !this.length || n14.nodeName != "BR" && ((i12 = R5.get(n14)) === null || i12 === void 0 ? void 0 : i12.isEditable) == false && (!y6.ios || !this.children.some((o) => o instanceof Q6))) {
      let o = document.createElement("BR");
      o.cmIgnore = true, this.dom.appendChild(o);
    }
  }
  measureTextSize() {
    if (this.children.length == 0 || this.length > 20) return null;
    let t8 = 0, e7;
    for (let i12 of this.children) {
      if (!(i12 instanceof Q6) || /[^ -~]/.test(i12.text)) return null;
      let n14 = At4(i12.dom);
      if (n14.length != 1) return null;
      t8 += n14[0].width, e7 = n14[0].height;
    }
    return t8 ? { lineHeight: this.dom.getBoundingClientRect().height, charWidth: t8 / this.length, textHeight: e7 } : null;
  }
  coordsAt(t8, e7) {
    let i12 = $s3(this, t8, e7);
    if (!this.children.length && i12 && this.parent) {
      let { heightOracle: n14 } = this.parent.view.viewState, o = i12.bottom - i12.top;
      if (Math.abs(o - n14.lineHeight) < 2 && n14.textHeight < o) {
        let r2 = (o - n14.textHeight) / 2;
        return { top: i12.top + r2, bottom: i12.bottom - r2, left: i12.left, right: i12.left };
      }
    }
    return i12;
  }
  become(t8) {
    return t8 instanceof s91 && this.children.length == 0 && t8.children.length == 0 && Se5(this.attrs, t8.attrs) && this.breakAfter == t8.breakAfter;
  }
  covers() {
    return true;
  }
  static find(t8, e7) {
    for (let i12 = 0, n14 = 0; i12 < t8.children.length; i12++) {
      let o = t8.children[i12], r2 = n14 + o.length;
      if (r2 >= e7) {
        if (o instanceof s91) return o;
        if (r2 > e7) break;
      }
      n14 = r2 + o.breakAfter;
    }
    return null;
  }
};
var dt4 = class s92 extends R5 {
  constructor(t8, e7, i12) {
    super(), this.widget = t8, this.length = e7, this.deco = i12, this.breakAfter = 0, this.prevWidget = null;
  }
  merge(t8, e7, i12, n14, o, r2) {
    return i12 && (!(i12 instanceof s92) || !this.widget.compare(i12.widget) || t8 > 0 && o <= 0 || e7 < this.length && r2 <= 0) ? false : (this.length = t8 + (i12 ? i12.length : 0) + (this.length - e7), true);
  }
  domAtPos(t8) {
    return t8 == 0 ? V6.before(this.dom) : V6.after(this.dom, t8 == this.length);
  }
  split(t8) {
    let e7 = this.length - t8;
    this.length = t8;
    let i12 = new s92(this.widget, e7, this.deco);
    return i12.breakAfter = this.breakAfter, i12;
  }
  get children() {
    return Fi3;
  }
  sync(t8) {
    (!this.dom || !this.widget.updateDOM(this.dom, t8)) && (this.dom && this.prevWidget && this.prevWidget.destroy(this.dom), this.prevWidget = null, this.setDOM(this.widget.toDOM(t8)), this.widget.editable || (this.dom.contentEditable = "false"));
  }
  get overrideDOMText() {
    return this.parent ? this.parent.view.state.doc.slice(this.posAtStart, this.posAtEnd) : m.empty;
  }
  domBoundsAround() {
    return null;
  }
  become(t8) {
    return t8 instanceof s92 && t8.widget.constructor == this.widget.constructor ? (t8.widget.compare(this.widget) || this.markDirty(true), this.dom && !this.prevWidget && (this.prevWidget = this.widget), this.widget = t8.widget, this.length = t8.length, this.deco = t8.deco, this.breakAfter = t8.breakAfter, true) : false;
  }
  ignoreMutation() {
    return true;
  }
  ignoreEvent(t8) {
    return this.widget.ignoreEvent(t8);
  }
  get isEditable() {
    return false;
  }
  get isWidget() {
    return true;
  }
  coordsAt(t8, e7) {
    let i12 = this.widget.coordsAt(this.dom, t8, e7);
    return i12 || (this.widget instanceof $t4 ? null : te6(this.dom.getBoundingClientRect(), this.length ? t8 == 0 : e7 <= 0));
  }
  destroy() {
    super.destroy(), this.dom && this.widget.destroy(this.dom);
  }
  covers(t8) {
    let { startSide: e7, endSide: i12 } = this.deco;
    return e7 == i12 ? false : t8 < 0 ? e7 < 0 : i12 > 0;
  }
};
var $t4 = class extends lt4 {
  constructor(t8) {
    super(), this.height = t8;
  }
  toDOM() {
    let t8 = document.createElement("div");
    return t8.className = "cm-gap", this.updateDOM(t8), t8;
  }
  eq(t8) {
    return t8.height == this.height;
  }
  updateDOM(t8) {
    return t8.style.height = this.height + "px", true;
  }
  get editable() {
    return true;
  }
  get estimatedHeight() {
    return this.height;
  }
  ignoreEvent() {
    return false;
  }
};
var Ft4 = class s93 {
  constructor(t8, e7, i12, n14) {
    this.doc = t8, this.pos = e7, this.end = i12, this.disallowBlockEffectsFor = n14, this.content = [], this.curLine = null, this.breakAtStart = 0, this.pendingBuffer = 0, this.bufferMarks = [], this.atCursorPos = true, this.openStart = -1, this.openEnd = -1, this.text = "", this.textOff = 0, this.cursor = t8.iter(), this.skip = e7;
  }
  posCovered() {
    if (this.content.length == 0) return !this.breakAtStart && this.doc.lineAt(this.pos).from != this.pos;
    let t8 = this.content[this.content.length - 1];
    return !(t8.breakAfter || t8 instanceof dt4 && t8.deco.endSide < 0);
  }
  getLine() {
    return this.curLine || (this.content.push(this.curLine = new P6()), this.atCursorPos = true), this.curLine;
  }
  flushBuffer(t8 = this.bufferMarks) {
    this.pendingBuffer && (this.curLine.append(ne5(new _t4(-1), t8), t8.length), this.pendingBuffer = 0);
  }
  addBlockWidget(t8) {
    this.flushBuffer(), this.curLine = null, this.content.push(t8);
  }
  finish(t8) {
    this.pendingBuffer && t8 <= this.bufferMarks.length ? this.flushBuffer() : this.pendingBuffer = 0, !this.posCovered() && !(t8 && this.content.length && this.content[this.content.length - 1] instanceof dt4) && this.getLine();
  }
  buildText(t8, e7, i12) {
    for (; t8 > 0; ) {
      if (this.textOff == this.text.length) {
        let { value: o, lineBreak: r2, done: l11 } = this.cursor.next(this.skip);
        if (this.skip = 0, l11) throw new Error("Ran out of text content when drawing inline views");
        if (r2) {
          this.posCovered() || this.getLine(), this.content.length ? this.content[this.content.length - 1].breakAfter = 1 : this.breakAtStart = 1, this.flushBuffer(), this.curLine = null, this.atCursorPos = true, t8--;
          continue;
        } else this.text = o, this.textOff = 0;
      }
      let n14 = Math.min(this.text.length - this.textOff, t8, 512);
      this.flushBuffer(e7.slice(e7.length - i12)), this.getLine().append(ne5(new Q6(this.text.slice(this.textOff, this.textOff + n14)), e7), i12), this.atCursorPos = true, this.textOff += n14, t8 -= n14, i12 = 0;
    }
  }
  span(t8, e7, i12, n14) {
    this.buildText(e7 - t8, i12, n14), this.pos = e7, this.openStart < 0 && (this.openStart = n14);
  }
  point(t8, e7, i12, n14, o, r2) {
    if (this.disallowBlockEffectsFor[r2] && i12 instanceof ht4) {
      if (i12.block) throw new RangeError("Block decorations may not be specified via plugins");
      if (e7 > this.doc.lineAt(this.pos).to) throw new RangeError("Decorations that replace line breaks may not be specified via plugins");
    }
    let l11 = e7 - t8;
    if (i12 instanceof ht4) if (i12.block) i12.startSide > 0 && !this.posCovered() && this.getLine(), this.addBlockWidget(new dt4(i12.widget || at5.block, l11, i12));
    else {
      let h3 = Yt4.create(i12.widget || at5.inline, l11, l11 ? 0 : i12.startSide), c3 = this.atCursorPos && !h3.isEditable && o <= n14.length && (t8 < e7 || i12.startSide > 0), a2 = !h3.isEditable && (t8 < e7 || o > n14.length || i12.startSide <= 0), f6 = this.getLine();
      this.pendingBuffer == 2 && !c3 && !h3.isEditable && (this.pendingBuffer = 0), this.flushBuffer(n14), c3 && (f6.append(ne5(new _t4(1), n14), o), o = n14.length + Math.max(0, o - n14.length)), f6.append(ne5(h3, n14), o), this.atCursorPos = a2, this.pendingBuffer = a2 ? t8 < e7 || o > n14.length ? 1 : 2 : 0, this.pendingBuffer && (this.bufferMarks = n14.slice());
    }
    else this.doc.lineAt(this.pos).from == this.pos && this.getLine().addLineDeco(i12);
    l11 && (this.textOff + l11 <= this.text.length ? this.textOff += l11 : (this.skip += l11 - (this.text.length - this.textOff), this.text = "", this.textOff = 0), this.pos = e7), this.openStart < 0 && (this.openStart = o);
  }
  static build(t8, e7, i12, n14, o) {
    let r2 = new s93(t8, e7, i12, o);
    return r2.openEnd = T.spans(n14, e7, i12, r2), r2.openStart < 0 && (r2.openStart = r2.openEnd), r2.finish(r2.openEnd), r2;
  }
};
function ne5(s212, t8) {
  for (let e7 of t8) s212 = new rt5(e7, [s212], s212.length);
  return s212;
}
var at5 = class extends lt4 {
  constructor(t8) {
    super(), this.tag = t8;
  }
  eq(t8) {
    return t8.tag == this.tag;
  }
  toDOM() {
    return document.createElement(this.tag);
  }
  updateDOM(t8) {
    return t8.nodeName.toLowerCase() == this.tag;
  }
  get isHidden() {
    return true;
  }
};
at5.inline = new at5("span");
at5.block = new at5("div");
var L5 = function(s212) {
  return s212[s212.LTR = 0] = "LTR", s212[s212.RTL = 1] = "RTL", s212;
}(L5 || (L5 = {}));
var gt3 = L5.LTR;
var Wi3 = L5.RTL;
function Qs3(s212) {
  let t8 = [];
  for (let e7 = 0; e7 < s212.length; e7++) t8.push(1 << +s212[e7]);
  return t8;
}
var co3 = Qs3("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008");
var fo3 = Qs3("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333");
var ei3 = /* @__PURE__ */ Object.create(null);
var _5 = [];
for (let s212 of ["()", "[]", "{}"]) {
  let t8 = s212.charCodeAt(0), e7 = s212.charCodeAt(1);
  ei3[t8] = e7, ei3[e7] = -t8;
}
function Js3(s212) {
  return s212 <= 247 ? co3[s212] : 1424 <= s212 && s212 <= 1524 ? 2 : 1536 <= s212 && s212 <= 1785 ? fo3[s212 - 1536] : 1774 <= s212 && s212 <= 2220 ? 4 : 8192 <= s212 && s212 <= 8204 ? 256 : 64336 <= s212 && s212 <= 65023 ? 4 : 1;
}
var uo3 = /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;
var G7 = class {
  get dir() {
    return this.level % 2 ? Wi3 : gt3;
  }
  constructor(t8, e7, i12) {
    this.from = t8, this.to = e7, this.level = i12;
  }
  side(t8, e7) {
    return this.dir == e7 == t8 ? this.to : this.from;
  }
  forward(t8, e7) {
    return t8 == (this.dir == e7);
  }
  static find(t8, e7, i12, n14) {
    let o = -1;
    for (let r2 = 0; r2 < t8.length; r2++) {
      let l11 = t8[r2];
      if (l11.from <= e7 && l11.to >= e7) {
        if (l11.level == i12) return r2;
        (o < 0 || (n14 != 0 ? n14 < 0 ? l11.from < e7 : l11.to > e7 : t8[o].level > l11.level)) && (o = r2);
      }
    }
    if (o < 0) throw new RangeError("Index out of range");
    return o;
  }
};
function Zs3(s212, t8) {
  if (s212.length != t8.length) return false;
  for (let e7 = 0; e7 < s212.length; e7++) {
    let i12 = s212[e7], n14 = t8[e7];
    if (i12.from != n14.from || i12.to != n14.to || i12.direction != n14.direction || !Zs3(i12.inner, n14.inner)) return false;
  }
  return true;
}
var D5 = [];
function po3(s212, t8, e7, i12, n14) {
  for (let o = 0; o <= i12.length; o++) {
    let r2 = o ? i12[o - 1].to : t8, l11 = o < i12.length ? i12[o].from : e7, h3 = o ? 256 : n14;
    for (let c3 = r2, a2 = h3, f6 = h3; c3 < l11; c3++) {
      let d4 = Js3(s212.charCodeAt(c3));
      d4 == 512 ? d4 = a2 : d4 == 8 && f6 == 4 && (d4 = 16), D5[c3] = d4 == 4 ? 2 : d4, d4 & 7 && (f6 = d4), a2 = d4;
    }
    for (let c3 = r2, a2 = h3, f6 = h3; c3 < l11; c3++) {
      let d4 = D5[c3];
      if (d4 == 128) c3 < l11 - 1 && a2 == D5[c3 + 1] && a2 & 24 ? d4 = D5[c3] = a2 : D5[c3] = 256;
      else if (d4 == 64) {
        let u3 = c3 + 1;
        for (; u3 < l11 && D5[u3] == 64; ) u3++;
        let p3 = c3 && a2 == 8 || u3 < e7 && D5[u3] == 8 ? f6 == 1 ? 1 : 8 : 256;
        for (let g8 = c3; g8 < u3; g8++) D5[g8] = p3;
        c3 = u3 - 1;
      } else d4 == 8 && f6 == 1 && (D5[c3] = 1);
      a2 = d4, d4 & 7 && (f6 = d4);
    }
  }
}
function go3(s212, t8, e7, i12, n14) {
  let o = n14 == 1 ? 2 : 1;
  for (let r2 = 0, l11 = 0, h3 = 0; r2 <= i12.length; r2++) {
    let c3 = r2 ? i12[r2 - 1].to : t8, a2 = r2 < i12.length ? i12[r2].from : e7;
    for (let f6 = c3, d4, u3, p3; f6 < a2; f6++) if (u3 = ei3[d4 = s212.charCodeAt(f6)]) if (u3 < 0) {
      for (let g8 = l11 - 3; g8 >= 0; g8 -= 3) if (_5[g8 + 1] == -u3) {
        let b12 = _5[g8 + 2], m11 = b12 & 2 ? n14 : b12 & 4 ? b12 & 1 ? o : n14 : 0;
        m11 && (D5[f6] = D5[_5[g8]] = m11), l11 = g8;
        break;
      }
    } else {
      if (_5.length == 189) break;
      _5[l11++] = f6, _5[l11++] = d4, _5[l11++] = h3;
    }
    else if ((p3 = D5[f6]) == 2 || p3 == 1) {
      let g8 = p3 == n14;
      h3 = g8 ? 0 : 1;
      for (let b12 = l11 - 3; b12 >= 0; b12 -= 3) {
        let m11 = _5[b12 + 2];
        if (m11 & 2) break;
        if (g8) _5[b12 + 2] |= 2;
        else {
          if (m11 & 4) break;
          _5[b12 + 2] |= 4;
        }
      }
    }
  }
}
function mo3(s212, t8, e7, i12) {
  for (let n14 = 0, o = i12; n14 <= e7.length; n14++) {
    let r2 = n14 ? e7[n14 - 1].to : s212, l11 = n14 < e7.length ? e7[n14].from : t8;
    for (let h3 = r2; h3 < l11; ) {
      let c3 = D5[h3];
      if (c3 == 256) {
        let a2 = h3 + 1;
        for (; ; ) if (a2 == l11) {
          if (n14 == e7.length) break;
          a2 = e7[n14++].to, l11 = n14 < e7.length ? e7[n14].from : t8;
        } else if (D5[a2] == 256) a2++;
        else break;
        let f6 = o == 1, d4 = (a2 < t8 ? D5[a2] : i12) == 1, u3 = f6 == d4 ? f6 ? 1 : 2 : i12;
        for (let p3 = a2, g8 = n14, b12 = g8 ? e7[g8 - 1].to : s212; p3 > h3; ) p3 == b12 && (p3 = e7[--g8].from, b12 = g8 ? e7[g8 - 1].to : s212), D5[--p3] = u3;
        h3 = a2;
      } else o = c3, h3++;
    }
  }
}
function ii3(s212, t8, e7, i12, n14, o, r2) {
  let l11 = i12 % 2 ? 2 : 1;
  if (i12 % 2 == n14 % 2) for (let h3 = t8, c3 = 0; h3 < e7; ) {
    let a2 = true, f6 = false;
    if (c3 == o.length || h3 < o[c3].from) {
      let g8 = D5[h3];
      g8 != l11 && (a2 = false, f6 = g8 == 16);
    }
    let d4 = !a2 && l11 == 1 ? [] : null, u3 = a2 ? i12 : i12 + 1, p3 = h3;
    t: for (; ; ) if (c3 < o.length && p3 == o[c3].from) {
      if (f6) break t;
      let g8 = o[c3];
      if (!a2) for (let b12 = g8.to, m11 = c3 + 1; ; ) {
        if (b12 == e7) break t;
        if (m11 < o.length && o[m11].from == b12) b12 = o[m11++].to;
        else {
          if (D5[b12] == l11) break t;
          break;
        }
      }
      if (c3++, d4) d4.push(g8);
      else {
        g8.from > h3 && r2.push(new G7(h3, g8.from, u3));
        let b12 = g8.direction == gt3 != !(u3 % 2);
        si3(s212, b12 ? i12 + 1 : i12, n14, g8.inner, g8.from, g8.to, r2), h3 = g8.to;
      }
      p3 = g8.to;
    } else {
      if (p3 == e7 || (a2 ? D5[p3] != l11 : D5[p3] == l11)) break;
      p3++;
    }
    d4 ? ii3(s212, h3, p3, i12 + 1, n14, d4, r2) : h3 < p3 && r2.push(new G7(h3, p3, u3)), h3 = p3;
  }
  else for (let h3 = e7, c3 = o.length; h3 > t8; ) {
    let a2 = true, f6 = false;
    if (!c3 || h3 > o[c3 - 1].to) {
      let g8 = D5[h3 - 1];
      g8 != l11 && (a2 = false, f6 = g8 == 16);
    }
    let d4 = !a2 && l11 == 1 ? [] : null, u3 = a2 ? i12 : i12 + 1, p3 = h3;
    t: for (; ; ) if (c3 && p3 == o[c3 - 1].to) {
      if (f6) break t;
      let g8 = o[--c3];
      if (!a2) for (let b12 = g8.from, m11 = c3; ; ) {
        if (b12 == t8) break t;
        if (m11 && o[m11 - 1].to == b12) b12 = o[--m11].from;
        else {
          if (D5[b12 - 1] == l11) break t;
          break;
        }
      }
      if (d4) d4.push(g8);
      else {
        g8.to < h3 && r2.push(new G7(g8.to, h3, u3));
        let b12 = g8.direction == gt3 != !(u3 % 2);
        si3(s212, b12 ? i12 + 1 : i12, n14, g8.inner, g8.from, g8.to, r2), h3 = g8.from;
      }
      p3 = g8.from;
    } else {
      if (p3 == t8 || (a2 ? D5[p3 - 1] != l11 : D5[p3 - 1] == l11)) break;
      p3--;
    }
    d4 ? ii3(s212, p3, h3, i12 + 1, n14, d4, r2) : p3 < h3 && r2.push(new G7(p3, h3, u3)), h3 = p3;
  }
}
function si3(s212, t8, e7, i12, n14, o, r2) {
  let l11 = t8 % 2 ? 2 : 1;
  po3(s212, n14, o, i12, l11), go3(s212, n14, o, i12, l11), mo3(n14, o, i12, l11), ii3(s212, n14, o, t8, e7, i12, r2);
}
function tn4(s212, t8, e7) {
  if (!s212) return [new G7(0, 0, t8 == Wi3 ? 1 : 0)];
  if (t8 == gt3 && !e7.length && !uo3.test(s212)) return en3(s212.length);
  if (e7.length) for (; s212.length > D5.length; ) D5[D5.length] = 256;
  let i12 = [], n14 = t8 == gt3 ? 0 : 1;
  return si3(s212, n14, n14, e7, 0, s212.length, i12), i12;
}
function en3(s212) {
  return [new G7(0, s212, 0)];
}
var sn3 = "";
function nn3(s212, t8, e7, i12, n14) {
  var o;
  let r2 = i12.head - s212.from, l11 = G7.find(t8, r2, (o = i12.bidiLevel) !== null && o !== void 0 ? o : -1, i12.assoc), h3 = t8[l11], c3 = h3.side(n14, e7);
  if (r2 == c3) {
    let d4 = l11 += n14 ? 1 : -1;
    if (d4 < 0 || d4 >= t8.length) return null;
    h3 = t8[l11 = d4], r2 = h3.side(!n14, e7), c3 = h3.side(n14, e7);
  }
  let a2 = ee(s212.text, r2, h3.forward(n14, e7));
  (a2 < h3.from || a2 > h3.to) && (a2 = c3), sn3 = s212.text.slice(Math.min(r2, a2), Math.max(r2, a2));
  let f6 = l11 == (n14 ? t8.length - 1 : 0) ? null : t8[l11 + (n14 ? 1 : -1)];
  return f6 && a2 == c3 && f6.level + (n14 ? 0 : 1) < h3.level ? x.cursor(f6.side(!n14, e7) + s212.from, f6.forward(n14, e7) ? 1 : -1, f6.level) : x.cursor(a2 + s212.from, h3.forward(n14, e7) ? -1 : 1, h3.level);
}
function bo3(s212, t8, e7) {
  for (let i12 = t8; i12 < e7; i12++) {
    let n14 = Js3(s212.charCodeAt(i12));
    if (n14 == 1) return gt3;
    if (n14 == 2 || n14 == 4) return Wi3;
  }
  return gt3;
}
var on3 = y.define();
var rn3 = y.define();
var ln3 = y.define();
var hn3 = y.define();
var ni3 = y.define();
var an3 = y.define();
var cn3 = y.define();
var zi3 = y.define();
var Ii3 = y.define();
var fn3 = y.define({ combine: (s212) => s212.some((t8) => t8) });
var dn3 = y.define({ combine: (s212) => s212.some((t8) => t8) });
var un3 = y.define();
var Wt4 = class s94 {
  constructor(t8, e7 = "nearest", i12 = "nearest", n14 = 5, o = 5, r2 = false) {
    this.range = t8, this.y = e7, this.x = i12, this.yMargin = n14, this.xMargin = o, this.isSnapshot = r2;
  }
  map(t8) {
    return t8.empty ? this : new s94(this.range.map(t8), this.y, this.x, this.yMargin, this.xMargin, this.isSnapshot);
  }
  clip(t8) {
    return this.range.to <= t8.doc.length ? this : new s94(x.cursor(t8.doc.length), this.y, this.x, this.yMargin, this.xMargin, this.isSnapshot);
  }
};
var oe4 = v.define({ map: (s212, t8) => s212.map(t8) });
var pn3 = v.define();
function $4(s212, t8, e7) {
  let i12 = s212.facet(hn3);
  i12.length ? i12[0](t8) : window.onerror ? window.onerror(String(t8), e7, void 0, void 0, t8) : e7 ? console.error(e7 + ":", t8) : console.error(t8);
}
var st5 = y.define({ combine: (s212) => s212.length ? s212[0] : true });
var yo3 = 0;
var Et4 = y.define();
var N6 = class s95 {
  constructor(t8, e7, i12, n14, o) {
    this.id = t8, this.create = e7, this.domEventHandlers = i12, this.domEventObservers = n14, this.extension = o(this);
  }
  static define(t8, e7) {
    let { eventHandlers: i12, eventObservers: n14, provide: o, decorations: r2 } = e7 || {};
    return new s95(yo3++, t8, i12, n14, (l11) => {
      let h3 = [Et4.of(l11)];
      return r2 && h3.push(Ut4.of((c3) => {
        let a2 = c3.plugin(l11);
        return a2 ? r2(a2) : O5.none;
      })), o && h3.push(o(l11)), h3;
    });
  }
  static fromClass(t8, e7) {
    return s95.define((i12) => new t8(i12), e7);
  }
};
var zt4 = class {
  constructor(t8) {
    this.spec = t8, this.mustUpdate = null, this.value = null;
  }
  update(t8) {
    if (this.value) {
      if (this.mustUpdate) {
        let e7 = this.mustUpdate;
        if (this.mustUpdate = null, this.value.update) try {
          this.value.update(e7);
        } catch (i12) {
          if ($4(e7.state, i12, "CodeMirror plugin crashed"), this.value.destroy) try {
            this.value.destroy();
          } catch {
          }
          this.deactivate();
        }
      }
    } else if (this.spec) try {
      this.value = this.spec.create(t8);
    } catch (e7) {
      $4(t8.state, e7, "CodeMirror plugin crashed"), this.deactivate();
    }
    return this;
  }
  destroy(t8) {
    var e7;
    if (!((e7 = this.value) === null || e7 === void 0) && e7.destroy) try {
      this.value.destroy();
    } catch (i12) {
      $4(t8.state, i12, "CodeMirror plugin crashed");
    }
  }
  deactivate() {
    this.spec = this.value = null;
  }
};
var gn3 = y.define();
var Ve5 = y.define();
var Ut4 = y.define();
var mn3 = y.define();
var Ki3 = y.define();
var bn3 = y.define();
function Ji3(s212, t8) {
  let e7 = s212.state.facet(bn3);
  if (!e7.length) return e7;
  let i12 = e7.map((o) => o instanceof Function ? o(s212) : o), n14 = [];
  return T.spans(i12, t8.from, t8.to, { point() {
  }, span(o, r2, l11, h3) {
    let c3 = o - t8.from, a2 = r2 - t8.from, f6 = n14;
    for (let d4 = l11.length - 1; d4 >= 0; d4--, h3--) {
      let u3 = l11[d4].spec.bidiIsolate, p3;
      if (u3 == null && (u3 = bo3(t8.text, c3, a2)), h3 > 0 && f6.length && (p3 = f6[f6.length - 1]).to == c3 && p3.direction == u3) p3.to = a2, f6 = p3.inner;
      else {
        let g8 = { from: c3, to: a2, direction: u3, inner: [] };
        f6.push(g8), f6 = g8.inner;
      }
    }
  } }), n14;
}
var yn3 = y.define();
function wn3(s212) {
  let t8 = 0, e7 = 0, i12 = 0, n14 = 0;
  for (let o of s212.state.facet(yn3)) {
    let r2 = o(s212);
    r2 && (r2.left != null && (t8 = Math.max(t8, r2.left)), r2.right != null && (e7 = Math.max(e7, r2.right)), r2.top != null && (i12 = Math.max(i12, r2.top)), r2.bottom != null && (n14 = Math.max(n14, r2.bottom)));
  }
  return { left: t8, right: e7, top: i12, bottom: n14 };
}
var Lt3 = y.define();
var j6 = class s96 {
  constructor(t8, e7, i12, n14) {
    this.fromA = t8, this.toA = e7, this.fromB = i12, this.toB = n14;
  }
  join(t8) {
    return new s96(Math.min(this.fromA, t8.fromA), Math.max(this.toA, t8.toA), Math.min(this.fromB, t8.fromB), Math.max(this.toB, t8.toB));
  }
  addToSet(t8) {
    let e7 = t8.length, i12 = this;
    for (; e7 > 0; e7--) {
      let n14 = t8[e7 - 1];
      if (!(n14.fromA > i12.toA)) {
        if (n14.toA < i12.fromA) break;
        i12 = i12.join(n14), t8.splice(e7 - 1, 1);
      }
    }
    return t8.splice(e7, 0, i12), t8;
  }
  static extendWithRanges(t8, e7) {
    if (e7.length == 0) return t8;
    let i12 = [];
    for (let n14 = 0, o = 0, r2 = 0, l11 = 0; ; n14++) {
      let h3 = n14 == t8.length ? null : t8[n14], c3 = r2 - l11, a2 = h3 ? h3.fromB : 1e9;
      for (; o < e7.length && e7[o] < a2; ) {
        let f6 = e7[o], d4 = e7[o + 1], u3 = Math.max(l11, f6), p3 = Math.min(a2, d4);
        if (u3 <= p3 && new s96(u3 + c3, p3 + c3, u3, p3).addToSet(i12), d4 > a2) break;
        o += 2;
      }
      if (!h3) return i12;
      new s96(h3.fromA, h3.toA, h3.fromB, h3.toB).addToSet(i12), r2 = h3.toA, l11 = h3.toB;
    }
  }
};
var Ce4 = class s97 {
  constructor(t8, e7, i12) {
    this.view = t8, this.state = e7, this.transactions = i12, this.flags = 0, this.startState = t8.state, this.changes = A.empty(this.startState.doc.length);
    for (let o of i12) this.changes = this.changes.compose(o.changes);
    let n14 = [];
    this.changes.iterChangedRanges((o, r2, l11, h3) => n14.push(new j6(o, r2, l11, h3))), this.changedRanges = n14;
  }
  static create(t8, e7, i12) {
    return new s97(t8, e7, i12);
  }
  get viewportChanged() {
    return (this.flags & 4) > 0;
  }
  get heightChanged() {
    return (this.flags & 2) > 0;
  }
  get geometryChanged() {
    return this.docChanged || (this.flags & 10) > 0;
  }
  get focusChanged() {
    return (this.flags & 1) > 0;
  }
  get docChanged() {
    return !this.changes.empty;
  }
  get selectionSet() {
    return this.transactions.some((t8) => t8.selection);
  }
  get empty() {
    return this.flags == 0 && this.transactions.length == 0;
  }
};
var Me4 = class extends R5 {
  get length() {
    return this.view.state.doc.length;
  }
  constructor(t8) {
    super(), this.view = t8, this.decorations = [], this.dynamicDecorationMap = [false], this.domChanged = null, this.hasComposition = null, this.markedForComposition = /* @__PURE__ */ new Set(), this.editContextFormatting = O5.none, this.lastCompositionAfterCursor = false, this.minWidth = 0, this.minWidthFrom = 0, this.minWidthTo = 0, this.impreciseAnchor = null, this.impreciseHead = null, this.forceSelection = false, this.lastUpdate = Date.now(), this.setDOM(t8.contentDOM), this.children = [new P6()], this.children[0].setParent(this), this.updateDeco(), this.updateInner([new j6(0, 0, 0, t8.state.doc.length)], 0, null);
  }
  update(t8) {
    var e7;
    let i12 = t8.changedRanges;
    this.minWidth > 0 && i12.length && (i12.every(({ fromA: c3, toA: a2 }) => a2 < this.minWidthFrom || c3 > this.minWidthTo) ? (this.minWidthFrom = t8.changes.mapPos(this.minWidthFrom, 1), this.minWidthTo = t8.changes.mapPos(this.minWidthTo, 1)) : this.minWidth = this.minWidthFrom = this.minWidthTo = 0), this.updateEditContextFormatting(t8);
    let n14 = -1;
    this.view.inputState.composing >= 0 && !this.view.observer.editContext && (!((e7 = this.domChanged) === null || e7 === void 0) && e7.newSel ? n14 = this.domChanged.newSel.head : !ko3(t8.changes, this.hasComposition) && !t8.selectionSet && (n14 = t8.state.selection.main.head));
    let o = n14 > -1 ? xo3(this.view, t8.changes, n14) : null;
    if (this.domChanged = null, this.hasComposition) {
      this.markedForComposition.clear();
      let { from: c3, to: a2 } = this.hasComposition;
      i12 = new j6(c3, a2, t8.changes.mapPos(c3, -1), t8.changes.mapPos(a2, 1)).addToSet(i12.slice());
    }
    this.hasComposition = o ? { from: o.range.fromB, to: o.range.toB } : null, (y6.ie || y6.chrome) && !o && t8 && t8.state.doc.lines != t8.startState.doc.lines && (this.forceSelection = true);
    let r2 = this.decorations, l11 = this.updateDeco(), h3 = Co3(r2, l11, t8.changes);
    return i12 = j6.extendWithRanges(i12, h3), !(this.flags & 7) && i12.length == 0 ? false : (this.updateInner(i12, t8.startState.doc.length, o), t8.transactions.length && (this.lastUpdate = Date.now()), true);
  }
  updateInner(t8, e7, i12) {
    this.view.viewState.mustMeasureContent = true, this.updateChildren(t8, e7, i12);
    let { observer: n14 } = this.view;
    n14.ignore(() => {
      this.dom.style.height = this.view.viewState.contentHeight / this.view.scaleY + "px", this.dom.style.flexBasis = this.minWidth ? this.minWidth + "px" : "";
      let r2 = y6.chrome || y6.ios ? { node: n14.selectionRange.focusNode, written: false } : void 0;
      this.sync(this.view, r2), this.flags &= -8, r2 && (r2.written || n14.selectionRange.focusNode != r2.node) && (this.forceSelection = true), this.dom.style.height = "";
    }), this.markedForComposition.forEach((r2) => r2.flags &= -9);
    let o = [];
    if (this.view.viewport.from || this.view.viewport.to < this.view.state.doc.length) for (let r2 of this.children) r2 instanceof dt4 && r2.widget instanceof $t4 && o.push(r2.dom);
    n14.updateGaps(o);
  }
  updateChildren(t8, e7, i12) {
    let n14 = i12 ? i12.range.addToSet(t8.slice()) : t8, o = this.childCursor(e7);
    for (let r2 = n14.length - 1; ; r2--) {
      let l11 = r2 >= 0 ? n14[r2] : null;
      if (!l11) break;
      let { fromA: h3, toA: c3, fromB: a2, toB: f6 } = l11, d4, u3, p3, g8;
      if (i12 && i12.range.fromB < f6 && i12.range.toB > a2) {
        let x11 = Ft4.build(this.view.state.doc, a2, i12.range.fromB, this.decorations, this.dynamicDecorationMap), S17 = Ft4.build(this.view.state.doc, i12.range.toB, f6, this.decorations, this.dynamicDecorationMap);
        u3 = x11.breakAtStart, p3 = x11.openStart, g8 = S17.openEnd;
        let C11 = this.compositionView(i12);
        S17.breakAtStart ? C11.breakAfter = 1 : S17.content.length && C11.merge(C11.length, C11.length, S17.content[0], false, S17.openStart, 0) && (C11.breakAfter = S17.content[0].breakAfter, S17.content.shift()), x11.content.length && C11.merge(0, 0, x11.content[x11.content.length - 1], true, 0, x11.openEnd) && x11.content.pop(), d4 = x11.content.concat(C11).concat(S17.content);
      } else ({ content: d4, breakAtStart: u3, openStart: p3, openEnd: g8 } = Ft4.build(this.view.state.doc, a2, f6, this.decorations, this.dynamicDecorationMap));
      let { i: b12, off: m11 } = o.findPos(c3, 1), { i: w14, off: v10 } = o.findPos(h3, -1);
      qs3(this, w14, v10, b12, m11, d4, u3, p3, g8);
    }
    i12 && this.fixCompositionDOM(i12);
  }
  updateEditContextFormatting(t8) {
    this.editContextFormatting = this.editContextFormatting.map(t8.changes);
    for (let e7 of t8.transactions) for (let i12 of e7.effects) i12.is(pn3) && (this.editContextFormatting = i12.value);
  }
  compositionView(t8) {
    let e7 = new Q6(t8.text.nodeValue);
    e7.flags |= 8;
    for (let { deco: n14 } of t8.marks) e7 = new rt5(n14, [e7], e7.length);
    let i12 = new P6();
    return i12.append(e7, 0), i12;
  }
  fixCompositionDOM(t8) {
    let e7 = (o, r2) => {
      r2.flags |= 8 | (r2.children.some((h3) => h3.flags & 7) ? 1 : 0), this.markedForComposition.add(r2);
      let l11 = R5.get(o);
      l11 && l11 != r2 && (l11.dom = null), r2.setDOM(o);
    }, i12 = this.childPos(t8.range.fromB, 1), n14 = this.children[i12.i];
    e7(t8.line, n14);
    for (let o = t8.marks.length - 1; o >= -1; o--) i12 = n14.childPos(i12.off, 1), n14 = n14.children[i12.i], e7(o >= 0 ? t8.marks[o].node : t8.text, n14);
  }
  updateSelection(t8 = false, e7 = false) {
    (t8 || !this.view.observer.selectionRange.focusNode) && this.view.observer.readSelectionRange();
    let i12 = this.view.root.activeElement, n14 = i12 == this.dom, o = !n14 && ue5(this.dom, this.view.observer.selectionRange) && !(i12 && this.dom.contains(i12));
    if (!(n14 || e7 || o)) return;
    let r2 = this.forceSelection;
    this.forceSelection = false;
    let l11 = this.view.state.selection.main, h3 = this.moveToLine(this.domAtPos(l11.anchor)), c3 = l11.empty ? h3 : this.moveToLine(this.domAtPos(l11.head));
    if (y6.gecko && l11.empty && !this.hasComposition && wo3(h3)) {
      let f6 = document.createTextNode("");
      this.view.observer.ignore(() => h3.node.insertBefore(f6, h3.node.childNodes[h3.offset] || null)), h3 = c3 = new V6(f6, 0), r2 = true;
    }
    let a2 = this.view.observer.selectionRange;
    (r2 || !a2.focusNode || (!Vt4(h3.node, h3.offset, a2.anchorNode, a2.anchorOffset) || !Vt4(c3.node, c3.offset, a2.focusNode, a2.focusOffset)) && !this.suppressWidgetCursorChange(a2, l11)) && (this.view.observer.ignore(() => {
      y6.android && y6.chrome && this.dom.contains(a2.focusNode) && Mo3(a2.focusNode, this.dom) && (this.dom.blur(), this.dom.focus({ preventScroll: true }));
      let f6 = jt4(this.view.root);
      if (f6) if (l11.empty) {
        if (y6.gecko) {
          let d4 = vo3(h3.node, h3.offset);
          if (d4 && d4 != 3) {
            let u3 = (d4 == 1 ? Is3 : Ks3)(h3.node, h3.offset);
            u3 && (h3 = new V6(u3.node, u3.offset));
          }
        }
        f6.collapse(h3.node, h3.offset), l11.bidiLevel != null && f6.caretBidiLevel !== void 0 && (f6.caretBidiLevel = l11.bidiLevel);
      } else if (f6.extend) {
        f6.collapse(h3.node, h3.offset);
        try {
          f6.extend(c3.node, c3.offset);
        } catch {
        }
      } else {
        let d4 = document.createRange();
        l11.anchor > l11.head && ([h3, c3] = [c3, h3]), d4.setEnd(c3.node, c3.offset), d4.setStart(h3.node, h3.offset), f6.removeAllRanges(), f6.addRange(d4);
      }
      o && this.view.root.activeElement == this.dom && (this.dom.blur(), i12 && i12.focus());
    }), this.view.observer.setSelectionRange(h3, c3)), this.impreciseAnchor = h3.precise ? null : new V6(a2.anchorNode, a2.anchorOffset), this.impreciseHead = c3.precise ? null : new V6(a2.focusNode, a2.focusOffset);
  }
  suppressWidgetCursorChange(t8, e7) {
    return this.hasComposition && e7.empty && Vt4(t8.focusNode, t8.focusOffset, t8.anchorNode, t8.anchorOffset) && this.posFromDOM(t8.focusNode, t8.focusOffset) == e7.head;
  }
  enforceCursorAssoc() {
    if (this.hasComposition) return;
    let { view: t8 } = this, e7 = t8.state.selection.main, i12 = jt4(t8.root), { anchorNode: n14, anchorOffset: o } = t8.observer.selectionRange;
    if (!i12 || !e7.empty || !e7.assoc || !i12.modify) return;
    let r2 = P6.find(this, e7.head);
    if (!r2) return;
    let l11 = r2.posAtStart;
    if (e7.head == l11 || e7.head == l11 + r2.length) return;
    let h3 = this.coordsAt(e7.head, -1), c3 = this.coordsAt(e7.head, 1);
    if (!h3 || !c3 || h3.bottom > c3.top) return;
    let a2 = this.domAtPos(e7.head + e7.assoc);
    i12.collapse(a2.node, a2.offset), i12.modify("move", e7.assoc < 0 ? "forward" : "backward", "lineboundary"), t8.observer.readSelectionRange();
    let f6 = t8.observer.selectionRange;
    t8.docView.posFromDOM(f6.anchorNode, f6.anchorOffset) != e7.from && i12.collapse(n14, o);
  }
  moveToLine(t8) {
    let e7 = this.dom, i12;
    if (t8.node != e7) return t8;
    for (let n14 = t8.offset; !i12 && n14 < e7.childNodes.length; n14++) {
      let o = R5.get(e7.childNodes[n14]);
      o instanceof P6 && (i12 = o.domAtPos(0));
    }
    for (let n14 = t8.offset - 1; !i12 && n14 >= 0; n14--) {
      let o = R5.get(e7.childNodes[n14]);
      o instanceof P6 && (i12 = o.domAtPos(o.length));
    }
    return i12 ? new V6(i12.node, i12.offset, true) : t8;
  }
  nearest(t8) {
    for (let e7 = t8; e7; ) {
      let i12 = R5.get(e7);
      if (i12 && i12.rootView == this) return i12;
      e7 = e7.parentNode;
    }
    return null;
  }
  posFromDOM(t8, e7) {
    let i12 = this.nearest(t8);
    if (!i12) throw new RangeError("Trying to find position for a DOM position outside of the document");
    return i12.localPosFromDOM(t8, e7) + i12.posAtStart;
  }
  domAtPos(t8) {
    let { i: e7, off: i12 } = this.childCursor().findPos(t8, -1);
    for (; e7 < this.children.length - 1; ) {
      let n14 = this.children[e7];
      if (i12 < n14.length || n14 instanceof P6) break;
      e7++, i12 = 0;
    }
    return this.children[e7].domAtPos(i12);
  }
  coordsAt(t8, e7) {
    let i12 = null, n14 = 0;
    for (let o = this.length, r2 = this.children.length - 1; r2 >= 0; r2--) {
      let l11 = this.children[r2], h3 = o - l11.breakAfter, c3 = h3 - l11.length;
      if (h3 < t8) break;
      if (c3 <= t8 && (c3 < t8 || l11.covers(-1)) && (h3 > t8 || l11.covers(1)) && (!i12 || l11 instanceof P6 && !(i12 instanceof P6 && e7 >= 0))) i12 = l11, n14 = c3;
      else if (i12 && c3 == t8 && h3 == t8 && l11 instanceof dt4 && Math.abs(e7) < 2) {
        if (l11.deco.startSide < 0) break;
        r2 && (i12 = null);
      }
      o = c3;
    }
    return i12 ? i12.coordsAt(t8 - n14, e7) : null;
  }
  coordsForChar(t8) {
    let { i: e7, off: i12 } = this.childPos(t8, 1), n14 = this.children[e7];
    if (!(n14 instanceof P6)) return null;
    for (; n14.children.length; ) {
      let { i: l11, off: h3 } = n14.childPos(i12, 1);
      for (; ; l11++) {
        if (l11 == n14.children.length) return null;
        if ((n14 = n14.children[l11]).length) break;
      }
      i12 = h3;
    }
    if (!(n14 instanceof Q6)) return null;
    let o = ee(n14.text, i12);
    if (o == i12) return null;
    let r2 = pt3(n14.dom, i12, o).getClientRects();
    for (let l11 = 0; l11 < r2.length; l11++) {
      let h3 = r2[l11];
      if (l11 == r2.length - 1 || h3.top < h3.bottom && h3.left < h3.right) return h3;
    }
    return null;
  }
  measureVisibleLineHeights(t8) {
    let e7 = [], { from: i12, to: n14 } = t8, o = this.view.contentDOM.clientWidth, r2 = o > Math.max(this.view.scrollDOM.clientWidth, this.minWidth) + 1, l11 = -1, h3 = this.view.textDirection == L5.LTR;
    for (let c3 = 0, a2 = 0; a2 < this.children.length; a2++) {
      let f6 = this.children[a2], d4 = c3 + f6.length;
      if (d4 > n14) break;
      if (c3 >= i12) {
        let u3 = f6.dom.getBoundingClientRect();
        if (e7.push(u3.height), r2) {
          let p3 = f6.dom.lastChild, g8 = p3 ? At4(p3) : [];
          if (g8.length) {
            let b12 = g8[g8.length - 1], m11 = h3 ? b12.right - u3.left : u3.right - b12.left;
            m11 > l11 && (l11 = m11, this.minWidth = o, this.minWidthFrom = c3, this.minWidthTo = d4);
          }
        }
      }
      c3 = d4 + f6.breakAfter;
    }
    return e7;
  }
  textDirectionAt(t8) {
    let { i: e7 } = this.childPos(t8, 1);
    return getComputedStyle(this.children[e7].dom).direction == "rtl" ? L5.RTL : L5.LTR;
  }
  measureTextSize() {
    for (let o of this.children) if (o instanceof P6) {
      let r2 = o.measureTextSize();
      if (r2) return r2;
    }
    let t8 = document.createElement("div"), e7, i12, n14;
    return t8.className = "cm-line", t8.style.width = "99999px", t8.style.position = "absolute", t8.textContent = "abc def ghi jkl mno pqr stu", this.view.observer.ignore(() => {
      this.dom.appendChild(t8);
      let o = At4(t8.firstChild)[0];
      e7 = t8.getBoundingClientRect().height, i12 = o ? o.width / 27 : 7, n14 = o ? o.height : e7, t8.remove();
    }), { lineHeight: e7, charWidth: i12, textHeight: n14 };
  }
  childCursor(t8 = this.length) {
    let e7 = this.children.length;
    return e7 && (t8 -= this.children[--e7].length), new ve4(this.children, t8, e7);
  }
  computeBlockGapDeco() {
    let t8 = [], e7 = this.view.viewState;
    for (let i12 = 0, n14 = 0; ; n14++) {
      let o = n14 == e7.viewports.length ? null : e7.viewports[n14], r2 = o ? o.from - 1 : this.length;
      if (r2 > i12) {
        let l11 = (e7.lineBlockAt(r2).bottom - e7.lineBlockAt(i12).top) / this.view.scaleY;
        t8.push(O5.replace({ widget: new $t4(l11), block: true, inclusive: true, isBlockGap: true }).range(i12, r2));
      }
      if (!o) break;
      i12 = o.to + 1;
    }
    return O5.set(t8);
  }
  updateDeco() {
    let t8 = 1, e7 = this.view.state.facet(Ut4).map((o) => (this.dynamicDecorationMap[t8++] = typeof o == "function") ? o(this.view) : o), i12 = false, n14 = this.view.state.facet(mn3).map((o, r2) => {
      let l11 = typeof o == "function";
      return l11 && (i12 = true), l11 ? o(this.view) : o;
    });
    for (n14.length && (this.dynamicDecorationMap[t8++] = i12, e7.push(T.join(n14))), this.decorations = [this.editContextFormatting, ...e7, this.computeBlockGapDeco(), this.view.viewState.lineGapDeco]; t8 < this.decorations.length; ) this.dynamicDecorationMap[t8++] = false;
    return this.decorations;
  }
  scrollIntoView(t8) {
    if (t8.isSnapshot) {
      let c3 = this.view.viewState.lineBlockAt(t8.range.head);
      this.view.scrollDOM.scrollTop = c3.top - t8.yMargin, this.view.scrollDOM.scrollLeft = t8.xMargin;
      return;
    }
    for (let c3 of this.view.state.facet(un3)) try {
      if (c3(this.view, t8.range, t8)) return true;
    } catch (a2) {
      $4(this.view.state, a2, "scroll handler");
    }
    let { range: e7 } = t8, i12 = this.coordsAt(e7.head, e7.empty ? e7.assoc : e7.head > e7.anchor ? -1 : 1), n14;
    if (!i12) return;
    !e7.empty && (n14 = this.coordsAt(e7.anchor, e7.anchor > e7.head ? -1 : 1)) && (i12 = { left: Math.min(i12.left, n14.left), top: Math.min(i12.top, n14.top), right: Math.max(i12.right, n14.right), bottom: Math.max(i12.bottom, n14.bottom) });
    let o = wn3(this.view), r2 = { left: i12.left - o.left, top: i12.top - o.top, right: i12.right + o.right, bottom: i12.bottom + o.bottom }, { offsetWidth: l11, offsetHeight: h3 } = this.view.scrollDOM;
    eo3(this.view.scrollDOM, r2, e7.head < e7.anchor ? -1 : 1, t8.x, t8.y, Math.max(Math.min(t8.xMargin, l11), -l11), Math.max(Math.min(t8.yMargin, h3), -h3), this.view.textDirection == L5.LTR);
  }
};
function wo3(s212) {
  return s212.node.nodeType == 1 && s212.node.firstChild && (s212.offset == 0 || s212.node.childNodes[s212.offset - 1].contentEditable == "false") && (s212.offset == s212.node.childNodes.length || s212.node.childNodes[s212.offset].contentEditable == "false");
}
function xn3(s212, t8) {
  let e7 = s212.observer.selectionRange;
  if (!e7.focusNode) return null;
  let i12 = Is3(e7.focusNode, e7.focusOffset), n14 = Ks3(e7.focusNode, e7.focusOffset), o = i12 || n14;
  if (n14 && i12 && n14.node != i12.node) {
    let l11 = R5.get(n14.node);
    if (!l11 || l11 instanceof Q6 && l11.text != n14.node.nodeValue) o = n14;
    else if (s212.docView.lastCompositionAfterCursor) {
      let h3 = R5.get(i12.node);
      !h3 || h3 instanceof Q6 && h3.text != i12.node.nodeValue || (o = n14);
    }
  }
  if (s212.docView.lastCompositionAfterCursor = o != i12, !o) return null;
  let r2 = t8 - o.offset;
  return { from: r2, to: r2 + o.node.nodeValue.length, node: o.node };
}
function xo3(s212, t8, e7) {
  let i12 = xn3(s212, e7);
  if (!i12) return null;
  let { node: n14, from: o, to: r2 } = i12, l11 = n14.nodeValue;
  if (/[\n\r]/.test(l11) || s212.state.doc.sliceString(i12.from, i12.to) != l11) return null;
  let h3 = t8.invertedDesc, c3 = new j6(h3.mapPos(o), h3.mapPos(r2), o, r2), a2 = [];
  for (let f6 = n14.parentNode; ; f6 = f6.parentNode) {
    let d4 = R5.get(f6);
    if (d4 instanceof rt5) a2.push({ node: f6, deco: d4.mark });
    else {
      if (d4 instanceof P6 || f6.nodeName == "DIV" && f6.parentNode == s212.contentDOM) return { range: c3, text: n14, marks: a2, line: f6 };
      if (f6 != s212.contentDOM) a2.push({ node: f6, deco: new Xt3({ inclusive: true, attributes: ho3(f6), tagName: f6.tagName.toLowerCase() }) });
      else return null;
    }
  }
}
function vo3(s212, t8) {
  return s212.nodeType != 1 ? 0 : (t8 && s212.childNodes[t8 - 1].contentEditable == "false" ? 1 : 0) | (t8 < s212.childNodes.length && s212.childNodes[t8].contentEditable == "false" ? 2 : 0);
}
var So3 = class {
  constructor() {
    this.changes = [];
  }
  compareRange(t8, e7) {
    ti3(t8, e7, this.changes);
  }
  comparePoint(t8, e7) {
    ti3(t8, e7, this.changes);
  }
};
function Co3(s212, t8, e7) {
  let i12 = new So3();
  return T.compare(s212, t8, e7, i12), i12.changes;
}
function Mo3(s212, t8) {
  for (let e7 = s212; e7 && e7 != t8; e7 = e7.assignedSlot || e7.parentNode) if (e7.nodeType == 1 && e7.contentEditable == "false") return true;
  return false;
}
function ko3(s212, t8) {
  let e7 = false;
  return t8 && s212.iterChangedRanges((i12, n14) => {
    i12 < t8.to && n14 > t8.from && (e7 = true);
  }), e7;
}
function Ao3(s212, t8, e7 = 1) {
  let i12 = s212.charCategorizer(t8), n14 = s212.doc.lineAt(t8), o = t8 - n14.from;
  if (n14.length == 0) return x.cursor(t8);
  o == 0 ? e7 = 1 : o == n14.length && (e7 = -1);
  let r2 = o, l11 = o;
  e7 < 0 ? r2 = ee(n14.text, o, false) : l11 = ee(n14.text, o);
  let h3 = i12(n14.text.slice(r2, l11));
  for (; r2 > 0; ) {
    let c3 = ee(n14.text, r2, false);
    if (i12(n14.text.slice(c3, r2)) != h3) break;
    r2 = c3;
  }
  for (; l11 < n14.length; ) {
    let c3 = ee(n14.text, l11);
    if (i12(n14.text.slice(l11, c3)) != h3) break;
    l11 = c3;
  }
  return x.range(r2 + n14.from, l11 + n14.from);
}
function Do3(s212, t8) {
  return t8.left > s212 ? t8.left - s212 : Math.max(0, s212 - t8.right);
}
function Oo3(s212, t8) {
  return t8.top > s212 ? t8.top - s212 : Math.max(0, s212 - t8.bottom);
}
function Ie5(s212, t8) {
  return s212.top < t8.bottom - 1 && s212.bottom > t8.top + 1;
}
function Zi3(s212, t8) {
  return t8 < s212.top ? { top: t8, left: s212.left, right: s212.right, bottom: s212.bottom } : s212;
}
function ts3(s212, t8) {
  return t8 > s212.bottom ? { top: s212.top, left: s212.left, right: s212.right, bottom: t8 } : s212;
}
function oi3(s212, t8, e7) {
  let i12, n14, o, r2, l11 = false, h3, c3, a2, f6;
  for (let p3 = s212.firstChild; p3; p3 = p3.nextSibling) {
    let g8 = At4(p3);
    for (let b12 = 0; b12 < g8.length; b12++) {
      let m11 = g8[b12];
      n14 && Ie5(n14, m11) && (m11 = Zi3(ts3(m11, n14.bottom), n14.top));
      let w14 = Do3(t8, m11), v10 = Oo3(e7, m11);
      if (w14 == 0 && v10 == 0) return p3.nodeType == 3 ? es3(p3, t8, e7) : oi3(p3, t8, e7);
      if (!i12 || r2 > v10 || r2 == v10 && o > w14) {
        i12 = p3, n14 = m11, o = w14, r2 = v10;
        let x11 = v10 ? e7 < m11.top ? -1 : 1 : w14 ? t8 < m11.left ? -1 : 1 : 0;
        l11 = !x11 || (x11 > 0 ? b12 < g8.length - 1 : b12 > 0);
      }
      w14 == 0 ? e7 > m11.bottom && (!a2 || a2.bottom < m11.bottom) ? (h3 = p3, a2 = m11) : e7 < m11.top && (!f6 || f6.top > m11.top) && (c3 = p3, f6 = m11) : a2 && Ie5(a2, m11) ? a2 = ts3(a2, m11.bottom) : f6 && Ie5(f6, m11) && (f6 = Zi3(f6, m11.top));
    }
  }
  if (a2 && a2.bottom >= e7 ? (i12 = h3, n14 = a2) : f6 && f6.top <= e7 && (i12 = c3, n14 = f6), !i12) return { node: s212, offset: 0 };
  let d4 = Math.max(n14.left, Math.min(n14.right, t8));
  if (i12.nodeType == 3) return es3(i12, d4, e7);
  if (l11 && i12.contentEditable != "false") return oi3(i12, d4, e7);
  let u3 = Array.prototype.indexOf.call(s212.childNodes, i12) + (t8 >= (n14.left + n14.right) / 2 ? 1 : 0);
  return { node: s212, offset: u3 };
}
function es3(s212, t8, e7) {
  let i12 = s212.nodeValue.length, n14 = -1, o = 1e9, r2 = 0;
  for (let l11 = 0; l11 < i12; l11++) {
    let h3 = pt3(s212, l11, l11 + 1).getClientRects();
    for (let c3 = 0; c3 < h3.length; c3++) {
      let a2 = h3[c3];
      if (a2.top == a2.bottom) continue;
      r2 || (r2 = t8 - a2.left);
      let f6 = (a2.top > e7 ? a2.top - e7 : e7 - a2.bottom) - 1;
      if (a2.left - 1 <= t8 && a2.right + 1 >= t8 && f6 < o) {
        let d4 = t8 >= (a2.left + a2.right) / 2, u3 = d4;
        if ((y6.chrome || y6.gecko) && pt3(s212, l11).getBoundingClientRect().left == a2.right && (u3 = !d4), f6 <= 0) return { node: s212, offset: l11 + (u3 ? 1 : 0) };
        n14 = l11 + (u3 ? 1 : 0), o = f6;
      }
    }
  }
  return { node: s212, offset: n14 > -1 ? n14 : r2 > 0 ? s212.nodeValue.length : 0 };
}
function vn3(s212, t8, e7, i12 = -1) {
  var n14, o;
  let r2 = s212.contentDOM.getBoundingClientRect(), l11 = r2.top + s212.viewState.paddingTop, h3, { docHeight: c3 } = s212.viewState, { x: a2, y: f6 } = t8, d4 = f6 - l11;
  if (d4 < 0) return 0;
  if (d4 > c3) return s212.state.doc.length;
  for (let x11 = s212.viewState.heightOracle.textHeight / 2, S17 = false; h3 = s212.elementAtHeight(d4), h3.type != F7.Text; ) for (; d4 = i12 > 0 ? h3.bottom + x11 : h3.top - x11, !(d4 >= 0 && d4 <= c3); ) {
    if (S17) return e7 ? null : 0;
    S17 = true, i12 = -i12;
  }
  f6 = l11 + d4;
  let u3 = h3.from;
  if (u3 < s212.viewport.from) return s212.viewport.from == 0 ? 0 : e7 ? null : is3(s212, r2, h3, a2, f6);
  if (u3 > s212.viewport.to) return s212.viewport.to == s212.state.doc.length ? s212.state.doc.length : e7 ? null : is3(s212, r2, h3, a2, f6);
  let p3 = s212.dom.ownerDocument, g8 = s212.root.elementFromPoint ? s212.root : p3, b12 = g8.elementFromPoint(a2, f6);
  b12 && !s212.contentDOM.contains(b12) && (b12 = null), b12 || (a2 = Math.max(r2.left + 1, Math.min(r2.right - 1, a2)), b12 = g8.elementFromPoint(a2, f6), b12 && !s212.contentDOM.contains(b12) && (b12 = null));
  let m11, w14 = -1;
  if (b12 && ((n14 = s212.docView.nearest(b12)) === null || n14 === void 0 ? void 0 : n14.isEditable) != false) {
    if (p3.caretPositionFromPoint) {
      let x11 = p3.caretPositionFromPoint(a2, f6);
      x11 && ({ offsetNode: m11, offset: w14 } = x11);
    } else if (p3.caretRangeFromPoint) {
      let x11 = p3.caretRangeFromPoint(a2, f6);
      x11 && ({ startContainer: m11, startOffset: w14 } = x11, (!s212.contentDOM.contains(m11) || y6.safari && To3(m11, w14, a2) || y6.chrome && Ro3(m11, w14, a2)) && (m11 = void 0));
    }
    m11 && (w14 = Math.min(U7(m11), w14));
  }
  if (!m11 || !s212.docView.dom.contains(m11)) {
    let x11 = P6.find(s212.docView, u3);
    if (!x11) return d4 > h3.top + h3.height / 2 ? h3.to : h3.from;
    ({ node: m11, offset: w14 } = oi3(x11.dom, a2, f6));
  }
  let v10 = s212.docView.nearest(m11);
  if (!v10) return null;
  if (v10.isWidget && ((o = v10.dom) === null || o === void 0 ? void 0 : o.nodeType) == 1) {
    let x11 = v10.dom.getBoundingClientRect();
    return t8.y < x11.top || t8.y <= x11.bottom && t8.x <= (x11.left + x11.right) / 2 ? v10.posAtStart : v10.posAtEnd;
  } else return v10.localPosFromDOM(m11, w14) + v10.posAtStart;
}
function is3(s212, t8, e7, i12, n14) {
  let o = Math.round((i12 - t8.left) * s212.defaultCharacterWidth);
  if (s212.lineWrapping && e7.height > s212.defaultLineHeight * 1.5) {
    let l11 = s212.viewState.heightOracle.textHeight, h3 = Math.floor((n14 - e7.top - (s212.defaultLineHeight - l11) * 0.5) / l11);
    o += h3 * s212.viewState.heightOracle.lineLength;
  }
  let r2 = s212.state.sliceDoc(e7.from, e7.to);
  return e7.from + ft(r2, o, s212.state.tabSize);
}
function To3(s212, t8, e7) {
  let i12;
  if (s212.nodeType != 3 || t8 != (i12 = s212.nodeValue.length)) return false;
  for (let n14 = s212.nextSibling; n14; n14 = n14.nextSibling) if (n14.nodeType != 1 || n14.nodeName != "BR") return false;
  return pt3(s212, i12 - 1, i12).getBoundingClientRect().left > e7;
}
function Ro3(s212, t8, e7) {
  if (t8 != 0) return false;
  for (let n14 = s212; ; ) {
    let o = n14.parentNode;
    if (!o || o.nodeType != 1 || o.firstChild != n14) return false;
    if (o.classList.contains("cm-line")) break;
    n14 = o;
  }
  let i12 = s212.nodeType == 1 ? s212.getBoundingClientRect() : pt3(s212, 0, Math.max(s212.nodeValue.length, 1)).getBoundingClientRect();
  return e7 - i12.left > 5;
}
function ri3(s212, t8) {
  let e7 = s212.lineBlockAt(t8);
  if (Array.isArray(e7.type)) {
    for (let i12 of e7.type) if (i12.to > t8 || i12.to == t8 && (i12.to == e7.to || i12.type == F7.Text)) return i12;
  }
  return e7;
}
function Eo3(s212, t8, e7, i12) {
  let n14 = ri3(s212, t8.head), o = !i12 || n14.type != F7.Text || !(s212.lineWrapping || n14.widgetLineBreaks) ? null : s212.coordsAtPos(t8.assoc < 0 && t8.head > n14.from ? t8.head - 1 : t8.head);
  if (o) {
    let r2 = s212.dom.getBoundingClientRect(), l11 = s212.textDirectionAt(n14.from), h3 = s212.posAtCoords({ x: e7 == (l11 == L5.LTR) ? r2.right - 1 : r2.left + 1, y: (o.top + o.bottom) / 2 });
    if (h3 != null) return x.cursor(h3, e7 ? -1 : 1);
  }
  return x.cursor(e7 ? n14.to : n14.from, e7 ? -1 : 1);
}
function ss3(s212, t8, e7, i12) {
  let n14 = s212.state.doc.lineAt(t8.head), o = s212.bidiSpans(n14), r2 = s212.textDirectionAt(n14.from);
  for (let l11 = t8, h3 = null; ; ) {
    let c3 = nn3(n14, o, r2, l11, e7), a2 = sn3;
    if (!c3) {
      if (n14.number == (e7 ? s212.state.doc.lines : 1)) return l11;
      a2 = `
`, n14 = s212.state.doc.line(n14.number + (e7 ? 1 : -1)), o = s212.bidiSpans(n14), c3 = s212.visualLineSide(n14, !e7);
    }
    if (h3) {
      if (!h3(a2)) return l11;
    } else {
      if (!i12) return c3;
      h3 = i12(a2);
    }
    l11 = c3;
  }
}
function Lo3(s212, t8, e7) {
  let i12 = s212.state.charCategorizer(t8), n14 = i12(e7);
  return (o) => {
    let r2 = i12(o);
    return n14 == O.Space && (n14 = r2), n14 == r2;
  };
}
function Bo3(s212, t8, e7, i12) {
  let n14 = t8.head, o = e7 ? 1 : -1;
  if (n14 == (e7 ? s212.state.doc.length : 0)) return x.cursor(n14, t8.assoc);
  let r2 = t8.goalColumn, l11, h3 = s212.contentDOM.getBoundingClientRect(), c3 = s212.coordsAtPos(n14, t8.assoc || -1), a2 = s212.documentTop;
  if (c3) r2 == null && (r2 = c3.left - h3.left), l11 = o < 0 ? c3.top : c3.bottom;
  else {
    let u3 = s212.viewState.lineBlockAt(n14);
    r2 == null && (r2 = Math.min(h3.right - h3.left, s212.defaultCharacterWidth * (n14 - u3.from))), l11 = (o < 0 ? u3.top : u3.bottom) + a2;
  }
  let f6 = h3.left + r2, d4 = i12 ?? s212.viewState.heightOracle.textHeight >> 1;
  for (let u3 = 0; ; u3 += 10) {
    let p3 = l11 + (d4 + u3) * o, g8 = vn3(s212, { x: f6, y: p3 }, false, o);
    if (p3 < h3.top || p3 > h3.bottom || (o < 0 ? g8 < n14 : g8 > n14)) {
      let b12 = s212.docView.coordsForChar(g8), m11 = !b12 || p3 < b12.top ? -1 : 1;
      return x.cursor(g8, m11, void 0, r2);
    }
  }
}
function pe5(s212, t8, e7) {
  for (; ; ) {
    let i12 = 0;
    for (let n14 of s212) n14.between(t8 - 1, t8 + 1, (o, r2, l11) => {
      if (t8 > o && t8 < r2) {
        let h3 = i12 || e7 || (t8 - o < r2 - t8 ? -1 : 1);
        t8 = h3 < 0 ? o : r2, i12 = h3;
      }
    });
    if (!i12) return t8;
  }
}
function Ke5(s212, t8, e7) {
  let i12 = pe5(s212.state.facet(Ki3).map((n14) => n14(s212)), e7.from, t8.head > e7.from ? -1 : 1);
  return i12 == e7.from ? e7 : x.cursor(i12, i12 < e7.from ? 1 : -1);
}
var Bt3 = "ï¿¿";
var li3 = class {
  constructor(t8, e7) {
    this.points = t8, this.text = "", this.lineSeparator = e7.facet(I.lineSeparator);
  }
  append(t8) {
    this.text += t8;
  }
  lineBreak() {
    this.text += Bt3;
  }
  readRange(t8, e7) {
    if (!t8) return this;
    let i12 = t8.parentNode;
    for (let n14 = t8; ; ) {
      this.findPointBefore(i12, n14);
      let o = this.text.length;
      this.readNode(n14);
      let r2 = n14.nextSibling;
      if (r2 == e7) break;
      let l11 = R5.get(n14), h3 = R5.get(r2);
      (l11 && h3 ? l11.breakAfter : (l11 ? l11.breakAfter : xe6(n14)) || xe6(r2) && (n14.nodeName != "BR" || n14.cmIgnore) && this.text.length > o) && this.lineBreak(), n14 = r2;
    }
    return this.findPointBefore(i12, e7), this;
  }
  readTextNode(t8) {
    let e7 = t8.nodeValue;
    for (let i12 of this.points) i12.node == t8 && (i12.pos = this.text.length + Math.min(i12.offset, e7.length));
    for (let i12 = 0, n14 = this.lineSeparator ? null : /\r\n?|\n/g; ; ) {
      let o = -1, r2 = 1, l11;
      if (this.lineSeparator ? (o = e7.indexOf(this.lineSeparator, i12), r2 = this.lineSeparator.length) : (l11 = n14.exec(e7)) && (o = l11.index, r2 = l11[0].length), this.append(e7.slice(i12, o < 0 ? e7.length : o)), o < 0) break;
      if (this.lineBreak(), r2 > 1) for (let h3 of this.points) h3.node == t8 && h3.pos > this.text.length && (h3.pos -= r2 - 1);
      i12 = o + r2;
    }
  }
  readNode(t8) {
    if (t8.cmIgnore) return;
    let e7 = R5.get(t8), i12 = e7 && e7.overrideDOMText;
    if (i12 != null) {
      this.findPointInside(t8, i12.length);
      for (let n14 = i12.iter(); !n14.next().done; ) n14.lineBreak ? this.lineBreak() : this.append(n14.value);
    } else t8.nodeType == 3 ? this.readTextNode(t8) : t8.nodeName == "BR" ? t8.nextSibling && this.lineBreak() : t8.nodeType == 1 && this.readRange(t8.firstChild, null);
  }
  findPointBefore(t8, e7) {
    for (let i12 of this.points) i12.node == t8 && t8.childNodes[i12.offset] == e7 && (i12.pos = this.text.length);
  }
  findPointInside(t8, e7) {
    for (let i12 of this.points) (t8.nodeType == 3 ? i12.node == t8 : t8.contains(i12.node)) && (i12.pos = this.text.length + (Po3(t8, i12.node, i12.offset) ? e7 : 0));
  }
};
function Po3(s212, t8, e7) {
  for (; ; ) {
    if (!t8 || e7 < U7(t8)) return false;
    if (t8 == s212) return true;
    e7 = ut3(t8) + 1, t8 = t8.parentNode;
  }
}
var ke6 = class {
  constructor(t8, e7) {
    this.node = t8, this.offset = e7, this.pos = -1;
  }
};
var hi3 = class {
  constructor(t8, e7, i12, n14) {
    this.typeOver = n14, this.bounds = null, this.text = "", this.domChanged = e7 > -1;
    let { impreciseHead: o, impreciseAnchor: r2 } = t8.docView;
    if (t8.state.readOnly && e7 > -1) this.newSel = null;
    else if (e7 > -1 && (this.bounds = t8.docView.domBoundsAround(e7, i12, 0))) {
      let l11 = o || r2 ? [] : Vo3(t8), h3 = new li3(l11, t8.state);
      h3.readRange(this.bounds.startDOM, this.bounds.endDOM), this.text = h3.text, this.newSel = Fo3(l11, this.bounds.from);
    } else {
      let l11 = t8.observer.selectionRange, h3 = o && o.node == l11.focusNode && o.offset == l11.focusOffset || !Xe5(t8.contentDOM, l11.focusNode) ? t8.state.selection.main.head : t8.docView.posFromDOM(l11.focusNode, l11.focusOffset), c3 = r2 && r2.node == l11.anchorNode && r2.offset == l11.anchorOffset || !Xe5(t8.contentDOM, l11.anchorNode) ? t8.state.selection.main.anchor : t8.docView.posFromDOM(l11.anchorNode, l11.anchorOffset), a2 = t8.viewport;
      if ((y6.ios || y6.chrome) && t8.state.selection.main.empty && h3 != c3 && (a2.from > 0 || a2.to < t8.state.doc.length)) {
        let f6 = Math.min(h3, c3), d4 = Math.max(h3, c3), u3 = a2.from - f6, p3 = a2.to - d4;
        (u3 == 0 || u3 == 1 || f6 == 0) && (p3 == 0 || p3 == -1 || d4 == t8.state.doc.length) && (h3 = 0, c3 = t8.state.doc.length);
      }
      this.newSel = x.single(c3, h3);
    }
  }
};
function Sn4(s212, t8) {
  let e7, { newSel: i12 } = t8, n14 = s212.state.selection.main, o = s212.inputState.lastKeyTime > Date.now() - 100 ? s212.inputState.lastKeyCode : -1;
  if (t8.bounds) {
    let { from: r2, to: l11 } = t8.bounds, h3 = n14.from, c3 = null;
    (o === 8 || y6.android && t8.text.length < l11 - r2) && (h3 = n14.to, c3 = "end");
    let a2 = No3(s212.state.doc.sliceString(r2, l11, Bt3), t8.text, h3 - r2, c3);
    a2 && (y6.chrome && o == 13 && a2.toB == a2.from + 2 && t8.text.slice(a2.from, a2.toB) == Bt3 + Bt3 && a2.toB--, e7 = { from: r2 + a2.from, to: r2 + a2.toA, insert: m.of(t8.text.slice(a2.from, a2.toB).split(Bt3)) });
  } else i12 && (!s212.hasFocus && s212.state.facet(st5) || i12.main.eq(n14)) && (i12 = null);
  if (!e7 && !i12) return false;
  if (!e7 && t8.typeOver && !n14.empty && i12 && i12.main.empty ? e7 = { from: n14.from, to: n14.to, insert: s212.state.doc.slice(n14.from, n14.to) } : e7 && e7.from >= n14.from && e7.to <= n14.to && (e7.from != n14.from || e7.to != n14.to) && n14.to - n14.from - (e7.to - e7.from) <= 4 ? e7 = { from: n14.from, to: n14.to, insert: s212.state.doc.slice(n14.from, e7.from).append(e7.insert).append(s212.state.doc.slice(e7.to, n14.to)) } : (y6.mac || y6.android) && e7 && e7.from == e7.to && e7.from == n14.head - 1 && /^\. ?$/.test(e7.insert.toString()) && s212.contentDOM.getAttribute("autocorrect") == "off" ? (i12 && e7.insert.length == 2 && (i12 = x.single(i12.main.anchor - 1, i12.main.head - 1)), e7 = { from: n14.from, to: n14.to, insert: m.of([" "]) }) : y6.chrome && e7 && e7.from == e7.to && e7.from == n14.head && e7.insert.toString() == `
 ` && s212.lineWrapping && (i12 && (i12 = x.single(i12.main.anchor - 1, i12.main.head - 1)), e7 = { from: n14.from, to: n14.to, insert: m.of([" "]) }), e7) return qi3(s212, e7, i12, o);
  if (i12 && !i12.main.eq(n14)) {
    let r2 = false, l11 = "select";
    return s212.inputState.lastSelectionTime > Date.now() - 50 && (s212.inputState.lastSelectionOrigin == "select" && (r2 = true), l11 = s212.inputState.lastSelectionOrigin), s212.dispatch({ selection: i12, scrollIntoView: r2, userEvent: l11 }), true;
  } else return false;
}
function qi3(s212, t8, e7, i12 = -1) {
  if (y6.ios && s212.inputState.flushIOSKey(t8)) return true;
  let n14 = s212.state.selection.main;
  if (y6.android && (t8.to == n14.to && (t8.from == n14.from || t8.from == n14.from - 1 && s212.state.sliceDoc(t8.from, n14.from) == " ") && t8.insert.length == 1 && t8.insert.lines == 2 && Mt3(s212.contentDOM, "Enter", 13) || (t8.from == n14.from - 1 && t8.to == n14.to && t8.insert.length == 0 || i12 == 8 && t8.insert.length < t8.to - t8.from && t8.to > n14.head) && Mt3(s212.contentDOM, "Backspace", 8) || t8.from == n14.from && t8.to == n14.to + 1 && t8.insert.length == 0 && Mt3(s212.contentDOM, "Delete", 46))) return true;
  let o = t8.insert.toString();
  s212.inputState.composing >= 0 && s212.inputState.composing++;
  let r2, l11 = () => r2 || (r2 = Ho3(s212, t8, e7));
  return s212.state.facet(an3).some((h3) => h3(s212, t8.from, t8.to, o, l11)) || s212.dispatch(l11()), true;
}
function Ho3(s212, t8, e7) {
  let i12, n14 = s212.state, o = n14.selection.main;
  if (t8.from >= o.from && t8.to <= o.to && t8.to - t8.from >= (o.to - o.from) / 3 && (!e7 || e7.main.empty && e7.main.from == t8.from + t8.insert.length) && s212.inputState.composing < 0) {
    let l11 = o.from < t8.from ? n14.sliceDoc(o.from, t8.from) : "", h3 = o.to > t8.to ? n14.sliceDoc(t8.to, o.to) : "";
    i12 = n14.replaceSelection(s212.state.toText(l11 + t8.insert.sliceString(0, void 0, s212.state.lineBreak) + h3));
  } else {
    let l11 = n14.changes(t8), h3 = e7 && e7.main.to <= l11.newLength ? e7.main : void 0;
    if (n14.selection.ranges.length > 1 && s212.inputState.composing >= 0 && t8.to <= o.to && t8.to >= o.to - 10) {
      let c3 = s212.state.sliceDoc(t8.from, t8.to), a2, f6 = e7 && xn3(s212, e7.main.head);
      if (f6) {
        let p3 = t8.insert.length - (t8.to - t8.from);
        a2 = { from: f6.from, to: f6.to - p3 };
      } else a2 = s212.state.doc.lineAt(o.head);
      let d4 = o.to - t8.to, u3 = o.to - o.from;
      i12 = n14.changeByRange((p3) => {
        if (p3.from == o.from && p3.to == o.to) return { changes: l11, range: h3 || p3.map(l11) };
        let g8 = p3.to - d4, b12 = g8 - c3.length;
        if (p3.to - p3.from != u3 || s212.state.sliceDoc(b12, g8) != c3 || p3.to >= a2.from && p3.from <= a2.to) return { range: p3 };
        let m11 = n14.changes({ from: b12, to: g8, insert: t8.insert }), w14 = p3.to - o.to;
        return { changes: m11, range: h3 ? x.range(Math.max(0, h3.anchor + w14), Math.max(0, h3.head + w14)) : p3.map(m11) };
      });
    } else i12 = { changes: l11, selection: h3 && n14.selection.replaceRange(h3) };
  }
  let r2 = "input.type";
  return (s212.composing || s212.inputState.compositionPendingChange && s212.inputState.compositionEndedAt > Date.now() - 50) && (s212.inputState.compositionPendingChange = false, r2 += ".compose", s212.inputState.compositionFirstChange && (r2 += ".start", s212.inputState.compositionFirstChange = false)), n14.update(i12, { userEvent: r2, scrollIntoView: true });
}
function No3(s212, t8, e7, i12) {
  let n14 = Math.min(s212.length, t8.length), o = 0;
  for (; o < n14 && s212.charCodeAt(o) == t8.charCodeAt(o); ) o++;
  if (o == n14 && s212.length == t8.length) return null;
  let r2 = s212.length, l11 = t8.length;
  for (; r2 > 0 && l11 > 0 && s212.charCodeAt(r2 - 1) == t8.charCodeAt(l11 - 1); ) r2--, l11--;
  if (i12 == "end") {
    let h3 = Math.max(0, o - Math.min(r2, l11));
    e7 -= r2 + h3 - o;
  }
  if (r2 < o && s212.length < t8.length) {
    let h3 = e7 <= o && e7 >= r2 ? o - e7 : 0;
    o -= h3, l11 = o + (l11 - r2), r2 = o;
  } else if (l11 < o) {
    let h3 = e7 <= o && e7 >= l11 ? o - e7 : 0;
    o -= h3, r2 = o + (r2 - l11), l11 = o;
  }
  return { from: o, toA: r2, toB: l11 };
}
function Vo3(s212) {
  let t8 = [];
  if (s212.root.activeElement != s212.contentDOM) return t8;
  let { anchorNode: e7, anchorOffset: i12, focusNode: n14, focusOffset: o } = s212.observer.selectionRange;
  return e7 && (t8.push(new ke6(e7, i12)), (n14 != e7 || o != i12) && t8.push(new ke6(n14, o))), t8;
}
function Fo3(s212, t8) {
  if (s212.length == 0) return null;
  let e7 = s212[0].pos, i12 = s212.length == 2 ? s212[1].pos : e7;
  return e7 > -1 && i12 > -1 ? x.single(e7 + t8, i12 + t8) : null;
}
var ai3 = class {
  setSelectionOrigin(t8) {
    this.lastSelectionOrigin = t8, this.lastSelectionTime = Date.now();
  }
  constructor(t8) {
    this.view = t8, this.lastKeyCode = 0, this.lastKeyTime = 0, this.lastTouchTime = 0, this.lastFocusTime = 0, this.lastScrollTop = 0, this.lastScrollLeft = 0, this.pendingIOSKey = void 0, this.tabFocusMode = -1, this.lastSelectionOrigin = null, this.lastSelectionTime = 0, this.lastContextMenu = 0, this.scrollHandlers = [], this.handlers = /* @__PURE__ */ Object.create(null), this.composing = -1, this.compositionFirstChange = null, this.compositionEndedAt = 0, this.compositionPendingKey = false, this.compositionPendingChange = false, this.mouseSelection = null, this.draggedContent = null, this.handleEvent = this.handleEvent.bind(this), this.notifiedFocused = t8.hasFocus, y6.safari && t8.contentDOM.addEventListener("input", () => null), y6.gecko && Zo3(t8.contentDOM.ownerDocument);
  }
  handleEvent(t8) {
    !Yo3(this.view, t8) || this.ignoreDuringComposition(t8) || t8.type == "keydown" && this.keydown(t8) || this.runHandlers(t8.type, t8);
  }
  runHandlers(t8, e7) {
    let i12 = this.handlers[t8];
    if (i12) {
      for (let n14 of i12.observers) n14(this.view, e7);
      for (let n14 of i12.handlers) {
        if (e7.defaultPrevented) break;
        if (n14(this.view, e7)) {
          e7.preventDefault();
          break;
        }
      }
    }
  }
  ensureHandlers(t8) {
    let e7 = Wo3(t8), i12 = this.handlers, n14 = this.view.contentDOM;
    for (let o in e7) if (o != "scroll") {
      let r2 = !e7[o].handlers.length, l11 = i12[o];
      l11 && r2 != !l11.handlers.length && (n14.removeEventListener(o, this.handleEvent), l11 = null), l11 || n14.addEventListener(o, this.handleEvent, { passive: r2 });
    }
    for (let o in i12) o != "scroll" && !e7[o] && n14.removeEventListener(o, this.handleEvent);
    this.handlers = e7;
  }
  keydown(t8) {
    if (this.lastKeyCode = t8.keyCode, this.lastKeyTime = Date.now(), t8.keyCode == 9 && this.tabFocusMode > -1 && (!this.tabFocusMode || Date.now() <= this.tabFocusMode)) return true;
    if (this.tabFocusMode > 0 && t8.keyCode != 27 && Mn3.indexOf(t8.keyCode) < 0 && (this.tabFocusMode = -1), y6.android && y6.chrome && !t8.synthetic && (t8.keyCode == 13 || t8.keyCode == 8)) return this.view.observer.delayAndroidKey(t8.key, t8.keyCode), true;
    let e7;
    return y6.ios && !t8.synthetic && !t8.altKey && !t8.metaKey && ((e7 = Cn3.find((i12) => i12.keyCode == t8.keyCode)) && !t8.ctrlKey || zo3.indexOf(t8.key) > -1 && t8.ctrlKey && !t8.shiftKey) ? (this.pendingIOSKey = e7 || t8, setTimeout(() => this.flushIOSKey(), 250), true) : (t8.keyCode != 229 && this.view.observer.forceFlush(), false);
  }
  flushIOSKey(t8) {
    let e7 = this.pendingIOSKey;
    return !e7 || e7.key == "Enter" && t8 && t8.from < t8.to && /^\S+$/.test(t8.insert.toString()) ? false : (this.pendingIOSKey = void 0, Mt3(this.view.contentDOM, e7.key, e7.keyCode, e7 instanceof KeyboardEvent ? e7 : void 0));
  }
  ignoreDuringComposition(t8) {
    return /^key/.test(t8.type) ? this.composing > 0 ? true : y6.safari && !y6.ios && this.compositionPendingKey && Date.now() - this.compositionEndedAt < 100 ? (this.compositionPendingKey = false, true) : false : false;
  }
  startMouseSelection(t8) {
    this.mouseSelection && this.mouseSelection.destroy(), this.mouseSelection = t8;
  }
  update(t8) {
    this.view.observer.update(t8), this.mouseSelection && this.mouseSelection.update(t8), this.draggedContent && t8.docChanged && (this.draggedContent = this.draggedContent.map(t8.changes)), t8.transactions.length && (this.lastKeyCode = this.lastSelectionTime = 0);
  }
  destroy() {
    this.mouseSelection && this.mouseSelection.destroy();
  }
};
function ns3(s212, t8) {
  return (e7, i12) => {
    try {
      return t8.call(s212, i12, e7);
    } catch (n14) {
      $4(e7.state, n14);
    }
  };
}
function Wo3(s212) {
  let t8 = /* @__PURE__ */ Object.create(null);
  function e7(i12) {
    return t8[i12] || (t8[i12] = { observers: [], handlers: [] });
  }
  for (let i12 of s212) {
    let n14 = i12.spec;
    if (n14 && n14.domEventHandlers) for (let o in n14.domEventHandlers) {
      let r2 = n14.domEventHandlers[o];
      r2 && e7(o).handlers.push(ns3(i12.value, r2));
    }
    if (n14 && n14.domEventObservers) for (let o in n14.domEventObservers) {
      let r2 = n14.domEventObservers[o];
      r2 && e7(o).observers.push(ns3(i12.value, r2));
    }
  }
  for (let i12 in Y7) e7(i12).handlers.push(Y7[i12]);
  for (let i12 in K5) e7(i12).observers.push(K5[i12]);
  return t8;
}
var Cn3 = [{ key: "Backspace", keyCode: 8, inputType: "deleteContentBackward" }, { key: "Enter", keyCode: 13, inputType: "insertParagraph" }, { key: "Enter", keyCode: 13, inputType: "insertLineBreak" }, { key: "Delete", keyCode: 46, inputType: "deleteContentForward" }];
var zo3 = "dthko";
var Mn3 = [16, 17, 18, 20, 91, 92, 224, 225];
var re4 = 6;
function le5(s212) {
  return Math.max(0, s212) * 0.7 + 8;
}
function Io3(s212, t8) {
  return Math.max(Math.abs(s212.clientX - t8.clientX), Math.abs(s212.clientY - t8.clientY));
}
var ci3 = class {
  constructor(t8, e7, i12, n14) {
    this.view = t8, this.startEvent = e7, this.style = i12, this.mustSelect = n14, this.scrollSpeed = { x: 0, y: 0 }, this.scrolling = -1, this.lastEvent = e7, this.scrollParents = io3(t8.contentDOM), this.atoms = t8.state.facet(Ki3).map((r2) => r2(t8));
    let o = t8.contentDOM.ownerDocument;
    o.addEventListener("mousemove", this.move = this.move.bind(this)), o.addEventListener("mouseup", this.up = this.up.bind(this)), this.extend = e7.shiftKey, this.multiple = t8.state.facet(I.allowMultipleSelections) && Ko3(t8, e7), this.dragging = jo3(t8, e7) && Dn3(e7) == 1 ? null : false;
  }
  start(t8) {
    this.dragging === false && this.select(t8);
  }
  move(t8) {
    if (t8.buttons == 0) return this.destroy();
    if (this.dragging || this.dragging == null && Io3(this.startEvent, t8) < 10) return;
    this.select(this.lastEvent = t8);
    let e7 = 0, i12 = 0, n14 = 0, o = 0, r2 = this.view.win.innerWidth, l11 = this.view.win.innerHeight;
    this.scrollParents.x && ({ left: n14, right: r2 } = this.scrollParents.x.getBoundingClientRect()), this.scrollParents.y && ({ top: o, bottom: l11 } = this.scrollParents.y.getBoundingClientRect());
    let h3 = wn3(this.view);
    t8.clientX - h3.left <= n14 + re4 ? e7 = -le5(n14 - t8.clientX) : t8.clientX + h3.right >= r2 - re4 && (e7 = le5(t8.clientX - r2)), t8.clientY - h3.top <= o + re4 ? i12 = -le5(o - t8.clientY) : t8.clientY + h3.bottom >= l11 - re4 && (i12 = le5(t8.clientY - l11)), this.setScrollSpeed(e7, i12);
  }
  up(t8) {
    this.dragging == null && this.select(this.lastEvent), this.dragging || t8.preventDefault(), this.destroy();
  }
  destroy() {
    this.setScrollSpeed(0, 0);
    let t8 = this.view.contentDOM.ownerDocument;
    t8.removeEventListener("mousemove", this.move), t8.removeEventListener("mouseup", this.up), this.view.inputState.mouseSelection = this.view.inputState.draggedContent = null;
  }
  setScrollSpeed(t8, e7) {
    this.scrollSpeed = { x: t8, y: e7 }, t8 || e7 ? this.scrolling < 0 && (this.scrolling = setInterval(() => this.scroll(), 50)) : this.scrolling > -1 && (clearInterval(this.scrolling), this.scrolling = -1);
  }
  scroll() {
    let { x: t8, y: e7 } = this.scrollSpeed;
    t8 && this.scrollParents.x && (this.scrollParents.x.scrollLeft += t8, t8 = 0), e7 && this.scrollParents.y && (this.scrollParents.y.scrollTop += e7, e7 = 0), (t8 || e7) && this.view.win.scrollBy(t8, e7), this.dragging === false && this.select(this.lastEvent);
  }
  skipAtoms(t8) {
    let e7 = null;
    for (let i12 = 0; i12 < t8.ranges.length; i12++) {
      let n14 = t8.ranges[i12], o = null;
      if (n14.empty) {
        let r2 = pe5(this.atoms, n14.from, 0);
        r2 != n14.from && (o = x.cursor(r2, -1));
      } else {
        let r2 = pe5(this.atoms, n14.from, -1), l11 = pe5(this.atoms, n14.to, 1);
        (r2 != n14.from || l11 != n14.to) && (o = x.range(n14.from == n14.anchor ? r2 : l11, n14.from == n14.head ? r2 : l11));
      }
      o && (e7 || (e7 = t8.ranges.slice()), e7[i12] = o);
    }
    return e7 ? x.create(e7, t8.mainIndex) : t8;
  }
  select(t8) {
    let { view: e7 } = this, i12 = this.skipAtoms(this.style.get(t8, this.extend, this.multiple));
    (this.mustSelect || !i12.eq(e7.state.selection, this.dragging === false)) && this.view.dispatch({ selection: i12, userEvent: "select.pointer" }), this.mustSelect = false;
  }
  update(t8) {
    t8.transactions.some((e7) => e7.isUserEvent("input.type")) ? this.destroy() : this.style.update(t8) && setTimeout(() => this.select(this.lastEvent), 20);
  }
};
function Ko3(s212, t8) {
  let e7 = s212.state.facet(on3);
  return e7.length ? e7[0](t8) : y6.mac ? t8.metaKey : t8.ctrlKey;
}
function qo3(s212, t8) {
  let e7 = s212.state.facet(rn3);
  return e7.length ? e7[0](t8) : y6.mac ? !t8.altKey : !t8.ctrlKey;
}
function jo3(s212, t8) {
  let { main: e7 } = s212.state.selection;
  if (e7.empty) return false;
  let i12 = jt4(s212.root);
  if (!i12 || i12.rangeCount == 0) return true;
  let n14 = i12.getRangeAt(0).getClientRects();
  for (let o = 0; o < n14.length; o++) {
    let r2 = n14[o];
    if (r2.left <= t8.clientX && r2.right >= t8.clientX && r2.top <= t8.clientY && r2.bottom >= t8.clientY) return true;
  }
  return false;
}
function Yo3(s212, t8) {
  if (!t8.bubbles) return true;
  if (t8.defaultPrevented) return false;
  for (let e7 = t8.target, i12; e7 != s212.contentDOM; e7 = e7.parentNode) if (!e7 || e7.nodeType == 11 || (i12 = R5.get(e7)) && i12.ignoreEvent(t8)) return false;
  return true;
}
var Y7 = /* @__PURE__ */ Object.create(null);
var K5 = /* @__PURE__ */ Object.create(null);
var kn3 = y6.ie && y6.ie_version < 15 || y6.ios && y6.webkit_version < 604;
function _o3(s212) {
  let t8 = s212.dom.parentNode;
  if (!t8) return;
  let e7 = t8.appendChild(document.createElement("textarea"));
  e7.style.cssText = "position: fixed; left: -10000px; top: 10px", e7.focus(), setTimeout(() => {
    s212.focus(), e7.remove(), An3(s212, e7.value);
  }, 50);
}
function Fe5(s212, t8, e7) {
  for (let i12 of s212.facet(t8)) e7 = i12(e7, s212);
  return e7;
}
function An3(s212, t8) {
  t8 = Fe5(s212.state, zi3, t8);
  let { state: e7 } = s212, i12, n14 = 1, o = e7.toText(t8), r2 = o.lines == e7.selection.ranges.length;
  if (fi3 != null && e7.selection.ranges.every((h3) => h3.empty) && fi3 == o.toString()) {
    let h3 = -1;
    i12 = e7.changeByRange((c3) => {
      let a2 = e7.doc.lineAt(c3.from);
      if (a2.from == h3) return { range: c3 };
      h3 = a2.from;
      let f6 = e7.toText((r2 ? o.line(n14++).text : t8) + e7.lineBreak);
      return { changes: { from: a2.from, insert: f6 }, range: x.cursor(c3.from + f6.length) };
    });
  } else r2 ? i12 = e7.changeByRange((h3) => {
    let c3 = o.line(n14++);
    return { changes: { from: h3.from, to: h3.to, insert: c3.text }, range: x.cursor(h3.from + c3.length) };
  }) : i12 = e7.replaceSelection(o);
  s212.dispatch(i12, { userEvent: "input.paste", scrollIntoView: true });
}
K5.scroll = (s212) => {
  s212.inputState.lastScrollTop = s212.scrollDOM.scrollTop, s212.inputState.lastScrollLeft = s212.scrollDOM.scrollLeft;
};
Y7.keydown = (s212, t8) => (s212.inputState.setSelectionOrigin("select"), t8.keyCode == 27 && s212.inputState.tabFocusMode != 0 && (s212.inputState.tabFocusMode = Date.now() + 2e3), false);
K5.touchstart = (s212, t8) => {
  s212.inputState.lastTouchTime = Date.now(), s212.inputState.setSelectionOrigin("select.pointer");
};
K5.touchmove = (s212) => {
  s212.inputState.setSelectionOrigin("select.pointer");
};
Y7.mousedown = (s212, t8) => {
  if (s212.observer.flush(), s212.inputState.lastTouchTime > Date.now() - 2e3) return false;
  let e7 = null;
  for (let i12 of s212.state.facet(ln3)) if (e7 = i12(s212, t8), e7) break;
  if (!e7 && t8.button == 0 && (e7 = $o3(s212, t8)), e7) {
    let i12 = !s212.hasFocus;
    s212.inputState.startMouseSelection(new ci3(s212, t8, e7, i12)), i12 && s212.observer.ignore(() => {
      Fs3(s212.contentDOM);
      let o = s212.root.activeElement;
      o && !o.contains(s212.contentDOM) && o.blur();
    });
    let n14 = s212.inputState.mouseSelection;
    if (n14) return n14.start(t8), n14.dragging === false;
  }
  return false;
};
function os3(s212, t8, e7, i12) {
  if (i12 == 1) return x.cursor(t8, e7);
  if (i12 == 2) return Ao3(s212.state, t8, e7);
  {
    let n14 = P6.find(s212.docView, t8), o = s212.state.doc.lineAt(n14 ? n14.posAtEnd : t8), r2 = n14 ? n14.posAtStart : o.from, l11 = n14 ? n14.posAtEnd : o.to;
    return l11 < s212.state.doc.length && l11 == o.to && l11++, x.range(r2, l11);
  }
}
var rs3 = (s212, t8, e7) => t8 >= e7.top && t8 <= e7.bottom && s212 >= e7.left && s212 <= e7.right;
function Xo3(s212, t8, e7, i12) {
  let n14 = P6.find(s212.docView, t8);
  if (!n14) return 1;
  let o = t8 - n14.posAtStart;
  if (o == 0) return 1;
  if (o == n14.length) return -1;
  let r2 = n14.coordsAt(o, -1);
  if (r2 && rs3(e7, i12, r2)) return -1;
  let l11 = n14.coordsAt(o, 1);
  return l11 && rs3(e7, i12, l11) ? 1 : r2 && r2.bottom >= i12 ? -1 : 1;
}
function ls3(s212, t8) {
  let e7 = s212.posAtCoords({ x: t8.clientX, y: t8.clientY }, false);
  return { pos: e7, bias: Xo3(s212, e7, t8.clientX, t8.clientY) };
}
var Go3 = y6.ie && y6.ie_version <= 11;
var hs3 = null;
var as3 = 0;
var cs3 = 0;
function Dn3(s212) {
  if (!Go3) return s212.detail;
  let t8 = hs3, e7 = cs3;
  return hs3 = s212, cs3 = Date.now(), as3 = !t8 || e7 > Date.now() - 400 && Math.abs(t8.clientX - s212.clientX) < 2 && Math.abs(t8.clientY - s212.clientY) < 2 ? (as3 + 1) % 3 : 1;
}
function $o3(s212, t8) {
  let e7 = ls3(s212, t8), i12 = Dn3(t8), n14 = s212.state.selection;
  return { update(o) {
    o.docChanged && (e7.pos = o.changes.mapPos(e7.pos), n14 = n14.map(o.changes));
  }, get(o, r2, l11) {
    let h3 = ls3(s212, o), c3, a2 = os3(s212, h3.pos, h3.bias, i12);
    if (e7.pos != h3.pos && !r2) {
      let f6 = os3(s212, e7.pos, e7.bias, i12), d4 = Math.min(f6.from, a2.from), u3 = Math.max(f6.to, a2.to);
      a2 = d4 < a2.from ? x.range(d4, u3) : x.range(u3, d4);
    }
    return r2 ? n14.replaceRange(n14.main.extend(a2.from, a2.to)) : l11 && i12 == 1 && n14.ranges.length > 1 && (c3 = Uo3(n14, h3.pos)) ? c3 : l11 ? n14.addRange(a2) : x.create([a2]);
  } };
}
function Uo3(s212, t8) {
  for (let e7 = 0; e7 < s212.ranges.length; e7++) {
    let { from: i12, to: n14 } = s212.ranges[e7];
    if (i12 <= t8 && n14 >= t8) return x.create(s212.ranges.slice(0, e7).concat(s212.ranges.slice(e7 + 1)), s212.mainIndex == e7 ? 0 : s212.mainIndex - (s212.mainIndex > e7 ? 1 : 0));
  }
  return null;
}
Y7.dragstart = (s212, t8) => {
  let { selection: { main: e7 } } = s212.state;
  if (t8.target.draggable) {
    let n14 = s212.docView.nearest(t8.target);
    if (n14 && n14.isWidget) {
      let o = n14.posAtStart, r2 = o + n14.length;
      (o >= e7.to || r2 <= e7.from) && (e7 = x.range(o, r2));
    }
  }
  let { inputState: i12 } = s212;
  return i12.mouseSelection && (i12.mouseSelection.dragging = true), i12.draggedContent = e7, t8.dataTransfer && (t8.dataTransfer.setData("Text", Fe5(s212.state, Ii3, s212.state.sliceDoc(e7.from, e7.to))), t8.dataTransfer.effectAllowed = "copyMove"), false;
};
Y7.dragend = (s212) => (s212.inputState.draggedContent = null, false);
function fs3(s212, t8, e7, i12) {
  if (e7 = Fe5(s212.state, zi3, e7), !e7) return;
  let n14 = s212.posAtCoords({ x: t8.clientX, y: t8.clientY }, false), { draggedContent: o } = s212.inputState, r2 = i12 && o && qo3(s212, t8) ? { from: o.from, to: o.to } : null, l11 = { from: n14, insert: e7 }, h3 = s212.state.changes(r2 ? [r2, l11] : l11);
  s212.focus(), s212.dispatch({ changes: h3, selection: { anchor: h3.mapPos(n14, -1), head: h3.mapPos(n14, 1) }, userEvent: r2 ? "move.drop" : "input.drop" }), s212.inputState.draggedContent = null;
}
Y7.drop = (s212, t8) => {
  if (!t8.dataTransfer) return false;
  if (s212.state.readOnly) return true;
  let e7 = t8.dataTransfer.files;
  if (e7 && e7.length) {
    let i12 = Array(e7.length), n14 = 0, o = () => {
      ++n14 == e7.length && fs3(s212, t8, i12.filter((r2) => r2 != null).join(s212.state.lineBreak), false);
    };
    for (let r2 = 0; r2 < e7.length; r2++) {
      let l11 = new FileReader();
      l11.onerror = o, l11.onload = () => {
        /[\x00-\x08\x0e-\x1f]{2}/.test(l11.result) || (i12[r2] = l11.result), o();
      }, l11.readAsText(e7[r2]);
    }
    return true;
  } else {
    let i12 = t8.dataTransfer.getData("Text");
    if (i12) return fs3(s212, t8, i12, true), true;
  }
  return false;
};
Y7.paste = (s212, t8) => {
  if (s212.state.readOnly) return true;
  s212.observer.flush();
  let e7 = kn3 ? null : t8.clipboardData;
  return e7 ? (An3(s212, e7.getData("text/plain") || e7.getData("text/uri-list")), true) : (_o3(s212), false);
};
function Qo3(s212, t8) {
  let e7 = s212.dom.parentNode;
  if (!e7) return;
  let i12 = e7.appendChild(document.createElement("textarea"));
  i12.style.cssText = "position: fixed; left: -10000px; top: 10px", i12.value = t8, i12.focus(), i12.selectionEnd = t8.length, i12.selectionStart = 0, setTimeout(() => {
    i12.remove(), s212.focus();
  }, 50);
}
function Jo3(s212) {
  let t8 = [], e7 = [], i12 = false;
  for (let n14 of s212.selection.ranges) n14.empty || (t8.push(s212.sliceDoc(n14.from, n14.to)), e7.push(n14));
  if (!t8.length) {
    let n14 = -1;
    for (let { from: o } of s212.selection.ranges) {
      let r2 = s212.doc.lineAt(o);
      r2.number > n14 && (t8.push(r2.text), e7.push({ from: r2.from, to: Math.min(s212.doc.length, r2.to + 1) })), n14 = r2.number;
    }
    i12 = true;
  }
  return { text: Fe5(s212, Ii3, t8.join(s212.lineBreak)), ranges: e7, linewise: i12 };
}
var fi3 = null;
Y7.copy = Y7.cut = (s212, t8) => {
  let { text: e7, ranges: i12, linewise: n14 } = Jo3(s212.state);
  if (!e7 && !n14) return false;
  fi3 = n14 ? e7 : null, t8.type == "cut" && !s212.state.readOnly && s212.dispatch({ changes: i12, scrollIntoView: true, userEvent: "delete.cut" });
  let o = kn3 ? null : t8.clipboardData;
  return o ? (o.clearData(), o.setData("text/plain", e7), true) : (Qo3(s212, e7), false);
};
var On3 = J.define();
function Tn3(s212, t8) {
  let e7 = [];
  for (let i12 of s212.facet(cn3)) {
    let n14 = i12(s212, t8);
    n14 && e7.push(n14);
  }
  return e7 ? s212.update({ effects: e7, annotations: On3.of(true) }) : null;
}
function Rn3(s212) {
  setTimeout(() => {
    let t8 = s212.hasFocus;
    if (t8 != s212.inputState.notifiedFocused) {
      let e7 = Tn3(s212.state, t8);
      e7 ? s212.dispatch(e7) : s212.update([]);
    }
  }, 10);
}
K5.focus = (s212) => {
  s212.inputState.lastFocusTime = Date.now(), !s212.scrollDOM.scrollTop && (s212.inputState.lastScrollTop || s212.inputState.lastScrollLeft) && (s212.scrollDOM.scrollTop = s212.inputState.lastScrollTop, s212.scrollDOM.scrollLeft = s212.inputState.lastScrollLeft), Rn3(s212);
};
K5.blur = (s212) => {
  s212.observer.clearSelectionRange(), Rn3(s212);
};
K5.compositionstart = K5.compositionupdate = (s212) => {
  s212.observer.editContext || (s212.inputState.compositionFirstChange == null && (s212.inputState.compositionFirstChange = true), s212.inputState.composing < 0 && (s212.inputState.composing = 0));
};
K5.compositionend = (s212) => {
  s212.observer.editContext || (s212.inputState.composing = -1, s212.inputState.compositionEndedAt = Date.now(), s212.inputState.compositionPendingKey = true, s212.inputState.compositionPendingChange = s212.observer.pendingRecords().length > 0, s212.inputState.compositionFirstChange = null, y6.chrome && y6.android ? s212.observer.flushSoon() : s212.inputState.compositionPendingChange ? Promise.resolve().then(() => s212.observer.flush()) : setTimeout(() => {
    s212.inputState.composing < 0 && s212.docView.hasComposition && s212.update([]);
  }, 50));
};
K5.contextmenu = (s212) => {
  s212.inputState.lastContextMenu = Date.now();
};
Y7.beforeinput = (s212, t8) => {
  var e7, i12;
  if (t8.inputType == "insertReplacementText" && s212.observer.editContext) {
    let o = (e7 = t8.dataTransfer) === null || e7 === void 0 ? void 0 : e7.getData("text/plain"), r2 = t8.getTargetRanges();
    if (o && r2.length) {
      let l11 = r2[0], h3 = s212.posAtDOM(l11.startContainer, l11.startOffset), c3 = s212.posAtDOM(l11.endContainer, l11.endOffset);
      return qi3(s212, { from: h3, to: c3, insert: s212.state.toText(o) }, null), true;
    }
  }
  let n14;
  if (y6.chrome && y6.android && (n14 = Cn3.find((o) => o.inputType == t8.inputType)) && (s212.observer.delayAndroidKey(n14.key, n14.keyCode), n14.key == "Backspace" || n14.key == "Delete")) {
    let o = ((i12 = window.visualViewport) === null || i12 === void 0 ? void 0 : i12.height) || 0;
    setTimeout(() => {
      var r2;
      (((r2 = window.visualViewport) === null || r2 === void 0 ? void 0 : r2.height) || 0) > o + 10 && s212.hasFocus && (s212.contentDOM.blur(), s212.focus());
    }, 100);
  }
  return y6.ios && t8.inputType == "deleteContentForward" && s212.observer.flushSoon(), y6.safari && t8.inputType == "insertText" && s212.inputState.composing >= 0 && setTimeout(() => K5.compositionend(s212, t8), 20), false;
};
var ds3 = /* @__PURE__ */ new Set();
function Zo3(s212) {
  ds3.has(s212) || (ds3.add(s212), s212.addEventListener("copy", () => {
  }), s212.addEventListener("cut", () => {
  }));
}
var us3 = ["pre-wrap", "normal", "pre-line", "break-spaces"];
var mt4 = false;
function di3() {
  mt4 = false;
}
var Ae5 = class {
  constructor(t8) {
    this.lineWrapping = t8, this.doc = m.empty, this.heightSamples = {}, this.lineHeight = 14, this.charWidth = 7, this.textHeight = 14, this.lineLength = 30;
  }
  heightForGap(t8, e7) {
    let i12 = this.doc.lineAt(e7).number - this.doc.lineAt(t8).number + 1;
    return this.lineWrapping && (i12 += Math.max(0, Math.ceil((e7 - t8 - i12 * this.lineLength * 0.5) / this.lineLength))), this.lineHeight * i12;
  }
  heightForLine(t8) {
    return this.lineWrapping ? (1 + Math.max(0, Math.ceil((t8 - this.lineLength) / (this.lineLength - 5)))) * this.lineHeight : this.lineHeight;
  }
  setDoc(t8) {
    return this.doc = t8, this;
  }
  mustRefreshForWrapping(t8) {
    return us3.indexOf(t8) > -1 != this.lineWrapping;
  }
  mustRefreshForHeights(t8) {
    let e7 = false;
    for (let i12 = 0; i12 < t8.length; i12++) {
      let n14 = t8[i12];
      n14 < 0 ? i12++ : this.heightSamples[Math.floor(n14 * 10)] || (e7 = true, this.heightSamples[Math.floor(n14 * 10)] = true);
    }
    return e7;
  }
  refresh(t8, e7, i12, n14, o, r2) {
    let l11 = us3.indexOf(t8) > -1, h3 = Math.round(e7) != Math.round(this.lineHeight) || this.lineWrapping != l11;
    if (this.lineWrapping = l11, this.lineHeight = e7, this.charWidth = i12, this.textHeight = n14, this.lineLength = o, h3) {
      this.heightSamples = {};
      for (let c3 = 0; c3 < r2.length; c3++) {
        let a2 = r2[c3];
        a2 < 0 ? c3++ : this.heightSamples[Math.floor(a2 * 10)] = true;
      }
    }
    return h3;
  }
};
var De4 = class {
  constructor(t8, e7) {
    this.from = t8, this.heights = e7, this.index = 0;
  }
  get more() {
    return this.index < this.heights.length;
  }
};
var X6 = class s98 {
  constructor(t8, e7, i12, n14, o) {
    this.from = t8, this.length = e7, this.top = i12, this.height = n14, this._content = o;
  }
  get type() {
    return typeof this._content == "number" ? F7.Text : Array.isArray(this._content) ? this._content : this._content.type;
  }
  get to() {
    return this.from + this.length;
  }
  get bottom() {
    return this.top + this.height;
  }
  get widget() {
    return this._content instanceof ht4 ? this._content.widget : null;
  }
  get widgetLineBreaks() {
    return typeof this._content == "number" ? this._content : 0;
  }
  join(t8) {
    let e7 = (Array.isArray(this._content) ? this._content : [this]).concat(Array.isArray(t8._content) ? t8._content : [t8]);
    return new s98(this.from, this.length + t8.length, this.top, this.height + t8.height, e7);
  }
};
var T6 = function(s212) {
  return s212[s212.ByPos = 0] = "ByPos", s212[s212.ByHeight = 1] = "ByHeight", s212[s212.ByPosNoHeight = 2] = "ByPosNoHeight", s212;
}(T6 || (T6 = {}));
var ge5 = 1e-3;
var z6 = class s99 {
  constructor(t8, e7, i12 = 2) {
    this.length = t8, this.height = e7, this.flags = i12;
  }
  get outdated() {
    return (this.flags & 2) > 0;
  }
  set outdated(t8) {
    this.flags = (t8 ? 2 : 0) | this.flags & -3;
  }
  setHeight(t8) {
    this.height != t8 && (Math.abs(this.height - t8) > ge5 && (mt4 = true), this.height = t8);
  }
  replace(t8, e7, i12) {
    return s99.of(i12);
  }
  decomposeLeft(t8, e7) {
    e7.push(this);
  }
  decomposeRight(t8, e7) {
    e7.push(this);
  }
  applyChanges(t8, e7, i12, n14) {
    let o = this, r2 = i12.doc;
    for (let l11 = n14.length - 1; l11 >= 0; l11--) {
      let { fromA: h3, toA: c3, fromB: a2, toB: f6 } = n14[l11], d4 = o.lineAt(h3, T6.ByPosNoHeight, i12.setDoc(e7), 0, 0), u3 = d4.to >= c3 ? d4 : o.lineAt(c3, T6.ByPosNoHeight, i12, 0, 0);
      for (f6 += u3.to - c3, c3 = u3.to; l11 > 0 && d4.from <= n14[l11 - 1].toA; ) h3 = n14[l11 - 1].fromA, a2 = n14[l11 - 1].fromB, l11--, h3 < d4.from && (d4 = o.lineAt(h3, T6.ByPosNoHeight, i12, 0, 0));
      a2 += d4.from - h3, h3 = d4.from;
      let p3 = pi3.build(i12.setDoc(r2), t8, a2, f6);
      o = Oe4(o, o.replace(h3, c3, p3));
    }
    return o.updateHeight(i12, 0);
  }
  static empty() {
    return new I6(0, 0);
  }
  static of(t8) {
    if (t8.length == 1) return t8[0];
    let e7 = 0, i12 = t8.length, n14 = 0, o = 0;
    for (; ; ) if (e7 == i12) if (n14 > o * 2) {
      let l11 = t8[e7 - 1];
      l11.break ? t8.splice(--e7, 1, l11.left, null, l11.right) : t8.splice(--e7, 1, l11.left, l11.right), i12 += 1 + l11.break, n14 -= l11.size;
    } else if (o > n14 * 2) {
      let l11 = t8[i12];
      l11.break ? t8.splice(i12, 1, l11.left, null, l11.right) : t8.splice(i12, 1, l11.left, l11.right), i12 += 2 + l11.break, o -= l11.size;
    } else break;
    else if (n14 < o) {
      let l11 = t8[e7++];
      l11 && (n14 += l11.size);
    } else {
      let l11 = t8[--i12];
      l11 && (o += l11.size);
    }
    let r2 = 0;
    return t8[e7 - 1] == null ? (r2 = 1, e7--) : t8[e7] == null && (r2 = 1, i12++), new ui3(s99.of(t8.slice(0, e7)), r2, s99.of(t8.slice(i12)));
  }
};
function Oe4(s212, t8) {
  return s212 == t8 ? s212 : (s212.constructor != t8.constructor && (mt4 = true), t8);
}
z6.prototype.size = 1;
var Te4 = class extends z6 {
  constructor(t8, e7, i12) {
    super(t8, e7), this.deco = i12;
  }
  blockAt(t8, e7, i12, n14) {
    return new X6(n14, this.length, i12, this.height, this.deco || 0);
  }
  lineAt(t8, e7, i12, n14, o) {
    return this.blockAt(0, i12, n14, o);
  }
  forEachLine(t8, e7, i12, n14, o, r2) {
    t8 <= o + this.length && e7 >= o && r2(this.blockAt(0, i12, n14, o));
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    return n14 && n14.from <= e7 && n14.more && this.setHeight(n14.heights[n14.index++]), this.outdated = false, this;
  }
  toString() {
    return `block(${this.length})`;
  }
};
var I6 = class s100 extends Te4 {
  constructor(t8, e7) {
    super(t8, e7, null), this.collapsed = 0, this.widgetHeight = 0, this.breaks = 0;
  }
  blockAt(t8, e7, i12, n14) {
    return new X6(n14, this.length, i12, this.height, this.breaks);
  }
  replace(t8, e7, i12) {
    let n14 = i12[0];
    return i12.length == 1 && (n14 instanceof s100 || n14 instanceof ot5 && n14.flags & 4) && Math.abs(this.length - n14.length) < 10 ? (n14 instanceof ot5 ? n14 = new s100(n14.length, this.height) : n14.height = this.height, this.outdated || (n14.outdated = false), n14) : z6.of(i12);
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    return n14 && n14.from <= e7 && n14.more ? this.setHeight(n14.heights[n14.index++]) : (i12 || this.outdated) && this.setHeight(Math.max(this.widgetHeight, t8.heightForLine(this.length - this.collapsed)) + this.breaks * t8.lineHeight), this.outdated = false, this;
  }
  toString() {
    return `line(${this.length}${this.collapsed ? -this.collapsed : ""}${this.widgetHeight ? ":" + this.widgetHeight : ""})`;
  }
};
var ot5 = class s101 extends z6 {
  constructor(t8) {
    super(t8, 0);
  }
  heightMetrics(t8, e7) {
    let i12 = t8.doc.lineAt(e7).number, n14 = t8.doc.lineAt(e7 + this.length).number, o = n14 - i12 + 1, r2, l11 = 0;
    if (t8.lineWrapping) {
      let h3 = Math.min(this.height, t8.lineHeight * o);
      r2 = h3 / o, this.length > o + 1 && (l11 = (this.height - h3) / (this.length - o - 1));
    } else r2 = this.height / o;
    return { firstLine: i12, lastLine: n14, perLine: r2, perChar: l11 };
  }
  blockAt(t8, e7, i12, n14) {
    let { firstLine: o, lastLine: r2, perLine: l11, perChar: h3 } = this.heightMetrics(e7, n14);
    if (e7.lineWrapping) {
      let c3 = n14 + (t8 < e7.lineHeight ? 0 : Math.round(Math.max(0, Math.min(1, (t8 - i12) / this.height)) * this.length)), a2 = e7.doc.lineAt(c3), f6 = l11 + a2.length * h3, d4 = Math.max(i12, t8 - f6 / 2);
      return new X6(a2.from, a2.length, d4, f6, 0);
    } else {
      let c3 = Math.max(0, Math.min(r2 - o, Math.floor((t8 - i12) / l11))), { from: a2, length: f6 } = e7.doc.line(o + c3);
      return new X6(a2, f6, i12 + l11 * c3, l11, 0);
    }
  }
  lineAt(t8, e7, i12, n14, o) {
    if (e7 == T6.ByHeight) return this.blockAt(t8, i12, n14, o);
    if (e7 == T6.ByPosNoHeight) {
      let { from: u3, to: p3 } = i12.doc.lineAt(t8);
      return new X6(u3, p3 - u3, 0, 0, 0);
    }
    let { firstLine: r2, perLine: l11, perChar: h3 } = this.heightMetrics(i12, o), c3 = i12.doc.lineAt(t8), a2 = l11 + c3.length * h3, f6 = c3.number - r2, d4 = n14 + l11 * f6 + h3 * (c3.from - o - f6);
    return new X6(c3.from, c3.length, Math.max(n14, Math.min(d4, n14 + this.height - a2)), a2, 0);
  }
  forEachLine(t8, e7, i12, n14, o, r2) {
    t8 = Math.max(t8, o), e7 = Math.min(e7, o + this.length);
    let { firstLine: l11, perLine: h3, perChar: c3 } = this.heightMetrics(i12, o);
    for (let a2 = t8, f6 = n14; a2 <= e7; ) {
      let d4 = i12.doc.lineAt(a2);
      if (a2 == t8) {
        let p3 = d4.number - l11;
        f6 += h3 * p3 + c3 * (t8 - o - p3);
      }
      let u3 = h3 + c3 * d4.length;
      r2(new X6(d4.from, d4.length, f6, u3, 0)), f6 += u3, a2 = d4.to + 1;
    }
  }
  replace(t8, e7, i12) {
    let n14 = this.length - e7;
    if (n14 > 0) {
      let o = i12[i12.length - 1];
      o instanceof s101 ? i12[i12.length - 1] = new s101(o.length + n14) : i12.push(null, new s101(n14 - 1));
    }
    if (t8 > 0) {
      let o = i12[0];
      o instanceof s101 ? i12[0] = new s101(t8 + o.length) : i12.unshift(new s101(t8 - 1), null);
    }
    return z6.of(i12);
  }
  decomposeLeft(t8, e7) {
    e7.push(new s101(t8 - 1), null);
  }
  decomposeRight(t8, e7) {
    e7.push(null, new s101(this.length - t8 - 1));
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    let o = e7 + this.length;
    if (n14 && n14.from <= e7 + this.length && n14.more) {
      let r2 = [], l11 = Math.max(e7, n14.from), h3 = -1;
      for (n14.from > e7 && r2.push(new s101(n14.from - e7 - 1).updateHeight(t8, e7)); l11 <= o && n14.more; ) {
        let a2 = t8.doc.lineAt(l11).length;
        r2.length && r2.push(null);
        let f6 = n14.heights[n14.index++];
        h3 == -1 ? h3 = f6 : Math.abs(f6 - h3) >= ge5 && (h3 = -2);
        let d4 = new I6(a2, f6);
        d4.outdated = false, r2.push(d4), l11 += a2 + 1;
      }
      l11 <= o && r2.push(null, new s101(o - l11).updateHeight(t8, l11));
      let c3 = z6.of(r2);
      return (h3 < 0 || Math.abs(c3.height - this.height) >= ge5 || Math.abs(h3 - this.heightMetrics(t8, e7).perLine) >= ge5) && (mt4 = true), Oe4(this, c3);
    } else (i12 || this.outdated) && (this.setHeight(t8.heightForGap(e7, e7 + this.length)), this.outdated = false);
    return this;
  }
  toString() {
    return `gap(${this.length})`;
  }
};
var ui3 = class extends z6 {
  constructor(t8, e7, i12) {
    super(t8.length + e7 + i12.length, t8.height + i12.height, e7 | (t8.outdated || i12.outdated ? 2 : 0)), this.left = t8, this.right = i12, this.size = t8.size + i12.size;
  }
  get break() {
    return this.flags & 1;
  }
  blockAt(t8, e7, i12, n14) {
    let o = i12 + this.left.height;
    return t8 < o ? this.left.blockAt(t8, e7, i12, n14) : this.right.blockAt(t8, e7, o, n14 + this.left.length + this.break);
  }
  lineAt(t8, e7, i12, n14, o) {
    let r2 = n14 + this.left.height, l11 = o + this.left.length + this.break, h3 = e7 == T6.ByHeight ? t8 < r2 : t8 < l11, c3 = h3 ? this.left.lineAt(t8, e7, i12, n14, o) : this.right.lineAt(t8, e7, i12, r2, l11);
    if (this.break || (h3 ? c3.to < l11 : c3.from > l11)) return c3;
    let a2 = e7 == T6.ByPosNoHeight ? T6.ByPosNoHeight : T6.ByPos;
    return h3 ? c3.join(this.right.lineAt(l11, a2, i12, r2, l11)) : this.left.lineAt(l11, a2, i12, n14, o).join(c3);
  }
  forEachLine(t8, e7, i12, n14, o, r2) {
    let l11 = n14 + this.left.height, h3 = o + this.left.length + this.break;
    if (this.break) t8 < h3 && this.left.forEachLine(t8, e7, i12, n14, o, r2), e7 >= h3 && this.right.forEachLine(t8, e7, i12, l11, h3, r2);
    else {
      let c3 = this.lineAt(h3, T6.ByPos, i12, n14, o);
      t8 < c3.from && this.left.forEachLine(t8, c3.from - 1, i12, n14, o, r2), c3.to >= t8 && c3.from <= e7 && r2(c3), e7 > c3.to && this.right.forEachLine(c3.to + 1, e7, i12, l11, h3, r2);
    }
  }
  replace(t8, e7, i12) {
    let n14 = this.left.length + this.break;
    if (e7 < n14) return this.balanced(this.left.replace(t8, e7, i12), this.right);
    if (t8 > this.left.length) return this.balanced(this.left, this.right.replace(t8 - n14, e7 - n14, i12));
    let o = [];
    t8 > 0 && this.decomposeLeft(t8, o);
    let r2 = o.length;
    for (let l11 of i12) o.push(l11);
    if (t8 > 0 && ps3(o, r2 - 1), e7 < this.length) {
      let l11 = o.length;
      this.decomposeRight(e7, o), ps3(o, l11);
    }
    return z6.of(o);
  }
  decomposeLeft(t8, e7) {
    let i12 = this.left.length;
    if (t8 <= i12) return this.left.decomposeLeft(t8, e7);
    e7.push(this.left), this.break && (i12++, t8 >= i12 && e7.push(null)), t8 > i12 && this.right.decomposeLeft(t8 - i12, e7);
  }
  decomposeRight(t8, e7) {
    let i12 = this.left.length, n14 = i12 + this.break;
    if (t8 >= n14) return this.right.decomposeRight(t8 - n14, e7);
    t8 < i12 && this.left.decomposeRight(t8, e7), this.break && t8 < n14 && e7.push(null), e7.push(this.right);
  }
  balanced(t8, e7) {
    return t8.size > 2 * e7.size || e7.size > 2 * t8.size ? z6.of(this.break ? [t8, null, e7] : [t8, e7]) : (this.left = Oe4(this.left, t8), this.right = Oe4(this.right, e7), this.setHeight(t8.height + e7.height), this.outdated = t8.outdated || e7.outdated, this.size = t8.size + e7.size, this.length = t8.length + this.break + e7.length, this);
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    let { left: o, right: r2 } = this, l11 = e7 + o.length + this.break, h3 = null;
    return n14 && n14.from <= e7 + o.length && n14.more ? h3 = o = o.updateHeight(t8, e7, i12, n14) : o.updateHeight(t8, e7, i12), n14 && n14.from <= l11 + r2.length && n14.more ? h3 = r2 = r2.updateHeight(t8, l11, i12, n14) : r2.updateHeight(t8, l11, i12), h3 ? this.balanced(o, r2) : (this.height = this.left.height + this.right.height, this.outdated = false, this);
  }
  toString() {
    return this.left + (this.break ? " " : "-") + this.right;
  }
};
function ps3(s212, t8) {
  let e7, i12;
  s212[t8] == null && (e7 = s212[t8 - 1]) instanceof ot5 && (i12 = s212[t8 + 1]) instanceof ot5 && s212.splice(t8 - 1, 3, new ot5(e7.length + 1 + i12.length));
}
var tr3 = 5;
var pi3 = class s102 {
  constructor(t8, e7) {
    this.pos = t8, this.oracle = e7, this.nodes = [], this.lineStart = -1, this.lineEnd = -1, this.covering = null, this.writtenTo = t8;
  }
  get isCovered() {
    return this.covering && this.nodes[this.nodes.length - 1] == this.covering;
  }
  span(t8, e7) {
    if (this.lineStart > -1) {
      let i12 = Math.min(e7, this.lineEnd), n14 = this.nodes[this.nodes.length - 1];
      n14 instanceof I6 ? n14.length += i12 - this.pos : (i12 > this.pos || !this.isCovered) && this.nodes.push(new I6(i12 - this.pos, -1)), this.writtenTo = i12, e7 > i12 && (this.nodes.push(null), this.writtenTo++, this.lineStart = -1);
    }
    this.pos = e7;
  }
  point(t8, e7, i12) {
    if (t8 < e7 || i12.heightRelevant) {
      let n14 = i12.widget ? i12.widget.estimatedHeight : 0, o = i12.widget ? i12.widget.lineBreaks : 0;
      n14 < 0 && (n14 = this.oracle.lineHeight);
      let r2 = e7 - t8;
      i12.block ? this.addBlock(new Te4(r2, n14, i12)) : (r2 || o || n14 >= tr3) && this.addLineDeco(n14, o, r2);
    } else e7 > t8 && this.span(t8, e7);
    this.lineEnd > -1 && this.lineEnd < this.pos && (this.lineEnd = this.oracle.doc.lineAt(this.pos).to);
  }
  enterLine() {
    if (this.lineStart > -1) return;
    let { from: t8, to: e7 } = this.oracle.doc.lineAt(this.pos);
    this.lineStart = t8, this.lineEnd = e7, this.writtenTo < t8 && ((this.writtenTo < t8 - 1 || this.nodes[this.nodes.length - 1] == null) && this.nodes.push(this.blankContent(this.writtenTo, t8 - 1)), this.nodes.push(null)), this.pos > t8 && this.nodes.push(new I6(this.pos - t8, -1)), this.writtenTo = this.pos;
  }
  blankContent(t8, e7) {
    let i12 = new ot5(e7 - t8);
    return this.oracle.doc.lineAt(t8).to == e7 && (i12.flags |= 4), i12;
  }
  ensureLine() {
    this.enterLine();
    let t8 = this.nodes.length ? this.nodes[this.nodes.length - 1] : null;
    if (t8 instanceof I6) return t8;
    let e7 = new I6(0, -1);
    return this.nodes.push(e7), e7;
  }
  addBlock(t8) {
    this.enterLine();
    let e7 = t8.deco;
    e7 && e7.startSide > 0 && !this.isCovered && this.ensureLine(), this.nodes.push(t8), this.writtenTo = this.pos = this.pos + t8.length, e7 && e7.endSide > 0 && (this.covering = t8);
  }
  addLineDeco(t8, e7, i12) {
    let n14 = this.ensureLine();
    n14.length += i12, n14.collapsed += i12, n14.widgetHeight = Math.max(n14.widgetHeight, t8), n14.breaks += e7, this.writtenTo = this.pos = this.pos + i12;
  }
  finish(t8) {
    let e7 = this.nodes.length == 0 ? null : this.nodes[this.nodes.length - 1];
    this.lineStart > -1 && !(e7 instanceof I6) && !this.isCovered ? this.nodes.push(new I6(0, -1)) : (this.writtenTo < this.pos || e7 == null) && this.nodes.push(this.blankContent(this.writtenTo, this.pos));
    let i12 = t8;
    for (let n14 of this.nodes) n14 instanceof I6 && n14.updateHeight(this.oracle, i12), i12 += n14 ? n14.length : 1;
    return this.nodes;
  }
  static build(t8, e7, i12, n14) {
    let o = new s102(i12, t8);
    return T.spans(e7, i12, n14, o, 0), o.finish(i12);
  }
};
function er3(s212, t8, e7) {
  let i12 = new gi3();
  return T.compare(s212, t8, e7, i12, 0), i12.changes;
}
var gi3 = class {
  constructor() {
    this.changes = [];
  }
  compareRange() {
  }
  comparePoint(t8, e7, i12, n14) {
    (t8 < e7 || i12 && i12.heightRelevant || n14 && n14.heightRelevant) && ti3(t8, e7, this.changes, 5);
  }
};
function ir3(s212, t8) {
  let e7 = s212.getBoundingClientRect(), i12 = s212.ownerDocument, n14 = i12.defaultView || window, o = Math.max(0, e7.left), r2 = Math.min(n14.innerWidth, e7.right), l11 = Math.max(0, e7.top), h3 = Math.min(n14.innerHeight, e7.bottom);
  for (let c3 = s212.parentNode; c3 && c3 != i12.body; ) if (c3.nodeType == 1) {
    let a2 = c3, f6 = window.getComputedStyle(a2);
    if ((a2.scrollHeight > a2.clientHeight || a2.scrollWidth > a2.clientWidth) && f6.overflow != "visible") {
      let d4 = a2.getBoundingClientRect();
      o = Math.max(o, d4.left), r2 = Math.min(r2, d4.right), l11 = Math.max(l11, d4.top), h3 = Math.min(c3 == s212.parentNode ? n14.innerHeight : h3, d4.bottom);
    }
    c3 = f6.position == "absolute" || f6.position == "fixed" ? a2.offsetParent : a2.parentNode;
  } else if (c3.nodeType == 11) c3 = c3.host;
  else break;
  return { left: o - e7.left, right: Math.max(o, r2) - e7.left, top: l11 - (e7.top + t8), bottom: Math.max(l11, h3) - (e7.top + t8) };
}
function sr3(s212, t8) {
  let e7 = s212.getBoundingClientRect();
  return { left: 0, right: e7.right - e7.left, top: t8, bottom: e7.bottom - (e7.top + t8) };
}
var It4 = class {
  constructor(t8, e7, i12, n14) {
    this.from = t8, this.to = e7, this.size = i12, this.displaySize = n14;
  }
  static same(t8, e7) {
    if (t8.length != e7.length) return false;
    for (let i12 = 0; i12 < t8.length; i12++) {
      let n14 = t8[i12], o = e7[i12];
      if (n14.from != o.from || n14.to != o.to || n14.size != o.size) return false;
    }
    return true;
  }
  draw(t8, e7) {
    return O5.replace({ widget: new mi3(this.displaySize * (e7 ? t8.scaleY : t8.scaleX), e7) }).range(this.from, this.to);
  }
};
var mi3 = class extends lt4 {
  constructor(t8, e7) {
    super(), this.size = t8, this.vertical = e7;
  }
  eq(t8) {
    return t8.size == this.size && t8.vertical == this.vertical;
  }
  toDOM() {
    let t8 = document.createElement("div");
    return this.vertical ? t8.style.height = this.size + "px" : (t8.style.width = this.size + "px", t8.style.height = "2px", t8.style.display = "inline-block"), t8;
  }
  get estimatedHeight() {
    return this.vertical ? this.size : -1;
  }
};
var Re5 = class {
  constructor(t8) {
    this.state = t8, this.pixelViewport = { left: 0, right: window.innerWidth, top: 0, bottom: 0 }, this.inView = true, this.paddingTop = 0, this.paddingBottom = 0, this.contentDOMWidth = 0, this.contentDOMHeight = 0, this.editorHeight = 0, this.editorWidth = 0, this.scrollTop = 0, this.scrolledToBottom = false, this.scaleX = 1, this.scaleY = 1, this.scrollAnchorPos = 0, this.scrollAnchorHeight = -1, this.scaler = gs3, this.scrollTarget = null, this.printing = false, this.mustMeasureContent = true, this.defaultTextDirection = L5.LTR, this.visibleRanges = [], this.mustEnforceCursorAssoc = false;
    let e7 = t8.facet(Ve5).some((i12) => typeof i12 != "function" && i12.class == "cm-lineWrapping");
    this.heightOracle = new Ae5(e7), this.stateDeco = t8.facet(Ut4).filter((i12) => typeof i12 != "function"), this.heightMap = z6.empty().applyChanges(this.stateDeco, m.empty, this.heightOracle.setDoc(t8.doc), [new j6(0, 0, 0, t8.doc.length)]);
    for (let i12 = 0; i12 < 2 && (this.viewport = this.getViewport(0, null), !!this.updateForViewport()); i12++) ;
    this.updateViewportLines(), this.lineGaps = this.ensureLineGaps([]), this.lineGapDeco = O5.set(this.lineGaps.map((i12) => i12.draw(this, false))), this.computeVisibleRanges();
  }
  updateForViewport() {
    let t8 = [this.viewport], { main: e7 } = this.state.selection;
    for (let i12 = 0; i12 <= 1; i12++) {
      let n14 = i12 ? e7.head : e7.anchor;
      if (!t8.some(({ from: o, to: r2 }) => n14 >= o && n14 <= r2)) {
        let { from: o, to: r2 } = this.lineBlockAt(n14);
        t8.push(new xt4(o, r2));
      }
    }
    return this.viewports = t8.sort((i12, n14) => i12.from - n14.from), this.updateScaler();
  }
  updateScaler() {
    let t8 = this.scaler;
    return this.scaler = this.heightMap.height <= 7e6 ? gs3 : new bi3(this.heightOracle, this.heightMap, this.viewports), t8.eq(this.scaler) ? 0 : 2;
  }
  updateViewportLines() {
    this.viewportLines = [], this.heightMap.forEachLine(this.viewport.from, this.viewport.to, this.heightOracle.setDoc(this.state.doc), 0, 0, (t8) => {
      this.viewportLines.push(Pt3(t8, this.scaler));
    });
  }
  update(t8, e7 = null) {
    this.state = t8.state;
    let i12 = this.stateDeco;
    this.stateDeco = this.state.facet(Ut4).filter((a2) => typeof a2 != "function");
    let n14 = t8.changedRanges, o = j6.extendWithRanges(n14, er3(i12, this.stateDeco, t8 ? t8.changes : A.empty(this.state.doc.length))), r2 = this.heightMap.height, l11 = this.scrolledToBottom ? null : this.scrollAnchorAt(this.scrollTop);
    di3(), this.heightMap = this.heightMap.applyChanges(this.stateDeco, t8.startState.doc, this.heightOracle.setDoc(this.state.doc), o), (this.heightMap.height != r2 || mt4) && (t8.flags |= 2), l11 ? (this.scrollAnchorPos = t8.changes.mapPos(l11.from, -1), this.scrollAnchorHeight = l11.top) : (this.scrollAnchorPos = -1, this.scrollAnchorHeight = this.heightMap.height);
    let h3 = o.length ? this.mapViewport(this.viewport, t8.changes) : this.viewport;
    (e7 && (e7.range.head < h3.from || e7.range.head > h3.to) || !this.viewportIsAppropriate(h3)) && (h3 = this.getViewport(0, e7));
    let c3 = h3.from != this.viewport.from || h3.to != this.viewport.to;
    this.viewport = h3, t8.flags |= this.updateForViewport(), (c3 || !t8.changes.empty || t8.flags & 2) && this.updateViewportLines(), (this.lineGaps.length || this.viewport.to - this.viewport.from > 4e3) && this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps, t8.changes))), t8.flags |= this.computeVisibleRanges(), e7 && (this.scrollTarget = e7), !this.mustEnforceCursorAssoc && t8.selectionSet && t8.view.lineWrapping && t8.state.selection.main.empty && t8.state.selection.main.assoc && !t8.state.facet(dn3) && (this.mustEnforceCursorAssoc = true);
  }
  measure(t8) {
    let e7 = t8.contentDOM, i12 = window.getComputedStyle(e7), n14 = this.heightOracle, o = i12.whiteSpace;
    this.defaultTextDirection = i12.direction == "rtl" ? L5.RTL : L5.LTR;
    let r2 = this.heightOracle.mustRefreshForWrapping(o), l11 = e7.getBoundingClientRect(), h3 = r2 || this.mustMeasureContent || this.contentDOMHeight != l11.height;
    this.contentDOMHeight = l11.height, this.mustMeasureContent = false;
    let c3 = 0, a2 = 0;
    if (l11.width && l11.height) {
      let { scaleX: x11, scaleY: S17 } = Vs(e7, l11);
      (x11 > 5e-3 && Math.abs(this.scaleX - x11) > 5e-3 || S17 > 5e-3 && Math.abs(this.scaleY - S17) > 5e-3) && (this.scaleX = x11, this.scaleY = S17, c3 |= 8, r2 = h3 = true);
    }
    let f6 = (parseInt(i12.paddingTop) || 0) * this.scaleY, d4 = (parseInt(i12.paddingBottom) || 0) * this.scaleY;
    (this.paddingTop != f6 || this.paddingBottom != d4) && (this.paddingTop = f6, this.paddingBottom = d4, c3 |= 10), this.editorWidth != t8.scrollDOM.clientWidth && (n14.lineWrapping && (h3 = true), this.editorWidth = t8.scrollDOM.clientWidth, c3 |= 8);
    let u3 = t8.scrollDOM.scrollTop * this.scaleY;
    this.scrollTop != u3 && (this.scrollAnchorHeight = -1, this.scrollTop = u3), this.scrolledToBottom = zs3(t8.scrollDOM);
    let p3 = (this.printing ? sr3 : ir3)(e7, this.paddingTop), g8 = p3.top - this.pixelViewport.top, b12 = p3.bottom - this.pixelViewport.bottom;
    this.pixelViewport = p3;
    let m11 = this.pixelViewport.bottom > this.pixelViewport.top && this.pixelViewport.right > this.pixelViewport.left;
    if (m11 != this.inView && (this.inView = m11, m11 && (h3 = true)), !this.inView && !this.scrollTarget) return 0;
    let w14 = l11.width;
    if ((this.contentDOMWidth != w14 || this.editorHeight != t8.scrollDOM.clientHeight) && (this.contentDOMWidth = l11.width, this.editorHeight = t8.scrollDOM.clientHeight, c3 |= 8), h3) {
      let x11 = t8.docView.measureVisibleLineHeights(this.viewport);
      if (n14.mustRefreshForHeights(x11) && (r2 = true), r2 || n14.lineWrapping && Math.abs(w14 - this.contentDOMWidth) > n14.charWidth) {
        let { lineHeight: S17, charWidth: C11, textHeight: E11 } = t8.docView.measureTextSize();
        r2 = S17 > 0 && n14.refresh(o, S17, C11, E11, w14 / C11, x11), r2 && (t8.docView.minWidth = 0, c3 |= 8);
      }
      g8 > 0 && b12 > 0 ? a2 = Math.max(g8, b12) : g8 < 0 && b12 < 0 && (a2 = Math.min(g8, b12)), di3();
      for (let S17 of this.viewports) {
        let C11 = S17.from == this.viewport.from ? x11 : t8.docView.measureVisibleLineHeights(S17);
        this.heightMap = (r2 ? z6.empty().applyChanges(this.stateDeco, m.empty, this.heightOracle, [new j6(0, 0, 0, t8.state.doc.length)]) : this.heightMap).updateHeight(n14, 0, r2, new De4(S17.from, C11));
      }
      mt4 && (c3 |= 2);
    }
    let v10 = !this.viewportIsAppropriate(this.viewport, a2) || this.scrollTarget && (this.scrollTarget.range.head < this.viewport.from || this.scrollTarget.range.head > this.viewport.to);
    return v10 && (c3 & 2 && (c3 |= this.updateScaler()), this.viewport = this.getViewport(a2, this.scrollTarget), c3 |= this.updateForViewport()), (c3 & 2 || v10) && this.updateViewportLines(), (this.lineGaps.length || this.viewport.to - this.viewport.from > 4e3) && this.updateLineGaps(this.ensureLineGaps(r2 ? [] : this.lineGaps, t8)), c3 |= this.computeVisibleRanges(), this.mustEnforceCursorAssoc && (this.mustEnforceCursorAssoc = false, t8.docView.enforceCursorAssoc()), c3;
  }
  get visibleTop() {
    return this.scaler.fromDOM(this.pixelViewport.top);
  }
  get visibleBottom() {
    return this.scaler.fromDOM(this.pixelViewport.bottom);
  }
  getViewport(t8, e7) {
    let i12 = 0.5 - Math.max(-0.5, Math.min(0.5, t8 / 1e3 / 2)), n14 = this.heightMap, o = this.heightOracle, { visibleTop: r2, visibleBottom: l11 } = this, h3 = new xt4(n14.lineAt(r2 - i12 * 1e3, T6.ByHeight, o, 0, 0).from, n14.lineAt(l11 + (1 - i12) * 1e3, T6.ByHeight, o, 0, 0).to);
    if (e7) {
      let { head: c3 } = e7.range;
      if (c3 < h3.from || c3 > h3.to) {
        let a2 = Math.min(this.editorHeight, this.pixelViewport.bottom - this.pixelViewport.top), f6 = n14.lineAt(c3, T6.ByPos, o, 0, 0), d4;
        e7.y == "center" ? d4 = (f6.top + f6.bottom) / 2 - a2 / 2 : e7.y == "start" || e7.y == "nearest" && c3 < h3.from ? d4 = f6.top : d4 = f6.bottom - a2, h3 = new xt4(n14.lineAt(d4 - 1e3 / 2, T6.ByHeight, o, 0, 0).from, n14.lineAt(d4 + a2 + 1e3 / 2, T6.ByHeight, o, 0, 0).to);
      }
    }
    return h3;
  }
  mapViewport(t8, e7) {
    let i12 = e7.mapPos(t8.from, -1), n14 = e7.mapPos(t8.to, 1);
    return new xt4(this.heightMap.lineAt(i12, T6.ByPos, this.heightOracle, 0, 0).from, this.heightMap.lineAt(n14, T6.ByPos, this.heightOracle, 0, 0).to);
  }
  viewportIsAppropriate({ from: t8, to: e7 }, i12 = 0) {
    if (!this.inView) return true;
    let { top: n14 } = this.heightMap.lineAt(t8, T6.ByPos, this.heightOracle, 0, 0), { bottom: o } = this.heightMap.lineAt(e7, T6.ByPos, this.heightOracle, 0, 0), { visibleTop: r2, visibleBottom: l11 } = this;
    return (t8 == 0 || n14 <= r2 - Math.max(10, Math.min(-i12, 250))) && (e7 == this.state.doc.length || o >= l11 + Math.max(10, Math.min(i12, 250))) && n14 > r2 - 2 * 1e3 && o < l11 + 2 * 1e3;
  }
  mapLineGaps(t8, e7) {
    if (!t8.length || e7.empty) return t8;
    let i12 = [];
    for (let n14 of t8) e7.touchesRange(n14.from, n14.to) || i12.push(new It4(e7.mapPos(n14.from), e7.mapPos(n14.to), n14.size, n14.displaySize));
    return i12;
  }
  ensureLineGaps(t8, e7) {
    let i12 = this.heightOracle.lineWrapping, n14 = i12 ? 1e4 : 2e3, o = n14 >> 1, r2 = n14 << 1;
    if (this.defaultTextDirection != L5.LTR && !i12) return [];
    let l11 = [], h3 = (a2, f6, d4, u3) => {
      if (f6 - a2 < o) return;
      let p3 = this.state.selection.main, g8 = [p3.from];
      p3.empty || g8.push(p3.to);
      for (let m11 of g8) if (m11 > a2 && m11 < f6) {
        h3(a2, m11 - 10, d4, u3), h3(m11 + 10, f6, d4, u3);
        return;
      }
      let b12 = or3(t8, (m11) => m11.from >= d4.from && m11.to <= d4.to && Math.abs(m11.from - a2) < o && Math.abs(m11.to - f6) < o && !g8.some((w14) => m11.from < w14 && m11.to > w14));
      if (!b12) {
        if (f6 < d4.to && e7 && i12 && e7.visibleRanges.some((v10) => v10.from <= f6 && v10.to >= f6)) {
          let v10 = e7.moveToLineBoundary(x.cursor(f6), false, true).head;
          v10 > a2 && (f6 = v10);
        }
        let m11 = this.gapSize(d4, a2, f6, u3), w14 = i12 || m11 < 2e6 ? m11 : 2e6;
        b12 = new It4(a2, f6, m11, w14);
      }
      l11.push(b12);
    }, c3 = (a2) => {
      if (a2.length < r2 || a2.type != F7.Text) return;
      let f6 = nr3(a2.from, a2.to, this.stateDeco);
      if (f6.total < r2) return;
      let d4 = this.scrollTarget ? this.scrollTarget.range.head : null, u3, p3;
      if (i12) {
        let g8 = n14 / this.heightOracle.lineLength * this.heightOracle.lineHeight, b12, m11;
        if (d4 != null) {
          let w14 = ae4(f6, d4), v10 = ((this.visibleBottom - this.visibleTop) / 2 + g8) / a2.height;
          b12 = w14 - v10, m11 = w14 + v10;
        } else b12 = (this.visibleTop - a2.top - g8) / a2.height, m11 = (this.visibleBottom - a2.top + g8) / a2.height;
        u3 = he4(f6, b12), p3 = he4(f6, m11);
      } else {
        let g8 = f6.total * this.heightOracle.charWidth, b12 = n14 * this.heightOracle.charWidth, m11 = 0;
        if (g8 > 2e6) for (let C11 of t8) C11.from >= a2.from && C11.from < a2.to && C11.size != C11.displaySize && C11.from * this.heightOracle.charWidth + m11 < this.pixelViewport.left && (m11 = C11.size - C11.displaySize);
        let w14 = this.pixelViewport.left + m11, v10 = this.pixelViewport.right + m11, x11, S17;
        if (d4 != null) {
          let C11 = ae4(f6, d4), E11 = ((v10 - w14) / 2 + b12) / g8;
          x11 = C11 - E11, S17 = C11 + E11;
        } else x11 = (w14 - b12) / g8, S17 = (v10 + b12) / g8;
        u3 = he4(f6, x11), p3 = he4(f6, S17);
      }
      u3 > a2.from && h3(a2.from, u3, a2, f6), p3 < a2.to && h3(p3, a2.to, a2, f6);
    };
    for (let a2 of this.viewportLines) Array.isArray(a2.type) ? a2.type.forEach(c3) : c3(a2);
    return l11;
  }
  gapSize(t8, e7, i12, n14) {
    let o = ae4(n14, i12) - ae4(n14, e7);
    return this.heightOracle.lineWrapping ? t8.height * o : n14.total * this.heightOracle.charWidth * o;
  }
  updateLineGaps(t8) {
    It4.same(t8, this.lineGaps) || (this.lineGaps = t8, this.lineGapDeco = O5.set(t8.map((e7) => e7.draw(this, this.heightOracle.lineWrapping))));
  }
  computeVisibleRanges() {
    let t8 = this.stateDeco;
    this.lineGaps.length && (t8 = t8.concat(this.lineGapDeco));
    let e7 = [];
    T.spans(t8, this.viewport.from, this.viewport.to, { span(n14, o) {
      e7.push({ from: n14, to: o });
    }, point() {
    } }, 20);
    let i12 = e7.length != this.visibleRanges.length || this.visibleRanges.some((n14, o) => n14.from != e7[o].from || n14.to != e7[o].to);
    return this.visibleRanges = e7, i12 ? 4 : 0;
  }
  lineBlockAt(t8) {
    return t8 >= this.viewport.from && t8 <= this.viewport.to && this.viewportLines.find((e7) => e7.from <= t8 && e7.to >= t8) || Pt3(this.heightMap.lineAt(t8, T6.ByPos, this.heightOracle, 0, 0), this.scaler);
  }
  lineBlockAtHeight(t8) {
    return t8 >= this.viewportLines[0].top && t8 <= this.viewportLines[this.viewportLines.length - 1].bottom && this.viewportLines.find((e7) => e7.top <= t8 && e7.bottom >= t8) || Pt3(this.heightMap.lineAt(this.scaler.fromDOM(t8), T6.ByHeight, this.heightOracle, 0, 0), this.scaler);
  }
  scrollAnchorAt(t8) {
    let e7 = this.lineBlockAtHeight(t8 + 8);
    return e7.from >= this.viewport.from || this.viewportLines[0].top - t8 > 200 ? e7 : this.viewportLines[0];
  }
  elementAtHeight(t8) {
    return Pt3(this.heightMap.blockAt(this.scaler.fromDOM(t8), this.heightOracle, 0, 0), this.scaler);
  }
  get docHeight() {
    return this.scaler.toDOM(this.heightMap.height);
  }
  get contentHeight() {
    return this.docHeight + this.paddingTop + this.paddingBottom;
  }
};
var xt4 = class {
  constructor(t8, e7) {
    this.from = t8, this.to = e7;
  }
};
function nr3(s212, t8, e7) {
  let i12 = [], n14 = s212, o = 0;
  return T.spans(e7, s212, t8, { span() {
  }, point(r2, l11) {
    r2 > n14 && (i12.push({ from: n14, to: r2 }), o += r2 - n14), n14 = l11;
  } }, 20), n14 < t8 && (i12.push({ from: n14, to: t8 }), o += t8 - n14), { total: o, ranges: i12 };
}
function he4({ total: s212, ranges: t8 }, e7) {
  if (e7 <= 0) return t8[0].from;
  if (e7 >= 1) return t8[t8.length - 1].to;
  let i12 = Math.floor(s212 * e7);
  for (let n14 = 0; ; n14++) {
    let { from: o, to: r2 } = t8[n14], l11 = r2 - o;
    if (i12 <= l11) return o + i12;
    i12 -= l11;
  }
}
function ae4(s212, t8) {
  let e7 = 0;
  for (let { from: i12, to: n14 } of s212.ranges) {
    if (t8 <= n14) {
      e7 += t8 - i12;
      break;
    }
    e7 += n14 - i12;
  }
  return e7 / s212.total;
}
function or3(s212, t8) {
  for (let e7 of s212) if (t8(e7)) return e7;
}
var gs3 = { toDOM(s212) {
  return s212;
}, fromDOM(s212) {
  return s212;
}, scale: 1, eq(s212) {
  return s212 == this;
} };
var bi3 = class s103 {
  constructor(t8, e7, i12) {
    let n14 = 0, o = 0, r2 = 0;
    this.viewports = i12.map(({ from: l11, to: h3 }) => {
      let c3 = e7.lineAt(l11, T6.ByPos, t8, 0, 0).top, a2 = e7.lineAt(h3, T6.ByPos, t8, 0, 0).bottom;
      return n14 += a2 - c3, { from: l11, to: h3, top: c3, bottom: a2, domTop: 0, domBottom: 0 };
    }), this.scale = (7e6 - n14) / (e7.height - n14);
    for (let l11 of this.viewports) l11.domTop = r2 + (l11.top - o) * this.scale, r2 = l11.domBottom = l11.domTop + (l11.bottom - l11.top), o = l11.bottom;
  }
  toDOM(t8) {
    for (let e7 = 0, i12 = 0, n14 = 0; ; e7++) {
      let o = e7 < this.viewports.length ? this.viewports[e7] : null;
      if (!o || t8 < o.top) return n14 + (t8 - i12) * this.scale;
      if (t8 <= o.bottom) return o.domTop + (t8 - o.top);
      i12 = o.bottom, n14 = o.domBottom;
    }
  }
  fromDOM(t8) {
    for (let e7 = 0, i12 = 0, n14 = 0; ; e7++) {
      let o = e7 < this.viewports.length ? this.viewports[e7] : null;
      if (!o || t8 < o.domTop) return i12 + (t8 - n14) / this.scale;
      if (t8 <= o.domBottom) return o.top + (t8 - o.domTop);
      i12 = o.bottom, n14 = o.domBottom;
    }
  }
  eq(t8) {
    return t8 instanceof s103 ? this.scale == t8.scale && this.viewports.length == t8.viewports.length && this.viewports.every((e7, i12) => e7.from == t8.viewports[i12].from && e7.to == t8.viewports[i12].to) : false;
  }
};
function Pt3(s212, t8) {
  if (t8.scale == 1) return s212;
  let e7 = t8.toDOM(s212.top), i12 = t8.toDOM(s212.bottom);
  return new X6(s212.from, s212.length, e7, i12 - e7, Array.isArray(s212._content) ? s212._content.map((n14) => Pt3(n14, t8)) : s212._content);
}
var ce6 = y.define({ combine: (s212) => s212.join(" ") });
var yi3 = y.define({ combine: (s212) => s212.indexOf(true) > -1 });
var wi3 = b2.newName();
var En3 = b2.newName();
var Ln3 = b2.newName();
var Bn3 = { "&light": "." + En3, "&dark": "." + Ln3 };
function xi3(s212, t8, e7) {
  return new b2(t8, { finish(i12) {
    return /&/.test(i12) ? i12.replace(/&\w*/, (n14) => {
      if (n14 == "&") return s212;
      if (!e7 || !e7[n14]) throw new RangeError(`Unsupported selector: ${n14}`);
      return e7[n14];
    }) : s212 + " " + i12;
  } });
}
var rr3 = xi3("." + wi3, { "&": { position: "relative !important", boxSizing: "border-box", "&.cm-focused": { outline: "1px dotted #212121" }, display: "flex !important", flexDirection: "column" }, ".cm-scroller": { display: "flex !important", alignItems: "flex-start !important", fontFamily: "monospace", lineHeight: 1.4, height: "100%", overflowX: "auto", position: "relative", zIndex: 0, overflowAnchor: "none" }, ".cm-content": { margin: 0, flexGrow: 2, flexShrink: 0, display: "block", whiteSpace: "pre", wordWrap: "normal", boxSizing: "border-box", minHeight: "100%", padding: "4px 0", outline: "none", "&[contenteditable=true]": { WebkitUserModify: "read-write-plaintext-only" } }, ".cm-lineWrapping": { whiteSpace_fallback: "pre-wrap", whiteSpace: "break-spaces", wordBreak: "break-word", overflowWrap: "anywhere", flexShrink: 1 }, "&light .cm-content": { caretColor: "black" }, "&dark .cm-content": { caretColor: "white" }, ".cm-line": { display: "block", padding: "0 2px 0 6px" }, ".cm-layer": { position: "absolute", left: 0, top: 0, contain: "size style", "& > *": { position: "absolute" } }, "&light .cm-selectionBackground": { background: "#d9d9d9" }, "&dark .cm-selectionBackground": { background: "#222" }, "&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground": { background: "#d7d4f0" }, "&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground": { background: "#233" }, ".cm-cursorLayer": { pointerEvents: "none" }, "&.cm-focused > .cm-scroller > .cm-cursorLayer": { animation: "steps(1) cm-blink 1.2s infinite" }, "@keyframes cm-blink": { "0%": {}, "50%": { opacity: 0 }, "100%": {} }, "@keyframes cm-blink2": { "0%": {}, "50%": { opacity: 0 }, "100%": {} }, ".cm-cursor, .cm-dropCursor": { borderLeft: "1.2px solid black", marginLeft: "-0.6px", pointerEvents: "none" }, ".cm-cursor": { display: "none" }, "&dark .cm-cursor": { borderLeftColor: "#444" }, ".cm-dropCursor": { position: "absolute" }, "&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor": { display: "block" }, ".cm-iso": { unicodeBidi: "isolate" }, ".cm-announced": { position: "fixed", top: "-10000px" }, "@media print": { ".cm-announced": { display: "none" } }, "&light .cm-activeLine": { backgroundColor: "#cceeff44" }, "&dark .cm-activeLine": { backgroundColor: "#99eeff33" }, "&light .cm-specialChar": { color: "red" }, "&dark .cm-specialChar": { color: "#f78" }, ".cm-gutters": { flexShrink: 0, display: "flex", height: "100%", boxSizing: "border-box", insetInlineStart: 0, zIndex: 200 }, "&light .cm-gutters": { backgroundColor: "#f5f5f5", color: "#6c6c6c", borderRight: "1px solid #ddd" }, "&dark .cm-gutters": { backgroundColor: "#333338", color: "#ccc" }, ".cm-gutter": { display: "flex !important", flexDirection: "column", flexShrink: 0, boxSizing: "border-box", minHeight: "100%", overflow: "hidden" }, ".cm-gutterElement": { boxSizing: "border-box" }, ".cm-lineNumbers .cm-gutterElement": { padding: "0 3px 0 5px", minWidth: "20px", textAlign: "right", whiteSpace: "nowrap" }, "&light .cm-activeLineGutter": { backgroundColor: "#e2f2ff" }, "&dark .cm-activeLineGutter": { backgroundColor: "#222227" }, ".cm-panels": { boxSizing: "border-box", position: "sticky", left: 0, right: 0, zIndex: 300 }, "&light .cm-panels": { backgroundColor: "#f5f5f5", color: "black" }, "&light .cm-panels-top": { borderBottom: "1px solid #ddd" }, "&light .cm-panels-bottom": { borderTop: "1px solid #ddd" }, "&dark .cm-panels": { backgroundColor: "#333338", color: "white" }, ".cm-tab": { display: "inline-block", overflow: "hidden", verticalAlign: "bottom" }, ".cm-widgetBuffer": { verticalAlign: "text-top", height: "1em", width: 0, display: "inline" }, ".cm-placeholder": { color: "#888", display: "inline-block", verticalAlign: "top" }, ".cm-highlightSpace": { backgroundImage: "radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)", backgroundPosition: "center" }, ".cm-highlightTab": { backgroundImage: `url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`, backgroundSize: "auto 100%", backgroundPosition: "right 90%", backgroundRepeat: "no-repeat" }, ".cm-trailingSpace": { backgroundColor: "#ff332255" }, ".cm-button": { verticalAlign: "middle", color: "inherit", fontSize: "70%", padding: ".2em 1em", borderRadius: "1px" }, "&light .cm-button": { backgroundImage: "linear-gradient(#eff1f5, #d9d9df)", border: "1px solid #888", "&:active": { backgroundImage: "linear-gradient(#b4b4b4, #d0d3d6)" } }, "&dark .cm-button": { backgroundImage: "linear-gradient(#393939, #111)", border: "1px solid #888", "&:active": { backgroundImage: "linear-gradient(#111, #333)" } }, ".cm-textfield": { verticalAlign: "middle", color: "inherit", fontSize: "70%", border: "1px solid silver", padding: ".2em .5em" }, "&light .cm-textfield": { backgroundColor: "white" }, "&dark .cm-textfield": { border: "1px solid #555", backgroundColor: "inherit" } }, Bn3);
var lr3 = { childList: true, characterData: true, subtree: true, attributes: true, characterDataOldValue: true };
var qe5 = y6.ie && y6.ie_version <= 11;
var vi3 = class {
  constructor(t8) {
    this.view = t8, this.active = false, this.editContext = null, this.selectionRange = new Ge4(), this.selectionChanged = false, this.delayedFlush = -1, this.resizeTimeout = -1, this.queue = [], this.delayedAndroidKey = null, this.flushingAndroidKey = -1, this.lastChange = 0, this.scrollTargets = [], this.intersection = null, this.resizeScroll = null, this.intersecting = false, this.gapIntersection = null, this.gaps = [], this.printQuery = null, this.parentCheck = -1, this.dom = t8.contentDOM, this.observer = new MutationObserver((e7) => {
      for (let i12 of e7) this.queue.push(i12);
      (y6.ie && y6.ie_version <= 11 || y6.ios && t8.composing) && e7.some((i12) => i12.type == "childList" && i12.removedNodes.length || i12.type == "characterData" && i12.oldValue.length > i12.target.nodeValue.length) ? this.flushSoon() : this.flush();
    }), window.EditContext && t8.constructor.EDIT_CONTEXT !== false && !(y6.chrome && y6.chrome_version < 126) && (this.editContext = new Si3(t8), t8.state.facet(st5) && (t8.contentDOM.editContext = this.editContext.editContext)), qe5 && (this.onCharData = (e7) => {
      this.queue.push({ target: e7.target, type: "characterData", oldValue: e7.prevValue }), this.flushSoon();
    }), this.onSelectionChange = this.onSelectionChange.bind(this), this.onResize = this.onResize.bind(this), this.onPrint = this.onPrint.bind(this), this.onScroll = this.onScroll.bind(this), window.matchMedia && (this.printQuery = window.matchMedia("print")), typeof ResizeObserver == "function" && (this.resizeScroll = new ResizeObserver(() => {
      var e7;
      ((e7 = this.view.docView) === null || e7 === void 0 ? void 0 : e7.lastUpdate) < Date.now() - 75 && this.onResize();
    }), this.resizeScroll.observe(t8.scrollDOM)), this.addWindowListeners(this.win = t8.win), this.start(), typeof IntersectionObserver == "function" && (this.intersection = new IntersectionObserver((e7) => {
      this.parentCheck < 0 && (this.parentCheck = setTimeout(this.listenForScroll.bind(this), 1e3)), e7.length > 0 && e7[e7.length - 1].intersectionRatio > 0 != this.intersecting && (this.intersecting = !this.intersecting, this.intersecting != this.view.inView && this.onScrollChanged(document.createEvent("Event")));
    }, { threshold: [0, 1e-3] }), this.intersection.observe(this.dom), this.gapIntersection = new IntersectionObserver((e7) => {
      e7.length > 0 && e7[e7.length - 1].intersectionRatio > 0 && this.onScrollChanged(document.createEvent("Event"));
    }, {})), this.listenForScroll(), this.readSelectionRange();
  }
  onScrollChanged(t8) {
    this.view.inputState.runHandlers("scroll", t8), this.intersecting && this.view.measure();
  }
  onScroll(t8) {
    this.intersecting && this.flush(false), this.editContext && this.view.requestMeasure(this.editContext.measureReq), this.onScrollChanged(t8);
  }
  onResize() {
    this.resizeTimeout < 0 && (this.resizeTimeout = setTimeout(() => {
      this.resizeTimeout = -1, this.view.requestMeasure();
    }, 50));
  }
  onPrint(t8) {
    (t8.type == "change" || !t8.type) && !t8.matches || (this.view.viewState.printing = true, this.view.measure(), setTimeout(() => {
      this.view.viewState.printing = false, this.view.requestMeasure();
    }, 500));
  }
  updateGaps(t8) {
    if (this.gapIntersection && (t8.length != this.gaps.length || this.gaps.some((e7, i12) => e7 != t8[i12]))) {
      this.gapIntersection.disconnect();
      for (let e7 of t8) this.gapIntersection.observe(e7);
      this.gaps = t8;
    }
  }
  onSelectionChange(t8) {
    let e7 = this.selectionChanged;
    if (!this.readSelectionRange() || this.delayedAndroidKey) return;
    let { view: i12 } = this, n14 = this.selectionRange;
    if (i12.state.facet(st5) ? i12.root.activeElement != this.dom : !ue5(this.dom, n14)) return;
    let o = n14.anchorNode && i12.docView.nearest(n14.anchorNode);
    if (o && o.ignoreEvent(t8)) {
      e7 || (this.selectionChanged = false);
      return;
    }
    (y6.ie && y6.ie_version <= 11 || y6.android && y6.chrome) && !i12.state.selection.main.empty && n14.focusNode && Vt4(n14.focusNode, n14.focusOffset, n14.anchorNode, n14.anchorOffset) ? this.flushSoon() : this.flush(false);
  }
  readSelectionRange() {
    let { view: t8 } = this, e7 = jt4(t8.root);
    if (!e7) return false;
    let i12 = y6.safari && t8.root.nodeType == 11 && t8.root.activeElement == this.dom && hr3(this.view, e7) || e7;
    if (!i12 || this.selectionRange.eq(i12)) return false;
    let n14 = ue5(this.dom, i12);
    return n14 && !this.selectionChanged && t8.inputState.lastFocusTime > Date.now() - 200 && t8.inputState.lastTouchTime < Date.now() - 300 && no3(this.dom, i12) ? (this.view.inputState.lastFocusTime = 0, t8.docView.updateSelection(), false) : (this.selectionRange.setRange(i12), n14 && (this.selectionChanged = true), true);
  }
  setSelectionRange(t8, e7) {
    this.selectionRange.set(t8.node, t8.offset, e7.node, e7.offset), this.selectionChanged = false;
  }
  clearSelectionRange() {
    this.selectionRange.set(null, 0, null, 0);
  }
  listenForScroll() {
    this.parentCheck = -1;
    let t8 = 0, e7 = null;
    for (let i12 = this.dom; i12; ) if (i12.nodeType == 1) !e7 && t8 < this.scrollTargets.length && this.scrollTargets[t8] == i12 ? t8++ : e7 || (e7 = this.scrollTargets.slice(0, t8)), e7 && e7.push(i12), i12 = i12.assignedSlot || i12.parentNode;
    else if (i12.nodeType == 11) i12 = i12.host;
    else break;
    if (t8 < this.scrollTargets.length && !e7 && (e7 = this.scrollTargets.slice(0, t8)), e7) {
      for (let i12 of this.scrollTargets) i12.removeEventListener("scroll", this.onScroll);
      for (let i12 of this.scrollTargets = e7) i12.addEventListener("scroll", this.onScroll);
    }
  }
  ignore(t8) {
    if (!this.active) return t8();
    try {
      return this.stop(), t8();
    } finally {
      this.start(), this.clear();
    }
  }
  start() {
    this.active || (this.observer.observe(this.dom, lr3), qe5 && this.dom.addEventListener("DOMCharacterDataModified", this.onCharData), this.active = true);
  }
  stop() {
    this.active && (this.active = false, this.observer.disconnect(), qe5 && this.dom.removeEventListener("DOMCharacterDataModified", this.onCharData));
  }
  clear() {
    this.processRecords(), this.queue.length = 0, this.selectionChanged = false;
  }
  delayAndroidKey(t8, e7) {
    var i12;
    if (!this.delayedAndroidKey) {
      let n14 = () => {
        let o = this.delayedAndroidKey;
        o && (this.clearDelayedAndroidKey(), this.view.inputState.lastKeyCode = o.keyCode, this.view.inputState.lastKeyTime = Date.now(), !this.flush() && o.force && Mt3(this.dom, o.key, o.keyCode));
      };
      this.flushingAndroidKey = this.view.win.requestAnimationFrame(n14);
    }
    (!this.delayedAndroidKey || t8 == "Enter") && (this.delayedAndroidKey = { key: t8, keyCode: e7, force: this.lastChange < Date.now() - 50 || !!(!((i12 = this.delayedAndroidKey) === null || i12 === void 0) && i12.force) });
  }
  clearDelayedAndroidKey() {
    this.win.cancelAnimationFrame(this.flushingAndroidKey), this.delayedAndroidKey = null, this.flushingAndroidKey = -1;
  }
  flushSoon() {
    this.delayedFlush < 0 && (this.delayedFlush = this.view.win.requestAnimationFrame(() => {
      this.delayedFlush = -1, this.flush();
    }));
  }
  forceFlush() {
    this.delayedFlush >= 0 && (this.view.win.cancelAnimationFrame(this.delayedFlush), this.delayedFlush = -1), this.flush();
  }
  pendingRecords() {
    for (let t8 of this.observer.takeRecords()) this.queue.push(t8);
    return this.queue;
  }
  processRecords() {
    let t8 = this.pendingRecords();
    t8.length && (this.queue = []);
    let e7 = -1, i12 = -1, n14 = false;
    for (let o of t8) {
      let r2 = this.readMutation(o);
      r2 && (r2.typeOver && (n14 = true), e7 == -1 ? { from: e7, to: i12 } = r2 : (e7 = Math.min(r2.from, e7), i12 = Math.max(r2.to, i12)));
    }
    return { from: e7, to: i12, typeOver: n14 };
  }
  readChange() {
    let { from: t8, to: e7, typeOver: i12 } = this.processRecords(), n14 = this.selectionChanged && ue5(this.dom, this.selectionRange);
    if (t8 < 0 && !n14) return null;
    t8 > -1 && (this.lastChange = Date.now()), this.view.inputState.lastFocusTime = 0, this.selectionChanged = false;
    let o = new hi3(this.view, t8, e7, i12);
    return this.view.docView.domChanged = { newSel: o.newSel ? o.newSel.main : null }, o;
  }
  flush(t8 = true) {
    if (this.delayedFlush >= 0 || this.delayedAndroidKey) return false;
    t8 && this.readSelectionRange();
    let e7 = this.readChange();
    if (!e7) return this.view.requestMeasure(), false;
    let i12 = this.view.state, n14 = Sn4(this.view, e7);
    return this.view.state == i12 && (e7.domChanged || e7.newSel && !e7.newSel.main.eq(this.view.state.selection.main)) && this.view.update([]), n14;
  }
  readMutation(t8) {
    let e7 = this.view.docView.nearest(t8.target);
    if (!e7 || e7.ignoreMutation(t8)) return null;
    if (e7.markDirty(t8.type == "attributes"), t8.type == "attributes" && (e7.flags |= 4), t8.type == "childList") {
      let i12 = ms3(e7, t8.previousSibling || t8.target.previousSibling, -1), n14 = ms3(e7, t8.nextSibling || t8.target.nextSibling, 1);
      return { from: i12 ? e7.posAfter(i12) : e7.posAtStart, to: n14 ? e7.posBefore(n14) : e7.posAtEnd, typeOver: false };
    } else return t8.type == "characterData" ? { from: e7.posAtStart, to: e7.posAtEnd, typeOver: t8.target.nodeValue == t8.oldValue } : null;
  }
  setWindow(t8) {
    t8 != this.win && (this.removeWindowListeners(this.win), this.win = t8, this.addWindowListeners(this.win));
  }
  addWindowListeners(t8) {
    t8.addEventListener("resize", this.onResize), this.printQuery ? this.printQuery.addEventListener ? this.printQuery.addEventListener("change", this.onPrint) : this.printQuery.addListener(this.onPrint) : t8.addEventListener("beforeprint", this.onPrint), t8.addEventListener("scroll", this.onScroll), t8.document.addEventListener("selectionchange", this.onSelectionChange);
  }
  removeWindowListeners(t8) {
    t8.removeEventListener("scroll", this.onScroll), t8.removeEventListener("resize", this.onResize), this.printQuery ? this.printQuery.removeEventListener ? this.printQuery.removeEventListener("change", this.onPrint) : this.printQuery.removeListener(this.onPrint) : t8.removeEventListener("beforeprint", this.onPrint), t8.document.removeEventListener("selectionchange", this.onSelectionChange);
  }
  update(t8) {
    this.editContext && (this.editContext.update(t8), t8.startState.facet(st5) != t8.state.facet(st5) && (t8.view.contentDOM.editContext = t8.state.facet(st5) ? this.editContext.editContext : null));
  }
  destroy() {
    var t8, e7, i12;
    this.stop(), (t8 = this.intersection) === null || t8 === void 0 || t8.disconnect(), (e7 = this.gapIntersection) === null || e7 === void 0 || e7.disconnect(), (i12 = this.resizeScroll) === null || i12 === void 0 || i12.disconnect();
    for (let n14 of this.scrollTargets) n14.removeEventListener("scroll", this.onScroll);
    this.removeWindowListeners(this.win), clearTimeout(this.parentCheck), clearTimeout(this.resizeTimeout), this.win.cancelAnimationFrame(this.delayedFlush), this.win.cancelAnimationFrame(this.flushingAndroidKey), this.editContext && (this.view.contentDOM.editContext = null, this.editContext.destroy());
  }
};
function ms3(s212, t8, e7) {
  for (; t8; ) {
    let i12 = R5.get(t8);
    if (i12 && i12.parent == s212) return i12;
    let n14 = t8.parentNode;
    t8 = n14 != s212.dom ? n14 : e7 > 0 ? t8.nextSibling : t8.previousSibling;
  }
  return null;
}
function bs3(s212, t8) {
  let e7 = t8.startContainer, i12 = t8.startOffset, n14 = t8.endContainer, o = t8.endOffset, r2 = s212.docView.domAtPos(s212.state.selection.main.anchor);
  return Vt4(r2.node, r2.offset, n14, o) && ([e7, i12, n14, o] = [n14, o, e7, i12]), { anchorNode: e7, anchorOffset: i12, focusNode: n14, focusOffset: o };
}
function hr3(s212, t8) {
  if (t8.getComposedRanges) {
    let n14 = t8.getComposedRanges(s212.root)[0];
    if (n14) return bs3(s212, n14);
  }
  let e7 = null;
  function i12(n14) {
    n14.preventDefault(), n14.stopImmediatePropagation(), e7 = n14.getTargetRanges()[0];
  }
  return s212.contentDOM.addEventListener("beforeinput", i12, true), s212.dom.ownerDocument.execCommand("indent"), s212.contentDOM.removeEventListener("beforeinput", i12, true), e7 ? bs3(s212, e7) : null;
}
var Si3 = class {
  constructor(t8) {
    this.from = 0, this.to = 0, this.pendingContextChange = null, this.handlers = /* @__PURE__ */ Object.create(null), this.resetRange(t8.state);
    let e7 = this.editContext = new window.EditContext({ text: t8.state.doc.sliceString(this.from, this.to), selectionStart: this.toContextPos(Math.max(this.from, Math.min(this.to, t8.state.selection.main.anchor))), selectionEnd: this.toContextPos(t8.state.selection.main.head) });
    this.handlers.textupdate = (i12) => {
      let { anchor: n14 } = t8.state.selection.main, o = { from: this.toEditorPos(i12.updateRangeStart), to: this.toEditorPos(i12.updateRangeEnd), insert: m.of(i12.text.split(`
`)) };
      o.from == this.from && n14 < this.from ? o.from = n14 : o.to == this.to && n14 > this.to && (o.to = n14), !(o.from == o.to && !o.insert.length) && (this.pendingContextChange = o, t8.state.readOnly || qi3(t8, o, x.single(this.toEditorPos(i12.selectionStart), this.toEditorPos(i12.selectionEnd))), this.pendingContextChange && (this.revertPending(t8.state), this.setSelection(t8.state)));
    }, this.handlers.characterboundsupdate = (i12) => {
      let n14 = [], o = null;
      for (let r2 = this.toEditorPos(i12.rangeStart), l11 = this.toEditorPos(i12.rangeEnd); r2 < l11; r2++) {
        let h3 = t8.coordsForChar(r2);
        o = h3 && new DOMRect(h3.left, h3.top, h3.right - h3.left, h3.bottom - h3.top) || o || new DOMRect(), n14.push(o);
      }
      e7.updateCharacterBounds(i12.rangeStart, n14);
    }, this.handlers.textformatupdate = (i12) => {
      let n14 = [];
      for (let o of i12.getTextFormats()) {
        let r2 = o.underlineStyle, l11 = o.underlineThickness;
        if (r2 != "None" && l11 != "None") {
          let h3 = `text-decoration: underline ${r2 == "Dashed" ? "dashed " : r2 == "Squiggle" ? "wavy " : ""}${l11 == "Thin" ? 1 : 2}px`;
          n14.push(O5.mark({ attributes: { style: h3 } }).range(this.toEditorPos(o.rangeStart), this.toEditorPos(o.rangeEnd)));
        }
      }
      t8.dispatch({ effects: pn3.of(O5.set(n14)) });
    }, this.handlers.compositionstart = () => {
      t8.inputState.composing < 0 && (t8.inputState.composing = 0, t8.inputState.compositionFirstChange = true);
    }, this.handlers.compositionend = () => {
      t8.inputState.composing = -1, t8.inputState.compositionFirstChange = null;
    };
    for (let i12 in this.handlers) e7.addEventListener(i12, this.handlers[i12]);
    this.measureReq = { read: (i12) => {
      this.editContext.updateControlBounds(i12.contentDOM.getBoundingClientRect());
      let n14 = jt4(i12.root);
      n14 && n14.rangeCount && this.editContext.updateSelectionBounds(n14.getRangeAt(0).getBoundingClientRect());
    } };
  }
  applyEdits(t8) {
    let e7 = 0, i12 = false, n14 = this.pendingContextChange;
    return t8.changes.iterChanges((o, r2, l11, h3, c3) => {
      if (i12) return;
      let a2 = c3.length - (r2 - o);
      if (n14 && r2 >= n14.to) if (n14.from == o && n14.to == r2 && n14.insert.eq(c3)) {
        n14 = this.pendingContextChange = null, e7 += a2, this.to += a2;
        return;
      } else n14 = null, this.revertPending(t8.state);
      if (o += e7, r2 += e7, r2 <= this.from) this.from += a2, this.to += a2;
      else if (o < this.to) {
        if (o < this.from || r2 > this.to || this.to - this.from + c3.length > 3e4) {
          i12 = true;
          return;
        }
        this.editContext.updateText(this.toContextPos(o), this.toContextPos(r2), c3.toString()), this.to += a2;
      }
      e7 += a2;
    }), n14 && !i12 && this.revertPending(t8.state), !i12;
  }
  update(t8) {
    let e7 = this.pendingContextChange;
    !this.applyEdits(t8) || !this.rangeIsValid(t8.state) ? (this.pendingContextChange = null, this.resetRange(t8.state), this.editContext.updateText(0, this.editContext.text.length, t8.state.doc.sliceString(this.from, this.to)), this.setSelection(t8.state)) : (t8.docChanged || t8.selectionSet || e7) && this.setSelection(t8.state), (t8.geometryChanged || t8.docChanged || t8.selectionSet) && t8.view.requestMeasure(this.measureReq);
  }
  resetRange(t8) {
    let { head: e7 } = t8.selection.main;
    this.from = Math.max(0, e7 - 1e4), this.to = Math.min(t8.doc.length, e7 + 1e4);
  }
  revertPending(t8) {
    let e7 = this.pendingContextChange;
    this.pendingContextChange = null, this.editContext.updateText(this.toContextPos(e7.from), this.toContextPos(e7.from + e7.insert.length), t8.doc.sliceString(e7.from, e7.to));
  }
  setSelection(t8) {
    let { main: e7 } = t8.selection, i12 = this.toContextPos(Math.max(this.from, Math.min(this.to, e7.anchor))), n14 = this.toContextPos(e7.head);
    (this.editContext.selectionStart != i12 || this.editContext.selectionEnd != n14) && this.editContext.updateSelection(i12, n14);
  }
  rangeIsValid(t8) {
    let { head: e7 } = t8.selection.main;
    return !(this.from > 0 && e7 - this.from < 500 || this.to < t8.doc.length && this.to - e7 < 500 || this.to - this.from > 1e4 * 3);
  }
  toEditorPos(t8) {
    return t8 + this.from;
  }
  toContextPos(t8) {
    return t8 - this.from;
  }
  destroy() {
    for (let t8 in this.handlers) this.editContext.removeEventListener(t8, this.handlers[t8]);
  }
};
var A5 = class s104 {
  get state() {
    return this.viewState.state;
  }
  get viewport() {
    return this.viewState.viewport;
  }
  get visibleRanges() {
    return this.viewState.visibleRanges;
  }
  get inView() {
    return this.viewState.inView;
  }
  get composing() {
    return this.inputState.composing > 0;
  }
  get compositionStarted() {
    return this.inputState.composing >= 0;
  }
  get root() {
    return this._root;
  }
  get win() {
    return this.dom.ownerDocument.defaultView || window;
  }
  constructor(t8 = {}) {
    var e7;
    this.plugins = [], this.pluginMap = /* @__PURE__ */ new Map(), this.editorAttrs = {}, this.contentAttrs = {}, this.bidiCache = [], this.destroyed = false, this.updateState = 2, this.measureScheduled = -1, this.measureRequests = [], this.contentDOM = document.createElement("div"), this.scrollDOM = document.createElement("div"), this.scrollDOM.tabIndex = -1, this.scrollDOM.className = "cm-scroller", this.scrollDOM.appendChild(this.contentDOM), this.announceDOM = document.createElement("div"), this.announceDOM.className = "cm-announced", this.announceDOM.setAttribute("aria-live", "polite"), this.dom = document.createElement("div"), this.dom.appendChild(this.announceDOM), this.dom.appendChild(this.scrollDOM), t8.parent && t8.parent.appendChild(this.dom);
    let { dispatch: i12 } = t8;
    this.dispatchTransactions = t8.dispatchTransactions || i12 && ((n14) => n14.forEach((o) => i12(o, this))) || ((n14) => this.update(n14)), this.dispatch = this.dispatch.bind(this), this._root = t8.root || so3(t8.parent) || document, this.viewState = new Re5(t8.state || I.create(t8)), t8.scrollTo && t8.scrollTo.is(oe4) && (this.viewState.scrollTarget = t8.scrollTo.value.clip(this.viewState.state)), this.plugins = this.state.facet(Et4).map((n14) => new zt4(n14));
    for (let n14 of this.plugins) n14.update(this);
    this.observer = new vi3(this), this.inputState = new ai3(this), this.inputState.ensureHandlers(this.plugins), this.docView = new Me4(this), this.mountStyles(), this.updateAttrs(), this.updateState = 0, this.requestMeasure(), !((e7 = document.fonts) === null || e7 === void 0) && e7.ready && document.fonts.ready.then(() => this.requestMeasure());
  }
  dispatch(...t8) {
    let e7 = t8.length == 1 && t8[0] instanceof S ? t8 : t8.length == 1 && Array.isArray(t8[0]) ? t8[0] : [this.state.update(...t8)];
    this.dispatchTransactions(e7, this);
  }
  update(t8) {
    if (this.updateState != 0) throw new Error("Calls to EditorView.update are not allowed while an update is in progress");
    let e7 = false, i12 = false, n14, o = this.state;
    for (let d4 of t8) {
      if (d4.startState != o) throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");
      o = d4.state;
    }
    if (this.destroyed) {
      this.viewState.state = o;
      return;
    }
    let r2 = this.hasFocus, l11 = 0, h3 = null;
    t8.some((d4) => d4.annotation(On3)) ? (this.inputState.notifiedFocused = r2, l11 = 1) : r2 != this.inputState.notifiedFocused && (this.inputState.notifiedFocused = r2, h3 = Tn3(o, r2), h3 || (l11 = 1));
    let c3 = this.observer.delayedAndroidKey, a2 = null;
    if (c3 ? (this.observer.clearDelayedAndroidKey(), a2 = this.observer.readChange(), (a2 && !this.state.doc.eq(o.doc) || !this.state.selection.eq(o.selection)) && (a2 = null)) : this.observer.clear(), o.facet(I.phrases) != this.state.facet(I.phrases)) return this.setState(o);
    n14 = Ce4.create(this, o, t8), n14.flags |= l11;
    let f6 = this.viewState.scrollTarget;
    try {
      this.updateState = 2;
      for (let d4 of t8) {
        if (f6 && (f6 = f6.map(d4.changes)), d4.scrollIntoView) {
          let { main: u3 } = d4.state.selection;
          f6 = new Wt4(u3.empty ? u3 : x.cursor(u3.head, u3.head > u3.anchor ? -1 : 1));
        }
        for (let u3 of d4.effects) u3.is(oe4) && (f6 = u3.value.clip(this.state));
      }
      this.viewState.update(n14, f6), this.bidiCache = Ee6.update(this.bidiCache, n14.changes), n14.empty || (this.updatePlugins(n14), this.inputState.update(n14)), e7 = this.docView.update(n14), this.state.facet(Lt3) != this.styleModules && this.mountStyles(), i12 = this.updateAttrs(), this.showAnnouncements(t8), this.docView.updateSelection(e7, t8.some((d4) => d4.isUserEvent("select.pointer")));
    } finally {
      this.updateState = 0;
    }
    if (n14.startState.facet(ce6) != n14.state.facet(ce6) && (this.viewState.mustMeasureContent = true), (e7 || i12 || f6 || this.viewState.mustEnforceCursorAssoc || this.viewState.mustMeasureContent) && this.requestMeasure(), e7 && this.docViewUpdate(), !n14.empty) for (let d4 of this.state.facet(ni3)) try {
      d4(n14);
    } catch (u3) {
      $4(this.state, u3, "update listener");
    }
    (h3 || a2) && Promise.resolve().then(() => {
      h3 && this.state == h3.startState && this.dispatch(h3), a2 && !Sn4(this, a2) && c3.force && Mt3(this.contentDOM, c3.key, c3.keyCode);
    });
  }
  setState(t8) {
    if (this.updateState != 0) throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");
    if (this.destroyed) {
      this.viewState.state = t8;
      return;
    }
    this.updateState = 2;
    let e7 = this.hasFocus;
    try {
      for (let i12 of this.plugins) i12.destroy(this);
      this.viewState = new Re5(t8), this.plugins = t8.facet(Et4).map((i12) => new zt4(i12)), this.pluginMap.clear();
      for (let i12 of this.plugins) i12.update(this);
      this.docView.destroy(), this.docView = new Me4(this), this.inputState.ensureHandlers(this.plugins), this.mountStyles(), this.updateAttrs(), this.bidiCache = [];
    } finally {
      this.updateState = 0;
    }
    e7 && this.focus(), this.requestMeasure();
  }
  updatePlugins(t8) {
    let e7 = t8.startState.facet(Et4), i12 = t8.state.facet(Et4);
    if (e7 != i12) {
      let n14 = [];
      for (let o of i12) {
        let r2 = e7.indexOf(o);
        if (r2 < 0) n14.push(new zt4(o));
        else {
          let l11 = this.plugins[r2];
          l11.mustUpdate = t8, n14.push(l11);
        }
      }
      for (let o of this.plugins) o.mustUpdate != t8 && o.destroy(this);
      this.plugins = n14, this.pluginMap.clear();
    } else for (let n14 of this.plugins) n14.mustUpdate = t8;
    for (let n14 = 0; n14 < this.plugins.length; n14++) this.plugins[n14].update(this);
    e7 != i12 && this.inputState.ensureHandlers(this.plugins);
  }
  docViewUpdate() {
    for (let t8 of this.plugins) {
      let e7 = t8.value;
      if (e7 && e7.docViewUpdate) try {
        e7.docViewUpdate(this);
      } catch (i12) {
        $4(this.state, i12, "doc view update listener");
      }
    }
  }
  measure(t8 = true) {
    if (this.destroyed) return;
    if (this.measureScheduled > -1 && this.win.cancelAnimationFrame(this.measureScheduled), this.observer.delayedAndroidKey) {
      this.measureScheduled = -1, this.requestMeasure();
      return;
    }
    this.measureScheduled = 0, t8 && this.observer.forceFlush();
    let e7 = null, i12 = this.scrollDOM, n14 = i12.scrollTop * this.scaleY, { scrollAnchorPos: o, scrollAnchorHeight: r2 } = this.viewState;
    Math.abs(n14 - this.viewState.scrollTop) > 1 && (r2 = -1), this.viewState.scrollAnchorHeight = -1;
    try {
      for (let l11 = 0; ; l11++) {
        if (r2 < 0) if (zs3(i12)) o = -1, r2 = this.viewState.heightMap.height;
        else {
          let u3 = this.viewState.scrollAnchorAt(n14);
          o = u3.from, r2 = u3.top;
        }
        this.updateState = 1;
        let h3 = this.viewState.measure(this);
        if (!h3 && !this.measureRequests.length && this.viewState.scrollTarget == null) break;
        if (l11 > 5) {
          console.warn(this.measureRequests.length ? "Measure loop restarted more than 5 times" : "Viewport failed to stabilize");
          break;
        }
        let c3 = [];
        h3 & 4 || ([this.measureRequests, c3] = [c3, this.measureRequests]);
        let a2 = c3.map((u3) => {
          try {
            return u3.read(this);
          } catch (p3) {
            return $4(this.state, p3), ys3;
          }
        }), f6 = Ce4.create(this, this.state, []), d4 = false;
        f6.flags |= h3, e7 ? e7.flags |= h3 : e7 = f6, this.updateState = 2, f6.empty || (this.updatePlugins(f6), this.inputState.update(f6), this.updateAttrs(), d4 = this.docView.update(f6), d4 && this.docViewUpdate());
        for (let u3 = 0; u3 < c3.length; u3++) if (a2[u3] != ys3) try {
          let p3 = c3[u3];
          p3.write && p3.write(a2[u3], this);
        } catch (p3) {
          $4(this.state, p3);
        }
        if (d4 && this.docView.updateSelection(true), !f6.viewportChanged && this.measureRequests.length == 0) {
          if (this.viewState.editorHeight) if (this.viewState.scrollTarget) {
            this.docView.scrollIntoView(this.viewState.scrollTarget), this.viewState.scrollTarget = null, r2 = -1;
            continue;
          } else {
            let p3 = (o < 0 ? this.viewState.heightMap.height : this.viewState.lineBlockAt(o).top) - r2;
            if (p3 > 1 || p3 < -1) {
              n14 = n14 + p3, i12.scrollTop = n14 / this.scaleY, r2 = -1;
              continue;
            }
          }
          break;
        }
      }
    } finally {
      this.updateState = 0, this.measureScheduled = -1;
    }
    if (e7 && !e7.empty) for (let l11 of this.state.facet(ni3)) l11(e7);
  }
  get themeClasses() {
    return wi3 + " " + (this.state.facet(yi3) ? Ln3 : En3) + " " + this.state.facet(ce6);
  }
  updateAttrs() {
    let t8 = ws3(this, gn3, { class: "cm-editor" + (this.hasFocus ? " cm-focused " : " ") + this.themeClasses }), e7 = { spellcheck: "false", autocorrect: "off", autocapitalize: "off", translate: "no", contenteditable: this.state.facet(st5) ? "true" : "false", class: "cm-content", style: `${y6.tabSize}: ${this.state.tabSize}`, role: "textbox", "aria-multiline": "true" };
    this.state.readOnly && (e7["aria-readonly"] = "true"), ws3(this, Ve5, e7);
    let i12 = this.observer.ignore(() => {
      let n14 = Ze5(this.contentDOM, this.contentAttrs, e7), o = Ze5(this.dom, this.editorAttrs, t8);
      return n14 || o;
    });
    return this.editorAttrs = t8, this.contentAttrs = e7, i12;
  }
  showAnnouncements(t8) {
    let e7 = true;
    for (let i12 of t8) for (let n14 of i12.effects) if (n14.is(s104.announce)) {
      e7 && (this.announceDOM.textContent = ""), e7 = false;
      let o = this.announceDOM.appendChild(document.createElement("div"));
      o.textContent = n14.value;
    }
  }
  mountStyles() {
    this.styleModules = this.state.facet(Lt3);
    let t8 = this.state.facet(s104.cspNonce);
    b2.mount(this.root, this.styleModules.concat(rr3).reverse(), t8 ? { nonce: t8 } : void 0);
  }
  readMeasured() {
    if (this.updateState == 2) throw new Error("Reading the editor layout isn't allowed during an update");
    this.updateState == 0 && this.measureScheduled > -1 && this.measure(false);
  }
  requestMeasure(t8) {
    if (this.measureScheduled < 0 && (this.measureScheduled = this.win.requestAnimationFrame(() => this.measure())), t8) {
      if (this.measureRequests.indexOf(t8) > -1) return;
      if (t8.key != null) {
        for (let e7 = 0; e7 < this.measureRequests.length; e7++) if (this.measureRequests[e7].key === t8.key) {
          this.measureRequests[e7] = t8;
          return;
        }
      }
      this.measureRequests.push(t8);
    }
  }
  plugin(t8) {
    let e7 = this.pluginMap.get(t8);
    return (e7 === void 0 || e7 && e7.spec != t8) && this.pluginMap.set(t8, e7 = this.plugins.find((i12) => i12.spec == t8) || null), e7 && e7.update(this).value;
  }
  get documentTop() {
    return this.contentDOM.getBoundingClientRect().top + this.viewState.paddingTop;
  }
  get documentPadding() {
    return { top: this.viewState.paddingTop, bottom: this.viewState.paddingBottom };
  }
  get scaleX() {
    return this.viewState.scaleX;
  }
  get scaleY() {
    return this.viewState.scaleY;
  }
  elementAtHeight(t8) {
    return this.readMeasured(), this.viewState.elementAtHeight(t8);
  }
  lineBlockAtHeight(t8) {
    return this.readMeasured(), this.viewState.lineBlockAtHeight(t8);
  }
  get viewportLineBlocks() {
    return this.viewState.viewportLines;
  }
  lineBlockAt(t8) {
    return this.viewState.lineBlockAt(t8);
  }
  get contentHeight() {
    return this.viewState.contentHeight;
  }
  moveByChar(t8, e7, i12) {
    return Ke5(this, t8, ss3(this, t8, e7, i12));
  }
  moveByGroup(t8, e7) {
    return Ke5(this, t8, ss3(this, t8, e7, (i12) => Lo3(this, t8.head, i12)));
  }
  visualLineSide(t8, e7) {
    let i12 = this.bidiSpans(t8), n14 = this.textDirectionAt(t8.from), o = i12[e7 ? i12.length - 1 : 0];
    return x.cursor(o.side(e7, n14) + t8.from, o.forward(!e7, n14) ? 1 : -1);
  }
  moveToLineBoundary(t8, e7, i12 = true) {
    return Eo3(this, t8, e7, i12);
  }
  moveVertically(t8, e7, i12) {
    return Ke5(this, t8, Bo3(this, t8, e7, i12));
  }
  domAtPos(t8) {
    return this.docView.domAtPos(t8);
  }
  posAtDOM(t8, e7 = 0) {
    return this.docView.posFromDOM(t8, e7);
  }
  posAtCoords(t8, e7 = true) {
    return this.readMeasured(), vn3(this, t8, e7);
  }
  coordsAtPos(t8, e7 = 1) {
    this.readMeasured();
    let i12 = this.docView.coordsAt(t8, e7);
    if (!i12 || i12.left == i12.right) return i12;
    let n14 = this.state.doc.lineAt(t8), o = this.bidiSpans(n14), r2 = o[G7.find(o, t8 - n14.from, -1, e7)];
    return te6(i12, r2.dir == L5.LTR == e7 > 0);
  }
  coordsForChar(t8) {
    return this.readMeasured(), this.docView.coordsForChar(t8);
  }
  get defaultCharacterWidth() {
    return this.viewState.heightOracle.charWidth;
  }
  get defaultLineHeight() {
    return this.viewState.heightOracle.lineHeight;
  }
  get textDirection() {
    return this.viewState.defaultTextDirection;
  }
  textDirectionAt(t8) {
    return !this.state.facet(fn3) || t8 < this.viewport.from || t8 > this.viewport.to ? this.textDirection : (this.readMeasured(), this.docView.textDirectionAt(t8));
  }
  get lineWrapping() {
    return this.viewState.heightOracle.lineWrapping;
  }
  bidiSpans(t8) {
    if (t8.length > ar3) return en3(t8.length);
    let e7 = this.textDirectionAt(t8.from), i12;
    for (let o of this.bidiCache) if (o.from == t8.from && o.dir == e7 && (o.fresh || Zs3(o.isolates, i12 = Ji3(this, t8)))) return o.order;
    i12 || (i12 = Ji3(this, t8));
    let n14 = tn4(t8.text, e7, i12);
    return this.bidiCache.push(new Ee6(t8.from, t8.to, e7, i12, true, n14)), n14;
  }
  get hasFocus() {
    var t8;
    return (this.dom.ownerDocument.hasFocus() || y6.safari && ((t8 = this.inputState) === null || t8 === void 0 ? void 0 : t8.lastContextMenu) > Date.now() - 3e4) && this.root.activeElement == this.contentDOM;
  }
  focus() {
    this.observer.ignore(() => {
      Fs3(this.contentDOM), this.docView.updateSelection();
    });
  }
  setRoot(t8) {
    this._root != t8 && (this._root = t8, this.observer.setWindow((t8.nodeType == 9 ? t8 : t8.ownerDocument).defaultView || window), this.mountStyles());
  }
  destroy() {
    this.root.activeElement == this.contentDOM && this.contentDOM.blur();
    for (let t8 of this.plugins) t8.destroy(this);
    this.plugins = [], this.inputState.destroy(), this.docView.destroy(), this.dom.remove(), this.observer.destroy(), this.measureScheduled > -1 && this.win.cancelAnimationFrame(this.measureScheduled), this.destroyed = true;
  }
  static scrollIntoView(t8, e7 = {}) {
    return oe4.of(new Wt4(typeof t8 == "number" ? x.cursor(t8) : t8, e7.y, e7.x, e7.yMargin, e7.xMargin));
  }
  scrollSnapshot() {
    let { scrollTop: t8, scrollLeft: e7 } = this.scrollDOM, i12 = this.viewState.scrollAnchorAt(t8);
    return oe4.of(new Wt4(x.cursor(i12.from), "start", "start", i12.top - t8, e7, true));
  }
  setTabFocusMode(t8) {
    t8 == null ? this.inputState.tabFocusMode = this.inputState.tabFocusMode < 0 ? 0 : -1 : typeof t8 == "boolean" ? this.inputState.tabFocusMode = t8 ? 0 : -1 : this.inputState.tabFocusMode != 0 && (this.inputState.tabFocusMode = Date.now() + t8);
  }
  static domEventHandlers(t8) {
    return N6.define(() => ({}), { eventHandlers: t8 });
  }
  static domEventObservers(t8) {
    return N6.define(() => ({}), { eventObservers: t8 });
  }
  static theme(t8, e7) {
    let i12 = b2.newName(), n14 = [ce6.of(i12), Lt3.of(xi3(`.${i12}`, t8))];
    return e7 && e7.dark && n14.push(yi3.of(true)), n14;
  }
  static baseTheme(t8) {
    return ht.lowest(Lt3.of(xi3("." + wi3, t8, Bn3)));
  }
  static findFromDOM(t8) {
    var e7;
    let i12 = t8.querySelector(".cm-content"), n14 = i12 && R5.get(i12) || R5.get(t8);
    return ((e7 = n14?.rootView) === null || e7 === void 0 ? void 0 : e7.view) || null;
  }
};
A5.styleModule = Lt3;
A5.inputHandler = an3;
A5.clipboardInputFilter = zi3;
A5.clipboardOutputFilter = Ii3;
A5.scrollHandler = un3;
A5.focusChangeEffect = cn3;
A5.perLineTextDirection = fn3;
A5.exceptionSink = hn3;
A5.updateListener = ni3;
A5.editable = st5;
A5.mouseSelectionStyle = ln3;
A5.dragMovesSelection = rn3;
A5.clickAddsSelectionRange = on3;
A5.decorations = Ut4;
A5.outerDecorations = mn3;
A5.atomicRanges = Ki3;
A5.bidiIsolatedRanges = bn3;
A5.scrollMargins = yn3;
A5.darkTheme = yi3;
A5.cspNonce = y.define({ combine: (s212) => s212.length ? s212[0] : "" });
A5.contentAttributes = Ve5;
A5.editorAttributes = gn3;
A5.lineWrapping = A5.contentAttributes.of({ class: "cm-lineWrapping" });
A5.announce = v.define();
var ar3 = 4096;
var ys3 = {};
var Ee6 = class s105 {
  constructor(t8, e7, i12, n14, o, r2) {
    this.from = t8, this.to = e7, this.dir = i12, this.isolates = n14, this.fresh = o, this.order = r2;
  }
  static update(t8, e7) {
    if (e7.empty && !t8.some((o) => o.fresh)) return t8;
    let i12 = [], n14 = t8.length ? t8[t8.length - 1].dir : L5.LTR;
    for (let o = Math.max(0, t8.length - 10); o < t8.length; o++) {
      let r2 = t8[o];
      r2.dir == n14 && !e7.touchesRange(r2.from, r2.to) && i12.push(new s105(e7.mapPos(r2.from, 1), e7.mapPos(r2.to, -1), r2.dir, r2.isolates, false, r2.order));
    }
    return i12;
  }
};
function ws3(s212, t8, e7) {
  for (let i12 = s212.state.facet(t8), n14 = i12.length - 1; n14 >= 0; n14--) {
    let o = i12[n14], r2 = typeof o == "function" ? o(s212) : o;
    r2 && Je4(r2, e7);
  }
  return e7;
}
var cr3 = y6.mac ? "mac" : y6.windows ? "win" : y6.linux ? "linux" : "key";
function fr3(s212, t8) {
  let e7 = s212.split(/-(?!$)/), i12 = e7[e7.length - 1];
  i12 == "Space" && (i12 = " ");
  let n14, o, r2, l11;
  for (let h3 = 0; h3 < e7.length - 1; ++h3) {
    let c3 = e7[h3];
    if (/^(cmd|meta|m)$/i.test(c3)) l11 = true;
    else if (/^a(lt)?$/i.test(c3)) n14 = true;
    else if (/^(c|ctrl|control)$/i.test(c3)) o = true;
    else if (/^s(hift)?$/i.test(c3)) r2 = true;
    else if (/^mod$/i.test(c3)) t8 == "mac" ? l11 = true : o = true;
    else throw new Error("Unrecognized modifier name: " + c3);
  }
  return n14 && (i12 = "Alt-" + i12), o && (i12 = "Ctrl-" + i12), l11 && (i12 = "Meta-" + i12), r2 && (i12 = "Shift-" + i12), i12;
}
function fe5(s212, t8, e7) {
  return t8.altKey && (s212 = "Alt-" + s212), t8.ctrlKey && (s212 = "Ctrl-" + s212), t8.metaKey && (s212 = "Meta-" + s212), e7 !== false && t8.shiftKey && (s212 = "Shift-" + s212), s212;
}
var dr3 = ht.default(A5.domEventHandlers({ keydown(s212, t8) {
  return Hn3(Pn3(t8.state), s212, t8, "editor");
} }));
var ur3 = y.define({ enables: dr3 });
var xs3 = /* @__PURE__ */ new WeakMap();
function Pn3(s212) {
  let t8 = s212.facet(ur3), e7 = xs3.get(t8);
  return e7 || xs3.set(t8, e7 = gr3(t8.reduce((i12, n14) => i12.concat(n14), []))), e7;
}
var nt5 = null;
var pr3 = 4e3;
function gr3(s212, t8 = cr3) {
  let e7 = /* @__PURE__ */ Object.create(null), i12 = /* @__PURE__ */ Object.create(null), n14 = (r2, l11) => {
    let h3 = i12[r2];
    if (h3 == null) i12[r2] = l11;
    else if (h3 != l11) throw new Error("Key binding " + r2 + " is used both as a regular binding and as a multi-stroke prefix");
  }, o = (r2, l11, h3, c3, a2) => {
    var f6, d4;
    let u3 = e7[r2] || (e7[r2] = /* @__PURE__ */ Object.create(null)), p3 = l11.split(/ (?!$)/).map((m11) => fr3(m11, t8));
    for (let m11 = 1; m11 < p3.length; m11++) {
      let w14 = p3.slice(0, m11).join(" ");
      n14(w14, true), u3[w14] || (u3[w14] = { preventDefault: true, stopPropagation: false, run: [(v10) => {
        let x11 = nt5 = { view: v10, prefix: w14, scope: r2 };
        return setTimeout(() => {
          nt5 == x11 && (nt5 = null);
        }, pr3), true;
      }] });
    }
    let g8 = p3.join(" ");
    n14(g8, false);
    let b12 = u3[g8] || (u3[g8] = { preventDefault: false, stopPropagation: false, run: ((d4 = (f6 = u3._any) === null || f6 === void 0 ? void 0 : f6.run) === null || d4 === void 0 ? void 0 : d4.slice()) || [] });
    h3 && b12.run.push(h3), c3 && (b12.preventDefault = true), a2 && (b12.stopPropagation = true);
  };
  for (let r2 of s212) {
    let l11 = r2.scope ? r2.scope.split(" ") : ["editor"];
    if (r2.any) for (let c3 of l11) {
      let a2 = e7[c3] || (e7[c3] = /* @__PURE__ */ Object.create(null));
      a2._any || (a2._any = { preventDefault: false, stopPropagation: false, run: [] });
      let { any: f6 } = r2;
      for (let d4 in a2) a2[d4].run.push((u3) => f6(u3, Ci3));
    }
    let h3 = r2[t8] || r2.key;
    if (h3) for (let c3 of l11) o(c3, h3, r2.run, r2.preventDefault, r2.stopPropagation), r2.shift && o(c3, "Shift-" + h3, r2.shift, r2.preventDefault, r2.stopPropagation);
  }
  return e7;
}
var Ci3 = null;
function Hn3(s212, t8, e7, i12) {
  Ci3 = t8;
  let n14 = g2(t8), o = ae(n14, 0), r2 = Oe(o) == n14.length && n14 != " ", l11 = "", h3 = false, c3 = false, a2 = false;
  nt5 && nt5.view == e7 && nt5.scope == i12 && (l11 = nt5.prefix + " ", Mn3.indexOf(t8.keyCode) < 0 && (c3 = true, nt5 = null));
  let f6 = /* @__PURE__ */ new Set(), d4 = (b12) => {
    if (b12) {
      for (let m11 of b12.run) if (!f6.has(m11) && (f6.add(m11), m11(e7))) return b12.stopPropagation && (a2 = true), true;
      b12.preventDefault && (b12.stopPropagation && (a2 = true), c3 = true);
    }
    return false;
  }, u3 = s212[i12], p3, g8;
  return u3 && (d4(u3[l11 + fe5(n14, t8, !r2)]) ? h3 = true : r2 && (t8.altKey || t8.metaKey || t8.ctrlKey) && !(y6.windows && t8.ctrlKey && t8.altKey) && (p3 = t[t8.keyCode]) && p3 != n14 ? (d4(u3[l11 + fe5(p3, t8, true)]) || t8.shiftKey && (g8 = i[t8.keyCode]) != n14 && g8 != p3 && d4(u3[l11 + fe5(g8, t8, false)])) && (h3 = true) : r2 && t8.shiftKey && d4(u3[l11 + fe5(n14, t8, true)]) && (h3 = true), !h3 && d4(u3._any) && (h3 = true)), c3 && (h3 = true), h3 && a2 && t8.stopPropagation(), Ci3 = null, h3;
}
var Qt3 = class s106 {
  constructor(t8, e7, i12, n14, o) {
    this.className = t8, this.left = e7, this.top = i12, this.width = n14, this.height = o;
  }
  draw() {
    let t8 = document.createElement("div");
    return t8.className = this.className, this.adjust(t8), t8;
  }
  update(t8, e7) {
    return e7.className != this.className ? false : (this.adjust(t8), true);
  }
  adjust(t8) {
    t8.style.left = this.left + "px", t8.style.top = this.top + "px", this.width != null && (t8.style.width = this.width + "px"), t8.style.height = this.height + "px";
  }
  eq(t8) {
    return this.left == t8.left && this.top == t8.top && this.width == t8.width && this.height == t8.height && this.className == t8.className;
  }
  static forRange(t8, e7, i12) {
    if (i12.empty) {
      let n14 = t8.coordsAtPos(i12.head, i12.assoc || 1);
      if (!n14) return [];
      let o = Nn3(t8);
      return [new s106(e7, n14.left - o.left, n14.top - o.top, null, n14.bottom - n14.top)];
    } else return mr3(t8, e7, i12);
  }
};
function Nn3(s212) {
  let t8 = s212.scrollDOM.getBoundingClientRect();
  return { left: (s212.textDirection == L5.LTR ? t8.left : t8.right - s212.scrollDOM.clientWidth * s212.scaleX) - s212.scrollDOM.scrollLeft * s212.scaleX, top: t8.top - s212.scrollDOM.scrollTop * s212.scaleY };
}
function vs3(s212, t8, e7, i12) {
  let n14 = s212.coordsAtPos(t8, e7 * 2);
  if (!n14) return i12;
  let o = s212.dom.getBoundingClientRect(), r2 = (n14.top + n14.bottom) / 2, l11 = s212.posAtCoords({ x: o.left + 1, y: r2 }), h3 = s212.posAtCoords({ x: o.right - 1, y: r2 });
  return l11 == null || h3 == null ? i12 : { from: Math.max(i12.from, Math.min(l11, h3)), to: Math.min(i12.to, Math.max(l11, h3)) };
}
function mr3(s212, t8, e7) {
  if (e7.to <= s212.viewport.from || e7.from >= s212.viewport.to) return [];
  let i12 = Math.max(e7.from, s212.viewport.from), n14 = Math.min(e7.to, s212.viewport.to), o = s212.textDirection == L5.LTR, r2 = s212.contentDOM, l11 = r2.getBoundingClientRect(), h3 = Nn3(s212), c3 = r2.querySelector(".cm-line"), a2 = c3 && window.getComputedStyle(c3), f6 = l11.left + (a2 ? parseInt(a2.paddingLeft) + Math.min(0, parseInt(a2.textIndent)) : 0), d4 = l11.right - (a2 ? parseInt(a2.paddingRight) : 0), u3 = ri3(s212, i12), p3 = ri3(s212, n14), g8 = u3.type == F7.Text ? u3 : null, b12 = p3.type == F7.Text ? p3 : null;
  if (g8 && (s212.lineWrapping || u3.widgetLineBreaks) && (g8 = vs3(s212, i12, 1, g8)), b12 && (s212.lineWrapping || p3.widgetLineBreaks) && (b12 = vs3(s212, n14, -1, b12)), g8 && b12 && g8.from == b12.from && g8.to == b12.to) return w14(v10(e7.from, e7.to, g8));
  {
    let S17 = g8 ? v10(e7.from, null, g8) : x11(u3, false), C11 = b12 ? v10(null, e7.to, b12) : x11(p3, true), E11 = [];
    return (g8 || u3).to < (b12 || p3).from - (g8 && b12 ? 1 : 0) || u3.widgetLineBreaks > 1 && S17.bottom + s212.defaultLineHeight / 2 < C11.top ? E11.push(m11(f6, S17.bottom, d4, C11.top)) : S17.bottom < C11.top && s212.elementAtHeight((S17.bottom + C11.top) / 2).type == F7.Text && (S17.bottom = C11.top = (S17.bottom + C11.top) / 2), w14(S17).concat(E11).concat(w14(C11));
  }
  function m11(S17, C11, E11, B15) {
    return new Qt3(t8, S17 - h3.left, C11 - h3.top - 0.01, E11 - S17, B15 - C11 + 0.01);
  }
  function w14({ top: S17, bottom: C11, horizontal: E11 }) {
    let B15 = [];
    for (let et13 = 0; et13 < E11.length; et13 += 2) B15.push(m11(E11[et13], S17, E11[et13 + 1], C11));
    return B15;
  }
  function v10(S17, C11, E11) {
    let B15 = 1e9, et13 = -1e9, ee13 = [];
    function ji3(ct8, it12, bt5, ft8, Tt6) {
      let Z21 = s212.coordsAtPos(ct8, ct8 == E11.to ? -2 : 2), tt10 = s212.coordsAtPos(bt5, bt5 == E11.from ? 2 : -2);
      !Z21 || !tt10 || (B15 = Math.min(Z21.top, tt10.top, B15), et13 = Math.max(Z21.bottom, tt10.bottom, et13), Tt6 == L5.LTR ? ee13.push(o && it12 ? f6 : Z21.left, o && ft8 ? d4 : tt10.right) : ee13.push(!o && ft8 ? f6 : tt10.left, !o && it12 ? d4 : Z21.right));
    }
    let ie12 = S17 ?? E11.from, se15 = C11 ?? E11.to;
    for (let ct8 of s212.visibleRanges) if (ct8.to > ie12 && ct8.from < se15) for (let it12 = Math.max(ct8.from, ie12), bt5 = Math.min(ct8.to, se15); ; ) {
      let ft8 = s212.state.doc.lineAt(it12);
      for (let Tt6 of s212.bidiSpans(ft8)) {
        let Z21 = Tt6.from + ft8.from, tt10 = Tt6.to + ft8.from;
        if (Z21 >= bt5) break;
        tt10 > it12 && ji3(Math.max(Z21, it12), S17 == null && Z21 <= ie12, Math.min(tt10, bt5), C11 == null && tt10 >= se15, Tt6.dir);
      }
      if (it12 = ft8.to + 1, it12 >= bt5) break;
    }
    return ee13.length == 0 && ji3(ie12, S17 == null, se15, C11 == null, s212.textDirection), { top: B15, bottom: et13, horizontal: ee13 };
  }
  function x11(S17, C11) {
    let E11 = l11.top + (C11 ? S17.top : S17.bottom);
    return { top: E11, bottom: E11, horizontal: [] };
  }
}
function br3(s212, t8) {
  return s212.constructor == t8.constructor && s212.eq(t8);
}
var Mi3 = class {
  constructor(t8, e7) {
    this.view = t8, this.layer = e7, this.drawn = [], this.scaleX = 1, this.scaleY = 1, this.measureReq = { read: this.measure.bind(this), write: this.draw.bind(this) }, this.dom = t8.scrollDOM.appendChild(document.createElement("div")), this.dom.classList.add("cm-layer"), e7.above && this.dom.classList.add("cm-layer-above"), e7.class && this.dom.classList.add(e7.class), this.scale(), this.dom.setAttribute("aria-hidden", "true"), this.setOrder(t8.state), t8.requestMeasure(this.measureReq), e7.mount && e7.mount(this.dom, t8);
  }
  update(t8) {
    t8.startState.facet(me5) != t8.state.facet(me5) && this.setOrder(t8.state), (this.layer.update(t8, this.dom) || t8.geometryChanged) && (this.scale(), t8.view.requestMeasure(this.measureReq));
  }
  docViewUpdate(t8) {
    this.layer.updateOnDocViewUpdate !== false && t8.requestMeasure(this.measureReq);
  }
  setOrder(t8) {
    let e7 = 0, i12 = t8.facet(me5);
    for (; e7 < i12.length && i12[e7] != this.layer; ) e7++;
    this.dom.style.zIndex = String((this.layer.above ? 150 : -1) - e7);
  }
  measure() {
    return this.layer.markers(this.view);
  }
  scale() {
    let { scaleX: t8, scaleY: e7 } = this.view;
    (t8 != this.scaleX || e7 != this.scaleY) && (this.scaleX = t8, this.scaleY = e7, this.dom.style.transform = `scale(${1 / t8}, ${1 / e7})`);
  }
  draw(t8) {
    if (t8.length != this.drawn.length || t8.some((e7, i12) => !br3(e7, this.drawn[i12]))) {
      let e7 = this.dom.firstChild, i12 = 0;
      for (let n14 of t8) n14.update && e7 && n14.constructor && this.drawn[i12].constructor && n14.update(e7, this.drawn[i12]) ? (e7 = e7.nextSibling, i12++) : this.dom.insertBefore(n14.draw(), e7);
      for (; e7; ) {
        let n14 = e7.nextSibling;
        e7.remove(), e7 = n14;
      }
      this.drawn = t8;
    }
  }
  destroy() {
    this.layer.destroy && this.layer.destroy(this.dom, this.view), this.dom.remove();
  }
};
var me5 = y.define();
function Vn3(s212) {
  return [N6.define((t8) => new Mi3(t8, s212)), me5.of(s212)];
}
var Fn3 = !y6.ios;
var Dt3 = y.define({ combine(s212) {
  return at(s212, { cursorBlinkRate: 1200, drawRangeCursor: true }, { cursorBlinkRate: (t8, e7) => Math.min(t8, e7), drawRangeCursor: (t8, e7) => t8 || e7 });
} });
function Wn3(s212) {
  return s212.startState.facet(Dt3) != s212.state.facet(Dt3);
}
var yr3 = Vn3({ above: true, markers(s212) {
  let { state: t8 } = s212, e7 = t8.facet(Dt3), i12 = [];
  for (let n14 of t8.selection.ranges) {
    let o = n14 == t8.selection.main;
    if (n14.empty ? !o || Fn3 : e7.drawRangeCursor) {
      let r2 = o ? "cm-cursor cm-cursor-primary" : "cm-cursor cm-cursor-secondary", l11 = n14.empty ? n14 : x.cursor(n14.head, n14.head > n14.anchor ? -1 : 1);
      for (let h3 of Qt3.forRange(s212, r2, l11)) i12.push(h3);
    }
  }
  return i12;
}, update(s212, t8) {
  s212.transactions.some((i12) => i12.selection) && (t8.style.animationName = t8.style.animationName == "cm-blink" ? "cm-blink2" : "cm-blink");
  let e7 = Wn3(s212);
  return e7 && Ss3(s212.state, t8), s212.docChanged || s212.selectionSet || e7;
}, mount(s212, t8) {
  Ss3(t8.state, s212);
}, class: "cm-cursorLayer" });
function Ss3(s212, t8) {
  t8.style.animationDuration = s212.facet(Dt3).cursorBlinkRate + "ms";
}
var wr3 = Vn3({ above: false, markers(s212) {
  return s212.state.selection.ranges.map((t8) => t8.empty ? [] : Qt3.forRange(s212, "cm-selectionBackground", t8)).reduce((t8, e7) => t8.concat(e7));
}, update(s212, t8) {
  return s212.docChanged || s212.selectionSet || s212.viewportChanged || Wn3(s212);
}, class: "cm-selectionLayer" });
var ki3 = { ".cm-line": { "& ::selection, &::selection": { backgroundColor: "transparent !important" } }, ".cm-content": { "& :focus": { caretColor: "initial !important", "&::selection, & ::selection": { backgroundColor: "Highlight !important" } } } };
Fn3 && (ki3[".cm-line"].caretColor = ki3[".cm-content"].caretColor = "transparent !important");
var xr3 = ht.highest(A5.theme(ki3));
var zn3 = v.define({ map(s212, t8) {
  return s212 == null ? null : t8.mapPos(s212);
} });
var Ht4 = z.define({ create() {
  return null;
}, update(s212, t8) {
  return s212 != null && (s212 = t8.changes.mapPos(s212)), t8.effects.reduce((e7, i12) => i12.is(zn3) ? i12.value : e7, s212);
} });
var vr3 = N6.fromClass(class {
  constructor(s212) {
    this.view = s212, this.cursor = null, this.measureReq = { read: this.readPos.bind(this), write: this.drawCursor.bind(this) };
  }
  update(s212) {
    var t8;
    let e7 = s212.state.field(Ht4);
    e7 == null ? this.cursor != null && ((t8 = this.cursor) === null || t8 === void 0 || t8.remove(), this.cursor = null) : (this.cursor || (this.cursor = this.view.scrollDOM.appendChild(document.createElement("div")), this.cursor.className = "cm-dropCursor"), (s212.startState.field(Ht4) != e7 || s212.docChanged || s212.geometryChanged) && this.view.requestMeasure(this.measureReq));
  }
  readPos() {
    let { view: s212 } = this, t8 = s212.state.field(Ht4), e7 = t8 != null && s212.coordsAtPos(t8);
    if (!e7) return null;
    let i12 = s212.scrollDOM.getBoundingClientRect();
    return { left: e7.left - i12.left + s212.scrollDOM.scrollLeft * s212.scaleX, top: e7.top - i12.top + s212.scrollDOM.scrollTop * s212.scaleY, height: e7.bottom - e7.top };
  }
  drawCursor(s212) {
    if (this.cursor) {
      let { scaleX: t8, scaleY: e7 } = this.view;
      s212 ? (this.cursor.style.left = s212.left / t8 + "px", this.cursor.style.top = s212.top / e7 + "px", this.cursor.style.height = s212.height / e7 + "px") : this.cursor.style.left = "-100000px";
    }
  }
  destroy() {
    this.cursor && this.cursor.remove();
  }
  setDropPos(s212) {
    this.view.state.field(Ht4) != s212 && this.view.dispatch({ effects: zn3.of(s212) });
  }
}, { eventObservers: { dragover(s212) {
  this.setDropPos(this.view.posAtCoords({ x: s212.clientX, y: s212.clientY }));
}, dragleave(s212) {
  (s212.target == this.view.contentDOM || !this.view.contentDOM.contains(s212.relatedTarget)) && this.setDropPos(null);
}, dragend() {
  this.setDropPos(null);
}, drop() {
  this.setDropPos(null);
} } });
function Cs3(s212, t8, e7, i12, n14) {
  t8.lastIndex = 0;
  for (let o = s212.iterRange(e7, i12), r2 = e7, l11; !o.next().done; r2 += o.value.length) if (!o.lineBreak) for (; l11 = t8.exec(o.value); ) n14(r2 + l11.index, l11);
}
function Sr3(s212, t8) {
  let e7 = s212.visibleRanges;
  if (e7.length == 1 && e7[0].from == s212.viewport.from && e7[0].to == s212.viewport.to) return e7;
  let i12 = [];
  for (let { from: n14, to: o } of e7) n14 = Math.max(s212.state.doc.lineAt(n14).from, n14 - t8), o = Math.min(s212.state.doc.lineAt(o).to, o + t8), i12.length && i12[i12.length - 1].to >= n14 ? i12[i12.length - 1].to = o : i12.push({ from: n14, to: o });
  return i12;
}
var Jt4 = class {
  constructor(t8) {
    let { regexp: e7, decoration: i12, decorate: n14, boundary: o, maxLength: r2 = 1e3 } = t8;
    if (!e7.global) throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");
    if (this.regexp = e7, n14) this.addMatch = (l11, h3, c3, a2) => n14(a2, c3, c3 + l11[0].length, l11, h3);
    else if (typeof i12 == "function") this.addMatch = (l11, h3, c3, a2) => {
      let f6 = i12(l11, h3, c3);
      f6 && a2(c3, c3 + l11[0].length, f6);
    };
    else if (i12) this.addMatch = (l11, h3, c3, a2) => a2(c3, c3 + l11[0].length, i12);
    else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");
    this.boundary = o, this.maxLength = r2;
  }
  createDeco(t8) {
    let e7 = new re(), i12 = e7.add.bind(e7);
    for (let { from: n14, to: o } of Sr3(t8, this.maxLength)) Cs3(t8.state.doc, this.regexp, n14, o, (r2, l11) => this.addMatch(l11, t8, r2, i12));
    return e7.finish();
  }
  updateDeco(t8, e7) {
    let i12 = 1e9, n14 = -1;
    return t8.docChanged && t8.changes.iterChanges((o, r2, l11, h3) => {
      h3 > t8.view.viewport.from && l11 < t8.view.viewport.to && (i12 = Math.min(l11, i12), n14 = Math.max(h3, n14));
    }), t8.viewportChanged || n14 - i12 > 1e3 ? this.createDeco(t8.view) : n14 > -1 ? this.updateRange(t8.view, e7.map(t8.changes), i12, n14) : e7;
  }
  updateRange(t8, e7, i12, n14) {
    for (let o of t8.visibleRanges) {
      let r2 = Math.max(o.from, i12), l11 = Math.min(o.to, n14);
      if (l11 > r2) {
        let h3 = t8.state.doc.lineAt(r2), c3 = h3.to < l11 ? t8.state.doc.lineAt(l11) : h3, a2 = Math.max(o.from, h3.from), f6 = Math.min(o.to, c3.to);
        if (this.boundary) {
          for (; r2 > h3.from; r2--) if (this.boundary.test(h3.text[r2 - 1 - h3.from])) {
            a2 = r2;
            break;
          }
          for (; l11 < c3.to; l11++) if (this.boundary.test(c3.text[l11 - c3.from])) {
            f6 = l11;
            break;
          }
        }
        let d4 = [], u3, p3 = (g8, b12, m11) => d4.push(m11.range(g8, b12));
        if (h3 == c3) for (this.regexp.lastIndex = a2 - h3.from; (u3 = this.regexp.exec(h3.text)) && u3.index < f6 - h3.from; ) this.addMatch(u3, t8, u3.index + h3.from, p3);
        else Cs3(t8.state.doc, this.regexp, a2, f6, (g8, b12) => this.addMatch(b12, t8, g8, p3));
        e7 = e7.update({ filterFrom: a2, filterTo: f6, filter: (g8, b12) => g8 < a2 || b12 > f6, add: d4 });
      }
    }
    return e7;
  }
};
var Ai3 = /x/.unicode != null ? "gu" : "g";
var Cr3 = new RegExp(`[\0-\b
--ÂŸÂ­Øœâ€‹â€Žâ€\u2028\u2029â€­â€®â¦â§â©\uFEFFï¿¹-ï¿¼]`, Ai3);
var je5 = null;
function kr3() {
  var s212;
  if (je5 == null && typeof document < "u" && document.body) {
    let t8 = document.body.style;
    je5 = ((s212 = t8.tabSize) !== null && s212 !== void 0 ? s212 : t8.MozTabSize) != null;
  }
  return je5 || false;
}
var be6 = y.define({ combine(s212) {
  let t8 = at(s212, { render: null, specialChars: Cr3, addSpecialChars: null });
  return (t8.replaceTabs = !kr3()) && (t8.specialChars = new RegExp("	|" + t8.specialChars.source, Ai3)), t8.addSpecialChars && (t8.specialChars = new RegExp(t8.specialChars.source + "|" + t8.addSpecialChars.source, Ai3)), t8;
} });
var ks2 = N6.fromClass(class {
  constructor() {
    this.height = 1e3, this.attrs = { style: "padding-bottom: 1000px" };
  }
  update(s212) {
    let { view: t8 } = s212, e7 = t8.viewState.editorHeight - t8.defaultLineHeight - t8.documentPadding.top - 0.5;
    e7 >= 0 && e7 != this.height && (this.height = e7, this.attrs = { style: `padding-bottom: ${e7}px` });
  }
});
var Tr2 = O5.line({ class: "cm-activeLine" });
var Rr2 = N6.fromClass(class {
  constructor(s212) {
    this.decorations = this.getDeco(s212);
  }
  update(s212) {
    (s212.docChanged || s212.selectionSet) && (this.decorations = this.getDeco(s212.view));
  }
  getDeco(s212) {
    let t8 = -1, e7 = [];
    for (let i12 of s212.state.selection.ranges) {
      let n14 = s212.lineBlockAt(i12.head);
      n14.from > t8 && (e7.push(Tr2.range(n14.from)), t8 = n14.from);
    }
    return O5.set(e7);
  }
}, { decorations: (s212) => s212.decorations });
var Rt4 = "-10000px";
var Le5 = class {
  constructor(t8, e7, i12, n14) {
    this.facet = e7, this.createTooltipView = i12, this.removeTooltipView = n14, this.input = t8.state.facet(e7), this.tooltips = this.input.filter((r2) => r2);
    let o = null;
    this.tooltipViews = this.tooltips.map((r2) => o = i12(r2, o));
  }
  update(t8, e7) {
    var i12;
    let n14 = t8.state.facet(this.facet), o = n14.filter((h3) => h3);
    if (n14 === this.input) {
      for (let h3 of this.tooltipViews) h3.update && h3.update(t8);
      return false;
    }
    let r2 = [], l11 = e7 ? [] : null;
    for (let h3 = 0; h3 < o.length; h3++) {
      let c3 = o[h3], a2 = -1;
      if (c3) {
        for (let f6 = 0; f6 < this.tooltips.length; f6++) {
          let d4 = this.tooltips[f6];
          d4 && d4.create == c3.create && (a2 = f6);
        }
        if (a2 < 0) r2[h3] = this.createTooltipView(c3, h3 ? r2[h3 - 1] : null), l11 && (l11[h3] = !!c3.above);
        else {
          let f6 = r2[h3] = this.tooltipViews[a2];
          l11 && (l11[h3] = e7[a2]), f6.update && f6.update(t8);
        }
      }
    }
    for (let h3 of this.tooltipViews) r2.indexOf(h3) < 0 && (this.removeTooltipView(h3), (i12 = h3.destroy) === null || i12 === void 0 || i12.call(h3));
    return e7 && (l11.forEach((h3, c3) => e7[c3] = h3), e7.length = l11.length), this.input = n14, this.tooltips = o, this.tooltipViews = r2, true;
  }
};
function Nr2(s212) {
  let { win: t8 } = s212;
  return { top: 0, left: 0, bottom: t8.innerHeight, right: t8.innerWidth };
}
var ye6 = y.define({ combine: (s212) => {
  var t8, e7, i12;
  return { position: y6.ios ? "absolute" : ((t8 = s212.find((n14) => n14.position)) === null || t8 === void 0 ? void 0 : t8.position) || "fixed", parent: ((e7 = s212.find((n14) => n14.parent)) === null || e7 === void 0 ? void 0 : e7.parent) || null, tooltipSpace: ((i12 = s212.find((n14) => n14.tooltipSpace)) === null || i12 === void 0 ? void 0 : i12.tooltipSpace) || Nr2 };
} });
var Ds2 = /* @__PURE__ */ new WeakMap();
var We5 = N6.fromClass(class {
  constructor(s212) {
    this.view = s212, this.above = [], this.inView = true, this.madeAbsolute = false, this.lastTransaction = 0, this.measureTimeout = -1;
    let t8 = s212.state.facet(ye6);
    this.position = t8.position, this.parent = t8.parent, this.classes = s212.themeClasses, this.createContainer(), this.measureReq = { read: this.readMeasure.bind(this), write: this.writeMeasure.bind(this), key: this }, this.resizeObserver = typeof ResizeObserver == "function" ? new ResizeObserver(() => this.measureSoon()) : null, this.manager = new Le5(s212, In3, (e7, i12) => this.createTooltip(e7, i12), (e7) => {
      this.resizeObserver && this.resizeObserver.unobserve(e7.dom), e7.dom.remove();
    }), this.above = this.manager.tooltips.map((e7) => !!e7.above), this.intersectionObserver = typeof IntersectionObserver == "function" ? new IntersectionObserver((e7) => {
      Date.now() > this.lastTransaction - 50 && e7.length > 0 && e7[e7.length - 1].intersectionRatio < 1 && this.measureSoon();
    }, { threshold: [1] }) : null, this.observeIntersection(), s212.win.addEventListener("resize", this.measureSoon = this.measureSoon.bind(this)), this.maybeMeasure();
  }
  createContainer() {
    this.parent ? (this.container = document.createElement("div"), this.container.style.position = "relative", this.container.className = this.view.themeClasses, this.parent.appendChild(this.container)) : this.container = this.view.dom;
  }
  observeIntersection() {
    if (this.intersectionObserver) {
      this.intersectionObserver.disconnect();
      for (let s212 of this.manager.tooltipViews) this.intersectionObserver.observe(s212.dom);
    }
  }
  measureSoon() {
    this.measureTimeout < 0 && (this.measureTimeout = setTimeout(() => {
      this.measureTimeout = -1, this.maybeMeasure();
    }, 50));
  }
  update(s212) {
    s212.transactions.length && (this.lastTransaction = Date.now());
    let t8 = this.manager.update(s212, this.above);
    t8 && this.observeIntersection();
    let e7 = t8 || s212.geometryChanged, i12 = s212.state.facet(ye6);
    if (i12.position != this.position && !this.madeAbsolute) {
      this.position = i12.position;
      for (let n14 of this.manager.tooltipViews) n14.dom.style.position = this.position;
      e7 = true;
    }
    if (i12.parent != this.parent) {
      this.parent && this.container.remove(), this.parent = i12.parent, this.createContainer();
      for (let n14 of this.manager.tooltipViews) this.container.appendChild(n14.dom);
      e7 = true;
    } else this.parent && this.view.themeClasses != this.classes && (this.classes = this.container.className = this.view.themeClasses);
    e7 && this.maybeMeasure();
  }
  createTooltip(s212, t8) {
    let e7 = s212.create(this.view), i12 = t8 ? t8.dom : null;
    if (e7.dom.classList.add("cm-tooltip"), s212.arrow && !e7.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")) {
      let n14 = document.createElement("div");
      n14.className = "cm-tooltip-arrow", e7.dom.appendChild(n14);
    }
    return e7.dom.style.position = this.position, e7.dom.style.top = Rt4, e7.dom.style.left = "0px", this.container.insertBefore(e7.dom, i12), e7.mount && e7.mount(this.view), this.resizeObserver && this.resizeObserver.observe(e7.dom), e7;
  }
  destroy() {
    var s212, t8, e7;
    this.view.win.removeEventListener("resize", this.measureSoon);
    for (let i12 of this.manager.tooltipViews) i12.dom.remove(), (s212 = i12.destroy) === null || s212 === void 0 || s212.call(i12);
    this.parent && this.container.remove(), (t8 = this.resizeObserver) === null || t8 === void 0 || t8.disconnect(), (e7 = this.intersectionObserver) === null || e7 === void 0 || e7.disconnect(), clearTimeout(this.measureTimeout);
  }
  readMeasure() {
    let s212 = this.view.dom.getBoundingClientRect(), t8 = 1, e7 = 1, i12 = false;
    if (this.position == "fixed" && this.manager.tooltipViews.length) {
      let { dom: n14 } = this.manager.tooltipViews[0];
      if (y6.gecko) i12 = n14.offsetParent != this.container.ownerDocument.body;
      else if (n14.style.top == Rt4 && n14.style.left == "0px") {
        let o = n14.getBoundingClientRect();
        i12 = Math.abs(o.top + 1e4) > 1 || Math.abs(o.left) > 1;
      }
    }
    if (i12 || this.position == "absolute") if (this.parent) {
      let n14 = this.parent.getBoundingClientRect();
      n14.width && n14.height && (t8 = n14.width / this.parent.offsetWidth, e7 = n14.height / this.parent.offsetHeight);
    } else ({ scaleX: t8, scaleY: e7 } = this.view.viewState);
    return { editor: s212, parent: this.parent ? this.container.getBoundingClientRect() : s212, pos: this.manager.tooltips.map((n14, o) => {
      let r2 = this.manager.tooltipViews[o];
      return r2.getCoords ? r2.getCoords(n14.pos) : this.view.coordsAtPos(n14.pos);
    }), size: this.manager.tooltipViews.map(({ dom: n14 }) => n14.getBoundingClientRect()), space: this.view.state.facet(ye6).tooltipSpace(this.view), scaleX: t8, scaleY: e7, makeAbsolute: i12 };
  }
  writeMeasure(s212) {
    var t8;
    if (s212.makeAbsolute) {
      this.madeAbsolute = true, this.position = "absolute";
      for (let l11 of this.manager.tooltipViews) l11.dom.style.position = "absolute";
    }
    let { editor: e7, space: i12, scaleX: n14, scaleY: o } = s212, r2 = [];
    for (let l11 = 0; l11 < this.manager.tooltips.length; l11++) {
      let h3 = this.manager.tooltips[l11], c3 = this.manager.tooltipViews[l11], { dom: a2 } = c3, f6 = s212.pos[l11], d4 = s212.size[l11];
      if (!f6 || f6.bottom <= Math.max(e7.top, i12.top) || f6.top >= Math.min(e7.bottom, i12.bottom) || f6.right < Math.max(e7.left, i12.left) - 0.1 || f6.left > Math.min(e7.right, i12.right) + 0.1) {
        a2.style.top = Rt4;
        continue;
      }
      let u3 = h3.arrow ? c3.dom.querySelector(".cm-tooltip-arrow") : null, p3 = u3 ? 7 : 0, g8 = d4.right - d4.left, b12 = (t8 = Ds2.get(c3)) !== null && t8 !== void 0 ? t8 : d4.bottom - d4.top, m11 = c3.offset || Fr3, w14 = this.view.textDirection == L5.LTR, v10 = d4.width > i12.right - i12.left ? w14 ? i12.left : i12.right - d4.width : w14 ? Math.max(i12.left, Math.min(f6.left - (u3 ? 14 : 0) + m11.x, i12.right - g8)) : Math.min(Math.max(i12.left, f6.left - g8 + (u3 ? 14 : 0) - m11.x), i12.right - g8), x11 = this.above[l11];
      !h3.strictSide && (x11 ? f6.top - (d4.bottom - d4.top) - m11.y < i12.top : f6.bottom + (d4.bottom - d4.top) + m11.y > i12.bottom) && x11 == i12.bottom - f6.bottom > f6.top - i12.top && (x11 = this.above[l11] = !x11);
      let S17 = (x11 ? f6.top - i12.top : i12.bottom - f6.bottom) - p3;
      if (S17 < b12 && c3.resize !== false) {
        if (S17 < this.view.defaultLineHeight) {
          a2.style.top = Rt4;
          continue;
        }
        Ds2.set(c3, b12), a2.style.height = (b12 = S17) / o + "px";
      } else a2.style.height && (a2.style.height = "");
      let C11 = x11 ? f6.top - b12 - p3 - m11.y : f6.bottom + p3 + m11.y, E11 = v10 + g8;
      if (c3.overlap !== true) for (let B15 of r2) B15.left < E11 && B15.right > v10 && B15.top < C11 + b12 && B15.bottom > C11 && (C11 = x11 ? B15.top - b12 - 2 - p3 : B15.bottom + p3 + 2);
      if (this.position == "absolute" ? (a2.style.top = (C11 - s212.parent.top) / o + "px", a2.style.left = (v10 - s212.parent.left) / n14 + "px") : (a2.style.top = C11 / o + "px", a2.style.left = v10 / n14 + "px"), u3) {
        let B15 = f6.left + (w14 ? m11.x : -m11.x) - (v10 + 14 - 7);
        u3.style.left = B15 / n14 + "px";
      }
      c3.overlap !== true && r2.push({ left: v10, top: C11, right: E11, bottom: C11 + b12 }), a2.classList.toggle("cm-tooltip-above", x11), a2.classList.toggle("cm-tooltip-below", !x11), c3.positioned && c3.positioned(s212.space);
    }
  }
  maybeMeasure() {
    if (this.manager.tooltips.length && (this.view.inView && this.view.requestMeasure(this.measureReq), this.inView != this.view.inView && (this.inView = this.view.inView, !this.inView))) for (let s212 of this.manager.tooltipViews) s212.dom.style.top = Rt4;
  }
}, { eventObservers: { scroll() {
  this.maybeMeasure();
} } });
var Vr2 = A5.baseTheme({ ".cm-tooltip": { zIndex: 100, boxSizing: "border-box" }, "&light .cm-tooltip": { border: "1px solid #bbb", backgroundColor: "#f5f5f5" }, "&light .cm-tooltip-section:not(:first-child)": { borderTop: "1px solid #bbb" }, "&dark .cm-tooltip": { backgroundColor: "#333338", color: "white" }, ".cm-tooltip-arrow": { height: "7px", width: `${7 * 2}px`, position: "absolute", zIndex: -1, overflow: "hidden", "&:before, &:after": { content: "''", position: "absolute", width: 0, height: 0, borderLeft: "7px solid transparent", borderRight: "7px solid transparent" }, ".cm-tooltip-above &": { bottom: "-7px", "&:before": { borderTop: "7px solid #bbb" }, "&:after": { borderTop: "7px solid #f5f5f5", bottom: "1px" } }, ".cm-tooltip-below &": { top: "-7px", "&:before": { borderBottom: "7px solid #bbb" }, "&:after": { borderBottom: "7px solid #f5f5f5", top: "1px" } } }, "&dark .cm-tooltip .cm-tooltip-arrow": { "&:before": { borderTopColor: "#333338", borderBottomColor: "#333338" }, "&:after": { borderTopColor: "transparent", borderBottomColor: "transparent" } } });
var Fr3 = { x: 0, y: 0 };
var In3 = y.define({ enables: [We5, Vr2] });
var Zt4 = y.define({ combine: (s212) => s212.reduce((t8, e7) => t8.concat(e7), []) });
var Be5 = class s107 {
  static create(t8) {
    return new s107(t8);
  }
  constructor(t8) {
    this.view = t8, this.mounted = false, this.dom = document.createElement("div"), this.dom.classList.add("cm-tooltip-hover"), this.manager = new Le5(t8, Zt4, (e7, i12) => this.createHostedView(e7, i12), (e7) => e7.dom.remove());
  }
  createHostedView(t8, e7) {
    let i12 = t8.create(this.view);
    return i12.dom.classList.add("cm-tooltip-section"), this.dom.insertBefore(i12.dom, e7 ? e7.dom.nextSibling : this.dom.firstChild), this.mounted && i12.mount && i12.mount(this.view), i12;
  }
  mount(t8) {
    for (let e7 of this.manager.tooltipViews) e7.mount && e7.mount(t8);
    this.mounted = true;
  }
  positioned(t8) {
    for (let e7 of this.manager.tooltipViews) e7.positioned && e7.positioned(t8);
  }
  update(t8) {
    this.manager.update(t8);
  }
  destroy() {
    var t8;
    for (let e7 of this.manager.tooltipViews) (t8 = e7.destroy) === null || t8 === void 0 || t8.call(e7);
  }
  passProp(t8) {
    let e7;
    for (let i12 of this.manager.tooltipViews) {
      let n14 = i12[t8];
      if (n14 !== void 0) {
        if (e7 === void 0) e7 = n14;
        else if (e7 !== n14) return;
      }
    }
    return e7;
  }
  get offset() {
    return this.passProp("offset");
  }
  get getCoords() {
    return this.passProp("getCoords");
  }
  get overlap() {
    return this.passProp("overlap");
  }
  get resize() {
    return this.passProp("resize");
  }
};
var Wr3 = In3.compute([Zt4], (s212) => {
  let t8 = s212.facet(Zt4);
  return t8.length === 0 ? null : { pos: Math.min(...t8.map((e7) => e7.pos)), end: Math.max(...t8.map((e7) => {
    var i12;
    return (i12 = e7.end) !== null && i12 !== void 0 ? i12 : e7.pos;
  })), create: Be5.create, above: t8[0].above, arrow: t8.some((e7) => e7.arrow) };
});
var Kn3 = v.define();
var wl2 = Kn3.of(null);
var Li3 = y.define({ combine(s212) {
  let t8, e7;
  for (let i12 of s212) t8 = t8 || i12.topContainer, e7 = e7 || i12.bottomContainer;
  return { topContainer: t8, bottomContainer: e7 };
} });
var qn3 = N6.fromClass(class {
  constructor(s212) {
    this.input = s212.state.facet(Ts3), this.specs = this.input.filter((e7) => e7), this.panels = this.specs.map((e7) => e7(s212));
    let t8 = s212.state.facet(Li3);
    this.top = new vt3(s212, true, t8.topContainer), this.bottom = new vt3(s212, false, t8.bottomContainer), this.top.sync(this.panels.filter((e7) => e7.top)), this.bottom.sync(this.panels.filter((e7) => !e7.top));
    for (let e7 of this.panels) e7.dom.classList.add("cm-panel"), e7.mount && e7.mount();
  }
  update(s212) {
    let t8 = s212.state.facet(Li3);
    this.top.container != t8.topContainer && (this.top.sync([]), this.top = new vt3(s212.view, true, t8.topContainer)), this.bottom.container != t8.bottomContainer && (this.bottom.sync([]), this.bottom = new vt3(s212.view, false, t8.bottomContainer)), this.top.syncClasses(), this.bottom.syncClasses();
    let e7 = s212.state.facet(Ts3);
    if (e7 != this.input) {
      let i12 = e7.filter((h3) => h3), n14 = [], o = [], r2 = [], l11 = [];
      for (let h3 of i12) {
        let c3 = this.specs.indexOf(h3), a2;
        c3 < 0 ? (a2 = h3(s212.view), l11.push(a2)) : (a2 = this.panels[c3], a2.update && a2.update(s212)), n14.push(a2), (a2.top ? o : r2).push(a2);
      }
      this.specs = i12, this.panels = n14, this.top.sync(o), this.bottom.sync(r2);
      for (let h3 of l11) h3.dom.classList.add("cm-panel"), h3.mount && h3.mount();
    } else for (let i12 of this.panels) i12.update && i12.update(s212);
  }
  destroy() {
    this.top.sync([]), this.bottom.sync([]);
  }
}, { provide: (s212) => A5.scrollMargins.of((t8) => {
  let e7 = t8.plugin(s212);
  return e7 && { top: e7.top.scrollMargin(), bottom: e7.bottom.scrollMargin() };
}) });
var vt3 = class {
  constructor(t8, e7, i12) {
    this.view = t8, this.top = e7, this.container = i12, this.dom = void 0, this.classes = "", this.panels = [], this.syncClasses();
  }
  sync(t8) {
    for (let e7 of this.panels) e7.destroy && t8.indexOf(e7) < 0 && e7.destroy();
    this.panels = t8, this.syncDOM();
  }
  syncDOM() {
    if (this.panels.length == 0) {
      this.dom && (this.dom.remove(), this.dom = void 0);
      return;
    }
    if (!this.dom) {
      this.dom = document.createElement("div"), this.dom.className = this.top ? "cm-panels cm-panels-top" : "cm-panels cm-panels-bottom", this.dom.style[this.top ? "top" : "bottom"] = "0";
      let e7 = this.container || this.view.dom;
      e7.insertBefore(this.dom, this.top ? e7.firstChild : null);
    }
    let t8 = this.dom.firstChild;
    for (let e7 of this.panels) if (e7.dom.parentNode == this.dom) {
      for (; t8 != e7.dom; ) t8 = Os3(t8);
      t8 = t8.nextSibling;
    } else this.dom.insertBefore(e7.dom, t8);
    for (; t8; ) t8 = Os3(t8);
  }
  scrollMargin() {
    return !this.dom || this.container ? 0 : Math.max(0, this.top ? this.dom.getBoundingClientRect().bottom - Math.max(0, this.view.scrollDOM.getBoundingClientRect().top) : Math.min(innerHeight, this.view.scrollDOM.getBoundingClientRect().bottom) - this.dom.getBoundingClientRect().top);
  }
  syncClasses() {
    if (!(!this.container || this.classes == this.view.themeClasses)) {
      for (let t8 of this.classes.split(" ")) t8 && this.container.classList.remove(t8);
      for (let t8 of (this.classes = this.view.themeClasses).split(" ")) t8 && this.container.classList.add(t8);
    }
  }
};
function Os3(s212) {
  let t8 = s212.nextSibling;
  return s212.remove(), t8;
}
var Ts3 = y.define({ enables: qn3 });
var J4 = class extends W {
  compare(t8) {
    return this == t8 || this.constructor == t8.constructor && this.eq(t8);
  }
  eq(t8) {
    return false;
  }
  destroy(t8) {
  }
};
J4.prototype.elementClass = "";
J4.prototype.toDOM = void 0;
J4.prototype.mapMode = E.TrackBefore;
J4.prototype.startSide = J4.prototype.endSide = -1;
J4.prototype.point = true;
var we6 = y.define();
var Kr2 = y.define();
var Kt4 = y.define();
var Bi3 = y.define({ combine: (s212) => s212.some((t8) => t8) });
var jr3 = N6.fromClass(class {
  constructor(s212) {
    this.view = s212, this.prevViewport = s212.viewport, this.dom = document.createElement("div"), this.dom.className = "cm-gutters", this.dom.setAttribute("aria-hidden", "true"), this.dom.style.minHeight = this.view.contentHeight / this.view.scaleY + "px", this.gutters = s212.state.facet(Kt4).map((t8) => new Pe5(s212, t8));
    for (let t8 of this.gutters) this.dom.appendChild(t8.dom);
    this.fixed = !s212.state.facet(Bi3), this.fixed && (this.dom.style.position = "sticky"), this.syncGutters(false), s212.scrollDOM.insertBefore(this.dom, s212.contentDOM);
  }
  update(s212) {
    if (this.updateGutters(s212)) {
      let t8 = this.prevViewport, e7 = s212.view.viewport, i12 = Math.min(t8.to, e7.to) - Math.max(t8.from, e7.from);
      this.syncGutters(i12 < (e7.to - e7.from) * 0.8);
    }
    s212.geometryChanged && (this.dom.style.minHeight = this.view.contentHeight / this.view.scaleY + "px"), this.view.state.facet(Bi3) != !this.fixed && (this.fixed = !this.fixed, this.dom.style.position = this.fixed ? "sticky" : ""), this.prevViewport = s212.view.viewport;
  }
  syncGutters(s212) {
    let t8 = this.dom.nextSibling;
    s212 && this.dom.remove();
    let e7 = T.iter(this.view.state.facet(we6), this.view.viewport.from), i12 = [], n14 = this.gutters.map((o) => new Hi3(o, this.view.viewport, -this.view.documentPadding.top));
    for (let o of this.view.viewportLineBlocks) if (i12.length && (i12 = []), Array.isArray(o.type)) {
      let r2 = true;
      for (let l11 of o.type) if (l11.type == F7.Text && r2) {
        Pi3(e7, i12, l11.from);
        for (let h3 of n14) h3.line(this.view, l11, i12);
        r2 = false;
      } else if (l11.widget) for (let h3 of n14) h3.widget(this.view, l11);
    } else if (o.type == F7.Text) {
      Pi3(e7, i12, o.from);
      for (let r2 of n14) r2.line(this.view, o, i12);
    } else if (o.widget) for (let r2 of n14) r2.widget(this.view, o);
    for (let o of n14) o.finish();
    s212 && this.view.scrollDOM.insertBefore(this.dom, t8);
  }
  updateGutters(s212) {
    let t8 = s212.startState.facet(Kt4), e7 = s212.state.facet(Kt4), i12 = s212.docChanged || s212.heightChanged || s212.viewportChanged || !T.eq(s212.startState.facet(we6), s212.state.facet(we6), s212.view.viewport.from, s212.view.viewport.to);
    if (t8 == e7) for (let n14 of this.gutters) n14.update(s212) && (i12 = true);
    else {
      i12 = true;
      let n14 = [];
      for (let o of e7) {
        let r2 = t8.indexOf(o);
        r2 < 0 ? n14.push(new Pe5(this.view, o)) : (this.gutters[r2].update(s212), n14.push(this.gutters[r2]));
      }
      for (let o of this.gutters) o.dom.remove(), n14.indexOf(o) < 0 && o.destroy();
      for (let o of n14) this.dom.appendChild(o.dom);
      this.gutters = n14;
    }
    return i12;
  }
  destroy() {
    for (let s212 of this.gutters) s212.destroy();
    this.dom.remove();
  }
}, { provide: (s212) => A5.scrollMargins.of((t8) => {
  let e7 = t8.plugin(s212);
  return !e7 || e7.gutters.length == 0 || !e7.fixed ? null : t8.textDirection == L5.LTR ? { left: e7.dom.offsetWidth * t8.scaleX } : { right: e7.dom.offsetWidth * t8.scaleX };
}) });
function Rs3(s212) {
  return Array.isArray(s212) ? s212 : [s212];
}
function Pi3(s212, t8, e7) {
  for (; s212.value && s212.from <= e7; ) s212.from == e7 && t8.push(s212.value), s212.next();
}
var Hi3 = class {
  constructor(t8, e7, i12) {
    this.gutter = t8, this.height = i12, this.i = 0, this.cursor = T.iter(t8.markers, e7.from);
  }
  addElement(t8, e7, i12) {
    let { gutter: n14 } = this, o = (e7.top - this.height) / t8.scaleY, r2 = e7.height / t8.scaleY;
    if (this.i == n14.elements.length) {
      let l11 = new He4(t8, r2, o, i12);
      n14.elements.push(l11), n14.dom.appendChild(l11.dom);
    } else n14.elements[this.i].update(t8, r2, o, i12);
    this.height = e7.bottom, this.i++;
  }
  line(t8, e7, i12) {
    let n14 = [];
    Pi3(this.cursor, n14, e7.from), i12.length && (n14 = n14.concat(i12));
    let o = this.gutter.config.lineMarker(t8, e7, n14);
    o && n14.unshift(o);
    let r2 = this.gutter;
    n14.length == 0 && !r2.config.renderEmptyElements || this.addElement(t8, e7, n14);
  }
  widget(t8, e7) {
    let i12 = this.gutter.config.widgetMarker(t8, e7.widget, e7), n14 = i12 ? [i12] : null;
    for (let o of t8.state.facet(Kr2)) {
      let r2 = o(t8, e7.widget, e7);
      r2 && (n14 || (n14 = [])).push(r2);
    }
    n14 && this.addElement(t8, e7, n14);
  }
  finish() {
    let t8 = this.gutter;
    for (; t8.elements.length > this.i; ) {
      let e7 = t8.elements.pop();
      t8.dom.removeChild(e7.dom), e7.destroy();
    }
  }
};
var Pe5 = class {
  constructor(t8, e7) {
    this.view = t8, this.config = e7, this.elements = [], this.spacer = null, this.dom = document.createElement("div"), this.dom.className = "cm-gutter" + (this.config.class ? " " + this.config.class : "");
    for (let i12 in e7.domEventHandlers) this.dom.addEventListener(i12, (n14) => {
      let o = n14.target, r2;
      if (o != this.dom && this.dom.contains(o)) {
        for (; o.parentNode != this.dom; ) o = o.parentNode;
        let h3 = o.getBoundingClientRect();
        r2 = (h3.top + h3.bottom) / 2;
      } else r2 = n14.clientY;
      let l11 = t8.lineBlockAtHeight(r2 - t8.documentTop);
      e7.domEventHandlers[i12](t8, l11, n14) && n14.preventDefault();
    });
    this.markers = Rs3(e7.markers(t8)), e7.initialSpacer && (this.spacer = new He4(t8, 0, 0, [e7.initialSpacer(t8)]), this.dom.appendChild(this.spacer.dom), this.spacer.dom.style.cssText += "visibility: hidden; pointer-events: none");
  }
  update(t8) {
    let e7 = this.markers;
    if (this.markers = Rs3(this.config.markers(t8.view)), this.spacer && this.config.updateSpacer) {
      let n14 = this.config.updateSpacer(this.spacer.markers[0], t8);
      n14 != this.spacer.markers[0] && this.spacer.update(t8.view, 0, 0, [n14]);
    }
    let i12 = t8.view.viewport;
    return !T.eq(this.markers, e7, i12.from, i12.to) || (this.config.lineMarkerChange ? this.config.lineMarkerChange(t8) : false);
  }
  destroy() {
    for (let t8 of this.elements) t8.destroy();
  }
};
var He4 = class {
  constructor(t8, e7, i12, n14) {
    this.height = -1, this.above = 0, this.markers = [], this.dom = document.createElement("div"), this.dom.className = "cm-gutterElement", this.update(t8, e7, i12, n14);
  }
  update(t8, e7, i12, n14) {
    this.height != e7 && (this.height = e7, this.dom.style.height = e7 + "px"), this.above != i12 && (this.dom.style.marginTop = (this.above = i12) ? i12 + "px" : ""), Yr2(this.markers, n14) || this.setMarkers(t8, n14);
  }
  setMarkers(t8, e7) {
    let i12 = "cm-gutterElement", n14 = this.dom.firstChild;
    for (let o = 0, r2 = 0; ; ) {
      let l11 = r2, h3 = o < e7.length ? e7[o++] : null, c3 = false;
      if (h3) {
        let a2 = h3.elementClass;
        a2 && (i12 += " " + a2);
        for (let f6 = r2; f6 < this.markers.length; f6++) if (this.markers[f6].compare(h3)) {
          l11 = f6, c3 = true;
          break;
        }
      } else l11 = this.markers.length;
      for (; r2 < l11; ) {
        let a2 = this.markers[r2++];
        if (a2.toDOM) {
          a2.destroy(n14);
          let f6 = n14.nextSibling;
          n14.remove(), n14 = f6;
        }
      }
      if (!h3) break;
      h3.toDOM && (c3 ? n14 = n14.nextSibling : this.dom.insertBefore(h3.toDOM(t8), n14)), c3 && r2++;
    }
    this.dom.className = i12, this.markers = e7;
  }
  destroy() {
    this.setMarkers(null, []);
  }
};
function Yr2(s212, t8) {
  if (s212.length != t8.length) return false;
  for (let e7 = 0; e7 < s212.length; e7++) if (!s212[e7].compare(t8[e7])) return false;
  return true;
}
var _r3 = y.define();
var Xr3 = y.define();
var St3 = y.define({ combine(s212) {
  return at(s212, { formatNumber: String, domEventHandlers: {} }, { domEventHandlers(t8, e7) {
    let i12 = Object.assign({}, t8);
    for (let n14 in e7) {
      let o = i12[n14], r2 = e7[n14];
      i12[n14] = o ? (l11, h3, c3) => o(l11, h3, c3) || r2(l11, h3, c3) : r2;
    }
    return i12;
  } });
} });
var qt3 = class extends J4 {
  constructor(t8) {
    super(), this.number = t8;
  }
  eq(t8) {
    return this.number == t8.number;
  }
  toDOM() {
    return document.createTextNode(this.number);
  }
};
function Ye5(s212, t8) {
  return s212.state.facet(St3).formatNumber(t8, s212.state);
}
var Gr3 = Kt4.compute([St3], (s212) => ({ class: "cm-lineNumbers", renderEmptyElements: false, markers(t8) {
  return t8.state.facet(_r3);
}, lineMarker(t8, e7, i12) {
  return i12.some((n14) => n14.toDOM) ? null : new qt3(Ye5(t8, t8.state.doc.lineAt(e7.from).number));
}, widgetMarker: (t8, e7, i12) => {
  for (let n14 of t8.state.facet(Xr3)) {
    let o = n14(t8, e7, i12);
    if (o) return o;
  }
  return null;
}, lineMarkerChange: (t8) => t8.startState.facet(St3) != t8.state.facet(St3), initialSpacer(t8) {
  return new qt3(Ye5(t8, Es3(t8.state.doc.lines)));
}, updateSpacer(t8, e7) {
  let i12 = Ye5(e7.view, Es3(e7.view.state.doc.lines));
  return i12 == t8.number ? t8 : new qt3(i12);
}, domEventHandlers: s212.facet(St3).domEventHandlers }));
function Es3(s212) {
  let t8 = 9;
  for (; t8 < s212; ) t8 = t8 * 10 + 9;
  return t8;
}
var $r3 = new class extends J4 {
  constructor() {
    super(...arguments), this.elementClass = "cm-activeLineGutter";
  }
}();
var Ur3 = we6.compute(["selection"], (s212) => {
  let t8 = [], e7 = -1;
  for (let i12 of s212.selection.ranges) {
    let n14 = s212.doc.lineAt(i12.head).from;
    n14 > e7 && (e7 = n14, t8.push($r3.range(n14)));
  }
  return T.of(t8);
});
function Yn2(s212) {
  return N6.define((t8) => ({ decorations: s212.createDeco(t8), update(e7) {
    this.decorations = s212.updateDeco(e7, this.decorations);
  } }), { decorations: (t8) => t8.decorations });
}
var Qr3 = O5.mark({ class: "cm-highlightTab" });
var Jr3 = O5.mark({ class: "cm-highlightSpace" });
var Zr3 = Yn2(new Jt4({ regexp: /\t| /g, decoration: (s212) => s212[0] == "	" ? Qr3 : Jr3, boundary: /\S/ }));
var tl3 = Yn2(new Jt4({ regexp: /\s+$/g, decoration: O5.mark({ class: "cm-trailingSpace" }), boundary: /\S/ }));

// https://esm.sh/v135/@lezer/common@1.2.3/denonext/common.mjs
var ze6 = 0;
var b3 = class {
  constructor(e7 = {}) {
    this.id = ze6++, this.perNode = !!e7.perNode, this.deserialize = e7.deserialize || (() => {
      throw new Error("This node type doesn't define a deserialize function");
    });
  }
  add(e7) {
    if (this.perNode) throw new RangeError("Can't add per-node props to node types");
    return typeof e7 != "function" && (e7 = F8.match(e7)), (t8) => {
      let r2 = e7(t8);
      return r2 === void 0 ? null : [this, r2];
    };
  }
};
b3.closedBy = new b3({ deserialize: (s212) => s212.split(" ") });
b3.openedBy = new b3({ deserialize: (s212) => s212.split(" ") });
b3.group = new b3({ deserialize: (s212) => s212.split(" ") });
b3.isolate = new b3({ deserialize: (s212) => {
  if (s212 && s212 != "rtl" && s212 != "ltr" && s212 != "auto") throw new RangeError("Invalid value for isolate: " + s212);
  return s212 || "auto";
} });
b3.contextHash = new b3({ perNode: true });
b3.lookAhead = new b3({ perNode: true });
b3.mounted = new b3({ perNode: true });
var V7 = class {
  constructor(e7, t8, r2) {
    this.tree = e7, this.overlay = t8, this.parser = r2;
  }
  static get(e7) {
    return e7 && e7.props && e7.props[b3.mounted.id];
  }
};
var Pe6 = /* @__PURE__ */ Object.create(null);
var F8 = class s108 {
  constructor(e7, t8, r2, n14 = 0) {
    this.name = e7, this.props = t8, this.id = r2, this.flags = n14;
  }
  static define(e7) {
    let t8 = e7.props && e7.props.length ? /* @__PURE__ */ Object.create(null) : Pe6, r2 = (e7.top ? 1 : 0) | (e7.skipped ? 2 : 0) | (e7.error ? 4 : 0) | (e7.name == null ? 8 : 0), n14 = new s108(e7.name || "", t8, e7.id, r2);
    if (e7.props) {
      for (let i12 of e7.props) if (Array.isArray(i12) || (i12 = i12(n14)), i12) {
        if (i12[0].perNode) throw new RangeError("Can't store a per-node prop on a node type");
        t8[i12[0].id] = i12[1];
      }
    }
    return n14;
  }
  prop(e7) {
    return this.props[e7.id];
  }
  get isTop() {
    return (this.flags & 1) > 0;
  }
  get isSkipped() {
    return (this.flags & 2) > 0;
  }
  get isError() {
    return (this.flags & 4) > 0;
  }
  get isAnonymous() {
    return (this.flags & 8) > 0;
  }
  is(e7) {
    if (typeof e7 == "string") {
      if (this.name == e7) return true;
      let t8 = this.prop(b3.group);
      return t8 ? t8.indexOf(e7) > -1 : false;
    }
    return this.id == e7;
  }
  static match(e7) {
    let t8 = /* @__PURE__ */ Object.create(null);
    for (let r2 in e7) for (let n14 of r2.split(" ")) t8[n14] = e7[r2];
    return (r2) => {
      for (let n14 = r2.prop(b3.group), i12 = -1; i12 < (n14 ? n14.length : 0); i12++) {
        let l11 = t8[i12 < 0 ? r2.name : n14[i12]];
        if (l11) return l11;
      }
    };
  }
};
F8.none = new F8("", /* @__PURE__ */ Object.create(null), 0, 8);
var Z4 = /* @__PURE__ */ new WeakMap();
var be7 = /* @__PURE__ */ new WeakMap();
var S5;
(function(s212) {
  s212[s212.ExcludeBuffers = 1] = "ExcludeBuffers", s212[s212.IncludeAnonymous = 2] = "IncludeAnonymous", s212[s212.IgnoreMounts = 4] = "IgnoreMounts", s212[s212.IgnoreOverlays = 8] = "IgnoreOverlays";
})(S5 || (S5 = {}));
var O6 = class s109 {
  constructor(e7, t8, r2, n14, i12) {
    if (this.type = e7, this.children = t8, this.positions = r2, this.length = n14, this.props = null, i12 && i12.length) {
      this.props = /* @__PURE__ */ Object.create(null);
      for (let [l11, f6] of i12) this.props[typeof l11 == "number" ? l11 : l11.id] = f6;
    }
  }
  toString() {
    let e7 = V7.get(this);
    if (e7 && !e7.overlay) return e7.tree.toString();
    let t8 = "";
    for (let r2 of this.children) {
      let n14 = r2.toString();
      n14 && (t8 && (t8 += ","), t8 += n14);
    }
    return this.type.name ? (/\W/.test(this.type.name) && !this.type.isError ? JSON.stringify(this.type.name) : this.type.name) + (t8.length ? "(" + t8 + ")" : "") : t8;
  }
  cursor(e7 = 0) {
    return new q4(this.topNode, e7);
  }
  cursorAt(e7, t8 = 0, r2 = 0) {
    let n14 = Z4.get(this) || this.topNode, i12 = new q4(n14);
    return i12.moveTo(e7, t8), Z4.set(this, i12._tree), i12;
  }
  get topNode() {
    return new P7(this, 0, 0, null);
  }
  resolve(e7, t8 = 0) {
    let r2 = Q7(Z4.get(this) || this.topNode, e7, t8, false);
    return Z4.set(this, r2), r2;
  }
  resolveInner(e7, t8 = 0) {
    let r2 = Q7(be7.get(this) || this.topNode, e7, t8, true);
    return be7.set(this, r2), r2;
  }
  resolveStack(e7, t8 = 0) {
    return Ee7(this, e7, t8);
  }
  iterate(e7) {
    let { enter: t8, leave: r2, from: n14 = 0, to: i12 = this.length } = e7, l11 = e7.mode || 0, f6 = (l11 & S5.IncludeAnonymous) > 0;
    for (let h3 = this.cursor(l11 | S5.IncludeAnonymous); ; ) {
      let u3 = false;
      if (h3.from <= i12 && h3.to >= n14 && (!f6 && h3.type.isAnonymous || t8(h3) !== false)) {
        if (h3.firstChild()) continue;
        u3 = true;
      }
      for (; u3 && r2 && (f6 || !h3.type.isAnonymous) && r2(h3), !h3.nextSibling(); ) {
        if (!h3.parent()) return;
        u3 = true;
      }
    }
  }
  prop(e7) {
    return e7.perNode ? this.props ? this.props[e7.id] : void 0 : this.type.prop(e7);
  }
  get propValues() {
    let e7 = [];
    if (this.props) for (let t8 in this.props) e7.push([+t8, this.props[t8]]);
    return e7;
  }
  balance(e7 = {}) {
    return this.children.length <= 8 ? this : ge6(F8.none, this.children, this.positions, 0, this.children.length, 0, this.length, (t8, r2, n14) => new s109(this.type, t8, r2, n14, this.propValues), e7.makeTree || ((t8, r2, n14) => new s109(F8.none, t8, r2, n14)));
  }
  static build(e7) {
    return Me5(e7);
  }
};
O6.empty = new O6(F8.none, [], [], 0);
var se3 = class s110 {
  constructor(e7, t8) {
    this.buffer = e7, this.index = t8;
  }
  get id() {
    return this.buffer[this.index - 4];
  }
  get start() {
    return this.buffer[this.index - 3];
  }
  get end() {
    return this.buffer[this.index - 2];
  }
  get size() {
    return this.buffer[this.index - 1];
  }
  get pos() {
    return this.index;
  }
  next() {
    this.index -= 4;
  }
  fork() {
    return new s110(this.buffer, this.index);
  }
};
var W6 = class s111 {
  constructor(e7, t8, r2) {
    this.buffer = e7, this.length = t8, this.set = r2;
  }
  get type() {
    return F8.none;
  }
  toString() {
    let e7 = [];
    for (let t8 = 0; t8 < this.buffer.length; ) e7.push(this.childString(t8)), t8 = this.buffer[t8 + 3];
    return e7.join(",");
  }
  childString(e7) {
    let t8 = this.buffer[e7], r2 = this.buffer[e7 + 3], n14 = this.set.types[t8], i12 = n14.name;
    if (/\W/.test(i12) && !n14.isError && (i12 = JSON.stringify(i12)), e7 += 4, r2 == e7) return i12;
    let l11 = [];
    for (; e7 < r2; ) l11.push(this.childString(e7)), e7 = this.buffer[e7 + 3];
    return i12 + "(" + l11.join(",") + ")";
  }
  findChild(e7, t8, r2, n14, i12) {
    let { buffer: l11 } = this, f6 = -1;
    for (let h3 = e7; h3 != t8 && !(Ne7(i12, n14, l11[h3 + 1], l11[h3 + 2]) && (f6 = h3, r2 > 0)); h3 = l11[h3 + 3]) ;
    return f6;
  }
  slice(e7, t8, r2) {
    let n14 = this.buffer, i12 = new Uint16Array(t8 - e7), l11 = 0;
    for (let f6 = e7, h3 = 0; f6 < t8; ) {
      i12[h3++] = n14[f6++], i12[h3++] = n14[f6++] - r2;
      let u3 = i12[h3++] = n14[f6++] - r2;
      i12[h3++] = n14[f6++] - e7, l11 = Math.max(l11, u3);
    }
    return new s111(i12, l11, this.set);
  }
};
function Ne7(s212, e7, t8, r2) {
  switch (s212) {
    case -2:
      return t8 < e7;
    case -1:
      return r2 >= e7 && t8 < e7;
    case 0:
      return t8 < e7 && r2 > e7;
    case 1:
      return t8 <= e7 && r2 > e7;
    case 2:
      return r2 > e7;
    case 4:
      return true;
  }
}
function Q7(s212, e7, t8, r2) {
  for (var n14; s212.from == s212.to || (t8 < 1 ? s212.from >= e7 : s212.from > e7) || (t8 > -1 ? s212.to <= e7 : s212.to < e7); ) {
    let l11 = !r2 && s212 instanceof P7 && s212.index < 0 ? null : s212.parent;
    if (!l11) return s212;
    s212 = l11;
  }
  let i12 = r2 ? 0 : S5.IgnoreOverlays;
  if (r2) for (let l11 = s212, f6 = l11.parent; f6; l11 = f6, f6 = l11.parent) l11 instanceof P7 && l11.index < 0 && ((n14 = f6.enter(e7, t8, i12)) === null || n14 === void 0 ? void 0 : n14.from) != l11.from && (s212 = f6);
  for (; ; ) {
    let l11 = s212.enter(e7, t8, i12);
    if (!l11) return s212;
    s212 = l11;
  }
}
var te7 = class {
  cursor(e7 = 0) {
    return new q4(this, e7);
  }
  getChild(e7, t8 = null, r2 = null) {
    let n14 = we7(this, e7, t8, r2);
    return n14.length ? n14[0] : null;
  }
  getChildren(e7, t8 = null, r2 = null) {
    return we7(this, e7, t8, r2);
  }
  resolve(e7, t8 = 0) {
    return Q7(this, e7, t8, false);
  }
  resolveInner(e7, t8 = 0) {
    return Q7(this, e7, t8, true);
  }
  matchContext(e7) {
    return le6(this.parent, e7);
  }
  enterUnfinishedNodesBefore(e7) {
    let t8 = this.childBefore(e7), r2 = this;
    for (; t8; ) {
      let n14 = t8.lastChild;
      if (!n14 || n14.to != t8.to) break;
      n14.type.isError && n14.from == n14.to ? (r2 = t8, t8 = n14.prevSibling) : t8 = n14;
    }
    return r2;
  }
  get node() {
    return this;
  }
  get next() {
    return this.parent;
  }
};
var P7 = class s112 extends te7 {
  constructor(e7, t8, r2, n14) {
    super(), this._tree = e7, this.from = t8, this.index = r2, this._parent = n14;
  }
  get type() {
    return this._tree.type;
  }
  get name() {
    return this._tree.type.name;
  }
  get to() {
    return this.from + this._tree.length;
  }
  nextChild(e7, t8, r2, n14, i12 = 0) {
    for (let l11 = this; ; ) {
      for (let { children: f6, positions: h3 } = l11._tree, u3 = t8 > 0 ? f6.length : -1; e7 != u3; e7 += t8) {
        let o = f6[e7], c3 = h3[e7] + l11.from;
        if (Ne7(n14, r2, c3, c3 + o.length)) {
          if (o instanceof W6) {
            if (i12 & S5.ExcludeBuffers) continue;
            let d4 = o.findChild(0, o.buffer.length, t8, r2 - c3, n14);
            if (d4 > -1) return new G8(new fe6(l11, o, e7, c3), null, d4);
          } else if (i12 & S5.IncludeAnonymous || !o.type.isAnonymous || ce7(o)) {
            let d4;
            if (!(i12 & S5.IgnoreMounts) && (d4 = V7.get(o)) && !d4.overlay) return new s112(d4.tree, c3, e7, l11);
            let y18 = new s112(o, c3, e7, l11);
            return i12 & S5.IncludeAnonymous || !y18.type.isAnonymous ? y18 : y18.nextChild(t8 < 0 ? o.children.length - 1 : 0, t8, r2, n14);
          }
        }
      }
      if (i12 & S5.IncludeAnonymous || !l11.type.isAnonymous || (l11.index >= 0 ? e7 = l11.index + t8 : e7 = t8 < 0 ? -1 : l11._parent._tree.children.length, l11 = l11._parent, !l11)) return null;
    }
  }
  get firstChild() {
    return this.nextChild(0, 1, 0, 4);
  }
  get lastChild() {
    return this.nextChild(this._tree.children.length - 1, -1, 0, 4);
  }
  childAfter(e7) {
    return this.nextChild(0, 1, e7, 2);
  }
  childBefore(e7) {
    return this.nextChild(this._tree.children.length - 1, -1, e7, -2);
  }
  enter(e7, t8, r2 = 0) {
    let n14;
    if (!(r2 & S5.IgnoreOverlays) && (n14 = V7.get(this._tree)) && n14.overlay) {
      let i12 = e7 - this.from;
      for (let { from: l11, to: f6 } of n14.overlay) if ((t8 > 0 ? l11 <= i12 : l11 < i12) && (t8 < 0 ? f6 >= i12 : f6 > i12)) return new s112(n14.tree, n14.overlay[0].from + this.from, -1, this);
    }
    return this.nextChild(0, 1, e7, t8, r2);
  }
  nextSignificantParent() {
    let e7 = this;
    for (; e7.type.isAnonymous && e7._parent; ) e7 = e7._parent;
    return e7;
  }
  get parent() {
    return this._parent ? this._parent.nextSignificantParent() : null;
  }
  get nextSibling() {
    return this._parent && this.index >= 0 ? this._parent.nextChild(this.index + 1, 1, 0, 4) : null;
  }
  get prevSibling() {
    return this._parent && this.index >= 0 ? this._parent.nextChild(this.index - 1, -1, 0, 4) : null;
  }
  get tree() {
    return this._tree;
  }
  toTree() {
    return this._tree;
  }
  toString() {
    return this._tree.toString();
  }
};
function we7(s212, e7, t8, r2) {
  let n14 = s212.cursor(), i12 = [];
  if (!n14.firstChild()) return i12;
  if (t8 != null) {
    for (let l11 = false; !l11; ) if (l11 = n14.type.is(t8), !n14.nextSibling()) return i12;
  }
  for (; ; ) {
    if (r2 != null && n14.type.is(r2)) return i12;
    if (n14.type.is(e7) && i12.push(n14.node), !n14.nextSibling()) return r2 == null ? i12 : [];
  }
}
function le6(s212, e7, t8 = e7.length - 1) {
  for (let r2 = s212; t8 >= 0; r2 = r2.parent) {
    if (!r2) return false;
    if (!r2.type.isAnonymous) {
      if (e7[t8] && e7[t8] != r2.name) return false;
      t8--;
    }
  }
  return true;
}
var fe6 = class {
  constructor(e7, t8, r2, n14) {
    this.parent = e7, this.buffer = t8, this.index = r2, this.start = n14;
  }
};
var G8 = class s113 extends te7 {
  get name() {
    return this.type.name;
  }
  get from() {
    return this.context.start + this.context.buffer.buffer[this.index + 1];
  }
  get to() {
    return this.context.start + this.context.buffer.buffer[this.index + 2];
  }
  constructor(e7, t8, r2) {
    super(), this.context = e7, this._parent = t8, this.index = r2, this.type = e7.buffer.set.types[e7.buffer.buffer[r2]];
  }
  child(e7, t8, r2) {
    let { buffer: n14 } = this.context, i12 = n14.findChild(this.index + 4, n14.buffer[this.index + 3], e7, t8 - this.context.start, r2);
    return i12 < 0 ? null : new s113(this.context, this, i12);
  }
  get firstChild() {
    return this.child(1, 0, 4);
  }
  get lastChild() {
    return this.child(-1, 0, 4);
  }
  childAfter(e7) {
    return this.child(1, e7, 2);
  }
  childBefore(e7) {
    return this.child(-1, e7, -2);
  }
  enter(e7, t8, r2 = 0) {
    if (r2 & S5.ExcludeBuffers) return null;
    let { buffer: n14 } = this.context, i12 = n14.findChild(this.index + 4, n14.buffer[this.index + 3], t8 > 0 ? 1 : -1, e7 - this.context.start, t8);
    return i12 < 0 ? null : new s113(this.context, this, i12);
  }
  get parent() {
    return this._parent || this.context.parent.nextSignificantParent();
  }
  externalSibling(e7) {
    return this._parent ? null : this.context.parent.nextChild(this.context.index + e7, e7, 0, 4);
  }
  get nextSibling() {
    let { buffer: e7 } = this.context, t8 = e7.buffer[this.index + 3];
    return t8 < (this._parent ? e7.buffer[this._parent.index + 3] : e7.buffer.length) ? new s113(this.context, this._parent, t8) : this.externalSibling(1);
  }
  get prevSibling() {
    let { buffer: e7 } = this.context, t8 = this._parent ? this._parent.index + 4 : 0;
    return this.index == t8 ? this.externalSibling(-1) : new s113(this.context, this._parent, e7.findChild(t8, this.index, -1, 0, 4));
  }
  get tree() {
    return null;
  }
  toTree() {
    let e7 = [], t8 = [], { buffer: r2 } = this.context, n14 = this.index + 4, i12 = r2.buffer[this.index + 3];
    if (i12 > n14) {
      let l11 = r2.buffer[this.index + 1];
      e7.push(r2.slice(n14, i12, l11)), t8.push(0);
    }
    return new O6(this.type, e7, t8, this.to - this.from);
  }
  toString() {
    return this.context.buffer.childString(this.index);
  }
};
function Be6(s212) {
  if (!s212.length) return null;
  let e7 = 0, t8 = s212[0];
  for (let i12 = 1; i12 < s212.length; i12++) {
    let l11 = s212[i12];
    (l11.from > t8.from || l11.to < t8.to) && (t8 = l11, e7 = i12);
  }
  let r2 = t8 instanceof P7 && t8.index < 0 ? null : t8.parent, n14 = s212.slice();
  return r2 ? n14[e7] = r2 : n14.splice(e7, 1), new he5(n14, t8);
}
var he5 = class {
  constructor(e7, t8) {
    this.heads = e7, this.node = t8;
  }
  get next() {
    return Be6(this.heads);
  }
};
function Ee7(s212, e7, t8) {
  let r2 = s212.resolveInner(e7, t8), n14 = null;
  for (let i12 = r2 instanceof P7 ? r2 : r2.context.parent; i12; i12 = i12.parent) if (i12.index < 0) {
    let l11 = i12.parent;
    (n14 || (n14 = [r2])).push(l11.resolve(e7, t8)), i12 = l11;
  } else {
    let l11 = V7.get(i12.tree);
    if (l11 && l11.overlay && l11.overlay[0].from <= e7 && l11.overlay[l11.overlay.length - 1].to >= e7) {
      let f6 = new P7(l11.tree, l11.overlay[0].from + i12.from, -1, i12);
      (n14 || (n14 = [r2])).push(Q7(f6, e7, t8, false));
    }
  }
  return n14 ? Be6(n14) : r2;
}
var q4 = class {
  get name() {
    return this.type.name;
  }
  constructor(e7, t8 = 0) {
    if (this.mode = t8, this.buffer = null, this.stack = [], this.index = 0, this.bufferNode = null, e7 instanceof P7) this.yieldNode(e7);
    else {
      this._tree = e7.context.parent, this.buffer = e7.context;
      for (let r2 = e7._parent; r2; r2 = r2._parent) this.stack.unshift(r2.index);
      this.bufferNode = e7, this.yieldBuf(e7.index);
    }
  }
  yieldNode(e7) {
    return e7 ? (this._tree = e7, this.type = e7.type, this.from = e7.from, this.to = e7.to, true) : false;
  }
  yieldBuf(e7, t8) {
    this.index = e7;
    let { start: r2, buffer: n14 } = this.buffer;
    return this.type = t8 || n14.set.types[n14.buffer[e7]], this.from = r2 + n14.buffer[e7 + 1], this.to = r2 + n14.buffer[e7 + 2], true;
  }
  yield(e7) {
    return e7 ? e7 instanceof P7 ? (this.buffer = null, this.yieldNode(e7)) : (this.buffer = e7.context, this.yieldBuf(e7.index, e7.type)) : false;
  }
  toString() {
    return this.buffer ? this.buffer.buffer.childString(this.index) : this._tree.toString();
  }
  enterChild(e7, t8, r2) {
    if (!this.buffer) return this.yield(this._tree.nextChild(e7 < 0 ? this._tree._tree.children.length - 1 : 0, e7, t8, r2, this.mode));
    let { buffer: n14 } = this.buffer, i12 = n14.findChild(this.index + 4, n14.buffer[this.index + 3], e7, t8 - this.buffer.start, r2);
    return i12 < 0 ? false : (this.stack.push(this.index), this.yieldBuf(i12));
  }
  firstChild() {
    return this.enterChild(1, 0, 4);
  }
  lastChild() {
    return this.enterChild(-1, 0, 4);
  }
  childAfter(e7) {
    return this.enterChild(1, e7, 2);
  }
  childBefore(e7) {
    return this.enterChild(-1, e7, -2);
  }
  enter(e7, t8, r2 = this.mode) {
    return this.buffer ? r2 & S5.ExcludeBuffers ? false : this.enterChild(1, e7, t8) : this.yield(this._tree.enter(e7, t8, r2));
  }
  parent() {
    if (!this.buffer) return this.yieldNode(this.mode & S5.IncludeAnonymous ? this._tree._parent : this._tree.parent);
    if (this.stack.length) return this.yieldBuf(this.stack.pop());
    let e7 = this.mode & S5.IncludeAnonymous ? this.buffer.parent : this.buffer.parent.nextSignificantParent();
    return this.buffer = null, this.yieldNode(e7);
  }
  sibling(e7) {
    if (!this.buffer) return this._tree._parent ? this.yield(this._tree.index < 0 ? null : this._tree._parent.nextChild(this._tree.index + e7, e7, 0, 4, this.mode)) : false;
    let { buffer: t8 } = this.buffer, r2 = this.stack.length - 1;
    if (e7 < 0) {
      let n14 = r2 < 0 ? 0 : this.stack[r2] + 4;
      if (this.index != n14) return this.yieldBuf(t8.findChild(n14, this.index, -1, 0, 4));
    } else {
      let n14 = t8.buffer[this.index + 3];
      if (n14 < (r2 < 0 ? t8.buffer.length : t8.buffer[this.stack[r2] + 3])) return this.yieldBuf(n14);
    }
    return r2 < 0 ? this.yield(this.buffer.parent.nextChild(this.buffer.index + e7, e7, 0, 4, this.mode)) : false;
  }
  nextSibling() {
    return this.sibling(1);
  }
  prevSibling() {
    return this.sibling(-1);
  }
  atLastNode(e7) {
    let t8, r2, { buffer: n14 } = this;
    if (n14) {
      if (e7 > 0) {
        if (this.index < n14.buffer.buffer.length) return false;
      } else for (let i12 = 0; i12 < this.index; i12++) if (n14.buffer.buffer[i12 + 3] < this.index) return false;
      ({ index: t8, parent: r2 } = n14);
    } else ({ index: t8, _parent: r2 } = this._tree);
    for (; r2; { index: t8, _parent: r2 } = r2) if (t8 > -1) for (let i12 = t8 + e7, l11 = e7 < 0 ? -1 : r2._tree.children.length; i12 != l11; i12 += e7) {
      let f6 = r2._tree.children[i12];
      if (this.mode & S5.IncludeAnonymous || f6 instanceof W6 || !f6.type.isAnonymous || ce7(f6)) return false;
    }
    return true;
  }
  move(e7, t8) {
    if (t8 && this.enterChild(e7, 0, 4)) return true;
    for (; ; ) {
      if (this.sibling(e7)) return true;
      if (this.atLastNode(e7) || !this.parent()) return false;
    }
  }
  next(e7 = true) {
    return this.move(1, e7);
  }
  prev(e7 = true) {
    return this.move(-1, e7);
  }
  moveTo(e7, t8 = 0) {
    for (; (this.from == this.to || (t8 < 1 ? this.from >= e7 : this.from > e7) || (t8 > -1 ? this.to <= e7 : this.to < e7)) && this.parent(); ) ;
    for (; this.enterChild(1, e7, t8); ) ;
    return this;
  }
  get node() {
    if (!this.buffer) return this._tree;
    let e7 = this.bufferNode, t8 = null, r2 = 0;
    if (e7 && e7.context == this.buffer) e: for (let n14 = this.index, i12 = this.stack.length; i12 >= 0; ) {
      for (let l11 = e7; l11; l11 = l11._parent) if (l11.index == n14) {
        if (n14 == this.index) return l11;
        t8 = l11, r2 = i12 + 1;
        break e;
      }
      n14 = this.stack[--i12];
    }
    for (let n14 = r2; n14 < this.stack.length; n14++) t8 = new G8(this.buffer, t8, this.stack[n14]);
    return this.bufferNode = new G8(this.buffer, t8, this.index);
  }
  get tree() {
    return this.buffer ? null : this._tree._tree;
  }
  iterate(e7, t8) {
    for (let r2 = 0; ; ) {
      let n14 = false;
      if (this.type.isAnonymous || e7(this) !== false) {
        if (this.firstChild()) {
          r2++;
          continue;
        }
        this.type.isAnonymous || (n14 = true);
      }
      for (; ; ) {
        if (n14 && t8 && t8(this), n14 = this.type.isAnonymous, !r2) return;
        if (this.nextSibling()) break;
        this.parent(), r2--, n14 = true;
      }
    }
  }
  matchContext(e7) {
    if (!this.buffer) return le6(this.node.parent, e7);
    let { buffer: t8 } = this.buffer, { types: r2 } = t8.set;
    for (let n14 = e7.length - 1, i12 = this.stack.length - 1; n14 >= 0; i12--) {
      if (i12 < 0) return le6(this._tree, e7, n14);
      let l11 = r2[t8.buffer[this.stack[i12]]];
      if (!l11.isAnonymous) {
        if (e7[n14] && e7[n14] != l11.name) return false;
        n14--;
      }
    }
    return true;
  }
};
function ce7(s212) {
  return s212.children.some((e7) => e7 instanceof W6 || !e7.type.isAnonymous || ce7(e7));
}
function Me5(s212) {
  var e7;
  let { buffer: t8, nodeSet: r2, maxBufferLength: n14 = 1024, reused: i12 = [], minRepeatType: l11 = r2.types.length } = s212, f6 = Array.isArray(t8) ? new se3(t8, t8.length) : t8, h3 = r2.types, u3 = 0, o = 0;
  function c3(m11, v10, a2, A18, x11, C11) {
    let { id: g8, start: p3, end: w14, size: k16 } = f6, N23 = o, U21 = u3;
    for (; k16 < 0; ) if (f6.next(), k16 == -1) {
      let L19 = i12[g8];
      a2.push(L19), A18.push(p3 - m11);
      return;
    } else if (k16 == -3) {
      u3 = g8;
      return;
    } else if (k16 == -4) {
      o = g8;
      return;
    } else throw new RangeError(`Unrecognized record size: ${k16}`);
    let K16 = h3[g8], X19, H12, me19 = p3 - m11;
    if (w14 - p3 <= n14 && (H12 = T22(f6.pos - v10, x11))) {
      let L19 = new Uint16Array(H12.size - H12.skip), M12 = f6.pos - H12.size, D14 = L19.length;
      for (; f6.pos > M12; ) D14 = j19(H12.start, L19, D14);
      X19 = new W6(L19, w14 - H12.start, r2), me19 = H12.start - m11;
    } else {
      let L19 = f6.pos - k16;
      f6.next();
      let M12 = [], D14 = [], J15 = g8 >= l11 ? g8 : -1, $18 = 0, Y23 = w14;
      for (; f6.pos > L19; ) J15 >= 0 && f6.id == J15 && f6.size >= 0 ? (f6.end <= Y23 - n14 && (_18(M12, D14, p3, $18, f6.end, Y23, J15, N23, U21), $18 = M12.length, Y23 = f6.end), f6.next()) : C11 > 2500 ? d4(p3, L19, M12, D14) : c3(p3, L19, M12, D14, J15, C11 + 1);
      if (J15 >= 0 && $18 > 0 && $18 < M12.length && _18(M12, D14, p3, $18, p3, Y23, J15, N23, U21), M12.reverse(), D14.reverse(), J15 > -1 && $18 > 0) {
        let ye14 = y18(K16, U21);
        X19 = ge6(K16, M12, D14, 0, M12.length, 0, w14 - p3, ye14, ye14);
      } else X19 = B15(K16, M12, D14, w14 - p3, N23 - w14, U21);
    }
    a2.push(X19), A18.push(me19);
  }
  function d4(m11, v10, a2, A18) {
    let x11 = [], C11 = 0, g8 = -1;
    for (; f6.pos > v10; ) {
      let { id: p3, start: w14, end: k16, size: N23 } = f6;
      if (N23 > 4) f6.next();
      else {
        if (g8 > -1 && w14 < g8) break;
        g8 < 0 && (g8 = k16 - n14), x11.push(p3, w14, k16), C11++, f6.next();
      }
    }
    if (C11) {
      let p3 = new Uint16Array(C11 * 4), w14 = x11[x11.length - 2];
      for (let k16 = x11.length - 3, N23 = 0; k16 >= 0; k16 -= 3) p3[N23++] = x11[k16], p3[N23++] = x11[k16 + 1] - w14, p3[N23++] = x11[k16 + 2] - w14, p3[N23++] = N23;
      a2.push(new W6(p3, x11[2] - w14, r2)), A18.push(w14 - m11);
    }
  }
  function y18(m11, v10) {
    return (a2, A18, x11) => {
      let C11 = 0, g8 = a2.length - 1, p3, w14;
      if (g8 >= 0 && (p3 = a2[g8]) instanceof O6) {
        if (!g8 && p3.type == m11 && p3.length == x11) return p3;
        (w14 = p3.prop(b3.lookAhead)) && (C11 = A18[g8] + p3.length + w14);
      }
      return B15(m11, a2, A18, x11, C11, v10);
    };
  }
  function _18(m11, v10, a2, A18, x11, C11, g8, p3, w14) {
    let k16 = [], N23 = [];
    for (; m11.length > A18; ) k16.push(m11.pop()), N23.push(v10.pop() + a2 - x11);
    m11.push(B15(r2.types[g8], k16, N23, C11 - x11, p3 - C11, w14)), v10.push(x11 - a2);
  }
  function B15(m11, v10, a2, A18, x11, C11, g8) {
    if (C11) {
      let p3 = [b3.contextHash, C11];
      g8 = g8 ? [p3].concat(g8) : [p3];
    }
    if (x11 > 25) {
      let p3 = [b3.lookAhead, x11];
      g8 = g8 ? [p3].concat(g8) : [p3];
    }
    return new O6(m11, v10, a2, A18, g8);
  }
  function T22(m11, v10) {
    let a2 = f6.fork(), A18 = 0, x11 = 0, C11 = 0, g8 = a2.end - n14, p3 = { size: 0, start: 0, skip: 0 };
    e: for (let w14 = a2.pos - m11; a2.pos > w14; ) {
      let k16 = a2.size;
      if (a2.id == v10 && k16 >= 0) {
        p3.size = A18, p3.start = x11, p3.skip = C11, C11 += 4, A18 += 4, a2.next();
        continue;
      }
      let N23 = a2.pos - k16;
      if (k16 < 0 || N23 < w14 || a2.start < g8) break;
      let U21 = a2.id >= l11 ? 4 : 0, K16 = a2.start;
      for (a2.next(); a2.pos > N23; ) {
        if (a2.size < 0) if (a2.size == -3) U21 += 4;
        else break e;
        else a2.id >= l11 && (U21 += 4);
        a2.next();
      }
      x11 = K16, A18 += k16, C11 += U21;
    }
    return (v10 < 0 || A18 == m11) && (p3.size = A18, p3.start = x11, p3.skip = C11), p3.size > 4 ? p3 : void 0;
  }
  function j19(m11, v10, a2) {
    let { id: A18, start: x11, end: C11, size: g8 } = f6;
    if (f6.next(), g8 >= 0 && A18 < l11) {
      let p3 = a2;
      if (g8 > 4) {
        let w14 = f6.pos - (g8 - 4);
        for (; f6.pos > w14; ) a2 = j19(m11, v10, a2);
      }
      v10[--a2] = p3, v10[--a2] = C11 - m11, v10[--a2] = x11 - m11, v10[--a2] = A18;
    } else g8 == -3 ? u3 = A18 : g8 == -4 && (o = A18);
    return a2;
  }
  let E11 = [], I22 = [];
  for (; f6.pos > 0; ) c3(s212.start || 0, s212.bufferStart || 0, E11, I22, -1, 0);
  let R19 = (e7 = s212.length) !== null && e7 !== void 0 ? e7 : E11.length ? I22[0] + E11[0].length : 0;
  return new O6(h3[s212.topID], E11.reverse(), I22.reverse(), R19);
}
var ve5 = /* @__PURE__ */ new WeakMap();
function ee4(s212, e7) {
  if (!s212.isAnonymous || e7 instanceof W6 || e7.type != s212) return 1;
  let t8 = ve5.get(e7);
  if (t8 == null) {
    t8 = 1;
    for (let r2 of e7.children) {
      if (r2.type != s212 || !(r2 instanceof O6)) {
        t8 = 1;
        break;
      }
      t8 += ee4(s212, r2);
    }
    ve5.set(e7, t8);
  }
  return t8;
}
function ge6(s212, e7, t8, r2, n14, i12, l11, f6, h3) {
  let u3 = 0;
  for (let _18 = r2; _18 < n14; _18++) u3 += ee4(s212, e7[_18]);
  let o = Math.ceil(u3 * 1.5 / 8), c3 = [], d4 = [];
  function y18(_18, B15, T22, j19, E11) {
    for (let I22 = T22; I22 < j19; ) {
      let R19 = I22, m11 = B15[I22], v10 = ee4(s212, _18[I22]);
      for (I22++; I22 < j19; I22++) {
        let a2 = ee4(s212, _18[I22]);
        if (v10 + a2 >= o) break;
        v10 += a2;
      }
      if (I22 == R19 + 1) {
        if (v10 > o) {
          let a2 = _18[R19];
          y18(a2.children, a2.positions, 0, a2.children.length, B15[R19] + E11);
          continue;
        }
        c3.push(_18[R19]);
      } else {
        let a2 = B15[I22 - 1] + _18[I22 - 1].length - m11;
        c3.push(ge6(s212, _18, B15, R19, I22, m11, a2, null, h3));
      }
      d4.push(m11 + E11 - i12);
    }
  }
  return y18(e7, t8, r2, n14, 0), (f6 || h3)(c3, d4, l11);
}
var ae5 = new b3({ perNode: true });

// https://esm.sh/v135/@codemirror/commands@6.7.1/denonext/commands.mjs
var lt5 = (e7) => {
  let { state: t8 } = e7, r2 = t8.doc.lineAt(t8.selection.main.from), n14 = ne6(e7.state, r2.from);
  return n14.line ? ct(e7) : n14.block ? it3(e7) : false;
};
function x4(e7, t8) {
  return ({ state: r2, dispatch: n14 }) => {
    if (r2.readOnly) return false;
    let l11 = e7(t8, r2);
    return l11 ? (n14(r2.update(l11)), true) : false;
  };
}
var ct = x4(re5, 0);
var pn4 = x4(re5, 1);
var gn4 = x4(re5, 2);
var st6 = x4(V8, 0);
var yn4 = x4(V8, 1);
var kn4 = x4(V8, 2);
var it3 = x4((e7, t8) => V8(e7, t8, ft2(t8)), 0);
function ne6(e7, t8) {
  let r2 = e7.languageDataAt("commentTokens", t8);
  return r2.length ? r2[0] : {};
}
var R6 = 50;
function ut4(e7, { open: t8, close: r2 }, n14, l11) {
  let o = e7.sliceDoc(n14 - R6, n14), c3 = e7.sliceDoc(l11, l11 + R6), s212 = /\s*$/.exec(o)[0].length, i12 = /^\s*/.exec(c3)[0].length, f6 = o.length - s212;
  if (o.slice(f6 - t8.length, f6) == t8 && c3.slice(i12, i12 + r2.length) == r2) return { open: { pos: n14 - s212, margin: s212 && 1 }, close: { pos: l11 + i12, margin: i12 && 1 } };
  let u3, a2;
  l11 - n14 <= 2 * R6 ? u3 = a2 = e7.sliceDoc(n14, l11) : (u3 = e7.sliceDoc(n14, n14 + R6), a2 = e7.sliceDoc(l11 - R6, l11));
  let d4 = /^\s*/.exec(u3)[0].length, B15 = /\s*$/.exec(a2)[0].length, g8 = a2.length - B15 - r2.length;
  return u3.slice(d4, d4 + t8.length) == t8 && a2.slice(g8, g8 + r2.length) == r2 ? { open: { pos: n14 + d4 + t8.length, margin: /\s/.test(u3.charAt(d4 + t8.length)) ? 1 : 0 }, close: { pos: l11 - B15 - r2.length, margin: /\s/.test(a2.charAt(g8 - 1)) ? 1 : 0 } } : null;
}
function ft2(e7) {
  let t8 = [];
  for (let r2 of e7.selection.ranges) {
    let n14 = e7.doc.lineAt(r2.from), l11 = r2.to <= n14.to ? n14 : e7.doc.lineAt(r2.to);
    l11.from > n14.from && l11.from == r2.to && (l11 = r2.to == n14.to + 1 ? n14 : e7.doc.lineAt(r2.to - 1));
    let o = t8.length - 1;
    o >= 0 && t8[o].to > n14.from ? t8[o].to = l11.to : t8.push({ from: n14.from + /^\s*/.exec(n14.text)[0].length, to: l11.to });
  }
  return t8;
}
function V8(e7, t8, r2 = t8.selection.ranges) {
  let n14 = r2.map((o) => ne6(t8, o.from).block);
  if (!n14.every((o) => o)) return null;
  let l11 = r2.map((o, c3) => ut4(t8, n14[c3], o.from, o.to));
  if (e7 != 2 && !l11.every((o) => o)) return { changes: t8.changes(r2.map((o, c3) => l11[c3] ? [] : [{ from: o.from, insert: n14[c3].open + " " }, { from: o.to, insert: " " + n14[c3].close }])) };
  if (e7 != 1 && l11.some((o) => o)) {
    let o = [];
    for (let c3 = 0, s212; c3 < l11.length; c3++) if (s212 = l11[c3]) {
      let i12 = n14[c3], { open: f6, close: u3 } = s212;
      o.push({ from: f6.pos - i12.open.length, to: f6.pos + f6.margin }, { from: u3.pos - u3.margin, to: u3.pos + i12.close.length });
    }
    return { changes: o };
  }
  return null;
}
function re5(e7, t8, r2 = t8.selection.ranges) {
  let n14 = [], l11 = -1;
  for (let { from: o, to: c3 } of r2) {
    let s212 = n14.length, i12 = 1e9, f6 = ne6(t8, o).line;
    if (f6) {
      for (let u3 = o; u3 <= c3; ) {
        let a2 = t8.doc.lineAt(u3);
        if (a2.from > l11 && (o == c3 || c3 > a2.from)) {
          l11 = a2.from;
          let d4 = /^\s*/.exec(a2.text)[0].length, B15 = d4 == a2.length, g8 = a2.text.slice(d4, d4 + f6.length) == f6 ? d4 : -1;
          d4 < a2.text.length && d4 < i12 && (i12 = d4), n14.push({ line: a2, comment: g8, token: f6, indent: d4, empty: B15, single: false });
        }
        u3 = a2.to + 1;
      }
      if (i12 < 1e9) for (let u3 = s212; u3 < n14.length; u3++) n14[u3].indent < n14[u3].line.text.length && (n14[u3].indent = i12);
      n14.length == s212 + 1 && (n14[s212].single = true);
    }
  }
  if (e7 != 2 && n14.some((o) => o.comment < 0 && (!o.empty || o.single))) {
    let o = [];
    for (let { line: s212, token: i12, indent: f6, empty: u3, single: a2 } of n14) (a2 || !u3) && o.push({ from: s212.from + f6, insert: i12 + " " });
    let c3 = t8.changes(o);
    return { changes: c3, selection: t8.selection.map(c3, 1) };
  } else if (e7 != 1 && n14.some((o) => o.comment >= 0)) {
    let o = [];
    for (let { line: c3, comment: s212, token: i12 } of n14) if (s212 >= 0) {
      let f6 = c3.from + s212, u3 = f6 + i12.length;
      c3.text[u3 - c3.from] == " " && u3++, o.push({ from: f6, to: u3 });
    }
    return { changes: o };
  }
  return null;
}
var Y8 = J.define();
var at6 = J.define();
var ht5 = y.define();
var Le6 = y.define({ combine(e7) {
  return at(e7, { minDepth: 100, newGroupDelay: 500, joinToEvent: (t8, r2) => r2 }, { minDepth: Math.max, newGroupDelay: Math.min, joinToEvent: (t8, r2) => (n14, l11) => t8(n14, l11) || r2(n14, l11) });
} });
var G9 = z.define({ create() {
  return L6.empty;
}, update(e7, t8) {
  let r2 = t8.state.facet(Le6), n14 = t8.annotation(Y8);
  if (n14) {
    let i12 = A6.fromTransaction(t8, n14.selection), f6 = n14.side, u3 = f6 == 0 ? e7.undone : e7.done;
    return i12 ? u3 = N7(u3, u3.length, r2.minDepth, i12) : u3 = be8(u3, t8.startState.selection), new L6(f6 == 0 ? n14.rest : u3, f6 == 0 ? u3 : n14.rest);
  }
  let l11 = t8.annotation(at6);
  if ((l11 == "full" || l11 == "before") && (e7 = e7.isolate()), t8.annotation(S.addToHistory) === false) return t8.changes.empty ? e7 : e7.addMapping(t8.changes.desc);
  let o = A6.fromTransaction(t8), c3 = t8.annotation(S.time), s212 = t8.annotation(S.userEvent);
  return o ? e7 = e7.addChanges(o, c3, s212, r2, t8) : t8.selection && (e7 = e7.addSelection(t8.startState.selection, c3, s212, r2.newGroupDelay)), (l11 == "full" || l11 == "after") && (e7 = e7.isolate()), e7;
}, toJSON(e7) {
  return { done: e7.done.map((t8) => t8.toJSON()), undone: e7.undone.map((t8) => t8.toJSON()) };
}, fromJSON(e7) {
  return new L6(e7.done.map(A6.fromJSON), e7.undone.map(A6.fromJSON));
} });
function P8(e7, t8) {
  return function({ state: r2, dispatch: n14 }) {
    if (!t8 && r2.readOnly) return false;
    let l11 = r2.field(G9, false);
    if (!l11) return false;
    let o = l11.pop(e7, r2, t8);
    return o ? (n14(o), true) : false;
  };
}
var xe7 = P8(0, false);
var Z5 = P8(1, false);
var dt5 = P8(0, true);
var mt5 = P8(1, true);
function De5(e7) {
  return function(t8) {
    let r2 = t8.field(G9, false);
    if (!r2) return 0;
    let n14 = e7 == 0 ? r2.done : r2.undone;
    return n14.length - (n14.length && !n14[0].changes ? 1 : 0);
  };
}
var Sn5 = De5(0);
var Cn4 = De5(1);
var A6 = class e2 {
  constructor(t8, r2, n14, l11, o) {
    this.changes = t8, this.effects = r2, this.mapped = n14, this.startSelection = l11, this.selectionsAfter = o;
  }
  setSelAfter(t8) {
    return new e2(this.changes, this.effects, this.mapped, this.startSelection, t8);
  }
  toJSON() {
    var t8, r2, n14;
    return { changes: (t8 = this.changes) === null || t8 === void 0 ? void 0 : t8.toJSON(), mapped: (r2 = this.mapped) === null || r2 === void 0 ? void 0 : r2.toJSON(), startSelection: (n14 = this.startSelection) === null || n14 === void 0 ? void 0 : n14.toJSON(), selectionsAfter: this.selectionsAfter.map((l11) => l11.toJSON()) };
  }
  static fromJSON(t8) {
    return new e2(t8.changes && A.fromJSON(t8.changes), [], t8.mapped && C.fromJSON(t8.mapped), t8.startSelection && x.fromJSON(t8.startSelection), t8.selectionsAfter.map(x.fromJSON));
  }
  static fromTransaction(t8, r2) {
    let n14 = k4;
    for (let l11 of t8.startState.facet(ht5)) {
      let o = l11(t8);
      o.length && (n14 = n14.concat(o));
    }
    return !n14.length && t8.changes.empty ? null : new e2(t8.changes.invert(t8.startState.doc), n14, void 0, r2 || t8.startState.selection, k4);
  }
  static selection(t8) {
    return new e2(void 0, k4, void 0, void 0, t8);
  }
};
function N7(e7, t8, r2, n14) {
  let l11 = t8 + 1 > r2 + 20 ? t8 - r2 - 1 : 0, o = e7.slice(l11, t8);
  return o.push(n14), o;
}
function pt4(e7, t8) {
  let r2 = [], n14 = false;
  return e7.iterChangedRanges((l11, o) => r2.push(l11, o)), t8.iterChangedRanges((l11, o, c3, s212) => {
    for (let i12 = 0; i12 < r2.length; ) {
      let f6 = r2[i12++], u3 = r2[i12++];
      s212 >= f6 && c3 <= u3 && (n14 = true);
    }
  }), n14;
}
function gt4(e7, t8) {
  return e7.ranges.length == t8.ranges.length && e7.ranges.filter((r2, n14) => r2.empty != t8.ranges[n14].empty).length === 0;
}
function Me6(e7, t8) {
  return e7.length ? t8.length ? e7.concat(t8) : e7 : t8;
}
var k4 = [];
var yt4 = 200;
function be8(e7, t8) {
  if (e7.length) {
    let r2 = e7[e7.length - 1], n14 = r2.selectionsAfter.slice(Math.max(0, r2.selectionsAfter.length - yt4));
    return n14.length && n14[n14.length - 1].eq(t8) ? e7 : (n14.push(t8), N7(e7, e7.length - 1, 1e9, r2.setSelAfter(n14)));
  } else return [A6.selection([t8])];
}
function kt2(e7) {
  let t8 = e7[e7.length - 1], r2 = e7.slice();
  return r2[e7.length - 1] = t8.setSelAfter(t8.selectionsAfter.slice(0, t8.selectionsAfter.length - 1)), r2;
}
function $5(e7, t8) {
  if (!e7.length) return e7;
  let r2 = e7.length, n14 = k4;
  for (; r2; ) {
    let l11 = Bt4(e7[r2 - 1], t8, n14);
    if (l11.changes && !l11.changes.empty || l11.effects.length) {
      let o = e7.slice(0, r2);
      return o[r2 - 1] = l11, o;
    } else t8 = l11.mapped, r2--, n14 = l11.selectionsAfter;
  }
  return n14.length ? [A6.selection(n14)] : k4;
}
function Bt4(e7, t8, r2) {
  let n14 = Me6(e7.selectionsAfter.length ? e7.selectionsAfter.map((s212) => s212.map(t8)) : k4, r2);
  if (!e7.changes) return A6.selection(n14);
  let l11 = e7.changes.map(t8), o = t8.mapDesc(e7.changes, true), c3 = e7.mapped ? e7.mapped.composeDesc(o) : o;
  return new A6(l11, v.mapEffects(e7.effects, t8), c3, e7.startSelection.map(o), n14);
}
var At5 = /^(input\.type|delete)($|\.)/;
var L6 = class e3 {
  constructor(t8, r2, n14 = 0, l11 = void 0) {
    this.done = t8, this.undone = r2, this.prevTime = n14, this.prevUserEvent = l11;
  }
  isolate() {
    return this.prevTime ? new e3(this.done, this.undone) : this;
  }
  addChanges(t8, r2, n14, l11, o) {
    let c3 = this.done, s212 = c3[c3.length - 1];
    return s212 && s212.changes && !s212.changes.empty && t8.changes && (!n14 || At5.test(n14)) && (!s212.selectionsAfter.length && r2 - this.prevTime < l11.newGroupDelay && l11.joinToEvent(o, pt4(s212.changes, t8.changes)) || n14 == "input.type.compose") ? c3 = N7(c3, c3.length - 1, l11.minDepth, new A6(t8.changes.compose(s212.changes), Me6(v.mapEffects(t8.effects, s212.changes), s212.effects), s212.mapped, s212.startSelection, k4)) : c3 = N7(c3, c3.length, l11.minDepth, t8), new e3(c3, k4, r2, n14);
  }
  addSelection(t8, r2, n14, l11) {
    let o = this.done.length ? this.done[this.done.length - 1].selectionsAfter : k4;
    return o.length > 0 && r2 - this.prevTime < l11 && n14 == this.prevUserEvent && n14 && /^select($|\.)/.test(n14) && gt4(o[o.length - 1], t8) ? this : new e3(be8(this.done, t8), this.undone, r2, n14);
  }
  addMapping(t8) {
    return new e3($5(this.done, t8), $5(this.undone, t8), this.prevTime, this.prevUserEvent);
  }
  pop(t8, r2, n14) {
    let l11 = t8 == 0 ? this.done : this.undone;
    if (l11.length == 0) return null;
    let o = l11[l11.length - 1], c3 = o.selectionsAfter[0] || r2.selection;
    if (n14 && o.selectionsAfter.length) return r2.update({ selection: o.selectionsAfter[o.selectionsAfter.length - 1], annotations: Y8.of({ side: t8, rest: kt2(l11), selection: c3 }), userEvent: t8 == 0 ? "select.undo" : "select.redo", scrollIntoView: true });
    if (o.changes) {
      let s212 = l11.length == 1 ? k4 : l11.slice(0, l11.length - 1);
      return o.mapped && (s212 = $5(s212, o.mapped)), r2.update({ changes: o.changes, selection: o.startSelection, effects: o.effects, annotations: Y8.of({ side: t8, rest: s212, selection: c3 }), filter: false, userEvent: t8 == 0 ? "undo" : "redo", scrollIntoView: true });
    } else return null;
  }
};
L6.empty = new L6(k4, k4);
function T7(e7, t8) {
  return x.create(e7.ranges.map(t8), e7.mainIndex);
}
function S6(e7, t8) {
  return e7.update({ selection: t8, scrollIntoView: true, userEvent: "select" });
}
function y7({ state: e7, dispatch: t8 }, r2) {
  let n14 = T7(e7.selection, r2);
  return n14.eq(e7.selection, true) ? false : (t8(S6(e7, n14)), true);
}
function O7(e7, t8) {
  return x.cursor(t8 ? e7.to : e7.from);
}
function w4(e7, t8) {
  return y7(e7, (r2) => r2.empty ? e7.moveByChar(r2, t8) : O7(r2, t8));
}
function m2(e7) {
  return e7.textDirectionAt(e7.state.selection.main.head) == L5.LTR;
}
var Ee8 = (e7) => w4(e7, !m2(e7));
var Te5 = (e7) => w4(e7, m2(e7));
function J5(e7, t8) {
  return y7(e7, (r2) => r2.empty ? e7.moveByGroup(r2, t8) : O7(r2, t8));
}
var St4 = (e7) => J5(e7, !m2(e7));
var Ct2 = (e7) => J5(e7, m2(e7));
var ie2 = typeof Intl < "u" && Intl.Segmenter ? new Intl.Segmenter(void 0, { granularity: "word" }) : null;
function Lt4(e7, t8, r2) {
  if (t8.type.prop(r2)) return true;
  let n14 = t8.to - t8.from;
  return n14 && (n14 > 2 || /[^\s,.;:]/.test(e7.sliceDoc(t8.from, t8.to))) || t8.firstChild;
}
function z7(e7, t8, r2) {
  let n14 = k3(e7).resolveInner(t8.head), l11 = r2 ? b3.closedBy : b3.openedBy;
  for (let i12 = t8.head; ; ) {
    let f6 = r2 ? n14.childAfter(i12) : n14.childBefore(i12);
    if (!f6) break;
    Lt4(e7, f6, l11) ? n14 = f6 : i12 = r2 ? f6.to : f6.from;
  }
  let o = n14.type.prop(l11), c3, s212;
  return o && (c3 = r2 ? U6(e7, n14.from, 1) : U6(e7, n14.to, -1)) && c3.matched ? s212 = r2 ? c3.end.to : c3.end.from : s212 = r2 ? n14.to : n14.from, x.cursor(s212, r2 ? -1 : 1);
}
var xt5 = (e7) => y7(e7, (t8) => z7(e7.state, t8, !m2(e7)));
var Dt4 = (e7) => y7(e7, (t8) => z7(e7.state, t8, m2(e7)));
function ve6(e7, t8) {
  return y7(e7, (r2) => {
    if (!r2.empty) return O7(r2, t8);
    let n14 = e7.moveVertically(r2, t8);
    return n14.head != r2.head ? n14 : e7.moveToLineBoundary(r2, t8);
  });
}
var Ue6 = (e7) => ve6(e7, false);
var Fe6 = (e7) => ve6(e7, true);
function Ne8(e7) {
  let t8 = e7.scrollDOM.clientHeight < e7.scrollDOM.scrollHeight - 2, r2 = 0, n14 = 0, l11;
  if (t8) {
    for (let o of e7.state.facet(A5.scrollMargins)) {
      let c3 = o(e7);
      c3?.top && (r2 = Math.max(c3?.top, r2)), c3?.bottom && (n14 = Math.max(c3?.bottom, n14));
    }
    l11 = e7.scrollDOM.clientHeight - r2 - n14;
  } else l11 = (e7.dom.ownerDocument.defaultView || window).innerHeight;
  return { marginTop: r2, marginBottom: n14, selfScroll: t8, height: Math.max(e7.defaultLineHeight, l11 - 5) };
}
function Ve6(e7, t8) {
  let r2 = Ne8(e7), { state: n14 } = e7, l11 = T7(n14.selection, (c3) => c3.empty ? e7.moveVertically(c3, t8, r2.height) : O7(c3, t8));
  if (l11.eq(n14.selection)) return false;
  let o;
  if (r2.selfScroll) {
    let c3 = e7.coordsAtPos(n14.selection.main.head), s212 = e7.scrollDOM.getBoundingClientRect(), i12 = s212.top + r2.marginTop, f6 = s212.bottom - r2.marginBottom;
    c3 && c3.top > i12 && c3.bottom < f6 && (o = A5.scrollIntoView(l11.main.head, { y: "start", yMargin: c3.top - i12 }));
  }
  return e7.dispatch(S6(n14, l11), { effects: o }), true;
}
var ue6 = (e7) => Ve6(e7, false);
var _6 = (e7) => Ve6(e7, true);
function C4(e7, t8, r2) {
  let n14 = e7.lineBlockAt(t8.head), l11 = e7.moveToLineBoundary(t8, r2);
  if (l11.head == t8.head && l11.head != (r2 ? n14.to : n14.from) && (l11 = e7.moveToLineBoundary(t8, r2, false)), !r2 && l11.head == n14.from && n14.length) {
    let o = /^\s*/.exec(e7.state.sliceDoc(n14.from, Math.min(n14.from + 100, n14.to)))[0].length;
    o && t8.head != n14.from + o && (l11 = x.cursor(n14.from + o));
  }
  return l11;
}
var Mt4 = (e7) => y7(e7, (t8) => C4(e7, t8, true));
var bt = (e7) => y7(e7, (t8) => C4(e7, t8, false));
var Et5 = (e7) => y7(e7, (t8) => C4(e7, t8, !m2(e7)));
var Tt = (e7) => y7(e7, (t8) => C4(e7, t8, m2(e7)));
var Ot = (e7) => y7(e7, (t8) => x.cursor(e7.lineBlockAt(t8.head).from, 1));
var It5 = (e7) => y7(e7, (t8) => x.cursor(e7.lineBlockAt(t8.head).to, -1));
function Ge5(e7, t8, r2) {
  let n14 = false, l11 = T7(e7.selection, (o) => {
    let c3 = U6(e7, o.head, -1) || U6(e7, o.head, 1) || o.head > 0 && U6(e7, o.head - 1, 1) || o.head < e7.doc.length && U6(e7, o.head + 1, -1);
    if (!c3 || !c3.end) return o;
    n14 = true;
    let s212 = c3.start.from == o.head ? c3.end.to : c3.end.from;
    return r2 ? x.range(o.anchor, s212) : x.cursor(s212);
  });
  return n14 ? (t8(S6(e7, l11)), true) : false;
}
var Rt5 = ({ state: e7, dispatch: t8 }) => Ge5(e7, t8, false);
function p2(e7, t8) {
  let r2 = T7(e7.state.selection, (n14) => {
    let l11 = t8(n14);
    return x.range(n14.anchor, l11.head, l11.goalColumn, l11.bidiLevel || void 0);
  });
  return r2.eq(e7.state.selection) ? false : (e7.dispatch(S6(e7.state, r2)), true);
}
function H2(e7, t8) {
  return p2(e7, (r2) => e7.moveByChar(r2, t8));
}
var Pe7 = (e7) => H2(e7, !m2(e7));
var we8 = (e7) => H2(e7, m2(e7));
function W7(e7, t8) {
  return p2(e7, (r2) => e7.moveByGroup(r2, t8));
}
var vt4 = (e7) => W7(e7, !m2(e7));
var Ut5 = (e7) => W7(e7, m2(e7));
var Ft5 = (e7) => p2(e7, (t8) => z7(e7.state, t8, !m2(e7)));
var Nt = (e7) => p2(e7, (t8) => z7(e7.state, t8, m2(e7)));
function ze7(e7, t8) {
  return p2(e7, (r2) => e7.moveVertically(r2, t8));
}
var He5 = (e7) => ze7(e7, false);
var We6 = (e7) => ze7(e7, true);
function qe6(e7, t8) {
  return p2(e7, (r2) => e7.moveVertically(r2, t8, Ne8(e7).height));
}
var fe7 = (e7) => qe6(e7, false);
var ae6 = (e7) => qe6(e7, true);
var Vt5 = (e7) => p2(e7, (t8) => C4(e7, t8, true));
var Gt5 = (e7) => p2(e7, (t8) => C4(e7, t8, false));
var Pt4 = (e7) => p2(e7, (t8) => C4(e7, t8, !m2(e7)));
var wt2 = (e7) => p2(e7, (t8) => C4(e7, t8, m2(e7)));
var Jt5 = (e7) => p2(e7, (t8) => x.cursor(e7.lineBlockAt(t8.head).from));
var zt5 = (e7) => p2(e7, (t8) => x.cursor(e7.lineBlockAt(t8.head).to));
var he6 = ({ state: e7, dispatch: t8 }) => (t8(S6(e7, { anchor: 0 })), true);
var de4 = ({ state: e7, dispatch: t8 }) => (t8(S6(e7, { anchor: e7.doc.length })), true);
var me6 = ({ state: e7, dispatch: t8 }) => (t8(S6(e7, { anchor: e7.selection.main.anchor, head: 0 })), true);
var pe6 = ({ state: e7, dispatch: t8 }) => (t8(S6(e7, { anchor: e7.selection.main.anchor, head: e7.doc.length })), true);
var Ht5 = ({ state: e7, dispatch: t8 }) => (t8(e7.update({ selection: { anchor: 0, head: e7.doc.length }, userEvent: "select" })), true);
var Wt5 = ({ state: e7, dispatch: t8 }) => {
  let r2 = q5(e7).map(({ from: n14, to: l11 }) => x.range(n14, Math.min(l11 + 1, e7.doc.length)));
  return t8(e7.update({ selection: x.create(r2), userEvent: "select" })), true;
};
var qt4 = ({ state: e7, dispatch: t8 }) => {
  let r2 = T7(e7.selection, (n14) => {
    let l11 = k3(e7), o = l11.resolveStack(n14.from, 1);
    if (n14.empty) {
      let c3 = l11.resolveStack(n14.from, -1);
      c3.node.from >= o.node.from && c3.node.to <= o.node.to && (o = c3);
    }
    for (let c3 = o; c3; c3 = c3.next) {
      let { node: s212 } = c3;
      if ((s212.from < n14.from && s212.to >= n14.to || s212.to > n14.to && s212.from <= n14.from) && c3.next) return x.range(s212.to, s212.from);
    }
    return n14;
  });
  return r2.eq(e7.selection) ? false : (t8(S6(e7, r2)), true);
};
var Kt5 = ({ state: e7, dispatch: t8 }) => {
  let r2 = e7.selection, n14 = null;
  return r2.ranges.length > 1 ? n14 = x.create([r2.main]) : r2.main.empty || (n14 = x.create([x.cursor(r2.main.head)])), n14 ? (t8(S6(e7, n14)), true) : false;
};
function I7(e7, t8) {
  if (e7.state.readOnly) return false;
  let r2 = "delete.selection", { state: n14 } = e7, l11 = n14.changeByRange((o) => {
    let { from: c3, to: s212 } = o;
    if (c3 == s212) {
      let i12 = t8(o);
      i12 < c3 ? (r2 = "delete.backward", i12 = U8(e7, i12, false)) : i12 > c3 && (r2 = "delete.forward", i12 = U8(e7, i12, true)), c3 = Math.min(c3, i12), s212 = Math.max(s212, i12);
    } else c3 = U8(e7, c3, false), s212 = U8(e7, s212, true);
    return c3 == s212 ? { range: o } : { changes: { from: c3, to: s212 }, range: x.cursor(c3, c3 < o.head ? -1 : 1) };
  });
  return l11.changes.empty ? false : (e7.dispatch(n14.update(l11, { scrollIntoView: true, userEvent: r2, effects: r2 == "delete.selection" ? A5.announce.of(n14.phrase("Selection deleted")) : void 0 })), true);
}
function U8(e7, t8, r2) {
  if (e7 instanceof A5) for (let n14 of e7.state.facet(A5.atomicRanges).map((l11) => l11(e7))) n14.between(t8, t8, (l11, o) => {
    l11 < t8 && o > t8 && (t8 = r2 ? o : l11);
  });
  return t8;
}
var le7 = (e7, t8, r2) => I7(e7, (n14) => {
  let l11 = n14.from, { state: o } = e7, c3 = o.doc.lineAt(l11), s212, i12;
  if (r2 && !t8 && l11 > c3.from && l11 < c3.from + 200 && !/[^ \t]/.test(s212 = c3.text.slice(0, l11 - c3.from))) {
    if (s212[s212.length - 1] == "	") return l11 - 1;
    let f6 = ot(s212, o.tabSize), u3 = f6 % V5(o) || V5(o);
    for (let a2 = 0; a2 < u3 && s212[s212.length - 1 - a2] == " "; a2++) l11--;
    i12 = l11;
  } else i12 = ee(c3.text, l11 - c3.from, t8, t8) + c3.from, i12 == l11 && c3.number != (t8 ? o.doc.lines : 1) ? i12 += t8 ? 1 : -1 : !t8 && /[\ufe00-\ufe0f]/.test(c3.text.slice(i12 - c3.from, l11 - c3.from)) && (i12 = ee(c3.text, i12 - c3.from, false, false) + c3.from);
  return i12;
});
var j7 = (e7) => le7(e7, false, true);
var Ke6 = (e7) => le7(e7, true, false);
var $e6 = (e7, t8) => I7(e7, (r2) => {
  let n14 = r2.head, { state: l11 } = e7, o = l11.doc.lineAt(n14), c3 = l11.charCategorizer(n14);
  for (let s212 = null; ; ) {
    if (n14 == (t8 ? o.to : o.from)) {
      n14 == r2.head && o.number != (t8 ? l11.doc.lines : 1) && (n14 += t8 ? 1 : -1);
      break;
    }
    let i12 = ee(o.text, n14 - o.from, t8) + o.from, f6 = o.text.slice(Math.min(n14, i12) - o.from, Math.max(n14, i12) - o.from), u3 = c3(f6);
    if (s212 != null && u3 != s212) break;
    (f6 != " " || n14 != r2.head) && (s212 = u3), n14 = i12;
  }
  return n14;
});
var Qe5 = (e7) => $e6(e7, false);
var $t5 = (e7) => $e6(e7, true);
var Qt4 = (e7) => I7(e7, (t8) => {
  let r2 = e7.lineBlockAt(t8.head).to;
  return t8.head < r2 ? r2 : Math.min(e7.state.doc.length, t8.head + 1);
});
var Xt4 = (e7) => I7(e7, (t8) => {
  let r2 = e7.moveToLineBoundary(t8, false).head;
  return t8.head > r2 ? r2 : Math.max(0, t8.head - 1);
});
var Yt5 = (e7) => I7(e7, (t8) => {
  let r2 = e7.moveToLineBoundary(t8, true).head;
  return t8.head < r2 ? r2 : Math.min(e7.state.doc.length, t8.head + 1);
});
var Zt5 = ({ state: e7, dispatch: t8 }) => {
  if (e7.readOnly) return false;
  let r2 = e7.changeByRange((n14) => ({ changes: { from: n14.from, to: n14.to, insert: m.of(["", ""]) }, range: x.cursor(n14.from) }));
  return t8(e7.update(r2, { scrollIntoView: true, userEvent: "input" })), true;
};
var _t5 = ({ state: e7, dispatch: t8 }) => {
  if (e7.readOnly) return false;
  let r2 = e7.changeByRange((n14) => {
    if (!n14.empty || n14.from == 0 || n14.from == e7.doc.length) return { range: n14 };
    let l11 = n14.from, o = e7.doc.lineAt(l11), c3 = l11 == o.from ? l11 - 1 : ee(o.text, l11 - o.from, false) + o.from, s212 = l11 == o.to ? l11 + 1 : ee(o.text, l11 - o.from, true) + o.from;
    return { changes: { from: c3, to: s212, insert: e7.doc.slice(l11, s212).append(e7.doc.slice(c3, l11)) }, range: x.cursor(s212) };
  });
  return r2.changes.empty ? false : (t8(e7.update(r2, { scrollIntoView: true, userEvent: "move.character" })), true);
};
function q5(e7) {
  let t8 = [], r2 = -1;
  for (let n14 of e7.selection.ranges) {
    let l11 = e7.doc.lineAt(n14.from), o = e7.doc.lineAt(n14.to);
    if (!n14.empty && n14.to == o.from && (o = e7.doc.lineAt(n14.to - 1)), r2 >= l11.number) {
      let c3 = t8[t8.length - 1];
      c3.to = o.to, c3.ranges.push(n14);
    } else t8.push({ from: l11.from, to: o.to, ranges: [n14] });
    r2 = o.number + 1;
  }
  return t8;
}
function Xe6(e7, t8, r2) {
  if (e7.readOnly) return false;
  let n14 = [], l11 = [];
  for (let o of q5(e7)) {
    if (r2 ? o.to == e7.doc.length : o.from == 0) continue;
    let c3 = e7.doc.lineAt(r2 ? o.to + 1 : o.from - 1), s212 = c3.length + 1;
    if (r2) {
      n14.push({ from: o.to, to: c3.to }, { from: o.from, insert: c3.text + e7.lineBreak });
      for (let i12 of o.ranges) l11.push(x.range(Math.min(e7.doc.length, i12.anchor + s212), Math.min(e7.doc.length, i12.head + s212)));
    } else {
      n14.push({ from: c3.from, to: o.from }, { from: o.to, insert: e7.lineBreak + c3.text });
      for (let i12 of o.ranges) l11.push(x.range(i12.anchor - s212, i12.head - s212));
    }
  }
  return n14.length ? (t8(e7.update({ changes: n14, scrollIntoView: true, selection: x.create(l11, e7.selection.mainIndex), userEvent: "move.line" })), true) : false;
}
var jt5 = ({ state: e7, dispatch: t8 }) => Xe6(e7, t8, false);
var en4 = ({ state: e7, dispatch: t8 }) => Xe6(e7, t8, true);
function Ye6(e7, t8, r2) {
  if (e7.readOnly) return false;
  let n14 = [];
  for (let l11 of q5(e7)) r2 ? n14.push({ from: l11.from, insert: e7.doc.slice(l11.from, l11.to) + e7.lineBreak }) : n14.push({ from: l11.to, insert: e7.lineBreak + e7.doc.slice(l11.from, l11.to) });
  return t8(e7.update({ changes: n14, scrollIntoView: true, userEvent: "input.copyline" })), true;
}
var tn5 = ({ state: e7, dispatch: t8 }) => Ye6(e7, t8, false);
var nn4 = ({ state: e7, dispatch: t8 }) => Ye6(e7, t8, true);
var rn4 = (e7) => {
  if (e7.state.readOnly) return false;
  let { state: t8 } = e7, r2 = t8.changes(q5(t8).map(({ from: l11, to: o }) => (l11 > 0 ? l11-- : o < t8.doc.length && o++, { from: l11, to: o }))), n14 = T7(t8.selection, (l11) => {
    let o;
    if (e7.lineWrapping) {
      let c3 = e7.lineBlockAt(l11.head), s212 = e7.coordsAtPos(l11.head, l11.assoc || 1);
      s212 && (o = c3.bottom + e7.documentTop - s212.bottom + e7.defaultLineHeight / 2);
    }
    return e7.moveVertically(l11, true, o);
  }).map(r2);
  return e7.dispatch({ changes: r2, selection: n14, scrollIntoView: true, userEvent: "delete.line" }), true;
};
function on4(e7, t8) {
  if (/\(\)|\[\]|\{\}/.test(e7.sliceDoc(t8 - 1, t8 + 1))) return { from: t8, to: t8 };
  let r2 = k3(e7).resolveInner(t8), n14 = r2.childBefore(t8), l11 = r2.childAfter(t8), o;
  return n14 && l11 && n14.to <= t8 && l11.from >= t8 && (o = n14.type.prop(b3.closedBy)) && o.indexOf(l11.name) > -1 && e7.doc.lineAt(n14.to).from == e7.doc.lineAt(l11.from).from && !/\S/.test(e7.sliceDoc(n14.to, l11.from)) ? { from: n14.to, to: l11.from } : null;
}
var ge7 = Ze6(false);
var ln4 = Ze6(true);
function Ze6(e7) {
  return ({ state: t8, dispatch: r2 }) => {
    if (t8.readOnly) return false;
    let n14 = t8.changeByRange((l11) => {
      let { from: o, to: c3 } = l11, s212 = t8.doc.lineAt(o), i12 = !e7 && o == c3 && on4(t8, o);
      e7 && (o = c3 = (c3 <= s212.to ? s212 : t8.doc.lineAt(c3)).to);
      let f6 = new B3(t8, { simulateBreak: o, simulateDoubleBreak: !!i12 }), u3 = jt3(f6, o);
      for (u3 == null && (u3 = ot(/^\s*/.exec(t8.doc.lineAt(o).text)[0], t8.tabSize)); c3 < s212.to && /\s/.test(s212.text[c3 - s212.from]); ) c3++;
      i12 ? { from: o, to: c3 } = i12 : o > s212.from && o < s212.from + 100 && !/\S/.test(s212.text.slice(0, o)) && (o = s212.from);
      let a2 = ["", Wt3(t8, u3)];
      return i12 && a2.push(Wt3(t8, f6.lineIndent(s212.from, -1))), { changes: { from: o, to: c3, insert: m.of(a2) }, range: x.cursor(o + 1 + a2[1].length) };
    });
    return r2(t8.update(n14, { scrollIntoView: true, userEvent: "input" })), true;
  };
}
function ce8(e7, t8) {
  let r2 = -1;
  return e7.changeByRange((n14) => {
    let l11 = [];
    for (let c3 = n14.from; c3 <= n14.to; ) {
      let s212 = e7.doc.lineAt(c3);
      s212.number > r2 && (n14.empty || n14.to > s212.from) && (t8(s212, l11, n14), r2 = s212.number), c3 = s212.to + 1;
    }
    let o = e7.changes(l11);
    return { changes: l11, range: x.range(o.mapPos(n14.anchor, 1), o.mapPos(n14.head, 1)) };
  });
}
var cn4 = ({ state: e7, dispatch: t8 }) => {
  if (e7.readOnly) return false;
  let r2 = /* @__PURE__ */ Object.create(null), n14 = new B3(e7, { overrideIndentation: (o) => {
    let c3 = r2[o];
    return c3 ?? -1;
  } }), l11 = ce8(e7, (o, c3, s212) => {
    let i12 = jt3(n14, o.from);
    if (i12 == null) return;
    /\S/.test(o.text) || (i12 = 0);
    let f6 = /^\s*/.exec(o.text)[0], u3 = Wt3(e7, i12);
    (f6 != u3 || s212.from < o.from + f6.length) && (r2[o.from] = i12, c3.push({ from: o.from, to: o.from + f6.length, insert: u3 }));
  });
  return l11.changes.empty || t8(e7.update(l11, { userEvent: "indent" })), true;
};
var se4 = ({ state: e7, dispatch: t8 }) => e7.readOnly ? false : (t8(e7.update(ce8(e7, (r2, n14) => {
  n14.push({ from: r2.from, insert: e7.facet(Ut3) });
}), { userEvent: "input.indent" })), true);
var _e3 = ({ state: e7, dispatch: t8 }) => e7.readOnly ? false : (t8(e7.update(ce8(e7, (r2, n14) => {
  let l11 = /^\s*/.exec(r2.text)[0];
  if (!l11) return;
  let o = ot(l11, e7.tabSize), c3 = 0, s212 = Wt3(e7, Math.max(0, o - V5(e7)));
  for (; c3 < l11.length && c3 < s212.length && l11.charCodeAt(c3) == s212.charCodeAt(c3); ) c3++;
  n14.push({ from: r2.from + c3, to: r2.from + l11.length, insert: s212.slice(c3) });
}), { userEvent: "delete.dedent" })), true);
var sn4 = (e7) => (e7.setTabFocusMode(), true);
var un4 = [{ key: "Ctrl-b", run: Ee8, shift: Pe7, preventDefault: true }, { key: "Ctrl-f", run: Te5, shift: we8 }, { key: "Ctrl-p", run: Ue6, shift: He5 }, { key: "Ctrl-n", run: Fe6, shift: We6 }, { key: "Ctrl-a", run: Ot, shift: Jt5 }, { key: "Ctrl-e", run: It5, shift: zt5 }, { key: "Ctrl-d", run: Ke6 }, { key: "Ctrl-h", run: j7 }, { key: "Ctrl-k", run: Qt4 }, { key: "Ctrl-Alt-h", run: Qe5 }, { key: "Ctrl-o", run: Zt5 }, { key: "Ctrl-t", run: _t5 }, { key: "Ctrl-v", run: _6 }];
var fn4 = [{ key: "ArrowLeft", run: Ee8, shift: Pe7, preventDefault: true }, { key: "Mod-ArrowLeft", mac: "Alt-ArrowLeft", run: St4, shift: vt4, preventDefault: true }, { mac: "Cmd-ArrowLeft", run: Et5, shift: Pt4, preventDefault: true }, { key: "ArrowRight", run: Te5, shift: we8, preventDefault: true }, { key: "Mod-ArrowRight", mac: "Alt-ArrowRight", run: Ct2, shift: Ut5, preventDefault: true }, { mac: "Cmd-ArrowRight", run: Tt, shift: wt2, preventDefault: true }, { key: "ArrowUp", run: Ue6, shift: He5, preventDefault: true }, { mac: "Cmd-ArrowUp", run: he6, shift: me6 }, { mac: "Ctrl-ArrowUp", run: ue6, shift: fe7 }, { key: "ArrowDown", run: Fe6, shift: We6, preventDefault: true }, { mac: "Cmd-ArrowDown", run: de4, shift: pe6 }, { mac: "Ctrl-ArrowDown", run: _6, shift: ae6 }, { key: "PageUp", run: ue6, shift: fe7 }, { key: "PageDown", run: _6, shift: ae6 }, { key: "Home", run: bt, shift: Gt5, preventDefault: true }, { key: "Mod-Home", run: he6, shift: me6 }, { key: "End", run: Mt4, shift: Vt5, preventDefault: true }, { key: "Mod-End", run: de4, shift: pe6 }, { key: "Enter", run: ge7, shift: ge7 }, { key: "Mod-a", run: Ht5 }, { key: "Backspace", run: j7, shift: j7 }, { key: "Delete", run: Ke6 }, { key: "Mod-Backspace", mac: "Alt-Backspace", run: Qe5 }, { key: "Mod-Delete", mac: "Alt-Delete", run: $t5 }, { mac: "Mod-Backspace", run: Xt4 }, { mac: "Mod-Delete", run: Yt5 }].concat(un4.map((e7) => ({ mac: e7.key, run: e7.run, shift: e7.shift })));
var Qn = [{ key: "Alt-ArrowLeft", mac: "Ctrl-ArrowLeft", run: xt5, shift: Ft5 }, { key: "Alt-ArrowRight", mac: "Ctrl-ArrowRight", run: Dt4, shift: Nt }, { key: "Alt-ArrowUp", run: jt5 }, { key: "Shift-Alt-ArrowUp", run: tn5 }, { key: "Alt-ArrowDown", run: en4 }, { key: "Shift-Alt-ArrowDown", run: nn4 }, { key: "Escape", run: Kt5 }, { key: "Mod-Enter", run: ln4 }, { key: "Alt-l", mac: "Ctrl-l", run: Wt5 }, { key: "Mod-i", run: qt4, preventDefault: true }, { key: "Mod-[", run: _e3 }, { key: "Mod-]", run: se4 }, { key: "Mod-Alt-\\", run: cn4 }, { key: "Shift-Mod-k", run: rn4 }, { key: "Shift-Mod-\\", run: Rt5 }, { key: "Mod-/", run: lt5 }, { key: "Alt-A", run: st6 }, { key: "Ctrl-m", mac: "Shift-Alt-m", run: sn4 }].concat(fn4);

// https://esm.sh/v135/crelt@1.0.6/denonext/crelt.mjs
function s114() {
  var r2 = arguments[0];
  typeof r2 == "string" && (r2 = document.createElement(r2));
  var e7 = 1, t8 = arguments[1];
  if (t8 && typeof t8 == "object" && t8.nodeType == null && !Array.isArray(t8)) {
    for (var n14 in t8) if (Object.prototype.hasOwnProperty.call(t8, n14)) {
      var o = t8[n14];
      typeof o == "string" ? r2.setAttribute(n14, o) : o != null && (r2[n14] = o);
    }
    e7++;
  }
  for (; e7 < arguments.length; e7++) f(r2, arguments[e7]);
  return r2;
}
function f(r2, e7) {
  if (typeof e7 == "string") r2.appendChild(document.createTextNode(e7));
  else if (e7 != null) if (e7.nodeType != null) r2.appendChild(e7);
  else if (Array.isArray(e7)) for (var t8 = 0; t8 < e7.length; t8++) f(r2, e7[t8]);
  else throw new RangeError("Unsupported child node: " + e7);
}

// https://esm.sh/v135/@codemirror/search@6.5.8/denonext/search.mjs
var re6 = typeof String.prototype.normalize == "function" ? (t8) => t8.normalize("NFKD") : (t8) => t8;
var S7 = class {
  constructor(e7, n14, r2 = 0, i12 = e7.length, s212, l11) {
    this.test = l11, this.value = { from: 0, to: 0 }, this.done = false, this.matches = [], this.buffer = "", this.bufferPos = 0, this.iter = e7.iterRange(r2, i12), this.bufferStart = r2, this.normalize = s212 ? (o) => s212(re6(o)) : re6, this.query = this.normalize(n14);
  }
  peek() {
    if (this.bufferPos == this.buffer.length) {
      if (this.bufferStart += this.buffer.length, this.iter.next(), this.iter.done) return -1;
      this.bufferPos = 0, this.buffer = this.iter.value;
    }
    return ae(this.buffer, this.bufferPos);
  }
  next() {
    for (; this.matches.length; ) this.matches.pop();
    return this.nextOverlapping();
  }
  nextOverlapping() {
    for (; ; ) {
      let e7 = this.peek();
      if (e7 < 0) return this.done = true, this;
      let n14 = lt(e7), r2 = this.bufferStart + this.bufferPos;
      this.bufferPos += Oe(e7);
      let i12 = this.normalize(n14);
      if (i12.length) for (let s212 = 0, l11 = r2; ; s212++) {
        let o = i12.charCodeAt(s212), c3 = this.match(o, l11, this.bufferPos + this.bufferStart);
        if (s212 == i12.length - 1) {
          if (c3) return this.value = c3, this;
          break;
        }
        l11 == r2 && s212 < n14.length && n14.charCodeAt(s212) == o && l11++;
      }
    }
  }
  match(e7, n14, r2) {
    let i12 = null;
    for (let s212 = 0; s212 < this.matches.length; s212 += 2) {
      let l11 = this.matches[s212], o = false;
      this.query.charCodeAt(l11) == e7 && (l11 == this.query.length - 1 ? i12 = { from: this.matches[s212 + 1], to: r2 } : (this.matches[s212]++, o = true)), o || (this.matches.splice(s212, 2), s212 -= 2);
    }
    return this.query.charCodeAt(0) == e7 && (this.query.length == 1 ? i12 = { from: n14, to: r2 } : this.matches.push(1, n14)), i12 && this.test && !this.test(i12.from, i12.to, this.buffer, this.bufferStart) && (i12 = null), i12;
  }
};
typeof Symbol < "u" && (S7.prototype[Symbol.iterator] = function() {
  return this;
});
var de5 = { from: -1, to: -1, match: /.*/.exec("") };
var X7 = "gm" + (/x/.unicode == null ? "" : "u");
var P9 = class {
  constructor(e7, n14, r2, i12 = 0, s212 = e7.length) {
    if (this.text = e7, this.to = s212, this.curLine = "", this.done = false, this.value = de5, /\\[sWDnr]|\n|\r|\[\^/.test(n14)) return new I8(e7, n14, r2, i12, s212);
    this.re = new RegExp(n14, X7 + (r2?.ignoreCase ? "i" : "")), this.test = r2?.test, this.iter = e7.iter();
    let l11 = e7.lineAt(i12);
    this.curLineStart = l11.from, this.matchPos = w5(e7, i12), this.getLine(this.curLineStart);
  }
  getLine(e7) {
    this.iter.next(e7), this.iter.lineBreak ? this.curLine = "" : (this.curLine = this.iter.value, this.curLineStart + this.curLine.length > this.to && (this.curLine = this.curLine.slice(0, this.to - this.curLineStart)), this.iter.next());
  }
  nextLine() {
    this.curLineStart = this.curLineStart + this.curLine.length + 1, this.curLineStart > this.to ? this.curLine = "" : this.getLine(0);
  }
  next() {
    for (let e7 = this.matchPos - this.curLineStart; ; ) {
      this.re.lastIndex = e7;
      let n14 = this.matchPos <= this.to && this.re.exec(this.curLine);
      if (n14) {
        let r2 = this.curLineStart + n14.index, i12 = r2 + n14[0].length;
        if (this.matchPos = w5(this.text, i12 + (r2 == i12 ? 1 : 0)), r2 == this.curLineStart + this.curLine.length && this.nextLine(), (r2 < i12 || r2 > this.value.to) && (!this.test || this.test(r2, i12, n14))) return this.value = { from: r2, to: i12, match: n14 }, this;
        e7 = this.matchPos - this.curLineStart;
      } else if (this.curLineStart + this.curLine.length < this.to) this.nextLine(), e7 = 0;
      else return this.done = true, this;
    }
  }
};
var K6 = /* @__PURE__ */ new WeakMap();
var R7 = class t2 {
  constructor(e7, n14) {
    this.from = e7, this.text = n14;
  }
  get to() {
    return this.from + this.text.length;
  }
  static get(e7, n14, r2) {
    let i12 = K6.get(e7);
    if (!i12 || i12.from >= r2 || i12.to <= n14) {
      let o = new t2(n14, e7.sliceString(n14, r2));
      return K6.set(e7, o), o;
    }
    if (i12.from == n14 && i12.to == r2) return i12;
    let { text: s212, from: l11 } = i12;
    return l11 > n14 && (s212 = e7.sliceString(n14, l11) + s212, l11 = n14), i12.to < r2 && (s212 += e7.sliceString(i12.to, r2)), K6.set(e7, new t2(l11, s212)), new t2(n14, s212.slice(n14 - l11, r2 - l11));
  }
};
var I8 = class {
  constructor(e7, n14, r2, i12, s212) {
    this.text = e7, this.to = s212, this.done = false, this.value = de5, this.matchPos = w5(e7, i12), this.re = new RegExp(n14, X7 + (r2?.ignoreCase ? "i" : "")), this.test = r2?.test, this.flat = R7.get(e7, i12, this.chunkEnd(i12 + 5e3));
  }
  chunkEnd(e7) {
    return e7 >= this.to ? this.to : this.text.lineAt(e7).to;
  }
  next() {
    for (; ; ) {
      let e7 = this.re.lastIndex = this.matchPos - this.flat.from, n14 = this.re.exec(this.flat.text);
      if (n14 && !n14[0] && n14.index == e7 && (this.re.lastIndex = e7 + 1, n14 = this.re.exec(this.flat.text)), n14) {
        let r2 = this.flat.from + n14.index, i12 = r2 + n14[0].length;
        if ((this.flat.to >= this.to || n14.index + n14[0].length <= this.flat.text.length - 10) && (!this.test || this.test(r2, i12, n14))) return this.value = { from: r2, to: i12, match: n14 }, this.matchPos = w5(this.text, i12 + (r2 == i12 ? 1 : 0)), this;
      }
      if (this.flat.to == this.to) return this.done = true, this;
      this.flat = R7.get(this.text, this.flat.from, this.chunkEnd(this.flat.from + this.flat.text.length * 2));
    }
  }
};
typeof Symbol < "u" && (P9.prototype[Symbol.iterator] = I8.prototype[Symbol.iterator] = function() {
  return this;
});
function We7(t8) {
  try {
    return new RegExp(t8, X7), true;
  } catch {
    return false;
  }
}
function w5(t8, e7) {
  if (e7 >= t8.length) return e7;
  let n14 = t8.lineAt(e7), r2;
  for (; e7 < n14.to && (r2 = n14.text.charCodeAt(e7 - n14.from)) >= 56320 && r2 < 57344; ) e7++;
  return e7;
}
function G10(t8) {
  let e7 = String(t8.state.doc.lineAt(t8.state.selection.main.head).number), n14 = s114("input", { class: "cm-textfield", name: "line", value: e7 }), r2 = s114("form", { class: "cm-gotoLine", onkeydown: (s212) => {
    s212.keyCode == 27 ? (s212.preventDefault(), t8.dispatch({ effects: T8.of(false) }), t8.focus()) : s212.keyCode == 13 && (s212.preventDefault(), i12());
  }, onsubmit: (s212) => {
    s212.preventDefault(), i12();
  } }, s114("label", t8.state.phrase("Go to line"), ": ", n14), " ", s114("button", { class: "cm-button", type: "submit" }, t8.state.phrase("go")));
  function i12() {
    let s212 = /^([+-])?(\d+)?(:\d+)?(%)?$/.exec(n14.value);
    if (!s212) return;
    let { state: l11 } = t8, o = l11.doc.lineAt(l11.selection.main.head), [, c3, a2, h3, m11] = s212, D14 = h3 ? +h3.slice(1) : 0, C11 = a2 ? +a2 : o.number;
    if (a2 && m11) {
      let H12 = C11 / 100;
      c3 && (H12 = H12 * (c3 == "-" ? -1 : 1) + o.number / l11.doc.lines), C11 = Math.round(l11.doc.lines * H12);
    } else a2 && c3 && (C11 = C11 * (c3 == "-" ? -1 : 1) + o.number);
    let te14 = l11.doc.line(Math.max(1, Math.min(l11.doc.lines, C11))), ne15 = x.cursor(te14.from + Math.max(0, Math.min(D14, te14.length)));
    t8.dispatch({ effects: [T8.of(false), A2.scrollIntoView(ne15.from, { y: "center" })], selection: ne15 }), t8.focus();
  }
  return { dom: r2 };
}
var T8 = v.define();
var ie3 = z.define({ create() {
  return true;
}, update(t8, e7) {
  for (let n14 of e7.effects) n14.is(T8) && (t8 = n14.value);
  return t8;
}, provide: (t8) => Rs.from(t8, (e7) => e7 ? G10 : null) });
var De6 = A2.baseTheme({ ".cm-panel.cm-gotoLine": { padding: "2px 6px 4px", "& label": { fontSize: "80%" } } });
var Fe7 = { highlightWordAroundCursor: false, minSelectionLength: 1, maxMatches: 100, wholeWords: false };
var me7 = y.define({ combine(t8) {
  return at(t8, Fe7, { highlightWordAroundCursor: (e7, n14) => e7 || n14, minSelectionLength: Math.min, maxMatches: Math.min });
} });
var qe7 = O2.mark({ class: "cm-selectionMatch" });
var Ee9 = O2.mark({ class: "cm-selectionMatch cm-selectionMatch-main" });
function se5(t8, e7, n14, r2) {
  return (n14 == 0 || t8(e7.sliceDoc(n14 - 1, n14)) != O.Word) && (r2 == e7.doc.length || t8(e7.sliceDoc(r2, r2 + 1)) != O.Word);
}
function Pe8(t8, e7, n14, r2) {
  return t8(e7.sliceDoc(n14, n14 + 1)) == O.Word && t8(e7.sliceDoc(r2 - 1, r2)) == O.Word;
}
var Re6 = N2.fromClass(class {
  constructor(t8) {
    this.decorations = this.getDeco(t8);
  }
  update(t8) {
    (t8.selectionSet || t8.docChanged || t8.viewportChanged) && (this.decorations = this.getDeco(t8.view));
  }
  getDeco(t8) {
    let e7 = t8.state.facet(me7), { state: n14 } = t8, r2 = n14.selection;
    if (r2.ranges.length > 1) return O2.none;
    let i12 = r2.main, s212, l11 = null;
    if (i12.empty) {
      if (!e7.highlightWordAroundCursor) return O2.none;
      let c3 = n14.wordAt(i12.head);
      if (!c3) return O2.none;
      l11 = n14.charCategorizer(i12.head), s212 = n14.sliceDoc(c3.from, c3.to);
    } else {
      let c3 = i12.to - i12.from;
      if (c3 < e7.minSelectionLength || c3 > 200) return O2.none;
      if (e7.wholeWords) {
        if (s212 = n14.sliceDoc(i12.from, i12.to), l11 = n14.charCategorizer(i12.head), !(se5(l11, n14, i12.from, i12.to) && Pe8(l11, n14, i12.from, i12.to))) return O2.none;
      } else if (s212 = n14.sliceDoc(i12.from, i12.to), !s212) return O2.none;
    }
    let o = [];
    for (let c3 of t8.visibleRanges) {
      let a2 = new S7(n14.doc, s212, c3.from, c3.to);
      for (; !a2.next().done; ) {
        let { from: h3, to: m11 } = a2.value;
        if ((!l11 || se5(l11, n14, h3, m11)) && (i12.empty && h3 <= i12.from && m11 >= i12.to ? o.push(Ee9.range(h3, m11)) : (h3 >= i12.to || m11 <= i12.from) && o.push(qe7.range(h3, m11)), o.length > e7.maxMatches)) return O2.none;
      }
    }
    return O2.set(o);
  }
}, { decorations: (t8) => t8.decorations });
var Ie6 = A2.baseTheme({ ".cm-selectionMatch": { backgroundColor: "#99ff7780" }, ".cm-searchMatch .cm-selectionMatch": { backgroundColor: "transparent" } });
var v3 = y.define({ combine(t8) {
  return at(t8, { top: false, caseSensitive: false, literal: false, regexp: false, wholeWord: false, createPanel: (e7) => new J6(e7), scrollToMatch: (e7) => A2.scrollIntoView(e7) });
} });
var O8 = class {
  constructor(e7) {
    this.search = e7.search, this.caseSensitive = !!e7.caseSensitive, this.literal = !!e7.literal, this.regexp = !!e7.regexp, this.replace = e7.replace || "", this.valid = !!this.search && (!this.regexp || We7(this.search)), this.unquoted = this.unquote(this.search), this.wholeWord = !!e7.wholeWord;
  }
  unquote(e7) {
    return this.literal ? e7 : e7.replace(/\\([nrt\\])/g, (n14, r2) => r2 == "n" ? `
` : r2 == "r" ? "\r" : r2 == "t" ? "	" : "\\");
  }
  eq(e7) {
    return this.search == e7.search && this.replace == e7.replace && this.caseSensitive == e7.caseSensitive && this.regexp == e7.regexp && this.wholeWord == e7.wholeWord;
  }
  create() {
    return this.regexp ? new j8(this) : new Q8(this);
  }
  getCursor(e7, n14 = 0, r2) {
    let i12 = e7.doc ? e7 : I.create({ doc: e7 });
    return r2 == null && (r2 = i12.doc.length), this.regexp ? b4(this, i12, n14, r2) : y8(this, i12, n14, r2);
  }
};
var $6 = class {
  constructor(e7) {
    this.spec = e7;
  }
};
function y8(t8, e7, n14, r2) {
  return new S7(e7.doc, t8.unquoted, n14, r2, t8.caseSensitive ? void 0 : (i12) => i12.toLowerCase(), t8.wholeWord ? $e7(e7.doc, e7.charCategorizer(e7.selection.main.head)) : void 0);
}
function $e7(t8, e7) {
  return (n14, r2, i12, s212) => ((s212 > n14 || s212 + i12.length < r2) && (s212 = Math.max(0, n14 - 2), i12 = t8.sliceString(s212, Math.min(t8.length, r2 + 2))), (e7(_7(i12, n14 - s212)) != O.Word || e7(z8(i12, n14 - s212)) != O.Word) && (e7(z8(i12, r2 - s212)) != O.Word || e7(_7(i12, r2 - s212)) != O.Word));
}
var Q8 = class extends $6 {
  constructor(e7) {
    super(e7);
  }
  nextMatch(e7, n14, r2) {
    let i12 = y8(this.spec, e7, r2, e7.doc.length).nextOverlapping();
    if (i12.done) {
      let s212 = Math.min(e7.doc.length, n14 + this.spec.unquoted.length);
      i12 = y8(this.spec, e7, 0, s212).nextOverlapping();
    }
    return i12.done || i12.value.from == n14 && i12.value.to == r2 ? null : i12.value;
  }
  prevMatchInRange(e7, n14, r2) {
    for (let i12 = r2; ; ) {
      let s212 = Math.max(n14, i12 - 1e4 - this.spec.unquoted.length), l11 = y8(this.spec, e7, s212, i12), o = null;
      for (; !l11.nextOverlapping().done; ) o = l11.value;
      if (o) return o;
      if (s212 == n14) return null;
      i12 -= 1e4;
    }
  }
  prevMatch(e7, n14, r2) {
    let i12 = this.prevMatchInRange(e7, 0, n14);
    return i12 || (i12 = this.prevMatchInRange(e7, Math.max(0, r2 - this.spec.unquoted.length), e7.doc.length)), i12 && (i12.from != n14 || i12.to != r2) ? i12 : null;
  }
  getReplacement(e7) {
    return this.spec.unquote(this.spec.replace);
  }
  matchAll(e7, n14) {
    let r2 = y8(this.spec, e7, 0, e7.doc.length), i12 = [];
    for (; !r2.next().done; ) {
      if (i12.length >= n14) return null;
      i12.push(r2.value);
    }
    return i12;
  }
  highlight(e7, n14, r2, i12) {
    let s212 = y8(this.spec, e7, Math.max(0, n14 - this.spec.unquoted.length), Math.min(r2 + this.spec.unquoted.length, e7.doc.length));
    for (; !s212.next().done; ) i12(s212.value.from, s212.value.to);
  }
};
function b4(t8, e7, n14, r2) {
  return new P9(e7.doc, t8.search, { ignoreCase: !t8.caseSensitive, test: t8.wholeWord ? _e4(e7.charCategorizer(e7.selection.main.head)) : void 0 }, n14, r2);
}
function _7(t8, e7) {
  return t8.slice(ee(t8, e7, false), e7);
}
function z8(t8, e7) {
  return t8.slice(e7, ee(t8, e7));
}
function _e4(t8) {
  return (e7, n14, r2) => !r2[0].length || (t8(_7(r2.input, r2.index)) != O.Word || t8(z8(r2.input, r2.index)) != O.Word) && (t8(z8(r2.input, r2.index + r2[0].length)) != O.Word || t8(_7(r2.input, r2.index + r2[0].length)) != O.Word);
}
var j8 = class extends $6 {
  nextMatch(e7, n14, r2) {
    let i12 = b4(this.spec, e7, r2, e7.doc.length).next();
    return i12.done && (i12 = b4(this.spec, e7, 0, n14).next()), i12.done ? null : i12.value;
  }
  prevMatchInRange(e7, n14, r2) {
    for (let i12 = 1; ; i12++) {
      let s212 = Math.max(n14, r2 - i12 * 1e4), l11 = b4(this.spec, e7, s212, r2), o = null;
      for (; !l11.next().done; ) o = l11.value;
      if (o && (s212 == n14 || o.from > s212 + 10)) return o;
      if (s212 == n14) return null;
    }
  }
  prevMatch(e7, n14, r2) {
    return this.prevMatchInRange(e7, 0, n14) || this.prevMatchInRange(e7, r2, e7.doc.length);
  }
  getReplacement(e7) {
    return this.spec.unquote(this.spec.replace).replace(/\$([$&\d+])/g, (n14, r2) => r2 == "$" ? "$" : r2 == "&" ? e7.match[0] : r2 != "0" && +r2 < e7.match.length ? e7.match[r2] : n14);
  }
  matchAll(e7, n14) {
    let r2 = b4(this.spec, e7, 0, e7.doc.length), i12 = [];
    for (; !r2.next().done; ) {
      if (i12.length >= n14) return null;
      i12.push(r2.value);
    }
    return i12;
  }
  highlight(e7, n14, r2, i12) {
    let s212 = b4(this.spec, e7, Math.max(0, n14 - 250), Math.min(r2 + 250, e7.doc.length));
    for (; !s212.next().done; ) i12(s212.value.from, s212.value.to);
  }
};
var L7 = v.define();
var Y9 = v.define();
var x5 = z.define({ create(t8) {
  return new k5(V9(t8).create(), null);
}, update(t8, e7) {
  for (let n14 of e7.effects) n14.is(L7) ? t8 = new k5(n14.value.create(), t8.panel) : n14.is(Y9) && (t8 = new k5(t8.query, n14.value ? Z6 : null));
  return t8;
}, provide: (t8) => Rs.from(t8, (e7) => e7.panel) });
var k5 = class {
  constructor(e7, n14) {
    this.query = e7, this.panel = n14;
  }
};
var ze8 = O2.mark({ class: "cm-searchMatch" });
var Be7 = O2.mark({ class: "cm-searchMatch cm-searchMatch-selected" });
var Ne9 = N2.fromClass(class {
  constructor(t8) {
    this.view = t8, this.decorations = this.highlight(t8.state.field(x5));
  }
  update(t8) {
    let e7 = t8.state.field(x5);
    (e7 != t8.startState.field(x5) || t8.docChanged || t8.selectionSet || t8.viewportChanged) && (this.decorations = this.highlight(e7));
  }
  highlight({ query: t8, panel: e7 }) {
    if (!e7 || !t8.spec.valid) return O2.none;
    let { view: n14 } = this, r2 = new re();
    for (let i12 = 0, s212 = n14.visibleRanges, l11 = s212.length; i12 < l11; i12++) {
      let { from: o, to: c3 } = s212[i12];
      for (; i12 < l11 - 1 && c3 > s212[i12 + 1].from - 2 * 250; ) c3 = s212[++i12].to;
      t8.highlight(n14.state, o, c3, (a2, h3) => {
        let m11 = n14.state.selection.ranges.some((D14) => D14.from == a2 && D14.to == h3);
        r2.add(a2, h3, m11 ? Be7 : ze8);
      });
    }
    return r2.finish();
  }
}, { decorations: (t8) => t8.decorations });
function A7(t8) {
  return (e7) => {
    let n14 = e7.state.field(x5, false);
    return n14 && n14.query.spec.valid ? t8(e7, n14) : xe8(e7);
  };
}
var B4 = A7((t8, { query: e7 }) => {
  let { to: n14 } = t8.state.selection.main, r2 = e7.nextMatch(t8.state, n14, n14);
  if (!r2) return false;
  let i12 = x.single(r2.from, r2.to), s212 = t8.state.facet(v3);
  return t8.dispatch({ selection: i12, effects: [ee5(t8, r2), s212.scrollToMatch(i12.main, t8)], userEvent: "select.search" }), ge8(t8), true;
});
var N8 = A7((t8, { query: e7 }) => {
  let { state: n14 } = t8, { from: r2 } = n14.selection.main, i12 = e7.prevMatch(n14, r2, r2);
  if (!i12) return false;
  let s212 = x.single(i12.from, i12.to), l11 = t8.state.facet(v3);
  return t8.dispatch({ selection: s212, effects: [ee5(t8, i12), l11.scrollToMatch(s212.main, t8)], userEvent: "select.search" }), ge8(t8), true;
});
var Ve7 = A7((t8, { query: e7 }) => {
  let n14 = e7.matchAll(t8.state, 1e3);
  return !n14 || !n14.length ? false : (t8.dispatch({ selection: x.create(n14.map((r2) => x.range(r2.from, r2.to))), userEvent: "select.search.matches" }), true);
});
var le8 = A7((t8, { query: e7 }) => {
  let { state: n14 } = t8, { from: r2, to: i12 } = n14.selection.main;
  if (n14.readOnly) return false;
  let s212 = e7.nextMatch(n14, r2, r2);
  if (!s212) return false;
  let l11 = s212, o = [], c3, a2, h3 = [];
  if (l11.from == r2 && l11.to == i12 && (a2 = n14.toText(e7.getReplacement(l11)), o.push({ from: l11.from, to: l11.to, insert: a2 }), l11 = e7.nextMatch(n14, l11.from, l11.to), h3.push(A2.announce.of(n14.phrase("replaced match on line $", n14.doc.lineAt(r2).number) + "."))), l11) {
    let m11 = o.length == 0 || o[0].from >= s212.to ? 0 : s212.to - s212.from - a2.length;
    c3 = x.single(l11.from - m11, l11.to - m11), h3.push(ee5(t8, l11)), h3.push(n14.facet(v3).scrollToMatch(c3.main, t8));
  }
  return t8.dispatch({ changes: o, selection: c3, effects: h3, userEvent: "input.replace" }), true;
});
var Ke7 = A7((t8, { query: e7 }) => {
  if (t8.state.readOnly) return false;
  let n14 = e7.matchAll(t8.state, 1e9).map((i12) => {
    let { from: s212, to: l11 } = i12;
    return { from: s212, to: l11, insert: e7.getReplacement(i12) };
  });
  if (!n14.length) return false;
  let r2 = t8.state.phrase("replaced $ matches", n14.length) + ".";
  return t8.dispatch({ changes: n14, effects: A2.announce.of(r2), userEvent: "input.replace.all" }), true;
});
function Z6(t8) {
  return t8.state.facet(v3).createPanel(t8);
}
function V9(t8, e7) {
  var n14, r2, i12, s212, l11;
  let o = t8.selection.main, c3 = o.empty || o.to > o.from + 100 ? "" : t8.sliceDoc(o.from, o.to);
  if (e7 && !c3) return e7;
  let a2 = t8.facet(v3);
  return new O8({ search: ((n14 = e7?.literal) !== null && n14 !== void 0 ? n14 : a2.literal) ? c3 : c3.replace(/\n/g, "\\n"), caseSensitive: (r2 = e7?.caseSensitive) !== null && r2 !== void 0 ? r2 : a2.caseSensitive, literal: (i12 = e7?.literal) !== null && i12 !== void 0 ? i12 : a2.literal, regexp: (s212 = e7?.regexp) !== null && s212 !== void 0 ? s212 : a2.regexp, wholeWord: (l11 = e7?.wholeWord) !== null && l11 !== void 0 ? l11 : a2.wholeWord });
}
function pe7(t8) {
  let e7 = Sl(t8, Z6);
  return e7 && e7.dom.querySelector("[main-field]");
}
function ge8(t8) {
  let e7 = pe7(t8);
  e7 && e7 == t8.root.activeElement && e7.select();
}
var xe8 = (t8) => {
  let e7 = t8.state.field(x5, false);
  if (e7 && e7.panel) {
    let n14 = pe7(t8);
    if (n14 && n14 != t8.root.activeElement) {
      let r2 = V9(t8.state, e7.query.spec);
      r2.valid && t8.dispatch({ effects: L7.of(r2) }), n14.focus(), n14.select();
    }
  } else t8.dispatch({ effects: [Y9.of(true), e7 ? L7.of(V9(t8.state, e7.query.spec)) : v.appendConfig.of(U9)] });
  return true;
};
var Me7 = (t8) => {
  let e7 = t8.state.field(x5, false);
  if (!e7 || !e7.panel) return false;
  let n14 = Sl(t8, Z6);
  return n14 && n14.dom.contains(t8.root.activeElement) && t8.focus(), t8.dispatch({ effects: Y9.of(false) }), true;
};
var J6 = class {
  constructor(e7) {
    this.view = e7;
    let n14 = this.query = e7.state.field(x5).query.spec;
    this.commit = this.commit.bind(this), this.searchField = s114("input", { value: n14.search, placeholder: f2(e7, "Find"), "aria-label": f2(e7, "Find"), class: "cm-textfield", name: "search", form: "", "main-field": "true", onchange: this.commit, onkeyup: this.commit }), this.replaceField = s114("input", { value: n14.replace, placeholder: f2(e7, "Replace"), "aria-label": f2(e7, "Replace"), class: "cm-textfield", name: "replace", form: "", onchange: this.commit, onkeyup: this.commit }), this.caseField = s114("input", { type: "checkbox", name: "case", form: "", checked: n14.caseSensitive, onchange: this.commit }), this.reField = s114("input", { type: "checkbox", name: "re", form: "", checked: n14.regexp, onchange: this.commit }), this.wordField = s114("input", { type: "checkbox", name: "word", form: "", checked: n14.wholeWord, onchange: this.commit });
    function r2(i12, s212, l11) {
      return s114("button", { class: "cm-button", name: i12, onclick: s212, type: "button" }, l11);
    }
    this.dom = s114("div", { onkeydown: (i12) => this.keydown(i12), class: "cm-search" }, [this.searchField, r2("next", () => B4(e7), [f2(e7, "next")]), r2("prev", () => N8(e7), [f2(e7, "previous")]), r2("select", () => Ve7(e7), [f2(e7, "all")]), s114("label", null, [this.caseField, f2(e7, "match case")]), s114("label", null, [this.reField, f2(e7, "regexp")]), s114("label", null, [this.wordField, f2(e7, "by word")]), ...e7.state.readOnly ? [] : [s114("br"), this.replaceField, r2("replace", () => le8(e7), [f2(e7, "replace")]), r2("replaceAll", () => Ke7(e7), [f2(e7, "replace all")])], s114("button", { name: "close", onclick: () => Me7(e7), "aria-label": f2(e7, "close"), type: "button" }, ["Ã—"])]);
  }
  commit() {
    let e7 = new O8({ search: this.searchField.value, caseSensitive: this.caseField.checked, regexp: this.reField.checked, wholeWord: this.wordField.checked, replace: this.replaceField.value });
    e7.eq(this.query) || (this.query = e7, this.view.dispatch({ effects: L7.of(e7) }));
  }
  keydown(e7) {
    ol(this.view, e7, "search-panel") ? e7.preventDefault() : e7.keyCode == 13 && e7.target == this.searchField ? (e7.preventDefault(), (e7.shiftKey ? N8 : B4)(this.view)) : e7.keyCode == 13 && e7.target == this.replaceField && (e7.preventDefault(), le8(this.view));
  }
  update(e7) {
    for (let n14 of e7.transactions) for (let r2 of n14.effects) r2.is(L7) && !r2.value.eq(this.query) && this.setQuery(r2.value);
  }
  setQuery(e7) {
    this.query = e7, this.searchField.value = e7.search, this.replaceField.value = e7.replace, this.caseField.checked = e7.caseSensitive, this.reField.checked = e7.regexp, this.wordField.checked = e7.wholeWord;
  }
  mount() {
    this.searchField.select();
  }
  get pos() {
    return 80;
  }
  get top() {
    return this.view.state.facet(v3).top;
  }
};
function f2(t8, e7) {
  return t8.state.phrase(e7);
}
var F9 = 30;
var q6 = /[\s\.,:;?!]/;
function ee5(t8, { from: e7, to: n14 }) {
  let r2 = t8.state.doc.lineAt(e7), i12 = t8.state.doc.lineAt(n14).to, s212 = Math.max(r2.from, e7 - F9), l11 = Math.min(i12, n14 + F9), o = t8.state.sliceDoc(s212, l11);
  if (s212 != r2.from) {
    for (let c3 = 0; c3 < F9; c3++) if (!q6.test(o[c3 + 1]) && q6.test(o[c3])) {
      o = o.slice(c3);
      break;
    }
  }
  if (l11 != i12) {
    for (let c3 = o.length - 1; c3 > o.length - F9; c3--) if (!q6.test(o[c3 - 1]) && q6.test(o[c3])) {
      o = o.slice(0, c3);
      break;
    }
  }
  return A2.announce.of(`${t8.state.phrase("current match")}. ${o} ${t8.state.phrase("on line")} ${r2.number}.`);
}
var Ge6 = A2.baseTheme({ ".cm-panel.cm-search": { padding: "2px 6px 4px", position: "relative", "& [name=close]": { position: "absolute", top: "0", right: "4px", backgroundColor: "inherit", border: "none", font: "inherit", padding: 0, margin: 0 }, "& input, & button, & label": { margin: ".2em .6em .2em 0" }, "& input[type=checkbox]": { marginRight: ".2em" }, "& label": { fontSize: "80%", whiteSpace: "pre" } }, "&light .cm-searchMatch": { backgroundColor: "#ffff0054" }, "&dark .cm-searchMatch": { backgroundColor: "#00ffff8a" }, "&light .cm-searchMatch-selected": { backgroundColor: "#ff6a0054" }, "&dark .cm-searchMatch-selected": { backgroundColor: "#ff00ff8a" } });
var U9 = [x5, ht.low(Ne9), Ge6];

// https://esm.sh/v135/@codemirror/view@6.34.2/denonext/view.mjs
function jt6(s212) {
  let t8;
  return s212.nodeType == 11 ? t8 = s212.getSelection ? s212 : s212.ownerDocument : t8 = s212, t8.getSelection();
}
function Xe7(s212, t8) {
  return t8 ? s212 == t8 || s212.contains(t8.nodeType != 1 ? t8.parentNode : t8) : false;
}
function ue7(s212, t8) {
  if (!t8.anchorNode) return false;
  try {
    return Xe7(s212, t8.anchorNode);
  } catch {
    return false;
  }
}
function At6(s212) {
  return s212.nodeType == 3 ? pt5(s212, 0, s212.nodeValue.length).getClientRects() : s212.nodeType == 1 ? s212.getClientRects() : [];
}
function Vt6(s212, t8, e7, i12) {
  return e7 ? Yi3(s212, t8, e7, i12, -1) || Yi3(s212, t8, e7, i12, 1) : false;
}
function ut5(s212) {
  for (var t8 = 0; ; t8++) if (s212 = s212.previousSibling, !s212) return t8;
}
function xe9(s212) {
  return s212.nodeType == 1 && /^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(s212.nodeName);
}
function Yi3(s212, t8, e7, i12, n14) {
  for (; ; ) {
    if (s212 == e7 && t8 == i12) return true;
    if (t8 == (n14 < 0 ? 0 : U10(s212))) {
      if (s212.nodeName == "DIV") return false;
      let o = s212.parentNode;
      if (!o || o.nodeType != 1) return false;
      t8 = ut5(s212) + (n14 < 0 ? 0 : 1), s212 = o;
    } else if (s212.nodeType == 1) {
      if (s212 = s212.childNodes[t8 + (n14 < 0 ? -1 : 0)], s212.nodeType == 1 && s212.contentEditable == "false") return false;
      t8 = n14 < 0 ? U10(s212) : 0;
    } else return false;
  }
}
function U10(s212) {
  return s212.nodeType == 3 ? s212.nodeValue.length : s212.childNodes.length;
}
function te8(s212, t8) {
  let e7 = t8 ? s212.left : s212.right;
  return { left: e7, right: e7, top: s212.top, bottom: s212.bottom };
}
function to3(s212) {
  let t8 = s212.visualViewport;
  return t8 ? { left: 0, right: t8.width, top: 0, bottom: t8.height } : { left: 0, right: s212.innerWidth, top: 0, bottom: s212.innerHeight };
}
function Vs2(s212, t8) {
  let e7 = t8.width / s212.offsetWidth, i12 = t8.height / s212.offsetHeight;
  return (e7 > 0.995 && e7 < 1.005 || !isFinite(e7) || Math.abs(t8.width - s212.offsetWidth) < 1) && (e7 = 1), (i12 > 0.995 && i12 < 1.005 || !isFinite(i12) || Math.abs(t8.height - s212.offsetHeight) < 1) && (i12 = 1), { scaleX: e7, scaleY: i12 };
}
function eo4(s212, t8, e7, i12, n14, o, r2, l11) {
  let h3 = s212.ownerDocument, c3 = h3.defaultView || window;
  for (let a2 = s212, f6 = false; a2 && !f6; ) if (a2.nodeType == 1) {
    let d4, u3 = a2 == h3.body, p3 = 1, g8 = 1;
    if (u3) d4 = to3(c3);
    else {
      if (/^(fixed|sticky)$/.test(getComputedStyle(a2).position) && (f6 = true), a2.scrollHeight <= a2.clientHeight && a2.scrollWidth <= a2.clientWidth) {
        a2 = a2.assignedSlot || a2.parentNode;
        continue;
      }
      let w14 = a2.getBoundingClientRect();
      ({ scaleX: p3, scaleY: g8 } = Vs2(a2, w14)), d4 = { left: w14.left, right: w14.left + a2.clientWidth * p3, top: w14.top, bottom: w14.top + a2.clientHeight * g8 };
    }
    let b12 = 0, m11 = 0;
    if (n14 == "nearest") t8.top < d4.top ? (m11 = -(d4.top - t8.top + r2), e7 > 0 && t8.bottom > d4.bottom + m11 && (m11 = t8.bottom - d4.bottom + m11 + r2)) : t8.bottom > d4.bottom && (m11 = t8.bottom - d4.bottom + r2, e7 < 0 && t8.top - m11 < d4.top && (m11 = -(d4.top + m11 - t8.top + r2)));
    else {
      let w14 = t8.bottom - t8.top, v10 = d4.bottom - d4.top;
      m11 = (n14 == "center" && w14 <= v10 ? t8.top + w14 / 2 - v10 / 2 : n14 == "start" || n14 == "center" && e7 < 0 ? t8.top - r2 : t8.bottom - v10 + r2) - d4.top;
    }
    if (i12 == "nearest" ? t8.left < d4.left ? (b12 = -(d4.left - t8.left + o), e7 > 0 && t8.right > d4.right + b12 && (b12 = t8.right - d4.right + b12 + o)) : t8.right > d4.right && (b12 = t8.right - d4.right + o, e7 < 0 && t8.left < d4.left + b12 && (b12 = -(d4.left + b12 - t8.left + o))) : b12 = (i12 == "center" ? t8.left + (t8.right - t8.left) / 2 - (d4.right - d4.left) / 2 : i12 == "start" == l11 ? t8.left - o : t8.right - (d4.right - d4.left) + o) - d4.left, b12 || m11) if (u3) c3.scrollBy(b12, m11);
    else {
      let w14 = 0, v10 = 0;
      if (m11) {
        let x11 = a2.scrollTop;
        a2.scrollTop += m11 / g8, v10 = (a2.scrollTop - x11) * g8;
      }
      if (b12) {
        let x11 = a2.scrollLeft;
        a2.scrollLeft += b12 / p3, w14 = (a2.scrollLeft - x11) * p3;
      }
      t8 = { left: t8.left - w14, top: t8.top - v10, right: t8.right - w14, bottom: t8.bottom - v10 }, w14 && Math.abs(w14 - b12) < 1 && (i12 = "nearest"), v10 && Math.abs(v10 - m11) < 1 && (n14 = "nearest");
    }
    if (u3) break;
    a2 = a2.assignedSlot || a2.parentNode;
  } else if (a2.nodeType == 11) a2 = a2.host;
  else break;
}
function io4(s212) {
  let t8 = s212.ownerDocument, e7, i12;
  for (let n14 = s212.parentNode; n14 && !(n14 == t8.body || e7 && i12); ) if (n14.nodeType == 1) !i12 && n14.scrollHeight > n14.clientHeight && (i12 = n14), !e7 && n14.scrollWidth > n14.clientWidth && (e7 = n14), n14 = n14.assignedSlot || n14.parentNode;
  else if (n14.nodeType == 11) n14 = n14.host;
  else break;
  return { x: e7, y: i12 };
}
var Ge7 = class {
  constructor() {
    this.anchorNode = null, this.anchorOffset = 0, this.focusNode = null, this.focusOffset = 0;
  }
  eq(t8) {
    return this.anchorNode == t8.anchorNode && this.anchorOffset == t8.anchorOffset && this.focusNode == t8.focusNode && this.focusOffset == t8.focusOffset;
  }
  setRange(t8) {
    let { anchorNode: e7, focusNode: i12 } = t8;
    this.set(e7, Math.min(t8.anchorOffset, e7 ? U10(e7) : 0), i12, Math.min(t8.focusOffset, i12 ? U10(i12) : 0));
  }
  set(t8, e7, i12, n14) {
    this.anchorNode = t8, this.anchorOffset = e7, this.focusNode = i12, this.focusOffset = n14;
  }
};
var yt5 = null;
function Fs4(s212) {
  if (s212.setActive) return s212.setActive();
  if (yt5) return s212.focus(yt5);
  let t8 = [];
  for (let e7 = s212; e7 && (t8.push(e7, e7.scrollTop, e7.scrollLeft), e7 != e7.ownerDocument); e7 = e7.parentNode) ;
  if (s212.focus(yt5 == null ? { get preventScroll() {
    return yt5 = { preventScroll: true }, true;
  } } : void 0), !yt5) {
    yt5 = false;
    for (let e7 = 0; e7 < t8.length; ) {
      let i12 = t8[e7++], n14 = t8[e7++], o = t8[e7++];
      i12.scrollTop != n14 && (i12.scrollTop = n14), i12.scrollLeft != o && (i12.scrollLeft = o);
    }
  }
}
var _i4;
function pt5(s212, t8, e7 = t8) {
  let i12 = _i4 || (_i4 = document.createRange());
  return i12.setEnd(s212, e7), i12.setStart(s212, t8), i12;
}
function Mt5(s212, t8, e7, i12) {
  let n14 = { key: t8, code: t8, keyCode: e7, which: e7, cancelable: true };
  i12 && ({ altKey: n14.altKey, ctrlKey: n14.ctrlKey, shiftKey: n14.shiftKey, metaKey: n14.metaKey } = i12);
  let o = new KeyboardEvent("keydown", n14);
  o.synthetic = true, s212.dispatchEvent(o);
  let r2 = new KeyboardEvent("keyup", n14);
  return r2.synthetic = true, s212.dispatchEvent(r2), o.defaultPrevented || r2.defaultPrevented;
}
function so4(s212) {
  for (; s212; ) {
    if (s212 && (s212.nodeType == 9 || s212.nodeType == 11 && s212.host)) return s212;
    s212 = s212.assignedSlot || s212.parentNode;
  }
  return null;
}
function Ws4(s212) {
  for (; s212.attributes.length; ) s212.removeAttributeNode(s212.attributes[0]);
}
function no4(s212, t8) {
  let e7 = t8.focusNode, i12 = t8.focusOffset;
  if (!e7 || t8.anchorNode != e7 || t8.anchorOffset != i12) return false;
  for (i12 = Math.min(i12, U10(e7)); ; ) if (i12) {
    if (e7.nodeType != 1) return false;
    let n14 = e7.childNodes[i12 - 1];
    n14.contentEditable == "false" ? i12-- : (e7 = n14, i12 = U10(e7));
  } else {
    if (e7 == s212) return true;
    i12 = ut5(e7), e7 = e7.parentNode;
  }
}
function zs4(s212) {
  return s212.scrollTop > Math.max(1, s212.scrollHeight - s212.clientHeight - 4);
}
function Is4(s212, t8) {
  for (let e7 = s212, i12 = t8; ; ) {
    if (e7.nodeType == 3 && i12 > 0) return { node: e7, offset: i12 };
    if (e7.nodeType == 1 && i12 > 0) {
      if (e7.contentEditable == "false") return null;
      e7 = e7.childNodes[i12 - 1], i12 = U10(e7);
    } else if (e7.parentNode && !xe9(e7)) i12 = ut5(e7), e7 = e7.parentNode;
    else return null;
  }
}
function Ks4(s212, t8) {
  for (let e7 = s212, i12 = t8; ; ) {
    if (e7.nodeType == 3 && i12 < e7.nodeValue.length) return { node: e7, offset: i12 };
    if (e7.nodeType == 1 && i12 < e7.childNodes.length) {
      if (e7.contentEditable == "false") return null;
      e7 = e7.childNodes[i12], i12 = 0;
    } else if (e7.parentNode && !xe9(e7)) i12 = ut5(e7) + 1, e7 = e7.parentNode;
    else return null;
  }
}
var V10 = class s115 {
  constructor(t8, e7, i12 = true) {
    this.node = t8, this.offset = e7, this.precise = i12;
  }
  static before(t8, e7) {
    return new s115(t8.parentNode, ut5(t8), e7);
  }
  static after(t8, e7) {
    return new s115(t8.parentNode, ut5(t8) + 1, e7);
  }
};
var Fi4 = [];
var R8 = class s116 {
  constructor() {
    this.parent = null, this.dom = null, this.flags = 2;
  }
  get overrideDOMText() {
    return null;
  }
  get posAtStart() {
    return this.parent ? this.parent.posBefore(this) : 0;
  }
  get posAtEnd() {
    return this.posAtStart + this.length;
  }
  posBefore(t8) {
    let e7 = this.posAtStart;
    for (let i12 of this.children) {
      if (i12 == t8) return e7;
      e7 += i12.length + i12.breakAfter;
    }
    throw new RangeError("Invalid child in posBefore");
  }
  posAfter(t8) {
    return this.posBefore(t8) + t8.length;
  }
  sync(t8, e7) {
    if (this.flags & 2) {
      let i12 = this.dom, n14 = null, o;
      for (let r2 of this.children) {
        if (r2.flags & 7) {
          if (!r2.dom && (o = n14 ? n14.nextSibling : i12.firstChild)) {
            let l11 = s116.get(o);
            (!l11 || !l11.parent && l11.canReuseDOM(r2)) && r2.reuseDOM(o);
          }
          r2.sync(t8, e7), r2.flags &= -8;
        }
        if (o = n14 ? n14.nextSibling : i12.firstChild, e7 && !e7.written && e7.node == i12 && o != r2.dom && (e7.written = true), r2.dom.parentNode == i12) for (; o && o != r2.dom; ) o = Xi4(o);
        else i12.insertBefore(r2.dom, o);
        n14 = r2.dom;
      }
      for (o = n14 ? n14.nextSibling : i12.firstChild, o && e7 && e7.node == i12 && (e7.written = true); o; ) o = Xi4(o);
    } else if (this.flags & 1) for (let i12 of this.children) i12.flags & 7 && (i12.sync(t8, e7), i12.flags &= -8);
  }
  reuseDOM(t8) {
  }
  localPosFromDOM(t8, e7) {
    let i12;
    if (t8 == this.dom) i12 = this.dom.childNodes[e7];
    else {
      let n14 = U10(t8) == 0 ? 0 : e7 == 0 ? -1 : 1;
      for (; ; ) {
        let o = t8.parentNode;
        if (o == this.dom) break;
        n14 == 0 && o.firstChild != o.lastChild && (t8 == o.firstChild ? n14 = -1 : n14 = 1), t8 = o;
      }
      n14 < 0 ? i12 = t8 : i12 = t8.nextSibling;
    }
    if (i12 == this.dom.firstChild) return 0;
    for (; i12 && !s116.get(i12); ) i12 = i12.nextSibling;
    if (!i12) return this.length;
    for (let n14 = 0, o = 0; ; n14++) {
      let r2 = this.children[n14];
      if (r2.dom == i12) return o;
      o += r2.length + r2.breakAfter;
    }
  }
  domBoundsAround(t8, e7, i12 = 0) {
    let n14 = -1, o = -1, r2 = -1, l11 = -1;
    for (let h3 = 0, c3 = i12, a2 = i12; h3 < this.children.length; h3++) {
      let f6 = this.children[h3], d4 = c3 + f6.length;
      if (c3 < t8 && d4 > e7) return f6.domBoundsAround(t8, e7, c3);
      if (d4 >= t8 && n14 == -1 && (n14 = h3, o = c3), c3 > e7 && f6.dom.parentNode == this.dom) {
        r2 = h3, l11 = a2;
        break;
      }
      a2 = d4, c3 = d4 + f6.breakAfter;
    }
    return { from: o, to: l11 < 0 ? i12 + this.length : l11, startDOM: (n14 ? this.children[n14 - 1].dom.nextSibling : null) || this.dom.firstChild, endDOM: r2 < this.children.length && r2 >= 0 ? this.children[r2].dom : null };
  }
  markDirty(t8 = false) {
    this.flags |= 2, this.markParentsDirty(t8);
  }
  markParentsDirty(t8) {
    for (let e7 = this.parent; e7; e7 = e7.parent) {
      if (t8 && (e7.flags |= 2), e7.flags & 1) return;
      e7.flags |= 1, t8 = false;
    }
  }
  setParent(t8) {
    this.parent != t8 && (this.parent = t8, this.flags & 7 && this.markParentsDirty(true));
  }
  setDOM(t8) {
    this.dom != t8 && (this.dom && (this.dom.cmView = null), this.dom = t8, t8.cmView = this);
  }
  get rootView() {
    for (let t8 = this; ; ) {
      let e7 = t8.parent;
      if (!e7) return t8;
      t8 = e7;
    }
  }
  replaceChildren(t8, e7, i12 = Fi4) {
    this.markDirty();
    for (let n14 = t8; n14 < e7; n14++) {
      let o = this.children[n14];
      o.parent == this && i12.indexOf(o) < 0 && o.destroy();
    }
    i12.length < 250 ? this.children.splice(t8, e7 - t8, ...i12) : this.children = [].concat(this.children.slice(0, t8), i12, this.children.slice(e7));
    for (let n14 = 0; n14 < i12.length; n14++) i12[n14].setParent(this);
  }
  ignoreMutation(t8) {
    return false;
  }
  ignoreEvent(t8) {
    return false;
  }
  childCursor(t8 = this.length) {
    return new ve7(this.children, t8, this.children.length);
  }
  childPos(t8, e7 = 1) {
    return this.childCursor().findPos(t8, e7);
  }
  toString() {
    let t8 = this.constructor.name.replace("View", "");
    return t8 + (this.children.length ? "(" + this.children.join() + ")" : this.length ? "[" + (t8 == "Text" ? this.text : this.length) + "]" : "") + (this.breakAfter ? "#" : "");
  }
  static get(t8) {
    return t8.cmView;
  }
  get isEditable() {
    return true;
  }
  get isWidget() {
    return false;
  }
  get isHidden() {
    return false;
  }
  merge(t8, e7, i12, n14, o, r2) {
    return false;
  }
  become(t8) {
    return false;
  }
  canReuseDOM(t8) {
    return t8.constructor == this.constructor && !((this.flags | t8.flags) & 8);
  }
  getSide() {
    return 0;
  }
  destroy() {
    for (let t8 of this.children) t8.parent == this && t8.destroy();
    this.parent = null;
  }
};
R8.prototype.breakAfter = 0;
function Xi4(s212) {
  let t8 = s212.nextSibling;
  return s212.parentNode.removeChild(s212), t8;
}
var ve7 = class {
  constructor(t8, e7, i12) {
    this.children = t8, this.pos = e7, this.i = i12, this.off = 0;
  }
  findPos(t8, e7 = 1) {
    for (; ; ) {
      if (t8 > this.pos || t8 == this.pos && (e7 > 0 || this.i == 0 || this.children[this.i - 1].breakAfter)) return this.off = t8 - this.pos, this;
      let i12 = this.children[--this.i];
      this.pos -= i12.length + i12.breakAfter;
    }
  }
};
function qs4(s212, t8, e7, i12, n14, o, r2, l11, h3) {
  let { children: c3 } = s212, a2 = c3.length ? c3[t8] : null, f6 = o.length ? o[o.length - 1] : null, d4 = f6 ? f6.breakAfter : r2;
  if (!(t8 == i12 && a2 && !r2 && !d4 && o.length < 2 && a2.merge(e7, n14, o.length ? f6 : null, e7 == 0, l11, h3))) {
    if (i12 < c3.length) {
      let u3 = c3[i12];
      u3 && (n14 < u3.length || u3.breakAfter && f6?.breakAfter) ? (t8 == i12 && (u3 = u3.split(n14), n14 = 0), !d4 && f6 && u3.merge(0, n14, f6, true, 0, h3) ? o[o.length - 1] = u3 : ((n14 || u3.children.length && !u3.children[0].length) && u3.merge(0, n14, null, false, 0, h3), o.push(u3))) : u3?.breakAfter && (f6 ? f6.breakAfter = 1 : r2 = 1), i12++;
    }
    for (a2 && (a2.breakAfter = r2, e7 > 0 && (!r2 && o.length && a2.merge(e7, a2.length, o[0], false, l11, 0) ? a2.breakAfter = o.shift().breakAfter : (e7 < a2.length || a2.children.length && a2.children[a2.children.length - 1].length == 0) && a2.merge(e7, a2.length, null, false, l11, 0), t8++)); t8 < i12 && o.length; ) if (c3[i12 - 1].become(o[o.length - 1])) i12--, o.pop(), h3 = o.length ? 0 : l11;
    else if (c3[t8].become(o[0])) t8++, o.shift(), l11 = o.length ? 0 : h3;
    else break;
    !o.length && t8 && i12 < c3.length && !c3[t8 - 1].breakAfter && c3[i12].merge(0, 0, c3[t8 - 1], false, l11, h3) && t8--, (t8 < i12 || o.length) && s212.replaceChildren(t8, i12, o);
  }
}
function js4(s212, t8, e7, i12, n14, o) {
  let r2 = s212.childCursor(), { i: l11, off: h3 } = r2.findPos(e7, 1), { i: c3, off: a2 } = r2.findPos(t8, -1), f6 = t8 - e7;
  for (let d4 of i12) f6 += d4.length;
  s212.length += f6, qs4(s212, c3, a2, l11, h3, i12, 0, n14, o);
}
var W8 = typeof navigator < "u" ? navigator : { userAgent: "", vendor: "", platform: "" };
var $e8 = typeof document < "u" ? document : { documentElement: { style: {} } };
var Ue7 = /Edge\/(\d+)/.exec(W8.userAgent);
var Ys4 = /MSIE \d/.test(W8.userAgent);
var Qe6 = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(W8.userAgent);
var Ne10 = !!(Ys4 || Qe6 || Ue7);
var Gi4 = !Ne10 && /gecko\/(\d+)/i.test(W8.userAgent);
var ze9 = !Ne10 && /Chrome\/(\d+)/.exec(W8.userAgent);
var $i4 = "webkitFontSmoothing" in $e8.documentElement.style;
var _s4 = !Ne10 && /Apple Computer/.test(W8.vendor);
var Ui4 = _s4 && (/Mobile\/\w+/.test(W8.userAgent) || W8.maxTouchPoints > 2);
var y9 = { mac: Ui4 || /Mac/.test(W8.platform), windows: /Win/.test(W8.platform), linux: /Linux|X11/.test(W8.platform), ie: Ne10, ie_version: Ys4 ? $e8.documentMode || 6 : Qe6 ? +Qe6[1] : Ue7 ? +Ue7[1] : 0, gecko: Gi4, gecko_version: Gi4 ? +(/Firefox\/(\d+)/.exec(W8.userAgent) || [0, 0])[1] : 0, chrome: !!ze9, chrome_version: ze9 ? +ze9[1] : 0, ios: Ui4, android: /Android\b/.test(W8.userAgent), webkit: $i4, safari: _s4, webkit_version: $i4 ? +(/\bAppleWebKit\/(\d+)/.exec(W8.userAgent) || [0, 0])[1] : 0, tabSize: $e8.documentElement.style.tabSize != null ? "tab-size" : "-moz-tab-size" };
var oo4 = 256;
var Q9 = class s117 extends R8 {
  constructor(t8) {
    super(), this.text = t8;
  }
  get length() {
    return this.text.length;
  }
  createDOM(t8) {
    this.setDOM(t8 || document.createTextNode(this.text));
  }
  sync(t8, e7) {
    this.dom || this.createDOM(), this.dom.nodeValue != this.text && (e7 && e7.node == this.dom && (e7.written = true), this.dom.nodeValue = this.text);
  }
  reuseDOM(t8) {
    t8.nodeType == 3 && this.createDOM(t8);
  }
  merge(t8, e7, i12) {
    return this.flags & 8 || i12 && (!(i12 instanceof s117) || this.length - (e7 - t8) + i12.length > oo4 || i12.flags & 8) ? false : (this.text = this.text.slice(0, t8) + (i12 ? i12.text : "") + this.text.slice(e7), this.markDirty(), true);
  }
  split(t8) {
    let e7 = new s117(this.text.slice(t8));
    return this.text = this.text.slice(0, t8), this.markDirty(), e7.flags |= this.flags & 8, e7;
  }
  localPosFromDOM(t8, e7) {
    return t8 == this.dom ? e7 : e7 ? this.text.length : 0;
  }
  domAtPos(t8) {
    return new V10(this.dom, t8);
  }
  domBoundsAround(t8, e7, i12) {
    return { from: i12, to: i12 + this.length, startDOM: this.dom, endDOM: this.dom.nextSibling };
  }
  coordsAt(t8, e7) {
    return ro4(this.dom, t8, e7);
  }
};
var rt6 = class s118 extends R8 {
  constructor(t8, e7 = [], i12 = 0) {
    super(), this.mark = t8, this.children = e7, this.length = i12;
    for (let n14 of e7) n14.setParent(this);
  }
  setAttrs(t8) {
    if (Ws4(t8), this.mark.class && (t8.className = this.mark.class), this.mark.attrs) for (let e7 in this.mark.attrs) t8.setAttribute(e7, this.mark.attrs[e7]);
    return t8;
  }
  canReuseDOM(t8) {
    return super.canReuseDOM(t8) && !((this.flags | t8.flags) & 8);
  }
  reuseDOM(t8) {
    t8.nodeName == this.mark.tagName.toUpperCase() && (this.setDOM(t8), this.flags |= 6);
  }
  sync(t8, e7) {
    this.dom ? this.flags & 4 && this.setAttrs(this.dom) : this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))), super.sync(t8, e7);
  }
  merge(t8, e7, i12, n14, o, r2) {
    return i12 && (!(i12 instanceof s118 && i12.mark.eq(this.mark)) || t8 && o <= 0 || e7 < this.length && r2 <= 0) ? false : (js4(this, t8, e7, i12 ? i12.children.slice() : [], o - 1, r2 - 1), this.markDirty(), true);
  }
  split(t8) {
    let e7 = [], i12 = 0, n14 = -1, o = 0;
    for (let l11 of this.children) {
      let h3 = i12 + l11.length;
      h3 > t8 && e7.push(i12 < t8 ? l11.split(t8 - i12) : l11), n14 < 0 && i12 >= t8 && (n14 = o), i12 = h3, o++;
    }
    let r2 = this.length - t8;
    return this.length = t8, n14 > -1 && (this.children.length = n14, this.markDirty()), new s118(this.mark, e7, r2);
  }
  domAtPos(t8) {
    return Xs4(this, t8);
  }
  coordsAt(t8, e7) {
    return $s4(this, t8, e7);
  }
};
function ro4(s212, t8, e7) {
  let i12 = s212.nodeValue.length;
  t8 > i12 && (t8 = i12);
  let n14 = t8, o = t8, r2 = 0;
  t8 == 0 && e7 < 0 || t8 == i12 && e7 >= 0 ? y9.chrome || y9.gecko || (t8 ? (n14--, r2 = 1) : o < i12 && (o++, r2 = -1)) : e7 < 0 ? n14-- : o < i12 && o++;
  let l11 = pt5(s212, n14, o).getClientRects();
  if (!l11.length) return null;
  let h3 = l11[(r2 ? r2 < 0 : e7 >= 0) ? 0 : l11.length - 1];
  return y9.safari && !r2 && h3.width == 0 && (h3 = Array.prototype.find.call(l11, (c3) => c3.width) || h3), r2 ? te8(h3, r2 < 0) : h3 || null;
}
var Yt6 = class s119 extends R8 {
  static create(t8, e7, i12) {
    return new s119(t8, e7, i12);
  }
  constructor(t8, e7, i12) {
    super(), this.widget = t8, this.length = e7, this.side = i12, this.prevWidget = null;
  }
  split(t8) {
    let e7 = s119.create(this.widget, this.length - t8, this.side);
    return this.length -= t8, e7;
  }
  sync(t8) {
    (!this.dom || !this.widget.updateDOM(this.dom, t8)) && (this.dom && this.prevWidget && this.prevWidget.destroy(this.dom), this.prevWidget = null, this.setDOM(this.widget.toDOM(t8)), this.widget.editable || (this.dom.contentEditable = "false"));
  }
  getSide() {
    return this.side;
  }
  merge(t8, e7, i12, n14, o, r2) {
    return i12 && (!(i12 instanceof s119) || !this.widget.compare(i12.widget) || t8 > 0 && o <= 0 || e7 < this.length && r2 <= 0) ? false : (this.length = t8 + (i12 ? i12.length : 0) + (this.length - e7), true);
  }
  become(t8) {
    return t8 instanceof s119 && t8.side == this.side && this.widget.constructor == t8.widget.constructor ? (this.widget.compare(t8.widget) || this.markDirty(true), this.dom && !this.prevWidget && (this.prevWidget = this.widget), this.widget = t8.widget, this.length = t8.length, true) : false;
  }
  ignoreMutation() {
    return true;
  }
  ignoreEvent(t8) {
    return this.widget.ignoreEvent(t8);
  }
  get overrideDOMText() {
    if (this.length == 0) return m.empty;
    let t8 = this;
    for (; t8.parent; ) t8 = t8.parent;
    let { view: e7 } = t8, i12 = e7 && e7.state.doc, n14 = this.posAtStart;
    return i12 ? i12.slice(n14, n14 + this.length) : m.empty;
  }
  domAtPos(t8) {
    return (this.length ? t8 == 0 : this.side > 0) ? V10.before(this.dom) : V10.after(this.dom, t8 == this.length);
  }
  domBoundsAround() {
    return null;
  }
  coordsAt(t8, e7) {
    let i12 = this.widget.coordsAt(this.dom, t8, e7);
    if (i12) return i12;
    let n14 = this.dom.getClientRects(), o = null;
    if (!n14.length) return null;
    let r2 = this.side ? this.side < 0 : t8 > 0;
    for (let l11 = r2 ? n14.length - 1 : 0; o = n14[l11], !(t8 > 0 ? l11 == 0 : l11 == n14.length - 1 || o.top < o.bottom); l11 += r2 ? -1 : 1) ;
    return te8(o, !r2);
  }
  get isEditable() {
    return false;
  }
  get isWidget() {
    return true;
  }
  get isHidden() {
    return this.widget.isHidden;
  }
  destroy() {
    super.destroy(), this.dom && this.widget.destroy(this.dom);
  }
};
var _t6 = class s120 extends R8 {
  constructor(t8) {
    super(), this.side = t8;
  }
  get length() {
    return 0;
  }
  merge() {
    return false;
  }
  become(t8) {
    return t8 instanceof s120 && t8.side == this.side;
  }
  split() {
    return new s120(this.side);
  }
  sync() {
    if (!this.dom) {
      let t8 = document.createElement("img");
      t8.className = "cm-widgetBuffer", t8.setAttribute("aria-hidden", "true"), this.setDOM(t8);
    }
  }
  getSide() {
    return this.side;
  }
  domAtPos(t8) {
    return this.side > 0 ? V10.before(this.dom) : V10.after(this.dom);
  }
  localPosFromDOM() {
    return 0;
  }
  domBoundsAround() {
    return null;
  }
  coordsAt(t8) {
    return this.dom.getBoundingClientRect();
  }
  get overrideDOMText() {
    return m.empty;
  }
  get isHidden() {
    return true;
  }
};
Q9.prototype.children = Yt6.prototype.children = _t6.prototype.children = Fi4;
function Xs4(s212, t8) {
  let e7 = s212.dom, { children: i12 } = s212, n14 = 0;
  for (let o = 0; n14 < i12.length; n14++) {
    let r2 = i12[n14], l11 = o + r2.length;
    if (!(l11 == o && r2.getSide() <= 0)) {
      if (t8 > o && t8 < l11 && r2.dom.parentNode == e7) return r2.domAtPos(t8 - o);
      if (t8 <= o) break;
      o = l11;
    }
  }
  for (let o = n14; o > 0; o--) {
    let r2 = i12[o - 1];
    if (r2.dom.parentNode == e7) return r2.domAtPos(r2.length);
  }
  for (let o = n14; o < i12.length; o++) {
    let r2 = i12[o];
    if (r2.dom.parentNode == e7) return r2.domAtPos(0);
  }
  return new V10(e7, 0);
}
function Gs4(s212, t8, e7) {
  let i12, { children: n14 } = s212;
  e7 > 0 && t8 instanceof rt6 && n14.length && (i12 = n14[n14.length - 1]) instanceof rt6 && i12.mark.eq(t8.mark) ? Gs4(i12, t8.children[0], e7 - 1) : (n14.push(t8), t8.setParent(s212)), s212.length += t8.length;
}
function $s4(s212, t8, e7) {
  let i12 = null, n14 = -1, o = null, r2 = -1;
  function l11(c3, a2) {
    for (let f6 = 0, d4 = 0; f6 < c3.children.length && d4 <= a2; f6++) {
      let u3 = c3.children[f6], p3 = d4 + u3.length;
      p3 >= a2 && (u3.children.length ? l11(u3, a2 - d4) : (!o || o.isHidden && e7 > 0) && (p3 > a2 || d4 == p3 && u3.getSide() > 0) ? (o = u3, r2 = a2 - d4) : (d4 < a2 || d4 == p3 && u3.getSide() < 0 && !u3.isHidden) && (i12 = u3, n14 = a2 - d4)), d4 = p3;
    }
  }
  l11(s212, t8);
  let h3 = (e7 < 0 ? i12 : o) || i12 || o;
  return h3 ? h3.coordsAt(Math.max(0, h3 == i12 ? n14 : r2), e7) : lo4(s212);
}
function lo4(s212) {
  let t8 = s212.dom.lastChild;
  if (!t8) return s212.dom.getBoundingClientRect();
  let e7 = At6(t8);
  return e7[e7.length - 1] || null;
}
function Je5(s212, t8) {
  for (let e7 in s212) e7 == "class" && t8.class ? t8.class += " " + s212.class : e7 == "style" && t8.style ? t8.style += ";" + s212.style : t8[e7] = s212[e7];
  return t8;
}
var Qi4 = /* @__PURE__ */ Object.create(null);
function Se6(s212, t8, e7) {
  if (s212 == t8) return true;
  s212 || (s212 = Qi4), t8 || (t8 = Qi4);
  let i12 = Object.keys(s212), n14 = Object.keys(t8);
  if (i12.length - (e7 && i12.indexOf(e7) > -1 ? 1 : 0) != n14.length - (e7 && n14.indexOf(e7) > -1 ? 1 : 0)) return false;
  for (let o of i12) if (o != e7 && (n14.indexOf(o) == -1 || s212[o] !== t8[o])) return false;
  return true;
}
function Ze7(s212, t8, e7) {
  let i12 = false;
  if (t8) for (let n14 in t8) e7 && n14 in e7 || (i12 = true, n14 == "style" ? s212.style.cssText = "" : s212.removeAttribute(n14));
  if (e7) for (let n14 in e7) t8 && t8[n14] == e7[n14] || (i12 = true, n14 == "style" ? s212.style.cssText = e7[n14] : s212.setAttribute(n14, e7[n14]));
  return i12;
}
function ho4(s212) {
  let t8 = /* @__PURE__ */ Object.create(null);
  for (let e7 = 0; e7 < s212.attributes.length; e7++) {
    let i12 = s212.attributes[e7];
    t8[i12.name] = i12.value;
  }
  return t8;
}
var lt6 = class {
  eq(t8) {
    return false;
  }
  updateDOM(t8, e7) {
    return false;
  }
  compare(t8) {
    return this == t8 || this.constructor == t8.constructor && this.eq(t8);
  }
  get estimatedHeight() {
    return -1;
  }
  get lineBreaks() {
    return 0;
  }
  ignoreEvent(t8) {
    return true;
  }
  coordsAt(t8, e7, i12) {
    return null;
  }
  get isHidden() {
    return false;
  }
  get editable() {
    return false;
  }
  destroy(t8) {
  }
};
var F10 = function(s212) {
  return s212[s212.Text = 0] = "Text", s212[s212.WidgetBefore = 1] = "WidgetBefore", s212[s212.WidgetAfter = 2] = "WidgetAfter", s212[s212.WidgetRange = 3] = "WidgetRange", s212;
}(F10 || (F10 = {}));
var O9 = class extends W {
  constructor(t8, e7, i12, n14) {
    super(), this.startSide = t8, this.endSide = e7, this.widget = i12, this.spec = n14;
  }
  get heightRelevant() {
    return false;
  }
  static mark(t8) {
    return new Xt5(t8);
  }
  static widget(t8) {
    let e7 = Math.max(-1e4, Math.min(1e4, t8.side || 0)), i12 = !!t8.block;
    return e7 += i12 && !t8.inlineOrder ? e7 > 0 ? 3e8 : -4e8 : e7 > 0 ? 1e8 : -1e8, new ht6(t8, e7, e7, i12, t8.widget || null, false);
  }
  static replace(t8) {
    let e7 = !!t8.block, i12, n14;
    if (t8.isBlockGap) i12 = -5e8, n14 = 4e8;
    else {
      let { start: o, end: r2 } = Us4(t8, e7);
      i12 = (o ? e7 ? -3e8 : -1 : 5e8) - 1, n14 = (r2 ? e7 ? 2e8 : 1 : -6e8) + 1;
    }
    return new ht6(t8, i12, n14, e7, t8.widget || null, true);
  }
  static line(t8) {
    return new Gt6(t8);
  }
  static set(t8, e7 = false) {
    return T.of(t8, e7);
  }
  hasHeight() {
    return this.widget ? this.widget.estimatedHeight > -1 : false;
  }
};
O9.none = T.empty;
var Xt5 = class s121 extends O9 {
  constructor(t8) {
    let { start: e7, end: i12 } = Us4(t8);
    super(e7 ? -1 : 5e8, i12 ? 1 : -6e8, null, t8), this.tagName = t8.tagName || "span", this.class = t8.class || "", this.attrs = t8.attributes || null;
  }
  eq(t8) {
    var e7, i12;
    return this == t8 || t8 instanceof s121 && this.tagName == t8.tagName && (this.class || ((e7 = this.attrs) === null || e7 === void 0 ? void 0 : e7.class)) == (t8.class || ((i12 = t8.attrs) === null || i12 === void 0 ? void 0 : i12.class)) && Se6(this.attrs, t8.attrs, "class");
  }
  range(t8, e7 = t8) {
    if (t8 >= e7) throw new RangeError("Mark decorations may not be empty");
    return super.range(t8, e7);
  }
};
Xt5.prototype.point = false;
var Gt6 = class s122 extends O9 {
  constructor(t8) {
    super(-2e8, -2e8, null, t8);
  }
  eq(t8) {
    return t8 instanceof s122 && this.spec.class == t8.spec.class && Se6(this.spec.attributes, t8.spec.attributes);
  }
  range(t8, e7 = t8) {
    if (e7 != t8) throw new RangeError("Line decoration ranges must be zero-length");
    return super.range(t8, e7);
  }
};
Gt6.prototype.mapMode = E.TrackBefore;
Gt6.prototype.point = true;
var ht6 = class s123 extends O9 {
  constructor(t8, e7, i12, n14, o, r2) {
    super(e7, i12, o, t8), this.block = n14, this.isReplace = r2, this.mapMode = n14 ? e7 <= 0 ? E.TrackBefore : E.TrackAfter : E.TrackDel;
  }
  get type() {
    return this.startSide != this.endSide ? F10.WidgetRange : this.startSide <= 0 ? F10.WidgetBefore : F10.WidgetAfter;
  }
  get heightRelevant() {
    return this.block || !!this.widget && (this.widget.estimatedHeight >= 5 || this.widget.lineBreaks > 0);
  }
  eq(t8) {
    return t8 instanceof s123 && ao4(this.widget, t8.widget) && this.block == t8.block && this.startSide == t8.startSide && this.endSide == t8.endSide;
  }
  range(t8, e7 = t8) {
    if (this.isReplace && (t8 > e7 || t8 == e7 && this.startSide > 0 && this.endSide <= 0)) throw new RangeError("Invalid range for replacement decoration");
    if (!this.isReplace && e7 != t8) throw new RangeError("Widget decorations can only have zero-length ranges");
    return super.range(t8, e7);
  }
};
ht6.prototype.point = true;
function Us4(s212, t8 = false) {
  let { inclusiveStart: e7, inclusiveEnd: i12 } = s212;
  return e7 == null && (e7 = s212.inclusive), i12 == null && (i12 = s212.inclusive), { start: e7 ?? t8, end: i12 ?? t8 };
}
function ao4(s212, t8) {
  return s212 == t8 || !!(s212 && t8 && s212.compare(t8));
}
function ti4(s212, t8, e7, i12 = 0) {
  let n14 = e7.length - 1;
  n14 >= 0 && e7[n14] + i12 >= s212 ? e7[n14] = Math.max(e7[n14], t8) : e7.push(s212, t8);
}
var P10 = class s124 extends R8 {
  constructor() {
    super(...arguments), this.children = [], this.length = 0, this.prevAttrs = void 0, this.attrs = null, this.breakAfter = 0;
  }
  merge(t8, e7, i12, n14, o, r2) {
    if (i12) {
      if (!(i12 instanceof s124)) return false;
      this.dom || i12.transferDOM(this);
    }
    return n14 && this.setDeco(i12 ? i12.attrs : null), js4(this, t8, e7, i12 ? i12.children.slice() : [], o, r2), true;
  }
  split(t8) {
    let e7 = new s124();
    if (e7.breakAfter = this.breakAfter, this.length == 0) return e7;
    let { i: i12, off: n14 } = this.childPos(t8);
    n14 && (e7.append(this.children[i12].split(n14), 0), this.children[i12].merge(n14, this.children[i12].length, null, false, 0, 0), i12++);
    for (let o = i12; o < this.children.length; o++) e7.append(this.children[o], 0);
    for (; i12 > 0 && this.children[i12 - 1].length == 0; ) this.children[--i12].destroy();
    return this.children.length = i12, this.markDirty(), this.length = t8, e7;
  }
  transferDOM(t8) {
    this.dom && (this.markDirty(), t8.setDOM(this.dom), t8.prevAttrs = this.prevAttrs === void 0 ? this.attrs : this.prevAttrs, this.prevAttrs = void 0, this.dom = null);
  }
  setDeco(t8) {
    Se6(this.attrs, t8) || (this.dom && (this.prevAttrs = this.attrs, this.markDirty()), this.attrs = t8);
  }
  append(t8, e7) {
    Gs4(this, t8, e7);
  }
  addLineDeco(t8) {
    let e7 = t8.spec.attributes, i12 = t8.spec.class;
    e7 && (this.attrs = Je5(e7, this.attrs || {})), i12 && (this.attrs = Je5({ class: i12 }, this.attrs || {}));
  }
  domAtPos(t8) {
    return Xs4(this, t8);
  }
  reuseDOM(t8) {
    t8.nodeName == "DIV" && (this.setDOM(t8), this.flags |= 6);
  }
  sync(t8, e7) {
    var i12;
    this.dom ? this.flags & 4 && (Ws4(this.dom), this.dom.className = "cm-line", this.prevAttrs = this.attrs ? null : void 0) : (this.setDOM(document.createElement("div")), this.dom.className = "cm-line", this.prevAttrs = this.attrs ? null : void 0), this.prevAttrs !== void 0 && (Ze7(this.dom, this.prevAttrs, this.attrs), this.dom.classList.add("cm-line"), this.prevAttrs = void 0), super.sync(t8, e7);
    let n14 = this.dom.lastChild;
    for (; n14 && R8.get(n14) instanceof rt6; ) n14 = n14.lastChild;
    if (!n14 || !this.length || n14.nodeName != "BR" && ((i12 = R8.get(n14)) === null || i12 === void 0 ? void 0 : i12.isEditable) == false && (!y9.ios || !this.children.some((o) => o instanceof Q9))) {
      let o = document.createElement("BR");
      o.cmIgnore = true, this.dom.appendChild(o);
    }
  }
  measureTextSize() {
    if (this.children.length == 0 || this.length > 20) return null;
    let t8 = 0, e7;
    for (let i12 of this.children) {
      if (!(i12 instanceof Q9) || /[^ -~]/.test(i12.text)) return null;
      let n14 = At6(i12.dom);
      if (n14.length != 1) return null;
      t8 += n14[0].width, e7 = n14[0].height;
    }
    return t8 ? { lineHeight: this.dom.getBoundingClientRect().height, charWidth: t8 / this.length, textHeight: e7 } : null;
  }
  coordsAt(t8, e7) {
    let i12 = $s4(this, t8, e7);
    if (!this.children.length && i12 && this.parent) {
      let { heightOracle: n14 } = this.parent.view.viewState, o = i12.bottom - i12.top;
      if (Math.abs(o - n14.lineHeight) < 2 && n14.textHeight < o) {
        let r2 = (o - n14.textHeight) / 2;
        return { top: i12.top + r2, bottom: i12.bottom - r2, left: i12.left, right: i12.left };
      }
    }
    return i12;
  }
  become(t8) {
    return t8 instanceof s124 && this.children.length == 0 && t8.children.length == 0 && Se6(this.attrs, t8.attrs) && this.breakAfter == t8.breakAfter;
  }
  covers() {
    return true;
  }
  static find(t8, e7) {
    for (let i12 = 0, n14 = 0; i12 < t8.children.length; i12++) {
      let o = t8.children[i12], r2 = n14 + o.length;
      if (r2 >= e7) {
        if (o instanceof s124) return o;
        if (r2 > e7) break;
      }
      n14 = r2 + o.breakAfter;
    }
    return null;
  }
};
var dt6 = class s125 extends R8 {
  constructor(t8, e7, i12) {
    super(), this.widget = t8, this.length = e7, this.deco = i12, this.breakAfter = 0, this.prevWidget = null;
  }
  merge(t8, e7, i12, n14, o, r2) {
    return i12 && (!(i12 instanceof s125) || !this.widget.compare(i12.widget) || t8 > 0 && o <= 0 || e7 < this.length && r2 <= 0) ? false : (this.length = t8 + (i12 ? i12.length : 0) + (this.length - e7), true);
  }
  domAtPos(t8) {
    return t8 == 0 ? V10.before(this.dom) : V10.after(this.dom, t8 == this.length);
  }
  split(t8) {
    let e7 = this.length - t8;
    this.length = t8;
    let i12 = new s125(this.widget, e7, this.deco);
    return i12.breakAfter = this.breakAfter, i12;
  }
  get children() {
    return Fi4;
  }
  sync(t8) {
    (!this.dom || !this.widget.updateDOM(this.dom, t8)) && (this.dom && this.prevWidget && this.prevWidget.destroy(this.dom), this.prevWidget = null, this.setDOM(this.widget.toDOM(t8)), this.widget.editable || (this.dom.contentEditable = "false"));
  }
  get overrideDOMText() {
    return this.parent ? this.parent.view.state.doc.slice(this.posAtStart, this.posAtEnd) : m.empty;
  }
  domBoundsAround() {
    return null;
  }
  become(t8) {
    return t8 instanceof s125 && t8.widget.constructor == this.widget.constructor ? (t8.widget.compare(this.widget) || this.markDirty(true), this.dom && !this.prevWidget && (this.prevWidget = this.widget), this.widget = t8.widget, this.length = t8.length, this.deco = t8.deco, this.breakAfter = t8.breakAfter, true) : false;
  }
  ignoreMutation() {
    return true;
  }
  ignoreEvent(t8) {
    return this.widget.ignoreEvent(t8);
  }
  get isEditable() {
    return false;
  }
  get isWidget() {
    return true;
  }
  coordsAt(t8, e7) {
    let i12 = this.widget.coordsAt(this.dom, t8, e7);
    return i12 || (this.widget instanceof $t6 ? null : te8(this.dom.getBoundingClientRect(), this.length ? t8 == 0 : e7 <= 0));
  }
  destroy() {
    super.destroy(), this.dom && this.widget.destroy(this.dom);
  }
  covers(t8) {
    let { startSide: e7, endSide: i12 } = this.deco;
    return e7 == i12 ? false : t8 < 0 ? e7 < 0 : i12 > 0;
  }
};
var $t6 = class extends lt6 {
  constructor(t8) {
    super(), this.height = t8;
  }
  toDOM() {
    let t8 = document.createElement("div");
    return t8.className = "cm-gap", this.updateDOM(t8), t8;
  }
  eq(t8) {
    return t8.height == this.height;
  }
  updateDOM(t8) {
    return t8.style.height = this.height + "px", true;
  }
  get editable() {
    return true;
  }
  get estimatedHeight() {
    return this.height;
  }
  ignoreEvent() {
    return false;
  }
};
var Ft6 = class s126 {
  constructor(t8, e7, i12, n14) {
    this.doc = t8, this.pos = e7, this.end = i12, this.disallowBlockEffectsFor = n14, this.content = [], this.curLine = null, this.breakAtStart = 0, this.pendingBuffer = 0, this.bufferMarks = [], this.atCursorPos = true, this.openStart = -1, this.openEnd = -1, this.text = "", this.textOff = 0, this.cursor = t8.iter(), this.skip = e7;
  }
  posCovered() {
    if (this.content.length == 0) return !this.breakAtStart && this.doc.lineAt(this.pos).from != this.pos;
    let t8 = this.content[this.content.length - 1];
    return !(t8.breakAfter || t8 instanceof dt6 && t8.deco.endSide < 0);
  }
  getLine() {
    return this.curLine || (this.content.push(this.curLine = new P10()), this.atCursorPos = true), this.curLine;
  }
  flushBuffer(t8 = this.bufferMarks) {
    this.pendingBuffer && (this.curLine.append(ne7(new _t6(-1), t8), t8.length), this.pendingBuffer = 0);
  }
  addBlockWidget(t8) {
    this.flushBuffer(), this.curLine = null, this.content.push(t8);
  }
  finish(t8) {
    this.pendingBuffer && t8 <= this.bufferMarks.length ? this.flushBuffer() : this.pendingBuffer = 0, !this.posCovered() && !(t8 && this.content.length && this.content[this.content.length - 1] instanceof dt6) && this.getLine();
  }
  buildText(t8, e7, i12) {
    for (; t8 > 0; ) {
      if (this.textOff == this.text.length) {
        let { value: o, lineBreak: r2, done: l11 } = this.cursor.next(this.skip);
        if (this.skip = 0, l11) throw new Error("Ran out of text content when drawing inline views");
        if (r2) {
          this.posCovered() || this.getLine(), this.content.length ? this.content[this.content.length - 1].breakAfter = 1 : this.breakAtStart = 1, this.flushBuffer(), this.curLine = null, this.atCursorPos = true, t8--;
          continue;
        } else this.text = o, this.textOff = 0;
      }
      let n14 = Math.min(this.text.length - this.textOff, t8, 512);
      this.flushBuffer(e7.slice(e7.length - i12)), this.getLine().append(ne7(new Q9(this.text.slice(this.textOff, this.textOff + n14)), e7), i12), this.atCursorPos = true, this.textOff += n14, t8 -= n14, i12 = 0;
    }
  }
  span(t8, e7, i12, n14) {
    this.buildText(e7 - t8, i12, n14), this.pos = e7, this.openStart < 0 && (this.openStart = n14);
  }
  point(t8, e7, i12, n14, o, r2) {
    if (this.disallowBlockEffectsFor[r2] && i12 instanceof ht6) {
      if (i12.block) throw new RangeError("Block decorations may not be specified via plugins");
      if (e7 > this.doc.lineAt(this.pos).to) throw new RangeError("Decorations that replace line breaks may not be specified via plugins");
    }
    let l11 = e7 - t8;
    if (i12 instanceof ht6) if (i12.block) i12.startSide > 0 && !this.posCovered() && this.getLine(), this.addBlockWidget(new dt6(i12.widget || at7.block, l11, i12));
    else {
      let h3 = Yt6.create(i12.widget || at7.inline, l11, l11 ? 0 : i12.startSide), c3 = this.atCursorPos && !h3.isEditable && o <= n14.length && (t8 < e7 || i12.startSide > 0), a2 = !h3.isEditable && (t8 < e7 || o > n14.length || i12.startSide <= 0), f6 = this.getLine();
      this.pendingBuffer == 2 && !c3 && !h3.isEditable && (this.pendingBuffer = 0), this.flushBuffer(n14), c3 && (f6.append(ne7(new _t6(1), n14), o), o = n14.length + Math.max(0, o - n14.length)), f6.append(ne7(h3, n14), o), this.atCursorPos = a2, this.pendingBuffer = a2 ? t8 < e7 || o > n14.length ? 1 : 2 : 0, this.pendingBuffer && (this.bufferMarks = n14.slice());
    }
    else this.doc.lineAt(this.pos).from == this.pos && this.getLine().addLineDeco(i12);
    l11 && (this.textOff + l11 <= this.text.length ? this.textOff += l11 : (this.skip += l11 - (this.text.length - this.textOff), this.text = "", this.textOff = 0), this.pos = e7), this.openStart < 0 && (this.openStart = o);
  }
  static build(t8, e7, i12, n14, o) {
    let r2 = new s126(t8, e7, i12, o);
    return r2.openEnd = T.spans(n14, e7, i12, r2), r2.openStart < 0 && (r2.openStart = r2.openEnd), r2.finish(r2.openEnd), r2;
  }
};
function ne7(s212, t8) {
  for (let e7 of t8) s212 = new rt6(e7, [s212], s212.length);
  return s212;
}
var at7 = class extends lt6 {
  constructor(t8) {
    super(), this.tag = t8;
  }
  eq(t8) {
    return t8.tag == this.tag;
  }
  toDOM() {
    return document.createElement(this.tag);
  }
  updateDOM(t8) {
    return t8.nodeName.toLowerCase() == this.tag;
  }
  get isHidden() {
    return true;
  }
};
at7.inline = new at7("span");
at7.block = new at7("div");
var L8 = function(s212) {
  return s212[s212.LTR = 0] = "LTR", s212[s212.RTL = 1] = "RTL", s212;
}(L8 || (L8 = {}));
var gt5 = L8.LTR;
var Wi4 = L8.RTL;
function Qs4(s212) {
  let t8 = [];
  for (let e7 = 0; e7 < s212.length; e7++) t8.push(1 << +s212[e7]);
  return t8;
}
var co4 = Qs4("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008");
var fo4 = Qs4("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333");
var ei4 = /* @__PURE__ */ Object.create(null);
var _8 = [];
for (let s212 of ["()", "[]", "{}"]) {
  let t8 = s212.charCodeAt(0), e7 = s212.charCodeAt(1);
  ei4[t8] = e7, ei4[e7] = -t8;
}
function Js4(s212) {
  return s212 <= 247 ? co4[s212] : 1424 <= s212 && s212 <= 1524 ? 2 : 1536 <= s212 && s212 <= 1785 ? fo4[s212 - 1536] : 1774 <= s212 && s212 <= 2220 ? 4 : 8192 <= s212 && s212 <= 8204 ? 256 : 64336 <= s212 && s212 <= 65023 ? 4 : 1;
}
var uo4 = /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;
var G11 = class {
  get dir() {
    return this.level % 2 ? Wi4 : gt5;
  }
  constructor(t8, e7, i12) {
    this.from = t8, this.to = e7, this.level = i12;
  }
  side(t8, e7) {
    return this.dir == e7 == t8 ? this.to : this.from;
  }
  forward(t8, e7) {
    return t8 == (this.dir == e7);
  }
  static find(t8, e7, i12, n14) {
    let o = -1;
    for (let r2 = 0; r2 < t8.length; r2++) {
      let l11 = t8[r2];
      if (l11.from <= e7 && l11.to >= e7) {
        if (l11.level == i12) return r2;
        (o < 0 || (n14 != 0 ? n14 < 0 ? l11.from < e7 : l11.to > e7 : t8[o].level > l11.level)) && (o = r2);
      }
    }
    if (o < 0) throw new RangeError("Index out of range");
    return o;
  }
};
function Zs4(s212, t8) {
  if (s212.length != t8.length) return false;
  for (let e7 = 0; e7 < s212.length; e7++) {
    let i12 = s212[e7], n14 = t8[e7];
    if (i12.from != n14.from || i12.to != n14.to || i12.direction != n14.direction || !Zs4(i12.inner, n14.inner)) return false;
  }
  return true;
}
var D6 = [];
function po4(s212, t8, e7, i12, n14) {
  for (let o = 0; o <= i12.length; o++) {
    let r2 = o ? i12[o - 1].to : t8, l11 = o < i12.length ? i12[o].from : e7, h3 = o ? 256 : n14;
    for (let c3 = r2, a2 = h3, f6 = h3; c3 < l11; c3++) {
      let d4 = Js4(s212.charCodeAt(c3));
      d4 == 512 ? d4 = a2 : d4 == 8 && f6 == 4 && (d4 = 16), D6[c3] = d4 == 4 ? 2 : d4, d4 & 7 && (f6 = d4), a2 = d4;
    }
    for (let c3 = r2, a2 = h3, f6 = h3; c3 < l11; c3++) {
      let d4 = D6[c3];
      if (d4 == 128) c3 < l11 - 1 && a2 == D6[c3 + 1] && a2 & 24 ? d4 = D6[c3] = a2 : D6[c3] = 256;
      else if (d4 == 64) {
        let u3 = c3 + 1;
        for (; u3 < l11 && D6[u3] == 64; ) u3++;
        let p3 = c3 && a2 == 8 || u3 < e7 && D6[u3] == 8 ? f6 == 1 ? 1 : 8 : 256;
        for (let g8 = c3; g8 < u3; g8++) D6[g8] = p3;
        c3 = u3 - 1;
      } else d4 == 8 && f6 == 1 && (D6[c3] = 1);
      a2 = d4, d4 & 7 && (f6 = d4);
    }
  }
}
function go4(s212, t8, e7, i12, n14) {
  let o = n14 == 1 ? 2 : 1;
  for (let r2 = 0, l11 = 0, h3 = 0; r2 <= i12.length; r2++) {
    let c3 = r2 ? i12[r2 - 1].to : t8, a2 = r2 < i12.length ? i12[r2].from : e7;
    for (let f6 = c3, d4, u3, p3; f6 < a2; f6++) if (u3 = ei4[d4 = s212.charCodeAt(f6)]) if (u3 < 0) {
      for (let g8 = l11 - 3; g8 >= 0; g8 -= 3) if (_8[g8 + 1] == -u3) {
        let b12 = _8[g8 + 2], m11 = b12 & 2 ? n14 : b12 & 4 ? b12 & 1 ? o : n14 : 0;
        m11 && (D6[f6] = D6[_8[g8]] = m11), l11 = g8;
        break;
      }
    } else {
      if (_8.length == 189) break;
      _8[l11++] = f6, _8[l11++] = d4, _8[l11++] = h3;
    }
    else if ((p3 = D6[f6]) == 2 || p3 == 1) {
      let g8 = p3 == n14;
      h3 = g8 ? 0 : 1;
      for (let b12 = l11 - 3; b12 >= 0; b12 -= 3) {
        let m11 = _8[b12 + 2];
        if (m11 & 2) break;
        if (g8) _8[b12 + 2] |= 2;
        else {
          if (m11 & 4) break;
          _8[b12 + 2] |= 4;
        }
      }
    }
  }
}
function mo4(s212, t8, e7, i12) {
  for (let n14 = 0, o = i12; n14 <= e7.length; n14++) {
    let r2 = n14 ? e7[n14 - 1].to : s212, l11 = n14 < e7.length ? e7[n14].from : t8;
    for (let h3 = r2; h3 < l11; ) {
      let c3 = D6[h3];
      if (c3 == 256) {
        let a2 = h3 + 1;
        for (; ; ) if (a2 == l11) {
          if (n14 == e7.length) break;
          a2 = e7[n14++].to, l11 = n14 < e7.length ? e7[n14].from : t8;
        } else if (D6[a2] == 256) a2++;
        else break;
        let f6 = o == 1, d4 = (a2 < t8 ? D6[a2] : i12) == 1, u3 = f6 == d4 ? f6 ? 1 : 2 : i12;
        for (let p3 = a2, g8 = n14, b12 = g8 ? e7[g8 - 1].to : s212; p3 > h3; ) p3 == b12 && (p3 = e7[--g8].from, b12 = g8 ? e7[g8 - 1].to : s212), D6[--p3] = u3;
        h3 = a2;
      } else o = c3, h3++;
    }
  }
}
function ii4(s212, t8, e7, i12, n14, o, r2) {
  let l11 = i12 % 2 ? 2 : 1;
  if (i12 % 2 == n14 % 2) for (let h3 = t8, c3 = 0; h3 < e7; ) {
    let a2 = true, f6 = false;
    if (c3 == o.length || h3 < o[c3].from) {
      let g8 = D6[h3];
      g8 != l11 && (a2 = false, f6 = g8 == 16);
    }
    let d4 = !a2 && l11 == 1 ? [] : null, u3 = a2 ? i12 : i12 + 1, p3 = h3;
    t: for (; ; ) if (c3 < o.length && p3 == o[c3].from) {
      if (f6) break t;
      let g8 = o[c3];
      if (!a2) for (let b12 = g8.to, m11 = c3 + 1; ; ) {
        if (b12 == e7) break t;
        if (m11 < o.length && o[m11].from == b12) b12 = o[m11++].to;
        else {
          if (D6[b12] == l11) break t;
          break;
        }
      }
      if (c3++, d4) d4.push(g8);
      else {
        g8.from > h3 && r2.push(new G11(h3, g8.from, u3));
        let b12 = g8.direction == gt5 != !(u3 % 2);
        si4(s212, b12 ? i12 + 1 : i12, n14, g8.inner, g8.from, g8.to, r2), h3 = g8.to;
      }
      p3 = g8.to;
    } else {
      if (p3 == e7 || (a2 ? D6[p3] != l11 : D6[p3] == l11)) break;
      p3++;
    }
    d4 ? ii4(s212, h3, p3, i12 + 1, n14, d4, r2) : h3 < p3 && r2.push(new G11(h3, p3, u3)), h3 = p3;
  }
  else for (let h3 = e7, c3 = o.length; h3 > t8; ) {
    let a2 = true, f6 = false;
    if (!c3 || h3 > o[c3 - 1].to) {
      let g8 = D6[h3 - 1];
      g8 != l11 && (a2 = false, f6 = g8 == 16);
    }
    let d4 = !a2 && l11 == 1 ? [] : null, u3 = a2 ? i12 : i12 + 1, p3 = h3;
    t: for (; ; ) if (c3 && p3 == o[c3 - 1].to) {
      if (f6) break t;
      let g8 = o[--c3];
      if (!a2) for (let b12 = g8.from, m11 = c3; ; ) {
        if (b12 == t8) break t;
        if (m11 && o[m11 - 1].to == b12) b12 = o[--m11].from;
        else {
          if (D6[b12 - 1] == l11) break t;
          break;
        }
      }
      if (d4) d4.push(g8);
      else {
        g8.to < h3 && r2.push(new G11(g8.to, h3, u3));
        let b12 = g8.direction == gt5 != !(u3 % 2);
        si4(s212, b12 ? i12 + 1 : i12, n14, g8.inner, g8.from, g8.to, r2), h3 = g8.from;
      }
      p3 = g8.from;
    } else {
      if (p3 == t8 || (a2 ? D6[p3 - 1] != l11 : D6[p3 - 1] == l11)) break;
      p3--;
    }
    d4 ? ii4(s212, p3, h3, i12 + 1, n14, d4, r2) : p3 < h3 && r2.push(new G11(p3, h3, u3)), h3 = p3;
  }
}
function si4(s212, t8, e7, i12, n14, o, r2) {
  let l11 = t8 % 2 ? 2 : 1;
  po4(s212, n14, o, i12, l11), go4(s212, n14, o, i12, l11), mo4(n14, o, i12, l11), ii4(s212, n14, o, t8, e7, i12, r2);
}
function tn6(s212, t8, e7) {
  if (!s212) return [new G11(0, 0, t8 == Wi4 ? 1 : 0)];
  if (t8 == gt5 && !e7.length && !uo4.test(s212)) return en5(s212.length);
  if (e7.length) for (; s212.length > D6.length; ) D6[D6.length] = 256;
  let i12 = [], n14 = t8 == gt5 ? 0 : 1;
  return si4(s212, n14, n14, e7, 0, s212.length, i12), i12;
}
function en5(s212) {
  return [new G11(0, s212, 0)];
}
var sn5 = "";
function nn5(s212, t8, e7, i12, n14) {
  var o;
  let r2 = i12.head - s212.from, l11 = G11.find(t8, r2, (o = i12.bidiLevel) !== null && o !== void 0 ? o : -1, i12.assoc), h3 = t8[l11], c3 = h3.side(n14, e7);
  if (r2 == c3) {
    let d4 = l11 += n14 ? 1 : -1;
    if (d4 < 0 || d4 >= t8.length) return null;
    h3 = t8[l11 = d4], r2 = h3.side(!n14, e7), c3 = h3.side(n14, e7);
  }
  let a2 = ee(s212.text, r2, h3.forward(n14, e7));
  (a2 < h3.from || a2 > h3.to) && (a2 = c3), sn5 = s212.text.slice(Math.min(r2, a2), Math.max(r2, a2));
  let f6 = l11 == (n14 ? t8.length - 1 : 0) ? null : t8[l11 + (n14 ? 1 : -1)];
  return f6 && a2 == c3 && f6.level + (n14 ? 0 : 1) < h3.level ? x.cursor(f6.side(!n14, e7) + s212.from, f6.forward(n14, e7) ? 1 : -1, f6.level) : x.cursor(a2 + s212.from, h3.forward(n14, e7) ? -1 : 1, h3.level);
}
function bo4(s212, t8, e7) {
  for (let i12 = t8; i12 < e7; i12++) {
    let n14 = Js4(s212.charCodeAt(i12));
    if (n14 == 1) return gt5;
    if (n14 == 2 || n14 == 4) return Wi4;
  }
  return gt5;
}
var on5 = y.define();
var rn5 = y.define();
var ln5 = y.define();
var hn4 = y.define();
var ni4 = y.define();
var an4 = y.define();
var cn5 = y.define();
var zi4 = y.define();
var Ii4 = y.define();
var fn5 = y.define({ combine: (s212) => s212.some((t8) => t8) });
var dn4 = y.define({ combine: (s212) => s212.some((t8) => t8) });
var un5 = y.define();
var Wt6 = class s127 {
  constructor(t8, e7 = "nearest", i12 = "nearest", n14 = 5, o = 5, r2 = false) {
    this.range = t8, this.y = e7, this.x = i12, this.yMargin = n14, this.xMargin = o, this.isSnapshot = r2;
  }
  map(t8) {
    return t8.empty ? this : new s127(this.range.map(t8), this.y, this.x, this.yMargin, this.xMargin, this.isSnapshot);
  }
  clip(t8) {
    return this.range.to <= t8.doc.length ? this : new s127(x.cursor(t8.doc.length), this.y, this.x, this.yMargin, this.xMargin, this.isSnapshot);
  }
};
var oe5 = v.define({ map: (s212, t8) => s212.map(t8) });
var pn5 = v.define();
function $7(s212, t8, e7) {
  let i12 = s212.facet(hn4);
  i12.length ? i12[0](t8) : window.onerror ? window.onerror(String(t8), e7, void 0, void 0, t8) : e7 ? console.error(e7 + ":", t8) : console.error(t8);
}
var st7 = y.define({ combine: (s212) => s212.length ? s212[0] : true });
var yo4 = 0;
var Et6 = y.define();
var N9 = class s128 {
  constructor(t8, e7, i12, n14, o) {
    this.id = t8, this.create = e7, this.domEventHandlers = i12, this.domEventObservers = n14, this.extension = o(this);
  }
  static define(t8, e7) {
    let { eventHandlers: i12, eventObservers: n14, provide: o, decorations: r2 } = e7 || {};
    return new s128(yo4++, t8, i12, n14, (l11) => {
      let h3 = [Et6.of(l11)];
      return r2 && h3.push(Ut6.of((c3) => {
        let a2 = c3.plugin(l11);
        return a2 ? r2(a2) : O9.none;
      })), o && h3.push(o(l11)), h3;
    });
  }
  static fromClass(t8, e7) {
    return s128.define((i12) => new t8(i12), e7);
  }
};
var zt6 = class {
  constructor(t8) {
    this.spec = t8, this.mustUpdate = null, this.value = null;
  }
  update(t8) {
    if (this.value) {
      if (this.mustUpdate) {
        let e7 = this.mustUpdate;
        if (this.mustUpdate = null, this.value.update) try {
          this.value.update(e7);
        } catch (i12) {
          if ($7(e7.state, i12, "CodeMirror plugin crashed"), this.value.destroy) try {
            this.value.destroy();
          } catch {
          }
          this.deactivate();
        }
      }
    } else if (this.spec) try {
      this.value = this.spec.create(t8);
    } catch (e7) {
      $7(t8.state, e7, "CodeMirror plugin crashed"), this.deactivate();
    }
    return this;
  }
  destroy(t8) {
    var e7;
    if (!((e7 = this.value) === null || e7 === void 0) && e7.destroy) try {
      this.value.destroy();
    } catch (i12) {
      $7(t8.state, i12, "CodeMirror plugin crashed");
    }
  }
  deactivate() {
    this.spec = this.value = null;
  }
};
var gn5 = y.define();
var Ve8 = y.define();
var Ut6 = y.define();
var mn4 = y.define();
var Ki4 = y.define();
var bn4 = y.define();
function Ji4(s212, t8) {
  let e7 = s212.state.facet(bn4);
  if (!e7.length) return e7;
  let i12 = e7.map((o) => o instanceof Function ? o(s212) : o), n14 = [];
  return T.spans(i12, t8.from, t8.to, { point() {
  }, span(o, r2, l11, h3) {
    let c3 = o - t8.from, a2 = r2 - t8.from, f6 = n14;
    for (let d4 = l11.length - 1; d4 >= 0; d4--, h3--) {
      let u3 = l11[d4].spec.bidiIsolate, p3;
      if (u3 == null && (u3 = bo4(t8.text, c3, a2)), h3 > 0 && f6.length && (p3 = f6[f6.length - 1]).to == c3 && p3.direction == u3) p3.to = a2, f6 = p3.inner;
      else {
        let g8 = { from: c3, to: a2, direction: u3, inner: [] };
        f6.push(g8), f6 = g8.inner;
      }
    }
  } }), n14;
}
var yn5 = y.define();
function wn4(s212) {
  let t8 = 0, e7 = 0, i12 = 0, n14 = 0;
  for (let o of s212.state.facet(yn5)) {
    let r2 = o(s212);
    r2 && (r2.left != null && (t8 = Math.max(t8, r2.left)), r2.right != null && (e7 = Math.max(e7, r2.right)), r2.top != null && (i12 = Math.max(i12, r2.top)), r2.bottom != null && (n14 = Math.max(n14, r2.bottom)));
  }
  return { left: t8, right: e7, top: i12, bottom: n14 };
}
var Lt5 = y.define();
var j9 = class s129 {
  constructor(t8, e7, i12, n14) {
    this.fromA = t8, this.toA = e7, this.fromB = i12, this.toB = n14;
  }
  join(t8) {
    return new s129(Math.min(this.fromA, t8.fromA), Math.max(this.toA, t8.toA), Math.min(this.fromB, t8.fromB), Math.max(this.toB, t8.toB));
  }
  addToSet(t8) {
    let e7 = t8.length, i12 = this;
    for (; e7 > 0; e7--) {
      let n14 = t8[e7 - 1];
      if (!(n14.fromA > i12.toA)) {
        if (n14.toA < i12.fromA) break;
        i12 = i12.join(n14), t8.splice(e7 - 1, 1);
      }
    }
    return t8.splice(e7, 0, i12), t8;
  }
  static extendWithRanges(t8, e7) {
    if (e7.length == 0) return t8;
    let i12 = [];
    for (let n14 = 0, o = 0, r2 = 0, l11 = 0; ; n14++) {
      let h3 = n14 == t8.length ? null : t8[n14], c3 = r2 - l11, a2 = h3 ? h3.fromB : 1e9;
      for (; o < e7.length && e7[o] < a2; ) {
        let f6 = e7[o], d4 = e7[o + 1], u3 = Math.max(l11, f6), p3 = Math.min(a2, d4);
        if (u3 <= p3 && new s129(u3 + c3, p3 + c3, u3, p3).addToSet(i12), d4 > a2) break;
        o += 2;
      }
      if (!h3) return i12;
      new s129(h3.fromA, h3.toA, h3.fromB, h3.toB).addToSet(i12), r2 = h3.toA, l11 = h3.toB;
    }
  }
};
var Ce5 = class s130 {
  constructor(t8, e7, i12) {
    this.view = t8, this.state = e7, this.transactions = i12, this.flags = 0, this.startState = t8.state, this.changes = A.empty(this.startState.doc.length);
    for (let o of i12) this.changes = this.changes.compose(o.changes);
    let n14 = [];
    this.changes.iterChangedRanges((o, r2, l11, h3) => n14.push(new j9(o, r2, l11, h3))), this.changedRanges = n14;
  }
  static create(t8, e7, i12) {
    return new s130(t8, e7, i12);
  }
  get viewportChanged() {
    return (this.flags & 4) > 0;
  }
  get heightChanged() {
    return (this.flags & 2) > 0;
  }
  get geometryChanged() {
    return this.docChanged || (this.flags & 10) > 0;
  }
  get focusChanged() {
    return (this.flags & 1) > 0;
  }
  get docChanged() {
    return !this.changes.empty;
  }
  get selectionSet() {
    return this.transactions.some((t8) => t8.selection);
  }
  get empty() {
    return this.flags == 0 && this.transactions.length == 0;
  }
};
var Me8 = class extends R8 {
  get length() {
    return this.view.state.doc.length;
  }
  constructor(t8) {
    super(), this.view = t8, this.decorations = [], this.dynamicDecorationMap = [false], this.domChanged = null, this.hasComposition = null, this.markedForComposition = /* @__PURE__ */ new Set(), this.editContextFormatting = O9.none, this.lastCompositionAfterCursor = false, this.minWidth = 0, this.minWidthFrom = 0, this.minWidthTo = 0, this.impreciseAnchor = null, this.impreciseHead = null, this.forceSelection = false, this.lastUpdate = Date.now(), this.setDOM(t8.contentDOM), this.children = [new P10()], this.children[0].setParent(this), this.updateDeco(), this.updateInner([new j9(0, 0, 0, t8.state.doc.length)], 0, null);
  }
  update(t8) {
    var e7;
    let i12 = t8.changedRanges;
    this.minWidth > 0 && i12.length && (i12.every(({ fromA: c3, toA: a2 }) => a2 < this.minWidthFrom || c3 > this.minWidthTo) ? (this.minWidthFrom = t8.changes.mapPos(this.minWidthFrom, 1), this.minWidthTo = t8.changes.mapPos(this.minWidthTo, 1)) : this.minWidth = this.minWidthFrom = this.minWidthTo = 0), this.updateEditContextFormatting(t8);
    let n14 = -1;
    this.view.inputState.composing >= 0 && !this.view.observer.editContext && (!((e7 = this.domChanged) === null || e7 === void 0) && e7.newSel ? n14 = this.domChanged.newSel.head : !ko4(t8.changes, this.hasComposition) && !t8.selectionSet && (n14 = t8.state.selection.main.head));
    let o = n14 > -1 ? xo4(this.view, t8.changes, n14) : null;
    if (this.domChanged = null, this.hasComposition) {
      this.markedForComposition.clear();
      let { from: c3, to: a2 } = this.hasComposition;
      i12 = new j9(c3, a2, t8.changes.mapPos(c3, -1), t8.changes.mapPos(a2, 1)).addToSet(i12.slice());
    }
    this.hasComposition = o ? { from: o.range.fromB, to: o.range.toB } : null, (y9.ie || y9.chrome) && !o && t8 && t8.state.doc.lines != t8.startState.doc.lines && (this.forceSelection = true);
    let r2 = this.decorations, l11 = this.updateDeco(), h3 = Co4(r2, l11, t8.changes);
    return i12 = j9.extendWithRanges(i12, h3), !(this.flags & 7) && i12.length == 0 ? false : (this.updateInner(i12, t8.startState.doc.length, o), t8.transactions.length && (this.lastUpdate = Date.now()), true);
  }
  updateInner(t8, e7, i12) {
    this.view.viewState.mustMeasureContent = true, this.updateChildren(t8, e7, i12);
    let { observer: n14 } = this.view;
    n14.ignore(() => {
      this.dom.style.height = this.view.viewState.contentHeight / this.view.scaleY + "px", this.dom.style.flexBasis = this.minWidth ? this.minWidth + "px" : "";
      let r2 = y9.chrome || y9.ios ? { node: n14.selectionRange.focusNode, written: false } : void 0;
      this.sync(this.view, r2), this.flags &= -8, r2 && (r2.written || n14.selectionRange.focusNode != r2.node) && (this.forceSelection = true), this.dom.style.height = "";
    }), this.markedForComposition.forEach((r2) => r2.flags &= -9);
    let o = [];
    if (this.view.viewport.from || this.view.viewport.to < this.view.state.doc.length) for (let r2 of this.children) r2 instanceof dt6 && r2.widget instanceof $t6 && o.push(r2.dom);
    n14.updateGaps(o);
  }
  updateChildren(t8, e7, i12) {
    let n14 = i12 ? i12.range.addToSet(t8.slice()) : t8, o = this.childCursor(e7);
    for (let r2 = n14.length - 1; ; r2--) {
      let l11 = r2 >= 0 ? n14[r2] : null;
      if (!l11) break;
      let { fromA: h3, toA: c3, fromB: a2, toB: f6 } = l11, d4, u3, p3, g8;
      if (i12 && i12.range.fromB < f6 && i12.range.toB > a2) {
        let x11 = Ft6.build(this.view.state.doc, a2, i12.range.fromB, this.decorations, this.dynamicDecorationMap), S17 = Ft6.build(this.view.state.doc, i12.range.toB, f6, this.decorations, this.dynamicDecorationMap);
        u3 = x11.breakAtStart, p3 = x11.openStart, g8 = S17.openEnd;
        let C11 = this.compositionView(i12);
        S17.breakAtStart ? C11.breakAfter = 1 : S17.content.length && C11.merge(C11.length, C11.length, S17.content[0], false, S17.openStart, 0) && (C11.breakAfter = S17.content[0].breakAfter, S17.content.shift()), x11.content.length && C11.merge(0, 0, x11.content[x11.content.length - 1], true, 0, x11.openEnd) && x11.content.pop(), d4 = x11.content.concat(C11).concat(S17.content);
      } else ({ content: d4, breakAtStart: u3, openStart: p3, openEnd: g8 } = Ft6.build(this.view.state.doc, a2, f6, this.decorations, this.dynamicDecorationMap));
      let { i: b12, off: m11 } = o.findPos(c3, 1), { i: w14, off: v10 } = o.findPos(h3, -1);
      qs4(this, w14, v10, b12, m11, d4, u3, p3, g8);
    }
    i12 && this.fixCompositionDOM(i12);
  }
  updateEditContextFormatting(t8) {
    this.editContextFormatting = this.editContextFormatting.map(t8.changes);
    for (let e7 of t8.transactions) for (let i12 of e7.effects) i12.is(pn5) && (this.editContextFormatting = i12.value);
  }
  compositionView(t8) {
    let e7 = new Q9(t8.text.nodeValue);
    e7.flags |= 8;
    for (let { deco: n14 } of t8.marks) e7 = new rt6(n14, [e7], e7.length);
    let i12 = new P10();
    return i12.append(e7, 0), i12;
  }
  fixCompositionDOM(t8) {
    let e7 = (o, r2) => {
      r2.flags |= 8 | (r2.children.some((h3) => h3.flags & 7) ? 1 : 0), this.markedForComposition.add(r2);
      let l11 = R8.get(o);
      l11 && l11 != r2 && (l11.dom = null), r2.setDOM(o);
    }, i12 = this.childPos(t8.range.fromB, 1), n14 = this.children[i12.i];
    e7(t8.line, n14);
    for (let o = t8.marks.length - 1; o >= -1; o--) i12 = n14.childPos(i12.off, 1), n14 = n14.children[i12.i], e7(o >= 0 ? t8.marks[o].node : t8.text, n14);
  }
  updateSelection(t8 = false, e7 = false) {
    (t8 || !this.view.observer.selectionRange.focusNode) && this.view.observer.readSelectionRange();
    let i12 = this.view.root.activeElement, n14 = i12 == this.dom, o = !n14 && ue7(this.dom, this.view.observer.selectionRange) && !(i12 && this.dom.contains(i12));
    if (!(n14 || e7 || o)) return;
    let r2 = this.forceSelection;
    this.forceSelection = false;
    let l11 = this.view.state.selection.main, h3 = this.moveToLine(this.domAtPos(l11.anchor)), c3 = l11.empty ? h3 : this.moveToLine(this.domAtPos(l11.head));
    if (y9.gecko && l11.empty && !this.hasComposition && wo4(h3)) {
      let f6 = document.createTextNode("");
      this.view.observer.ignore(() => h3.node.insertBefore(f6, h3.node.childNodes[h3.offset] || null)), h3 = c3 = new V10(f6, 0), r2 = true;
    }
    let a2 = this.view.observer.selectionRange;
    (r2 || !a2.focusNode || (!Vt6(h3.node, h3.offset, a2.anchorNode, a2.anchorOffset) || !Vt6(c3.node, c3.offset, a2.focusNode, a2.focusOffset)) && !this.suppressWidgetCursorChange(a2, l11)) && (this.view.observer.ignore(() => {
      y9.android && y9.chrome && this.dom.contains(a2.focusNode) && Mo4(a2.focusNode, this.dom) && (this.dom.blur(), this.dom.focus({ preventScroll: true }));
      let f6 = jt6(this.view.root);
      if (f6) if (l11.empty) {
        if (y9.gecko) {
          let d4 = vo4(h3.node, h3.offset);
          if (d4 && d4 != 3) {
            let u3 = (d4 == 1 ? Is4 : Ks4)(h3.node, h3.offset);
            u3 && (h3 = new V10(u3.node, u3.offset));
          }
        }
        f6.collapse(h3.node, h3.offset), l11.bidiLevel != null && f6.caretBidiLevel !== void 0 && (f6.caretBidiLevel = l11.bidiLevel);
      } else if (f6.extend) {
        f6.collapse(h3.node, h3.offset);
        try {
          f6.extend(c3.node, c3.offset);
        } catch {
        }
      } else {
        let d4 = document.createRange();
        l11.anchor > l11.head && ([h3, c3] = [c3, h3]), d4.setEnd(c3.node, c3.offset), d4.setStart(h3.node, h3.offset), f6.removeAllRanges(), f6.addRange(d4);
      }
      o && this.view.root.activeElement == this.dom && (this.dom.blur(), i12 && i12.focus());
    }), this.view.observer.setSelectionRange(h3, c3)), this.impreciseAnchor = h3.precise ? null : new V10(a2.anchorNode, a2.anchorOffset), this.impreciseHead = c3.precise ? null : new V10(a2.focusNode, a2.focusOffset);
  }
  suppressWidgetCursorChange(t8, e7) {
    return this.hasComposition && e7.empty && Vt6(t8.focusNode, t8.focusOffset, t8.anchorNode, t8.anchorOffset) && this.posFromDOM(t8.focusNode, t8.focusOffset) == e7.head;
  }
  enforceCursorAssoc() {
    if (this.hasComposition) return;
    let { view: t8 } = this, e7 = t8.state.selection.main, i12 = jt6(t8.root), { anchorNode: n14, anchorOffset: o } = t8.observer.selectionRange;
    if (!i12 || !e7.empty || !e7.assoc || !i12.modify) return;
    let r2 = P10.find(this, e7.head);
    if (!r2) return;
    let l11 = r2.posAtStart;
    if (e7.head == l11 || e7.head == l11 + r2.length) return;
    let h3 = this.coordsAt(e7.head, -1), c3 = this.coordsAt(e7.head, 1);
    if (!h3 || !c3 || h3.bottom > c3.top) return;
    let a2 = this.domAtPos(e7.head + e7.assoc);
    i12.collapse(a2.node, a2.offset), i12.modify("move", e7.assoc < 0 ? "forward" : "backward", "lineboundary"), t8.observer.readSelectionRange();
    let f6 = t8.observer.selectionRange;
    t8.docView.posFromDOM(f6.anchorNode, f6.anchorOffset) != e7.from && i12.collapse(n14, o);
  }
  moveToLine(t8) {
    let e7 = this.dom, i12;
    if (t8.node != e7) return t8;
    for (let n14 = t8.offset; !i12 && n14 < e7.childNodes.length; n14++) {
      let o = R8.get(e7.childNodes[n14]);
      o instanceof P10 && (i12 = o.domAtPos(0));
    }
    for (let n14 = t8.offset - 1; !i12 && n14 >= 0; n14--) {
      let o = R8.get(e7.childNodes[n14]);
      o instanceof P10 && (i12 = o.domAtPos(o.length));
    }
    return i12 ? new V10(i12.node, i12.offset, true) : t8;
  }
  nearest(t8) {
    for (let e7 = t8; e7; ) {
      let i12 = R8.get(e7);
      if (i12 && i12.rootView == this) return i12;
      e7 = e7.parentNode;
    }
    return null;
  }
  posFromDOM(t8, e7) {
    let i12 = this.nearest(t8);
    if (!i12) throw new RangeError("Trying to find position for a DOM position outside of the document");
    return i12.localPosFromDOM(t8, e7) + i12.posAtStart;
  }
  domAtPos(t8) {
    let { i: e7, off: i12 } = this.childCursor().findPos(t8, -1);
    for (; e7 < this.children.length - 1; ) {
      let n14 = this.children[e7];
      if (i12 < n14.length || n14 instanceof P10) break;
      e7++, i12 = 0;
    }
    return this.children[e7].domAtPos(i12);
  }
  coordsAt(t8, e7) {
    let i12 = null, n14 = 0;
    for (let o = this.length, r2 = this.children.length - 1; r2 >= 0; r2--) {
      let l11 = this.children[r2], h3 = o - l11.breakAfter, c3 = h3 - l11.length;
      if (h3 < t8) break;
      if (c3 <= t8 && (c3 < t8 || l11.covers(-1)) && (h3 > t8 || l11.covers(1)) && (!i12 || l11 instanceof P10 && !(i12 instanceof P10 && e7 >= 0))) i12 = l11, n14 = c3;
      else if (i12 && c3 == t8 && h3 == t8 && l11 instanceof dt6 && Math.abs(e7) < 2) {
        if (l11.deco.startSide < 0) break;
        r2 && (i12 = null);
      }
      o = c3;
    }
    return i12 ? i12.coordsAt(t8 - n14, e7) : null;
  }
  coordsForChar(t8) {
    let { i: e7, off: i12 } = this.childPos(t8, 1), n14 = this.children[e7];
    if (!(n14 instanceof P10)) return null;
    for (; n14.children.length; ) {
      let { i: l11, off: h3 } = n14.childPos(i12, 1);
      for (; ; l11++) {
        if (l11 == n14.children.length) return null;
        if ((n14 = n14.children[l11]).length) break;
      }
      i12 = h3;
    }
    if (!(n14 instanceof Q9)) return null;
    let o = ee(n14.text, i12);
    if (o == i12) return null;
    let r2 = pt5(n14.dom, i12, o).getClientRects();
    for (let l11 = 0; l11 < r2.length; l11++) {
      let h3 = r2[l11];
      if (l11 == r2.length - 1 || h3.top < h3.bottom && h3.left < h3.right) return h3;
    }
    return null;
  }
  measureVisibleLineHeights(t8) {
    let e7 = [], { from: i12, to: n14 } = t8, o = this.view.contentDOM.clientWidth, r2 = o > Math.max(this.view.scrollDOM.clientWidth, this.minWidth) + 1, l11 = -1, h3 = this.view.textDirection == L8.LTR;
    for (let c3 = 0, a2 = 0; a2 < this.children.length; a2++) {
      let f6 = this.children[a2], d4 = c3 + f6.length;
      if (d4 > n14) break;
      if (c3 >= i12) {
        let u3 = f6.dom.getBoundingClientRect();
        if (e7.push(u3.height), r2) {
          let p3 = f6.dom.lastChild, g8 = p3 ? At6(p3) : [];
          if (g8.length) {
            let b12 = g8[g8.length - 1], m11 = h3 ? b12.right - u3.left : u3.right - b12.left;
            m11 > l11 && (l11 = m11, this.minWidth = o, this.minWidthFrom = c3, this.minWidthTo = d4);
          }
        }
      }
      c3 = d4 + f6.breakAfter;
    }
    return e7;
  }
  textDirectionAt(t8) {
    let { i: e7 } = this.childPos(t8, 1);
    return getComputedStyle(this.children[e7].dom).direction == "rtl" ? L8.RTL : L8.LTR;
  }
  measureTextSize() {
    for (let o of this.children) if (o instanceof P10) {
      let r2 = o.measureTextSize();
      if (r2) return r2;
    }
    let t8 = document.createElement("div"), e7, i12, n14;
    return t8.className = "cm-line", t8.style.width = "99999px", t8.style.position = "absolute", t8.textContent = "abc def ghi jkl mno pqr stu", this.view.observer.ignore(() => {
      this.dom.appendChild(t8);
      let o = At6(t8.firstChild)[0];
      e7 = t8.getBoundingClientRect().height, i12 = o ? o.width / 27 : 7, n14 = o ? o.height : e7, t8.remove();
    }), { lineHeight: e7, charWidth: i12, textHeight: n14 };
  }
  childCursor(t8 = this.length) {
    let e7 = this.children.length;
    return e7 && (t8 -= this.children[--e7].length), new ve7(this.children, t8, e7);
  }
  computeBlockGapDeco() {
    let t8 = [], e7 = this.view.viewState;
    for (let i12 = 0, n14 = 0; ; n14++) {
      let o = n14 == e7.viewports.length ? null : e7.viewports[n14], r2 = o ? o.from - 1 : this.length;
      if (r2 > i12) {
        let l11 = (e7.lineBlockAt(r2).bottom - e7.lineBlockAt(i12).top) / this.view.scaleY;
        t8.push(O9.replace({ widget: new $t6(l11), block: true, inclusive: true, isBlockGap: true }).range(i12, r2));
      }
      if (!o) break;
      i12 = o.to + 1;
    }
    return O9.set(t8);
  }
  updateDeco() {
    let t8 = 1, e7 = this.view.state.facet(Ut6).map((o) => (this.dynamicDecorationMap[t8++] = typeof o == "function") ? o(this.view) : o), i12 = false, n14 = this.view.state.facet(mn4).map((o, r2) => {
      let l11 = typeof o == "function";
      return l11 && (i12 = true), l11 ? o(this.view) : o;
    });
    for (n14.length && (this.dynamicDecorationMap[t8++] = i12, e7.push(T.join(n14))), this.decorations = [this.editContextFormatting, ...e7, this.computeBlockGapDeco(), this.view.viewState.lineGapDeco]; t8 < this.decorations.length; ) this.dynamicDecorationMap[t8++] = false;
    return this.decorations;
  }
  scrollIntoView(t8) {
    if (t8.isSnapshot) {
      let c3 = this.view.viewState.lineBlockAt(t8.range.head);
      this.view.scrollDOM.scrollTop = c3.top - t8.yMargin, this.view.scrollDOM.scrollLeft = t8.xMargin;
      return;
    }
    for (let c3 of this.view.state.facet(un5)) try {
      if (c3(this.view, t8.range, t8)) return true;
    } catch (a2) {
      $7(this.view.state, a2, "scroll handler");
    }
    let { range: e7 } = t8, i12 = this.coordsAt(e7.head, e7.empty ? e7.assoc : e7.head > e7.anchor ? -1 : 1), n14;
    if (!i12) return;
    !e7.empty && (n14 = this.coordsAt(e7.anchor, e7.anchor > e7.head ? -1 : 1)) && (i12 = { left: Math.min(i12.left, n14.left), top: Math.min(i12.top, n14.top), right: Math.max(i12.right, n14.right), bottom: Math.max(i12.bottom, n14.bottom) });
    let o = wn4(this.view), r2 = { left: i12.left - o.left, top: i12.top - o.top, right: i12.right + o.right, bottom: i12.bottom + o.bottom }, { offsetWidth: l11, offsetHeight: h3 } = this.view.scrollDOM;
    eo4(this.view.scrollDOM, r2, e7.head < e7.anchor ? -1 : 1, t8.x, t8.y, Math.max(Math.min(t8.xMargin, l11), -l11), Math.max(Math.min(t8.yMargin, h3), -h3), this.view.textDirection == L8.LTR);
  }
};
function wo4(s212) {
  return s212.node.nodeType == 1 && s212.node.firstChild && (s212.offset == 0 || s212.node.childNodes[s212.offset - 1].contentEditable == "false") && (s212.offset == s212.node.childNodes.length || s212.node.childNodes[s212.offset].contentEditable == "false");
}
function xn4(s212, t8) {
  let e7 = s212.observer.selectionRange;
  if (!e7.focusNode) return null;
  let i12 = Is4(e7.focusNode, e7.focusOffset), n14 = Ks4(e7.focusNode, e7.focusOffset), o = i12 || n14;
  if (n14 && i12 && n14.node != i12.node) {
    let l11 = R8.get(n14.node);
    if (!l11 || l11 instanceof Q9 && l11.text != n14.node.nodeValue) o = n14;
    else if (s212.docView.lastCompositionAfterCursor) {
      let h3 = R8.get(i12.node);
      !h3 || h3 instanceof Q9 && h3.text != i12.node.nodeValue || (o = n14);
    }
  }
  if (s212.docView.lastCompositionAfterCursor = o != i12, !o) return null;
  let r2 = t8 - o.offset;
  return { from: r2, to: r2 + o.node.nodeValue.length, node: o.node };
}
function xo4(s212, t8, e7) {
  let i12 = xn4(s212, e7);
  if (!i12) return null;
  let { node: n14, from: o, to: r2 } = i12, l11 = n14.nodeValue;
  if (/[\n\r]/.test(l11) || s212.state.doc.sliceString(i12.from, i12.to) != l11) return null;
  let h3 = t8.invertedDesc, c3 = new j9(h3.mapPos(o), h3.mapPos(r2), o, r2), a2 = [];
  for (let f6 = n14.parentNode; ; f6 = f6.parentNode) {
    let d4 = R8.get(f6);
    if (d4 instanceof rt6) a2.push({ node: f6, deco: d4.mark });
    else {
      if (d4 instanceof P10 || f6.nodeName == "DIV" && f6.parentNode == s212.contentDOM) return { range: c3, text: n14, marks: a2, line: f6 };
      if (f6 != s212.contentDOM) a2.push({ node: f6, deco: new Xt5({ inclusive: true, attributes: ho4(f6), tagName: f6.tagName.toLowerCase() }) });
      else return null;
    }
  }
}
function vo4(s212, t8) {
  return s212.nodeType != 1 ? 0 : (t8 && s212.childNodes[t8 - 1].contentEditable == "false" ? 1 : 0) | (t8 < s212.childNodes.length && s212.childNodes[t8].contentEditable == "false" ? 2 : 0);
}
var So4 = class {
  constructor() {
    this.changes = [];
  }
  compareRange(t8, e7) {
    ti4(t8, e7, this.changes);
  }
  comparePoint(t8, e7) {
    ti4(t8, e7, this.changes);
  }
};
function Co4(s212, t8, e7) {
  let i12 = new So4();
  return T.compare(s212, t8, e7, i12), i12.changes;
}
function Mo4(s212, t8) {
  for (let e7 = s212; e7 && e7 != t8; e7 = e7.assignedSlot || e7.parentNode) if (e7.nodeType == 1 && e7.contentEditable == "false") return true;
  return false;
}
function ko4(s212, t8) {
  let e7 = false;
  return t8 && s212.iterChangedRanges((i12, n14) => {
    i12 < t8.to && n14 > t8.from && (e7 = true);
  }), e7;
}
function Ao4(s212, t8, e7 = 1) {
  let i12 = s212.charCategorizer(t8), n14 = s212.doc.lineAt(t8), o = t8 - n14.from;
  if (n14.length == 0) return x.cursor(t8);
  o == 0 ? e7 = 1 : o == n14.length && (e7 = -1);
  let r2 = o, l11 = o;
  e7 < 0 ? r2 = ee(n14.text, o, false) : l11 = ee(n14.text, o);
  let h3 = i12(n14.text.slice(r2, l11));
  for (; r2 > 0; ) {
    let c3 = ee(n14.text, r2, false);
    if (i12(n14.text.slice(c3, r2)) != h3) break;
    r2 = c3;
  }
  for (; l11 < n14.length; ) {
    let c3 = ee(n14.text, l11);
    if (i12(n14.text.slice(l11, c3)) != h3) break;
    l11 = c3;
  }
  return x.range(r2 + n14.from, l11 + n14.from);
}
function Do4(s212, t8) {
  return t8.left > s212 ? t8.left - s212 : Math.max(0, s212 - t8.right);
}
function Oo4(s212, t8) {
  return t8.top > s212 ? t8.top - s212 : Math.max(0, s212 - t8.bottom);
}
function Ie7(s212, t8) {
  return s212.top < t8.bottom - 1 && s212.bottom > t8.top + 1;
}
function Zi4(s212, t8) {
  return t8 < s212.top ? { top: t8, left: s212.left, right: s212.right, bottom: s212.bottom } : s212;
}
function ts4(s212, t8) {
  return t8 > s212.bottom ? { top: s212.top, left: s212.left, right: s212.right, bottom: t8 } : s212;
}
function oi4(s212, t8, e7) {
  let i12, n14, o, r2, l11 = false, h3, c3, a2, f6;
  for (let p3 = s212.firstChild; p3; p3 = p3.nextSibling) {
    let g8 = At6(p3);
    for (let b12 = 0; b12 < g8.length; b12++) {
      let m11 = g8[b12];
      n14 && Ie7(n14, m11) && (m11 = Zi4(ts4(m11, n14.bottom), n14.top));
      let w14 = Do4(t8, m11), v10 = Oo4(e7, m11);
      if (w14 == 0 && v10 == 0) return p3.nodeType == 3 ? es4(p3, t8, e7) : oi4(p3, t8, e7);
      if (!i12 || r2 > v10 || r2 == v10 && o > w14) {
        i12 = p3, n14 = m11, o = w14, r2 = v10;
        let x11 = v10 ? e7 < m11.top ? -1 : 1 : w14 ? t8 < m11.left ? -1 : 1 : 0;
        l11 = !x11 || (x11 > 0 ? b12 < g8.length - 1 : b12 > 0);
      }
      w14 == 0 ? e7 > m11.bottom && (!a2 || a2.bottom < m11.bottom) ? (h3 = p3, a2 = m11) : e7 < m11.top && (!f6 || f6.top > m11.top) && (c3 = p3, f6 = m11) : a2 && Ie7(a2, m11) ? a2 = ts4(a2, m11.bottom) : f6 && Ie7(f6, m11) && (f6 = Zi4(f6, m11.top));
    }
  }
  if (a2 && a2.bottom >= e7 ? (i12 = h3, n14 = a2) : f6 && f6.top <= e7 && (i12 = c3, n14 = f6), !i12) return { node: s212, offset: 0 };
  let d4 = Math.max(n14.left, Math.min(n14.right, t8));
  if (i12.nodeType == 3) return es4(i12, d4, e7);
  if (l11 && i12.contentEditable != "false") return oi4(i12, d4, e7);
  let u3 = Array.prototype.indexOf.call(s212.childNodes, i12) + (t8 >= (n14.left + n14.right) / 2 ? 1 : 0);
  return { node: s212, offset: u3 };
}
function es4(s212, t8, e7) {
  let i12 = s212.nodeValue.length, n14 = -1, o = 1e9, r2 = 0;
  for (let l11 = 0; l11 < i12; l11++) {
    let h3 = pt5(s212, l11, l11 + 1).getClientRects();
    for (let c3 = 0; c3 < h3.length; c3++) {
      let a2 = h3[c3];
      if (a2.top == a2.bottom) continue;
      r2 || (r2 = t8 - a2.left);
      let f6 = (a2.top > e7 ? a2.top - e7 : e7 - a2.bottom) - 1;
      if (a2.left - 1 <= t8 && a2.right + 1 >= t8 && f6 < o) {
        let d4 = t8 >= (a2.left + a2.right) / 2, u3 = d4;
        if ((y9.chrome || y9.gecko) && pt5(s212, l11).getBoundingClientRect().left == a2.right && (u3 = !d4), f6 <= 0) return { node: s212, offset: l11 + (u3 ? 1 : 0) };
        n14 = l11 + (u3 ? 1 : 0), o = f6;
      }
    }
  }
  return { node: s212, offset: n14 > -1 ? n14 : r2 > 0 ? s212.nodeValue.length : 0 };
}
function vn4(s212, t8, e7, i12 = -1) {
  var n14, o;
  let r2 = s212.contentDOM.getBoundingClientRect(), l11 = r2.top + s212.viewState.paddingTop, h3, { docHeight: c3 } = s212.viewState, { x: a2, y: f6 } = t8, d4 = f6 - l11;
  if (d4 < 0) return 0;
  if (d4 > c3) return s212.state.doc.length;
  for (let x11 = s212.viewState.heightOracle.textHeight / 2, S17 = false; h3 = s212.elementAtHeight(d4), h3.type != F10.Text; ) for (; d4 = i12 > 0 ? h3.bottom + x11 : h3.top - x11, !(d4 >= 0 && d4 <= c3); ) {
    if (S17) return e7 ? null : 0;
    S17 = true, i12 = -i12;
  }
  f6 = l11 + d4;
  let u3 = h3.from;
  if (u3 < s212.viewport.from) return s212.viewport.from == 0 ? 0 : e7 ? null : is4(s212, r2, h3, a2, f6);
  if (u3 > s212.viewport.to) return s212.viewport.to == s212.state.doc.length ? s212.state.doc.length : e7 ? null : is4(s212, r2, h3, a2, f6);
  let p3 = s212.dom.ownerDocument, g8 = s212.root.elementFromPoint ? s212.root : p3, b12 = g8.elementFromPoint(a2, f6);
  b12 && !s212.contentDOM.contains(b12) && (b12 = null), b12 || (a2 = Math.max(r2.left + 1, Math.min(r2.right - 1, a2)), b12 = g8.elementFromPoint(a2, f6), b12 && !s212.contentDOM.contains(b12) && (b12 = null));
  let m11, w14 = -1;
  if (b12 && ((n14 = s212.docView.nearest(b12)) === null || n14 === void 0 ? void 0 : n14.isEditable) != false) {
    if (p3.caretPositionFromPoint) {
      let x11 = p3.caretPositionFromPoint(a2, f6);
      x11 && ({ offsetNode: m11, offset: w14 } = x11);
    } else if (p3.caretRangeFromPoint) {
      let x11 = p3.caretRangeFromPoint(a2, f6);
      x11 && ({ startContainer: m11, startOffset: w14 } = x11, (!s212.contentDOM.contains(m11) || y9.safari && To4(m11, w14, a2) || y9.chrome && Ro4(m11, w14, a2)) && (m11 = void 0));
    }
    m11 && (w14 = Math.min(U10(m11), w14));
  }
  if (!m11 || !s212.docView.dom.contains(m11)) {
    let x11 = P10.find(s212.docView, u3);
    if (!x11) return d4 > h3.top + h3.height / 2 ? h3.to : h3.from;
    ({ node: m11, offset: w14 } = oi4(x11.dom, a2, f6));
  }
  let v10 = s212.docView.nearest(m11);
  if (!v10) return null;
  if (v10.isWidget && ((o = v10.dom) === null || o === void 0 ? void 0 : o.nodeType) == 1) {
    let x11 = v10.dom.getBoundingClientRect();
    return t8.y < x11.top || t8.y <= x11.bottom && t8.x <= (x11.left + x11.right) / 2 ? v10.posAtStart : v10.posAtEnd;
  } else return v10.localPosFromDOM(m11, w14) + v10.posAtStart;
}
function is4(s212, t8, e7, i12, n14) {
  let o = Math.round((i12 - t8.left) * s212.defaultCharacterWidth);
  if (s212.lineWrapping && e7.height > s212.defaultLineHeight * 1.5) {
    let l11 = s212.viewState.heightOracle.textHeight, h3 = Math.floor((n14 - e7.top - (s212.defaultLineHeight - l11) * 0.5) / l11);
    o += h3 * s212.viewState.heightOracle.lineLength;
  }
  let r2 = s212.state.sliceDoc(e7.from, e7.to);
  return e7.from + ft(r2, o, s212.state.tabSize);
}
function To4(s212, t8, e7) {
  let i12;
  if (s212.nodeType != 3 || t8 != (i12 = s212.nodeValue.length)) return false;
  for (let n14 = s212.nextSibling; n14; n14 = n14.nextSibling) if (n14.nodeType != 1 || n14.nodeName != "BR") return false;
  return pt5(s212, i12 - 1, i12).getBoundingClientRect().left > e7;
}
function Ro4(s212, t8, e7) {
  if (t8 != 0) return false;
  for (let n14 = s212; ; ) {
    let o = n14.parentNode;
    if (!o || o.nodeType != 1 || o.firstChild != n14) return false;
    if (o.classList.contains("cm-line")) break;
    n14 = o;
  }
  let i12 = s212.nodeType == 1 ? s212.getBoundingClientRect() : pt5(s212, 0, Math.max(s212.nodeValue.length, 1)).getBoundingClientRect();
  return e7 - i12.left > 5;
}
function ri4(s212, t8) {
  let e7 = s212.lineBlockAt(t8);
  if (Array.isArray(e7.type)) {
    for (let i12 of e7.type) if (i12.to > t8 || i12.to == t8 && (i12.to == e7.to || i12.type == F10.Text)) return i12;
  }
  return e7;
}
function Eo4(s212, t8, e7, i12) {
  let n14 = ri4(s212, t8.head), o = !i12 || n14.type != F10.Text || !(s212.lineWrapping || n14.widgetLineBreaks) ? null : s212.coordsAtPos(t8.assoc < 0 && t8.head > n14.from ? t8.head - 1 : t8.head);
  if (o) {
    let r2 = s212.dom.getBoundingClientRect(), l11 = s212.textDirectionAt(n14.from), h3 = s212.posAtCoords({ x: e7 == (l11 == L8.LTR) ? r2.right - 1 : r2.left + 1, y: (o.top + o.bottom) / 2 });
    if (h3 != null) return x.cursor(h3, e7 ? -1 : 1);
  }
  return x.cursor(e7 ? n14.to : n14.from, e7 ? -1 : 1);
}
function ss4(s212, t8, e7, i12) {
  let n14 = s212.state.doc.lineAt(t8.head), o = s212.bidiSpans(n14), r2 = s212.textDirectionAt(n14.from);
  for (let l11 = t8, h3 = null; ; ) {
    let c3 = nn5(n14, o, r2, l11, e7), a2 = sn5;
    if (!c3) {
      if (n14.number == (e7 ? s212.state.doc.lines : 1)) return l11;
      a2 = `
`, n14 = s212.state.doc.line(n14.number + (e7 ? 1 : -1)), o = s212.bidiSpans(n14), c3 = s212.visualLineSide(n14, !e7);
    }
    if (h3) {
      if (!h3(a2)) return l11;
    } else {
      if (!i12) return c3;
      h3 = i12(a2);
    }
    l11 = c3;
  }
}
function Lo4(s212, t8, e7) {
  let i12 = s212.state.charCategorizer(t8), n14 = i12(e7);
  return (o) => {
    let r2 = i12(o);
    return n14 == O.Space && (n14 = r2), n14 == r2;
  };
}
function Bo4(s212, t8, e7, i12) {
  let n14 = t8.head, o = e7 ? 1 : -1;
  if (n14 == (e7 ? s212.state.doc.length : 0)) return x.cursor(n14, t8.assoc);
  let r2 = t8.goalColumn, l11, h3 = s212.contentDOM.getBoundingClientRect(), c3 = s212.coordsAtPos(n14, t8.assoc || -1), a2 = s212.documentTop;
  if (c3) r2 == null && (r2 = c3.left - h3.left), l11 = o < 0 ? c3.top : c3.bottom;
  else {
    let u3 = s212.viewState.lineBlockAt(n14);
    r2 == null && (r2 = Math.min(h3.right - h3.left, s212.defaultCharacterWidth * (n14 - u3.from))), l11 = (o < 0 ? u3.top : u3.bottom) + a2;
  }
  let f6 = h3.left + r2, d4 = i12 ?? s212.viewState.heightOracle.textHeight >> 1;
  for (let u3 = 0; ; u3 += 10) {
    let p3 = l11 + (d4 + u3) * o, g8 = vn4(s212, { x: f6, y: p3 }, false, o);
    if (p3 < h3.top || p3 > h3.bottom || (o < 0 ? g8 < n14 : g8 > n14)) {
      let b12 = s212.docView.coordsForChar(g8), m11 = !b12 || p3 < b12.top ? -1 : 1;
      return x.cursor(g8, m11, void 0, r2);
    }
  }
}
function pe8(s212, t8, e7) {
  for (; ; ) {
    let i12 = 0;
    for (let n14 of s212) n14.between(t8 - 1, t8 + 1, (o, r2, l11) => {
      if (t8 > o && t8 < r2) {
        let h3 = i12 || e7 || (t8 - o < r2 - t8 ? -1 : 1);
        t8 = h3 < 0 ? o : r2, i12 = h3;
      }
    });
    if (!i12) return t8;
  }
}
function Ke8(s212, t8, e7) {
  let i12 = pe8(s212.state.facet(Ki4).map((n14) => n14(s212)), e7.from, t8.head > e7.from ? -1 : 1);
  return i12 == e7.from ? e7 : x.cursor(i12, i12 < e7.from ? 1 : -1);
}
var Bt5 = "ï¿¿";
var li4 = class {
  constructor(t8, e7) {
    this.points = t8, this.text = "", this.lineSeparator = e7.facet(I.lineSeparator);
  }
  append(t8) {
    this.text += t8;
  }
  lineBreak() {
    this.text += Bt5;
  }
  readRange(t8, e7) {
    if (!t8) return this;
    let i12 = t8.parentNode;
    for (let n14 = t8; ; ) {
      this.findPointBefore(i12, n14);
      let o = this.text.length;
      this.readNode(n14);
      let r2 = n14.nextSibling;
      if (r2 == e7) break;
      let l11 = R8.get(n14), h3 = R8.get(r2);
      (l11 && h3 ? l11.breakAfter : (l11 ? l11.breakAfter : xe9(n14)) || xe9(r2) && (n14.nodeName != "BR" || n14.cmIgnore) && this.text.length > o) && this.lineBreak(), n14 = r2;
    }
    return this.findPointBefore(i12, e7), this;
  }
  readTextNode(t8) {
    let e7 = t8.nodeValue;
    for (let i12 of this.points) i12.node == t8 && (i12.pos = this.text.length + Math.min(i12.offset, e7.length));
    for (let i12 = 0, n14 = this.lineSeparator ? null : /\r\n?|\n/g; ; ) {
      let o = -1, r2 = 1, l11;
      if (this.lineSeparator ? (o = e7.indexOf(this.lineSeparator, i12), r2 = this.lineSeparator.length) : (l11 = n14.exec(e7)) && (o = l11.index, r2 = l11[0].length), this.append(e7.slice(i12, o < 0 ? e7.length : o)), o < 0) break;
      if (this.lineBreak(), r2 > 1) for (let h3 of this.points) h3.node == t8 && h3.pos > this.text.length && (h3.pos -= r2 - 1);
      i12 = o + r2;
    }
  }
  readNode(t8) {
    if (t8.cmIgnore) return;
    let e7 = R8.get(t8), i12 = e7 && e7.overrideDOMText;
    if (i12 != null) {
      this.findPointInside(t8, i12.length);
      for (let n14 = i12.iter(); !n14.next().done; ) n14.lineBreak ? this.lineBreak() : this.append(n14.value);
    } else t8.nodeType == 3 ? this.readTextNode(t8) : t8.nodeName == "BR" ? t8.nextSibling && this.lineBreak() : t8.nodeType == 1 && this.readRange(t8.firstChild, null);
  }
  findPointBefore(t8, e7) {
    for (let i12 of this.points) i12.node == t8 && t8.childNodes[i12.offset] == e7 && (i12.pos = this.text.length);
  }
  findPointInside(t8, e7) {
    for (let i12 of this.points) (t8.nodeType == 3 ? i12.node == t8 : t8.contains(i12.node)) && (i12.pos = this.text.length + (Po4(t8, i12.node, i12.offset) ? e7 : 0));
  }
};
function Po4(s212, t8, e7) {
  for (; ; ) {
    if (!t8 || e7 < U10(t8)) return false;
    if (t8 == s212) return true;
    e7 = ut5(t8) + 1, t8 = t8.parentNode;
  }
}
var ke7 = class {
  constructor(t8, e7) {
    this.node = t8, this.offset = e7, this.pos = -1;
  }
};
var hi4 = class {
  constructor(t8, e7, i12, n14) {
    this.typeOver = n14, this.bounds = null, this.text = "", this.domChanged = e7 > -1;
    let { impreciseHead: o, impreciseAnchor: r2 } = t8.docView;
    if (t8.state.readOnly && e7 > -1) this.newSel = null;
    else if (e7 > -1 && (this.bounds = t8.docView.domBoundsAround(e7, i12, 0))) {
      let l11 = o || r2 ? [] : Vo4(t8), h3 = new li4(l11, t8.state);
      h3.readRange(this.bounds.startDOM, this.bounds.endDOM), this.text = h3.text, this.newSel = Fo4(l11, this.bounds.from);
    } else {
      let l11 = t8.observer.selectionRange, h3 = o && o.node == l11.focusNode && o.offset == l11.focusOffset || !Xe7(t8.contentDOM, l11.focusNode) ? t8.state.selection.main.head : t8.docView.posFromDOM(l11.focusNode, l11.focusOffset), c3 = r2 && r2.node == l11.anchorNode && r2.offset == l11.anchorOffset || !Xe7(t8.contentDOM, l11.anchorNode) ? t8.state.selection.main.anchor : t8.docView.posFromDOM(l11.anchorNode, l11.anchorOffset), a2 = t8.viewport;
      if ((y9.ios || y9.chrome) && t8.state.selection.main.empty && h3 != c3 && (a2.from > 0 || a2.to < t8.state.doc.length)) {
        let f6 = Math.min(h3, c3), d4 = Math.max(h3, c3), u3 = a2.from - f6, p3 = a2.to - d4;
        (u3 == 0 || u3 == 1 || f6 == 0) && (p3 == 0 || p3 == -1 || d4 == t8.state.doc.length) && (h3 = 0, c3 = t8.state.doc.length);
      }
      this.newSel = x.single(c3, h3);
    }
  }
};
function Sn6(s212, t8) {
  let e7, { newSel: i12 } = t8, n14 = s212.state.selection.main, o = s212.inputState.lastKeyTime > Date.now() - 100 ? s212.inputState.lastKeyCode : -1;
  if (t8.bounds) {
    let { from: r2, to: l11 } = t8.bounds, h3 = n14.from, c3 = null;
    (o === 8 || y9.android && t8.text.length < l11 - r2) && (h3 = n14.to, c3 = "end");
    let a2 = No4(s212.state.doc.sliceString(r2, l11, Bt5), t8.text, h3 - r2, c3);
    a2 && (y9.chrome && o == 13 && a2.toB == a2.from + 2 && t8.text.slice(a2.from, a2.toB) == Bt5 + Bt5 && a2.toB--, e7 = { from: r2 + a2.from, to: r2 + a2.toA, insert: m.of(t8.text.slice(a2.from, a2.toB).split(Bt5)) });
  } else i12 && (!s212.hasFocus && s212.state.facet(st7) || i12.main.eq(n14)) && (i12 = null);
  if (!e7 && !i12) return false;
  if (!e7 && t8.typeOver && !n14.empty && i12 && i12.main.empty ? e7 = { from: n14.from, to: n14.to, insert: s212.state.doc.slice(n14.from, n14.to) } : e7 && e7.from >= n14.from && e7.to <= n14.to && (e7.from != n14.from || e7.to != n14.to) && n14.to - n14.from - (e7.to - e7.from) <= 4 ? e7 = { from: n14.from, to: n14.to, insert: s212.state.doc.slice(n14.from, e7.from).append(e7.insert).append(s212.state.doc.slice(e7.to, n14.to)) } : (y9.mac || y9.android) && e7 && e7.from == e7.to && e7.from == n14.head - 1 && /^\. ?$/.test(e7.insert.toString()) && s212.contentDOM.getAttribute("autocorrect") == "off" ? (i12 && e7.insert.length == 2 && (i12 = x.single(i12.main.anchor - 1, i12.main.head - 1)), e7 = { from: n14.from, to: n14.to, insert: m.of([" "]) }) : y9.chrome && e7 && e7.from == e7.to && e7.from == n14.head && e7.insert.toString() == `
 ` && s212.lineWrapping && (i12 && (i12 = x.single(i12.main.anchor - 1, i12.main.head - 1)), e7 = { from: n14.from, to: n14.to, insert: m.of([" "]) }), e7) return qi4(s212, e7, i12, o);
  if (i12 && !i12.main.eq(n14)) {
    let r2 = false, l11 = "select";
    return s212.inputState.lastSelectionTime > Date.now() - 50 && (s212.inputState.lastSelectionOrigin == "select" && (r2 = true), l11 = s212.inputState.lastSelectionOrigin), s212.dispatch({ selection: i12, scrollIntoView: r2, userEvent: l11 }), true;
  } else return false;
}
function qi4(s212, t8, e7, i12 = -1) {
  if (y9.ios && s212.inputState.flushIOSKey(t8)) return true;
  let n14 = s212.state.selection.main;
  if (y9.android && (t8.to == n14.to && (t8.from == n14.from || t8.from == n14.from - 1 && s212.state.sliceDoc(t8.from, n14.from) == " ") && t8.insert.length == 1 && t8.insert.lines == 2 && Mt5(s212.contentDOM, "Enter", 13) || (t8.from == n14.from - 1 && t8.to == n14.to && t8.insert.length == 0 || i12 == 8 && t8.insert.length < t8.to - t8.from && t8.to > n14.head) && Mt5(s212.contentDOM, "Backspace", 8) || t8.from == n14.from && t8.to == n14.to + 1 && t8.insert.length == 0 && Mt5(s212.contentDOM, "Delete", 46))) return true;
  let o = t8.insert.toString();
  s212.inputState.composing >= 0 && s212.inputState.composing++;
  let r2, l11 = () => r2 || (r2 = Ho4(s212, t8, e7));
  return s212.state.facet(an4).some((h3) => h3(s212, t8.from, t8.to, o, l11)) || s212.dispatch(l11()), true;
}
function Ho4(s212, t8, e7) {
  let i12, n14 = s212.state, o = n14.selection.main;
  if (t8.from >= o.from && t8.to <= o.to && t8.to - t8.from >= (o.to - o.from) / 3 && (!e7 || e7.main.empty && e7.main.from == t8.from + t8.insert.length) && s212.inputState.composing < 0) {
    let l11 = o.from < t8.from ? n14.sliceDoc(o.from, t8.from) : "", h3 = o.to > t8.to ? n14.sliceDoc(t8.to, o.to) : "";
    i12 = n14.replaceSelection(s212.state.toText(l11 + t8.insert.sliceString(0, void 0, s212.state.lineBreak) + h3));
  } else {
    let l11 = n14.changes(t8), h3 = e7 && e7.main.to <= l11.newLength ? e7.main : void 0;
    if (n14.selection.ranges.length > 1 && s212.inputState.composing >= 0 && t8.to <= o.to && t8.to >= o.to - 10) {
      let c3 = s212.state.sliceDoc(t8.from, t8.to), a2, f6 = e7 && xn4(s212, e7.main.head);
      if (f6) {
        let p3 = t8.insert.length - (t8.to - t8.from);
        a2 = { from: f6.from, to: f6.to - p3 };
      } else a2 = s212.state.doc.lineAt(o.head);
      let d4 = o.to - t8.to, u3 = o.to - o.from;
      i12 = n14.changeByRange((p3) => {
        if (p3.from == o.from && p3.to == o.to) return { changes: l11, range: h3 || p3.map(l11) };
        let g8 = p3.to - d4, b12 = g8 - c3.length;
        if (p3.to - p3.from != u3 || s212.state.sliceDoc(b12, g8) != c3 || p3.to >= a2.from && p3.from <= a2.to) return { range: p3 };
        let m11 = n14.changes({ from: b12, to: g8, insert: t8.insert }), w14 = p3.to - o.to;
        return { changes: m11, range: h3 ? x.range(Math.max(0, h3.anchor + w14), Math.max(0, h3.head + w14)) : p3.map(m11) };
      });
    } else i12 = { changes: l11, selection: h3 && n14.selection.replaceRange(h3) };
  }
  let r2 = "input.type";
  return (s212.composing || s212.inputState.compositionPendingChange && s212.inputState.compositionEndedAt > Date.now() - 50) && (s212.inputState.compositionPendingChange = false, r2 += ".compose", s212.inputState.compositionFirstChange && (r2 += ".start", s212.inputState.compositionFirstChange = false)), n14.update(i12, { userEvent: r2, scrollIntoView: true });
}
function No4(s212, t8, e7, i12) {
  let n14 = Math.min(s212.length, t8.length), o = 0;
  for (; o < n14 && s212.charCodeAt(o) == t8.charCodeAt(o); ) o++;
  if (o == n14 && s212.length == t8.length) return null;
  let r2 = s212.length, l11 = t8.length;
  for (; r2 > 0 && l11 > 0 && s212.charCodeAt(r2 - 1) == t8.charCodeAt(l11 - 1); ) r2--, l11--;
  if (i12 == "end") {
    let h3 = Math.max(0, o - Math.min(r2, l11));
    e7 -= r2 + h3 - o;
  }
  if (r2 < o && s212.length < t8.length) {
    let h3 = e7 <= o && e7 >= r2 ? o - e7 : 0;
    o -= h3, l11 = o + (l11 - r2), r2 = o;
  } else if (l11 < o) {
    let h3 = e7 <= o && e7 >= l11 ? o - e7 : 0;
    o -= h3, r2 = o + (r2 - l11), l11 = o;
  }
  return { from: o, toA: r2, toB: l11 };
}
function Vo4(s212) {
  let t8 = [];
  if (s212.root.activeElement != s212.contentDOM) return t8;
  let { anchorNode: e7, anchorOffset: i12, focusNode: n14, focusOffset: o } = s212.observer.selectionRange;
  return e7 && (t8.push(new ke7(e7, i12)), (n14 != e7 || o != i12) && t8.push(new ke7(n14, o))), t8;
}
function Fo4(s212, t8) {
  if (s212.length == 0) return null;
  let e7 = s212[0].pos, i12 = s212.length == 2 ? s212[1].pos : e7;
  return e7 > -1 && i12 > -1 ? x.single(e7 + t8, i12 + t8) : null;
}
var ai4 = class {
  setSelectionOrigin(t8) {
    this.lastSelectionOrigin = t8, this.lastSelectionTime = Date.now();
  }
  constructor(t8) {
    this.view = t8, this.lastKeyCode = 0, this.lastKeyTime = 0, this.lastTouchTime = 0, this.lastFocusTime = 0, this.lastScrollTop = 0, this.lastScrollLeft = 0, this.pendingIOSKey = void 0, this.tabFocusMode = -1, this.lastSelectionOrigin = null, this.lastSelectionTime = 0, this.lastContextMenu = 0, this.scrollHandlers = [], this.handlers = /* @__PURE__ */ Object.create(null), this.composing = -1, this.compositionFirstChange = null, this.compositionEndedAt = 0, this.compositionPendingKey = false, this.compositionPendingChange = false, this.mouseSelection = null, this.draggedContent = null, this.handleEvent = this.handleEvent.bind(this), this.notifiedFocused = t8.hasFocus, y9.safari && t8.contentDOM.addEventListener("input", () => null), y9.gecko && Zo4(t8.contentDOM.ownerDocument);
  }
  handleEvent(t8) {
    !Yo4(this.view, t8) || this.ignoreDuringComposition(t8) || t8.type == "keydown" && this.keydown(t8) || this.runHandlers(t8.type, t8);
  }
  runHandlers(t8, e7) {
    let i12 = this.handlers[t8];
    if (i12) {
      for (let n14 of i12.observers) n14(this.view, e7);
      for (let n14 of i12.handlers) {
        if (e7.defaultPrevented) break;
        if (n14(this.view, e7)) {
          e7.preventDefault();
          break;
        }
      }
    }
  }
  ensureHandlers(t8) {
    let e7 = Wo4(t8), i12 = this.handlers, n14 = this.view.contentDOM;
    for (let o in e7) if (o != "scroll") {
      let r2 = !e7[o].handlers.length, l11 = i12[o];
      l11 && r2 != !l11.handlers.length && (n14.removeEventListener(o, this.handleEvent), l11 = null), l11 || n14.addEventListener(o, this.handleEvent, { passive: r2 });
    }
    for (let o in i12) o != "scroll" && !e7[o] && n14.removeEventListener(o, this.handleEvent);
    this.handlers = e7;
  }
  keydown(t8) {
    if (this.lastKeyCode = t8.keyCode, this.lastKeyTime = Date.now(), t8.keyCode == 9 && this.tabFocusMode > -1 && (!this.tabFocusMode || Date.now() <= this.tabFocusMode)) return true;
    if (this.tabFocusMode > 0 && t8.keyCode != 27 && Mn4.indexOf(t8.keyCode) < 0 && (this.tabFocusMode = -1), y9.android && y9.chrome && !t8.synthetic && (t8.keyCode == 13 || t8.keyCode == 8)) return this.view.observer.delayAndroidKey(t8.key, t8.keyCode), true;
    let e7;
    return y9.ios && !t8.synthetic && !t8.altKey && !t8.metaKey && ((e7 = Cn5.find((i12) => i12.keyCode == t8.keyCode)) && !t8.ctrlKey || zo4.indexOf(t8.key) > -1 && t8.ctrlKey && !t8.shiftKey) ? (this.pendingIOSKey = e7 || t8, setTimeout(() => this.flushIOSKey(), 250), true) : (t8.keyCode != 229 && this.view.observer.forceFlush(), false);
  }
  flushIOSKey(t8) {
    let e7 = this.pendingIOSKey;
    return !e7 || e7.key == "Enter" && t8 && t8.from < t8.to && /^\S+$/.test(t8.insert.toString()) ? false : (this.pendingIOSKey = void 0, Mt5(this.view.contentDOM, e7.key, e7.keyCode, e7 instanceof KeyboardEvent ? e7 : void 0));
  }
  ignoreDuringComposition(t8) {
    return /^key/.test(t8.type) ? this.composing > 0 ? true : y9.safari && !y9.ios && this.compositionPendingKey && Date.now() - this.compositionEndedAt < 100 ? (this.compositionPendingKey = false, true) : false : false;
  }
  startMouseSelection(t8) {
    this.mouseSelection && this.mouseSelection.destroy(), this.mouseSelection = t8;
  }
  update(t8) {
    this.view.observer.update(t8), this.mouseSelection && this.mouseSelection.update(t8), this.draggedContent && t8.docChanged && (this.draggedContent = this.draggedContent.map(t8.changes)), t8.transactions.length && (this.lastKeyCode = this.lastSelectionTime = 0);
  }
  destroy() {
    this.mouseSelection && this.mouseSelection.destroy();
  }
};
function ns4(s212, t8) {
  return (e7, i12) => {
    try {
      return t8.call(s212, i12, e7);
    } catch (n14) {
      $7(e7.state, n14);
    }
  };
}
function Wo4(s212) {
  let t8 = /* @__PURE__ */ Object.create(null);
  function e7(i12) {
    return t8[i12] || (t8[i12] = { observers: [], handlers: [] });
  }
  for (let i12 of s212) {
    let n14 = i12.spec;
    if (n14 && n14.domEventHandlers) for (let o in n14.domEventHandlers) {
      let r2 = n14.domEventHandlers[o];
      r2 && e7(o).handlers.push(ns4(i12.value, r2));
    }
    if (n14 && n14.domEventObservers) for (let o in n14.domEventObservers) {
      let r2 = n14.domEventObservers[o];
      r2 && e7(o).observers.push(ns4(i12.value, r2));
    }
  }
  for (let i12 in Y10) e7(i12).handlers.push(Y10[i12]);
  for (let i12 in K7) e7(i12).observers.push(K7[i12]);
  return t8;
}
var Cn5 = [{ key: "Backspace", keyCode: 8, inputType: "deleteContentBackward" }, { key: "Enter", keyCode: 13, inputType: "insertParagraph" }, { key: "Enter", keyCode: 13, inputType: "insertLineBreak" }, { key: "Delete", keyCode: 46, inputType: "deleteContentForward" }];
var zo4 = "dthko";
var Mn4 = [16, 17, 18, 20, 91, 92, 224, 225];
var re7 = 6;
function le9(s212) {
  return Math.max(0, s212) * 0.7 + 8;
}
function Io4(s212, t8) {
  return Math.max(Math.abs(s212.clientX - t8.clientX), Math.abs(s212.clientY - t8.clientY));
}
var ci4 = class {
  constructor(t8, e7, i12, n14) {
    this.view = t8, this.startEvent = e7, this.style = i12, this.mustSelect = n14, this.scrollSpeed = { x: 0, y: 0 }, this.scrolling = -1, this.lastEvent = e7, this.scrollParents = io4(t8.contentDOM), this.atoms = t8.state.facet(Ki4).map((r2) => r2(t8));
    let o = t8.contentDOM.ownerDocument;
    o.addEventListener("mousemove", this.move = this.move.bind(this)), o.addEventListener("mouseup", this.up = this.up.bind(this)), this.extend = e7.shiftKey, this.multiple = t8.state.facet(I.allowMultipleSelections) && Ko4(t8, e7), this.dragging = jo4(t8, e7) && Dn4(e7) == 1 ? null : false;
  }
  start(t8) {
    this.dragging === false && this.select(t8);
  }
  move(t8) {
    if (t8.buttons == 0) return this.destroy();
    if (this.dragging || this.dragging == null && Io4(this.startEvent, t8) < 10) return;
    this.select(this.lastEvent = t8);
    let e7 = 0, i12 = 0, n14 = 0, o = 0, r2 = this.view.win.innerWidth, l11 = this.view.win.innerHeight;
    this.scrollParents.x && ({ left: n14, right: r2 } = this.scrollParents.x.getBoundingClientRect()), this.scrollParents.y && ({ top: o, bottom: l11 } = this.scrollParents.y.getBoundingClientRect());
    let h3 = wn4(this.view);
    t8.clientX - h3.left <= n14 + re7 ? e7 = -le9(n14 - t8.clientX) : t8.clientX + h3.right >= r2 - re7 && (e7 = le9(t8.clientX - r2)), t8.clientY - h3.top <= o + re7 ? i12 = -le9(o - t8.clientY) : t8.clientY + h3.bottom >= l11 - re7 && (i12 = le9(t8.clientY - l11)), this.setScrollSpeed(e7, i12);
  }
  up(t8) {
    this.dragging == null && this.select(this.lastEvent), this.dragging || t8.preventDefault(), this.destroy();
  }
  destroy() {
    this.setScrollSpeed(0, 0);
    let t8 = this.view.contentDOM.ownerDocument;
    t8.removeEventListener("mousemove", this.move), t8.removeEventListener("mouseup", this.up), this.view.inputState.mouseSelection = this.view.inputState.draggedContent = null;
  }
  setScrollSpeed(t8, e7) {
    this.scrollSpeed = { x: t8, y: e7 }, t8 || e7 ? this.scrolling < 0 && (this.scrolling = setInterval(() => this.scroll(), 50)) : this.scrolling > -1 && (clearInterval(this.scrolling), this.scrolling = -1);
  }
  scroll() {
    let { x: t8, y: e7 } = this.scrollSpeed;
    t8 && this.scrollParents.x && (this.scrollParents.x.scrollLeft += t8, t8 = 0), e7 && this.scrollParents.y && (this.scrollParents.y.scrollTop += e7, e7 = 0), (t8 || e7) && this.view.win.scrollBy(t8, e7), this.dragging === false && this.select(this.lastEvent);
  }
  skipAtoms(t8) {
    let e7 = null;
    for (let i12 = 0; i12 < t8.ranges.length; i12++) {
      let n14 = t8.ranges[i12], o = null;
      if (n14.empty) {
        let r2 = pe8(this.atoms, n14.from, 0);
        r2 != n14.from && (o = x.cursor(r2, -1));
      } else {
        let r2 = pe8(this.atoms, n14.from, -1), l11 = pe8(this.atoms, n14.to, 1);
        (r2 != n14.from || l11 != n14.to) && (o = x.range(n14.from == n14.anchor ? r2 : l11, n14.from == n14.head ? r2 : l11));
      }
      o && (e7 || (e7 = t8.ranges.slice()), e7[i12] = o);
    }
    return e7 ? x.create(e7, t8.mainIndex) : t8;
  }
  select(t8) {
    let { view: e7 } = this, i12 = this.skipAtoms(this.style.get(t8, this.extend, this.multiple));
    (this.mustSelect || !i12.eq(e7.state.selection, this.dragging === false)) && this.view.dispatch({ selection: i12, userEvent: "select.pointer" }), this.mustSelect = false;
  }
  update(t8) {
    t8.transactions.some((e7) => e7.isUserEvent("input.type")) ? this.destroy() : this.style.update(t8) && setTimeout(() => this.select(this.lastEvent), 20);
  }
};
function Ko4(s212, t8) {
  let e7 = s212.state.facet(on5);
  return e7.length ? e7[0](t8) : y9.mac ? t8.metaKey : t8.ctrlKey;
}
function qo4(s212, t8) {
  let e7 = s212.state.facet(rn5);
  return e7.length ? e7[0](t8) : y9.mac ? !t8.altKey : !t8.ctrlKey;
}
function jo4(s212, t8) {
  let { main: e7 } = s212.state.selection;
  if (e7.empty) return false;
  let i12 = jt6(s212.root);
  if (!i12 || i12.rangeCount == 0) return true;
  let n14 = i12.getRangeAt(0).getClientRects();
  for (let o = 0; o < n14.length; o++) {
    let r2 = n14[o];
    if (r2.left <= t8.clientX && r2.right >= t8.clientX && r2.top <= t8.clientY && r2.bottom >= t8.clientY) return true;
  }
  return false;
}
function Yo4(s212, t8) {
  if (!t8.bubbles) return true;
  if (t8.defaultPrevented) return false;
  for (let e7 = t8.target, i12; e7 != s212.contentDOM; e7 = e7.parentNode) if (!e7 || e7.nodeType == 11 || (i12 = R8.get(e7)) && i12.ignoreEvent(t8)) return false;
  return true;
}
var Y10 = /* @__PURE__ */ Object.create(null);
var K7 = /* @__PURE__ */ Object.create(null);
var kn5 = y9.ie && y9.ie_version < 15 || y9.ios && y9.webkit_version < 604;
function _o4(s212) {
  let t8 = s212.dom.parentNode;
  if (!t8) return;
  let e7 = t8.appendChild(document.createElement("textarea"));
  e7.style.cssText = "position: fixed; left: -10000px; top: 10px", e7.focus(), setTimeout(() => {
    s212.focus(), e7.remove(), An4(s212, e7.value);
  }, 50);
}
function Fe8(s212, t8, e7) {
  for (let i12 of s212.facet(t8)) e7 = i12(e7, s212);
  return e7;
}
function An4(s212, t8) {
  t8 = Fe8(s212.state, zi4, t8);
  let { state: e7 } = s212, i12, n14 = 1, o = e7.toText(t8), r2 = o.lines == e7.selection.ranges.length;
  if (fi4 != null && e7.selection.ranges.every((h3) => h3.empty) && fi4 == o.toString()) {
    let h3 = -1;
    i12 = e7.changeByRange((c3) => {
      let a2 = e7.doc.lineAt(c3.from);
      if (a2.from == h3) return { range: c3 };
      h3 = a2.from;
      let f6 = e7.toText((r2 ? o.line(n14++).text : t8) + e7.lineBreak);
      return { changes: { from: a2.from, insert: f6 }, range: x.cursor(c3.from + f6.length) };
    });
  } else r2 ? i12 = e7.changeByRange((h3) => {
    let c3 = o.line(n14++);
    return { changes: { from: h3.from, to: h3.to, insert: c3.text }, range: x.cursor(h3.from + c3.length) };
  }) : i12 = e7.replaceSelection(o);
  s212.dispatch(i12, { userEvent: "input.paste", scrollIntoView: true });
}
K7.scroll = (s212) => {
  s212.inputState.lastScrollTop = s212.scrollDOM.scrollTop, s212.inputState.lastScrollLeft = s212.scrollDOM.scrollLeft;
};
Y10.keydown = (s212, t8) => (s212.inputState.setSelectionOrigin("select"), t8.keyCode == 27 && s212.inputState.tabFocusMode != 0 && (s212.inputState.tabFocusMode = Date.now() + 2e3), false);
K7.touchstart = (s212, t8) => {
  s212.inputState.lastTouchTime = Date.now(), s212.inputState.setSelectionOrigin("select.pointer");
};
K7.touchmove = (s212) => {
  s212.inputState.setSelectionOrigin("select.pointer");
};
Y10.mousedown = (s212, t8) => {
  if (s212.observer.flush(), s212.inputState.lastTouchTime > Date.now() - 2e3) return false;
  let e7 = null;
  for (let i12 of s212.state.facet(ln5)) if (e7 = i12(s212, t8), e7) break;
  if (!e7 && t8.button == 0 && (e7 = $o4(s212, t8)), e7) {
    let i12 = !s212.hasFocus;
    s212.inputState.startMouseSelection(new ci4(s212, t8, e7, i12)), i12 && s212.observer.ignore(() => {
      Fs4(s212.contentDOM);
      let o = s212.root.activeElement;
      o && !o.contains(s212.contentDOM) && o.blur();
    });
    let n14 = s212.inputState.mouseSelection;
    if (n14) return n14.start(t8), n14.dragging === false;
  }
  return false;
};
function os4(s212, t8, e7, i12) {
  if (i12 == 1) return x.cursor(t8, e7);
  if (i12 == 2) return Ao4(s212.state, t8, e7);
  {
    let n14 = P10.find(s212.docView, t8), o = s212.state.doc.lineAt(n14 ? n14.posAtEnd : t8), r2 = n14 ? n14.posAtStart : o.from, l11 = n14 ? n14.posAtEnd : o.to;
    return l11 < s212.state.doc.length && l11 == o.to && l11++, x.range(r2, l11);
  }
}
var rs4 = (s212, t8, e7) => t8 >= e7.top && t8 <= e7.bottom && s212 >= e7.left && s212 <= e7.right;
function Xo4(s212, t8, e7, i12) {
  let n14 = P10.find(s212.docView, t8);
  if (!n14) return 1;
  let o = t8 - n14.posAtStart;
  if (o == 0) return 1;
  if (o == n14.length) return -1;
  let r2 = n14.coordsAt(o, -1);
  if (r2 && rs4(e7, i12, r2)) return -1;
  let l11 = n14.coordsAt(o, 1);
  return l11 && rs4(e7, i12, l11) ? 1 : r2 && r2.bottom >= i12 ? -1 : 1;
}
function ls4(s212, t8) {
  let e7 = s212.posAtCoords({ x: t8.clientX, y: t8.clientY }, false);
  return { pos: e7, bias: Xo4(s212, e7, t8.clientX, t8.clientY) };
}
var Go4 = y9.ie && y9.ie_version <= 11;
var hs4 = null;
var as4 = 0;
var cs4 = 0;
function Dn4(s212) {
  if (!Go4) return s212.detail;
  let t8 = hs4, e7 = cs4;
  return hs4 = s212, cs4 = Date.now(), as4 = !t8 || e7 > Date.now() - 400 && Math.abs(t8.clientX - s212.clientX) < 2 && Math.abs(t8.clientY - s212.clientY) < 2 ? (as4 + 1) % 3 : 1;
}
function $o4(s212, t8) {
  let e7 = ls4(s212, t8), i12 = Dn4(t8), n14 = s212.state.selection;
  return { update(o) {
    o.docChanged && (e7.pos = o.changes.mapPos(e7.pos), n14 = n14.map(o.changes));
  }, get(o, r2, l11) {
    let h3 = ls4(s212, o), c3, a2 = os4(s212, h3.pos, h3.bias, i12);
    if (e7.pos != h3.pos && !r2) {
      let f6 = os4(s212, e7.pos, e7.bias, i12), d4 = Math.min(f6.from, a2.from), u3 = Math.max(f6.to, a2.to);
      a2 = d4 < a2.from ? x.range(d4, u3) : x.range(u3, d4);
    }
    return r2 ? n14.replaceRange(n14.main.extend(a2.from, a2.to)) : l11 && i12 == 1 && n14.ranges.length > 1 && (c3 = Uo4(n14, h3.pos)) ? c3 : l11 ? n14.addRange(a2) : x.create([a2]);
  } };
}
function Uo4(s212, t8) {
  for (let e7 = 0; e7 < s212.ranges.length; e7++) {
    let { from: i12, to: n14 } = s212.ranges[e7];
    if (i12 <= t8 && n14 >= t8) return x.create(s212.ranges.slice(0, e7).concat(s212.ranges.slice(e7 + 1)), s212.mainIndex == e7 ? 0 : s212.mainIndex - (s212.mainIndex > e7 ? 1 : 0));
  }
  return null;
}
Y10.dragstart = (s212, t8) => {
  let { selection: { main: e7 } } = s212.state;
  if (t8.target.draggable) {
    let n14 = s212.docView.nearest(t8.target);
    if (n14 && n14.isWidget) {
      let o = n14.posAtStart, r2 = o + n14.length;
      (o >= e7.to || r2 <= e7.from) && (e7 = x.range(o, r2));
    }
  }
  let { inputState: i12 } = s212;
  return i12.mouseSelection && (i12.mouseSelection.dragging = true), i12.draggedContent = e7, t8.dataTransfer && (t8.dataTransfer.setData("Text", Fe8(s212.state, Ii4, s212.state.sliceDoc(e7.from, e7.to))), t8.dataTransfer.effectAllowed = "copyMove"), false;
};
Y10.dragend = (s212) => (s212.inputState.draggedContent = null, false);
function fs4(s212, t8, e7, i12) {
  if (e7 = Fe8(s212.state, zi4, e7), !e7) return;
  let n14 = s212.posAtCoords({ x: t8.clientX, y: t8.clientY }, false), { draggedContent: o } = s212.inputState, r2 = i12 && o && qo4(s212, t8) ? { from: o.from, to: o.to } : null, l11 = { from: n14, insert: e7 }, h3 = s212.state.changes(r2 ? [r2, l11] : l11);
  s212.focus(), s212.dispatch({ changes: h3, selection: { anchor: h3.mapPos(n14, -1), head: h3.mapPos(n14, 1) }, userEvent: r2 ? "move.drop" : "input.drop" }), s212.inputState.draggedContent = null;
}
Y10.drop = (s212, t8) => {
  if (!t8.dataTransfer) return false;
  if (s212.state.readOnly) return true;
  let e7 = t8.dataTransfer.files;
  if (e7 && e7.length) {
    let i12 = Array(e7.length), n14 = 0, o = () => {
      ++n14 == e7.length && fs4(s212, t8, i12.filter((r2) => r2 != null).join(s212.state.lineBreak), false);
    };
    for (let r2 = 0; r2 < e7.length; r2++) {
      let l11 = new FileReader();
      l11.onerror = o, l11.onload = () => {
        /[\x00-\x08\x0e-\x1f]{2}/.test(l11.result) || (i12[r2] = l11.result), o();
      }, l11.readAsText(e7[r2]);
    }
    return true;
  } else {
    let i12 = t8.dataTransfer.getData("Text");
    if (i12) return fs4(s212, t8, i12, true), true;
  }
  return false;
};
Y10.paste = (s212, t8) => {
  if (s212.state.readOnly) return true;
  s212.observer.flush();
  let e7 = kn5 ? null : t8.clipboardData;
  return e7 ? (An4(s212, e7.getData("text/plain") || e7.getData("text/uri-list")), true) : (_o4(s212), false);
};
function Qo4(s212, t8) {
  let e7 = s212.dom.parentNode;
  if (!e7) return;
  let i12 = e7.appendChild(document.createElement("textarea"));
  i12.style.cssText = "position: fixed; left: -10000px; top: 10px", i12.value = t8, i12.focus(), i12.selectionEnd = t8.length, i12.selectionStart = 0, setTimeout(() => {
    i12.remove(), s212.focus();
  }, 50);
}
function Jo4(s212) {
  let t8 = [], e7 = [], i12 = false;
  for (let n14 of s212.selection.ranges) n14.empty || (t8.push(s212.sliceDoc(n14.from, n14.to)), e7.push(n14));
  if (!t8.length) {
    let n14 = -1;
    for (let { from: o } of s212.selection.ranges) {
      let r2 = s212.doc.lineAt(o);
      r2.number > n14 && (t8.push(r2.text), e7.push({ from: r2.from, to: Math.min(s212.doc.length, r2.to + 1) })), n14 = r2.number;
    }
    i12 = true;
  }
  return { text: Fe8(s212, Ii4, t8.join(s212.lineBreak)), ranges: e7, linewise: i12 };
}
var fi4 = null;
Y10.copy = Y10.cut = (s212, t8) => {
  let { text: e7, ranges: i12, linewise: n14 } = Jo4(s212.state);
  if (!e7 && !n14) return false;
  fi4 = n14 ? e7 : null, t8.type == "cut" && !s212.state.readOnly && s212.dispatch({ changes: i12, scrollIntoView: true, userEvent: "delete.cut" });
  let o = kn5 ? null : t8.clipboardData;
  return o ? (o.clearData(), o.setData("text/plain", e7), true) : (Qo4(s212, e7), false);
};
var On4 = J.define();
function Tn4(s212, t8) {
  let e7 = [];
  for (let i12 of s212.facet(cn5)) {
    let n14 = i12(s212, t8);
    n14 && e7.push(n14);
  }
  return e7 ? s212.update({ effects: e7, annotations: On4.of(true) }) : null;
}
function Rn4(s212) {
  setTimeout(() => {
    let t8 = s212.hasFocus;
    if (t8 != s212.inputState.notifiedFocused) {
      let e7 = Tn4(s212.state, t8);
      e7 ? s212.dispatch(e7) : s212.update([]);
    }
  }, 10);
}
K7.focus = (s212) => {
  s212.inputState.lastFocusTime = Date.now(), !s212.scrollDOM.scrollTop && (s212.inputState.lastScrollTop || s212.inputState.lastScrollLeft) && (s212.scrollDOM.scrollTop = s212.inputState.lastScrollTop, s212.scrollDOM.scrollLeft = s212.inputState.lastScrollLeft), Rn4(s212);
};
K7.blur = (s212) => {
  s212.observer.clearSelectionRange(), Rn4(s212);
};
K7.compositionstart = K7.compositionupdate = (s212) => {
  s212.observer.editContext || (s212.inputState.compositionFirstChange == null && (s212.inputState.compositionFirstChange = true), s212.inputState.composing < 0 && (s212.inputState.composing = 0));
};
K7.compositionend = (s212) => {
  s212.observer.editContext || (s212.inputState.composing = -1, s212.inputState.compositionEndedAt = Date.now(), s212.inputState.compositionPendingKey = true, s212.inputState.compositionPendingChange = s212.observer.pendingRecords().length > 0, s212.inputState.compositionFirstChange = null, y9.chrome && y9.android ? s212.observer.flushSoon() : s212.inputState.compositionPendingChange ? Promise.resolve().then(() => s212.observer.flush()) : setTimeout(() => {
    s212.inputState.composing < 0 && s212.docView.hasComposition && s212.update([]);
  }, 50));
};
K7.contextmenu = (s212) => {
  s212.inputState.lastContextMenu = Date.now();
};
Y10.beforeinput = (s212, t8) => {
  var e7, i12;
  if (t8.inputType == "insertReplacementText" && s212.observer.editContext) {
    let o = (e7 = t8.dataTransfer) === null || e7 === void 0 ? void 0 : e7.getData("text/plain"), r2 = t8.getTargetRanges();
    if (o && r2.length) {
      let l11 = r2[0], h3 = s212.posAtDOM(l11.startContainer, l11.startOffset), c3 = s212.posAtDOM(l11.endContainer, l11.endOffset);
      return qi4(s212, { from: h3, to: c3, insert: s212.state.toText(o) }, null), true;
    }
  }
  let n14;
  if (y9.chrome && y9.android && (n14 = Cn5.find((o) => o.inputType == t8.inputType)) && (s212.observer.delayAndroidKey(n14.key, n14.keyCode), n14.key == "Backspace" || n14.key == "Delete")) {
    let o = ((i12 = window.visualViewport) === null || i12 === void 0 ? void 0 : i12.height) || 0;
    setTimeout(() => {
      var r2;
      (((r2 = window.visualViewport) === null || r2 === void 0 ? void 0 : r2.height) || 0) > o + 10 && s212.hasFocus && (s212.contentDOM.blur(), s212.focus());
    }, 100);
  }
  return y9.ios && t8.inputType == "deleteContentForward" && s212.observer.flushSoon(), y9.safari && t8.inputType == "insertText" && s212.inputState.composing >= 0 && setTimeout(() => K7.compositionend(s212, t8), 20), false;
};
var ds4 = /* @__PURE__ */ new Set();
function Zo4(s212) {
  ds4.has(s212) || (ds4.add(s212), s212.addEventListener("copy", () => {
  }), s212.addEventListener("cut", () => {
  }));
}
var us4 = ["pre-wrap", "normal", "pre-line", "break-spaces"];
var mt6 = false;
function di4() {
  mt6 = false;
}
var Ae6 = class {
  constructor(t8) {
    this.lineWrapping = t8, this.doc = m.empty, this.heightSamples = {}, this.lineHeight = 14, this.charWidth = 7, this.textHeight = 14, this.lineLength = 30;
  }
  heightForGap(t8, e7) {
    let i12 = this.doc.lineAt(e7).number - this.doc.lineAt(t8).number + 1;
    return this.lineWrapping && (i12 += Math.max(0, Math.ceil((e7 - t8 - i12 * this.lineLength * 0.5) / this.lineLength))), this.lineHeight * i12;
  }
  heightForLine(t8) {
    return this.lineWrapping ? (1 + Math.max(0, Math.ceil((t8 - this.lineLength) / (this.lineLength - 5)))) * this.lineHeight : this.lineHeight;
  }
  setDoc(t8) {
    return this.doc = t8, this;
  }
  mustRefreshForWrapping(t8) {
    return us4.indexOf(t8) > -1 != this.lineWrapping;
  }
  mustRefreshForHeights(t8) {
    let e7 = false;
    for (let i12 = 0; i12 < t8.length; i12++) {
      let n14 = t8[i12];
      n14 < 0 ? i12++ : this.heightSamples[Math.floor(n14 * 10)] || (e7 = true, this.heightSamples[Math.floor(n14 * 10)] = true);
    }
    return e7;
  }
  refresh(t8, e7, i12, n14, o, r2) {
    let l11 = us4.indexOf(t8) > -1, h3 = Math.round(e7) != Math.round(this.lineHeight) || this.lineWrapping != l11;
    if (this.lineWrapping = l11, this.lineHeight = e7, this.charWidth = i12, this.textHeight = n14, this.lineLength = o, h3) {
      this.heightSamples = {};
      for (let c3 = 0; c3 < r2.length; c3++) {
        let a2 = r2[c3];
        a2 < 0 ? c3++ : this.heightSamples[Math.floor(a2 * 10)] = true;
      }
    }
    return h3;
  }
};
var De7 = class {
  constructor(t8, e7) {
    this.from = t8, this.heights = e7, this.index = 0;
  }
  get more() {
    return this.index < this.heights.length;
  }
};
var X8 = class s131 {
  constructor(t8, e7, i12, n14, o) {
    this.from = t8, this.length = e7, this.top = i12, this.height = n14, this._content = o;
  }
  get type() {
    return typeof this._content == "number" ? F10.Text : Array.isArray(this._content) ? this._content : this._content.type;
  }
  get to() {
    return this.from + this.length;
  }
  get bottom() {
    return this.top + this.height;
  }
  get widget() {
    return this._content instanceof ht6 ? this._content.widget : null;
  }
  get widgetLineBreaks() {
    return typeof this._content == "number" ? this._content : 0;
  }
  join(t8) {
    let e7 = (Array.isArray(this._content) ? this._content : [this]).concat(Array.isArray(t8._content) ? t8._content : [t8]);
    return new s131(this.from, this.length + t8.length, this.top, this.height + t8.height, e7);
  }
};
var T9 = function(s212) {
  return s212[s212.ByPos = 0] = "ByPos", s212[s212.ByHeight = 1] = "ByHeight", s212[s212.ByPosNoHeight = 2] = "ByPosNoHeight", s212;
}(T9 || (T9 = {}));
var ge9 = 1e-3;
var z9 = class s132 {
  constructor(t8, e7, i12 = 2) {
    this.length = t8, this.height = e7, this.flags = i12;
  }
  get outdated() {
    return (this.flags & 2) > 0;
  }
  set outdated(t8) {
    this.flags = (t8 ? 2 : 0) | this.flags & -3;
  }
  setHeight(t8) {
    this.height != t8 && (Math.abs(this.height - t8) > ge9 && (mt6 = true), this.height = t8);
  }
  replace(t8, e7, i12) {
    return s132.of(i12);
  }
  decomposeLeft(t8, e7) {
    e7.push(this);
  }
  decomposeRight(t8, e7) {
    e7.push(this);
  }
  applyChanges(t8, e7, i12, n14) {
    let o = this, r2 = i12.doc;
    for (let l11 = n14.length - 1; l11 >= 0; l11--) {
      let { fromA: h3, toA: c3, fromB: a2, toB: f6 } = n14[l11], d4 = o.lineAt(h3, T9.ByPosNoHeight, i12.setDoc(e7), 0, 0), u3 = d4.to >= c3 ? d4 : o.lineAt(c3, T9.ByPosNoHeight, i12, 0, 0);
      for (f6 += u3.to - c3, c3 = u3.to; l11 > 0 && d4.from <= n14[l11 - 1].toA; ) h3 = n14[l11 - 1].fromA, a2 = n14[l11 - 1].fromB, l11--, h3 < d4.from && (d4 = o.lineAt(h3, T9.ByPosNoHeight, i12, 0, 0));
      a2 += d4.from - h3, h3 = d4.from;
      let p3 = pi4.build(i12.setDoc(r2), t8, a2, f6);
      o = Oe5(o, o.replace(h3, c3, p3));
    }
    return o.updateHeight(i12, 0);
  }
  static empty() {
    return new I9(0, 0);
  }
  static of(t8) {
    if (t8.length == 1) return t8[0];
    let e7 = 0, i12 = t8.length, n14 = 0, o = 0;
    for (; ; ) if (e7 == i12) if (n14 > o * 2) {
      let l11 = t8[e7 - 1];
      l11.break ? t8.splice(--e7, 1, l11.left, null, l11.right) : t8.splice(--e7, 1, l11.left, l11.right), i12 += 1 + l11.break, n14 -= l11.size;
    } else if (o > n14 * 2) {
      let l11 = t8[i12];
      l11.break ? t8.splice(i12, 1, l11.left, null, l11.right) : t8.splice(i12, 1, l11.left, l11.right), i12 += 2 + l11.break, o -= l11.size;
    } else break;
    else if (n14 < o) {
      let l11 = t8[e7++];
      l11 && (n14 += l11.size);
    } else {
      let l11 = t8[--i12];
      l11 && (o += l11.size);
    }
    let r2 = 0;
    return t8[e7 - 1] == null ? (r2 = 1, e7--) : t8[e7] == null && (r2 = 1, i12++), new ui4(s132.of(t8.slice(0, e7)), r2, s132.of(t8.slice(i12)));
  }
};
function Oe5(s212, t8) {
  return s212 == t8 ? s212 : (s212.constructor != t8.constructor && (mt6 = true), t8);
}
z9.prototype.size = 1;
var Te6 = class extends z9 {
  constructor(t8, e7, i12) {
    super(t8, e7), this.deco = i12;
  }
  blockAt(t8, e7, i12, n14) {
    return new X8(n14, this.length, i12, this.height, this.deco || 0);
  }
  lineAt(t8, e7, i12, n14, o) {
    return this.blockAt(0, i12, n14, o);
  }
  forEachLine(t8, e7, i12, n14, o, r2) {
    t8 <= o + this.length && e7 >= o && r2(this.blockAt(0, i12, n14, o));
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    return n14 && n14.from <= e7 && n14.more && this.setHeight(n14.heights[n14.index++]), this.outdated = false, this;
  }
  toString() {
    return `block(${this.length})`;
  }
};
var I9 = class s133 extends Te6 {
  constructor(t8, e7) {
    super(t8, e7, null), this.collapsed = 0, this.widgetHeight = 0, this.breaks = 0;
  }
  blockAt(t8, e7, i12, n14) {
    return new X8(n14, this.length, i12, this.height, this.breaks);
  }
  replace(t8, e7, i12) {
    let n14 = i12[0];
    return i12.length == 1 && (n14 instanceof s133 || n14 instanceof ot6 && n14.flags & 4) && Math.abs(this.length - n14.length) < 10 ? (n14 instanceof ot6 ? n14 = new s133(n14.length, this.height) : n14.height = this.height, this.outdated || (n14.outdated = false), n14) : z9.of(i12);
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    return n14 && n14.from <= e7 && n14.more ? this.setHeight(n14.heights[n14.index++]) : (i12 || this.outdated) && this.setHeight(Math.max(this.widgetHeight, t8.heightForLine(this.length - this.collapsed)) + this.breaks * t8.lineHeight), this.outdated = false, this;
  }
  toString() {
    return `line(${this.length}${this.collapsed ? -this.collapsed : ""}${this.widgetHeight ? ":" + this.widgetHeight : ""})`;
  }
};
var ot6 = class s134 extends z9 {
  constructor(t8) {
    super(t8, 0);
  }
  heightMetrics(t8, e7) {
    let i12 = t8.doc.lineAt(e7).number, n14 = t8.doc.lineAt(e7 + this.length).number, o = n14 - i12 + 1, r2, l11 = 0;
    if (t8.lineWrapping) {
      let h3 = Math.min(this.height, t8.lineHeight * o);
      r2 = h3 / o, this.length > o + 1 && (l11 = (this.height - h3) / (this.length - o - 1));
    } else r2 = this.height / o;
    return { firstLine: i12, lastLine: n14, perLine: r2, perChar: l11 };
  }
  blockAt(t8, e7, i12, n14) {
    let { firstLine: o, lastLine: r2, perLine: l11, perChar: h3 } = this.heightMetrics(e7, n14);
    if (e7.lineWrapping) {
      let c3 = n14 + (t8 < e7.lineHeight ? 0 : Math.round(Math.max(0, Math.min(1, (t8 - i12) / this.height)) * this.length)), a2 = e7.doc.lineAt(c3), f6 = l11 + a2.length * h3, d4 = Math.max(i12, t8 - f6 / 2);
      return new X8(a2.from, a2.length, d4, f6, 0);
    } else {
      let c3 = Math.max(0, Math.min(r2 - o, Math.floor((t8 - i12) / l11))), { from: a2, length: f6 } = e7.doc.line(o + c3);
      return new X8(a2, f6, i12 + l11 * c3, l11, 0);
    }
  }
  lineAt(t8, e7, i12, n14, o) {
    if (e7 == T9.ByHeight) return this.blockAt(t8, i12, n14, o);
    if (e7 == T9.ByPosNoHeight) {
      let { from: u3, to: p3 } = i12.doc.lineAt(t8);
      return new X8(u3, p3 - u3, 0, 0, 0);
    }
    let { firstLine: r2, perLine: l11, perChar: h3 } = this.heightMetrics(i12, o), c3 = i12.doc.lineAt(t8), a2 = l11 + c3.length * h3, f6 = c3.number - r2, d4 = n14 + l11 * f6 + h3 * (c3.from - o - f6);
    return new X8(c3.from, c3.length, Math.max(n14, Math.min(d4, n14 + this.height - a2)), a2, 0);
  }
  forEachLine(t8, e7, i12, n14, o, r2) {
    t8 = Math.max(t8, o), e7 = Math.min(e7, o + this.length);
    let { firstLine: l11, perLine: h3, perChar: c3 } = this.heightMetrics(i12, o);
    for (let a2 = t8, f6 = n14; a2 <= e7; ) {
      let d4 = i12.doc.lineAt(a2);
      if (a2 == t8) {
        let p3 = d4.number - l11;
        f6 += h3 * p3 + c3 * (t8 - o - p3);
      }
      let u3 = h3 + c3 * d4.length;
      r2(new X8(d4.from, d4.length, f6, u3, 0)), f6 += u3, a2 = d4.to + 1;
    }
  }
  replace(t8, e7, i12) {
    let n14 = this.length - e7;
    if (n14 > 0) {
      let o = i12[i12.length - 1];
      o instanceof s134 ? i12[i12.length - 1] = new s134(o.length + n14) : i12.push(null, new s134(n14 - 1));
    }
    if (t8 > 0) {
      let o = i12[0];
      o instanceof s134 ? i12[0] = new s134(t8 + o.length) : i12.unshift(new s134(t8 - 1), null);
    }
    return z9.of(i12);
  }
  decomposeLeft(t8, e7) {
    e7.push(new s134(t8 - 1), null);
  }
  decomposeRight(t8, e7) {
    e7.push(null, new s134(this.length - t8 - 1));
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    let o = e7 + this.length;
    if (n14 && n14.from <= e7 + this.length && n14.more) {
      let r2 = [], l11 = Math.max(e7, n14.from), h3 = -1;
      for (n14.from > e7 && r2.push(new s134(n14.from - e7 - 1).updateHeight(t8, e7)); l11 <= o && n14.more; ) {
        let a2 = t8.doc.lineAt(l11).length;
        r2.length && r2.push(null);
        let f6 = n14.heights[n14.index++];
        h3 == -1 ? h3 = f6 : Math.abs(f6 - h3) >= ge9 && (h3 = -2);
        let d4 = new I9(a2, f6);
        d4.outdated = false, r2.push(d4), l11 += a2 + 1;
      }
      l11 <= o && r2.push(null, new s134(o - l11).updateHeight(t8, l11));
      let c3 = z9.of(r2);
      return (h3 < 0 || Math.abs(c3.height - this.height) >= ge9 || Math.abs(h3 - this.heightMetrics(t8, e7).perLine) >= ge9) && (mt6 = true), Oe5(this, c3);
    } else (i12 || this.outdated) && (this.setHeight(t8.heightForGap(e7, e7 + this.length)), this.outdated = false);
    return this;
  }
  toString() {
    return `gap(${this.length})`;
  }
};
var ui4 = class extends z9 {
  constructor(t8, e7, i12) {
    super(t8.length + e7 + i12.length, t8.height + i12.height, e7 | (t8.outdated || i12.outdated ? 2 : 0)), this.left = t8, this.right = i12, this.size = t8.size + i12.size;
  }
  get break() {
    return this.flags & 1;
  }
  blockAt(t8, e7, i12, n14) {
    let o = i12 + this.left.height;
    return t8 < o ? this.left.blockAt(t8, e7, i12, n14) : this.right.blockAt(t8, e7, o, n14 + this.left.length + this.break);
  }
  lineAt(t8, e7, i12, n14, o) {
    let r2 = n14 + this.left.height, l11 = o + this.left.length + this.break, h3 = e7 == T9.ByHeight ? t8 < r2 : t8 < l11, c3 = h3 ? this.left.lineAt(t8, e7, i12, n14, o) : this.right.lineAt(t8, e7, i12, r2, l11);
    if (this.break || (h3 ? c3.to < l11 : c3.from > l11)) return c3;
    let a2 = e7 == T9.ByPosNoHeight ? T9.ByPosNoHeight : T9.ByPos;
    return h3 ? c3.join(this.right.lineAt(l11, a2, i12, r2, l11)) : this.left.lineAt(l11, a2, i12, n14, o).join(c3);
  }
  forEachLine(t8, e7, i12, n14, o, r2) {
    let l11 = n14 + this.left.height, h3 = o + this.left.length + this.break;
    if (this.break) t8 < h3 && this.left.forEachLine(t8, e7, i12, n14, o, r2), e7 >= h3 && this.right.forEachLine(t8, e7, i12, l11, h3, r2);
    else {
      let c3 = this.lineAt(h3, T9.ByPos, i12, n14, o);
      t8 < c3.from && this.left.forEachLine(t8, c3.from - 1, i12, n14, o, r2), c3.to >= t8 && c3.from <= e7 && r2(c3), e7 > c3.to && this.right.forEachLine(c3.to + 1, e7, i12, l11, h3, r2);
    }
  }
  replace(t8, e7, i12) {
    let n14 = this.left.length + this.break;
    if (e7 < n14) return this.balanced(this.left.replace(t8, e7, i12), this.right);
    if (t8 > this.left.length) return this.balanced(this.left, this.right.replace(t8 - n14, e7 - n14, i12));
    let o = [];
    t8 > 0 && this.decomposeLeft(t8, o);
    let r2 = o.length;
    for (let l11 of i12) o.push(l11);
    if (t8 > 0 && ps4(o, r2 - 1), e7 < this.length) {
      let l11 = o.length;
      this.decomposeRight(e7, o), ps4(o, l11);
    }
    return z9.of(o);
  }
  decomposeLeft(t8, e7) {
    let i12 = this.left.length;
    if (t8 <= i12) return this.left.decomposeLeft(t8, e7);
    e7.push(this.left), this.break && (i12++, t8 >= i12 && e7.push(null)), t8 > i12 && this.right.decomposeLeft(t8 - i12, e7);
  }
  decomposeRight(t8, e7) {
    let i12 = this.left.length, n14 = i12 + this.break;
    if (t8 >= n14) return this.right.decomposeRight(t8 - n14, e7);
    t8 < i12 && this.left.decomposeRight(t8, e7), this.break && t8 < n14 && e7.push(null), e7.push(this.right);
  }
  balanced(t8, e7) {
    return t8.size > 2 * e7.size || e7.size > 2 * t8.size ? z9.of(this.break ? [t8, null, e7] : [t8, e7]) : (this.left = Oe5(this.left, t8), this.right = Oe5(this.right, e7), this.setHeight(t8.height + e7.height), this.outdated = t8.outdated || e7.outdated, this.size = t8.size + e7.size, this.length = t8.length + this.break + e7.length, this);
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    let { left: o, right: r2 } = this, l11 = e7 + o.length + this.break, h3 = null;
    return n14 && n14.from <= e7 + o.length && n14.more ? h3 = o = o.updateHeight(t8, e7, i12, n14) : o.updateHeight(t8, e7, i12), n14 && n14.from <= l11 + r2.length && n14.more ? h3 = r2 = r2.updateHeight(t8, l11, i12, n14) : r2.updateHeight(t8, l11, i12), h3 ? this.balanced(o, r2) : (this.height = this.left.height + this.right.height, this.outdated = false, this);
  }
  toString() {
    return this.left + (this.break ? " " : "-") + this.right;
  }
};
function ps4(s212, t8) {
  let e7, i12;
  s212[t8] == null && (e7 = s212[t8 - 1]) instanceof ot6 && (i12 = s212[t8 + 1]) instanceof ot6 && s212.splice(t8 - 1, 3, new ot6(e7.length + 1 + i12.length));
}
var tr4 = 5;
var pi4 = class s135 {
  constructor(t8, e7) {
    this.pos = t8, this.oracle = e7, this.nodes = [], this.lineStart = -1, this.lineEnd = -1, this.covering = null, this.writtenTo = t8;
  }
  get isCovered() {
    return this.covering && this.nodes[this.nodes.length - 1] == this.covering;
  }
  span(t8, e7) {
    if (this.lineStart > -1) {
      let i12 = Math.min(e7, this.lineEnd), n14 = this.nodes[this.nodes.length - 1];
      n14 instanceof I9 ? n14.length += i12 - this.pos : (i12 > this.pos || !this.isCovered) && this.nodes.push(new I9(i12 - this.pos, -1)), this.writtenTo = i12, e7 > i12 && (this.nodes.push(null), this.writtenTo++, this.lineStart = -1);
    }
    this.pos = e7;
  }
  point(t8, e7, i12) {
    if (t8 < e7 || i12.heightRelevant) {
      let n14 = i12.widget ? i12.widget.estimatedHeight : 0, o = i12.widget ? i12.widget.lineBreaks : 0;
      n14 < 0 && (n14 = this.oracle.lineHeight);
      let r2 = e7 - t8;
      i12.block ? this.addBlock(new Te6(r2, n14, i12)) : (r2 || o || n14 >= tr4) && this.addLineDeco(n14, o, r2);
    } else e7 > t8 && this.span(t8, e7);
    this.lineEnd > -1 && this.lineEnd < this.pos && (this.lineEnd = this.oracle.doc.lineAt(this.pos).to);
  }
  enterLine() {
    if (this.lineStart > -1) return;
    let { from: t8, to: e7 } = this.oracle.doc.lineAt(this.pos);
    this.lineStart = t8, this.lineEnd = e7, this.writtenTo < t8 && ((this.writtenTo < t8 - 1 || this.nodes[this.nodes.length - 1] == null) && this.nodes.push(this.blankContent(this.writtenTo, t8 - 1)), this.nodes.push(null)), this.pos > t8 && this.nodes.push(new I9(this.pos - t8, -1)), this.writtenTo = this.pos;
  }
  blankContent(t8, e7) {
    let i12 = new ot6(e7 - t8);
    return this.oracle.doc.lineAt(t8).to == e7 && (i12.flags |= 4), i12;
  }
  ensureLine() {
    this.enterLine();
    let t8 = this.nodes.length ? this.nodes[this.nodes.length - 1] : null;
    if (t8 instanceof I9) return t8;
    let e7 = new I9(0, -1);
    return this.nodes.push(e7), e7;
  }
  addBlock(t8) {
    this.enterLine();
    let e7 = t8.deco;
    e7 && e7.startSide > 0 && !this.isCovered && this.ensureLine(), this.nodes.push(t8), this.writtenTo = this.pos = this.pos + t8.length, e7 && e7.endSide > 0 && (this.covering = t8);
  }
  addLineDeco(t8, e7, i12) {
    let n14 = this.ensureLine();
    n14.length += i12, n14.collapsed += i12, n14.widgetHeight = Math.max(n14.widgetHeight, t8), n14.breaks += e7, this.writtenTo = this.pos = this.pos + i12;
  }
  finish(t8) {
    let e7 = this.nodes.length == 0 ? null : this.nodes[this.nodes.length - 1];
    this.lineStart > -1 && !(e7 instanceof I9) && !this.isCovered ? this.nodes.push(new I9(0, -1)) : (this.writtenTo < this.pos || e7 == null) && this.nodes.push(this.blankContent(this.writtenTo, this.pos));
    let i12 = t8;
    for (let n14 of this.nodes) n14 instanceof I9 && n14.updateHeight(this.oracle, i12), i12 += n14 ? n14.length : 1;
    return this.nodes;
  }
  static build(t8, e7, i12, n14) {
    let o = new s135(i12, t8);
    return T.spans(e7, i12, n14, o, 0), o.finish(i12);
  }
};
function er4(s212, t8, e7) {
  let i12 = new gi4();
  return T.compare(s212, t8, e7, i12, 0), i12.changes;
}
var gi4 = class {
  constructor() {
    this.changes = [];
  }
  compareRange() {
  }
  comparePoint(t8, e7, i12, n14) {
    (t8 < e7 || i12 && i12.heightRelevant || n14 && n14.heightRelevant) && ti4(t8, e7, this.changes, 5);
  }
};
function ir4(s212, t8) {
  let e7 = s212.getBoundingClientRect(), i12 = s212.ownerDocument, n14 = i12.defaultView || window, o = Math.max(0, e7.left), r2 = Math.min(n14.innerWidth, e7.right), l11 = Math.max(0, e7.top), h3 = Math.min(n14.innerHeight, e7.bottom);
  for (let c3 = s212.parentNode; c3 && c3 != i12.body; ) if (c3.nodeType == 1) {
    let a2 = c3, f6 = window.getComputedStyle(a2);
    if ((a2.scrollHeight > a2.clientHeight || a2.scrollWidth > a2.clientWidth) && f6.overflow != "visible") {
      let d4 = a2.getBoundingClientRect();
      o = Math.max(o, d4.left), r2 = Math.min(r2, d4.right), l11 = Math.max(l11, d4.top), h3 = Math.min(c3 == s212.parentNode ? n14.innerHeight : h3, d4.bottom);
    }
    c3 = f6.position == "absolute" || f6.position == "fixed" ? a2.offsetParent : a2.parentNode;
  } else if (c3.nodeType == 11) c3 = c3.host;
  else break;
  return { left: o - e7.left, right: Math.max(o, r2) - e7.left, top: l11 - (e7.top + t8), bottom: Math.max(l11, h3) - (e7.top + t8) };
}
function sr4(s212, t8) {
  let e7 = s212.getBoundingClientRect();
  return { left: 0, right: e7.right - e7.left, top: t8, bottom: e7.bottom - (e7.top + t8) };
}
var It6 = class {
  constructor(t8, e7, i12, n14) {
    this.from = t8, this.to = e7, this.size = i12, this.displaySize = n14;
  }
  static same(t8, e7) {
    if (t8.length != e7.length) return false;
    for (let i12 = 0; i12 < t8.length; i12++) {
      let n14 = t8[i12], o = e7[i12];
      if (n14.from != o.from || n14.to != o.to || n14.size != o.size) return false;
    }
    return true;
  }
  draw(t8, e7) {
    return O9.replace({ widget: new mi4(this.displaySize * (e7 ? t8.scaleY : t8.scaleX), e7) }).range(this.from, this.to);
  }
};
var mi4 = class extends lt6 {
  constructor(t8, e7) {
    super(), this.size = t8, this.vertical = e7;
  }
  eq(t8) {
    return t8.size == this.size && t8.vertical == this.vertical;
  }
  toDOM() {
    let t8 = document.createElement("div");
    return this.vertical ? t8.style.height = this.size + "px" : (t8.style.width = this.size + "px", t8.style.height = "2px", t8.style.display = "inline-block"), t8;
  }
  get estimatedHeight() {
    return this.vertical ? this.size : -1;
  }
};
var Re7 = class {
  constructor(t8) {
    this.state = t8, this.pixelViewport = { left: 0, right: window.innerWidth, top: 0, bottom: 0 }, this.inView = true, this.paddingTop = 0, this.paddingBottom = 0, this.contentDOMWidth = 0, this.contentDOMHeight = 0, this.editorHeight = 0, this.editorWidth = 0, this.scrollTop = 0, this.scrolledToBottom = false, this.scaleX = 1, this.scaleY = 1, this.scrollAnchorPos = 0, this.scrollAnchorHeight = -1, this.scaler = gs4, this.scrollTarget = null, this.printing = false, this.mustMeasureContent = true, this.defaultTextDirection = L8.LTR, this.visibleRanges = [], this.mustEnforceCursorAssoc = false;
    let e7 = t8.facet(Ve8).some((i12) => typeof i12 != "function" && i12.class == "cm-lineWrapping");
    this.heightOracle = new Ae6(e7), this.stateDeco = t8.facet(Ut6).filter((i12) => typeof i12 != "function"), this.heightMap = z9.empty().applyChanges(this.stateDeco, m.empty, this.heightOracle.setDoc(t8.doc), [new j9(0, 0, 0, t8.doc.length)]);
    for (let i12 = 0; i12 < 2 && (this.viewport = this.getViewport(0, null), !!this.updateForViewport()); i12++) ;
    this.updateViewportLines(), this.lineGaps = this.ensureLineGaps([]), this.lineGapDeco = O9.set(this.lineGaps.map((i12) => i12.draw(this, false))), this.computeVisibleRanges();
  }
  updateForViewport() {
    let t8 = [this.viewport], { main: e7 } = this.state.selection;
    for (let i12 = 0; i12 <= 1; i12++) {
      let n14 = i12 ? e7.head : e7.anchor;
      if (!t8.some(({ from: o, to: r2 }) => n14 >= o && n14 <= r2)) {
        let { from: o, to: r2 } = this.lineBlockAt(n14);
        t8.push(new xt6(o, r2));
      }
    }
    return this.viewports = t8.sort((i12, n14) => i12.from - n14.from), this.updateScaler();
  }
  updateScaler() {
    let t8 = this.scaler;
    return this.scaler = this.heightMap.height <= 7e6 ? gs4 : new bi4(this.heightOracle, this.heightMap, this.viewports), t8.eq(this.scaler) ? 0 : 2;
  }
  updateViewportLines() {
    this.viewportLines = [], this.heightMap.forEachLine(this.viewport.from, this.viewport.to, this.heightOracle.setDoc(this.state.doc), 0, 0, (t8) => {
      this.viewportLines.push(Pt5(t8, this.scaler));
    });
  }
  update(t8, e7 = null) {
    this.state = t8.state;
    let i12 = this.stateDeco;
    this.stateDeco = this.state.facet(Ut6).filter((a2) => typeof a2 != "function");
    let n14 = t8.changedRanges, o = j9.extendWithRanges(n14, er4(i12, this.stateDeco, t8 ? t8.changes : A.empty(this.state.doc.length))), r2 = this.heightMap.height, l11 = this.scrolledToBottom ? null : this.scrollAnchorAt(this.scrollTop);
    di4(), this.heightMap = this.heightMap.applyChanges(this.stateDeco, t8.startState.doc, this.heightOracle.setDoc(this.state.doc), o), (this.heightMap.height != r2 || mt6) && (t8.flags |= 2), l11 ? (this.scrollAnchorPos = t8.changes.mapPos(l11.from, -1), this.scrollAnchorHeight = l11.top) : (this.scrollAnchorPos = -1, this.scrollAnchorHeight = this.heightMap.height);
    let h3 = o.length ? this.mapViewport(this.viewport, t8.changes) : this.viewport;
    (e7 && (e7.range.head < h3.from || e7.range.head > h3.to) || !this.viewportIsAppropriate(h3)) && (h3 = this.getViewport(0, e7));
    let c3 = h3.from != this.viewport.from || h3.to != this.viewport.to;
    this.viewport = h3, t8.flags |= this.updateForViewport(), (c3 || !t8.changes.empty || t8.flags & 2) && this.updateViewportLines(), (this.lineGaps.length || this.viewport.to - this.viewport.from > 4e3) && this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps, t8.changes))), t8.flags |= this.computeVisibleRanges(), e7 && (this.scrollTarget = e7), !this.mustEnforceCursorAssoc && t8.selectionSet && t8.view.lineWrapping && t8.state.selection.main.empty && t8.state.selection.main.assoc && !t8.state.facet(dn4) && (this.mustEnforceCursorAssoc = true);
  }
  measure(t8) {
    let e7 = t8.contentDOM, i12 = window.getComputedStyle(e7), n14 = this.heightOracle, o = i12.whiteSpace;
    this.defaultTextDirection = i12.direction == "rtl" ? L8.RTL : L8.LTR;
    let r2 = this.heightOracle.mustRefreshForWrapping(o), l11 = e7.getBoundingClientRect(), h3 = r2 || this.mustMeasureContent || this.contentDOMHeight != l11.height;
    this.contentDOMHeight = l11.height, this.mustMeasureContent = false;
    let c3 = 0, a2 = 0;
    if (l11.width && l11.height) {
      let { scaleX: x11, scaleY: S17 } = Vs2(e7, l11);
      (x11 > 5e-3 && Math.abs(this.scaleX - x11) > 5e-3 || S17 > 5e-3 && Math.abs(this.scaleY - S17) > 5e-3) && (this.scaleX = x11, this.scaleY = S17, c3 |= 8, r2 = h3 = true);
    }
    let f6 = (parseInt(i12.paddingTop) || 0) * this.scaleY, d4 = (parseInt(i12.paddingBottom) || 0) * this.scaleY;
    (this.paddingTop != f6 || this.paddingBottom != d4) && (this.paddingTop = f6, this.paddingBottom = d4, c3 |= 10), this.editorWidth != t8.scrollDOM.clientWidth && (n14.lineWrapping && (h3 = true), this.editorWidth = t8.scrollDOM.clientWidth, c3 |= 8);
    let u3 = t8.scrollDOM.scrollTop * this.scaleY;
    this.scrollTop != u3 && (this.scrollAnchorHeight = -1, this.scrollTop = u3), this.scrolledToBottom = zs4(t8.scrollDOM);
    let p3 = (this.printing ? sr4 : ir4)(e7, this.paddingTop), g8 = p3.top - this.pixelViewport.top, b12 = p3.bottom - this.pixelViewport.bottom;
    this.pixelViewport = p3;
    let m11 = this.pixelViewport.bottom > this.pixelViewport.top && this.pixelViewport.right > this.pixelViewport.left;
    if (m11 != this.inView && (this.inView = m11, m11 && (h3 = true)), !this.inView && !this.scrollTarget) return 0;
    let w14 = l11.width;
    if ((this.contentDOMWidth != w14 || this.editorHeight != t8.scrollDOM.clientHeight) && (this.contentDOMWidth = l11.width, this.editorHeight = t8.scrollDOM.clientHeight, c3 |= 8), h3) {
      let x11 = t8.docView.measureVisibleLineHeights(this.viewport);
      if (n14.mustRefreshForHeights(x11) && (r2 = true), r2 || n14.lineWrapping && Math.abs(w14 - this.contentDOMWidth) > n14.charWidth) {
        let { lineHeight: S17, charWidth: C11, textHeight: E11 } = t8.docView.measureTextSize();
        r2 = S17 > 0 && n14.refresh(o, S17, C11, E11, w14 / C11, x11), r2 && (t8.docView.minWidth = 0, c3 |= 8);
      }
      g8 > 0 && b12 > 0 ? a2 = Math.max(g8, b12) : g8 < 0 && b12 < 0 && (a2 = Math.min(g8, b12)), di4();
      for (let S17 of this.viewports) {
        let C11 = S17.from == this.viewport.from ? x11 : t8.docView.measureVisibleLineHeights(S17);
        this.heightMap = (r2 ? z9.empty().applyChanges(this.stateDeco, m.empty, this.heightOracle, [new j9(0, 0, 0, t8.state.doc.length)]) : this.heightMap).updateHeight(n14, 0, r2, new De7(S17.from, C11));
      }
      mt6 && (c3 |= 2);
    }
    let v10 = !this.viewportIsAppropriate(this.viewport, a2) || this.scrollTarget && (this.scrollTarget.range.head < this.viewport.from || this.scrollTarget.range.head > this.viewport.to);
    return v10 && (c3 & 2 && (c3 |= this.updateScaler()), this.viewport = this.getViewport(a2, this.scrollTarget), c3 |= this.updateForViewport()), (c3 & 2 || v10) && this.updateViewportLines(), (this.lineGaps.length || this.viewport.to - this.viewport.from > 4e3) && this.updateLineGaps(this.ensureLineGaps(r2 ? [] : this.lineGaps, t8)), c3 |= this.computeVisibleRanges(), this.mustEnforceCursorAssoc && (this.mustEnforceCursorAssoc = false, t8.docView.enforceCursorAssoc()), c3;
  }
  get visibleTop() {
    return this.scaler.fromDOM(this.pixelViewport.top);
  }
  get visibleBottom() {
    return this.scaler.fromDOM(this.pixelViewport.bottom);
  }
  getViewport(t8, e7) {
    let i12 = 0.5 - Math.max(-0.5, Math.min(0.5, t8 / 1e3 / 2)), n14 = this.heightMap, o = this.heightOracle, { visibleTop: r2, visibleBottom: l11 } = this, h3 = new xt6(n14.lineAt(r2 - i12 * 1e3, T9.ByHeight, o, 0, 0).from, n14.lineAt(l11 + (1 - i12) * 1e3, T9.ByHeight, o, 0, 0).to);
    if (e7) {
      let { head: c3 } = e7.range;
      if (c3 < h3.from || c3 > h3.to) {
        let a2 = Math.min(this.editorHeight, this.pixelViewport.bottom - this.pixelViewport.top), f6 = n14.lineAt(c3, T9.ByPos, o, 0, 0), d4;
        e7.y == "center" ? d4 = (f6.top + f6.bottom) / 2 - a2 / 2 : e7.y == "start" || e7.y == "nearest" && c3 < h3.from ? d4 = f6.top : d4 = f6.bottom - a2, h3 = new xt6(n14.lineAt(d4 - 1e3 / 2, T9.ByHeight, o, 0, 0).from, n14.lineAt(d4 + a2 + 1e3 / 2, T9.ByHeight, o, 0, 0).to);
      }
    }
    return h3;
  }
  mapViewport(t8, e7) {
    let i12 = e7.mapPos(t8.from, -1), n14 = e7.mapPos(t8.to, 1);
    return new xt6(this.heightMap.lineAt(i12, T9.ByPos, this.heightOracle, 0, 0).from, this.heightMap.lineAt(n14, T9.ByPos, this.heightOracle, 0, 0).to);
  }
  viewportIsAppropriate({ from: t8, to: e7 }, i12 = 0) {
    if (!this.inView) return true;
    let { top: n14 } = this.heightMap.lineAt(t8, T9.ByPos, this.heightOracle, 0, 0), { bottom: o } = this.heightMap.lineAt(e7, T9.ByPos, this.heightOracle, 0, 0), { visibleTop: r2, visibleBottom: l11 } = this;
    return (t8 == 0 || n14 <= r2 - Math.max(10, Math.min(-i12, 250))) && (e7 == this.state.doc.length || o >= l11 + Math.max(10, Math.min(i12, 250))) && n14 > r2 - 2 * 1e3 && o < l11 + 2 * 1e3;
  }
  mapLineGaps(t8, e7) {
    if (!t8.length || e7.empty) return t8;
    let i12 = [];
    for (let n14 of t8) e7.touchesRange(n14.from, n14.to) || i12.push(new It6(e7.mapPos(n14.from), e7.mapPos(n14.to), n14.size, n14.displaySize));
    return i12;
  }
  ensureLineGaps(t8, e7) {
    let i12 = this.heightOracle.lineWrapping, n14 = i12 ? 1e4 : 2e3, o = n14 >> 1, r2 = n14 << 1;
    if (this.defaultTextDirection != L8.LTR && !i12) return [];
    let l11 = [], h3 = (a2, f6, d4, u3) => {
      if (f6 - a2 < o) return;
      let p3 = this.state.selection.main, g8 = [p3.from];
      p3.empty || g8.push(p3.to);
      for (let m11 of g8) if (m11 > a2 && m11 < f6) {
        h3(a2, m11 - 10, d4, u3), h3(m11 + 10, f6, d4, u3);
        return;
      }
      let b12 = or4(t8, (m11) => m11.from >= d4.from && m11.to <= d4.to && Math.abs(m11.from - a2) < o && Math.abs(m11.to - f6) < o && !g8.some((w14) => m11.from < w14 && m11.to > w14));
      if (!b12) {
        if (f6 < d4.to && e7 && i12 && e7.visibleRanges.some((v10) => v10.from <= f6 && v10.to >= f6)) {
          let v10 = e7.moveToLineBoundary(x.cursor(f6), false, true).head;
          v10 > a2 && (f6 = v10);
        }
        let m11 = this.gapSize(d4, a2, f6, u3), w14 = i12 || m11 < 2e6 ? m11 : 2e6;
        b12 = new It6(a2, f6, m11, w14);
      }
      l11.push(b12);
    }, c3 = (a2) => {
      if (a2.length < r2 || a2.type != F10.Text) return;
      let f6 = nr4(a2.from, a2.to, this.stateDeco);
      if (f6.total < r2) return;
      let d4 = this.scrollTarget ? this.scrollTarget.range.head : null, u3, p3;
      if (i12) {
        let g8 = n14 / this.heightOracle.lineLength * this.heightOracle.lineHeight, b12, m11;
        if (d4 != null) {
          let w14 = ae7(f6, d4), v10 = ((this.visibleBottom - this.visibleTop) / 2 + g8) / a2.height;
          b12 = w14 - v10, m11 = w14 + v10;
        } else b12 = (this.visibleTop - a2.top - g8) / a2.height, m11 = (this.visibleBottom - a2.top + g8) / a2.height;
        u3 = he7(f6, b12), p3 = he7(f6, m11);
      } else {
        let g8 = f6.total * this.heightOracle.charWidth, b12 = n14 * this.heightOracle.charWidth, m11 = 0;
        if (g8 > 2e6) for (let C11 of t8) C11.from >= a2.from && C11.from < a2.to && C11.size != C11.displaySize && C11.from * this.heightOracle.charWidth + m11 < this.pixelViewport.left && (m11 = C11.size - C11.displaySize);
        let w14 = this.pixelViewport.left + m11, v10 = this.pixelViewport.right + m11, x11, S17;
        if (d4 != null) {
          let C11 = ae7(f6, d4), E11 = ((v10 - w14) / 2 + b12) / g8;
          x11 = C11 - E11, S17 = C11 + E11;
        } else x11 = (w14 - b12) / g8, S17 = (v10 + b12) / g8;
        u3 = he7(f6, x11), p3 = he7(f6, S17);
      }
      u3 > a2.from && h3(a2.from, u3, a2, f6), p3 < a2.to && h3(p3, a2.to, a2, f6);
    };
    for (let a2 of this.viewportLines) Array.isArray(a2.type) ? a2.type.forEach(c3) : c3(a2);
    return l11;
  }
  gapSize(t8, e7, i12, n14) {
    let o = ae7(n14, i12) - ae7(n14, e7);
    return this.heightOracle.lineWrapping ? t8.height * o : n14.total * this.heightOracle.charWidth * o;
  }
  updateLineGaps(t8) {
    It6.same(t8, this.lineGaps) || (this.lineGaps = t8, this.lineGapDeco = O9.set(t8.map((e7) => e7.draw(this, this.heightOracle.lineWrapping))));
  }
  computeVisibleRanges() {
    let t8 = this.stateDeco;
    this.lineGaps.length && (t8 = t8.concat(this.lineGapDeco));
    let e7 = [];
    T.spans(t8, this.viewport.from, this.viewport.to, { span(n14, o) {
      e7.push({ from: n14, to: o });
    }, point() {
    } }, 20);
    let i12 = e7.length != this.visibleRanges.length || this.visibleRanges.some((n14, o) => n14.from != e7[o].from || n14.to != e7[o].to);
    return this.visibleRanges = e7, i12 ? 4 : 0;
  }
  lineBlockAt(t8) {
    return t8 >= this.viewport.from && t8 <= this.viewport.to && this.viewportLines.find((e7) => e7.from <= t8 && e7.to >= t8) || Pt5(this.heightMap.lineAt(t8, T9.ByPos, this.heightOracle, 0, 0), this.scaler);
  }
  lineBlockAtHeight(t8) {
    return t8 >= this.viewportLines[0].top && t8 <= this.viewportLines[this.viewportLines.length - 1].bottom && this.viewportLines.find((e7) => e7.top <= t8 && e7.bottom >= t8) || Pt5(this.heightMap.lineAt(this.scaler.fromDOM(t8), T9.ByHeight, this.heightOracle, 0, 0), this.scaler);
  }
  scrollAnchorAt(t8) {
    let e7 = this.lineBlockAtHeight(t8 + 8);
    return e7.from >= this.viewport.from || this.viewportLines[0].top - t8 > 200 ? e7 : this.viewportLines[0];
  }
  elementAtHeight(t8) {
    return Pt5(this.heightMap.blockAt(this.scaler.fromDOM(t8), this.heightOracle, 0, 0), this.scaler);
  }
  get docHeight() {
    return this.scaler.toDOM(this.heightMap.height);
  }
  get contentHeight() {
    return this.docHeight + this.paddingTop + this.paddingBottom;
  }
};
var xt6 = class {
  constructor(t8, e7) {
    this.from = t8, this.to = e7;
  }
};
function nr4(s212, t8, e7) {
  let i12 = [], n14 = s212, o = 0;
  return T.spans(e7, s212, t8, { span() {
  }, point(r2, l11) {
    r2 > n14 && (i12.push({ from: n14, to: r2 }), o += r2 - n14), n14 = l11;
  } }, 20), n14 < t8 && (i12.push({ from: n14, to: t8 }), o += t8 - n14), { total: o, ranges: i12 };
}
function he7({ total: s212, ranges: t8 }, e7) {
  if (e7 <= 0) return t8[0].from;
  if (e7 >= 1) return t8[t8.length - 1].to;
  let i12 = Math.floor(s212 * e7);
  for (let n14 = 0; ; n14++) {
    let { from: o, to: r2 } = t8[n14], l11 = r2 - o;
    if (i12 <= l11) return o + i12;
    i12 -= l11;
  }
}
function ae7(s212, t8) {
  let e7 = 0;
  for (let { from: i12, to: n14 } of s212.ranges) {
    if (t8 <= n14) {
      e7 += t8 - i12;
      break;
    }
    e7 += n14 - i12;
  }
  return e7 / s212.total;
}
function or4(s212, t8) {
  for (let e7 of s212) if (t8(e7)) return e7;
}
var gs4 = { toDOM(s212) {
  return s212;
}, fromDOM(s212) {
  return s212;
}, scale: 1, eq(s212) {
  return s212 == this;
} };
var bi4 = class s136 {
  constructor(t8, e7, i12) {
    let n14 = 0, o = 0, r2 = 0;
    this.viewports = i12.map(({ from: l11, to: h3 }) => {
      let c3 = e7.lineAt(l11, T9.ByPos, t8, 0, 0).top, a2 = e7.lineAt(h3, T9.ByPos, t8, 0, 0).bottom;
      return n14 += a2 - c3, { from: l11, to: h3, top: c3, bottom: a2, domTop: 0, domBottom: 0 };
    }), this.scale = (7e6 - n14) / (e7.height - n14);
    for (let l11 of this.viewports) l11.domTop = r2 + (l11.top - o) * this.scale, r2 = l11.domBottom = l11.domTop + (l11.bottom - l11.top), o = l11.bottom;
  }
  toDOM(t8) {
    for (let e7 = 0, i12 = 0, n14 = 0; ; e7++) {
      let o = e7 < this.viewports.length ? this.viewports[e7] : null;
      if (!o || t8 < o.top) return n14 + (t8 - i12) * this.scale;
      if (t8 <= o.bottom) return o.domTop + (t8 - o.top);
      i12 = o.bottom, n14 = o.domBottom;
    }
  }
  fromDOM(t8) {
    for (let e7 = 0, i12 = 0, n14 = 0; ; e7++) {
      let o = e7 < this.viewports.length ? this.viewports[e7] : null;
      if (!o || t8 < o.domTop) return i12 + (t8 - n14) / this.scale;
      if (t8 <= o.domBottom) return o.top + (t8 - o.domTop);
      i12 = o.bottom, n14 = o.domBottom;
    }
  }
  eq(t8) {
    return t8 instanceof s136 ? this.scale == t8.scale && this.viewports.length == t8.viewports.length && this.viewports.every((e7, i12) => e7.from == t8.viewports[i12].from && e7.to == t8.viewports[i12].to) : false;
  }
};
function Pt5(s212, t8) {
  if (t8.scale == 1) return s212;
  let e7 = t8.toDOM(s212.top), i12 = t8.toDOM(s212.bottom);
  return new X8(s212.from, s212.length, e7, i12 - e7, Array.isArray(s212._content) ? s212._content.map((n14) => Pt5(n14, t8)) : s212._content);
}
var ce9 = y.define({ combine: (s212) => s212.join(" ") });
var yi4 = y.define({ combine: (s212) => s212.indexOf(true) > -1 });
var wi4 = b2.newName();
var En4 = b2.newName();
var Ln4 = b2.newName();
var Bn4 = { "&light": "." + En4, "&dark": "." + Ln4 };
function xi4(s212, t8, e7) {
  return new b2(t8, { finish(i12) {
    return /&/.test(i12) ? i12.replace(/&\w*/, (n14) => {
      if (n14 == "&") return s212;
      if (!e7 || !e7[n14]) throw new RangeError(`Unsupported selector: ${n14}`);
      return e7[n14];
    }) : s212 + " " + i12;
  } });
}
var rr4 = xi4("." + wi4, { "&": { position: "relative !important", boxSizing: "border-box", "&.cm-focused": { outline: "1px dotted #212121" }, display: "flex !important", flexDirection: "column" }, ".cm-scroller": { display: "flex !important", alignItems: "flex-start !important", fontFamily: "monospace", lineHeight: 1.4, height: "100%", overflowX: "auto", position: "relative", zIndex: 0, overflowAnchor: "none" }, ".cm-content": { margin: 0, flexGrow: 2, flexShrink: 0, display: "block", whiteSpace: "pre", wordWrap: "normal", boxSizing: "border-box", minHeight: "100%", padding: "4px 0", outline: "none", "&[contenteditable=true]": { WebkitUserModify: "read-write-plaintext-only" } }, ".cm-lineWrapping": { whiteSpace_fallback: "pre-wrap", whiteSpace: "break-spaces", wordBreak: "break-word", overflowWrap: "anywhere", flexShrink: 1 }, "&light .cm-content": { caretColor: "black" }, "&dark .cm-content": { caretColor: "white" }, ".cm-line": { display: "block", padding: "0 2px 0 6px" }, ".cm-layer": { position: "absolute", left: 0, top: 0, contain: "size style", "& > *": { position: "absolute" } }, "&light .cm-selectionBackground": { background: "#d9d9d9" }, "&dark .cm-selectionBackground": { background: "#222" }, "&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground": { background: "#d7d4f0" }, "&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground": { background: "#233" }, ".cm-cursorLayer": { pointerEvents: "none" }, "&.cm-focused > .cm-scroller > .cm-cursorLayer": { animation: "steps(1) cm-blink 1.2s infinite" }, "@keyframes cm-blink": { "0%": {}, "50%": { opacity: 0 }, "100%": {} }, "@keyframes cm-blink2": { "0%": {}, "50%": { opacity: 0 }, "100%": {} }, ".cm-cursor, .cm-dropCursor": { borderLeft: "1.2px solid black", marginLeft: "-0.6px", pointerEvents: "none" }, ".cm-cursor": { display: "none" }, "&dark .cm-cursor": { borderLeftColor: "#ddd" }, ".cm-dropCursor": { position: "absolute" }, "&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor": { display: "block" }, ".cm-iso": { unicodeBidi: "isolate" }, ".cm-announced": { position: "fixed", top: "-10000px" }, "@media print": { ".cm-announced": { display: "none" } }, "&light .cm-activeLine": { backgroundColor: "#cceeff44" }, "&dark .cm-activeLine": { backgroundColor: "#99eeff33" }, "&light .cm-specialChar": { color: "red" }, "&dark .cm-specialChar": { color: "#f78" }, ".cm-gutters": { flexShrink: 0, display: "flex", height: "100%", boxSizing: "border-box", insetInlineStart: 0, zIndex: 200 }, "&light .cm-gutters": { backgroundColor: "#f5f5f5", color: "#6c6c6c", borderRight: "1px solid #ddd" }, "&dark .cm-gutters": { backgroundColor: "#333338", color: "#ccc" }, ".cm-gutter": { display: "flex !important", flexDirection: "column", flexShrink: 0, boxSizing: "border-box", minHeight: "100%", overflow: "hidden" }, ".cm-gutterElement": { boxSizing: "border-box" }, ".cm-lineNumbers .cm-gutterElement": { padding: "0 3px 0 5px", minWidth: "20px", textAlign: "right", whiteSpace: "nowrap" }, "&light .cm-activeLineGutter": { backgroundColor: "#e2f2ff" }, "&dark .cm-activeLineGutter": { backgroundColor: "#222227" }, ".cm-panels": { boxSizing: "border-box", position: "sticky", left: 0, right: 0, zIndex: 300 }, "&light .cm-panels": { backgroundColor: "#f5f5f5", color: "black" }, "&light .cm-panels-top": { borderBottom: "1px solid #ddd" }, "&light .cm-panels-bottom": { borderTop: "1px solid #ddd" }, "&dark .cm-panels": { backgroundColor: "#333338", color: "white" }, ".cm-tab": { display: "inline-block", overflow: "hidden", verticalAlign: "bottom" }, ".cm-widgetBuffer": { verticalAlign: "text-top", height: "1em", width: 0, display: "inline" }, ".cm-placeholder": { color: "#888", display: "inline-block", verticalAlign: "top" }, ".cm-highlightSpace": { backgroundImage: "radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)", backgroundPosition: "center" }, ".cm-highlightTab": { backgroundImage: `url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`, backgroundSize: "auto 100%", backgroundPosition: "right 90%", backgroundRepeat: "no-repeat" }, ".cm-trailingSpace": { backgroundColor: "#ff332255" }, ".cm-button": { verticalAlign: "middle", color: "inherit", fontSize: "70%", padding: ".2em 1em", borderRadius: "1px" }, "&light .cm-button": { backgroundImage: "linear-gradient(#eff1f5, #d9d9df)", border: "1px solid #888", "&:active": { backgroundImage: "linear-gradient(#b4b4b4, #d0d3d6)" } }, "&dark .cm-button": { backgroundImage: "linear-gradient(#393939, #111)", border: "1px solid #888", "&:active": { backgroundImage: "linear-gradient(#111, #333)" } }, ".cm-textfield": { verticalAlign: "middle", color: "inherit", fontSize: "70%", border: "1px solid silver", padding: ".2em .5em" }, "&light .cm-textfield": { backgroundColor: "white" }, "&dark .cm-textfield": { border: "1px solid #555", backgroundColor: "inherit" } }, Bn4);
var lr4 = { childList: true, characterData: true, subtree: true, attributes: true, characterDataOldValue: true };
var qe8 = y9.ie && y9.ie_version <= 11;
var vi4 = class {
  constructor(t8) {
    this.view = t8, this.active = false, this.editContext = null, this.selectionRange = new Ge7(), this.selectionChanged = false, this.delayedFlush = -1, this.resizeTimeout = -1, this.queue = [], this.delayedAndroidKey = null, this.flushingAndroidKey = -1, this.lastChange = 0, this.scrollTargets = [], this.intersection = null, this.resizeScroll = null, this.intersecting = false, this.gapIntersection = null, this.gaps = [], this.printQuery = null, this.parentCheck = -1, this.dom = t8.contentDOM, this.observer = new MutationObserver((e7) => {
      for (let i12 of e7) this.queue.push(i12);
      (y9.ie && y9.ie_version <= 11 || y9.ios && t8.composing) && e7.some((i12) => i12.type == "childList" && i12.removedNodes.length || i12.type == "characterData" && i12.oldValue.length > i12.target.nodeValue.length) ? this.flushSoon() : this.flush();
    }), window.EditContext && t8.constructor.EDIT_CONTEXT !== false && !(y9.chrome && y9.chrome_version < 126) && (this.editContext = new Si4(t8), t8.state.facet(st7) && (t8.contentDOM.editContext = this.editContext.editContext)), qe8 && (this.onCharData = (e7) => {
      this.queue.push({ target: e7.target, type: "characterData", oldValue: e7.prevValue }), this.flushSoon();
    }), this.onSelectionChange = this.onSelectionChange.bind(this), this.onResize = this.onResize.bind(this), this.onPrint = this.onPrint.bind(this), this.onScroll = this.onScroll.bind(this), window.matchMedia && (this.printQuery = window.matchMedia("print")), typeof ResizeObserver == "function" && (this.resizeScroll = new ResizeObserver(() => {
      var e7;
      ((e7 = this.view.docView) === null || e7 === void 0 ? void 0 : e7.lastUpdate) < Date.now() - 75 && this.onResize();
    }), this.resizeScroll.observe(t8.scrollDOM)), this.addWindowListeners(this.win = t8.win), this.start(), typeof IntersectionObserver == "function" && (this.intersection = new IntersectionObserver((e7) => {
      this.parentCheck < 0 && (this.parentCheck = setTimeout(this.listenForScroll.bind(this), 1e3)), e7.length > 0 && e7[e7.length - 1].intersectionRatio > 0 != this.intersecting && (this.intersecting = !this.intersecting, this.intersecting != this.view.inView && this.onScrollChanged(document.createEvent("Event")));
    }, { threshold: [0, 1e-3] }), this.intersection.observe(this.dom), this.gapIntersection = new IntersectionObserver((e7) => {
      e7.length > 0 && e7[e7.length - 1].intersectionRatio > 0 && this.onScrollChanged(document.createEvent("Event"));
    }, {})), this.listenForScroll(), this.readSelectionRange();
  }
  onScrollChanged(t8) {
    this.view.inputState.runHandlers("scroll", t8), this.intersecting && this.view.measure();
  }
  onScroll(t8) {
    this.intersecting && this.flush(false), this.editContext && this.view.requestMeasure(this.editContext.measureReq), this.onScrollChanged(t8);
  }
  onResize() {
    this.resizeTimeout < 0 && (this.resizeTimeout = setTimeout(() => {
      this.resizeTimeout = -1, this.view.requestMeasure();
    }, 50));
  }
  onPrint(t8) {
    (t8.type == "change" || !t8.type) && !t8.matches || (this.view.viewState.printing = true, this.view.measure(), setTimeout(() => {
      this.view.viewState.printing = false, this.view.requestMeasure();
    }, 500));
  }
  updateGaps(t8) {
    if (this.gapIntersection && (t8.length != this.gaps.length || this.gaps.some((e7, i12) => e7 != t8[i12]))) {
      this.gapIntersection.disconnect();
      for (let e7 of t8) this.gapIntersection.observe(e7);
      this.gaps = t8;
    }
  }
  onSelectionChange(t8) {
    let e7 = this.selectionChanged;
    if (!this.readSelectionRange() || this.delayedAndroidKey) return;
    let { view: i12 } = this, n14 = this.selectionRange;
    if (i12.state.facet(st7) ? i12.root.activeElement != this.dom : !ue7(this.dom, n14)) return;
    let o = n14.anchorNode && i12.docView.nearest(n14.anchorNode);
    if (o && o.ignoreEvent(t8)) {
      e7 || (this.selectionChanged = false);
      return;
    }
    (y9.ie && y9.ie_version <= 11 || y9.android && y9.chrome) && !i12.state.selection.main.empty && n14.focusNode && Vt6(n14.focusNode, n14.focusOffset, n14.anchorNode, n14.anchorOffset) ? this.flushSoon() : this.flush(false);
  }
  readSelectionRange() {
    let { view: t8 } = this, e7 = jt6(t8.root);
    if (!e7) return false;
    let i12 = y9.safari && t8.root.nodeType == 11 && t8.root.activeElement == this.dom && hr4(this.view, e7) || e7;
    if (!i12 || this.selectionRange.eq(i12)) return false;
    let n14 = ue7(this.dom, i12);
    return n14 && !this.selectionChanged && t8.inputState.lastFocusTime > Date.now() - 200 && t8.inputState.lastTouchTime < Date.now() - 300 && no4(this.dom, i12) ? (this.view.inputState.lastFocusTime = 0, t8.docView.updateSelection(), false) : (this.selectionRange.setRange(i12), n14 && (this.selectionChanged = true), true);
  }
  setSelectionRange(t8, e7) {
    this.selectionRange.set(t8.node, t8.offset, e7.node, e7.offset), this.selectionChanged = false;
  }
  clearSelectionRange() {
    this.selectionRange.set(null, 0, null, 0);
  }
  listenForScroll() {
    this.parentCheck = -1;
    let t8 = 0, e7 = null;
    for (let i12 = this.dom; i12; ) if (i12.nodeType == 1) !e7 && t8 < this.scrollTargets.length && this.scrollTargets[t8] == i12 ? t8++ : e7 || (e7 = this.scrollTargets.slice(0, t8)), e7 && e7.push(i12), i12 = i12.assignedSlot || i12.parentNode;
    else if (i12.nodeType == 11) i12 = i12.host;
    else break;
    if (t8 < this.scrollTargets.length && !e7 && (e7 = this.scrollTargets.slice(0, t8)), e7) {
      for (let i12 of this.scrollTargets) i12.removeEventListener("scroll", this.onScroll);
      for (let i12 of this.scrollTargets = e7) i12.addEventListener("scroll", this.onScroll);
    }
  }
  ignore(t8) {
    if (!this.active) return t8();
    try {
      return this.stop(), t8();
    } finally {
      this.start(), this.clear();
    }
  }
  start() {
    this.active || (this.observer.observe(this.dom, lr4), qe8 && this.dom.addEventListener("DOMCharacterDataModified", this.onCharData), this.active = true);
  }
  stop() {
    this.active && (this.active = false, this.observer.disconnect(), qe8 && this.dom.removeEventListener("DOMCharacterDataModified", this.onCharData));
  }
  clear() {
    this.processRecords(), this.queue.length = 0, this.selectionChanged = false;
  }
  delayAndroidKey(t8, e7) {
    var i12;
    if (!this.delayedAndroidKey) {
      let n14 = () => {
        let o = this.delayedAndroidKey;
        o && (this.clearDelayedAndroidKey(), this.view.inputState.lastKeyCode = o.keyCode, this.view.inputState.lastKeyTime = Date.now(), !this.flush() && o.force && Mt5(this.dom, o.key, o.keyCode));
      };
      this.flushingAndroidKey = this.view.win.requestAnimationFrame(n14);
    }
    (!this.delayedAndroidKey || t8 == "Enter") && (this.delayedAndroidKey = { key: t8, keyCode: e7, force: this.lastChange < Date.now() - 50 || !!(!((i12 = this.delayedAndroidKey) === null || i12 === void 0) && i12.force) });
  }
  clearDelayedAndroidKey() {
    this.win.cancelAnimationFrame(this.flushingAndroidKey), this.delayedAndroidKey = null, this.flushingAndroidKey = -1;
  }
  flushSoon() {
    this.delayedFlush < 0 && (this.delayedFlush = this.view.win.requestAnimationFrame(() => {
      this.delayedFlush = -1, this.flush();
    }));
  }
  forceFlush() {
    this.delayedFlush >= 0 && (this.view.win.cancelAnimationFrame(this.delayedFlush), this.delayedFlush = -1), this.flush();
  }
  pendingRecords() {
    for (let t8 of this.observer.takeRecords()) this.queue.push(t8);
    return this.queue;
  }
  processRecords() {
    let t8 = this.pendingRecords();
    t8.length && (this.queue = []);
    let e7 = -1, i12 = -1, n14 = false;
    for (let o of t8) {
      let r2 = this.readMutation(o);
      r2 && (r2.typeOver && (n14 = true), e7 == -1 ? { from: e7, to: i12 } = r2 : (e7 = Math.min(r2.from, e7), i12 = Math.max(r2.to, i12)));
    }
    return { from: e7, to: i12, typeOver: n14 };
  }
  readChange() {
    let { from: t8, to: e7, typeOver: i12 } = this.processRecords(), n14 = this.selectionChanged && ue7(this.dom, this.selectionRange);
    if (t8 < 0 && !n14) return null;
    t8 > -1 && (this.lastChange = Date.now()), this.view.inputState.lastFocusTime = 0, this.selectionChanged = false;
    let o = new hi4(this.view, t8, e7, i12);
    return this.view.docView.domChanged = { newSel: o.newSel ? o.newSel.main : null }, o;
  }
  flush(t8 = true) {
    if (this.delayedFlush >= 0 || this.delayedAndroidKey) return false;
    t8 && this.readSelectionRange();
    let e7 = this.readChange();
    if (!e7) return this.view.requestMeasure(), false;
    let i12 = this.view.state, n14 = Sn6(this.view, e7);
    return this.view.state == i12 && (e7.domChanged || e7.newSel && !e7.newSel.main.eq(this.view.state.selection.main)) && this.view.update([]), n14;
  }
  readMutation(t8) {
    let e7 = this.view.docView.nearest(t8.target);
    if (!e7 || e7.ignoreMutation(t8)) return null;
    if (e7.markDirty(t8.type == "attributes"), t8.type == "attributes" && (e7.flags |= 4), t8.type == "childList") {
      let i12 = ms4(e7, t8.previousSibling || t8.target.previousSibling, -1), n14 = ms4(e7, t8.nextSibling || t8.target.nextSibling, 1);
      return { from: i12 ? e7.posAfter(i12) : e7.posAtStart, to: n14 ? e7.posBefore(n14) : e7.posAtEnd, typeOver: false };
    } else return t8.type == "characterData" ? { from: e7.posAtStart, to: e7.posAtEnd, typeOver: t8.target.nodeValue == t8.oldValue } : null;
  }
  setWindow(t8) {
    t8 != this.win && (this.removeWindowListeners(this.win), this.win = t8, this.addWindowListeners(this.win));
  }
  addWindowListeners(t8) {
    t8.addEventListener("resize", this.onResize), this.printQuery ? this.printQuery.addEventListener ? this.printQuery.addEventListener("change", this.onPrint) : this.printQuery.addListener(this.onPrint) : t8.addEventListener("beforeprint", this.onPrint), t8.addEventListener("scroll", this.onScroll), t8.document.addEventListener("selectionchange", this.onSelectionChange);
  }
  removeWindowListeners(t8) {
    t8.removeEventListener("scroll", this.onScroll), t8.removeEventListener("resize", this.onResize), this.printQuery ? this.printQuery.removeEventListener ? this.printQuery.removeEventListener("change", this.onPrint) : this.printQuery.removeListener(this.onPrint) : t8.removeEventListener("beforeprint", this.onPrint), t8.document.removeEventListener("selectionchange", this.onSelectionChange);
  }
  update(t8) {
    this.editContext && (this.editContext.update(t8), t8.startState.facet(st7) != t8.state.facet(st7) && (t8.view.contentDOM.editContext = t8.state.facet(st7) ? this.editContext.editContext : null));
  }
  destroy() {
    var t8, e7, i12;
    this.stop(), (t8 = this.intersection) === null || t8 === void 0 || t8.disconnect(), (e7 = this.gapIntersection) === null || e7 === void 0 || e7.disconnect(), (i12 = this.resizeScroll) === null || i12 === void 0 || i12.disconnect();
    for (let n14 of this.scrollTargets) n14.removeEventListener("scroll", this.onScroll);
    this.removeWindowListeners(this.win), clearTimeout(this.parentCheck), clearTimeout(this.resizeTimeout), this.win.cancelAnimationFrame(this.delayedFlush), this.win.cancelAnimationFrame(this.flushingAndroidKey), this.editContext && (this.view.contentDOM.editContext = null, this.editContext.destroy());
  }
};
function ms4(s212, t8, e7) {
  for (; t8; ) {
    let i12 = R8.get(t8);
    if (i12 && i12.parent == s212) return i12;
    let n14 = t8.parentNode;
    t8 = n14 != s212.dom ? n14 : e7 > 0 ? t8.nextSibling : t8.previousSibling;
  }
  return null;
}
function bs4(s212, t8) {
  let e7 = t8.startContainer, i12 = t8.startOffset, n14 = t8.endContainer, o = t8.endOffset, r2 = s212.docView.domAtPos(s212.state.selection.main.anchor);
  return Vt6(r2.node, r2.offset, n14, o) && ([e7, i12, n14, o] = [n14, o, e7, i12]), { anchorNode: e7, anchorOffset: i12, focusNode: n14, focusOffset: o };
}
function hr4(s212, t8) {
  if (t8.getComposedRanges) {
    let n14 = t8.getComposedRanges(s212.root)[0];
    if (n14) return bs4(s212, n14);
  }
  let e7 = null;
  function i12(n14) {
    n14.preventDefault(), n14.stopImmediatePropagation(), e7 = n14.getTargetRanges()[0];
  }
  return s212.contentDOM.addEventListener("beforeinput", i12, true), s212.dom.ownerDocument.execCommand("indent"), s212.contentDOM.removeEventListener("beforeinput", i12, true), e7 ? bs4(s212, e7) : null;
}
var Si4 = class {
  constructor(t8) {
    this.from = 0, this.to = 0, this.pendingContextChange = null, this.handlers = /* @__PURE__ */ Object.create(null), this.resetRange(t8.state);
    let e7 = this.editContext = new window.EditContext({ text: t8.state.doc.sliceString(this.from, this.to), selectionStart: this.toContextPos(Math.max(this.from, Math.min(this.to, t8.state.selection.main.anchor))), selectionEnd: this.toContextPos(t8.state.selection.main.head) });
    this.handlers.textupdate = (i12) => {
      let { anchor: n14 } = t8.state.selection.main, o = { from: this.toEditorPos(i12.updateRangeStart), to: this.toEditorPos(i12.updateRangeEnd), insert: m.of(i12.text.split(`
`)) };
      o.from == this.from && n14 < this.from ? o.from = n14 : o.to == this.to && n14 > this.to && (o.to = n14), !(o.from == o.to && !o.insert.length) && (this.pendingContextChange = o, t8.state.readOnly || qi4(t8, o, x.single(this.toEditorPos(i12.selectionStart), this.toEditorPos(i12.selectionEnd))), this.pendingContextChange && (this.revertPending(t8.state), this.setSelection(t8.state)));
    }, this.handlers.characterboundsupdate = (i12) => {
      let n14 = [], o = null;
      for (let r2 = this.toEditorPos(i12.rangeStart), l11 = this.toEditorPos(i12.rangeEnd); r2 < l11; r2++) {
        let h3 = t8.coordsForChar(r2);
        o = h3 && new DOMRect(h3.left, h3.top, h3.right - h3.left, h3.bottom - h3.top) || o || new DOMRect(), n14.push(o);
      }
      e7.updateCharacterBounds(i12.rangeStart, n14);
    }, this.handlers.textformatupdate = (i12) => {
      let n14 = [];
      for (let o of i12.getTextFormats()) {
        let r2 = o.underlineStyle, l11 = o.underlineThickness;
        if (r2 != "None" && l11 != "None") {
          let h3 = `text-decoration: underline ${r2 == "Dashed" ? "dashed " : r2 == "Squiggle" ? "wavy " : ""}${l11 == "Thin" ? 1 : 2}px`;
          n14.push(O9.mark({ attributes: { style: h3 } }).range(this.toEditorPos(o.rangeStart), this.toEditorPos(o.rangeEnd)));
        }
      }
      t8.dispatch({ effects: pn5.of(O9.set(n14)) });
    }, this.handlers.compositionstart = () => {
      t8.inputState.composing < 0 && (t8.inputState.composing = 0, t8.inputState.compositionFirstChange = true);
    }, this.handlers.compositionend = () => {
      t8.inputState.composing = -1, t8.inputState.compositionFirstChange = null;
    };
    for (let i12 in this.handlers) e7.addEventListener(i12, this.handlers[i12]);
    this.measureReq = { read: (i12) => {
      this.editContext.updateControlBounds(i12.contentDOM.getBoundingClientRect());
      let n14 = jt6(i12.root);
      n14 && n14.rangeCount && this.editContext.updateSelectionBounds(n14.getRangeAt(0).getBoundingClientRect());
    } };
  }
  applyEdits(t8) {
    let e7 = 0, i12 = false, n14 = this.pendingContextChange;
    return t8.changes.iterChanges((o, r2, l11, h3, c3) => {
      if (i12) return;
      let a2 = c3.length - (r2 - o);
      if (n14 && r2 >= n14.to) if (n14.from == o && n14.to == r2 && n14.insert.eq(c3)) {
        n14 = this.pendingContextChange = null, e7 += a2, this.to += a2;
        return;
      } else n14 = null, this.revertPending(t8.state);
      if (o += e7, r2 += e7, r2 <= this.from) this.from += a2, this.to += a2;
      else if (o < this.to) {
        if (o < this.from || r2 > this.to || this.to - this.from + c3.length > 3e4) {
          i12 = true;
          return;
        }
        this.editContext.updateText(this.toContextPos(o), this.toContextPos(r2), c3.toString()), this.to += a2;
      }
      e7 += a2;
    }), n14 && !i12 && this.revertPending(t8.state), !i12;
  }
  update(t8) {
    let e7 = this.pendingContextChange;
    !this.applyEdits(t8) || !this.rangeIsValid(t8.state) ? (this.pendingContextChange = null, this.resetRange(t8.state), this.editContext.updateText(0, this.editContext.text.length, t8.state.doc.sliceString(this.from, this.to)), this.setSelection(t8.state)) : (t8.docChanged || t8.selectionSet || e7) && this.setSelection(t8.state), (t8.geometryChanged || t8.docChanged || t8.selectionSet) && t8.view.requestMeasure(this.measureReq);
  }
  resetRange(t8) {
    let { head: e7 } = t8.selection.main;
    this.from = Math.max(0, e7 - 1e4), this.to = Math.min(t8.doc.length, e7 + 1e4);
  }
  revertPending(t8) {
    let e7 = this.pendingContextChange;
    this.pendingContextChange = null, this.editContext.updateText(this.toContextPos(e7.from), this.toContextPos(e7.from + e7.insert.length), t8.doc.sliceString(e7.from, e7.to));
  }
  setSelection(t8) {
    let { main: e7 } = t8.selection, i12 = this.toContextPos(Math.max(this.from, Math.min(this.to, e7.anchor))), n14 = this.toContextPos(e7.head);
    (this.editContext.selectionStart != i12 || this.editContext.selectionEnd != n14) && this.editContext.updateSelection(i12, n14);
  }
  rangeIsValid(t8) {
    let { head: e7 } = t8.selection.main;
    return !(this.from > 0 && e7 - this.from < 500 || this.to < t8.doc.length && this.to - e7 < 500 || this.to - this.from > 1e4 * 3);
  }
  toEditorPos(t8) {
    return t8 + this.from;
  }
  toContextPos(t8) {
    return t8 - this.from;
  }
  destroy() {
    for (let t8 in this.handlers) this.editContext.removeEventListener(t8, this.handlers[t8]);
  }
};
var A8 = class s137 {
  get state() {
    return this.viewState.state;
  }
  get viewport() {
    return this.viewState.viewport;
  }
  get visibleRanges() {
    return this.viewState.visibleRanges;
  }
  get inView() {
    return this.viewState.inView;
  }
  get composing() {
    return this.inputState.composing > 0;
  }
  get compositionStarted() {
    return this.inputState.composing >= 0;
  }
  get root() {
    return this._root;
  }
  get win() {
    return this.dom.ownerDocument.defaultView || window;
  }
  constructor(t8 = {}) {
    var e7;
    this.plugins = [], this.pluginMap = /* @__PURE__ */ new Map(), this.editorAttrs = {}, this.contentAttrs = {}, this.bidiCache = [], this.destroyed = false, this.updateState = 2, this.measureScheduled = -1, this.measureRequests = [], this.contentDOM = document.createElement("div"), this.scrollDOM = document.createElement("div"), this.scrollDOM.tabIndex = -1, this.scrollDOM.className = "cm-scroller", this.scrollDOM.appendChild(this.contentDOM), this.announceDOM = document.createElement("div"), this.announceDOM.className = "cm-announced", this.announceDOM.setAttribute("aria-live", "polite"), this.dom = document.createElement("div"), this.dom.appendChild(this.announceDOM), this.dom.appendChild(this.scrollDOM), t8.parent && t8.parent.appendChild(this.dom);
    let { dispatch: i12 } = t8;
    this.dispatchTransactions = t8.dispatchTransactions || i12 && ((n14) => n14.forEach((o) => i12(o, this))) || ((n14) => this.update(n14)), this.dispatch = this.dispatch.bind(this), this._root = t8.root || so4(t8.parent) || document, this.viewState = new Re7(t8.state || I.create(t8)), t8.scrollTo && t8.scrollTo.is(oe5) && (this.viewState.scrollTarget = t8.scrollTo.value.clip(this.viewState.state)), this.plugins = this.state.facet(Et6).map((n14) => new zt6(n14));
    for (let n14 of this.plugins) n14.update(this);
    this.observer = new vi4(this), this.inputState = new ai4(this), this.inputState.ensureHandlers(this.plugins), this.docView = new Me8(this), this.mountStyles(), this.updateAttrs(), this.updateState = 0, this.requestMeasure(), !((e7 = document.fonts) === null || e7 === void 0) && e7.ready && document.fonts.ready.then(() => this.requestMeasure());
  }
  dispatch(...t8) {
    let e7 = t8.length == 1 && t8[0] instanceof S ? t8 : t8.length == 1 && Array.isArray(t8[0]) ? t8[0] : [this.state.update(...t8)];
    this.dispatchTransactions(e7, this);
  }
  update(t8) {
    if (this.updateState != 0) throw new Error("Calls to EditorView.update are not allowed while an update is in progress");
    let e7 = false, i12 = false, n14, o = this.state;
    for (let d4 of t8) {
      if (d4.startState != o) throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");
      o = d4.state;
    }
    if (this.destroyed) {
      this.viewState.state = o;
      return;
    }
    let r2 = this.hasFocus, l11 = 0, h3 = null;
    t8.some((d4) => d4.annotation(On4)) ? (this.inputState.notifiedFocused = r2, l11 = 1) : r2 != this.inputState.notifiedFocused && (this.inputState.notifiedFocused = r2, h3 = Tn4(o, r2), h3 || (l11 = 1));
    let c3 = this.observer.delayedAndroidKey, a2 = null;
    if (c3 ? (this.observer.clearDelayedAndroidKey(), a2 = this.observer.readChange(), (a2 && !this.state.doc.eq(o.doc) || !this.state.selection.eq(o.selection)) && (a2 = null)) : this.observer.clear(), o.facet(I.phrases) != this.state.facet(I.phrases)) return this.setState(o);
    n14 = Ce5.create(this, o, t8), n14.flags |= l11;
    let f6 = this.viewState.scrollTarget;
    try {
      this.updateState = 2;
      for (let d4 of t8) {
        if (f6 && (f6 = f6.map(d4.changes)), d4.scrollIntoView) {
          let { main: u3 } = d4.state.selection;
          f6 = new Wt6(u3.empty ? u3 : x.cursor(u3.head, u3.head > u3.anchor ? -1 : 1));
        }
        for (let u3 of d4.effects) u3.is(oe5) && (f6 = u3.value.clip(this.state));
      }
      this.viewState.update(n14, f6), this.bidiCache = Ee10.update(this.bidiCache, n14.changes), n14.empty || (this.updatePlugins(n14), this.inputState.update(n14)), e7 = this.docView.update(n14), this.state.facet(Lt5) != this.styleModules && this.mountStyles(), i12 = this.updateAttrs(), this.showAnnouncements(t8), this.docView.updateSelection(e7, t8.some((d4) => d4.isUserEvent("select.pointer")));
    } finally {
      this.updateState = 0;
    }
    if (n14.startState.facet(ce9) != n14.state.facet(ce9) && (this.viewState.mustMeasureContent = true), (e7 || i12 || f6 || this.viewState.mustEnforceCursorAssoc || this.viewState.mustMeasureContent) && this.requestMeasure(), e7 && this.docViewUpdate(), !n14.empty) for (let d4 of this.state.facet(ni4)) try {
      d4(n14);
    } catch (u3) {
      $7(this.state, u3, "update listener");
    }
    (h3 || a2) && Promise.resolve().then(() => {
      h3 && this.state == h3.startState && this.dispatch(h3), a2 && !Sn6(this, a2) && c3.force && Mt5(this.contentDOM, c3.key, c3.keyCode);
    });
  }
  setState(t8) {
    if (this.updateState != 0) throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");
    if (this.destroyed) {
      this.viewState.state = t8;
      return;
    }
    this.updateState = 2;
    let e7 = this.hasFocus;
    try {
      for (let i12 of this.plugins) i12.destroy(this);
      this.viewState = new Re7(t8), this.plugins = t8.facet(Et6).map((i12) => new zt6(i12)), this.pluginMap.clear();
      for (let i12 of this.plugins) i12.update(this);
      this.docView.destroy(), this.docView = new Me8(this), this.inputState.ensureHandlers(this.plugins), this.mountStyles(), this.updateAttrs(), this.bidiCache = [];
    } finally {
      this.updateState = 0;
    }
    e7 && this.focus(), this.requestMeasure();
  }
  updatePlugins(t8) {
    let e7 = t8.startState.facet(Et6), i12 = t8.state.facet(Et6);
    if (e7 != i12) {
      let n14 = [];
      for (let o of i12) {
        let r2 = e7.indexOf(o);
        if (r2 < 0) n14.push(new zt6(o));
        else {
          let l11 = this.plugins[r2];
          l11.mustUpdate = t8, n14.push(l11);
        }
      }
      for (let o of this.plugins) o.mustUpdate != t8 && o.destroy(this);
      this.plugins = n14, this.pluginMap.clear();
    } else for (let n14 of this.plugins) n14.mustUpdate = t8;
    for (let n14 = 0; n14 < this.plugins.length; n14++) this.plugins[n14].update(this);
    e7 != i12 && this.inputState.ensureHandlers(this.plugins);
  }
  docViewUpdate() {
    for (let t8 of this.plugins) {
      let e7 = t8.value;
      if (e7 && e7.docViewUpdate) try {
        e7.docViewUpdate(this);
      } catch (i12) {
        $7(this.state, i12, "doc view update listener");
      }
    }
  }
  measure(t8 = true) {
    if (this.destroyed) return;
    if (this.measureScheduled > -1 && this.win.cancelAnimationFrame(this.measureScheduled), this.observer.delayedAndroidKey) {
      this.measureScheduled = -1, this.requestMeasure();
      return;
    }
    this.measureScheduled = 0, t8 && this.observer.forceFlush();
    let e7 = null, i12 = this.scrollDOM, n14 = i12.scrollTop * this.scaleY, { scrollAnchorPos: o, scrollAnchorHeight: r2 } = this.viewState;
    Math.abs(n14 - this.viewState.scrollTop) > 1 && (r2 = -1), this.viewState.scrollAnchorHeight = -1;
    try {
      for (let l11 = 0; ; l11++) {
        if (r2 < 0) if (zs4(i12)) o = -1, r2 = this.viewState.heightMap.height;
        else {
          let u3 = this.viewState.scrollAnchorAt(n14);
          o = u3.from, r2 = u3.top;
        }
        this.updateState = 1;
        let h3 = this.viewState.measure(this);
        if (!h3 && !this.measureRequests.length && this.viewState.scrollTarget == null) break;
        if (l11 > 5) {
          console.warn(this.measureRequests.length ? "Measure loop restarted more than 5 times" : "Viewport failed to stabilize");
          break;
        }
        let c3 = [];
        h3 & 4 || ([this.measureRequests, c3] = [c3, this.measureRequests]);
        let a2 = c3.map((u3) => {
          try {
            return u3.read(this);
          } catch (p3) {
            return $7(this.state, p3), ys4;
          }
        }), f6 = Ce5.create(this, this.state, []), d4 = false;
        f6.flags |= h3, e7 ? e7.flags |= h3 : e7 = f6, this.updateState = 2, f6.empty || (this.updatePlugins(f6), this.inputState.update(f6), this.updateAttrs(), d4 = this.docView.update(f6), d4 && this.docViewUpdate());
        for (let u3 = 0; u3 < c3.length; u3++) if (a2[u3] != ys4) try {
          let p3 = c3[u3];
          p3.write && p3.write(a2[u3], this);
        } catch (p3) {
          $7(this.state, p3);
        }
        if (d4 && this.docView.updateSelection(true), !f6.viewportChanged && this.measureRequests.length == 0) {
          if (this.viewState.editorHeight) if (this.viewState.scrollTarget) {
            this.docView.scrollIntoView(this.viewState.scrollTarget), this.viewState.scrollTarget = null, r2 = -1;
            continue;
          } else {
            let p3 = (o < 0 ? this.viewState.heightMap.height : this.viewState.lineBlockAt(o).top) - r2;
            if (p3 > 1 || p3 < -1) {
              n14 = n14 + p3, i12.scrollTop = n14 / this.scaleY, r2 = -1;
              continue;
            }
          }
          break;
        }
      }
    } finally {
      this.updateState = 0, this.measureScheduled = -1;
    }
    if (e7 && !e7.empty) for (let l11 of this.state.facet(ni4)) l11(e7);
  }
  get themeClasses() {
    return wi4 + " " + (this.state.facet(yi4) ? Ln4 : En4) + " " + this.state.facet(ce9);
  }
  updateAttrs() {
    let t8 = ws4(this, gn5, { class: "cm-editor" + (this.hasFocus ? " cm-focused " : " ") + this.themeClasses }), e7 = { spellcheck: "false", autocorrect: "off", autocapitalize: "off", translate: "no", contenteditable: this.state.facet(st7) ? "true" : "false", class: "cm-content", style: `${y9.tabSize}: ${this.state.tabSize}`, role: "textbox", "aria-multiline": "true" };
    this.state.readOnly && (e7["aria-readonly"] = "true"), ws4(this, Ve8, e7);
    let i12 = this.observer.ignore(() => {
      let n14 = Ze7(this.contentDOM, this.contentAttrs, e7), o = Ze7(this.dom, this.editorAttrs, t8);
      return n14 || o;
    });
    return this.editorAttrs = t8, this.contentAttrs = e7, i12;
  }
  showAnnouncements(t8) {
    let e7 = true;
    for (let i12 of t8) for (let n14 of i12.effects) if (n14.is(s137.announce)) {
      e7 && (this.announceDOM.textContent = ""), e7 = false;
      let o = this.announceDOM.appendChild(document.createElement("div"));
      o.textContent = n14.value;
    }
  }
  mountStyles() {
    this.styleModules = this.state.facet(Lt5);
    let t8 = this.state.facet(s137.cspNonce);
    b2.mount(this.root, this.styleModules.concat(rr4).reverse(), t8 ? { nonce: t8 } : void 0);
  }
  readMeasured() {
    if (this.updateState == 2) throw new Error("Reading the editor layout isn't allowed during an update");
    this.updateState == 0 && this.measureScheduled > -1 && this.measure(false);
  }
  requestMeasure(t8) {
    if (this.measureScheduled < 0 && (this.measureScheduled = this.win.requestAnimationFrame(() => this.measure())), t8) {
      if (this.measureRequests.indexOf(t8) > -1) return;
      if (t8.key != null) {
        for (let e7 = 0; e7 < this.measureRequests.length; e7++) if (this.measureRequests[e7].key === t8.key) {
          this.measureRequests[e7] = t8;
          return;
        }
      }
      this.measureRequests.push(t8);
    }
  }
  plugin(t8) {
    let e7 = this.pluginMap.get(t8);
    return (e7 === void 0 || e7 && e7.spec != t8) && this.pluginMap.set(t8, e7 = this.plugins.find((i12) => i12.spec == t8) || null), e7 && e7.update(this).value;
  }
  get documentTop() {
    return this.contentDOM.getBoundingClientRect().top + this.viewState.paddingTop;
  }
  get documentPadding() {
    return { top: this.viewState.paddingTop, bottom: this.viewState.paddingBottom };
  }
  get scaleX() {
    return this.viewState.scaleX;
  }
  get scaleY() {
    return this.viewState.scaleY;
  }
  elementAtHeight(t8) {
    return this.readMeasured(), this.viewState.elementAtHeight(t8);
  }
  lineBlockAtHeight(t8) {
    return this.readMeasured(), this.viewState.lineBlockAtHeight(t8);
  }
  get viewportLineBlocks() {
    return this.viewState.viewportLines;
  }
  lineBlockAt(t8) {
    return this.viewState.lineBlockAt(t8);
  }
  get contentHeight() {
    return this.viewState.contentHeight;
  }
  moveByChar(t8, e7, i12) {
    return Ke8(this, t8, ss4(this, t8, e7, i12));
  }
  moveByGroup(t8, e7) {
    return Ke8(this, t8, ss4(this, t8, e7, (i12) => Lo4(this, t8.head, i12)));
  }
  visualLineSide(t8, e7) {
    let i12 = this.bidiSpans(t8), n14 = this.textDirectionAt(t8.from), o = i12[e7 ? i12.length - 1 : 0];
    return x.cursor(o.side(e7, n14) + t8.from, o.forward(!e7, n14) ? 1 : -1);
  }
  moveToLineBoundary(t8, e7, i12 = true) {
    return Eo4(this, t8, e7, i12);
  }
  moveVertically(t8, e7, i12) {
    return Ke8(this, t8, Bo4(this, t8, e7, i12));
  }
  domAtPos(t8) {
    return this.docView.domAtPos(t8);
  }
  posAtDOM(t8, e7 = 0) {
    return this.docView.posFromDOM(t8, e7);
  }
  posAtCoords(t8, e7 = true) {
    return this.readMeasured(), vn4(this, t8, e7);
  }
  coordsAtPos(t8, e7 = 1) {
    this.readMeasured();
    let i12 = this.docView.coordsAt(t8, e7);
    if (!i12 || i12.left == i12.right) return i12;
    let n14 = this.state.doc.lineAt(t8), o = this.bidiSpans(n14), r2 = o[G11.find(o, t8 - n14.from, -1, e7)];
    return te8(i12, r2.dir == L8.LTR == e7 > 0);
  }
  coordsForChar(t8) {
    return this.readMeasured(), this.docView.coordsForChar(t8);
  }
  get defaultCharacterWidth() {
    return this.viewState.heightOracle.charWidth;
  }
  get defaultLineHeight() {
    return this.viewState.heightOracle.lineHeight;
  }
  get textDirection() {
    return this.viewState.defaultTextDirection;
  }
  textDirectionAt(t8) {
    return !this.state.facet(fn5) || t8 < this.viewport.from || t8 > this.viewport.to ? this.textDirection : (this.readMeasured(), this.docView.textDirectionAt(t8));
  }
  get lineWrapping() {
    return this.viewState.heightOracle.lineWrapping;
  }
  bidiSpans(t8) {
    if (t8.length > ar4) return en5(t8.length);
    let e7 = this.textDirectionAt(t8.from), i12;
    for (let o of this.bidiCache) if (o.from == t8.from && o.dir == e7 && (o.fresh || Zs4(o.isolates, i12 = Ji4(this, t8)))) return o.order;
    i12 || (i12 = Ji4(this, t8));
    let n14 = tn6(t8.text, e7, i12);
    return this.bidiCache.push(new Ee10(t8.from, t8.to, e7, i12, true, n14)), n14;
  }
  get hasFocus() {
    var t8;
    return (this.dom.ownerDocument.hasFocus() || y9.safari && ((t8 = this.inputState) === null || t8 === void 0 ? void 0 : t8.lastContextMenu) > Date.now() - 3e4) && this.root.activeElement == this.contentDOM;
  }
  focus() {
    this.observer.ignore(() => {
      Fs4(this.contentDOM), this.docView.updateSelection();
    });
  }
  setRoot(t8) {
    this._root != t8 && (this._root = t8, this.observer.setWindow((t8.nodeType == 9 ? t8 : t8.ownerDocument).defaultView || window), this.mountStyles());
  }
  destroy() {
    this.root.activeElement == this.contentDOM && this.contentDOM.blur();
    for (let t8 of this.plugins) t8.destroy(this);
    this.plugins = [], this.inputState.destroy(), this.docView.destroy(), this.dom.remove(), this.observer.destroy(), this.measureScheduled > -1 && this.win.cancelAnimationFrame(this.measureScheduled), this.destroyed = true;
  }
  static scrollIntoView(t8, e7 = {}) {
    return oe5.of(new Wt6(typeof t8 == "number" ? x.cursor(t8) : t8, e7.y, e7.x, e7.yMargin, e7.xMargin));
  }
  scrollSnapshot() {
    let { scrollTop: t8, scrollLeft: e7 } = this.scrollDOM, i12 = this.viewState.scrollAnchorAt(t8);
    return oe5.of(new Wt6(x.cursor(i12.from), "start", "start", i12.top - t8, e7, true));
  }
  setTabFocusMode(t8) {
    t8 == null ? this.inputState.tabFocusMode = this.inputState.tabFocusMode < 0 ? 0 : -1 : typeof t8 == "boolean" ? this.inputState.tabFocusMode = t8 ? 0 : -1 : this.inputState.tabFocusMode != 0 && (this.inputState.tabFocusMode = Date.now() + t8);
  }
  static domEventHandlers(t8) {
    return N9.define(() => ({}), { eventHandlers: t8 });
  }
  static domEventObservers(t8) {
    return N9.define(() => ({}), { eventObservers: t8 });
  }
  static theme(t8, e7) {
    let i12 = b2.newName(), n14 = [ce9.of(i12), Lt5.of(xi4(`.${i12}`, t8))];
    return e7 && e7.dark && n14.push(yi4.of(true)), n14;
  }
  static baseTheme(t8) {
    return ht.lowest(Lt5.of(xi4("." + wi4, t8, Bn4)));
  }
  static findFromDOM(t8) {
    var e7;
    let i12 = t8.querySelector(".cm-content"), n14 = i12 && R8.get(i12) || R8.get(t8);
    return ((e7 = n14?.rootView) === null || e7 === void 0 ? void 0 : e7.view) || null;
  }
};
A8.styleModule = Lt5;
A8.inputHandler = an4;
A8.clipboardInputFilter = zi4;
A8.clipboardOutputFilter = Ii4;
A8.scrollHandler = un5;
A8.focusChangeEffect = cn5;
A8.perLineTextDirection = fn5;
A8.exceptionSink = hn4;
A8.updateListener = ni4;
A8.editable = st7;
A8.mouseSelectionStyle = ln5;
A8.dragMovesSelection = rn5;
A8.clickAddsSelectionRange = on5;
A8.decorations = Ut6;
A8.outerDecorations = mn4;
A8.atomicRanges = Ki4;
A8.bidiIsolatedRanges = bn4;
A8.scrollMargins = yn5;
A8.darkTheme = yi4;
A8.cspNonce = y.define({ combine: (s212) => s212.length ? s212[0] : "" });
A8.contentAttributes = Ve8;
A8.editorAttributes = gn5;
A8.lineWrapping = A8.contentAttributes.of({ class: "cm-lineWrapping" });
A8.announce = v.define();
var ar4 = 4096;
var ys4 = {};
var Ee10 = class s138 {
  constructor(t8, e7, i12, n14, o, r2) {
    this.from = t8, this.to = e7, this.dir = i12, this.isolates = n14, this.fresh = o, this.order = r2;
  }
  static update(t8, e7) {
    if (e7.empty && !t8.some((o) => o.fresh)) return t8;
    let i12 = [], n14 = t8.length ? t8[t8.length - 1].dir : L8.LTR;
    for (let o = Math.max(0, t8.length - 10); o < t8.length; o++) {
      let r2 = t8[o];
      r2.dir == n14 && !e7.touchesRange(r2.from, r2.to) && i12.push(new s138(e7.mapPos(r2.from, 1), e7.mapPos(r2.to, -1), r2.dir, r2.isolates, false, r2.order));
    }
    return i12;
  }
};
function ws4(s212, t8, e7) {
  for (let i12 = s212.state.facet(t8), n14 = i12.length - 1; n14 >= 0; n14--) {
    let o = i12[n14], r2 = typeof o == "function" ? o(s212) : o;
    r2 && Je5(r2, e7);
  }
  return e7;
}
var cr4 = y9.mac ? "mac" : y9.windows ? "win" : y9.linux ? "linux" : "key";
function fr4(s212, t8) {
  let e7 = s212.split(/-(?!$)/), i12 = e7[e7.length - 1];
  i12 == "Space" && (i12 = " ");
  let n14, o, r2, l11;
  for (let h3 = 0; h3 < e7.length - 1; ++h3) {
    let c3 = e7[h3];
    if (/^(cmd|meta|m)$/i.test(c3)) l11 = true;
    else if (/^a(lt)?$/i.test(c3)) n14 = true;
    else if (/^(c|ctrl|control)$/i.test(c3)) o = true;
    else if (/^s(hift)?$/i.test(c3)) r2 = true;
    else if (/^mod$/i.test(c3)) t8 == "mac" ? l11 = true : o = true;
    else throw new Error("Unrecognized modifier name: " + c3);
  }
  return n14 && (i12 = "Alt-" + i12), o && (i12 = "Ctrl-" + i12), l11 && (i12 = "Meta-" + i12), r2 && (i12 = "Shift-" + i12), i12;
}
function fe8(s212, t8, e7) {
  return t8.altKey && (s212 = "Alt-" + s212), t8.ctrlKey && (s212 = "Ctrl-" + s212), t8.metaKey && (s212 = "Meta-" + s212), e7 !== false && t8.shiftKey && (s212 = "Shift-" + s212), s212;
}
var dr4 = ht.default(A8.domEventHandlers({ keydown(s212, t8) {
  return Hn4(Pn4(t8.state), s212, t8, "editor");
} }));
var ur4 = y.define({ enables: dr4 });
var xs4 = /* @__PURE__ */ new WeakMap();
function Pn4(s212) {
  let t8 = s212.facet(ur4), e7 = xs4.get(t8);
  return e7 || xs4.set(t8, e7 = gr4(t8.reduce((i12, n14) => i12.concat(n14), []))), e7;
}
var nt6 = null;
var pr4 = 4e3;
function gr4(s212, t8 = cr4) {
  let e7 = /* @__PURE__ */ Object.create(null), i12 = /* @__PURE__ */ Object.create(null), n14 = (r2, l11) => {
    let h3 = i12[r2];
    if (h3 == null) i12[r2] = l11;
    else if (h3 != l11) throw new Error("Key binding " + r2 + " is used both as a regular binding and as a multi-stroke prefix");
  }, o = (r2, l11, h3, c3, a2) => {
    var f6, d4;
    let u3 = e7[r2] || (e7[r2] = /* @__PURE__ */ Object.create(null)), p3 = l11.split(/ (?!$)/).map((m11) => fr4(m11, t8));
    for (let m11 = 1; m11 < p3.length; m11++) {
      let w14 = p3.slice(0, m11).join(" ");
      n14(w14, true), u3[w14] || (u3[w14] = { preventDefault: true, stopPropagation: false, run: [(v10) => {
        let x11 = nt6 = { view: v10, prefix: w14, scope: r2 };
        return setTimeout(() => {
          nt6 == x11 && (nt6 = null);
        }, pr4), true;
      }] });
    }
    let g8 = p3.join(" ");
    n14(g8, false);
    let b12 = u3[g8] || (u3[g8] = { preventDefault: false, stopPropagation: false, run: ((d4 = (f6 = u3._any) === null || f6 === void 0 ? void 0 : f6.run) === null || d4 === void 0 ? void 0 : d4.slice()) || [] });
    h3 && b12.run.push(h3), c3 && (b12.preventDefault = true), a2 && (b12.stopPropagation = true);
  };
  for (let r2 of s212) {
    let l11 = r2.scope ? r2.scope.split(" ") : ["editor"];
    if (r2.any) for (let c3 of l11) {
      let a2 = e7[c3] || (e7[c3] = /* @__PURE__ */ Object.create(null));
      a2._any || (a2._any = { preventDefault: false, stopPropagation: false, run: [] });
      let { any: f6 } = r2;
      for (let d4 in a2) a2[d4].run.push((u3) => f6(u3, Ci4));
    }
    let h3 = r2[t8] || r2.key;
    if (h3) for (let c3 of l11) o(c3, h3, r2.run, r2.preventDefault, r2.stopPropagation), r2.shift && o(c3, "Shift-" + h3, r2.shift, r2.preventDefault, r2.stopPropagation);
  }
  return e7;
}
var Ci4 = null;
function Hn4(s212, t8, e7, i12) {
  Ci4 = t8;
  let n14 = g2(t8), o = ae(n14, 0), r2 = Oe(o) == n14.length && n14 != " ", l11 = "", h3 = false, c3 = false, a2 = false;
  nt6 && nt6.view == e7 && nt6.scope == i12 && (l11 = nt6.prefix + " ", Mn4.indexOf(t8.keyCode) < 0 && (c3 = true, nt6 = null));
  let f6 = /* @__PURE__ */ new Set(), d4 = (b12) => {
    if (b12) {
      for (let m11 of b12.run) if (!f6.has(m11) && (f6.add(m11), m11(e7))) return b12.stopPropagation && (a2 = true), true;
      b12.preventDefault && (b12.stopPropagation && (a2 = true), c3 = true);
    }
    return false;
  }, u3 = s212[i12], p3, g8;
  return u3 && (d4(u3[l11 + fe8(n14, t8, !r2)]) ? h3 = true : r2 && (t8.altKey || t8.metaKey || t8.ctrlKey) && !(y9.windows && t8.ctrlKey && t8.altKey) && (p3 = t[t8.keyCode]) && p3 != n14 ? (d4(u3[l11 + fe8(p3, t8, true)]) || t8.shiftKey && (g8 = i[t8.keyCode]) != n14 && g8 != p3 && d4(u3[l11 + fe8(g8, t8, false)])) && (h3 = true) : r2 && t8.shiftKey && d4(u3[l11 + fe8(n14, t8, true)]) && (h3 = true), !h3 && d4(u3._any) && (h3 = true)), c3 && (h3 = true), h3 && a2 && t8.stopPropagation(), Ci4 = null, h3;
}
var Qt5 = class s139 {
  constructor(t8, e7, i12, n14, o) {
    this.className = t8, this.left = e7, this.top = i12, this.width = n14, this.height = o;
  }
  draw() {
    let t8 = document.createElement("div");
    return t8.className = this.className, this.adjust(t8), t8;
  }
  update(t8, e7) {
    return e7.className != this.className ? false : (this.adjust(t8), true);
  }
  adjust(t8) {
    t8.style.left = this.left + "px", t8.style.top = this.top + "px", this.width != null && (t8.style.width = this.width + "px"), t8.style.height = this.height + "px";
  }
  eq(t8) {
    return this.left == t8.left && this.top == t8.top && this.width == t8.width && this.height == t8.height && this.className == t8.className;
  }
  static forRange(t8, e7, i12) {
    if (i12.empty) {
      let n14 = t8.coordsAtPos(i12.head, i12.assoc || 1);
      if (!n14) return [];
      let o = Nn4(t8);
      return [new s139(e7, n14.left - o.left, n14.top - o.top, null, n14.bottom - n14.top)];
    } else return mr4(t8, e7, i12);
  }
};
function Nn4(s212) {
  let t8 = s212.scrollDOM.getBoundingClientRect();
  return { left: (s212.textDirection == L8.LTR ? t8.left : t8.right - s212.scrollDOM.clientWidth * s212.scaleX) - s212.scrollDOM.scrollLeft * s212.scaleX, top: t8.top - s212.scrollDOM.scrollTop * s212.scaleY };
}
function vs4(s212, t8, e7, i12) {
  let n14 = s212.coordsAtPos(t8, e7 * 2);
  if (!n14) return i12;
  let o = s212.dom.getBoundingClientRect(), r2 = (n14.top + n14.bottom) / 2, l11 = s212.posAtCoords({ x: o.left + 1, y: r2 }), h3 = s212.posAtCoords({ x: o.right - 1, y: r2 });
  return l11 == null || h3 == null ? i12 : { from: Math.max(i12.from, Math.min(l11, h3)), to: Math.min(i12.to, Math.max(l11, h3)) };
}
function mr4(s212, t8, e7) {
  if (e7.to <= s212.viewport.from || e7.from >= s212.viewport.to) return [];
  let i12 = Math.max(e7.from, s212.viewport.from), n14 = Math.min(e7.to, s212.viewport.to), o = s212.textDirection == L8.LTR, r2 = s212.contentDOM, l11 = r2.getBoundingClientRect(), h3 = Nn4(s212), c3 = r2.querySelector(".cm-line"), a2 = c3 && window.getComputedStyle(c3), f6 = l11.left + (a2 ? parseInt(a2.paddingLeft) + Math.min(0, parseInt(a2.textIndent)) : 0), d4 = l11.right - (a2 ? parseInt(a2.paddingRight) : 0), u3 = ri4(s212, i12), p3 = ri4(s212, n14), g8 = u3.type == F10.Text ? u3 : null, b12 = p3.type == F10.Text ? p3 : null;
  if (g8 && (s212.lineWrapping || u3.widgetLineBreaks) && (g8 = vs4(s212, i12, 1, g8)), b12 && (s212.lineWrapping || p3.widgetLineBreaks) && (b12 = vs4(s212, n14, -1, b12)), g8 && b12 && g8.from == b12.from && g8.to == b12.to) return w14(v10(e7.from, e7.to, g8));
  {
    let S17 = g8 ? v10(e7.from, null, g8) : x11(u3, false), C11 = b12 ? v10(null, e7.to, b12) : x11(p3, true), E11 = [];
    return (g8 || u3).to < (b12 || p3).from - (g8 && b12 ? 1 : 0) || u3.widgetLineBreaks > 1 && S17.bottom + s212.defaultLineHeight / 2 < C11.top ? E11.push(m11(f6, S17.bottom, d4, C11.top)) : S17.bottom < C11.top && s212.elementAtHeight((S17.bottom + C11.top) / 2).type == F10.Text && (S17.bottom = C11.top = (S17.bottom + C11.top) / 2), w14(S17).concat(E11).concat(w14(C11));
  }
  function m11(S17, C11, E11, B15) {
    return new Qt5(t8, S17 - h3.left, C11 - h3.top - 0.01, E11 - S17, B15 - C11 + 0.01);
  }
  function w14({ top: S17, bottom: C11, horizontal: E11 }) {
    let B15 = [];
    for (let et13 = 0; et13 < E11.length; et13 += 2) B15.push(m11(E11[et13], S17, E11[et13 + 1], C11));
    return B15;
  }
  function v10(S17, C11, E11) {
    let B15 = 1e9, et13 = -1e9, ee13 = [];
    function ji3(ct8, it12, bt5, ft8, Tt6) {
      let Z21 = s212.coordsAtPos(ct8, ct8 == E11.to ? -2 : 2), tt10 = s212.coordsAtPos(bt5, bt5 == E11.from ? 2 : -2);
      !Z21 || !tt10 || (B15 = Math.min(Z21.top, tt10.top, B15), et13 = Math.max(Z21.bottom, tt10.bottom, et13), Tt6 == L8.LTR ? ee13.push(o && it12 ? f6 : Z21.left, o && ft8 ? d4 : tt10.right) : ee13.push(!o && ft8 ? f6 : tt10.left, !o && it12 ? d4 : Z21.right));
    }
    let ie12 = S17 ?? E11.from, se15 = C11 ?? E11.to;
    for (let ct8 of s212.visibleRanges) if (ct8.to > ie12 && ct8.from < se15) for (let it12 = Math.max(ct8.from, ie12), bt5 = Math.min(ct8.to, se15); ; ) {
      let ft8 = s212.state.doc.lineAt(it12);
      for (let Tt6 of s212.bidiSpans(ft8)) {
        let Z21 = Tt6.from + ft8.from, tt10 = Tt6.to + ft8.from;
        if (Z21 >= bt5) break;
        tt10 > it12 && ji3(Math.max(Z21, it12), S17 == null && Z21 <= ie12, Math.min(tt10, bt5), C11 == null && tt10 >= se15, Tt6.dir);
      }
      if (it12 = ft8.to + 1, it12 >= bt5) break;
    }
    return ee13.length == 0 && ji3(ie12, S17 == null, se15, C11 == null, s212.textDirection), { top: B15, bottom: et13, horizontal: ee13 };
  }
  function x11(S17, C11) {
    let E11 = l11.top + (C11 ? S17.top : S17.bottom);
    return { top: E11, bottom: E11, horizontal: [] };
  }
}
function br4(s212, t8) {
  return s212.constructor == t8.constructor && s212.eq(t8);
}
var Mi4 = class {
  constructor(t8, e7) {
    this.view = t8, this.layer = e7, this.drawn = [], this.scaleX = 1, this.scaleY = 1, this.measureReq = { read: this.measure.bind(this), write: this.draw.bind(this) }, this.dom = t8.scrollDOM.appendChild(document.createElement("div")), this.dom.classList.add("cm-layer"), e7.above && this.dom.classList.add("cm-layer-above"), e7.class && this.dom.classList.add(e7.class), this.scale(), this.dom.setAttribute("aria-hidden", "true"), this.setOrder(t8.state), t8.requestMeasure(this.measureReq), e7.mount && e7.mount(this.dom, t8);
  }
  update(t8) {
    t8.startState.facet(me8) != t8.state.facet(me8) && this.setOrder(t8.state), (this.layer.update(t8, this.dom) || t8.geometryChanged) && (this.scale(), t8.view.requestMeasure(this.measureReq));
  }
  docViewUpdate(t8) {
    this.layer.updateOnDocViewUpdate !== false && t8.requestMeasure(this.measureReq);
  }
  setOrder(t8) {
    let e7 = 0, i12 = t8.facet(me8);
    for (; e7 < i12.length && i12[e7] != this.layer; ) e7++;
    this.dom.style.zIndex = String((this.layer.above ? 150 : -1) - e7);
  }
  measure() {
    return this.layer.markers(this.view);
  }
  scale() {
    let { scaleX: t8, scaleY: e7 } = this.view;
    (t8 != this.scaleX || e7 != this.scaleY) && (this.scaleX = t8, this.scaleY = e7, this.dom.style.transform = `scale(${1 / t8}, ${1 / e7})`);
  }
  draw(t8) {
    if (t8.length != this.drawn.length || t8.some((e7, i12) => !br4(e7, this.drawn[i12]))) {
      let e7 = this.dom.firstChild, i12 = 0;
      for (let n14 of t8) n14.update && e7 && n14.constructor && this.drawn[i12].constructor && n14.update(e7, this.drawn[i12]) ? (e7 = e7.nextSibling, i12++) : this.dom.insertBefore(n14.draw(), e7);
      for (; e7; ) {
        let n14 = e7.nextSibling;
        e7.remove(), e7 = n14;
      }
      this.drawn = t8;
    }
  }
  destroy() {
    this.layer.destroy && this.layer.destroy(this.dom, this.view), this.dom.remove();
  }
};
var me8 = y.define();
function Vn4(s212) {
  return [N9.define((t8) => new Mi4(t8, s212)), me8.of(s212)];
}
var Fn4 = !y9.ios;
var Dt5 = y.define({ combine(s212) {
  return at(s212, { cursorBlinkRate: 1200, drawRangeCursor: true }, { cursorBlinkRate: (t8, e7) => Math.min(t8, e7), drawRangeCursor: (t8, e7) => t8 || e7 });
} });
function Wn4(s212) {
  return s212.startState.facet(Dt5) != s212.state.facet(Dt5);
}
var yr4 = Vn4({ above: true, markers(s212) {
  let { state: t8 } = s212, e7 = t8.facet(Dt5), i12 = [];
  for (let n14 of t8.selection.ranges) {
    let o = n14 == t8.selection.main;
    if (n14.empty ? !o || Fn4 : e7.drawRangeCursor) {
      let r2 = o ? "cm-cursor cm-cursor-primary" : "cm-cursor cm-cursor-secondary", l11 = n14.empty ? n14 : x.cursor(n14.head, n14.head > n14.anchor ? -1 : 1);
      for (let h3 of Qt5.forRange(s212, r2, l11)) i12.push(h3);
    }
  }
  return i12;
}, update(s212, t8) {
  s212.transactions.some((i12) => i12.selection) && (t8.style.animationName = t8.style.animationName == "cm-blink" ? "cm-blink2" : "cm-blink");
  let e7 = Wn4(s212);
  return e7 && Ss4(s212.state, t8), s212.docChanged || s212.selectionSet || e7;
}, mount(s212, t8) {
  Ss4(t8.state, s212);
}, class: "cm-cursorLayer" });
function Ss4(s212, t8) {
  t8.style.animationDuration = s212.facet(Dt5).cursorBlinkRate + "ms";
}
var wr4 = Vn4({ above: false, markers(s212) {
  return s212.state.selection.ranges.map((t8) => t8.empty ? [] : Qt5.forRange(s212, "cm-selectionBackground", t8)).reduce((t8, e7) => t8.concat(e7));
}, update(s212, t8) {
  return s212.docChanged || s212.selectionSet || s212.viewportChanged || Wn4(s212);
}, class: "cm-selectionLayer" });
var ki4 = { ".cm-line": { "& ::selection, &::selection": { backgroundColor: "transparent !important" } }, ".cm-content": { "& :focus": { caretColor: "initial !important", "&::selection, & ::selection": { backgroundColor: "Highlight !important" } } } };
Fn4 && (ki4[".cm-line"].caretColor = ki4[".cm-content"].caretColor = "transparent !important");
var xr4 = ht.highest(A8.theme(ki4));
var zn4 = v.define({ map(s212, t8) {
  return s212 == null ? null : t8.mapPos(s212);
} });
var Ht6 = z.define({ create() {
  return null;
}, update(s212, t8) {
  return s212 != null && (s212 = t8.changes.mapPos(s212)), t8.effects.reduce((e7, i12) => i12.is(zn4) ? i12.value : e7, s212);
} });
var vr4 = N9.fromClass(class {
  constructor(s212) {
    this.view = s212, this.cursor = null, this.measureReq = { read: this.readPos.bind(this), write: this.drawCursor.bind(this) };
  }
  update(s212) {
    var t8;
    let e7 = s212.state.field(Ht6);
    e7 == null ? this.cursor != null && ((t8 = this.cursor) === null || t8 === void 0 || t8.remove(), this.cursor = null) : (this.cursor || (this.cursor = this.view.scrollDOM.appendChild(document.createElement("div")), this.cursor.className = "cm-dropCursor"), (s212.startState.field(Ht6) != e7 || s212.docChanged || s212.geometryChanged) && this.view.requestMeasure(this.measureReq));
  }
  readPos() {
    let { view: s212 } = this, t8 = s212.state.field(Ht6), e7 = t8 != null && s212.coordsAtPos(t8);
    if (!e7) return null;
    let i12 = s212.scrollDOM.getBoundingClientRect();
    return { left: e7.left - i12.left + s212.scrollDOM.scrollLeft * s212.scaleX, top: e7.top - i12.top + s212.scrollDOM.scrollTop * s212.scaleY, height: e7.bottom - e7.top };
  }
  drawCursor(s212) {
    if (this.cursor) {
      let { scaleX: t8, scaleY: e7 } = this.view;
      s212 ? (this.cursor.style.left = s212.left / t8 + "px", this.cursor.style.top = s212.top / e7 + "px", this.cursor.style.height = s212.height / e7 + "px") : this.cursor.style.left = "-100000px";
    }
  }
  destroy() {
    this.cursor && this.cursor.remove();
  }
  setDropPos(s212) {
    this.view.state.field(Ht6) != s212 && this.view.dispatch({ effects: zn4.of(s212) });
  }
}, { eventObservers: { dragover(s212) {
  this.setDropPos(this.view.posAtCoords({ x: s212.clientX, y: s212.clientY }));
}, dragleave(s212) {
  (s212.target == this.view.contentDOM || !this.view.contentDOM.contains(s212.relatedTarget)) && this.setDropPos(null);
}, dragend() {
  this.setDropPos(null);
}, drop() {
  this.setDropPos(null);
} } });
function Cs4(s212, t8, e7, i12, n14) {
  t8.lastIndex = 0;
  for (let o = s212.iterRange(e7, i12), r2 = e7, l11; !o.next().done; r2 += o.value.length) if (!o.lineBreak) for (; l11 = t8.exec(o.value); ) n14(r2 + l11.index, l11);
}
function Sr4(s212, t8) {
  let e7 = s212.visibleRanges;
  if (e7.length == 1 && e7[0].from == s212.viewport.from && e7[0].to == s212.viewport.to) return e7;
  let i12 = [];
  for (let { from: n14, to: o } of e7) n14 = Math.max(s212.state.doc.lineAt(n14).from, n14 - t8), o = Math.min(s212.state.doc.lineAt(o).to, o + t8), i12.length && i12[i12.length - 1].to >= n14 ? i12[i12.length - 1].to = o : i12.push({ from: n14, to: o });
  return i12;
}
var Jt6 = class {
  constructor(t8) {
    let { regexp: e7, decoration: i12, decorate: n14, boundary: o, maxLength: r2 = 1e3 } = t8;
    if (!e7.global) throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");
    if (this.regexp = e7, n14) this.addMatch = (l11, h3, c3, a2) => n14(a2, c3, c3 + l11[0].length, l11, h3);
    else if (typeof i12 == "function") this.addMatch = (l11, h3, c3, a2) => {
      let f6 = i12(l11, h3, c3);
      f6 && a2(c3, c3 + l11[0].length, f6);
    };
    else if (i12) this.addMatch = (l11, h3, c3, a2) => a2(c3, c3 + l11[0].length, i12);
    else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");
    this.boundary = o, this.maxLength = r2;
  }
  createDeco(t8) {
    let e7 = new re(), i12 = e7.add.bind(e7);
    for (let { from: n14, to: o } of Sr4(t8, this.maxLength)) Cs4(t8.state.doc, this.regexp, n14, o, (r2, l11) => this.addMatch(l11, t8, r2, i12));
    return e7.finish();
  }
  updateDeco(t8, e7) {
    let i12 = 1e9, n14 = -1;
    return t8.docChanged && t8.changes.iterChanges((o, r2, l11, h3) => {
      h3 > t8.view.viewport.from && l11 < t8.view.viewport.to && (i12 = Math.min(l11, i12), n14 = Math.max(h3, n14));
    }), t8.viewportChanged || n14 - i12 > 1e3 ? this.createDeco(t8.view) : n14 > -1 ? this.updateRange(t8.view, e7.map(t8.changes), i12, n14) : e7;
  }
  updateRange(t8, e7, i12, n14) {
    for (let o of t8.visibleRanges) {
      let r2 = Math.max(o.from, i12), l11 = Math.min(o.to, n14);
      if (l11 > r2) {
        let h3 = t8.state.doc.lineAt(r2), c3 = h3.to < l11 ? t8.state.doc.lineAt(l11) : h3, a2 = Math.max(o.from, h3.from), f6 = Math.min(o.to, c3.to);
        if (this.boundary) {
          for (; r2 > h3.from; r2--) if (this.boundary.test(h3.text[r2 - 1 - h3.from])) {
            a2 = r2;
            break;
          }
          for (; l11 < c3.to; l11++) if (this.boundary.test(c3.text[l11 - c3.from])) {
            f6 = l11;
            break;
          }
        }
        let d4 = [], u3, p3 = (g8, b12, m11) => d4.push(m11.range(g8, b12));
        if (h3 == c3) for (this.regexp.lastIndex = a2 - h3.from; (u3 = this.regexp.exec(h3.text)) && u3.index < f6 - h3.from; ) this.addMatch(u3, t8, u3.index + h3.from, p3);
        else Cs4(t8.state.doc, this.regexp, a2, f6, (g8, b12) => this.addMatch(b12, t8, g8, p3));
        e7 = e7.update({ filterFrom: a2, filterTo: f6, filter: (g8, b12) => g8 < a2 || b12 > f6, add: d4 });
      }
    }
    return e7;
  }
};
var Ai4 = /x/.unicode != null ? "gu" : "g";
var Cr4 = new RegExp(`[\0-\b
--ÂŸÂ­Øœâ€‹â€Žâ€\u2028\u2029â€­â€®â¦â§â©\uFEFFï¿¹-ï¿¼]`, Ai4);
var je6 = null;
function kr4() {
  var s212;
  if (je6 == null && typeof document < "u" && document.body) {
    let t8 = document.body.style;
    je6 = ((s212 = t8.tabSize) !== null && s212 !== void 0 ? s212 : t8.MozTabSize) != null;
  }
  return je6 || false;
}
var be9 = y.define({ combine(s212) {
  let t8 = at(s212, { render: null, specialChars: Cr4, addSpecialChars: null });
  return (t8.replaceTabs = !kr4()) && (t8.specialChars = new RegExp("	|" + t8.specialChars.source, Ai4)), t8.addSpecialChars && (t8.specialChars = new RegExp(t8.specialChars.source + "|" + t8.addSpecialChars.source, Ai4)), t8;
} });
var ks3 = N9.fromClass(class {
  constructor() {
    this.height = 1e3, this.attrs = { style: "padding-bottom: 1000px" };
  }
  update(s212) {
    let { view: t8 } = s212, e7 = t8.viewState.editorHeight - t8.defaultLineHeight - t8.documentPadding.top - 0.5;
    e7 >= 0 && e7 != this.height && (this.height = e7, this.attrs = { style: `padding-bottom: ${e7}px` });
  }
});
var Tr3 = O9.line({ class: "cm-activeLine" });
var Rr3 = N9.fromClass(class {
  constructor(s212) {
    this.decorations = this.getDeco(s212);
  }
  update(s212) {
    (s212.docChanged || s212.selectionSet) && (this.decorations = this.getDeco(s212.view));
  }
  getDeco(s212) {
    let t8 = -1, e7 = [];
    for (let i12 of s212.state.selection.ranges) {
      let n14 = s212.lineBlockAt(i12.head);
      n14.from > t8 && (e7.push(Tr3.range(n14.from)), t8 = n14.from);
    }
    return O9.set(e7);
  }
}, { decorations: (s212) => s212.decorations });
var Rt6 = "-10000px";
var Le7 = class {
  constructor(t8, e7, i12, n14) {
    this.facet = e7, this.createTooltipView = i12, this.removeTooltipView = n14, this.input = t8.state.facet(e7), this.tooltips = this.input.filter((r2) => r2);
    let o = null;
    this.tooltipViews = this.tooltips.map((r2) => o = i12(r2, o));
  }
  update(t8, e7) {
    var i12;
    let n14 = t8.state.facet(this.facet), o = n14.filter((h3) => h3);
    if (n14 === this.input) {
      for (let h3 of this.tooltipViews) h3.update && h3.update(t8);
      return false;
    }
    let r2 = [], l11 = e7 ? [] : null;
    for (let h3 = 0; h3 < o.length; h3++) {
      let c3 = o[h3], a2 = -1;
      if (c3) {
        for (let f6 = 0; f6 < this.tooltips.length; f6++) {
          let d4 = this.tooltips[f6];
          d4 && d4.create == c3.create && (a2 = f6);
        }
        if (a2 < 0) r2[h3] = this.createTooltipView(c3, h3 ? r2[h3 - 1] : null), l11 && (l11[h3] = !!c3.above);
        else {
          let f6 = r2[h3] = this.tooltipViews[a2];
          l11 && (l11[h3] = e7[a2]), f6.update && f6.update(t8);
        }
      }
    }
    for (let h3 of this.tooltipViews) r2.indexOf(h3) < 0 && (this.removeTooltipView(h3), (i12 = h3.destroy) === null || i12 === void 0 || i12.call(h3));
    return e7 && (l11.forEach((h3, c3) => e7[c3] = h3), e7.length = l11.length), this.input = n14, this.tooltips = o, this.tooltipViews = r2, true;
  }
};
function Nr3(s212) {
  let { win: t8 } = s212;
  return { top: 0, left: 0, bottom: t8.innerHeight, right: t8.innerWidth };
}
var ye7 = y.define({ combine: (s212) => {
  var t8, e7, i12;
  return { position: y9.ios ? "absolute" : ((t8 = s212.find((n14) => n14.position)) === null || t8 === void 0 ? void 0 : t8.position) || "fixed", parent: ((e7 = s212.find((n14) => n14.parent)) === null || e7 === void 0 ? void 0 : e7.parent) || null, tooltipSpace: ((i12 = s212.find((n14) => n14.tooltipSpace)) === null || i12 === void 0 ? void 0 : i12.tooltipSpace) || Nr3 };
} });
var Ds3 = /* @__PURE__ */ new WeakMap();
var We8 = N9.fromClass(class {
  constructor(s212) {
    this.view = s212, this.above = [], this.inView = true, this.madeAbsolute = false, this.lastTransaction = 0, this.measureTimeout = -1;
    let t8 = s212.state.facet(ye7);
    this.position = t8.position, this.parent = t8.parent, this.classes = s212.themeClasses, this.createContainer(), this.measureReq = { read: this.readMeasure.bind(this), write: this.writeMeasure.bind(this), key: this }, this.resizeObserver = typeof ResizeObserver == "function" ? new ResizeObserver(() => this.measureSoon()) : null, this.manager = new Le7(s212, In4, (e7, i12) => this.createTooltip(e7, i12), (e7) => {
      this.resizeObserver && this.resizeObserver.unobserve(e7.dom), e7.dom.remove();
    }), this.above = this.manager.tooltips.map((e7) => !!e7.above), this.intersectionObserver = typeof IntersectionObserver == "function" ? new IntersectionObserver((e7) => {
      Date.now() > this.lastTransaction - 50 && e7.length > 0 && e7[e7.length - 1].intersectionRatio < 1 && this.measureSoon();
    }, { threshold: [1] }) : null, this.observeIntersection(), s212.win.addEventListener("resize", this.measureSoon = this.measureSoon.bind(this)), this.maybeMeasure();
  }
  createContainer() {
    this.parent ? (this.container = document.createElement("div"), this.container.style.position = "relative", this.container.className = this.view.themeClasses, this.parent.appendChild(this.container)) : this.container = this.view.dom;
  }
  observeIntersection() {
    if (this.intersectionObserver) {
      this.intersectionObserver.disconnect();
      for (let s212 of this.manager.tooltipViews) this.intersectionObserver.observe(s212.dom);
    }
  }
  measureSoon() {
    this.measureTimeout < 0 && (this.measureTimeout = setTimeout(() => {
      this.measureTimeout = -1, this.maybeMeasure();
    }, 50));
  }
  update(s212) {
    s212.transactions.length && (this.lastTransaction = Date.now());
    let t8 = this.manager.update(s212, this.above);
    t8 && this.observeIntersection();
    let e7 = t8 || s212.geometryChanged, i12 = s212.state.facet(ye7);
    if (i12.position != this.position && !this.madeAbsolute) {
      this.position = i12.position;
      for (let n14 of this.manager.tooltipViews) n14.dom.style.position = this.position;
      e7 = true;
    }
    if (i12.parent != this.parent) {
      this.parent && this.container.remove(), this.parent = i12.parent, this.createContainer();
      for (let n14 of this.manager.tooltipViews) this.container.appendChild(n14.dom);
      e7 = true;
    } else this.parent && this.view.themeClasses != this.classes && (this.classes = this.container.className = this.view.themeClasses);
    e7 && this.maybeMeasure();
  }
  createTooltip(s212, t8) {
    let e7 = s212.create(this.view), i12 = t8 ? t8.dom : null;
    if (e7.dom.classList.add("cm-tooltip"), s212.arrow && !e7.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")) {
      let n14 = document.createElement("div");
      n14.className = "cm-tooltip-arrow", e7.dom.appendChild(n14);
    }
    return e7.dom.style.position = this.position, e7.dom.style.top = Rt6, e7.dom.style.left = "0px", this.container.insertBefore(e7.dom, i12), e7.mount && e7.mount(this.view), this.resizeObserver && this.resizeObserver.observe(e7.dom), e7;
  }
  destroy() {
    var s212, t8, e7;
    this.view.win.removeEventListener("resize", this.measureSoon);
    for (let i12 of this.manager.tooltipViews) i12.dom.remove(), (s212 = i12.destroy) === null || s212 === void 0 || s212.call(i12);
    this.parent && this.container.remove(), (t8 = this.resizeObserver) === null || t8 === void 0 || t8.disconnect(), (e7 = this.intersectionObserver) === null || e7 === void 0 || e7.disconnect(), clearTimeout(this.measureTimeout);
  }
  readMeasure() {
    let s212 = this.view.dom.getBoundingClientRect(), t8 = 1, e7 = 1, i12 = false;
    if (this.position == "fixed" && this.manager.tooltipViews.length) {
      let { dom: n14 } = this.manager.tooltipViews[0];
      if (y9.gecko) i12 = n14.offsetParent != this.container.ownerDocument.body;
      else if (n14.style.top == Rt6 && n14.style.left == "0px") {
        let o = n14.getBoundingClientRect();
        i12 = Math.abs(o.top + 1e4) > 1 || Math.abs(o.left) > 1;
      }
    }
    if (i12 || this.position == "absolute") if (this.parent) {
      let n14 = this.parent.getBoundingClientRect();
      n14.width && n14.height && (t8 = n14.width / this.parent.offsetWidth, e7 = n14.height / this.parent.offsetHeight);
    } else ({ scaleX: t8, scaleY: e7 } = this.view.viewState);
    return { editor: s212, parent: this.parent ? this.container.getBoundingClientRect() : s212, pos: this.manager.tooltips.map((n14, o) => {
      let r2 = this.manager.tooltipViews[o];
      return r2.getCoords ? r2.getCoords(n14.pos) : this.view.coordsAtPos(n14.pos);
    }), size: this.manager.tooltipViews.map(({ dom: n14 }) => n14.getBoundingClientRect()), space: this.view.state.facet(ye7).tooltipSpace(this.view), scaleX: t8, scaleY: e7, makeAbsolute: i12 };
  }
  writeMeasure(s212) {
    var t8;
    if (s212.makeAbsolute) {
      this.madeAbsolute = true, this.position = "absolute";
      for (let l11 of this.manager.tooltipViews) l11.dom.style.position = "absolute";
    }
    let { editor: e7, space: i12, scaleX: n14, scaleY: o } = s212, r2 = [];
    for (let l11 = 0; l11 < this.manager.tooltips.length; l11++) {
      let h3 = this.manager.tooltips[l11], c3 = this.manager.tooltipViews[l11], { dom: a2 } = c3, f6 = s212.pos[l11], d4 = s212.size[l11];
      if (!f6 || f6.bottom <= Math.max(e7.top, i12.top) || f6.top >= Math.min(e7.bottom, i12.bottom) || f6.right < Math.max(e7.left, i12.left) - 0.1 || f6.left > Math.min(e7.right, i12.right) + 0.1) {
        a2.style.top = Rt6;
        continue;
      }
      let u3 = h3.arrow ? c3.dom.querySelector(".cm-tooltip-arrow") : null, p3 = u3 ? 7 : 0, g8 = d4.right - d4.left, b12 = (t8 = Ds3.get(c3)) !== null && t8 !== void 0 ? t8 : d4.bottom - d4.top, m11 = c3.offset || Fr4, w14 = this.view.textDirection == L8.LTR, v10 = d4.width > i12.right - i12.left ? w14 ? i12.left : i12.right - d4.width : w14 ? Math.max(i12.left, Math.min(f6.left - (u3 ? 14 : 0) + m11.x, i12.right - g8)) : Math.min(Math.max(i12.left, f6.left - g8 + (u3 ? 14 : 0) - m11.x), i12.right - g8), x11 = this.above[l11];
      !h3.strictSide && (x11 ? f6.top - (d4.bottom - d4.top) - m11.y < i12.top : f6.bottom + (d4.bottom - d4.top) + m11.y > i12.bottom) && x11 == i12.bottom - f6.bottom > f6.top - i12.top && (x11 = this.above[l11] = !x11);
      let S17 = (x11 ? f6.top - i12.top : i12.bottom - f6.bottom) - p3;
      if (S17 < b12 && c3.resize !== false) {
        if (S17 < this.view.defaultLineHeight) {
          a2.style.top = Rt6;
          continue;
        }
        Ds3.set(c3, b12), a2.style.height = (b12 = S17) / o + "px";
      } else a2.style.height && (a2.style.height = "");
      let C11 = x11 ? f6.top - b12 - p3 - m11.y : f6.bottom + p3 + m11.y, E11 = v10 + g8;
      if (c3.overlap !== true) for (let B15 of r2) B15.left < E11 && B15.right > v10 && B15.top < C11 + b12 && B15.bottom > C11 && (C11 = x11 ? B15.top - b12 - 2 - p3 : B15.bottom + p3 + 2);
      if (this.position == "absolute" ? (a2.style.top = (C11 - s212.parent.top) / o + "px", a2.style.left = (v10 - s212.parent.left) / n14 + "px") : (a2.style.top = C11 / o + "px", a2.style.left = v10 / n14 + "px"), u3) {
        let B15 = f6.left + (w14 ? m11.x : -m11.x) - (v10 + 14 - 7);
        u3.style.left = B15 / n14 + "px";
      }
      c3.overlap !== true && r2.push({ left: v10, top: C11, right: E11, bottom: C11 + b12 }), a2.classList.toggle("cm-tooltip-above", x11), a2.classList.toggle("cm-tooltip-below", !x11), c3.positioned && c3.positioned(s212.space);
    }
  }
  maybeMeasure() {
    if (this.manager.tooltips.length && (this.view.inView && this.view.requestMeasure(this.measureReq), this.inView != this.view.inView && (this.inView = this.view.inView, !this.inView))) for (let s212 of this.manager.tooltipViews) s212.dom.style.top = Rt6;
  }
}, { eventObservers: { scroll() {
  this.maybeMeasure();
} } });
var Vr3 = A8.baseTheme({ ".cm-tooltip": { zIndex: 100, boxSizing: "border-box" }, "&light .cm-tooltip": { border: "1px solid #bbb", backgroundColor: "#f5f5f5" }, "&light .cm-tooltip-section:not(:first-child)": { borderTop: "1px solid #bbb" }, "&dark .cm-tooltip": { backgroundColor: "#333338", color: "white" }, ".cm-tooltip-arrow": { height: "7px", width: `${7 * 2}px`, position: "absolute", zIndex: -1, overflow: "hidden", "&:before, &:after": { content: "''", position: "absolute", width: 0, height: 0, borderLeft: "7px solid transparent", borderRight: "7px solid transparent" }, ".cm-tooltip-above &": { bottom: "-7px", "&:before": { borderTop: "7px solid #bbb" }, "&:after": { borderTop: "7px solid #f5f5f5", bottom: "1px" } }, ".cm-tooltip-below &": { top: "-7px", "&:before": { borderBottom: "7px solid #bbb" }, "&:after": { borderBottom: "7px solid #f5f5f5", top: "1px" } } }, "&dark .cm-tooltip .cm-tooltip-arrow": { "&:before": { borderTopColor: "#333338", borderBottomColor: "#333338" }, "&:after": { borderTopColor: "transparent", borderBottomColor: "transparent" } } });
var Fr4 = { x: 0, y: 0 };
var In4 = y.define({ enables: [We8, Vr3] });
var Zt6 = y.define({ combine: (s212) => s212.reduce((t8, e7) => t8.concat(e7), []) });
var Be8 = class s140 {
  static create(t8) {
    return new s140(t8);
  }
  constructor(t8) {
    this.view = t8, this.mounted = false, this.dom = document.createElement("div"), this.dom.classList.add("cm-tooltip-hover"), this.manager = new Le7(t8, Zt6, (e7, i12) => this.createHostedView(e7, i12), (e7) => e7.dom.remove());
  }
  createHostedView(t8, e7) {
    let i12 = t8.create(this.view);
    return i12.dom.classList.add("cm-tooltip-section"), this.dom.insertBefore(i12.dom, e7 ? e7.dom.nextSibling : this.dom.firstChild), this.mounted && i12.mount && i12.mount(this.view), i12;
  }
  mount(t8) {
    for (let e7 of this.manager.tooltipViews) e7.mount && e7.mount(t8);
    this.mounted = true;
  }
  positioned(t8) {
    for (let e7 of this.manager.tooltipViews) e7.positioned && e7.positioned(t8);
  }
  update(t8) {
    this.manager.update(t8);
  }
  destroy() {
    var t8;
    for (let e7 of this.manager.tooltipViews) (t8 = e7.destroy) === null || t8 === void 0 || t8.call(e7);
  }
  passProp(t8) {
    let e7;
    for (let i12 of this.manager.tooltipViews) {
      let n14 = i12[t8];
      if (n14 !== void 0) {
        if (e7 === void 0) e7 = n14;
        else if (e7 !== n14) return;
      }
    }
    return e7;
  }
  get offset() {
    return this.passProp("offset");
  }
  get getCoords() {
    return this.passProp("getCoords");
  }
  get overlap() {
    return this.passProp("overlap");
  }
  get resize() {
    return this.passProp("resize");
  }
};
var Wr4 = In4.compute([Zt6], (s212) => {
  let t8 = s212.facet(Zt6);
  return t8.length === 0 ? null : { pos: Math.min(...t8.map((e7) => e7.pos)), end: Math.max(...t8.map((e7) => {
    var i12;
    return (i12 = e7.end) !== null && i12 !== void 0 ? i12 : e7.pos;
  })), create: Be8.create, above: t8[0].above, arrow: t8.some((e7) => e7.arrow) };
});
function bl(s212, t8) {
  let e7 = s212.plugin(We8);
  if (!e7) return null;
  let i12 = e7.manager.tooltips.indexOf(t8);
  return i12 < 0 ? null : e7.manager.tooltipViews[i12];
}
var Kn4 = v.define();
var wl3 = Kn4.of(null);
var Li4 = y.define({ combine(s212) {
  let t8, e7;
  for (let i12 of s212) t8 = t8 || i12.topContainer, e7 = e7 || i12.bottomContainer;
  return { topContainer: t8, bottomContainer: e7 };
} });
var qn4 = N9.fromClass(class {
  constructor(s212) {
    this.input = s212.state.facet(Ts4), this.specs = this.input.filter((e7) => e7), this.panels = this.specs.map((e7) => e7(s212));
    let t8 = s212.state.facet(Li4);
    this.top = new vt5(s212, true, t8.topContainer), this.bottom = new vt5(s212, false, t8.bottomContainer), this.top.sync(this.panels.filter((e7) => e7.top)), this.bottom.sync(this.panels.filter((e7) => !e7.top));
    for (let e7 of this.panels) e7.dom.classList.add("cm-panel"), e7.mount && e7.mount();
  }
  update(s212) {
    let t8 = s212.state.facet(Li4);
    this.top.container != t8.topContainer && (this.top.sync([]), this.top = new vt5(s212.view, true, t8.topContainer)), this.bottom.container != t8.bottomContainer && (this.bottom.sync([]), this.bottom = new vt5(s212.view, false, t8.bottomContainer)), this.top.syncClasses(), this.bottom.syncClasses();
    let e7 = s212.state.facet(Ts4);
    if (e7 != this.input) {
      let i12 = e7.filter((h3) => h3), n14 = [], o = [], r2 = [], l11 = [];
      for (let h3 of i12) {
        let c3 = this.specs.indexOf(h3), a2;
        c3 < 0 ? (a2 = h3(s212.view), l11.push(a2)) : (a2 = this.panels[c3], a2.update && a2.update(s212)), n14.push(a2), (a2.top ? o : r2).push(a2);
      }
      this.specs = i12, this.panels = n14, this.top.sync(o), this.bottom.sync(r2);
      for (let h3 of l11) h3.dom.classList.add("cm-panel"), h3.mount && h3.mount();
    } else for (let i12 of this.panels) i12.update && i12.update(s212);
  }
  destroy() {
    this.top.sync([]), this.bottom.sync([]);
  }
}, { provide: (s212) => A8.scrollMargins.of((t8) => {
  let e7 = t8.plugin(s212);
  return e7 && { top: e7.top.scrollMargin(), bottom: e7.bottom.scrollMargin() };
}) });
var vt5 = class {
  constructor(t8, e7, i12) {
    this.view = t8, this.top = e7, this.container = i12, this.dom = void 0, this.classes = "", this.panels = [], this.syncClasses();
  }
  sync(t8) {
    for (let e7 of this.panels) e7.destroy && t8.indexOf(e7) < 0 && e7.destroy();
    this.panels = t8, this.syncDOM();
  }
  syncDOM() {
    if (this.panels.length == 0) {
      this.dom && (this.dom.remove(), this.dom = void 0);
      return;
    }
    if (!this.dom) {
      this.dom = document.createElement("div"), this.dom.className = this.top ? "cm-panels cm-panels-top" : "cm-panels cm-panels-bottom", this.dom.style[this.top ? "top" : "bottom"] = "0";
      let e7 = this.container || this.view.dom;
      e7.insertBefore(this.dom, this.top ? e7.firstChild : null);
    }
    let t8 = this.dom.firstChild;
    for (let e7 of this.panels) if (e7.dom.parentNode == this.dom) {
      for (; t8 != e7.dom; ) t8 = Os4(t8);
      t8 = t8.nextSibling;
    } else this.dom.insertBefore(e7.dom, t8);
    for (; t8; ) t8 = Os4(t8);
  }
  scrollMargin() {
    return !this.dom || this.container ? 0 : Math.max(0, this.top ? this.dom.getBoundingClientRect().bottom - Math.max(0, this.view.scrollDOM.getBoundingClientRect().top) : Math.min(innerHeight, this.view.scrollDOM.getBoundingClientRect().bottom) - this.dom.getBoundingClientRect().top);
  }
  syncClasses() {
    if (!(!this.container || this.classes == this.view.themeClasses)) {
      for (let t8 of this.classes.split(" ")) t8 && this.container.classList.remove(t8);
      for (let t8 of (this.classes = this.view.themeClasses).split(" ")) t8 && this.container.classList.add(t8);
    }
  }
};
function Os4(s212) {
  let t8 = s212.nextSibling;
  return s212.remove(), t8;
}
var Ts4 = y.define({ enables: qn4 });
var J7 = class extends W {
  compare(t8) {
    return this == t8 || this.constructor == t8.constructor && this.eq(t8);
  }
  eq(t8) {
    return false;
  }
  destroy(t8) {
  }
};
J7.prototype.elementClass = "";
J7.prototype.toDOM = void 0;
J7.prototype.mapMode = E.TrackBefore;
J7.prototype.startSide = J7.prototype.endSide = -1;
J7.prototype.point = true;
var we9 = y.define();
var Kr3 = y.define();
var Kt6 = y.define();
var Bi4 = y.define({ combine: (s212) => s212.some((t8) => t8) });
var jr4 = N9.fromClass(class {
  constructor(s212) {
    this.view = s212, this.prevViewport = s212.viewport, this.dom = document.createElement("div"), this.dom.className = "cm-gutters", this.dom.setAttribute("aria-hidden", "true"), this.dom.style.minHeight = this.view.contentHeight / this.view.scaleY + "px", this.gutters = s212.state.facet(Kt6).map((t8) => new Pe9(s212, t8));
    for (let t8 of this.gutters) this.dom.appendChild(t8.dom);
    this.fixed = !s212.state.facet(Bi4), this.fixed && (this.dom.style.position = "sticky"), this.syncGutters(false), s212.scrollDOM.insertBefore(this.dom, s212.contentDOM);
  }
  update(s212) {
    if (this.updateGutters(s212)) {
      let t8 = this.prevViewport, e7 = s212.view.viewport, i12 = Math.min(t8.to, e7.to) - Math.max(t8.from, e7.from);
      this.syncGutters(i12 < (e7.to - e7.from) * 0.8);
    }
    s212.geometryChanged && (this.dom.style.minHeight = this.view.contentHeight / this.view.scaleY + "px"), this.view.state.facet(Bi4) != !this.fixed && (this.fixed = !this.fixed, this.dom.style.position = this.fixed ? "sticky" : ""), this.prevViewport = s212.view.viewport;
  }
  syncGutters(s212) {
    let t8 = this.dom.nextSibling;
    s212 && this.dom.remove();
    let e7 = T.iter(this.view.state.facet(we9), this.view.viewport.from), i12 = [], n14 = this.gutters.map((o) => new Hi4(o, this.view.viewport, -this.view.documentPadding.top));
    for (let o of this.view.viewportLineBlocks) if (i12.length && (i12 = []), Array.isArray(o.type)) {
      let r2 = true;
      for (let l11 of o.type) if (l11.type == F10.Text && r2) {
        Pi4(e7, i12, l11.from);
        for (let h3 of n14) h3.line(this.view, l11, i12);
        r2 = false;
      } else if (l11.widget) for (let h3 of n14) h3.widget(this.view, l11);
    } else if (o.type == F10.Text) {
      Pi4(e7, i12, o.from);
      for (let r2 of n14) r2.line(this.view, o, i12);
    } else if (o.widget) for (let r2 of n14) r2.widget(this.view, o);
    for (let o of n14) o.finish();
    s212 && this.view.scrollDOM.insertBefore(this.dom, t8);
  }
  updateGutters(s212) {
    let t8 = s212.startState.facet(Kt6), e7 = s212.state.facet(Kt6), i12 = s212.docChanged || s212.heightChanged || s212.viewportChanged || !T.eq(s212.startState.facet(we9), s212.state.facet(we9), s212.view.viewport.from, s212.view.viewport.to);
    if (t8 == e7) for (let n14 of this.gutters) n14.update(s212) && (i12 = true);
    else {
      i12 = true;
      let n14 = [];
      for (let o of e7) {
        let r2 = t8.indexOf(o);
        r2 < 0 ? n14.push(new Pe9(this.view, o)) : (this.gutters[r2].update(s212), n14.push(this.gutters[r2]));
      }
      for (let o of this.gutters) o.dom.remove(), n14.indexOf(o) < 0 && o.destroy();
      for (let o of n14) this.dom.appendChild(o.dom);
      this.gutters = n14;
    }
    return i12;
  }
  destroy() {
    for (let s212 of this.gutters) s212.destroy();
    this.dom.remove();
  }
}, { provide: (s212) => A8.scrollMargins.of((t8) => {
  let e7 = t8.plugin(s212);
  return !e7 || e7.gutters.length == 0 || !e7.fixed ? null : t8.textDirection == L8.LTR ? { left: e7.dom.offsetWidth * t8.scaleX } : { right: e7.dom.offsetWidth * t8.scaleX };
}) });
function Rs4(s212) {
  return Array.isArray(s212) ? s212 : [s212];
}
function Pi4(s212, t8, e7) {
  for (; s212.value && s212.from <= e7; ) s212.from == e7 && t8.push(s212.value), s212.next();
}
var Hi4 = class {
  constructor(t8, e7, i12) {
    this.gutter = t8, this.height = i12, this.i = 0, this.cursor = T.iter(t8.markers, e7.from);
  }
  addElement(t8, e7, i12) {
    let { gutter: n14 } = this, o = (e7.top - this.height) / t8.scaleY, r2 = e7.height / t8.scaleY;
    if (this.i == n14.elements.length) {
      let l11 = new He6(t8, r2, o, i12);
      n14.elements.push(l11), n14.dom.appendChild(l11.dom);
    } else n14.elements[this.i].update(t8, r2, o, i12);
    this.height = e7.bottom, this.i++;
  }
  line(t8, e7, i12) {
    let n14 = [];
    Pi4(this.cursor, n14, e7.from), i12.length && (n14 = n14.concat(i12));
    let o = this.gutter.config.lineMarker(t8, e7, n14);
    o && n14.unshift(o);
    let r2 = this.gutter;
    n14.length == 0 && !r2.config.renderEmptyElements || this.addElement(t8, e7, n14);
  }
  widget(t8, e7) {
    let i12 = this.gutter.config.widgetMarker(t8, e7.widget, e7), n14 = i12 ? [i12] : null;
    for (let o of t8.state.facet(Kr3)) {
      let r2 = o(t8, e7.widget, e7);
      r2 && (n14 || (n14 = [])).push(r2);
    }
    n14 && this.addElement(t8, e7, n14);
  }
  finish() {
    let t8 = this.gutter;
    for (; t8.elements.length > this.i; ) {
      let e7 = t8.elements.pop();
      t8.dom.removeChild(e7.dom), e7.destroy();
    }
  }
};
var Pe9 = class {
  constructor(t8, e7) {
    this.view = t8, this.config = e7, this.elements = [], this.spacer = null, this.dom = document.createElement("div"), this.dom.className = "cm-gutter" + (this.config.class ? " " + this.config.class : "");
    for (let i12 in e7.domEventHandlers) this.dom.addEventListener(i12, (n14) => {
      let o = n14.target, r2;
      if (o != this.dom && this.dom.contains(o)) {
        for (; o.parentNode != this.dom; ) o = o.parentNode;
        let h3 = o.getBoundingClientRect();
        r2 = (h3.top + h3.bottom) / 2;
      } else r2 = n14.clientY;
      let l11 = t8.lineBlockAtHeight(r2 - t8.documentTop);
      e7.domEventHandlers[i12](t8, l11, n14) && n14.preventDefault();
    });
    this.markers = Rs4(e7.markers(t8)), e7.initialSpacer && (this.spacer = new He6(t8, 0, 0, [e7.initialSpacer(t8)]), this.dom.appendChild(this.spacer.dom), this.spacer.dom.style.cssText += "visibility: hidden; pointer-events: none");
  }
  update(t8) {
    let e7 = this.markers;
    if (this.markers = Rs4(this.config.markers(t8.view)), this.spacer && this.config.updateSpacer) {
      let n14 = this.config.updateSpacer(this.spacer.markers[0], t8);
      n14 != this.spacer.markers[0] && this.spacer.update(t8.view, 0, 0, [n14]);
    }
    let i12 = t8.view.viewport;
    return !T.eq(this.markers, e7, i12.from, i12.to) || (this.config.lineMarkerChange ? this.config.lineMarkerChange(t8) : false);
  }
  destroy() {
    for (let t8 of this.elements) t8.destroy();
  }
};
var He6 = class {
  constructor(t8, e7, i12, n14) {
    this.height = -1, this.above = 0, this.markers = [], this.dom = document.createElement("div"), this.dom.className = "cm-gutterElement", this.update(t8, e7, i12, n14);
  }
  update(t8, e7, i12, n14) {
    this.height != e7 && (this.height = e7, this.dom.style.height = e7 + "px"), this.above != i12 && (this.dom.style.marginTop = (this.above = i12) ? i12 + "px" : ""), Yr3(this.markers, n14) || this.setMarkers(t8, n14);
  }
  setMarkers(t8, e7) {
    let i12 = "cm-gutterElement", n14 = this.dom.firstChild;
    for (let o = 0, r2 = 0; ; ) {
      let l11 = r2, h3 = o < e7.length ? e7[o++] : null, c3 = false;
      if (h3) {
        let a2 = h3.elementClass;
        a2 && (i12 += " " + a2);
        for (let f6 = r2; f6 < this.markers.length; f6++) if (this.markers[f6].compare(h3)) {
          l11 = f6, c3 = true;
          break;
        }
      } else l11 = this.markers.length;
      for (; r2 < l11; ) {
        let a2 = this.markers[r2++];
        if (a2.toDOM) {
          a2.destroy(n14);
          let f6 = n14.nextSibling;
          n14.remove(), n14 = f6;
        }
      }
      if (!h3) break;
      h3.toDOM && (c3 ? n14 = n14.nextSibling : this.dom.insertBefore(h3.toDOM(t8), n14)), c3 && r2++;
    }
    this.dom.className = i12, this.markers = e7;
  }
  destroy() {
    this.setMarkers(null, []);
  }
};
function Yr3(s212, t8) {
  if (s212.length != t8.length) return false;
  for (let e7 = 0; e7 < s212.length; e7++) if (!s212[e7].compare(t8[e7])) return false;
  return true;
}
var _r4 = y.define();
var Xr4 = y.define();
var St5 = y.define({ combine(s212) {
  return at(s212, { formatNumber: String, domEventHandlers: {} }, { domEventHandlers(t8, e7) {
    let i12 = Object.assign({}, t8);
    for (let n14 in e7) {
      let o = i12[n14], r2 = e7[n14];
      i12[n14] = o ? (l11, h3, c3) => o(l11, h3, c3) || r2(l11, h3, c3) : r2;
    }
    return i12;
  } });
} });
var qt5 = class extends J7 {
  constructor(t8) {
    super(), this.number = t8;
  }
  eq(t8) {
    return this.number == t8.number;
  }
  toDOM() {
    return document.createTextNode(this.number);
  }
};
function Ye7(s212, t8) {
  return s212.state.facet(St5).formatNumber(t8, s212.state);
}
var Gr4 = Kt6.compute([St5], (s212) => ({ class: "cm-lineNumbers", renderEmptyElements: false, markers(t8) {
  return t8.state.facet(_r4);
}, lineMarker(t8, e7, i12) {
  return i12.some((n14) => n14.toDOM) ? null : new qt5(Ye7(t8, t8.state.doc.lineAt(e7.from).number));
}, widgetMarker: (t8, e7, i12) => {
  for (let n14 of t8.state.facet(Xr4)) {
    let o = n14(t8, e7, i12);
    if (o) return o;
  }
  return null;
}, lineMarkerChange: (t8) => t8.startState.facet(St5) != t8.state.facet(St5), initialSpacer(t8) {
  return new qt5(Ye7(t8, Es4(t8.state.doc.lines)));
}, updateSpacer(t8, e7) {
  let i12 = Ye7(e7.view, Es4(e7.view.state.doc.lines));
  return i12 == t8.number ? t8 : new qt5(i12);
}, domEventHandlers: s212.facet(St5).domEventHandlers }));
function Es4(s212) {
  let t8 = 9;
  for (; t8 < s212; ) t8 = t8 * 10 + 9;
  return t8;
}
var $r4 = new class extends J7 {
  constructor() {
    super(...arguments), this.elementClass = "cm-activeLineGutter";
  }
}();
var Ur4 = we9.compute(["selection"], (s212) => {
  let t8 = [], e7 = -1;
  for (let i12 of s212.selection.ranges) {
    let n14 = s212.doc.lineAt(i12.head).from;
    n14 > e7 && (e7 = n14, t8.push($r4.range(n14)));
  }
  return T.of(t8);
});
function Yn3(s212) {
  return N9.define((t8) => ({ decorations: s212.createDeco(t8), update(e7) {
    this.decorations = s212.updateDeco(e7, this.decorations);
  } }), { decorations: (t8) => t8.decorations });
}
var Qr4 = O9.mark({ class: "cm-highlightTab" });
var Jr4 = O9.mark({ class: "cm-highlightSpace" });
var Zr4 = Yn3(new Jt6({ regexp: /\t| /g, decoration: (s212) => s212[0] == "	" ? Qr4 : Jr4, boundary: /\S/ }));
var tl4 = Yn3(new Jt6({ regexp: /\s+$/g, decoration: O9.mark({ class: "cm-trailingSpace" }), boundary: /\S/ }));

// https://esm.sh/v135/@codemirror/autocomplete@6.18.3/denonext/autocomplete.mjs
var W9 = class {
  constructor(e7, t8, n14, s212) {
    this.state = e7, this.pos = t8, this.explicit = n14, this.view = s212, this.abortListeners = [], this.abortOnDocChange = false;
  }
  tokenBefore(e7) {
    let t8 = k3(this.state).resolveInner(this.pos, -1);
    for (; t8 && e7.indexOf(t8.name) < 0; ) t8 = t8.parent;
    return t8 ? { from: t8.from, to: this.pos, text: this.state.sliceDoc(t8.from, this.pos), type: t8.type } : null;
  }
  matchBefore(e7) {
    let t8 = this.state.doc.lineAt(this.pos), n14 = Math.max(t8.from, this.pos - 250), s212 = t8.text.slice(n14 - t8.from, this.pos - t8.from), o = s212.search(Le8(e7, false));
    return o < 0 ? null : { from: n14 + o, to: this.pos, text: s212.slice(o) };
  }
  get aborted() {
    return this.abortListeners == null;
  }
  addEventListener(e7, t8, n14) {
    e7 == "abort" && this.abortListeners && (this.abortListeners.push(t8), n14 && n14.onDocChange && (this.abortOnDocChange = true));
  }
};
function me9(i12) {
  let e7 = Object.keys(i12).join(""), t8 = /\w/.test(e7);
  return t8 && (e7 = e7.replace(/\w/g, "")), `[${t8 ? "\\w" : ""}${e7.replace(/[^\w\s]/g, "\\$&")}]`;
}
function Ze8(i12) {
  let e7 = /* @__PURE__ */ Object.create(null), t8 = /* @__PURE__ */ Object.create(null);
  for (let { label: s212 } of i12) {
    e7[s212[0]] = true;
    for (let o = 1; o < s212.length; o++) t8[s212[o]] = true;
  }
  let n14 = me9(e7) + me9(t8) + "*$";
  return [new RegExp("^" + n14), new RegExp(n14)];
}
function _e5(i12) {
  let e7 = i12.map((s212) => typeof s212 == "string" ? { label: s212 } : s212), [t8, n14] = e7.every((s212) => /^\w+$/.test(s212.label)) ? [/\w*$/, /\w+$/] : Ze8(e7);
  return (s212) => {
    let o = s212.matchBefore(n14);
    return o || s212.explicit ? { from: o ? o.from : s212.pos, options: e7, validFor: t8 } : null;
  };
}
var N10 = class {
  constructor(e7, t8, n14, s212) {
    this.completion = e7, this.source = t8, this.match = n14, this.score = s212;
  }
};
function A9(i12) {
  return i12.selection.main.from;
}
function Le8(i12, e7) {
  var t8;
  let { source: n14 } = i12, s212 = e7 && n14[0] != "^", o = n14[n14.length - 1] != "$";
  return !s212 && !o ? i12 : new RegExp(`${s212 ? "^" : ""}(?:${n14})${o ? "$" : ""}`, (t8 = i12.flags) !== null && t8 !== void 0 ? t8 : i12.ignoreCase ? "i" : "");
}
var ce10 = J.define();
function et4(i12, e7, t8, n14) {
  let { main: s212 } = i12.selection, o = t8 - s212.from, l11 = n14 - s212.from;
  return Object.assign(Object.assign({}, i12.changeByRange((a2) => {
    if (a2 != s212 && t8 != n14 && i12.sliceDoc(a2.from + o, a2.from + l11) != i12.sliceDoc(t8, n14)) return { range: a2 };
    let r2 = i12.toText(e7);
    return { changes: { from: a2.from + o, to: n14 == s212.from ? a2.to : a2.from + l11, insert: r2 }, range: x.cursor(a2.from + o + r2.length) };
  })), { scrollIntoView: true, userEvent: "input.complete" });
}
var ge10 = /* @__PURE__ */ new WeakMap();
function tt4(i12) {
  if (!Array.isArray(i12)) return i12;
  let e7 = ge10.get(i12);
  return e7 || ge10.set(i12, e7 = _e5(i12)), e7;
}
var U11 = v.define();
var M4 = v.define();
var Z7 = class {
  constructor(e7) {
    this.pattern = e7, this.chars = [], this.folded = [], this.any = [], this.precise = [], this.byWord = [], this.score = 0, this.matched = [];
    for (let t8 = 0; t8 < e7.length; ) {
      let n14 = ae(e7, t8), s212 = Oe(n14);
      this.chars.push(n14);
      let o = e7.slice(t8, t8 + s212), l11 = o.toUpperCase();
      this.folded.push(ae(l11 == o ? o.toLowerCase() : l11, 0)), t8 += s212;
    }
    this.astral = e7.length != this.chars.length;
  }
  ret(e7, t8) {
    return this.score = e7, this.matched = t8, this;
  }
  match(e7) {
    if (this.pattern.length == 0) return this.ret(-100, []);
    if (e7.length < this.pattern.length) return null;
    let { chars: t8, folded: n14, any: s212, precise: o, byWord: l11 } = this;
    if (t8.length == 1) {
      let d4 = ae(e7, 0), D14 = Oe(d4), C11 = D14 == e7.length ? 0 : -100;
      if (d4 != t8[0]) if (d4 == n14[0]) C11 += -200;
      else return null;
      return this.ret(C11, [0, D14]);
    }
    let a2 = e7.indexOf(this.pattern);
    if (a2 == 0) return this.ret(e7.length == this.pattern.length ? 0 : -100, [0, this.pattern.length]);
    let r2 = t8.length, f6 = 0;
    if (a2 < 0) {
      for (let d4 = 0, D14 = Math.min(e7.length, 200); d4 < D14 && f6 < r2; ) {
        let C11 = ae(e7, d4);
        (C11 == t8[f6] || C11 == n14[f6]) && (s212[f6++] = d4), d4 += Oe(C11);
      }
      if (f6 < r2) return null;
    }
    let c3 = 0, h3 = 0, u3 = false, p3 = 0, b12 = -1, v10 = -1, K16 = /[a-z]/.test(e7), L19 = true;
    for (let d4 = 0, D14 = Math.min(e7.length, 200), C11 = 0; d4 < D14 && h3 < r2; ) {
      let y18 = ae(e7, d4);
      a2 < 0 && (c3 < r2 && y18 == t8[c3] && (o[c3++] = d4), p3 < r2 && (y18 == t8[p3] || y18 == n14[p3] ? (p3 == 0 && (b12 = d4), v10 = d4 + 1, p3++) : p3 = 0));
      let $18, z22 = y18 < 255 ? y18 >= 48 && y18 <= 57 || y18 >= 97 && y18 <= 122 ? 2 : y18 >= 65 && y18 <= 90 ? 1 : 0 : ($18 = lt(y18)) != $18.toLowerCase() ? 1 : $18 != $18.toUpperCase() ? 2 : 0;
      (!d4 || z22 == 1 && K16 || C11 == 0 && z22 != 0) && (t8[h3] == y18 || n14[h3] == y18 && (u3 = true) ? l11[h3++] = d4 : l11.length && (L19 = false)), C11 = z22, d4 += Oe(y18);
    }
    return h3 == r2 && l11[0] == 0 && L19 ? this.result(-100 + (u3 ? -200 : 0), l11, e7) : p3 == r2 && b12 == 0 ? this.ret(-200 - e7.length + (v10 == e7.length ? 0 : -100), [0, v10]) : a2 > -1 ? this.ret(-700 - e7.length, [a2, a2 + this.pattern.length]) : p3 == r2 ? this.ret(-900 - e7.length, [b12, v10]) : h3 == r2 ? this.result(-100 + (u3 ? -200 : 0) + -700 + (L19 ? 0 : -1100), l11, e7) : t8.length == 2 ? null : this.result((s212[0] ? -700 : 0) + -200 + -1100, s212, e7);
  }
  result(e7, t8, n14) {
    let s212 = [], o = 0;
    for (let l11 of t8) {
      let a2 = l11 + (this.astral ? Oe(ae(n14, l11)) : 1);
      o && s212[o - 1] == l11 ? s212[o - 1] = a2 : (s212[o++] = l11, s212[o++] = a2);
    }
    return this.ret(e7 - n14.length, s212);
  }
};
var _9 = class {
  constructor(e7) {
    this.pattern = e7, this.matched = [], this.score = 0, this.folded = e7.toLowerCase();
  }
  match(e7) {
    if (e7.length < this.pattern.length) return null;
    let t8 = e7.slice(0, this.pattern.length), n14 = t8 == this.pattern ? 0 : t8.toLowerCase() == this.folded ? -200 : null;
    return n14 == null ? null : (this.matched = [0, t8.length], this.score = n14 + (e7.length == this.pattern.length ? 0 : -100), this);
  }
};
var g3 = y.define({ combine(i12) {
  return at(i12, { activateOnTyping: true, activateOnCompletion: () => false, activateOnTypingDelay: 100, selectOnOpen: true, override: null, closeOnBlur: true, maxRenderedOptions: 100, defaultKeymap: true, tooltipClass: () => "", optionClass: () => "", aboveCursor: false, icons: true, addToOptions: [], positionInfo: it4, filterStrict: false, compareCompletions: (e7, t8) => e7.label.localeCompare(t8.label), interactionDelay: 75, updateSyncTime: 100 }, { defaultKeymap: (e7, t8) => e7 && t8, closeOnBlur: (e7, t8) => e7 && t8, icons: (e7, t8) => e7 && t8, tooltipClass: (e7, t8) => (n14) => be10(e7(n14), t8(n14)), optionClass: (e7, t8) => (n14) => be10(e7(n14), t8(n14)), addToOptions: (e7, t8) => e7.concat(t8), filterStrict: (e7, t8) => e7 || t8 });
} });
function be10(i12, e7) {
  return i12 ? e7 ? i12 + " " + e7 : i12 : e7;
}
function it4(i12, e7, t8, n14, s212, o) {
  let l11 = i12.textDirection == L8.RTL, a2 = l11, r2 = false, f6 = "top", c3, h3, u3 = e7.left - s212.left, p3 = s212.right - e7.right, b12 = n14.right - n14.left, v10 = n14.bottom - n14.top;
  if (a2 && u3 < Math.min(b12, p3) ? a2 = false : !a2 && p3 < Math.min(b12, u3) && (a2 = true), b12 <= (a2 ? u3 : p3)) c3 = Math.max(s212.top, Math.min(t8.top, s212.bottom - v10)) - e7.top, h3 = Math.min(400, a2 ? u3 : p3);
  else {
    r2 = true, h3 = Math.min(400, (l11 ? e7.right : s212.right - e7.left) - 30);
    let d4 = s212.bottom - e7.bottom;
    d4 >= v10 || d4 > e7.top ? c3 = t8.bottom - e7.top : (f6 = "bottom", c3 = e7.bottom - t8.top);
  }
  let K16 = (e7.bottom - e7.top) / o.offsetHeight, L19 = (e7.right - e7.left) / o.offsetWidth;
  return { style: `${f6}: ${c3 / K16}px; max-width: ${h3 / L19}px`, class: "cm-completionInfo-" + (r2 ? l11 ? "left-narrow" : "right-narrow" : a2 ? "left" : "right") };
}
function nt7(i12) {
  let e7 = i12.addToOptions.slice();
  return i12.icons && e7.push({ render(t8) {
    let n14 = document.createElement("div");
    return n14.classList.add("cm-completionIcon"), t8.type && n14.classList.add(...t8.type.split(/\s+/g).map((s212) => "cm-completionIcon-" + s212)), n14.setAttribute("aria-hidden", "true"), n14;
  }, position: 20 }), e7.push({ render(t8, n14, s212, o) {
    let l11 = document.createElement("span");
    l11.className = "cm-completionLabel";
    let a2 = t8.displayLabel || t8.label, r2 = 0;
    for (let f6 = 0; f6 < o.length; ) {
      let c3 = o[f6++], h3 = o[f6++];
      c3 > r2 && l11.appendChild(document.createTextNode(a2.slice(r2, c3)));
      let u3 = l11.appendChild(document.createElement("span"));
      u3.appendChild(document.createTextNode(a2.slice(c3, h3))), u3.className = "cm-completionMatchedText", r2 = h3;
    }
    return r2 < a2.length && l11.appendChild(document.createTextNode(a2.slice(r2))), l11;
  }, position: 50 }, { render(t8) {
    if (!t8.detail) return null;
    let n14 = document.createElement("span");
    return n14.className = "cm-completionDetail", n14.textContent = t8.detail, n14;
  }, position: 80 }), e7.sort((t8, n14) => t8.position - n14.position).map((t8) => t8.render);
}
function Q10(i12, e7, t8) {
  if (i12 <= t8) return { from: 0, to: i12 };
  if (e7 < 0 && (e7 = 0), e7 <= i12 >> 1) {
    let s212 = Math.floor(e7 / t8);
    return { from: s212 * t8, to: (s212 + 1) * t8 };
  }
  let n14 = Math.floor((i12 - e7) / t8);
  return { from: i12 - (n14 + 1) * t8, to: i12 - n14 * t8 };
}
var ee6 = class {
  constructor(e7, t8, n14) {
    this.view = e7, this.stateField = t8, this.applyCompletion = n14, this.info = null, this.infoDestroy = null, this.placeInfoReq = { read: () => this.measureInfo(), write: (r2) => this.placeInfo(r2), key: this }, this.space = null, this.currentClass = "";
    let s212 = e7.state.field(t8), { options: o, selected: l11 } = s212.open, a2 = e7.state.facet(g3);
    this.optionContent = nt7(a2), this.optionClass = a2.optionClass, this.tooltipClass = a2.tooltipClass, this.range = Q10(o.length, l11, a2.maxRenderedOptions), this.dom = document.createElement("div"), this.dom.className = "cm-tooltip-autocomplete", this.updateTooltipClass(e7.state), this.dom.addEventListener("mousedown", (r2) => {
      let { options: f6 } = e7.state.field(t8).open;
      for (let c3 = r2.target, h3; c3 && c3 != this.dom; c3 = c3.parentNode) if (c3.nodeName == "LI" && (h3 = /-(\d+)$/.exec(c3.id)) && +h3[1] < f6.length) {
        this.applyCompletion(e7, f6[+h3[1]]), r2.preventDefault();
        return;
      }
    }), this.dom.addEventListener("focusout", (r2) => {
      let f6 = e7.state.field(this.stateField, false);
      f6 && f6.tooltip && e7.state.facet(g3).closeOnBlur && r2.relatedTarget != e7.contentDOM && e7.dispatch({ effects: M4.of(null) });
    }), this.showOptions(o, s212.id);
  }
  mount() {
    this.updateSel();
  }
  showOptions(e7, t8) {
    this.list && this.list.remove(), this.list = this.dom.appendChild(this.createListBox(e7, t8, this.range)), this.list.addEventListener("scroll", () => {
      this.info && this.view.requestMeasure(this.placeInfoReq);
    });
  }
  update(e7) {
    var t8;
    let n14 = e7.state.field(this.stateField), s212 = e7.startState.field(this.stateField);
    if (this.updateTooltipClass(e7.state), n14 != s212) {
      let { options: o, selected: l11, disabled: a2 } = n14.open;
      (!s212.open || s212.open.options != o) && (this.range = Q10(o.length, l11, e7.state.facet(g3).maxRenderedOptions), this.showOptions(o, n14.id)), this.updateSel(), a2 != ((t8 = s212.open) === null || t8 === void 0 ? void 0 : t8.disabled) && this.dom.classList.toggle("cm-tooltip-autocomplete-disabled", !!a2);
    }
  }
  updateTooltipClass(e7) {
    let t8 = this.tooltipClass(e7);
    if (t8 != this.currentClass) {
      for (let n14 of this.currentClass.split(" ")) n14 && this.dom.classList.remove(n14);
      for (let n14 of t8.split(" ")) n14 && this.dom.classList.add(n14);
      this.currentClass = t8;
    }
  }
  positioned(e7) {
    this.space = e7, this.info && this.view.requestMeasure(this.placeInfoReq);
  }
  updateSel() {
    let e7 = this.view.state.field(this.stateField), t8 = e7.open;
    if ((t8.selected > -1 && t8.selected < this.range.from || t8.selected >= this.range.to) && (this.range = Q10(t8.options.length, t8.selected, this.view.state.facet(g3).maxRenderedOptions), this.showOptions(t8.options, e7.id)), this.updateSelectedOption(t8.selected)) {
      this.destroyInfo();
      let { completion: n14 } = t8.options[t8.selected], { info: s212 } = n14;
      if (!s212) return;
      let o = typeof s212 == "string" ? document.createTextNode(s212) : s212(n14);
      if (!o) return;
      "then" in o ? o.then((l11) => {
        l11 && this.view.state.field(this.stateField, false) == e7 && this.addInfoPane(l11, n14);
      }).catch((l11) => $7(this.view.state, l11, "completion info")) : this.addInfoPane(o, n14);
    }
  }
  addInfoPane(e7, t8) {
    this.destroyInfo();
    let n14 = this.info = document.createElement("div");
    if (n14.className = "cm-tooltip cm-completionInfo", e7.nodeType != null) n14.appendChild(e7), this.infoDestroy = null;
    else {
      let { dom: s212, destroy: o } = e7;
      n14.appendChild(s212), this.infoDestroy = o || null;
    }
    this.dom.appendChild(n14), this.view.requestMeasure(this.placeInfoReq);
  }
  updateSelectedOption(e7) {
    let t8 = null;
    for (let n14 = this.list.firstChild, s212 = this.range.from; n14; n14 = n14.nextSibling, s212++) n14.nodeName != "LI" || !n14.id ? s212-- : s212 == e7 ? n14.hasAttribute("aria-selected") || (n14.setAttribute("aria-selected", "true"), t8 = n14) : n14.hasAttribute("aria-selected") && n14.removeAttribute("aria-selected");
    return t8 && ot7(this.list, t8), t8;
  }
  measureInfo() {
    let e7 = this.dom.querySelector("[aria-selected]");
    if (!e7 || !this.info) return null;
    let t8 = this.dom.getBoundingClientRect(), n14 = this.info.getBoundingClientRect(), s212 = e7.getBoundingClientRect(), o = this.space;
    if (!o) {
      let l11 = this.dom.ownerDocument.defaultView || window;
      o = { left: 0, top: 0, right: l11.innerWidth, bottom: l11.innerHeight };
    }
    return s212.top > Math.min(o.bottom, t8.bottom) - 10 || s212.bottom < Math.max(o.top, t8.top) + 10 ? null : this.view.state.facet(g3).positionInfo(this.view, t8, s212, n14, o, this.dom);
  }
  placeInfo(e7) {
    this.info && (e7 ? (e7.style && (this.info.style.cssText = e7.style), this.info.className = "cm-tooltip cm-completionInfo " + (e7.class || "")) : this.info.style.cssText = "top: -1e6px");
  }
  createListBox(e7, t8, n14) {
    let s212 = document.createElement("ul");
    s212.id = t8, s212.setAttribute("role", "listbox"), s212.setAttribute("aria-expanded", "true"), s212.setAttribute("aria-label", this.view.state.phrase("Completions"));
    let o = null;
    for (let l11 = n14.from; l11 < n14.to; l11++) {
      let { completion: a2, match: r2 } = e7[l11], { section: f6 } = a2;
      if (f6) {
        let u3 = typeof f6 == "string" ? f6 : f6.name;
        if (u3 != o && (l11 > n14.from || n14.from == 0)) if (o = u3, typeof f6 != "string" && f6.header) s212.appendChild(f6.header(f6));
        else {
          let p3 = s212.appendChild(document.createElement("completion-section"));
          p3.textContent = u3;
        }
      }
      let c3 = s212.appendChild(document.createElement("li"));
      c3.id = t8 + "-" + l11, c3.setAttribute("role", "option");
      let h3 = this.optionClass(a2);
      h3 && (c3.className = h3);
      for (let u3 of this.optionContent) {
        let p3 = u3(a2, this.view.state, this.view, r2);
        p3 && c3.appendChild(p3);
      }
    }
    return n14.from && s212.classList.add("cm-completionListIncompleteTop"), n14.to < e7.length && s212.classList.add("cm-completionListIncompleteBottom"), s212;
  }
  destroyInfo() {
    this.info && (this.infoDestroy && this.infoDestroy(), this.info.remove(), this.info = null);
  }
  destroy() {
    this.destroyInfo();
  }
};
function st8(i12, e7) {
  return (t8) => new ee6(t8, i12, e7);
}
function ot7(i12, e7) {
  let t8 = i12.getBoundingClientRect(), n14 = e7.getBoundingClientRect(), s212 = t8.height / i12.offsetHeight;
  n14.top < t8.top ? i12.scrollTop -= (t8.top - n14.top) / s212 : n14.bottom > t8.bottom && (i12.scrollTop += (n14.bottom - t8.bottom) / s212);
}
function ye8(i12) {
  return (i12.boost || 0) * 100 + (i12.apply ? 10 : 0) + (i12.info ? 5 : 0) + (i12.type ? 1 : 0);
}
function lt7(i12, e7) {
  let t8 = [], n14 = null, s212 = (f6) => {
    t8.push(f6);
    let { section: c3 } = f6.completion;
    if (c3) {
      n14 || (n14 = []);
      let h3 = typeof c3 == "string" ? c3 : c3.name;
      n14.some((u3) => u3.name == h3) || n14.push(typeof c3 == "string" ? { name: h3 } : c3);
    }
  }, o = e7.facet(g3);
  for (let f6 of i12) if (f6.hasResult()) {
    let c3 = f6.result.getMatch;
    if (f6.result.filter === false) for (let h3 of f6.result.options) s212(new N10(h3, f6.source, c3 ? c3(h3) : [], 1e9 - t8.length));
    else {
      let h3 = e7.sliceDoc(f6.from, f6.to), u3, p3 = o.filterStrict ? new _9(h3) : new Z7(h3);
      for (let b12 of f6.result.options) if (u3 = p3.match(b12.label)) {
        let v10 = b12.displayLabel ? c3 ? c3(b12, u3.matched) : [] : u3.matched;
        s212(new N10(b12, f6.source, v10, u3.score + (b12.boost || 0)));
      }
    }
  }
  if (n14) {
    let f6 = /* @__PURE__ */ Object.create(null), c3 = 0, h3 = (u3, p3) => {
      var b12, v10;
      return ((b12 = u3.rank) !== null && b12 !== void 0 ? b12 : 1e9) - ((v10 = p3.rank) !== null && v10 !== void 0 ? v10 : 1e9) || (u3.name < p3.name ? -1 : 1);
    };
    for (let u3 of n14.sort(h3)) c3 -= 1e5, f6[u3.name] = c3;
    for (let u3 of t8) {
      let { section: p3 } = u3.completion;
      p3 && (u3.score += f6[typeof p3 == "string" ? p3 : p3.name]);
    }
  }
  let l11 = [], a2 = null, r2 = o.compareCompletions;
  for (let f6 of t8.sort((c3, h3) => h3.score - c3.score || r2(c3.completion, h3.completion))) {
    let c3 = f6.completion;
    !a2 || a2.label != c3.label || a2.detail != c3.detail || a2.type != null && c3.type != null && a2.type != c3.type || a2.apply != c3.apply || a2.boost != c3.boost ? l11.push(f6) : ye8(f6.completion) > ye8(a2) && (l11[l11.length - 1] = f6), a2 = f6.completion;
  }
  return l11;
}
var te9 = class i2 {
  constructor(e7, t8, n14, s212, o, l11) {
    this.options = e7, this.attrs = t8, this.tooltip = n14, this.timestamp = s212, this.selected = o, this.disabled = l11;
  }
  setSelected(e7, t8) {
    return e7 == this.selected || e7 >= this.options.length ? this : new i2(this.options, ve8(t8, e7), this.tooltip, this.timestamp, e7, this.disabled);
  }
  static build(e7, t8, n14, s212, o, l11) {
    if (s212 && !l11 && e7.some((f6) => f6.isPending)) return s212.setDisabled();
    let a2 = lt7(e7, t8);
    if (!a2.length) return s212 && e7.some((f6) => f6.isPending) ? s212.setDisabled() : null;
    let r2 = t8.facet(g3).selectOnOpen ? 0 : -1;
    if (s212 && s212.selected != r2 && s212.selected != -1) {
      let f6 = s212.options[s212.selected].completion;
      for (let c3 = 0; c3 < a2.length; c3++) if (a2[c3].completion == f6) {
        r2 = c3;
        break;
      }
    }
    return new i2(a2, ve8(n14, r2), { pos: e7.reduce((f6, c3) => c3.hasResult() ? Math.min(f6, c3.from) : f6, 1e8), create: ut6, above: o.aboveCursor }, s212 ? s212.timestamp : Date.now(), r2, false);
  }
  map(e7) {
    return new i2(this.options, this.attrs, Object.assign(Object.assign({}, this.tooltip), { pos: e7.mapPos(this.tooltip.pos) }), this.timestamp, this.selected, this.disabled);
  }
  setDisabled() {
    return new i2(this.options, this.attrs, this.tooltip, this.timestamp, this.selected, true);
  }
};
var ie4 = class i3 {
  constructor(e7, t8, n14) {
    this.active = e7, this.id = t8, this.open = n14;
  }
  static start() {
    return new i3(ft3, "cm-ac-" + Math.floor(Math.random() * 2e6).toString(36), null);
  }
  update(e7) {
    let { state: t8 } = e7, n14 = t8.facet(g3), o = (n14.override || t8.languageDataAt("autocomplete", A9(t8)).map(tt4)).map((r2) => (this.active.find((c3) => c3.source == r2) || new S8(r2, this.active.some((c3) => c3.state != 0) ? 1 : 0)).update(e7, n14));
    o.length == this.active.length && o.every((r2, f6) => r2 == this.active[f6]) && (o = this.active);
    let l11 = this.open, a2 = e7.effects.some((r2) => r2.is(fe9));
    l11 && e7.docChanged && (l11 = l11.map(e7.changes)), e7.selection || o.some((r2) => r2.hasResult() && e7.changes.touchesRange(r2.from, r2.to)) || !rt7(o, this.active) || a2 ? l11 = te9.build(o, t8, this.id, l11, n14, a2) : l11 && l11.disabled && !o.some((r2) => r2.isPending) && (l11 = null), !l11 && o.every((r2) => !r2.isPending) && o.some((r2) => r2.hasResult()) && (o = o.map((r2) => r2.hasResult() ? new S8(r2.source, 0) : r2));
    for (let r2 of e7.effects) r2.is(he8) && (l11 = l11 && l11.setSelected(r2.value, this.id));
    return o == this.active && l11 == this.open ? this : new i3(o, this.id, l11);
  }
  get tooltip() {
    return this.open ? this.open.tooltip : null;
  }
  get attrs() {
    return this.open ? this.open.attrs : this.active.length ? at8 : ct2;
  }
};
function rt7(i12, e7) {
  if (i12 == e7) return true;
  for (let t8 = 0, n14 = 0; ; ) {
    for (; t8 < i12.length && !i12[t8].hasResult(); ) t8++;
    for (; n14 < e7.length && !e7[n14].hasResult(); ) n14++;
    let s212 = t8 == i12.length, o = n14 == e7.length;
    if (s212 || o) return s212 == o;
    if (i12[t8++].result != e7[n14++].result) return false;
  }
}
var at8 = { "aria-autocomplete": "list" };
var ct2 = {};
function ve8(i12, e7) {
  let t8 = { "aria-autocomplete": "list", "aria-haspopup": "listbox", "aria-controls": i12 };
  return e7 > -1 && (t8["aria-activedescendant"] = i12 + "-" + e7), t8;
}
var ft3 = [];
function Me9(i12, e7) {
  if (i12.isUserEvent("input.complete")) {
    let n14 = i12.annotation(ce10);
    if (n14 && e7.activateOnCompletion(n14)) return 12;
  }
  let t8 = i12.isUserEvent("input.type");
  return t8 && e7.activateOnTyping ? 5 : t8 ? 1 : i12.isUserEvent("delete.backward") ? 2 : i12.selection ? 8 : i12.docChanged ? 16 : 0;
}
var S8 = class i4 {
  constructor(e7, t8, n14 = false) {
    this.source = e7, this.state = t8, this.explicit = n14;
  }
  hasResult() {
    return false;
  }
  get isPending() {
    return this.state == 1;
  }
  update(e7, t8) {
    let n14 = Me9(e7, t8), s212 = this;
    (n14 & 8 || n14 & 16 && this.touches(e7)) && (s212 = new i4(s212.source, 0)), n14 & 4 && s212.state == 0 && (s212 = new i4(this.source, 1)), s212 = s212.updateFor(e7, n14);
    for (let o of e7.effects) if (o.is(U11)) s212 = new i4(s212.source, 1, o.value);
    else if (o.is(M4)) s212 = new i4(s212.source, 0);
    else if (o.is(fe9)) for (let l11 of o.value) l11.source == s212.source && (s212 = l11);
    return s212;
  }
  updateFor(e7, t8) {
    return this.map(e7.changes);
  }
  map(e7) {
    return this;
  }
  touches(e7) {
    return e7.changes.touchesRange(A9(e7.state));
  }
};
var V11 = class i5 extends S8 {
  constructor(e7, t8, n14, s212, o, l11) {
    super(e7, 3, t8), this.limit = n14, this.result = s212, this.from = o, this.to = l11;
  }
  hasResult() {
    return true;
  }
  updateFor(e7, t8) {
    var n14;
    if (!(t8 & 3)) return this.map(e7.changes);
    let s212 = this.result;
    s212.map && !e7.changes.empty && (s212 = s212.map(s212, e7.changes));
    let o = e7.changes.mapPos(this.from), l11 = e7.changes.mapPos(this.to, 1), a2 = A9(e7.state);
    if (a2 > l11 || !s212 || t8 & 2 && (A9(e7.startState) == this.from || a2 < this.limit)) return new S8(this.source, t8 & 4 ? 1 : 0);
    let r2 = e7.changes.mapPos(this.limit);
    return ht7(s212.validFor, e7.state, o, l11) ? new i5(this.source, this.explicit, r2, s212, o, l11) : s212.update && (s212 = s212.update(s212, o, l11, new W9(e7.state, a2, false))) ? new i5(this.source, this.explicit, r2, s212, s212.from, (n14 = s212.to) !== null && n14 !== void 0 ? n14 : A9(e7.state)) : new S8(this.source, 1, this.explicit);
  }
  map(e7) {
    return e7.empty ? this : (this.result.map ? this.result.map(this.result, e7) : this.result) ? new i5(this.source, this.explicit, e7.mapPos(this.limit), this.result, e7.mapPos(this.from), e7.mapPos(this.to, 1)) : new S8(this.source, 0);
  }
  touches(e7) {
    return e7.changes.touchesRange(this.from, this.to);
  }
};
function ht7(i12, e7, t8, n14) {
  if (!i12) return false;
  let s212 = e7.sliceDoc(t8, n14);
  return typeof i12 == "function" ? i12(s212, t8, n14, e7) : Le8(i12, true).test(s212);
}
var fe9 = v.define({ map(i12, e7) {
  return i12.map((t8) => t8.map(e7));
} });
var he8 = v.define();
var m3 = z.define({ create() {
  return ie4.start();
}, update(i12, e7) {
  return i12.update(e7);
}, provide: (i12) => [In4.from(i12, (e7) => e7.tooltip), A8.contentAttributes.from(i12, (e7) => e7.attrs)] });
function ue8(i12, e7) {
  let t8 = e7.completion.apply || e7.completion.label, n14 = i12.state.field(m3).active.find((s212) => s212.source == e7.source);
  return n14 instanceof V11 ? (typeof t8 == "string" ? i12.dispatch(Object.assign(Object.assign({}, et4(i12.state, t8, n14.from, n14.to)), { annotations: ce10.of(e7.completion) })) : t8(i12, e7.completion, n14.from, n14.to), true) : false;
}
var ut6 = st8(m3, ue8);
function F11(i12, e7 = "option") {
  return (t8) => {
    let n14 = t8.state.field(m3, false);
    if (!n14 || !n14.open || n14.open.disabled || Date.now() - n14.open.timestamp < t8.state.facet(g3).interactionDelay) return false;
    let s212 = 1, o;
    e7 == "page" && (o = bl(t8, n14.open.tooltip)) && (s212 = Math.max(2, Math.floor(o.dom.offsetHeight / o.dom.querySelector("li").offsetHeight) - 1));
    let { length: l11 } = n14.open.options, a2 = n14.open.selected > -1 ? n14.open.selected + s212 * (i12 ? 1 : -1) : i12 ? 0 : l11 - 1;
    return a2 < 0 ? a2 = e7 == "page" ? 0 : l11 - 1 : a2 >= l11 && (a2 = e7 == "page" ? l11 - 1 : 0), t8.dispatch({ effects: he8.of(a2) }), true;
  };
}
var pt6 = (i12) => {
  let e7 = i12.state.field(m3, false);
  return i12.state.readOnly || !e7 || !e7.open || e7.open.selected < 0 || e7.open.disabled || Date.now() - e7.open.timestamp < i12.state.facet(g3).interactionDelay ? false : ue8(i12, e7.open.options[e7.open.selected]);
};
var xe10 = (i12) => i12.state.field(m3, false) ? (i12.dispatch({ effects: U11.of(true) }), true) : false;
var dt7 = (i12) => {
  let e7 = i12.state.field(m3, false);
  return !e7 || !e7.active.some((t8) => t8.state != 0) ? false : (i12.dispatch({ effects: M4.of(null) }), true);
};
var ne8 = class {
  constructor(e7, t8) {
    this.active = e7, this.context = t8, this.time = Date.now(), this.updates = [], this.done = void 0;
  }
};
var mt7 = 50;
var gt6 = 1e3;
var bt2 = N9.fromClass(class {
  constructor(i12) {
    this.view = i12, this.debounceUpdate = -1, this.running = [], this.debounceAccept = -1, this.pendingStart = false, this.composing = 0;
    for (let e7 of i12.state.field(m3).active) e7.isPending && this.startQuery(e7);
  }
  update(i12) {
    let e7 = i12.state.field(m3), t8 = i12.state.facet(g3);
    if (!i12.selectionSet && !i12.docChanged && i12.startState.field(m3) == e7) return;
    let n14 = i12.transactions.some((o) => {
      let l11 = Me9(o, t8);
      return l11 & 8 || (o.selection || o.docChanged) && !(l11 & 3);
    });
    for (let o = 0; o < this.running.length; o++) {
      let l11 = this.running[o];
      if (n14 || l11.context.abortOnDocChange && i12.docChanged || l11.updates.length + i12.transactions.length > mt7 && Date.now() - l11.time > gt6) {
        for (let a2 of l11.context.abortListeners) try {
          a2();
        } catch (r2) {
          $7(this.view.state, r2);
        }
        l11.context.abortListeners = null, this.running.splice(o--, 1);
      } else l11.updates.push(...i12.transactions);
    }
    this.debounceUpdate > -1 && clearTimeout(this.debounceUpdate), i12.transactions.some((o) => o.effects.some((l11) => l11.is(U11))) && (this.pendingStart = true);
    let s212 = this.pendingStart ? 50 : t8.activateOnTypingDelay;
    if (this.debounceUpdate = e7.active.some((o) => o.isPending && !this.running.some((l11) => l11.active.source == o.source)) ? setTimeout(() => this.startUpdate(), s212) : -1, this.composing != 0) for (let o of i12.transactions) o.isUserEvent("input.type") ? this.composing = 2 : this.composing == 2 && o.selection && (this.composing = 3);
  }
  startUpdate() {
    this.debounceUpdate = -1, this.pendingStart = false;
    let { state: i12 } = this.view, e7 = i12.field(m3);
    for (let t8 of e7.active) t8.isPending && !this.running.some((n14) => n14.active.source == t8.source) && this.startQuery(t8);
    this.running.length && e7.open && e7.open.disabled && (this.debounceAccept = setTimeout(() => this.accept(), this.view.state.facet(g3).updateSyncTime));
  }
  startQuery(i12) {
    let { state: e7 } = this.view, t8 = A9(e7), n14 = new W9(e7, t8, i12.explicit, this.view), s212 = new ne8(i12, n14);
    this.running.push(s212), Promise.resolve(i12.source(n14)).then((o) => {
      s212.context.aborted || (s212.done = o || null, this.scheduleAccept());
    }, (o) => {
      this.view.dispatch({ effects: M4.of(null) }), $7(this.view.state, o);
    });
  }
  scheduleAccept() {
    this.running.every((i12) => i12.done !== void 0) ? this.accept() : this.debounceAccept < 0 && (this.debounceAccept = setTimeout(() => this.accept(), this.view.state.facet(g3).updateSyncTime));
  }
  accept() {
    var i12;
    this.debounceAccept > -1 && clearTimeout(this.debounceAccept), this.debounceAccept = -1;
    let e7 = [], t8 = this.view.state.facet(g3), n14 = this.view.state.field(m3);
    for (let s212 = 0; s212 < this.running.length; s212++) {
      let o = this.running[s212];
      if (o.done === void 0) continue;
      if (this.running.splice(s212--, 1), o.done) {
        let a2 = A9(o.updates.length ? o.updates[0].startState : this.view.state), r2 = Math.min(a2, o.done.from + (o.active.explicit ? 0 : 1)), f6 = new V11(o.active.source, o.active.explicit, r2, o.done, o.done.from, (i12 = o.done.to) !== null && i12 !== void 0 ? i12 : a2);
        for (let c3 of o.updates) f6 = f6.update(c3, t8);
        if (f6.hasResult()) {
          e7.push(f6);
          continue;
        }
      }
      let l11 = n14.active.find((a2) => a2.source == o.active.source);
      if (l11 && l11.isPending) if (o.done == null) {
        let a2 = new S8(o.active.source, 0);
        for (let r2 of o.updates) a2 = a2.update(r2, t8);
        a2.isPending || e7.push(a2);
      } else this.startQuery(l11);
    }
    (e7.length || n14.open && n14.open.disabled) && this.view.dispatch({ effects: fe9.of(e7) });
  }
}, { eventHandlers: { blur(i12) {
  let e7 = this.view.state.field(m3, false);
  if (e7 && e7.tooltip && this.view.state.facet(g3).closeOnBlur) {
    let t8 = e7.open && bl(this.view, e7.open.tooltip);
    (!t8 || !t8.dom.contains(i12.relatedTarget)) && setTimeout(() => this.view.dispatch({ effects: M4.of(null) }), 10);
  }
}, compositionstart() {
  this.composing = 1;
}, compositionend() {
  this.composing == 3 && setTimeout(() => this.view.dispatch({ effects: U11.of(false) }), 20), this.composing = 0;
} } });
var yt6 = typeof navigator == "object" && /Win/.test(navigator.platform);
var vt6 = ht.highest(A8.domEventHandlers({ keydown(i12, e7) {
  let t8 = e7.state.field(m3, false);
  if (!t8 || !t8.open || t8.open.disabled || t8.open.selected < 0 || i12.key.length > 1 || i12.ctrlKey && !(yt6 && i12.altKey) || i12.metaKey) return false;
  let n14 = t8.open.options[t8.open.selected], s212 = t8.active.find((l11) => l11.source == n14.source), o = n14.completion.commitCharacters || s212.result.commitCharacters;
  return o && o.indexOf(i12.key) > -1 && ue8(e7, n14), false;
} }));
var ke8 = A8.baseTheme({ ".cm-tooltip.cm-tooltip-autocomplete": { "& > ul": { fontFamily: "monospace", whiteSpace: "nowrap", overflow: "hidden auto", maxWidth_fallback: "700px", maxWidth: "min(700px, 95vw)", minWidth: "250px", maxHeight: "10em", height: "100%", listStyle: "none", margin: 0, padding: 0, "& > li, & > completion-section": { padding: "1px 3px", lineHeight: 1.2 }, "& > li": { overflowX: "hidden", textOverflow: "ellipsis", cursor: "pointer" }, "& > completion-section": { display: "list-item", borderBottom: "1px solid silver", paddingLeft: "0.5em", opacity: 0.7 } } }, "&light .cm-tooltip-autocomplete ul li[aria-selected]": { background: "#17c", color: "white" }, "&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]": { background: "#777" }, "&dark .cm-tooltip-autocomplete ul li[aria-selected]": { background: "#347", color: "white" }, "&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]": { background: "#444" }, ".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after": { content: '"Â·Â·Â·"', opacity: 0.5, display: "block", textAlign: "center" }, ".cm-tooltip.cm-completionInfo": { position: "absolute", padding: "3px 9px", width: "max-content", maxWidth: "400px", boxSizing: "border-box", whiteSpace: "pre-line" }, ".cm-completionInfo.cm-completionInfo-left": { right: "100%" }, ".cm-completionInfo.cm-completionInfo-right": { left: "100%" }, ".cm-completionInfo.cm-completionInfo-left-narrow": { right: "30px" }, ".cm-completionInfo.cm-completionInfo-right-narrow": { left: "30px" }, "&light .cm-snippetField": { backgroundColor: "#00000022" }, "&dark .cm-snippetField": { backgroundColor: "#ffffff22" }, ".cm-snippetFieldPosition": { verticalAlign: "text-top", width: 0, height: "1.15em", display: "inline-block", margin: "0 -0.7px -.7em", borderLeft: "1.4px dotted #888" }, ".cm-completionMatchedText": { textDecoration: "underline" }, ".cm-completionDetail": { marginLeft: "0.5em", fontStyle: "italic" }, ".cm-completionIcon": { fontSize: "90%", width: ".8em", display: "inline-block", textAlign: "center", paddingRight: ".6em", opacity: "0.6", boxSizing: "content-box" }, ".cm-completionIcon-function, .cm-completionIcon-method": { "&:after": { content: "'Æ’'" } }, ".cm-completionIcon-class": { "&:after": { content: "'â—‹'" } }, ".cm-completionIcon-interface": { "&:after": { content: "'â—Œ'" } }, ".cm-completionIcon-variable": { "&:after": { content: "'ð‘¥'" } }, ".cm-completionIcon-constant": { "&:after": { content: "'ð¶'" } }, ".cm-completionIcon-type": { "&:after": { content: "'ð‘¡'" } }, ".cm-completionIcon-enum": { "&:after": { content: "'âˆª'" } }, ".cm-completionIcon-property": { "&:after": { content: "'â–¡'" } }, ".cm-completionIcon-keyword": { "&:after": { content: "'ðŸ”‘ï¸Ž'" } }, ".cm-completionIcon-namespace": { "&:after": { content: "'â–¢'" } }, ".cm-completionIcon-text": { "&:after": { content: "'abc'", fontSize: "50%", verticalAlign: "middle" } } });
var xt7 = O9.widget({ widget: new class extends lt6 {
  toDOM() {
    let i12 = document.createElement("span");
    return i12.className = "cm-snippetFieldPosition", i12;
  }
  ignoreEvent() {
    return false;
  }
}() });
var wt3 = O9.mark({ class: "cm-snippetField" });
var P11 = class i6 {
  constructor(e7, t8) {
    this.ranges = e7, this.active = t8, this.deco = O9.set(e7.map((n14) => (n14.from == n14.to ? xt7 : wt3).range(n14.from, n14.to)));
  }
  map(e7) {
    let t8 = [];
    for (let n14 of this.ranges) {
      let s212 = n14.map(e7);
      if (!s212) return null;
      t8.push(s212);
    }
    return new i6(t8, this.active);
  }
  selectionInsideField(e7) {
    return e7.ranges.every((t8) => this.ranges.some((n14) => n14.field == this.active && n14.from <= t8.from && n14.to >= t8.to));
  }
};
var j10 = v.define({ map(i12, e7) {
  return i12 && i12.map(e7);
} });
var Ct3 = v.define();
var E4 = z.define({ create() {
  return null;
}, update(i12, e7) {
  for (let t8 of e7.effects) {
    if (t8.is(j10)) return t8.value;
    if (t8.is(Ct3) && i12) return new P11(i12.ranges, t8.value);
  }
  return i12 && e7.docChanged && (i12 = i12.map(e7.changes)), i12 && e7.selection && !i12.selectionInsideField(e7.selection) && (i12 = null), i12;
}, provide: (i12) => A8.decorations.from(i12, (e7) => e7 ? e7.deco : O9.none) });
function pe9(i12, e7) {
  return x.create(i12.filter((t8) => t8.field == e7).map((t8) => x.range(t8.from, t8.to)));
}
function Be9(i12) {
  return ({ state: e7, dispatch: t8 }) => {
    let n14 = e7.field(E4, false);
    if (!n14 || i12 < 0 && n14.active == 0) return false;
    let s212 = n14.active + i12, o = i12 > 0 && !n14.ranges.some((l11) => l11.field == s212 + i12);
    return t8(e7.update({ selection: pe9(n14.ranges, s212), effects: j10.of(o ? null : new P11(n14.ranges, s212)), scrollIntoView: true })), true;
  };
}
var It7 = ({ state: i12, dispatch: e7 }) => i12.field(E4, false) ? (e7(i12.update({ effects: j10.of(null) })), true) : false;
var Ot2 = Be9(1);
var Tt2 = Be9(-1);
var At7 = [{ key: "Tab", run: Ot2, shift: Tt2 }, { key: "Escape", run: It7 }];
var we10 = y.define({ combine(i12) {
  return i12.length ? i12[0] : At7;
} });
var Et7 = ht.highest(ur4.compute([we10], (i12) => i12.facet(we10)));
var Dt6 = A8.domEventHandlers({ mousedown(i12, e7) {
  let t8 = e7.state.field(E4, false), n14;
  if (!t8 || (n14 = e7.posAtCoords({ x: i12.clientX, y: i12.clientY })) == null) return false;
  let s212 = t8.ranges.find((o) => o.from <= n14 && o.to >= n14);
  return !s212 || s212.field == t8.active ? false : (e7.dispatch({ selection: pe9(t8.ranges, s212.field), effects: j10.of(t8.ranges.some((o) => o.field > s212.field) ? new P11(t8.ranges, s212.field) : null), scrollIntoView: true }), true);
} });
var k6 = { brackets: ["(", "[", "{", "'", '"'], before: ")]}:;>", stringPrefixes: [] };
var T10 = v.define({ map(i12, e7) {
  let t8 = e7.mapPos(i12, -1, E.TrackAfter);
  return t8 ?? void 0;
} });
var de6 = new class extends W {
}();
de6.startSide = 1;
de6.endSide = -1;
var $e9 = z.define({ create() {
  return T.empty;
}, update(i12, e7) {
  if (i12 = i12.map(e7.changes), e7.selection) {
    let t8 = e7.state.doc.lineAt(e7.selection.main.head);
    i12 = i12.update({ filter: (n14) => n14 >= t8.from && n14 <= t8.to });
  }
  for (let t8 of e7.effects) t8.is(T10) && (i12 = i12.update({ add: [de6.range(t8.value, t8.value + 1)] }));
  return i12;
} });
var X9 = "()[]{}<>";
function Fe9(i12) {
  for (let e7 = 0; e7 < X9.length; e7 += 2) if (X9.charCodeAt(e7) == i12) return X9.charAt(e7 + 1);
  return lt(i12 < 128 ? i12 : i12 + 1);
}
function We9(i12, e7) {
  return i12.languageDataAt("closeBrackets", e7)[0] || k6;
}
var Lt6 = typeof navigator == "object" && /Android\b/.test(navigator.userAgent);
var Mt6 = A8.inputHandler.of((i12, e7, t8, n14) => {
  if ((Lt6 ? i12.composing : i12.compositionStarted) || i12.state.readOnly) return false;
  let s212 = i12.state.selection.main;
  if (n14.length > 2 || n14.length == 2 && Oe(ae(n14, 0)) == 1 || e7 != s212.from || t8 != s212.to) return false;
  let o = Bt6(i12.state, n14);
  return o ? (i12.dispatch(o), true) : false;
});
function Bt6(i12, e7) {
  let t8 = We9(i12, i12.selection.main.head), n14 = t8.brackets || k6.brackets;
  for (let s212 of n14) {
    let o = Fe9(ae(s212, 0));
    if (e7 == s212) return o == s212 ? Wt7(i12, s212, n14.indexOf(s212 + s212 + s212) > -1, t8) : $t7(i12, s212, o, t8.before || k6.before);
    if (e7 == o && Ne11(i12, i12.selection.main.from)) return Ft7(i12, s212, o);
  }
  return null;
}
function Ne11(i12, e7) {
  let t8 = false;
  return i12.field($e9).between(0, i12.doc.length, (n14) => {
    n14 == e7 && (t8 = true);
  }), t8;
}
function q7(i12, e7) {
  let t8 = i12.sliceString(e7, e7 + 2);
  return t8.slice(0, Oe(ae(t8, 0)));
}
function $t7(i12, e7, t8, n14) {
  let s212 = null, o = i12.changeByRange((l11) => {
    if (!l11.empty) return { changes: [{ insert: e7, from: l11.from }, { insert: t8, from: l11.to }], effects: T10.of(l11.to + e7.length), range: x.range(l11.anchor + e7.length, l11.head + e7.length) };
    let a2 = q7(i12.doc, l11.head);
    return !a2 || /\s/.test(a2) || n14.indexOf(a2) > -1 ? { changes: { insert: e7 + t8, from: l11.head }, effects: T10.of(l11.head + e7.length), range: x.cursor(l11.head + e7.length) } : { range: s212 = l11 };
  });
  return s212 ? null : i12.update(o, { scrollIntoView: true, userEvent: "input.type" });
}
function Ft7(i12, e7, t8) {
  let n14 = null, s212 = i12.changeByRange((o) => o.empty && q7(i12.doc, o.head) == t8 ? { changes: { from: o.head, to: o.head + t8.length, insert: t8 }, range: x.cursor(o.head + t8.length) } : n14 = { range: o });
  return n14 ? null : i12.update(s212, { scrollIntoView: true, userEvent: "input.type" });
}
function Wt7(i12, e7, t8, n14) {
  let s212 = n14.stringPrefixes || k6.stringPrefixes, o = null, l11 = i12.changeByRange((a2) => {
    if (!a2.empty) return { changes: [{ insert: e7, from: a2.from }, { insert: e7, from: a2.to }], effects: T10.of(a2.to + e7.length), range: x.range(a2.anchor + e7.length, a2.head + e7.length) };
    let r2 = a2.head, f6 = q7(i12.doc, r2), c3;
    if (f6 == e7) {
      if (Oe6(i12, r2)) return { changes: { insert: e7 + e7, from: r2 }, effects: T10.of(r2 + e7.length), range: x.cursor(r2 + e7.length) };
      if (Ne11(i12, r2)) {
        let u3 = t8 && i12.sliceDoc(r2, r2 + e7.length * 3) == e7 + e7 + e7 ? e7 + e7 + e7 : e7;
        return { changes: { from: r2, to: r2 + u3.length, insert: u3 }, range: x.cursor(r2 + u3.length) };
      }
    } else {
      if (t8 && i12.sliceDoc(r2 - 2 * e7.length, r2) == e7 + e7 && (c3 = Te7(i12, r2 - 2 * e7.length, s212)) > -1 && Oe6(i12, c3)) return { changes: { insert: e7 + e7 + e7 + e7, from: r2 }, effects: T10.of(r2 + e7.length), range: x.cursor(r2 + e7.length) };
      if (i12.charCategorizer(r2)(f6) != O.Word && Te7(i12, r2, s212) > -1 && !Nt2(i12, r2, e7, s212)) return { changes: { insert: e7 + e7, from: r2 }, effects: T10.of(r2 + e7.length), range: x.cursor(r2 + e7.length) };
    }
    return { range: o = a2 };
  });
  return o ? null : i12.update(l11, { scrollIntoView: true, userEvent: "input.type" });
}
function Oe6(i12, e7) {
  let t8 = k3(i12).resolveInner(e7 + 1);
  return t8.parent && t8.from == e7;
}
function Nt2(i12, e7, t8, n14) {
  let s212 = k3(i12).resolveInner(e7, -1), o = n14.reduce((l11, a2) => Math.max(l11, a2.length), 0);
  for (let l11 = 0; l11 < 5; l11++) {
    let a2 = i12.sliceDoc(s212.from, Math.min(s212.to, s212.from + t8.length + o)), r2 = a2.indexOf(t8);
    if (!r2 || r2 > -1 && n14.indexOf(a2.slice(0, r2)) > -1) {
      let c3 = s212.firstChild;
      for (; c3 && c3.from == s212.from && c3.to - c3.from > t8.length + r2; ) {
        if (i12.sliceDoc(c3.to - t8.length, c3.to) == t8) return false;
        c3 = c3.firstChild;
      }
      return true;
    }
    let f6 = s212.to == e7 && s212.parent;
    if (!f6) break;
    s212 = f6;
  }
  return false;
}
function Te7(i12, e7, t8) {
  let n14 = i12.charCategorizer(e7);
  if (n14(i12.sliceDoc(e7 - 1, e7)) != O.Word) return e7;
  for (let s212 of t8) {
    let o = e7 - s212.length;
    if (i12.sliceDoc(o, e7) == s212 && n14(i12.sliceDoc(o - 1, o)) != O.Word) return o;
  }
  return -1;
}
var Ut7 = [{ key: "Ctrl-Space", run: xe10 }, { mac: "Alt-`", run: xe10 }, { key: "Escape", run: dt7 }, { key: "ArrowDown", run: F11(true) }, { key: "ArrowUp", run: F11(false) }, { key: "PageDown", run: F11(true, "page") }, { key: "PageUp", run: F11(false, "page") }, { key: "Enter", run: pt6 }];
var Vt7 = ht.highest(ur4.computeN([g3], (i12) => i12.facet(g3).defaultKeymap ? [Ut7] : []));

// https://esm.sh/v135/@codemirror/lint@6.8.3/denonext/lint.mjs
var D7 = class {
  constructor(e7, n14, i12) {
    this.from = e7, this.to = n14, this.diagnostic = i12;
  }
};
var h = class t3 {
  constructor(e7, n14, i12) {
    this.diagnostics = e7, this.panel = n14, this.selected = i12;
  }
  static init(e7, n14, i12) {
    let s212 = e7, o = i12.facet(m4).markerFilter;
    o && (s212 = o(s212, i12));
    let l11 = O2.set(s212.map((r2) => r2.from == r2.to || r2.from == r2.to - 1 && i12.doc.lineAt(r2.from).to == r2.from ? O2.widget({ widget: new L9(r2), diagnostic: r2 }).range(r2.from) : O2.mark({ attributes: { class: "cm-lintRange cm-lintRange-" + r2.severity + (r2.markClass ? " " + r2.markClass : "") }, diagnostic: r2 }).range(r2.from, r2.to)), true);
    return new t3(l11, n14, b5(l11));
  }
};
function b5(t8, e7 = null, n14 = 0) {
  let i12 = null;
  return t8.between(n14, 1e9, (s212, o, { spec: l11 }) => {
    if (!(e7 && l11.diagnostic != e7)) return i12 = new D7(s212, o, l11.diagnostic), false;
  }), i12;
}
function z10(t8, e7) {
  let n14 = e7.pos, i12 = e7.end || n14, s212 = t8.state.facet(m4).hideOn(t8, n14, i12);
  if (s212 != null) return s212;
  let o = t8.startState.doc.lineAt(e7.pos);
  return !!(t8.effects.some((l11) => l11.is(R9)) || t8.changes.touchesRange(o.from, Math.max(o.to, i12)));
}
function H3(t8, e7) {
  return t8.field(f3, false) ? e7 : e7.concat(v.appendConfig.of(Z8));
}
function se6(t8, e7) {
  return { effects: H3(t8, [R9.of(e7)]) };
}
var R9 = v.define();
var I10 = v.define();
var $8 = v.define();
var f3 = z.define({ create() {
  return new h(O2.none, null, null);
}, update(t8, e7) {
  if (e7.docChanged && t8.diagnostics.size) {
    let n14 = t8.diagnostics.map(e7.changes), i12 = null, s212 = t8.panel;
    if (t8.selected) {
      let o = e7.changes.mapPos(t8.selected.from, 1);
      i12 = b5(n14, t8.selected.diagnostic, o) || b5(n14, null, o);
    }
    !n14.size && s212 && e7.state.facet(m4).autoPanel && (s212 = null), t8 = new h(n14, s212, i12);
  }
  for (let n14 of e7.effects) if (n14.is(R9)) {
    let i12 = e7.state.facet(m4).autoPanel ? n14.value.length ? w6.open : null : t8.panel;
    t8 = h.init(n14.value, i12, e7.state);
  } else n14.is(I10) ? t8 = new h(t8.diagnostics, n14.value ? w6.open : null, t8.selected) : n14.is($8) && (t8 = new h(t8.diagnostics, t8.panel, n14.value));
  return t8;
}, provide: (t8) => [Rs.from(t8, (e7) => e7.panel), A2.decorations.from(t8, (e7) => e7.diagnostics)] });
var oe6 = O2.mark({ class: "cm-lintRange cm-lintRange-active" });
function le10(t8, e7, n14) {
  let { diagnostics: i12 } = t8.state.field(f3), s212 = [], o = 2e8, l11 = 0;
  i12.between(e7 - (n14 < 0 ? 1 : 0), e7 + (n14 > 0 ? 1 : 0), (a2, c3, { spec: d4 }) => {
    e7 >= a2 && e7 <= c3 && (a2 == c3 || (e7 > a2 || n14 > 0) && (e7 < c3 || n14 < 0)) && (s212.push(d4.diagnostic), o = Math.min(a2, o), l11 = Math.max(c3, l11));
  });
  let r2 = t8.state.facet(m4).tooltipFilter;
  return r2 && (s212 = r2(s212, t8.state)), s212.length ? { pos: o, end: l11, above: t8.state.doc.lineAt(o).to < l11, create() {
    return { dom: V12(t8, s212) };
  } } : null;
}
function V12(t8, e7) {
  return s114("ul", { class: "cm-tooltip-lint" }, e7.map((n14) => _10(t8, n14, false)));
}
var B5 = (t8) => {
  let e7 = t8.state.field(f3, false);
  return !e7 || !e7.panel ? false : (t8.dispatch({ effects: I10.of(false) }), true);
};
var N11 = N2.fromClass(class {
  constructor(t8) {
    this.view = t8, this.timeout = -1, this.set = true;
    let { delay: e7 } = t8.state.facet(m4);
    this.lintTime = Date.now() + e7, this.run = this.run.bind(this), this.timeout = setTimeout(this.run, e7);
  }
  run() {
    clearTimeout(this.timeout);
    let t8 = Date.now();
    if (t8 < this.lintTime - 10) this.timeout = setTimeout(this.run, this.lintTime - t8);
    else {
      this.set = false;
      let { state: e7 } = this.view, { sources: n14 } = e7.facet(m4);
      n14.length && ce11(n14.map((i12) => Promise.resolve(i12(this.view))), (i12) => {
        this.view.state.doc == e7.doc && this.view.dispatch(se6(this.view.state, i12.reduce((s212, o) => s212.concat(o))));
      }, (i12) => {
        $2(this.view.state, i12);
      });
    }
  }
  update(t8) {
    let e7 = t8.state.facet(m4);
    (t8.docChanged || e7 != t8.startState.facet(m4) || e7.needsRefresh && e7.needsRefresh(t8)) && (this.lintTime = Date.now() + e7.delay, this.set || (this.set = true, this.timeout = setTimeout(this.run, e7.delay)));
  }
  force() {
    this.set && (this.lintTime = Date.now(), this.run());
  }
  destroy() {
    clearTimeout(this.timeout);
  }
});
function ce11(t8, e7, n14) {
  let i12 = [], s212 = -1;
  for (let o of t8) o.then((l11) => {
    i12.push(l11), clearTimeout(s212), i12.length == t8.length ? e7(i12) : setTimeout(() => e7(i12), 200);
  }, n14);
}
var m4 = y.define({ combine(t8) {
  return Object.assign({ sources: t8.map((e7) => e7.source).filter((e7) => e7 != null) }, at(t8.map((e7) => e7.config), { delay: 750, markerFilter: null, tooltipFilter: null, needsRefresh: null, hideOn: () => null }, { needsRefresh: (e7, n14) => e7 ? n14 ? (i12) => e7(i12) || n14(i12) : e7 : n14 }));
} });
function Y11(t8) {
  let e7 = [];
  if (t8) e: for (let { name: n14 } of t8) {
    for (let i12 = 0; i12 < n14.length; i12++) {
      let s212 = n14[i12];
      if (/[a-zA-Z]/.test(s212) && !e7.some((o) => o.toLowerCase() == s212.toLowerCase())) {
        e7.push(s212);
        continue e;
      }
    }
    e7.push("");
  }
  return e7;
}
function _10(t8, e7, n14) {
  var i12;
  let s212 = n14 ? Y11(e7.actions) : [];
  return s114("li", { class: "cm-diagnostic cm-diagnostic-" + e7.severity }, s114("span", { class: "cm-diagnosticText" }, e7.renderMessage ? e7.renderMessage(t8) : e7.message), (i12 = e7.actions) === null || i12 === void 0 ? void 0 : i12.map((o, l11) => {
    let r2 = false, a2 = (K16) => {
      if (K16.preventDefault(), r2) return;
      r2 = true;
      let P23 = b5(t8.state.field(f3).diagnostics, e7);
      P23 && o.apply(t8, P23.from, P23.to);
    }, { name: c3 } = o, d4 = s212[l11] ? c3.indexOf(s212[l11]) : -1, p3 = d4 < 0 ? c3 : [c3.slice(0, d4), s114("u", c3.slice(d4, d4 + 1)), c3.slice(d4 + 1)];
    return s114("button", { type: "button", class: "cm-diagnosticAction", onclick: a2, onmousedown: a2, "aria-label": ` Action: ${c3}${d4 < 0 ? "" : ` (access key "${s212[l11]})"`}.` }, p3);
  }), e7.source && s114("div", { class: "cm-diagnosticSource" }, e7.source));
}
var L9 = class extends lt2 {
  constructor(e7) {
    super(), this.diagnostic = e7;
  }
  eq(e7) {
    return e7.diagnostic == this.diagnostic;
  }
  toDOM() {
    return s114("span", { class: "cm-lintPoint cm-lintPoint-" + this.diagnostic.severity });
  }
};
var v4 = class {
  constructor(e7, n14) {
    this.diagnostic = n14, this.id = "item_" + Math.floor(Math.random() * 4294967295).toString(16), this.dom = _10(e7, n14, true), this.dom.id = this.id, this.dom.setAttribute("role", "option");
  }
};
var w6 = class t4 {
  constructor(e7) {
    this.view = e7, this.items = [];
    let n14 = (s212) => {
      if (s212.keyCode == 27) B5(this.view), this.view.focus();
      else if (s212.keyCode == 38 || s212.keyCode == 33) this.moveSelection((this.selectedIndex - 1 + this.items.length) % this.items.length);
      else if (s212.keyCode == 40 || s212.keyCode == 34) this.moveSelection((this.selectedIndex + 1) % this.items.length);
      else if (s212.keyCode == 36) this.moveSelection(0);
      else if (s212.keyCode == 35) this.moveSelection(this.items.length - 1);
      else if (s212.keyCode == 13) this.view.focus();
      else if (s212.keyCode >= 65 && s212.keyCode <= 90 && this.selectedIndex >= 0) {
        let { diagnostic: o } = this.items[this.selectedIndex], l11 = Y11(o.actions);
        for (let r2 = 0; r2 < l11.length; r2++) if (l11[r2].toUpperCase().charCodeAt(0) == s212.keyCode) {
          let a2 = b5(this.view.state.field(f3).diagnostics, o);
          a2 && o.actions[r2].apply(e7, a2.from, a2.to);
        }
      } else return;
      s212.preventDefault();
    }, i12 = (s212) => {
      for (let o = 0; o < this.items.length; o++) this.items[o].dom.contains(s212.target) && this.moveSelection(o);
    };
    this.list = s114("ul", { tabIndex: 0, role: "listbox", "aria-label": this.view.state.phrase("Diagnostics"), onkeydown: n14, onclick: i12 }), this.dom = s114("div", { class: "cm-panel-lint" }, this.list, s114("button", { type: "button", name: "close", "aria-label": this.view.state.phrase("close"), onclick: () => B5(this.view) }, "Ã—")), this.update();
  }
  get selectedIndex() {
    let e7 = this.view.state.field(f3).selected;
    if (!e7) return -1;
    for (let n14 = 0; n14 < this.items.length; n14++) if (this.items[n14].diagnostic == e7.diagnostic) return n14;
    return -1;
  }
  update() {
    let { diagnostics: e7, selected: n14 } = this.view.state.field(f3), i12 = 0, s212 = false, o = null;
    for (e7.between(0, this.view.state.doc.length, (l11, r2, { spec: a2 }) => {
      let c3 = -1, d4;
      for (let p3 = i12; p3 < this.items.length; p3++) if (this.items[p3].diagnostic == a2.diagnostic) {
        c3 = p3;
        break;
      }
      c3 < 0 ? (d4 = new v4(this.view, a2.diagnostic), this.items.splice(i12, 0, d4), s212 = true) : (d4 = this.items[c3], c3 > i12 && (this.items.splice(i12, c3 - i12), s212 = true)), n14 && d4.diagnostic == n14.diagnostic ? d4.dom.hasAttribute("aria-selected") || (d4.dom.setAttribute("aria-selected", "true"), o = d4) : d4.dom.hasAttribute("aria-selected") && d4.dom.removeAttribute("aria-selected"), i12++;
    }); i12 < this.items.length && !(this.items.length == 1 && this.items[0].diagnostic.from < 0); ) s212 = true, this.items.pop();
    this.items.length == 0 && (this.items.push(new v4(this.view, { from: -1, to: -1, severity: "info", message: this.view.state.phrase("No diagnostics") })), s212 = true), o ? (this.list.setAttribute("aria-activedescendant", o.id), this.view.requestMeasure({ key: this, read: () => ({ sel: o.dom.getBoundingClientRect(), panel: this.list.getBoundingClientRect() }), write: ({ sel: l11, panel: r2 }) => {
      let a2 = r2.height / this.list.offsetHeight;
      l11.top < r2.top ? this.list.scrollTop -= (r2.top - l11.top) / a2 : l11.bottom > r2.bottom && (this.list.scrollTop += (l11.bottom - r2.bottom) / a2);
    } })) : this.selectedIndex < 0 && this.list.removeAttribute("aria-activedescendant"), s212 && this.sync();
  }
  sync() {
    let e7 = this.list.firstChild;
    function n14() {
      let i12 = e7;
      e7 = i12.nextSibling, i12.remove();
    }
    for (let i12 of this.items) if (i12.dom.parentNode == this.list) {
      for (; e7 != i12.dom; ) n14();
      e7 = i12.dom.nextSibling;
    } else this.list.insertBefore(i12.dom, e7);
    for (; e7; ) n14();
  }
  moveSelection(e7) {
    if (this.selectedIndex < 0) return;
    let n14 = this.view.state.field(f3), i12 = b5(n14.diagnostics, this.items[e7].diagnostic);
    i12 && this.view.dispatch({ selection: { anchor: i12.from, head: i12.to }, scrollIntoView: true, effects: $8.of(i12) });
  }
  static open(e7) {
    return new t4(e7);
  }
};
function y10(t8, e7 = 'viewBox="0 0 40 40"') {
  return `url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e7}>${encodeURIComponent(t8)}</svg>')`;
}
function x6(t8) {
  return y10(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${t8}" fill="none" stroke-width=".7"/>`, 'width="6" height="3"');
}
var de7 = A2.baseTheme({ ".cm-diagnostic": { padding: "3px 6px 3px 8px", marginLeft: "-1px", display: "block", whiteSpace: "pre-wrap" }, ".cm-diagnostic-error": { borderLeft: "5px solid #d11" }, ".cm-diagnostic-warning": { borderLeft: "5px solid orange" }, ".cm-diagnostic-info": { borderLeft: "5px solid #999" }, ".cm-diagnostic-hint": { borderLeft: "5px solid #66d" }, ".cm-diagnosticAction": { font: "inherit", border: "none", padding: "2px 4px", backgroundColor: "#444", color: "white", borderRadius: "3px", marginLeft: "8px", cursor: "pointer" }, ".cm-diagnosticSource": { fontSize: "70%", opacity: 0.7 }, ".cm-lintRange": { backgroundPosition: "left bottom", backgroundRepeat: "repeat-x", paddingBottom: "0.7px" }, ".cm-lintRange-error": { backgroundImage: x6("#d11") }, ".cm-lintRange-warning": { backgroundImage: x6("orange") }, ".cm-lintRange-info": { backgroundImage: x6("#999") }, ".cm-lintRange-hint": { backgroundImage: x6("#66d") }, ".cm-lintRange-active": { backgroundColor: "#ffdd9980" }, ".cm-tooltip-lint": { padding: 0, margin: 0 }, ".cm-lintPoint": { position: "relative", "&:after": { content: '""', position: "absolute", bottom: 0, left: "-2px", borderLeft: "3px solid transparent", borderRight: "3px solid transparent", borderBottom: "4px solid #d11" } }, ".cm-lintPoint-warning": { "&:after": { borderBottomColor: "orange" } }, ".cm-lintPoint-info": { "&:after": { borderBottomColor: "#999" } }, ".cm-lintPoint-hint": { "&:after": { borderBottomColor: "#66d" } }, ".cm-panel.cm-panel-lint": { position: "relative", "& ul": { maxHeight: "100px", overflowY: "auto", "& [aria-selected]": { backgroundColor: "#ddd", "& u": { textDecoration: "underline" } }, "&:focus [aria-selected]": { background_fallback: "#bdf", backgroundColor: "Highlight", color_fallback: "white", color: "HighlightText" }, "& u": { textDecoration: "none" }, padding: 0, margin: 0 }, "& [name=close]": { position: "absolute", top: "0", right: "2px", background: "inherit", border: "none", font: "inherit", padding: 0, margin: 0 } } });
function O10(t8) {
  return t8 == "error" ? 4 : t8 == "warning" ? 3 : t8 == "info" ? 2 : 1;
}
var C5 = class extends J2 {
  constructor(e7) {
    super(), this.diagnostics = e7, this.severity = e7.reduce((n14, i12) => O10(n14) < O10(i12.severity) ? i12.severity : n14, "hint");
  }
  toDOM(e7) {
    let n14 = document.createElement("div");
    n14.className = "cm-lint-marker cm-lint-marker-" + this.severity;
    let i12 = this.diagnostics, s212 = e7.state.facet(S9).tooltipFilter;
    return s212 && (i12 = s212(i12, e7.state)), i12.length && (n14.onmouseover = () => ue9(e7, n14, i12)), n14;
  }
};
function fe10(t8, e7) {
  let n14 = (i12) => {
    let s212 = e7.getBoundingClientRect();
    if (!(i12.clientX > s212.left - 10 && i12.clientX < s212.right + 10 && i12.clientY > s212.top - 10 && i12.clientY < s212.bottom + 10)) {
      for (let o = i12.target; o; o = o.parentNode) if (o.nodeType == 1 && o.classList.contains("cm-tooltip-lint")) return;
      window.removeEventListener("mousemove", n14), t8.state.field(q8) && t8.dispatch({ effects: E5.of(null) });
    }
  };
  window.addEventListener("mousemove", n14);
}
function ue9(t8, e7, n14) {
  function i12() {
    let l11 = t8.elementAtHeight(e7.getBoundingClientRect().top + 5 - t8.documentTop);
    t8.coordsAtPos(l11.from) && t8.dispatch({ effects: E5.of({ pos: l11.from, above: false, clip: false, create() {
      return { dom: V12(t8, n14), getCoords: () => e7.getBoundingClientRect() };
    } }) }), e7.onmouseout = e7.onmousemove = null, fe10(t8, e7);
  }
  let { hoverTime: s212 } = t8.state.facet(S9), o = setTimeout(i12, s212);
  e7.onmouseout = () => {
    clearTimeout(o), e7.onmouseout = e7.onmousemove = null;
  }, e7.onmousemove = () => {
    clearTimeout(o), o = setTimeout(i12, s212);
  };
}
function me10(t8, e7) {
  let n14 = /* @__PURE__ */ Object.create(null);
  for (let s212 of e7) {
    let o = t8.lineAt(s212.from);
    (n14[o.from] || (n14[o.from] = [])).push(s212);
  }
  let i12 = [];
  for (let s212 in n14) i12.push(new C5(n14[s212]).range(+s212));
  return T.of(i12, true);
}
var he9 = Cl({ class: "cm-gutter-lint", markers: (t8) => t8.state.field(A10), widgetMarker: (t8, e7, n14) => {
  let i12 = [];
  return t8.state.field(A10).between(n14.from, n14.to, (s212, o, l11) => {
    i12.push(...l11.diagnostics);
  }), i12.length ? new C5(i12) : null;
} });
var A10 = z.define({ create() {
  return T.empty;
}, update(t8, e7) {
  t8 = t8.map(e7.changes);
  let n14 = e7.state.facet(S9).markerFilter;
  for (let i12 of e7.effects) if (i12.is(R9)) {
    let s212 = i12.value;
    n14 && (s212 = n14(s212 || [], e7.state)), t8 = me10(e7.state.doc, s212.slice(0));
  }
  return t8;
} });
var E5 = v.define();
var q8 = z.define({ create() {
  return null;
}, update(t8, e7) {
  return t8 && e7.docChanged && (t8 = z10(e7, t8) ? null : Object.assign(Object.assign({}, t8), { pos: e7.changes.mapPos(t8.pos) })), e7.effects.reduce((n14, i12) => i12.is(E5) ? i12.value : n14, t8);
}, provide: (t8) => In.from(t8) });
var ge11 = A2.baseTheme({ ".cm-gutter-lint": { width: "1.4em", "& .cm-gutterElement": { padding: ".2em" } }, ".cm-lint-marker": { width: "1em", height: "1em" }, ".cm-lint-marker-info": { content: y10('<path fill="#aaf" stroke="#77e" stroke-width="6" stroke-linejoin="round" d="M5 5L35 5L35 35L5 35Z"/>') }, ".cm-lint-marker-warning": { content: y10('<path fill="#fe8" stroke="#fd7" stroke-width="6" stroke-linejoin="round" d="M20 6L37 35L3 35Z"/>') }, ".cm-lint-marker-error": { content: y10('<circle cx="20" cy="20" r="15" fill="#f87" stroke="#f43" stroke-width="6"/>') } });
var Z8 = [f3, A2.decorations.compute([f3], (t8) => {
  let { selected: e7, panel: n14 } = t8.field(f3);
  return !e7 || !n14 || e7.from == e7.to ? O2.none : O2.set([oe6.range(e7.from, e7.to)]);
}), ml(le10, { hideOn: z10 }), de7];
var S9 = y.define({ combine(t8) {
  return at(t8, { hoverTime: 300, markerFilter: null, tooltipFilter: null });
} });

// https://esm.sh/v135/@codemirror/state@6.3.2/denonext/state.mjs
var m5 = class s141 {
  lineAt(e7) {
    if (e7 < 0 || e7 > this.length) throw new RangeError(`Invalid position ${e7} in document of length ${this.length}`);
    return this.lineInner(e7, false, 1, 0);
  }
  line(e7) {
    if (e7 < 1 || e7 > this.lines) throw new RangeError(`Invalid line number ${e7} in ${this.lines}-line document`);
    return this.lineInner(e7, true, 1, 0);
  }
  replace(e7, t8, n14) {
    let i12 = [];
    return this.decompose(0, e7, i12, 2), n14.length && n14.decompose(0, n14.length, i12, 3), this.decompose(t8, this.length, i12, 1), L10.from(i12, this.length - (t8 - e7) + n14.length);
  }
  append(e7) {
    return this.replace(this.length, this.length, e7);
  }
  slice(e7, t8 = this.length) {
    let n14 = [];
    return this.decompose(e7, t8, n14, 0), L10.from(n14, t8 - e7);
  }
  eq(e7) {
    if (e7 == this) return true;
    if (e7.length != this.length || e7.lines != this.lines) return false;
    let t8 = this.scanIdentical(e7, 1), n14 = this.length - this.scanIdentical(e7, -1), i12 = new M5(this), r2 = new M5(e7);
    for (let l11 = t8, h3 = t8; ; ) {
      if (i12.next(l11), r2.next(l11), l11 = 0, i12.lineBreak != r2.lineBreak || i12.done != r2.done || i12.value != r2.value) return false;
      if (h3 += i12.value.length, i12.done || h3 >= n14) return true;
    }
  }
  iter(e7 = 1) {
    return new M5(this, e7);
  }
  iterRange(e7, t8 = this.length) {
    return new X10(this, e7, t8);
  }
  iterLines(e7, t8) {
    let n14;
    if (e7 == null) n14 = this.iter();
    else {
      t8 == null && (t8 = this.lines + 1);
      let i12 = this.line(e7).from;
      n14 = this.iterRange(i12, Math.max(i12, t8 == this.lines + 1 ? this.length : t8 <= 1 ? 0 : this.line(t8 - 1).to));
    }
    return new Y12(n14);
  }
  toString() {
    return this.sliceString(0);
  }
  toJSON() {
    let e7 = [];
    return this.flatten(e7), e7;
  }
  constructor() {
  }
  static of(e7) {
    if (e7.length == 0) throw new RangeError("A document must have at least one line");
    return e7.length == 1 && !e7[0] ? s141.empty : e7.length <= 32 ? new k7(e7) : L10.from(k7.split(e7, []));
  }
};
var k7 = class s142 extends m5 {
  constructor(e7, t8 = je7(e7)) {
    super(), this.text = e7, this.length = t8;
  }
  get lines() {
    return this.text.length;
  }
  get children() {
    return null;
  }
  lineInner(e7, t8, n14, i12) {
    for (let r2 = 0; ; r2++) {
      let l11 = this.text[r2], h3 = i12 + l11.length;
      if ((t8 ? n14 : h3) >= e7) return new ae8(i12, h3, n14, l11);
      i12 = h3 + 1, n14++;
    }
  }
  decompose(e7, t8, n14, i12) {
    let r2 = e7 <= 0 && t8 >= this.length ? this : new s142(Ae7(this.text, e7, t8), Math.min(t8, this.length) - Math.max(0, e7));
    if (i12 & 1) {
      let l11 = n14.pop(), h3 = Q11(r2.text, l11.text.slice(), 0, r2.length);
      if (h3.length <= 32) n14.push(new s142(h3, l11.length + r2.length));
      else {
        let o = h3.length >> 1;
        n14.push(new s142(h3.slice(0, o)), new s142(h3.slice(o)));
      }
    } else n14.push(r2);
  }
  replace(e7, t8, n14) {
    if (!(n14 instanceof s142)) return super.replace(e7, t8, n14);
    let i12 = Q11(this.text, Q11(n14.text, Ae7(this.text, 0, e7)), t8), r2 = this.length + n14.length - (t8 - e7);
    return i12.length <= 32 ? new s142(i12, r2) : L10.from(s142.split(i12, []), r2);
  }
  sliceString(e7, t8 = this.length, n14 = `
`) {
    let i12 = "";
    for (let r2 = 0, l11 = 0; r2 <= t8 && l11 < this.text.length; l11++) {
      let h3 = this.text[l11], o = r2 + h3.length;
      r2 > e7 && l11 && (i12 += n14), e7 < o && t8 > r2 && (i12 += h3.slice(Math.max(0, e7 - r2), t8 - r2)), r2 = o + 1;
    }
    return i12;
  }
  flatten(e7) {
    for (let t8 of this.text) e7.push(t8);
  }
  scanIdentical() {
    return 0;
  }
  static split(e7, t8) {
    let n14 = [], i12 = -1;
    for (let r2 of e7) n14.push(r2), i12 += r2.length + 1, n14.length == 32 && (t8.push(new s142(n14, i12)), n14 = [], i12 = -1);
    return i12 > -1 && t8.push(new s142(n14, i12)), t8;
  }
};
var L10 = class s143 extends m5 {
  constructor(e7, t8) {
    super(), this.children = e7, this.length = t8, this.lines = 0;
    for (let n14 of e7) this.lines += n14.lines;
  }
  lineInner(e7, t8, n14, i12) {
    for (let r2 = 0; ; r2++) {
      let l11 = this.children[r2], h3 = i12 + l11.length, o = n14 + l11.lines - 1;
      if ((t8 ? o : h3) >= e7) return l11.lineInner(e7, t8, n14, i12);
      i12 = h3 + 1, n14 = o + 1;
    }
  }
  decompose(e7, t8, n14, i12) {
    for (let r2 = 0, l11 = 0; l11 <= t8 && r2 < this.children.length; r2++) {
      let h3 = this.children[r2], o = l11 + h3.length;
      if (e7 <= o && t8 >= l11) {
        let a2 = i12 & ((l11 <= e7 ? 1 : 0) | (o >= t8 ? 2 : 0));
        l11 >= e7 && o <= t8 && !a2 ? n14.push(h3) : h3.decompose(e7 - l11, t8 - l11, n14, a2);
      }
      l11 = o + 1;
    }
  }
  replace(e7, t8, n14) {
    if (n14.lines < this.lines) for (let i12 = 0, r2 = 0; i12 < this.children.length; i12++) {
      let l11 = this.children[i12], h3 = r2 + l11.length;
      if (e7 >= r2 && t8 <= h3) {
        let o = l11.replace(e7 - r2, t8 - r2, n14), a2 = this.lines - l11.lines + o.lines;
        if (o.lines < a2 >> 4 && o.lines > a2 >> 6) {
          let f6 = this.children.slice();
          return f6[i12] = o, new s143(f6, this.length - (t8 - e7) + n14.length);
        }
        return super.replace(r2, h3, o);
      }
      r2 = h3 + 1;
    }
    return super.replace(e7, t8, n14);
  }
  sliceString(e7, t8 = this.length, n14 = `
`) {
    let i12 = "";
    for (let r2 = 0, l11 = 0; r2 < this.children.length && l11 <= t8; r2++) {
      let h3 = this.children[r2], o = l11 + h3.length;
      l11 > e7 && r2 && (i12 += n14), e7 < o && t8 > l11 && (i12 += h3.sliceString(e7 - l11, t8 - l11, n14)), l11 = o + 1;
    }
    return i12;
  }
  flatten(e7) {
    for (let t8 of this.children) t8.flatten(e7);
  }
  scanIdentical(e7, t8) {
    if (!(e7 instanceof s143)) return 0;
    let n14 = 0, [i12, r2, l11, h3] = t8 > 0 ? [0, 0, this.children.length, e7.children.length] : [this.children.length - 1, e7.children.length - 1, -1, -1];
    for (; ; i12 += t8, r2 += t8) {
      if (i12 == l11 || r2 == h3) return n14;
      let o = this.children[i12], a2 = e7.children[r2];
      if (o != a2) return n14 + o.scanIdentical(a2, t8);
      n14 += o.length + 1;
    }
  }
  static from(e7, t8 = e7.reduce((n14, i12) => n14 + i12.length + 1, -1)) {
    let n14 = 0;
    for (let c3 of e7) n14 += c3.lines;
    if (n14 < 32) {
      let c3 = [];
      for (let g8 of e7) g8.flatten(c3);
      return new k7(c3, t8);
    }
    let i12 = Math.max(32, n14 >> 5), r2 = i12 << 1, l11 = i12 >> 1, h3 = [], o = 0, a2 = -1, f6 = [];
    function u3(c3) {
      let g8;
      if (c3.lines > r2 && c3 instanceof s143) for (let A18 of c3.children) u3(A18);
      else c3.lines > l11 && (o > l11 || !o) ? (d4(), h3.push(c3)) : c3 instanceof k7 && o && (g8 = f6[f6.length - 1]) instanceof k7 && c3.lines + g8.lines <= 32 ? (o += c3.lines, a2 += c3.length + 1, f6[f6.length - 1] = new k7(g8.text.concat(c3.text), g8.length + 1 + c3.length)) : (o + c3.lines > i12 && d4(), o += c3.lines, a2 += c3.length + 1, f6.push(c3));
    }
    function d4() {
      o != 0 && (h3.push(f6.length == 1 ? f6[0] : s143.from(f6, a2)), a2 = -1, o = f6.length = 0);
    }
    for (let c3 of e7) u3(c3);
    return d4(), h3.length == 1 ? h3[0] : new s143(h3, t8);
  }
};
m5.empty = new k7([""], 0);
function je7(s212) {
  let e7 = -1;
  for (let t8 of s212) e7 += t8.length + 1;
  return e7;
}
function Q11(s212, e7, t8 = 0, n14 = 1e9) {
  for (let i12 = 0, r2 = 0, l11 = true; r2 < s212.length && i12 <= n14; r2++) {
    let h3 = s212[r2], o = i12 + h3.length;
    o >= t8 && (o > n14 && (h3 = h3.slice(0, n14 - i12)), i12 < t8 && (h3 = h3.slice(t8 - i12)), l11 ? (e7[e7.length - 1] += h3, l11 = false) : e7.push(h3)), i12 = o + 1;
  }
  return e7;
}
function Ae7(s212, e7, t8) {
  return Q11(s212, [""], e7, t8);
}
var M5 = class {
  constructor(e7, t8 = 1) {
    this.dir = t8, this.done = false, this.lineBreak = false, this.value = "", this.nodes = [e7], this.offsets = [t8 > 0 ? 1 : (e7 instanceof k7 ? e7.text.length : e7.children.length) << 1];
  }
  nextInner(e7, t8) {
    for (this.done = this.lineBreak = false; ; ) {
      let n14 = this.nodes.length - 1, i12 = this.nodes[n14], r2 = this.offsets[n14], l11 = r2 >> 1, h3 = i12 instanceof k7 ? i12.text.length : i12.children.length;
      if (l11 == (t8 > 0 ? h3 : 0)) {
        if (n14 == 0) return this.done = true, this.value = "", this;
        t8 > 0 && this.offsets[n14 - 1]++, this.nodes.pop(), this.offsets.pop();
      } else if ((r2 & 1) == (t8 > 0 ? 0 : 1)) {
        if (this.offsets[n14] += t8, e7 == 0) return this.lineBreak = true, this.value = `
`, this;
        e7--;
      } else if (i12 instanceof k7) {
        let o = i12.text[l11 + (t8 < 0 ? -1 : 0)];
        if (this.offsets[n14] += t8, o.length > Math.max(0, e7)) return this.value = e7 == 0 ? o : t8 > 0 ? o.slice(e7) : o.slice(0, o.length - e7), this;
        e7 -= o.length;
      } else {
        let o = i12.children[l11 + (t8 < 0 ? -1 : 0)];
        e7 > o.length ? (e7 -= o.length, this.offsets[n14] += t8) : (t8 < 0 && this.offsets[n14]--, this.nodes.push(o), this.offsets.push(t8 > 0 ? 1 : (o instanceof k7 ? o.text.length : o.children.length) << 1));
      }
    }
  }
  next(e7 = 0) {
    return e7 < 0 && (this.nextInner(-e7, -this.dir), e7 = this.value.length), this.nextInner(e7, this.dir);
  }
};
var X10 = class {
  constructor(e7, t8, n14) {
    this.value = "", this.done = false, this.cursor = new M5(e7, t8 > n14 ? -1 : 1), this.pos = t8 > n14 ? e7.length : 0, this.from = Math.min(t8, n14), this.to = Math.max(t8, n14);
  }
  nextInner(e7, t8) {
    if (t8 < 0 ? this.pos <= this.from : this.pos >= this.to) return this.value = "", this.done = true, this;
    e7 += Math.max(0, t8 < 0 ? this.pos - this.to : this.from - this.pos);
    let n14 = t8 < 0 ? this.pos - this.from : this.to - this.pos;
    e7 > n14 && (e7 = n14), n14 -= e7;
    let { value: i12 } = this.cursor.next(e7);
    return this.pos += (i12.length + e7) * t8, this.value = i12.length <= n14 ? i12 : t8 < 0 ? i12.slice(i12.length - n14) : i12.slice(0, n14), this.done = !this.value, this;
  }
  next(e7 = 0) {
    return e7 < 0 ? e7 = Math.max(e7, this.from - this.pos) : e7 > 0 && (e7 = Math.min(e7, this.to - this.pos)), this.nextInner(e7, this.cursor.dir);
  }
  get lineBreak() {
    return this.cursor.lineBreak && this.value != "";
  }
};
var Y12 = class {
  constructor(e7) {
    this.inner = e7, this.afterBreak = true, this.value = "", this.done = false;
  }
  next(e7 = 0) {
    let { done: t8, lineBreak: n14, value: i12 } = this.inner.next(e7);
    return t8 && this.afterBreak ? (this.value = "", this.afterBreak = false) : t8 ? (this.done = true, this.value = "") : n14 ? this.afterBreak ? this.value = "" : (this.afterBreak = true, this.next()) : (this.value = i12, this.afterBreak = false), this;
  }
  get lineBreak() {
    return false;
  }
};
typeof Symbol < "u" && (m5.prototype[Symbol.iterator] = function() {
  return this.iter();
}, M5.prototype[Symbol.iterator] = X10.prototype[Symbol.iterator] = Y12.prototype[Symbol.iterator] = function() {
  return this;
});
var ae8 = class {
  constructor(e7, t8, n14, i12) {
    this.from = e7, this.to = t8, this.number = n14, this.text = i12;
  }
  get length() {
    return this.to - this.from;
  }
};
var D8 = "lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((s212) => s212 ? parseInt(s212, 36) : 1);
for (let s212 = 1; s212 < D8.length; s212++) D8[s212] += D8[s212 - 1];
function He7(s212) {
  for (let e7 = 1; e7 < D8.length; e7 += 2) if (D8[e7] > s212) return D8[e7 - 1] <= s212;
  return false;
}
function Pe10(s212) {
  return s212 >= 127462 && s212 <= 127487;
}
var Ee11 = 8205;
function _11(s212, e7, t8 = true, n14 = true) {
  return (t8 ? Ce6 : Ze9)(s212, e7, n14);
}
function Ce6(s212, e7, t8) {
  if (e7 == s212.length) return e7;
  e7 && Fe10(s212.charCodeAt(e7)) && Je6(s212.charCodeAt(e7 - 1)) && e7--;
  let n14 = he10(s212, e7);
  for (e7 += be11(n14); e7 < s212.length; ) {
    let i12 = he10(s212, e7);
    if (n14 == Ee11 || i12 == Ee11 || t8 && He7(i12)) e7 += be11(i12), n14 = i12;
    else if (Pe10(i12)) {
      let r2 = 0, l11 = e7 - 2;
      for (; l11 >= 0 && Pe10(he10(s212, l11)); ) r2++, l11 -= 2;
      if (r2 % 2 == 0) break;
      e7 += 2;
    } else break;
  }
  return e7;
}
function Ze9(s212, e7, t8) {
  for (; e7 > 0; ) {
    let n14 = Ce6(s212, e7 - 2, t8);
    if (n14 < e7) return n14;
    e7--;
  }
  return 0;
}
function Fe10(s212) {
  return s212 >= 56320 && s212 < 57344;
}
function Je6(s212) {
  return s212 >= 55296 && s212 < 56320;
}
function he10(s212, e7) {
  let t8 = s212.charCodeAt(e7);
  if (!Je6(t8) || e7 + 1 == s212.length) return t8;
  let n14 = s212.charCodeAt(e7 + 1);
  return Fe10(n14) ? (t8 - 55296 << 10) + (n14 - 56320) + 65536 : t8;
}
function rt8(s212) {
  return s212 <= 65535 ? String.fromCharCode(s212) : (s212 -= 65536, String.fromCharCode((s212 >> 10) + 55296, (s212 & 1023) + 56320));
}
function be11(s212) {
  return s212 < 65536 ? 1 : 2;
}
var fe11 = /\r\n?|\n/;
var E6 = function(s212) {
  return s212[s212.Simple = 0] = "Simple", s212[s212.TrackDel = 1] = "TrackDel", s212[s212.TrackBefore = 2] = "TrackBefore", s212[s212.TrackAfter = 3] = "TrackAfter", s212;
}(E6 || (E6 = {}));
var C6 = class s144 {
  constructor(e7) {
    this.sections = e7;
  }
  get length() {
    let e7 = 0;
    for (let t8 = 0; t8 < this.sections.length; t8 += 2) e7 += this.sections[t8];
    return e7;
  }
  get newLength() {
    let e7 = 0;
    for (let t8 = 0; t8 < this.sections.length; t8 += 2) {
      let n14 = this.sections[t8 + 1];
      e7 += n14 < 0 ? this.sections[t8] : n14;
    }
    return e7;
  }
  get empty() {
    return this.sections.length == 0 || this.sections.length == 2 && this.sections[1] < 0;
  }
  iterGaps(e7) {
    for (let t8 = 0, n14 = 0, i12 = 0; t8 < this.sections.length; ) {
      let r2 = this.sections[t8++], l11 = this.sections[t8++];
      l11 < 0 ? (e7(n14, i12, r2), i12 += r2) : i12 += l11, n14 += r2;
    }
  }
  iterChangedRanges(e7, t8 = false) {
    ue10(this, e7, t8);
  }
  get invertedDesc() {
    let e7 = [];
    for (let t8 = 0; t8 < this.sections.length; ) {
      let n14 = this.sections[t8++], i12 = this.sections[t8++];
      i12 < 0 ? e7.push(n14, i12) : e7.push(i12, n14);
    }
    return new s144(e7);
  }
  composeDesc(e7) {
    return this.empty ? e7 : e7.empty ? this : Ne12(this, e7);
  }
  mapDesc(e7, t8 = false) {
    return e7.empty ? this : ce12(this, e7, t8);
  }
  mapPos(e7, t8 = -1, n14 = E6.Simple) {
    let i12 = 0, r2 = 0;
    for (let l11 = 0; l11 < this.sections.length; ) {
      let h3 = this.sections[l11++], o = this.sections[l11++], a2 = i12 + h3;
      if (o < 0) {
        if (a2 > e7) return r2 + (e7 - i12);
        r2 += h3;
      } else {
        if (n14 != E6.Simple && a2 >= e7 && (n14 == E6.TrackDel && i12 < e7 && a2 > e7 || n14 == E6.TrackBefore && i12 < e7 || n14 == E6.TrackAfter && a2 > e7)) return null;
        if (a2 > e7 || a2 == e7 && t8 < 0 && !h3) return e7 == i12 || t8 < 0 ? r2 : r2 + o;
        r2 += o;
      }
      i12 = a2;
    }
    if (e7 > i12) throw new RangeError(`Position ${e7} is out of range for changeset of length ${i12}`);
    return r2;
  }
  touchesRange(e7, t8 = e7) {
    for (let n14 = 0, i12 = 0; n14 < this.sections.length && i12 <= t8; ) {
      let r2 = this.sections[n14++], l11 = this.sections[n14++], h3 = i12 + r2;
      if (l11 >= 0 && i12 <= t8 && h3 >= e7) return i12 < e7 && h3 > t8 ? "cover" : true;
      i12 = h3;
    }
    return false;
  }
  toString() {
    let e7 = "";
    for (let t8 = 0; t8 < this.sections.length; ) {
      let n14 = this.sections[t8++], i12 = this.sections[t8++];
      e7 += (e7 ? " " : "") + n14 + (i12 >= 0 ? ":" + i12 : "");
    }
    return e7;
  }
  toJSON() {
    return this.sections;
  }
  static fromJSON(e7) {
    if (!Array.isArray(e7) || e7.length % 2 || e7.some((t8) => typeof t8 != "number")) throw new RangeError("Invalid JSON representation of ChangeDesc");
    return new s144(e7);
  }
  static create(e7) {
    return new s144(e7);
  }
};
var P12 = class s145 extends C6 {
  constructor(e7, t8) {
    super(e7), this.inserted = t8;
  }
  apply(e7) {
    if (this.length != e7.length) throw new RangeError("Applying change set to a document with the wrong length");
    return ue10(this, (t8, n14, i12, r2, l11) => e7 = e7.replace(i12, i12 + (n14 - t8), l11), false), e7;
  }
  mapDesc(e7, t8 = false) {
    return ce12(this, e7, t8, true);
  }
  invert(e7) {
    let t8 = this.sections.slice(), n14 = [];
    for (let i12 = 0, r2 = 0; i12 < t8.length; i12 += 2) {
      let l11 = t8[i12], h3 = t8[i12 + 1];
      if (h3 >= 0) {
        t8[i12] = h3, t8[i12 + 1] = l11;
        let o = i12 >> 1;
        for (; n14.length < o; ) n14.push(m5.empty);
        n14.push(l11 ? e7.slice(r2, r2 + l11) : m5.empty);
      }
      r2 += l11;
    }
    return new s145(t8, n14);
  }
  compose(e7) {
    return this.empty ? e7 : e7.empty ? this : Ne12(this, e7, true);
  }
  map(e7, t8 = false) {
    return e7.empty ? this : ce12(this, e7, t8, true);
  }
  iterChanges(e7, t8 = false) {
    ue10(this, e7, t8);
  }
  get desc() {
    return C6.create(this.sections);
  }
  filter(e7) {
    let t8 = [], n14 = [], i12 = [], r2 = new F12(this);
    e: for (let l11 = 0, h3 = 0; ; ) {
      let o = l11 == e7.length ? 1e9 : e7[l11++];
      for (; h3 < o || h3 == o && r2.len == 0; ) {
        if (r2.done) break e;
        let f6 = Math.min(r2.len, o - h3);
        w7(i12, f6, -1);
        let u3 = r2.ins == -1 ? -1 : r2.off == 0 ? r2.ins : 0;
        w7(t8, f6, u3), u3 > 0 && b6(n14, t8, r2.text), r2.forward(f6), h3 += f6;
      }
      let a2 = e7[l11++];
      for (; h3 < a2; ) {
        if (r2.done) break e;
        let f6 = Math.min(r2.len, a2 - h3);
        w7(t8, f6, -1), w7(i12, f6, r2.ins == -1 ? -1 : r2.off == 0 ? r2.ins : 0), r2.forward(f6), h3 += f6;
      }
    }
    return { changes: new s145(t8, n14), filtered: C6.create(i12) };
  }
  toJSON() {
    let e7 = [];
    for (let t8 = 0; t8 < this.sections.length; t8 += 2) {
      let n14 = this.sections[t8], i12 = this.sections[t8 + 1];
      i12 < 0 ? e7.push(n14) : i12 == 0 ? e7.push([n14]) : e7.push([n14].concat(this.inserted[t8 >> 1].toJSON()));
    }
    return e7;
  }
  static of(e7, t8, n14) {
    let i12 = [], r2 = [], l11 = 0, h3 = null;
    function o(f6 = false) {
      if (!f6 && !i12.length) return;
      l11 < t8 && w7(i12, t8 - l11, -1);
      let u3 = new s145(i12, r2);
      h3 = h3 ? h3.compose(u3.map(h3)) : u3, i12 = [], r2 = [], l11 = 0;
    }
    function a2(f6) {
      if (Array.isArray(f6)) for (let u3 of f6) a2(u3);
      else if (f6 instanceof s145) {
        if (f6.length != t8) throw new RangeError(`Mismatched change set length (got ${f6.length}, expected ${t8})`);
        o(), h3 = h3 ? h3.compose(f6.map(h3)) : f6;
      } else {
        let { from: u3, to: d4 = u3, insert: c3 } = f6;
        if (u3 > d4 || u3 < 0 || d4 > t8) throw new RangeError(`Invalid change range ${u3} to ${d4} (in doc of length ${t8})`);
        let g8 = c3 ? typeof c3 == "string" ? m5.of(c3.split(n14 || fe11)) : c3 : m5.empty, A18 = g8.length;
        if (u3 == d4 && A18 == 0) return;
        u3 < l11 && o(), u3 > l11 && w7(i12, u3 - l11, -1), w7(i12, d4 - u3, A18), b6(r2, i12, g8), l11 = d4;
      }
    }
    return a2(e7), o(!h3), h3;
  }
  static empty(e7) {
    return new s145(e7 ? [e7, -1] : [], []);
  }
  static fromJSON(e7) {
    if (!Array.isArray(e7)) throw new RangeError("Invalid JSON representation of ChangeSet");
    let t8 = [], n14 = [];
    for (let i12 = 0; i12 < e7.length; i12++) {
      let r2 = e7[i12];
      if (typeof r2 == "number") t8.push(r2, -1);
      else {
        if (!Array.isArray(r2) || typeof r2[0] != "number" || r2.some((l11, h3) => h3 && typeof l11 != "string")) throw new RangeError("Invalid JSON representation of ChangeSet");
        if (r2.length == 1) t8.push(r2[0], 0);
        else {
          for (; n14.length < i12; ) n14.push(m5.empty);
          n14[i12] = m5.of(r2.slice(1)), t8.push(r2[0], n14[i12].length);
        }
      }
    }
    return new s145(t8, n14);
  }
  static createSet(e7, t8) {
    return new s145(e7, t8);
  }
};
function w7(s212, e7, t8, n14 = false) {
  if (e7 == 0 && t8 <= 0) return;
  let i12 = s212.length - 2;
  i12 >= 0 && t8 <= 0 && t8 == s212[i12 + 1] ? s212[i12] += e7 : e7 == 0 && s212[i12] == 0 ? s212[i12 + 1] += t8 : n14 ? (s212[i12] += e7, s212[i12 + 1] += t8) : s212.push(e7, t8);
}
function b6(s212, e7, t8) {
  if (t8.length == 0) return;
  let n14 = e7.length - 2 >> 1;
  if (n14 < s212.length) s212[s212.length - 1] = s212[s212.length - 1].append(t8);
  else {
    for (; s212.length < n14; ) s212.push(m5.empty);
    s212.push(t8);
  }
}
function ue10(s212, e7, t8) {
  let n14 = s212.inserted;
  for (let i12 = 0, r2 = 0, l11 = 0; l11 < s212.sections.length; ) {
    let h3 = s212.sections[l11++], o = s212.sections[l11++];
    if (o < 0) i12 += h3, r2 += h3;
    else {
      let a2 = i12, f6 = r2, u3 = m5.empty;
      for (; a2 += h3, f6 += o, o && n14 && (u3 = u3.append(n14[l11 - 2 >> 1])), !(t8 || l11 == s212.sections.length || s212.sections[l11 + 1] < 0); ) h3 = s212.sections[l11++], o = s212.sections[l11++];
      e7(i12, a2, r2, f6, u3), i12 = a2, r2 = f6;
    }
  }
}
function ce12(s212, e7, t8, n14 = false) {
  let i12 = [], r2 = n14 ? [] : null, l11 = new F12(s212), h3 = new F12(e7);
  for (let o = -1; ; ) if (l11.ins == -1 && h3.ins == -1) {
    let a2 = Math.min(l11.len, h3.len);
    w7(i12, a2, -1), l11.forward(a2), h3.forward(a2);
  } else if (h3.ins >= 0 && (l11.ins < 0 || o == l11.i || l11.off == 0 && (h3.len < l11.len || h3.len == l11.len && !t8))) {
    let a2 = h3.len;
    for (w7(i12, h3.ins, -1); a2; ) {
      let f6 = Math.min(l11.len, a2);
      l11.ins >= 0 && o < l11.i && l11.len <= f6 && (w7(i12, 0, l11.ins), r2 && b6(r2, i12, l11.text), o = l11.i), l11.forward(f6), a2 -= f6;
    }
    h3.next();
  } else if (l11.ins >= 0) {
    let a2 = 0, f6 = l11.len;
    for (; f6; ) if (h3.ins == -1) {
      let u3 = Math.min(f6, h3.len);
      a2 += u3, f6 -= u3, h3.forward(u3);
    } else if (h3.ins == 0 && h3.len < f6) f6 -= h3.len, h3.next();
    else break;
    w7(i12, a2, o < l11.i ? l11.ins : 0), r2 && o < l11.i && b6(r2, i12, l11.text), o = l11.i, l11.forward(l11.len - f6);
  } else {
    if (l11.done && h3.done) return r2 ? P12.createSet(i12, r2) : C6.create(i12);
    throw new Error("Mismatched change set lengths");
  }
}
function Ne12(s212, e7, t8 = false) {
  let n14 = [], i12 = t8 ? [] : null, r2 = new F12(s212), l11 = new F12(e7);
  for (let h3 = false; ; ) {
    if (r2.done && l11.done) return i12 ? P12.createSet(n14, i12) : C6.create(n14);
    if (r2.ins == 0) w7(n14, r2.len, 0, h3), r2.next();
    else if (l11.len == 0 && !l11.done) w7(n14, 0, l11.ins, h3), i12 && b6(i12, n14, l11.text), l11.next();
    else {
      if (r2.done || l11.done) throw new Error("Mismatched change set lengths");
      {
        let o = Math.min(r2.len2, l11.len), a2 = n14.length;
        if (r2.ins == -1) {
          let f6 = l11.ins == -1 ? -1 : l11.off ? 0 : l11.ins;
          w7(n14, o, f6, h3), i12 && f6 && b6(i12, n14, l11.text);
        } else l11.ins == -1 ? (w7(n14, r2.off ? 0 : r2.len, o, h3), i12 && b6(i12, n14, r2.textBit(o))) : (w7(n14, r2.off ? 0 : r2.len, l11.off ? 0 : l11.ins, h3), i12 && !l11.off && b6(i12, n14, l11.text));
        h3 = (r2.ins > o || l11.ins >= 0 && l11.len > o) && (h3 || n14.length > a2), r2.forward2(o), l11.forward(o);
      }
    }
  }
}
var F12 = class {
  constructor(e7) {
    this.set = e7, this.i = 0, this.next();
  }
  next() {
    let { sections: e7 } = this.set;
    this.i < e7.length ? (this.len = e7[this.i++], this.ins = e7[this.i++]) : (this.len = 0, this.ins = -2), this.off = 0;
  }
  get done() {
    return this.ins == -2;
  }
  get len2() {
    return this.ins < 0 ? this.len : this.ins;
  }
  get text() {
    let { inserted: e7 } = this.set, t8 = this.i - 2 >> 1;
    return t8 >= e7.length ? m5.empty : e7[t8];
  }
  textBit(e7) {
    let { inserted: t8 } = this.set, n14 = this.i - 2 >> 1;
    return n14 >= t8.length && !e7 ? m5.empty : t8[n14].slice(this.off, e7 == null ? void 0 : this.off + e7);
  }
  forward(e7) {
    e7 == this.len ? this.next() : (this.len -= e7, this.off += e7);
  }
  forward2(e7) {
    this.ins == -1 ? this.forward(e7) : e7 == this.ins ? this.next() : (this.ins -= e7, this.off += e7);
  }
};
var N12 = class s146 {
  constructor(e7, t8, n14) {
    this.from = e7, this.to = t8, this.flags = n14;
  }
  get anchor() {
    return this.flags & 32 ? this.to : this.from;
  }
  get head() {
    return this.flags & 32 ? this.from : this.to;
  }
  get empty() {
    return this.from == this.to;
  }
  get assoc() {
    return this.flags & 8 ? -1 : this.flags & 16 ? 1 : 0;
  }
  get bidiLevel() {
    let e7 = this.flags & 7;
    return e7 == 7 ? null : e7;
  }
  get goalColumn() {
    let e7 = this.flags >> 6;
    return e7 == 16777215 ? void 0 : e7;
  }
  map(e7, t8 = -1) {
    let n14, i12;
    return this.empty ? n14 = i12 = e7.mapPos(this.from, t8) : (n14 = e7.mapPos(this.from, 1), i12 = e7.mapPos(this.to, -1)), n14 == this.from && i12 == this.to ? this : new s146(n14, i12, this.flags);
  }
  extend(e7, t8 = e7) {
    if (e7 <= this.anchor && t8 >= this.anchor) return x7.range(e7, t8);
    let n14 = Math.abs(e7 - this.anchor) > Math.abs(t8 - this.anchor) ? e7 : t8;
    return x7.range(this.anchor, n14);
  }
  eq(e7) {
    return this.anchor == e7.anchor && this.head == e7.head;
  }
  toJSON() {
    return { anchor: this.anchor, head: this.head };
  }
  static fromJSON(e7) {
    if (!e7 || typeof e7.anchor != "number" || typeof e7.head != "number") throw new RangeError("Invalid JSON representation for SelectionRange");
    return x7.range(e7.anchor, e7.head);
  }
  static create(e7, t8, n14) {
    return new s146(e7, t8, n14);
  }
};
var x7 = class s147 {
  constructor(e7, t8) {
    this.ranges = e7, this.mainIndex = t8;
  }
  map(e7, t8 = -1) {
    return e7.empty ? this : s147.create(this.ranges.map((n14) => n14.map(e7, t8)), this.mainIndex);
  }
  eq(e7) {
    if (this.ranges.length != e7.ranges.length || this.mainIndex != e7.mainIndex) return false;
    for (let t8 = 0; t8 < this.ranges.length; t8++) if (!this.ranges[t8].eq(e7.ranges[t8])) return false;
    return true;
  }
  get main() {
    return this.ranges[this.mainIndex];
  }
  asSingle() {
    return this.ranges.length == 1 ? this : new s147([this.main], 0);
  }
  addRange(e7, t8 = true) {
    return s147.create([e7].concat(this.ranges), t8 ? 0 : this.mainIndex + 1);
  }
  replaceRange(e7, t8 = this.mainIndex) {
    let n14 = this.ranges.slice();
    return n14[t8] = e7, s147.create(n14, this.mainIndex);
  }
  toJSON() {
    return { ranges: this.ranges.map((e7) => e7.toJSON()), main: this.mainIndex };
  }
  static fromJSON(e7) {
    if (!e7 || !Array.isArray(e7.ranges) || typeof e7.main != "number" || e7.main >= e7.ranges.length) throw new RangeError("Invalid JSON representation for EditorSelection");
    return new s147(e7.ranges.map((t8) => N12.fromJSON(t8)), e7.main);
  }
  static single(e7, t8 = e7) {
    return new s147([s147.range(e7, t8)], 0);
  }
  static create(e7, t8 = 0) {
    if (e7.length == 0) throw new RangeError("A selection needs at least one range");
    for (let n14 = 0, i12 = 0; i12 < e7.length; i12++) {
      let r2 = e7[i12];
      if (r2.empty ? r2.from <= n14 : r2.from < n14) return s147.normalized(e7.slice(), t8);
      n14 = r2.to;
    }
    return new s147(e7, t8);
  }
  static cursor(e7, t8 = 0, n14, i12) {
    return N12.create(e7, e7, (t8 == 0 ? 0 : t8 < 0 ? 8 : 16) | (n14 == null ? 7 : Math.min(6, n14)) | (i12 ?? 16777215) << 6);
  }
  static range(e7, t8, n14, i12) {
    let r2 = (n14 ?? 16777215) << 6 | (i12 == null ? 7 : Math.min(6, i12));
    return t8 < e7 ? N12.create(t8, e7, 48 | r2) : N12.create(e7, t8, (t8 > e7 ? 8 : 0) | r2);
  }
  static normalized(e7, t8 = 0) {
    let n14 = e7[t8];
    e7.sort((i12, r2) => i12.from - r2.from), t8 = e7.indexOf(n14);
    for (let i12 = 1; i12 < e7.length; i12++) {
      let r2 = e7[i12], l11 = e7[i12 - 1];
      if (r2.empty ? r2.from <= l11.to : r2.from < l11.to) {
        let h3 = l11.from, o = Math.max(r2.to, l11.to);
        i12 <= t8 && t8--, e7.splice(--i12, 2, r2.anchor > r2.head ? s147.range(o, h3) : s147.range(h3, o));
      }
    }
    return new s147(e7, t8);
  }
};
function Le9(s212, e7) {
  for (let t8 of s212.ranges) if (t8.to > e7) throw new RangeError("Selection points outside of document");
}
var Se7 = 0;
var y11 = class s148 {
  constructor(e7, t8, n14, i12, r2) {
    this.combine = e7, this.compareInput = t8, this.compare = n14, this.isStatic = i12, this.id = Se7++, this.default = e7([]), this.extensions = typeof r2 == "function" ? r2(this) : r2;
  }
  get reader() {
    return this;
  }
  static define(e7 = {}) {
    return new s148(e7.combine || ((t8) => t8), e7.compareInput || ((t8, n14) => t8 === n14), e7.compare || (e7.combine ? (t8, n14) => t8 === n14 : Ie8), !!e7.static, e7.enables);
  }
  of(e7) {
    return new V13([], this, 0, e7);
  }
  compute(e7, t8) {
    if (this.isStatic) throw new Error("Can't compute a static facet");
    return new V13(e7, this, 1, t8);
  }
  computeN(e7, t8) {
    if (this.isStatic) throw new Error("Can't compute a static facet");
    return new V13(e7, this, 2, t8);
  }
  from(e7, t8) {
    return t8 || (t8 = (n14) => n14), this.compute([e7], (n14) => t8(n14.field(e7)));
  }
};
function Ie8(s212, e7) {
  return s212 == e7 || s212.length == e7.length && s212.every((t8, n14) => t8 === e7[n14]);
}
var V13 = class {
  constructor(e7, t8, n14, i12) {
    this.dependencies = e7, this.facet = t8, this.type = n14, this.value = i12, this.id = Se7++;
  }
  dynamicSlot(e7) {
    var t8;
    let n14 = this.value, i12 = this.facet.compareInput, r2 = this.id, l11 = e7[r2] >> 1, h3 = this.type == 2, o = false, a2 = false, f6 = [];
    for (let u3 of this.dependencies) u3 == "doc" ? o = true : u3 == "selection" ? a2 = true : ((t8 = e7[u3.id]) !== null && t8 !== void 0 ? t8 : 1) & 1 || f6.push(e7[u3.id]);
    return { create(u3) {
      return u3.values[l11] = n14(u3), 1;
    }, update(u3, d4) {
      if (o && d4.docChanged || a2 && (d4.docChanged || d4.selection) || de8(u3, f6)) {
        let c3 = n14(u3);
        if (h3 ? !Oe7(c3, u3.values[l11], i12) : !i12(c3, u3.values[l11])) return u3.values[l11] = c3, 1;
      }
      return 0;
    }, reconfigure: (u3, d4) => {
      let c3, g8 = d4.config.address[r2];
      if (g8 != null) {
        let A18 = ie5(d4, g8);
        if (this.dependencies.every((p3) => p3 instanceof y11 ? d4.facet(p3) === u3.facet(p3) : p3 instanceof $9 ? d4.field(p3, false) == u3.field(p3, false) : true) || (h3 ? Oe7(c3 = n14(u3), A18, i12) : i12(c3 = n14(u3), A18))) return u3.values[l11] = A18, 0;
      } else c3 = n14(u3);
      return u3.values[l11] = c3, 1;
    } };
  }
};
function Oe7(s212, e7, t8) {
  if (s212.length != e7.length) return false;
  for (let n14 = 0; n14 < s212.length; n14++) if (!t8(s212[n14], e7[n14])) return false;
  return true;
}
function de8(s212, e7) {
  let t8 = false;
  for (let n14 of e7) U12(s212, n14) & 1 && (t8 = true);
  return t8;
}
function Ke9(s212, e7, t8) {
  let n14 = t8.map((o) => s212[o.id]), i12 = t8.map((o) => o.type), r2 = n14.filter((o) => !(o & 1)), l11 = s212[e7.id] >> 1;
  function h3(o) {
    let a2 = [];
    for (let f6 = 0; f6 < n14.length; f6++) {
      let u3 = ie5(o, n14[f6]);
      if (i12[f6] == 2) for (let d4 of u3) a2.push(d4);
      else a2.push(u3);
    }
    return e7.combine(a2);
  }
  return { create(o) {
    for (let a2 of n14) U12(o, a2);
    return o.values[l11] = h3(o), 1;
  }, update(o, a2) {
    if (!de8(o, r2)) return 0;
    let f6 = h3(o);
    return e7.compare(f6, o.values[l11]) ? 0 : (o.values[l11] = f6, 1);
  }, reconfigure(o, a2) {
    let f6 = de8(o, n14), u3 = a2.config.facets[e7.id], d4 = a2.facet(e7);
    if (u3 && !f6 && Ie8(t8, u3)) return o.values[l11] = d4, 0;
    let c3 = h3(o);
    return e7.compare(c3, d4) ? (o.values[l11] = d4, 0) : (o.values[l11] = c3, 1);
  } };
}
var Te8 = y11.define({ static: true });
var $9 = class s149 {
  constructor(e7, t8, n14, i12, r2) {
    this.id = e7, this.createF = t8, this.updateF = n14, this.compareF = i12, this.spec = r2, this.provides = void 0;
  }
  static define(e7) {
    let t8 = new s149(Se7++, e7.create, e7.update, e7.compare || ((n14, i12) => n14 === i12), e7);
    return e7.provide && (t8.provides = e7.provide(t8)), t8;
  }
  create(e7) {
    let t8 = e7.facet(Te8).find((n14) => n14.field == this);
    return (t8?.create || this.createF)(e7);
  }
  slot(e7) {
    let t8 = e7[this.id] >> 1;
    return { create: (n14) => (n14.values[t8] = this.create(n14), 1), update: (n14, i12) => {
      let r2 = n14.values[t8], l11 = this.updateF(r2, i12);
      return this.compareF(r2, l11) ? 0 : (n14.values[t8] = l11, 1);
    }, reconfigure: (n14, i12) => i12.config.address[this.id] != null ? (n14.values[t8] = i12.field(this), 0) : (n14.values[t8] = this.create(n14), 1) };
  }
  init(e7) {
    return [this, Te8.of({ field: this, create: e7 })];
  }
  get extension() {
    return this;
  }
};
var R10 = { lowest: 4, low: 3, default: 2, high: 1, highest: 0 };
function W10(s212) {
  return (e7) => new ee7(e7, s212);
}
var lt8 = { highest: W10(R10.highest), high: W10(R10.high), default: W10(R10.default), low: W10(R10.low), lowest: W10(R10.lowest) };
var ee7 = class {
  constructor(e7, t8) {
    this.inner = e7, this.prec = t8;
  }
};
var te10 = class s150 {
  of(e7) {
    return new G12(this, e7);
  }
  reconfigure(e7) {
    return s150.reconfigure.of({ compartment: this, extension: e7 });
  }
  get(e7) {
    return e7.config.compartments.get(this);
  }
};
var G12 = class {
  constructor(e7, t8) {
    this.compartment = e7, this.inner = t8;
  }
};
var ne9 = class s151 {
  constructor(e7, t8, n14, i12, r2, l11) {
    for (this.base = e7, this.compartments = t8, this.dynamicSlots = n14, this.address = i12, this.staticValues = r2, this.facets = l11, this.statusTemplate = []; this.statusTemplate.length < n14.length; ) this.statusTemplate.push(0);
  }
  staticFacet(e7) {
    let t8 = this.address[e7.id];
    return t8 == null ? e7.default : this.staticValues[t8 >> 1];
  }
  static resolve(e7, t8, n14) {
    let i12 = [], r2 = /* @__PURE__ */ Object.create(null), l11 = /* @__PURE__ */ new Map();
    for (let d4 of Qe7(e7, t8, l11)) d4 instanceof $9 ? i12.push(d4) : (r2[d4.facet.id] || (r2[d4.facet.id] = [])).push(d4);
    let h3 = /* @__PURE__ */ Object.create(null), o = [], a2 = [];
    for (let d4 of i12) h3[d4.id] = a2.length << 1, a2.push((c3) => d4.slot(c3));
    let f6 = n14?.config.facets;
    for (let d4 in r2) {
      let c3 = r2[d4], g8 = c3[0].facet, A18 = f6 && f6[d4] || [];
      if (c3.every((p3) => p3.type == 0)) if (h3[g8.id] = o.length << 1 | 1, Ie8(A18, c3)) o.push(n14.facet(g8));
      else {
        let p3 = g8.combine(c3.map((le18) => le18.value));
        o.push(n14 && g8.compare(p3, n14.facet(g8)) ? n14.facet(g8) : p3);
      }
      else {
        for (let p3 of c3) p3.type == 0 ? (h3[p3.id] = o.length << 1 | 1, o.push(p3.value)) : (h3[p3.id] = a2.length << 1, a2.push((le18) => p3.dynamicSlot(le18)));
        h3[g8.id] = a2.length << 1, a2.push((p3) => Ke9(p3, g8, c3));
      }
    }
    let u3 = a2.map((d4) => d4(h3));
    return new s151(e7, l11, u3, h3, o, r2);
  }
};
function Qe7(s212, e7, t8) {
  let n14 = [[], [], [], [], []], i12 = /* @__PURE__ */ new Map();
  function r2(l11, h3) {
    let o = i12.get(l11);
    if (o != null) {
      if (o <= h3) return;
      let a2 = n14[o].indexOf(l11);
      a2 > -1 && n14[o].splice(a2, 1), l11 instanceof G12 && t8.delete(l11.compartment);
    }
    if (i12.set(l11, h3), Array.isArray(l11)) for (let a2 of l11) r2(a2, h3);
    else if (l11 instanceof G12) {
      if (t8.has(l11.compartment)) throw new RangeError("Duplicate use of compartment in extensions");
      let a2 = e7.get(l11.compartment) || l11.inner;
      t8.set(l11.compartment, a2), r2(a2, h3);
    } else if (l11 instanceof ee7) r2(l11.inner, l11.prec);
    else if (l11 instanceof $9) n14[h3].push(l11), l11.provides && r2(l11.provides, h3);
    else if (l11 instanceof V13) n14[h3].push(l11), l11.facet.extensions && r2(l11.facet.extensions, R10.default);
    else {
      let a2 = l11.extension;
      if (!a2) throw new Error(`Unrecognized extension value in extension set (${l11}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);
      r2(a2, h3);
    }
  }
  return r2(s212, R10.default), n14.reduce((l11, h3) => l11.concat(h3));
}
function U12(s212, e7) {
  if (e7 & 1) return 2;
  let t8 = e7 >> 1, n14 = s212.status[t8];
  if (n14 == 4) throw new Error("Cyclic dependency between fields and/or facets");
  if (n14 & 2) return n14;
  s212.status[t8] = 4;
  let i12 = s212.computeSlot(s212, s212.config.dynamicSlots[t8]);
  return s212.status[t8] = 2 | i12;
}
function ie5(s212, e7) {
  return e7 & 1 ? s212.config.staticValues[e7 >> 1] : s212.values[e7 >> 1];
}
var De8 = y11.define();
var ge12 = y11.define({ combine: (s212) => s212.some((e7) => e7), static: true });
var Ve9 = y11.define({ combine: (s212) => s212.length ? s212[0] : void 0, static: true });
var qe9 = y11.define();
var $e10 = y11.define();
var ze10 = y11.define();
var We10 = y11.define({ combine: (s212) => s212.length ? s212[0] : false });
var J8 = class {
  constructor(e7, t8) {
    this.type = e7, this.value = t8;
  }
  static define() {
    return new pe10();
  }
};
var pe10 = class {
  of(e7) {
    return new J8(this, e7);
  }
};
var me11 = class {
  constructor(e7) {
    this.map = e7;
  }
  of(e7) {
    return new v5(this, e7);
  }
};
var v5 = class s152 {
  constructor(e7, t8) {
    this.type = e7, this.value = t8;
  }
  map(e7) {
    let t8 = this.type.map(this.value, e7);
    return t8 === void 0 ? void 0 : t8 == this.value ? this : new s152(this.type, t8);
  }
  is(e7) {
    return this.type == e7;
  }
  static define(e7 = {}) {
    return new me11(e7.map || ((t8) => t8));
  }
  static mapEffects(e7, t8) {
    if (!e7.length) return e7;
    let n14 = [];
    for (let i12 of e7) {
      let r2 = i12.map(t8);
      r2 && n14.push(r2);
    }
    return n14;
  }
};
v5.reconfigure = v5.define();
v5.appendConfig = v5.define();
var S10 = class s153 {
  constructor(e7, t8, n14, i12, r2, l11) {
    this.startState = e7, this.changes = t8, this.selection = n14, this.effects = i12, this.annotations = r2, this.scrollIntoView = l11, this._doc = null, this._state = null, n14 && Le9(n14, t8.newLength), r2.some((h3) => h3.type == s153.time) || (this.annotations = r2.concat(s153.time.of(Date.now())));
  }
  static create(e7, t8, n14, i12, r2, l11) {
    return new s153(e7, t8, n14, i12, r2, l11);
  }
  get newDoc() {
    return this._doc || (this._doc = this.changes.apply(this.startState.doc));
  }
  get newSelection() {
    return this.selection || this.startState.selection.map(this.changes);
  }
  get state() {
    return this._state || this.startState.applyTransaction(this), this._state;
  }
  annotation(e7) {
    for (let t8 of this.annotations) if (t8.type == e7) return t8.value;
  }
  get docChanged() {
    return !this.changes.empty;
  }
  get reconfigured() {
    return this.startState.config != this.state.config;
  }
  isUserEvent(e7) {
    let t8 = this.annotation(s153.userEvent);
    return !!(t8 && (t8 == e7 || t8.length > e7.length && t8.slice(0, e7.length) == e7 && t8[e7.length] == "."));
  }
};
S10.time = J8.define();
S10.userEvent = J8.define();
S10.addToHistory = J8.define();
S10.remote = J8.define();
function Xe8(s212, e7) {
  let t8 = [];
  for (let n14 = 0, i12 = 0; ; ) {
    let r2, l11;
    if (n14 < s212.length && (i12 == e7.length || e7[i12] >= s212[n14])) r2 = s212[n14++], l11 = s212[n14++];
    else if (i12 < e7.length) r2 = e7[i12++], l11 = e7[i12++];
    else return t8;
    !t8.length || t8[t8.length - 1] < r2 ? t8.push(r2, l11) : t8[t8.length - 1] < l11 && (t8[t8.length - 1] = l11);
  }
}
function Ue8(s212, e7, t8) {
  var n14;
  let i12, r2, l11;
  return t8 ? (i12 = e7.changes, r2 = P12.empty(e7.changes.length), l11 = s212.changes.compose(e7.changes)) : (i12 = e7.changes.map(s212.changes), r2 = s212.changes.mapDesc(e7.changes, true), l11 = s212.changes.compose(i12)), { changes: l11, selection: e7.selection ? e7.selection.map(r2) : (n14 = s212.selection) === null || n14 === void 0 ? void 0 : n14.map(i12), effects: v5.mapEffects(s212.effects, i12).concat(v5.mapEffects(e7.effects, r2)), annotations: s212.annotations.length ? s212.annotations.concat(e7.annotations) : e7.annotations, scrollIntoView: s212.scrollIntoView || e7.scrollIntoView };
}
function we11(s212, e7, t8) {
  let n14 = e7.selection, i12 = q9(e7.annotations);
  return e7.userEvent && (i12 = i12.concat(S10.userEvent.of(e7.userEvent))), { changes: e7.changes instanceof P12 ? e7.changes : P12.of(e7.changes || [], t8, s212.facet(Ve9)), selection: n14 && (n14 instanceof x7 ? n14 : x7.single(n14.anchor, n14.head)), effects: q9(e7.effects), annotations: i12, scrollIntoView: !!e7.scrollIntoView };
}
function Ge8(s212, e7, t8) {
  let n14 = we11(s212, e7.length ? e7[0] : {}, s212.doc.length);
  e7.length && e7[0].filter === false && (t8 = false);
  for (let r2 = 1; r2 < e7.length; r2++) {
    e7[r2].filter === false && (t8 = false);
    let l11 = !!e7[r2].sequential;
    n14 = Ue8(n14, we11(s212, e7[r2], l11 ? n14.changes.newLength : s212.doc.length), l11);
  }
  let i12 = S10.create(s212, n14.changes, n14.selection, n14.effects, n14.annotations, n14.scrollIntoView);
  return _e6(t8 ? Ye8(i12) : i12);
}
function Ye8(s212) {
  let e7 = s212.startState, t8 = true;
  for (let i12 of e7.facet(qe9)) {
    let r2 = i12(s212);
    if (r2 === false) {
      t8 = false;
      break;
    }
    Array.isArray(r2) && (t8 = t8 === true ? r2 : Xe8(t8, r2));
  }
  if (t8 !== true) {
    let i12, r2;
    if (t8 === false) r2 = s212.changes.invertedDesc, i12 = P12.empty(e7.doc.length);
    else {
      let l11 = s212.changes.filter(t8);
      i12 = l11.changes, r2 = l11.filtered.mapDesc(l11.changes).invertedDesc;
    }
    s212 = S10.create(e7, i12, s212.selection && s212.selection.map(r2), v5.mapEffects(s212.effects, r2), s212.annotations, s212.scrollIntoView);
  }
  let n14 = e7.facet($e10);
  for (let i12 = n14.length - 1; i12 >= 0; i12--) {
    let r2 = n14[i12](s212);
    r2 instanceof S10 ? s212 = r2 : Array.isArray(r2) && r2.length == 1 && r2[0] instanceof S10 ? s212 = r2[0] : s212 = Ge8(e7, q9(r2), false);
  }
  return s212;
}
function _e6(s212) {
  let e7 = s212.startState, t8 = e7.facet(ze10), n14 = s212;
  for (let i12 = t8.length - 1; i12 >= 0; i12--) {
    let r2 = t8[i12](s212);
    r2 && Object.keys(r2).length && (n14 = Ue8(n14, we11(e7, r2, s212.changes.newLength), true));
  }
  return n14 == s212 ? s212 : S10.create(e7, s212.changes, s212.selection, n14.effects, n14.annotations, n14.scrollIntoView);
}
var et5 = [];
function q9(s212) {
  return s212 == null ? et5 : Array.isArray(s212) ? s212 : [s212];
}
var O11 = function(s212) {
  return s212[s212.Word = 0] = "Word", s212[s212.Space = 1] = "Space", s212[s212.Other = 2] = "Other", s212;
}(O11 || (O11 = {}));
var tt5 = /[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;
var ve9;
try {
  ve9 = new RegExp("[\\p{Alphabetic}\\p{Number}_]", "u");
} catch {
}
function nt8(s212) {
  if (ve9) return ve9.test(s212);
  for (let e7 = 0; e7 < s212.length; e7++) {
    let t8 = s212[e7];
    if (/\w/.test(t8) || t8 > "Â€" && (t8.toUpperCase() != t8.toLowerCase() || tt5.test(t8))) return true;
  }
  return false;
}
function it5(s212) {
  return (e7) => {
    if (!/\S/.test(e7)) return O11.Space;
    if (nt8(e7)) return O11.Word;
    for (let t8 = 0; t8 < s212.length; t8++) if (e7.indexOf(s212[t8]) > -1) return O11.Word;
    return O11.Other;
  };
}
var I11 = class s154 {
  constructor(e7, t8, n14, i12, r2, l11) {
    this.config = e7, this.doc = t8, this.selection = n14, this.values = i12, this.status = e7.statusTemplate.slice(), this.computeSlot = r2, l11 && (l11._state = this);
    for (let h3 = 0; h3 < this.config.dynamicSlots.length; h3++) U12(this, h3 << 1);
    this.computeSlot = null;
  }
  field(e7, t8 = true) {
    let n14 = this.config.address[e7.id];
    if (n14 == null) {
      if (t8) throw new RangeError("Field is not present in this state");
      return;
    }
    return U12(this, n14), ie5(this, n14);
  }
  update(...e7) {
    return Ge8(this, e7, true);
  }
  applyTransaction(e7) {
    let t8 = this.config, { base: n14, compartments: i12 } = t8;
    for (let h3 of e7.effects) h3.is(te10.reconfigure) ? (t8 && (i12 = /* @__PURE__ */ new Map(), t8.compartments.forEach((o, a2) => i12.set(a2, o)), t8 = null), i12.set(h3.value.compartment, h3.value.extension)) : h3.is(v5.reconfigure) ? (t8 = null, n14 = h3.value) : h3.is(v5.appendConfig) && (t8 = null, n14 = q9(n14).concat(h3.value));
    let r2;
    t8 ? r2 = e7.startState.values.slice() : (t8 = ne9.resolve(n14, i12, this), r2 = new s154(t8, this.doc, this.selection, t8.dynamicSlots.map(() => null), (o, a2) => a2.reconfigure(o, this), null).values);
    let l11 = e7.startState.facet(ge12) ? e7.newSelection : e7.newSelection.asSingle();
    new s154(t8, e7.newDoc, l11, r2, (h3, o) => o.update(h3, e7), e7);
  }
  replaceSelection(e7) {
    return typeof e7 == "string" && (e7 = this.toText(e7)), this.changeByRange((t8) => ({ changes: { from: t8.from, to: t8.to, insert: e7 }, range: x7.cursor(t8.from + e7.length) }));
  }
  changeByRange(e7) {
    let t8 = this.selection, n14 = e7(t8.ranges[0]), i12 = this.changes(n14.changes), r2 = [n14.range], l11 = q9(n14.effects);
    for (let h3 = 1; h3 < t8.ranges.length; h3++) {
      let o = e7(t8.ranges[h3]), a2 = this.changes(o.changes), f6 = a2.map(i12);
      for (let d4 = 0; d4 < h3; d4++) r2[d4] = r2[d4].map(f6);
      let u3 = i12.mapDesc(a2, true);
      r2.push(o.range.map(u3)), i12 = i12.compose(f6), l11 = v5.mapEffects(l11, f6).concat(v5.mapEffects(q9(o.effects), u3));
    }
    return { changes: i12, selection: x7.create(r2, t8.mainIndex), effects: l11 };
  }
  changes(e7 = []) {
    return e7 instanceof P12 ? e7 : P12.of(e7, this.doc.length, this.facet(s154.lineSeparator));
  }
  toText(e7) {
    return m5.of(e7.split(this.facet(s154.lineSeparator) || fe11));
  }
  sliceDoc(e7 = 0, t8 = this.doc.length) {
    return this.doc.sliceString(e7, t8, this.lineBreak);
  }
  facet(e7) {
    let t8 = this.config.address[e7.id];
    return t8 == null ? e7.default : (U12(this, t8), ie5(this, t8));
  }
  toJSON(e7) {
    let t8 = { doc: this.sliceDoc(), selection: this.selection.toJSON() };
    if (e7) for (let n14 in e7) {
      let i12 = e7[n14];
      i12 instanceof $9 && this.config.address[i12.id] != null && (t8[n14] = i12.spec.toJSON(this.field(e7[n14]), this));
    }
    return t8;
  }
  static fromJSON(e7, t8 = {}, n14) {
    if (!e7 || typeof e7.doc != "string") throw new RangeError("Invalid JSON representation for EditorState");
    let i12 = [];
    if (n14) {
      for (let r2 in n14) if (Object.prototype.hasOwnProperty.call(e7, r2)) {
        let l11 = n14[r2], h3 = e7[r2];
        i12.push(l11.init((o) => l11.spec.fromJSON(h3, o)));
      }
    }
    return s154.create({ doc: e7.doc, selection: x7.fromJSON(e7.selection), extensions: t8.extensions ? i12.concat([t8.extensions]) : i12 });
  }
  static create(e7 = {}) {
    let t8 = ne9.resolve(e7.extensions || [], /* @__PURE__ */ new Map()), n14 = e7.doc instanceof m5 ? e7.doc : m5.of((e7.doc || "").split(t8.staticFacet(s154.lineSeparator) || fe11)), i12 = e7.selection ? e7.selection instanceof x7 ? e7.selection : x7.single(e7.selection.anchor, e7.selection.head) : x7.single(0);
    return Le9(i12, n14.length), t8.staticFacet(ge12) || (i12 = i12.asSingle()), new s154(t8, n14, i12, t8.dynamicSlots.map(() => null), (r2, l11) => l11.create(r2), null);
  }
  get tabSize() {
    return this.facet(s154.tabSize);
  }
  get lineBreak() {
    return this.facet(s154.lineSeparator) || `
`;
  }
  get readOnly() {
    return this.facet(We10);
  }
  phrase(e7, ...t8) {
    for (let n14 of this.facet(s154.phrases)) if (Object.prototype.hasOwnProperty.call(n14, e7)) {
      e7 = n14[e7];
      break;
    }
    return t8.length && (e7 = e7.replace(/\$(\$|\d*)/g, (n14, i12) => {
      if (i12 == "$") return "$";
      let r2 = +(i12 || 1);
      return !r2 || r2 > t8.length ? n14 : t8[r2 - 1];
    })), e7;
  }
  languageDataAt(e7, t8, n14 = -1) {
    let i12 = [];
    for (let r2 of this.facet(De8)) for (let l11 of r2(this, t8, n14)) Object.prototype.hasOwnProperty.call(l11, e7) && i12.push(l11[e7]);
    return i12;
  }
  charCategorizer(e7) {
    return it5(this.languageDataAt("wordChars", e7).join(""));
  }
  wordAt(e7) {
    let { text: t8, from: n14, length: i12 } = this.doc.lineAt(e7), r2 = this.charCategorizer(e7), l11 = e7 - n14, h3 = e7 - n14;
    for (; l11 > 0; ) {
      let o = _11(t8, l11, false);
      if (r2(t8.slice(o, l11)) != O11.Word) break;
      l11 = o;
    }
    for (; h3 < i12; ) {
      let o = _11(t8, h3);
      if (r2(t8.slice(h3, o)) != O11.Word) break;
      h3 = o;
    }
    return l11 == h3 ? null : x7.range(l11 + n14, h3 + n14);
  }
};
I11.allowMultipleSelections = ge12;
I11.tabSize = y11.define({ combine: (s212) => s212.length ? s212[0] : 4 });
I11.lineSeparator = Ve9;
I11.readOnly = We10;
I11.phrases = y11.define({ compare(s212, e7) {
  let t8 = Object.keys(s212), n14 = Object.keys(e7);
  return t8.length == n14.length && t8.every((i12) => s212[i12] == e7[i12]);
} });
I11.languageData = De8;
I11.changeFilter = qe9;
I11.transactionFilter = $e10;
I11.transactionExtender = ze10;
te10.reconfigure = v5.define();
function ht8(s212, e7, t8 = {}) {
  let n14 = {};
  for (let i12 of s212) for (let r2 of Object.keys(i12)) {
    let l11 = i12[r2], h3 = n14[r2];
    if (h3 === void 0) n14[r2] = l11;
    else if (!(h3 === l11 || l11 === void 0)) if (Object.hasOwnProperty.call(t8, r2)) n14[r2] = t8[r2](h3, l11);
    else throw new Error("Config merge conflict for field " + r2);
  }
  for (let i12 in e7) n14[i12] === void 0 && (n14[i12] = e7[i12]);
  return n14;
}
var z11 = class {
  eq(e7) {
    return this == e7;
  }
  range(e7, t8 = e7) {
    return j11.create(e7, t8, this);
  }
};
z11.prototype.startSide = z11.prototype.endSide = 0;
z11.prototype.point = false;
z11.prototype.mapMode = E6.TrackDel;
var j11 = class s155 {
  constructor(e7, t8, n14) {
    this.from = e7, this.to = t8, this.value = n14;
  }
  static create(e7, t8, n14) {
    return new s155(e7, t8, n14);
  }
};
function xe11(s212, e7) {
  return s212.from - e7.from || s212.value.startSide - e7.value.startSide;
}
var ke9 = class s156 {
  constructor(e7, t8, n14, i12) {
    this.from = e7, this.to = t8, this.value = n14, this.maxPoint = i12;
  }
  get length() {
    return this.to[this.to.length - 1];
  }
  findIndex(e7, t8, n14, i12 = 0) {
    let r2 = n14 ? this.to : this.from;
    for (let l11 = i12, h3 = r2.length; ; ) {
      if (l11 == h3) return l11;
      let o = l11 + h3 >> 1, a2 = r2[o] - e7 || (n14 ? this.value[o].endSide : this.value[o].startSide) - t8;
      if (o == l11) return a2 >= 0 ? l11 : h3;
      a2 >= 0 ? h3 = o : l11 = o + 1;
    }
  }
  between(e7, t8, n14, i12) {
    for (let r2 = this.findIndex(t8, -1e9, true), l11 = this.findIndex(n14, 1e9, false, r2); r2 < l11; r2++) if (i12(this.from[r2] + e7, this.to[r2] + e7, this.value[r2]) === false) return false;
  }
  map(e7, t8) {
    let n14 = [], i12 = [], r2 = [], l11 = -1, h3 = -1;
    for (let o = 0; o < this.value.length; o++) {
      let a2 = this.value[o], f6 = this.from[o] + e7, u3 = this.to[o] + e7, d4, c3;
      if (f6 == u3) {
        let g8 = t8.mapPos(f6, a2.startSide, a2.mapMode);
        if (g8 == null || (d4 = c3 = g8, a2.startSide != a2.endSide && (c3 = t8.mapPos(f6, a2.endSide), c3 < d4))) continue;
      } else if (d4 = t8.mapPos(f6, a2.startSide), c3 = t8.mapPos(u3, a2.endSide), d4 > c3 || d4 == c3 && a2.startSide > 0 && a2.endSide <= 0) continue;
      (c3 - d4 || a2.endSide - a2.startSide) < 0 || (l11 < 0 && (l11 = d4), a2.point && (h3 = Math.max(h3, c3 - d4)), n14.push(a2), i12.push(d4 - l11), r2.push(c3 - l11));
    }
    return { mapped: n14.length ? new s156(i12, r2, n14, h3) : null, pos: l11 };
  }
};
var T11 = class s157 {
  constructor(e7, t8, n14, i12) {
    this.chunkPos = e7, this.chunk = t8, this.nextLayer = n14, this.maxPoint = i12;
  }
  static create(e7, t8, n14, i12) {
    return new s157(e7, t8, n14, i12);
  }
  get length() {
    let e7 = this.chunk.length - 1;
    return e7 < 0 ? 0 : Math.max(this.chunkEnd(e7), this.nextLayer.length);
  }
  get size() {
    if (this.isEmpty) return 0;
    let e7 = this.nextLayer.size;
    for (let t8 of this.chunk) e7 += t8.value.length;
    return e7;
  }
  chunkEnd(e7) {
    return this.chunkPos[e7] + this.chunk[e7].length;
  }
  update(e7) {
    let { add: t8 = [], sort: n14 = false, filterFrom: i12 = 0, filterTo: r2 = this.length } = e7, l11 = e7.filter;
    if (t8.length == 0 && !l11) return this;
    if (n14 && (t8 = t8.slice().sort(xe11)), this.isEmpty) return t8.length ? s157.of(t8) : this;
    let h3 = new re8(this, null, -1).goto(0), o = 0, a2 = [], f6 = new se7();
    for (; h3.value || o < t8.length; ) if (o < t8.length && (h3.from - t8[o].from || h3.startSide - t8[o].value.startSide) >= 0) {
      let u3 = t8[o++];
      f6.addInner(u3.from, u3.to, u3.value) || a2.push(u3);
    } else h3.rangeIndex == 1 && h3.chunkIndex < this.chunk.length && (o == t8.length || this.chunkEnd(h3.chunkIndex) < t8[o].from) && (!l11 || i12 > this.chunkEnd(h3.chunkIndex) || r2 < this.chunkPos[h3.chunkIndex]) && f6.addChunk(this.chunkPos[h3.chunkIndex], this.chunk[h3.chunkIndex]) ? h3.nextChunk() : ((!l11 || i12 > h3.to || r2 < h3.from || l11(h3.from, h3.to, h3.value)) && (f6.addInner(h3.from, h3.to, h3.value) || a2.push(j11.create(h3.from, h3.to, h3.value))), h3.next());
    return f6.finishInner(this.nextLayer.isEmpty && !a2.length ? s157.empty : this.nextLayer.update({ add: a2, filter: l11, filterFrom: i12, filterTo: r2 }));
  }
  map(e7) {
    if (e7.empty || this.isEmpty) return this;
    let t8 = [], n14 = [], i12 = -1;
    for (let l11 = 0; l11 < this.chunk.length; l11++) {
      let h3 = this.chunkPos[l11], o = this.chunk[l11], a2 = e7.touchesRange(h3, h3 + o.length);
      if (a2 === false) i12 = Math.max(i12, o.maxPoint), t8.push(o), n14.push(e7.mapPos(h3));
      else if (a2 === true) {
        let { mapped: f6, pos: u3 } = o.map(h3, e7);
        f6 && (i12 = Math.max(i12, f6.maxPoint), t8.push(f6), n14.push(u3));
      }
    }
    let r2 = this.nextLayer.map(e7);
    return t8.length == 0 ? r2 : new s157(n14, t8, r2 || s157.empty, i12);
  }
  between(e7, t8, n14) {
    if (!this.isEmpty) {
      for (let i12 = 0; i12 < this.chunk.length; i12++) {
        let r2 = this.chunkPos[i12], l11 = this.chunk[i12];
        if (t8 >= r2 && e7 <= r2 + l11.length && l11.between(r2, e7 - r2, t8 - r2, n14) === false) return;
      }
      this.nextLayer.between(e7, t8, n14);
    }
  }
  iter(e7 = 0) {
    return H4.from([this]).goto(e7);
  }
  get isEmpty() {
    return this.nextLayer == this;
  }
  static iter(e7, t8 = 0) {
    return H4.from(e7).goto(t8);
  }
  static compare(e7, t8, n14, i12, r2 = -1) {
    let l11 = e7.filter((u3) => u3.maxPoint > 0 || !u3.isEmpty && u3.maxPoint >= r2), h3 = t8.filter((u3) => u3.maxPoint > 0 || !u3.isEmpty && u3.maxPoint >= r2), o = Re8(l11, h3, n14), a2 = new B6(l11, o, r2), f6 = new B6(h3, o, r2);
    n14.iterGaps((u3, d4, c3) => Be10(a2, u3, f6, d4, c3, i12)), n14.empty && n14.length == 0 && Be10(a2, 0, f6, 0, 0, i12);
  }
  static eq(e7, t8, n14 = 0, i12) {
    i12 == null && (i12 = 999999999);
    let r2 = e7.filter((f6) => !f6.isEmpty && t8.indexOf(f6) < 0), l11 = t8.filter((f6) => !f6.isEmpty && e7.indexOf(f6) < 0);
    if (r2.length != l11.length) return false;
    if (!r2.length) return true;
    let h3 = Re8(r2, l11), o = new B6(r2, h3, 0).goto(n14), a2 = new B6(l11, h3, 0).goto(n14);
    for (; ; ) {
      if (o.to != a2.to || !ye9(o.active, a2.active) || o.point && (!a2.point || !o.point.eq(a2.point))) return false;
      if (o.to > i12) return true;
      o.next(), a2.next();
    }
  }
  static spans(e7, t8, n14, i12, r2 = -1) {
    let l11 = new B6(e7, null, r2).goto(t8), h3 = t8, o = l11.openStart;
    for (; ; ) {
      let a2 = Math.min(l11.to, n14);
      if (l11.point) {
        let f6 = l11.activeForPoint(l11.to), u3 = l11.pointFrom < t8 ? f6.length + 1 : Math.min(f6.length, o);
        i12.point(h3, a2, l11.point, f6, u3, l11.pointRank), o = Math.min(l11.openEnd(a2), f6.length);
      } else a2 > h3 && (i12.span(h3, a2, l11.active, o), o = l11.openEnd(a2));
      if (l11.to > n14) return o + (l11.point && l11.to > n14 ? 1 : 0);
      h3 = l11.to, l11.next();
    }
  }
  static of(e7, t8 = false) {
    let n14 = new se7();
    for (let i12 of e7 instanceof j11 ? [e7] : t8 ? st9(e7) : e7) n14.add(i12.from, i12.to, i12.value);
    return n14.finish();
  }
};
T11.empty = new T11([], [], null, -1);
function st9(s212) {
  if (s212.length > 1) for (let e7 = s212[0], t8 = 1; t8 < s212.length; t8++) {
    let n14 = s212[t8];
    if (xe11(e7, n14) > 0) return s212.slice().sort(xe11);
    e7 = n14;
  }
  return s212;
}
T11.empty.nextLayer = T11.empty;
var se7 = class s158 {
  finishChunk(e7) {
    this.chunks.push(new ke9(this.from, this.to, this.value, this.maxPoint)), this.chunkPos.push(this.chunkStart), this.chunkStart = -1, this.setMaxPoint = Math.max(this.setMaxPoint, this.maxPoint), this.maxPoint = -1, e7 && (this.from = [], this.to = [], this.value = []);
  }
  constructor() {
    this.chunks = [], this.chunkPos = [], this.chunkStart = -1, this.last = null, this.lastFrom = -1e9, this.lastTo = -1e9, this.from = [], this.to = [], this.value = [], this.maxPoint = -1, this.setMaxPoint = -1, this.nextLayer = null;
  }
  add(e7, t8, n14) {
    this.addInner(e7, t8, n14) || (this.nextLayer || (this.nextLayer = new s158())).add(e7, t8, n14);
  }
  addInner(e7, t8, n14) {
    let i12 = e7 - this.lastTo || n14.startSide - this.last.endSide;
    if (i12 <= 0 && (e7 - this.lastFrom || n14.startSide - this.last.startSide) < 0) throw new Error("Ranges must be added sorted by `from` position and `startSide`");
    return i12 < 0 ? false : (this.from.length == 250 && this.finishChunk(true), this.chunkStart < 0 && (this.chunkStart = e7), this.from.push(e7 - this.chunkStart), this.to.push(t8 - this.chunkStart), this.last = n14, this.lastFrom = e7, this.lastTo = t8, this.value.push(n14), n14.point && (this.maxPoint = Math.max(this.maxPoint, t8 - e7)), true);
  }
  addChunk(e7, t8) {
    if ((e7 - this.lastTo || t8.value[0].startSide - this.last.endSide) < 0) return false;
    this.from.length && this.finishChunk(true), this.setMaxPoint = Math.max(this.setMaxPoint, t8.maxPoint), this.chunks.push(t8), this.chunkPos.push(e7);
    let n14 = t8.value.length - 1;
    return this.last = t8.value[n14], this.lastFrom = t8.from[n14] + e7, this.lastTo = t8.to[n14] + e7, true;
  }
  finish() {
    return this.finishInner(T11.empty);
  }
  finishInner(e7) {
    if (this.from.length && this.finishChunk(false), this.chunks.length == 0) return e7;
    let t8 = T11.create(this.chunkPos, this.chunks, this.nextLayer ? this.nextLayer.finishInner(e7) : e7, this.setMaxPoint);
    return this.from = null, t8;
  }
};
function Re8(s212, e7, t8) {
  let n14 = /* @__PURE__ */ new Map();
  for (let r2 of s212) for (let l11 = 0; l11 < r2.chunk.length; l11++) r2.chunk[l11].maxPoint <= 0 && n14.set(r2.chunk[l11], r2.chunkPos[l11]);
  let i12 = /* @__PURE__ */ new Set();
  for (let r2 of e7) for (let l11 = 0; l11 < r2.chunk.length; l11++) {
    let h3 = n14.get(r2.chunk[l11]);
    h3 != null && (t8 ? t8.mapPos(h3) : h3) == r2.chunkPos[l11] && !t8?.touchesRange(h3, h3 + r2.chunk[l11].length) && i12.add(r2.chunk[l11]);
  }
  return i12;
}
var re8 = class {
  constructor(e7, t8, n14, i12 = 0) {
    this.layer = e7, this.skip = t8, this.minPoint = n14, this.rank = i12;
  }
  get startSide() {
    return this.value ? this.value.startSide : 0;
  }
  get endSide() {
    return this.value ? this.value.endSide : 0;
  }
  goto(e7, t8 = -1e9) {
    return this.chunkIndex = this.rangeIndex = 0, this.gotoInner(e7, t8, false), this;
  }
  gotoInner(e7, t8, n14) {
    for (; this.chunkIndex < this.layer.chunk.length; ) {
      let i12 = this.layer.chunk[this.chunkIndex];
      if (!(this.skip && this.skip.has(i12) || this.layer.chunkEnd(this.chunkIndex) < e7 || i12.maxPoint < this.minPoint)) break;
      this.chunkIndex++, n14 = false;
    }
    if (this.chunkIndex < this.layer.chunk.length) {
      let i12 = this.layer.chunk[this.chunkIndex].findIndex(e7 - this.layer.chunkPos[this.chunkIndex], t8, true);
      (!n14 || this.rangeIndex < i12) && this.setRangeIndex(i12);
    }
    this.next();
  }
  forward(e7, t8) {
    (this.to - e7 || this.endSide - t8) < 0 && this.gotoInner(e7, t8, true);
  }
  next() {
    for (; ; ) if (this.chunkIndex == this.layer.chunk.length) {
      this.from = this.to = 1e9, this.value = null;
      break;
    } else {
      let e7 = this.layer.chunkPos[this.chunkIndex], t8 = this.layer.chunk[this.chunkIndex], n14 = e7 + t8.from[this.rangeIndex];
      if (this.from = n14, this.to = e7 + t8.to[this.rangeIndex], this.value = t8.value[this.rangeIndex], this.setRangeIndex(this.rangeIndex + 1), this.minPoint < 0 || this.value.point && this.to - this.from >= this.minPoint) break;
    }
  }
  setRangeIndex(e7) {
    if (e7 == this.layer.chunk[this.chunkIndex].value.length) {
      if (this.chunkIndex++, this.skip) for (; this.chunkIndex < this.layer.chunk.length && this.skip.has(this.layer.chunk[this.chunkIndex]); ) this.chunkIndex++;
      this.rangeIndex = 0;
    } else this.rangeIndex = e7;
  }
  nextChunk() {
    this.chunkIndex++, this.rangeIndex = 0, this.next();
  }
  compare(e7) {
    return this.from - e7.from || this.startSide - e7.startSide || this.rank - e7.rank || this.to - e7.to || this.endSide - e7.endSide;
  }
};
var H4 = class s159 {
  constructor(e7) {
    this.heap = e7;
  }
  static from(e7, t8 = null, n14 = -1) {
    let i12 = [];
    for (let r2 = 0; r2 < e7.length; r2++) for (let l11 = e7[r2]; !l11.isEmpty; l11 = l11.nextLayer) l11.maxPoint >= n14 && i12.push(new re8(l11, t8, n14, r2));
    return i12.length == 1 ? i12[0] : new s159(i12);
  }
  get startSide() {
    return this.value ? this.value.startSide : 0;
  }
  goto(e7, t8 = -1e9) {
    for (let n14 of this.heap) n14.goto(e7, t8);
    for (let n14 = this.heap.length >> 1; n14 >= 0; n14--) oe7(this.heap, n14);
    return this.next(), this;
  }
  forward(e7, t8) {
    for (let n14 of this.heap) n14.forward(e7, t8);
    for (let n14 = this.heap.length >> 1; n14 >= 0; n14--) oe7(this.heap, n14);
    (this.to - e7 || this.value.endSide - t8) < 0 && this.next();
  }
  next() {
    if (this.heap.length == 0) this.from = this.to = 1e9, this.value = null, this.rank = -1;
    else {
      let e7 = this.heap[0];
      this.from = e7.from, this.to = e7.to, this.value = e7.value, this.rank = e7.rank, e7.value && e7.next(), oe7(this.heap, 0);
    }
  }
};
function oe7(s212, e7) {
  for (let t8 = s212[e7]; ; ) {
    let n14 = (e7 << 1) + 1;
    if (n14 >= s212.length) break;
    let i12 = s212[n14];
    if (n14 + 1 < s212.length && i12.compare(s212[n14 + 1]) >= 0 && (i12 = s212[n14 + 1], n14++), t8.compare(i12) < 0) break;
    s212[n14] = t8, s212[e7] = i12, e7 = n14;
  }
}
var B6 = class {
  constructor(e7, t8, n14) {
    this.minPoint = n14, this.active = [], this.activeTo = [], this.activeRank = [], this.minActive = -1, this.point = null, this.pointFrom = 0, this.pointRank = 0, this.to = -1e9, this.endSide = 0, this.openStart = -1, this.cursor = H4.from(e7, t8, n14);
  }
  goto(e7, t8 = -1e9) {
    return this.cursor.goto(e7, t8), this.active.length = this.activeTo.length = this.activeRank.length = 0, this.minActive = -1, this.to = e7, this.endSide = t8, this.openStart = -1, this.next(), this;
  }
  forward(e7, t8) {
    for (; this.minActive > -1 && (this.activeTo[this.minActive] - e7 || this.active[this.minActive].endSide - t8) < 0; ) this.removeActive(this.minActive);
    this.cursor.forward(e7, t8);
  }
  removeActive(e7) {
    Z9(this.active, e7), Z9(this.activeTo, e7), Z9(this.activeRank, e7), this.minActive = Me10(this.active, this.activeTo);
  }
  addActive(e7) {
    let t8 = 0, { value: n14, to: i12, rank: r2 } = this.cursor;
    for (; t8 < this.activeRank.length && this.activeRank[t8] <= r2; ) t8++;
    K8(this.active, t8, n14), K8(this.activeTo, t8, i12), K8(this.activeRank, t8, r2), e7 && K8(e7, t8, this.cursor.from), this.minActive = Me10(this.active, this.activeTo);
  }
  next() {
    let e7 = this.to, t8 = this.point;
    this.point = null;
    let n14 = this.openStart < 0 ? [] : null;
    for (; ; ) {
      let i12 = this.minActive;
      if (i12 > -1 && (this.activeTo[i12] - this.cursor.from || this.active[i12].endSide - this.cursor.startSide) < 0) {
        if (this.activeTo[i12] > e7) {
          this.to = this.activeTo[i12], this.endSide = this.active[i12].endSide;
          break;
        }
        this.removeActive(i12), n14 && Z9(n14, i12);
      } else if (this.cursor.value) if (this.cursor.from > e7) {
        this.to = this.cursor.from, this.endSide = this.cursor.startSide;
        break;
      } else {
        let r2 = this.cursor.value;
        if (!r2.point) this.addActive(n14), this.cursor.next();
        else if (t8 && this.cursor.to == this.to && this.cursor.from < this.cursor.to) this.cursor.next();
        else {
          this.point = r2, this.pointFrom = this.cursor.from, this.pointRank = this.cursor.rank, this.to = this.cursor.to, this.endSide = r2.endSide, this.cursor.next(), this.forward(this.to, this.endSide);
          break;
        }
      }
      else {
        this.to = this.endSide = 1e9;
        break;
      }
    }
    if (n14) {
      this.openStart = 0;
      for (let i12 = n14.length - 1; i12 >= 0 && n14[i12] < e7; i12--) this.openStart++;
    }
  }
  activeForPoint(e7) {
    if (!this.active.length) return this.active;
    let t8 = [];
    for (let n14 = this.active.length - 1; n14 >= 0 && !(this.activeRank[n14] < this.pointRank); n14--) (this.activeTo[n14] > e7 || this.activeTo[n14] == e7 && this.active[n14].endSide >= this.point.endSide) && t8.push(this.active[n14]);
    return t8.reverse();
  }
  openEnd(e7) {
    let t8 = 0;
    for (let n14 = this.activeTo.length - 1; n14 >= 0 && this.activeTo[n14] > e7; n14--) t8++;
    return t8;
  }
};
function Be10(s212, e7, t8, n14, i12, r2) {
  s212.goto(e7), t8.goto(n14);
  let l11 = n14 + i12, h3 = n14, o = n14 - e7;
  for (; ; ) {
    let a2 = s212.to + o - t8.to || s212.endSide - t8.endSide, f6 = a2 < 0 ? s212.to + o : t8.to, u3 = Math.min(f6, l11);
    if (s212.point || t8.point ? s212.point && t8.point && (s212.point == t8.point || s212.point.eq(t8.point)) && ye9(s212.activeForPoint(s212.to), t8.activeForPoint(t8.to)) || r2.comparePoint(h3, u3, s212.point, t8.point) : u3 > h3 && !ye9(s212.active, t8.active) && r2.compareRange(h3, u3, s212.active, t8.active), f6 > l11) break;
    h3 = f6, a2 <= 0 && s212.next(), a2 >= 0 && t8.next();
  }
}
function ye9(s212, e7) {
  if (s212.length != e7.length) return false;
  for (let t8 = 0; t8 < s212.length; t8++) if (s212[t8] != e7[t8] && !s212[t8].eq(e7[t8])) return false;
  return true;
}
function Z9(s212, e7) {
  for (let t8 = e7, n14 = s212.length - 1; t8 < n14; t8++) s212[t8] = s212[t8 + 1];
  s212.pop();
}
function K8(s212, e7, t8) {
  for (let n14 = s212.length - 1; n14 >= e7; n14--) s212[n14 + 1] = s212[n14];
  s212[e7] = t8;
}
function Me10(s212, e7) {
  let t8 = -1, n14 = 1e9;
  for (let i12 = 0; i12 < e7.length; i12++) (e7[i12] - n14 || s212[i12].endSide - s212[t8].endSide) < 0 && (t8 = i12, n14 = e7[i12]);
  return t8;
}
function ot8(s212, e7, t8 = s212.length) {
  let n14 = 0;
  for (let i12 = 0; i12 < t8; ) s212.charCodeAt(i12) == 9 ? (n14 += e7 - n14 % e7, i12++) : (n14++, i12 = _11(s212, i12));
  return n14;
}
function at9(s212, e7, t8, n14) {
  for (let i12 = 0, r2 = 0; ; ) {
    if (r2 >= e7) return i12;
    if (i12 == s212.length) break;
    r2 += s212.charCodeAt(i12) == 9 ? t8 - r2 % t8 : 1, i12 = _11(s212, i12);
  }
  return n14 === true ? -1 : s212.length;
}

// https://esm.sh/v135/style-mod@4.1.0/denonext/style-mod.mjs
var y12 = "Í¼";
var g4 = typeof Symbol > "u" ? "__" + y12 : Symbol.for(y12);
var c2 = typeof Symbol > "u" ? "__styleSet" + Math.floor(Math.random() * 1e8) : Symbol("styleSet");
var w8 = typeof globalThis < "u" ? globalThis : typeof window < "u" ? window : {};
var b7 = class {
  constructor(e7, n14) {
    this.rules = [];
    let { finish: i12 } = n14 || {};
    function l11(t8) {
      return /^@/.test(t8) ? [t8] : t8.split(/,\s*/);
    }
    function s212(t8, h3, a2, C11) {
      let d4 = [], r2 = /^@(\w+)\b/.exec(t8[0]), m11 = r2 && r2[1] == "keyframes";
      if (r2 && h3 == null) return a2.push(t8[0] + ";");
      for (let u3 in h3) {
        let o = h3[u3];
        if (/&/.test(u3)) s212(u3.split(/,\s*/).map((f6) => t8.map((p3) => f6.replace(/&/, p3))).reduce((f6, p3) => f6.concat(p3)), o, a2);
        else if (o && typeof o == "object") {
          if (!r2) throw new RangeError("The value of a property (" + u3 + ") should be a primitive value.");
          s212(l11(u3), o, d4, m11);
        } else o != null && d4.push(u3.replace(/_.*/, "").replace(/[A-Z]/g, (f6) => "-" + f6.toLowerCase()) + ": " + o + ";");
      }
      (d4.length || m11) && a2.push((i12 && !r2 && !C11 ? t8.map(i12) : t8).join(", ") + " {" + d4.join(" ") + "}");
    }
    for (let t8 in e7) s212(l11(t8), e7[t8], this.rules);
  }
  getRules() {
    return this.rules.join(`
`);
  }
  static newName() {
    let e7 = w8[g4] || 1;
    return w8[g4] = e7 + 1, y12 + e7.toString(36);
  }
  static mount(e7, n14, i12) {
    let l11 = e7[c2], s212 = i12 && i12.nonce;
    l11 ? s212 && l11.setNonce(s212) : l11 = new S11(e7, s212), l11.mount(Array.isArray(n14) ? n14 : [n14]);
  }
};
var T12 = /* @__PURE__ */ new Map();
var S11 = class {
  constructor(e7, n14) {
    let i12 = e7.ownerDocument || e7, l11 = i12.defaultView;
    if (!e7.head && e7.adoptedStyleSheets && l11.CSSStyleSheet) {
      let s212 = T12.get(i12);
      if (s212) return e7.adoptedStyleSheets = [s212.sheet, ...e7.adoptedStyleSheets], e7[c2] = s212;
      this.sheet = new l11.CSSStyleSheet(), e7.adoptedStyleSheets = [this.sheet, ...e7.adoptedStyleSheets], T12.set(i12, this);
    } else {
      this.styleTag = i12.createElement("style"), n14 && this.styleTag.setAttribute("nonce", n14);
      let s212 = e7.head || e7;
      s212.insertBefore(this.styleTag, s212.firstChild);
    }
    this.modules = [], e7[c2] = this;
  }
  mount(e7) {
    let n14 = this.sheet, i12 = 0, l11 = 0;
    for (let s212 = 0; s212 < e7.length; s212++) {
      let t8 = e7[s212], h3 = this.modules.indexOf(t8);
      if (h3 < l11 && h3 > -1 && (this.modules.splice(h3, 1), l11--, h3 = -1), h3 == -1) {
        if (this.modules.splice(l11++, 0, t8), n14) for (let a2 = 0; a2 < t8.rules.length; a2++) n14.insertRule(t8.rules[a2], i12++);
      } else {
        for (; l11 < h3; ) i12 += this.modules[l11++].rules.length;
        i12 += t8.rules.length, l11++;
      }
    }
    if (!n14) {
      let s212 = "";
      for (let t8 = 0; t8 < this.modules.length; t8++) s212 += this.modules[t8].getRules() + `
`;
      this.styleTag.textContent = s212;
    }
  }
  setNonce(e7) {
    this.styleTag && this.styleTag.getAttribute("nonce") != e7 && this.styleTag.setAttribute("nonce", e7);
  }
};

// https://esm.sh/v135/@codemirror/view@6.22.0/denonext/view.mjs
function de9(s212) {
  let t8;
  return s212.nodeType == 11 ? t8 = s212.getSelection ? s212 : s212.ownerDocument : t8 = s212, t8.getSelection();
}
function Fe11(s212, t8) {
  return t8 ? s212 == t8 || s212.contains(t8.nodeType != 1 ? t8.parentNode : t8) : false;
}
function zn5(s212) {
  let t8 = s212.activeElement;
  for (; t8 && t8.shadowRoot; ) t8 = t8.shadowRoot.activeElement;
  return t8;
}
function re9(s212, t8) {
  if (!t8.anchorNode) return false;
  try {
    return Fe11(s212, t8.anchorNode);
  } catch {
    return false;
  }
}
function xt8(s212) {
  return s212.nodeType == 3 ? ct3(s212, 0, s212.nodeValue.length).getClientRects() : s212.nodeType == 1 ? s212.getClientRects() : [];
}
function ue11(s212, t8, e7, i12) {
  return e7 ? Bi5(s212, t8, e7, i12, -1) || Bi5(s212, t8, e7, i12, 1) : false;
}
function Vt8(s212) {
  for (var t8 = 0; ; t8++) if (s212 = s212.previousSibling, !s212) return t8;
}
function Bi5(s212, t8, e7, i12, n14) {
  for (; ; ) {
    if (s212 == e7 && t8 == i12) return true;
    if (t8 == (n14 < 0 ? 0 : Z10(s212))) {
      if (s212.nodeName == "DIV") return false;
      let r2 = s212.parentNode;
      if (!r2 || r2.nodeType != 1) return false;
      t8 = Vt8(s212) + (n14 < 0 ? 0 : 1), s212 = r2;
    } else if (s212.nodeType == 1) {
      if (s212 = s212.childNodes[t8 + (n14 < 0 ? -1 : 0)], s212.nodeType == 1 && s212.contentEditable == "false") return false;
      t8 = n14 < 0 ? Z10(s212) : 0;
    } else return false;
  }
}
function Z10(s212) {
  return s212.nodeType == 3 ? s212.nodeValue.length : s212.childNodes.length;
}
function Te9(s212, t8) {
  let e7 = t8 ? s212.left : s212.right;
  return { left: e7, right: e7, top: s212.top, bottom: s212.bottom };
}
function In5(s212) {
  return { left: 0, right: s212.innerWidth, top: 0, bottom: s212.innerHeight };
}
function Kn5(s212, t8, e7, i12, n14, r2, o, l11) {
  let h3 = s212.ownerDocument, c3 = h3.defaultView || window;
  for (let a2 = s212, f6 = false; a2 && !f6; ) if (a2.nodeType == 1) {
    let d4, u3 = a2 == h3.body, g8 = 1, m11 = 1;
    if (u3) d4 = In5(c3);
    else {
      if (/^(fixed|sticky)$/.test(getComputedStyle(a2).position) && (f6 = true), a2.scrollHeight <= a2.clientHeight && a2.scrollWidth <= a2.clientWidth) {
        a2 = a2.assignedSlot || a2.parentNode;
        continue;
      }
      let v10 = a2.getBoundingClientRect();
      g8 = v10.width / a2.offsetWidth, m11 = v10.height / a2.offsetHeight, d4 = { left: v10.left, right: v10.left + a2.clientWidth * g8, top: v10.top, bottom: v10.top + a2.clientHeight * m11 };
    }
    let p3 = 0, b12 = 0;
    if (n14 == "nearest") t8.top < d4.top ? (b12 = -(d4.top - t8.top + o), e7 > 0 && t8.bottom > d4.bottom + b12 && (b12 = t8.bottom - d4.bottom + b12 + o)) : t8.bottom > d4.bottom && (b12 = t8.bottom - d4.bottom + o, e7 < 0 && t8.top - b12 < d4.top && (b12 = -(d4.top + b12 - t8.top + o)));
    else {
      let v10 = t8.bottom - t8.top, S17 = d4.bottom - d4.top;
      b12 = (n14 == "center" && v10 <= S17 ? t8.top + v10 / 2 - S17 / 2 : n14 == "start" || n14 == "center" && e7 < 0 ? t8.top - o : t8.bottom - S17 + o) - d4.top;
    }
    if (i12 == "nearest" ? t8.left < d4.left ? (p3 = -(d4.left - t8.left + r2), e7 > 0 && t8.right > d4.right + p3 && (p3 = t8.right - d4.right + p3 + r2)) : t8.right > d4.right && (p3 = t8.right - d4.right + r2, e7 < 0 && t8.left < d4.left + p3 && (p3 = -(d4.left + p3 - t8.left + r2))) : p3 = (i12 == "center" ? t8.left + (t8.right - t8.left) / 2 - (d4.right - d4.left) / 2 : i12 == "start" == l11 ? t8.left - r2 : t8.right - (d4.right - d4.left) + r2) - d4.left, p3 || b12) if (u3) c3.scrollBy(p3, b12);
    else {
      let v10 = 0, S17 = 0;
      if (b12) {
        let y18 = a2.scrollTop;
        a2.scrollTop += b12 / m11, S17 = (a2.scrollTop - y18) * m11;
      }
      if (p3) {
        let y18 = a2.scrollLeft;
        a2.scrollLeft += p3 / g8, v10 = (a2.scrollLeft - y18) * g8;
      }
      t8 = { left: t8.left - v10, top: t8.top - S17, right: t8.right - v10, bottom: t8.bottom - S17 }, v10 && Math.abs(v10 - p3) < 1 && (i12 = "nearest"), S17 && Math.abs(S17 - b12) < 1 && (n14 = "nearest");
    }
    if (u3) break;
    a2 = a2.assignedSlot || a2.parentNode;
  } else if (a2.nodeType == 11) a2 = a2.host;
  else break;
}
function qn5(s212) {
  let t8 = s212.ownerDocument;
  for (let e7 = s212.parentNode; e7 && e7 != t8.body; ) if (e7.nodeType == 1) {
    if (e7.scrollHeight > e7.clientHeight || e7.scrollWidth > e7.clientWidth) return e7;
    e7 = e7.assignedSlot || e7.parentNode;
  } else if (e7.nodeType == 11) e7 = e7.host;
  else break;
  return null;
}
var ze11 = class {
  constructor() {
    this.anchorNode = null, this.anchorOffset = 0, this.focusNode = null, this.focusOffset = 0;
  }
  eq(t8) {
    return this.anchorNode == t8.anchorNode && this.anchorOffset == t8.anchorOffset && this.focusNode == t8.focusNode && this.focusOffset == t8.focusOffset;
  }
  setRange(t8) {
    let { anchorNode: e7, focusNode: i12 } = t8;
    this.set(e7, Math.min(t8.anchorOffset, e7 ? Z10(e7) : 0), i12, Math.min(t8.focusOffset, i12 ? Z10(i12) : 0));
  }
  set(t8, e7, i12, n14) {
    this.anchorNode = t8, this.anchorOffset = e7, this.focusNode = i12, this.focusOffset = n14;
  }
};
var dt8 = null;
function As2(s212) {
  if (s212.setActive) return s212.setActive();
  if (dt8) return s212.focus(dt8);
  let t8 = [];
  for (let e7 = s212; e7 && (t8.push(e7, e7.scrollTop, e7.scrollLeft), e7 != e7.ownerDocument); e7 = e7.parentNode) ;
  if (s212.focus(dt8 == null ? { get preventScroll() {
    return dt8 = { preventScroll: true }, true;
  } } : void 0), !dt8) {
    dt8 = false;
    for (let e7 = 0; e7 < t8.length; ) {
      let i12 = t8[e7++], n14 = t8[e7++], r2 = t8[e7++];
      i12.scrollTop != n14 && (i12.scrollTop = n14), i12.scrollLeft != r2 && (i12.scrollLeft = r2);
    }
  }
}
var Ei2;
function ct3(s212, t8, e7 = t8) {
  let i12 = Ei2 || (Ei2 = document.createRange());
  return i12.setEnd(s212, e7), i12.setStart(s212, t8), i12;
}
function wt4(s212, t8, e7) {
  let i12 = { key: t8, code: t8, keyCode: e7, which: e7, cancelable: true }, n14 = new KeyboardEvent("keydown", i12);
  n14.synthetic = true, s212.dispatchEvent(n14);
  let r2 = new KeyboardEvent("keyup", i12);
  return r2.synthetic = true, s212.dispatchEvent(r2), n14.defaultPrevented || r2.defaultPrevented;
}
function jn3(s212) {
  for (; s212; ) {
    if (s212 && (s212.nodeType == 9 || s212.nodeType == 11 && s212.host)) return s212;
    s212 = s212.assignedSlot || s212.parentNode;
  }
  return null;
}
function Ds4(s212) {
  for (; s212.attributes.length; ) s212.removeAttributeNode(s212.attributes[0]);
}
function Yn4(s212, t8) {
  let e7 = t8.focusNode, i12 = t8.focusOffset;
  if (!e7 || t8.anchorNode != e7 || t8.anchorOffset != i12) return false;
  for (i12 = Math.min(i12, Z10(e7)); ; ) if (i12) {
    if (e7.nodeType != 1) return false;
    let n14 = e7.childNodes[i12 - 1];
    n14.contentEditable == "false" ? i12-- : (e7 = n14, i12 = Z10(e7));
  } else {
    if (e7 == s212) return true;
    i12 = Vt8(e7), e7 = e7.parentNode;
  }
}
function Ts5(s212) {
  return s212.scrollTop > Math.max(1, s212.scrollHeight - s212.clientHeight - 4);
}
var N13 = class s160 {
  constructor(t8, e7, i12 = true) {
    this.node = t8, this.offset = e7, this.precise = i12;
  }
  static before(t8, e7) {
    return new s160(t8.parentNode, Vt8(t8), e7);
  }
  static after(t8, e7) {
    return new s160(t8.parentNode, Vt8(t8) + 1, e7);
  }
};
var Di = [];
var O12 = class s161 {
  constructor() {
    this.parent = null, this.dom = null, this.flags = 2;
  }
  get overrideDOMText() {
    return null;
  }
  get posAtStart() {
    return this.parent ? this.parent.posBefore(this) : 0;
  }
  get posAtEnd() {
    return this.posAtStart + this.length;
  }
  posBefore(t8) {
    let e7 = this.posAtStart;
    for (let i12 of this.children) {
      if (i12 == t8) return e7;
      e7 += i12.length + i12.breakAfter;
    }
    throw new RangeError("Invalid child in posBefore");
  }
  posAfter(t8) {
    return this.posBefore(t8) + t8.length;
  }
  sync(t8, e7) {
    if (this.flags & 2) {
      let i12 = this.dom, n14 = null, r2;
      for (let o of this.children) {
        if (o.flags & 7) {
          if (!o.dom && (r2 = n14 ? n14.nextSibling : i12.firstChild)) {
            let l11 = s161.get(r2);
            (!l11 || !l11.parent && l11.canReuseDOM(o)) && o.reuseDOM(r2);
          }
          o.sync(t8, e7), o.flags &= -8;
        }
        if (r2 = n14 ? n14.nextSibling : i12.firstChild, e7 && !e7.written && e7.node == i12 && r2 != o.dom && (e7.written = true), o.dom.parentNode == i12) for (; r2 && r2 != o.dom; ) r2 = Pi5(r2);
        else i12.insertBefore(o.dom, r2);
        n14 = o.dom;
      }
      for (r2 = n14 ? n14.nextSibling : i12.firstChild, r2 && e7 && e7.node == i12 && (e7.written = true); r2; ) r2 = Pi5(r2);
    } else if (this.flags & 1) for (let i12 of this.children) i12.flags & 7 && (i12.sync(t8, e7), i12.flags &= -8);
  }
  reuseDOM(t8) {
  }
  localPosFromDOM(t8, e7) {
    let i12;
    if (t8 == this.dom) i12 = this.dom.childNodes[e7];
    else {
      let n14 = Z10(t8) == 0 ? 0 : e7 == 0 ? -1 : 1;
      for (; ; ) {
        let r2 = t8.parentNode;
        if (r2 == this.dom) break;
        n14 == 0 && r2.firstChild != r2.lastChild && (t8 == r2.firstChild ? n14 = -1 : n14 = 1), t8 = r2;
      }
      n14 < 0 ? i12 = t8 : i12 = t8.nextSibling;
    }
    if (i12 == this.dom.firstChild) return 0;
    for (; i12 && !s161.get(i12); ) i12 = i12.nextSibling;
    if (!i12) return this.length;
    for (let n14 = 0, r2 = 0; ; n14++) {
      let o = this.children[n14];
      if (o.dom == i12) return r2;
      r2 += o.length + o.breakAfter;
    }
  }
  domBoundsAround(t8, e7, i12 = 0) {
    let n14 = -1, r2 = -1, o = -1, l11 = -1;
    for (let h3 = 0, c3 = i12, a2 = i12; h3 < this.children.length; h3++) {
      let f6 = this.children[h3], d4 = c3 + f6.length;
      if (c3 < t8 && d4 > e7) return f6.domBoundsAround(t8, e7, c3);
      if (d4 >= t8 && n14 == -1 && (n14 = h3, r2 = c3), c3 > e7 && f6.dom.parentNode == this.dom) {
        o = h3, l11 = a2;
        break;
      }
      a2 = d4, c3 = d4 + f6.breakAfter;
    }
    return { from: r2, to: l11 < 0 ? i12 + this.length : l11, startDOM: (n14 ? this.children[n14 - 1].dom.nextSibling : null) || this.dom.firstChild, endDOM: o < this.children.length && o >= 0 ? this.children[o].dom : null };
  }
  markDirty(t8 = false) {
    this.flags |= 2, this.markParentsDirty(t8);
  }
  markParentsDirty(t8) {
    for (let e7 = this.parent; e7; e7 = e7.parent) {
      if (t8 && (e7.flags |= 2), e7.flags & 1) return;
      e7.flags |= 1, t8 = false;
    }
  }
  setParent(t8) {
    this.parent != t8 && (this.parent = t8, this.flags & 7 && this.markParentsDirty(true));
  }
  setDOM(t8) {
    this.dom != t8 && (this.dom && (this.dom.cmView = null), this.dom = t8, t8.cmView = this);
  }
  get rootView() {
    for (let t8 = this; ; ) {
      let e7 = t8.parent;
      if (!e7) return t8;
      t8 = e7;
    }
  }
  replaceChildren(t8, e7, i12 = Di) {
    this.markDirty();
    for (let n14 = t8; n14 < e7; n14++) {
      let r2 = this.children[n14];
      r2.parent == this && r2.destroy();
    }
    this.children.splice(t8, e7 - t8, ...i12);
    for (let n14 = 0; n14 < i12.length; n14++) i12[n14].setParent(this);
  }
  ignoreMutation(t8) {
    return false;
  }
  ignoreEvent(t8) {
    return false;
  }
  childCursor(t8 = this.length) {
    return new ge13(this.children, t8, this.children.length);
  }
  childPos(t8, e7 = 1) {
    return this.childCursor().findPos(t8, e7);
  }
  toString() {
    let t8 = this.constructor.name.replace("View", "");
    return t8 + (this.children.length ? "(" + this.children.join() + ")" : this.length ? "[" + (t8 == "Text" ? this.text : this.length) + "]" : "") + (this.breakAfter ? "#" : "");
  }
  static get(t8) {
    return t8.cmView;
  }
  get isEditable() {
    return true;
  }
  get isWidget() {
    return false;
  }
  get isHidden() {
    return false;
  }
  merge(t8, e7, i12, n14, r2, o) {
    return false;
  }
  become(t8) {
    return false;
  }
  canReuseDOM(t8) {
    return t8.constructor == this.constructor && !((this.flags | t8.flags) & 8);
  }
  getSide() {
    return 0;
  }
  destroy() {
    this.parent = null;
  }
};
O12.prototype.breakAfter = 0;
function Pi5(s212) {
  let t8 = s212.nextSibling;
  return s212.parentNode.removeChild(s212), t8;
}
var ge13 = class {
  constructor(t8, e7, i12) {
    this.children = t8, this.pos = e7, this.i = i12, this.off = 0;
  }
  findPos(t8, e7 = 1) {
    for (; ; ) {
      if (t8 > this.pos || t8 == this.pos && (e7 > 0 || this.i == 0 || this.children[this.i - 1].breakAfter)) return this.off = t8 - this.pos, this;
      let i12 = this.children[--this.i];
      this.pos -= i12.length + i12.breakAfter;
    }
  }
};
function Os5(s212, t8, e7, i12, n14, r2, o, l11, h3) {
  let { children: c3 } = s212, a2 = c3.length ? c3[t8] : null, f6 = r2.length ? r2[r2.length - 1] : null, d4 = f6 ? f6.breakAfter : o;
  if (!(t8 == i12 && a2 && !o && !d4 && r2.length < 2 && a2.merge(e7, n14, r2.length ? f6 : null, e7 == 0, l11, h3))) {
    if (i12 < c3.length) {
      let u3 = c3[i12];
      u3 && (n14 < u3.length || u3.breakAfter && f6?.breakAfter) ? (t8 == i12 && (u3 = u3.split(n14), n14 = 0), !d4 && f6 && u3.merge(0, n14, f6, true, 0, h3) ? r2[r2.length - 1] = u3 : ((n14 || u3.children.length && !u3.children[0].length) && u3.merge(0, n14, null, false, 0, h3), r2.push(u3))) : u3?.breakAfter && (f6 ? f6.breakAfter = 1 : o = 1), i12++;
    }
    for (a2 && (a2.breakAfter = o, e7 > 0 && (!o && r2.length && a2.merge(e7, a2.length, r2[0], false, l11, 0) ? a2.breakAfter = r2.shift().breakAfter : (e7 < a2.length || a2.children.length && a2.children[a2.children.length - 1].length == 0) && a2.merge(e7, a2.length, null, false, l11, 0), t8++)); t8 < i12 && r2.length; ) if (c3[i12 - 1].become(r2[r2.length - 1])) i12--, r2.pop(), h3 = r2.length ? 0 : l11;
    else if (c3[t8].become(r2[0])) t8++, r2.shift(), l11 = r2.length ? 0 : h3;
    else break;
    !r2.length && t8 && i12 < c3.length && !c3[t8 - 1].breakAfter && c3[i12].merge(0, 0, c3[t8 - 1], false, l11, h3) && t8--, (t8 < i12 || r2.length) && s212.replaceChildren(t8, i12, r2);
  }
}
function Rs5(s212, t8, e7, i12, n14, r2) {
  let o = s212.childCursor(), { i: l11, off: h3 } = o.findPos(e7, 1), { i: c3, off: a2 } = o.findPos(t8, -1), f6 = t8 - e7;
  for (let d4 of i12) f6 += d4.length;
  s212.length += f6, Os5(s212, c3, a2, l11, h3, i12, 0, n14, r2);
}
var z12 = typeof navigator < "u" ? navigator : { userAgent: "", vendor: "", platform: "" };
var Ie9 = typeof document < "u" ? document : { documentElement: { style: {} } };
var Ke10 = /Edge\/(\d+)/.exec(z12.userAgent);
var Ls3 = /MSIE \d/.test(z12.userAgent);
var qe10 = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(z12.userAgent);
var Oe8 = !!(Ls3 || qe10 || Ke10);
var Hi5 = !Oe8 && /gecko\/(\d+)/i.test(z12.userAgent);
var Be11 = !Oe8 && /Chrome\/(\d+)/.exec(z12.userAgent);
var Ni = "webkitFontSmoothing" in Ie9.documentElement.style;
var Bs = !Oe8 && /Apple Computer/.test(z12.vendor);
var Vi = Bs && (/Mobile\/\w+/.test(z12.userAgent) || z12.maxTouchPoints > 2);
var w9 = { mac: Vi || /Mac/.test(z12.platform), windows: /Win/.test(z12.platform), linux: /Linux|X11/.test(z12.platform), ie: Oe8, ie_version: Ls3 ? Ie9.documentMode || 6 : qe10 ? +qe10[1] : Ke10 ? +Ke10[1] : 0, gecko: Hi5, gecko_version: Hi5 ? +(/Firefox\/(\d+)/.exec(z12.userAgent) || [0, 0])[1] : 0, chrome: !!Be11, chrome_version: Be11 ? +Be11[1] : 0, ios: Vi, android: /Android\b/.test(z12.userAgent), webkit: Ni, safari: Bs, webkit_version: Ni ? +(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent) || [0, 0])[1] : 0, tabSize: Ie9.documentElement.style.tabSize != null ? "tab-size" : "-moz-tab-size" };
var _n2 = 256;
var nt9 = class s162 extends O12 {
  constructor(t8) {
    super(), this.text = t8;
  }
  get length() {
    return this.text.length;
  }
  createDOM(t8) {
    this.setDOM(t8 || document.createTextNode(this.text));
  }
  sync(t8, e7) {
    this.dom || this.createDOM(), this.dom.nodeValue != this.text && (e7 && e7.node == this.dom && (e7.written = true), this.dom.nodeValue = this.text);
  }
  reuseDOM(t8) {
    t8.nodeType == 3 && this.createDOM(t8);
  }
  merge(t8, e7, i12) {
    return this.flags & 8 || i12 && (!(i12 instanceof s162) || this.length - (e7 - t8) + i12.length > _n2 || i12.flags & 8) ? false : (this.text = this.text.slice(0, t8) + (i12 ? i12.text : "") + this.text.slice(e7), this.markDirty(), true);
  }
  split(t8) {
    let e7 = new s162(this.text.slice(t8));
    return this.text = this.text.slice(0, t8), this.markDirty(), e7.flags |= this.flags & 8, e7;
  }
  localPosFromDOM(t8, e7) {
    return t8 == this.dom ? e7 : e7 ? this.text.length : 0;
  }
  domAtPos(t8) {
    return new N13(this.dom, t8);
  }
  domBoundsAround(t8, e7, i12) {
    return { from: i12, to: i12 + this.length, startDOM: this.dom, endDOM: this.dom.nextSibling };
  }
  coordsAt(t8, e7) {
    return Xn(this.dom, t8, e7);
  }
};
var rt9 = class s163 extends O12 {
  constructor(t8, e7 = [], i12 = 0) {
    super(), this.mark = t8, this.children = e7, this.length = i12;
    for (let n14 of e7) n14.setParent(this);
  }
  setAttrs(t8) {
    if (Ds4(t8), this.mark.class && (t8.className = this.mark.class), this.mark.attrs) for (let e7 in this.mark.attrs) t8.setAttribute(e7, this.mark.attrs[e7]);
    return t8;
  }
  canReuseDOM(t8) {
    return super.canReuseDOM(t8) && !((this.flags | t8.flags) & 8);
  }
  reuseDOM(t8) {
    t8.nodeName == this.mark.tagName.toUpperCase() && (this.setDOM(t8), this.flags |= 6);
  }
  sync(t8, e7) {
    this.dom ? this.flags & 4 && this.setAttrs(this.dom) : this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))), super.sync(t8, e7);
  }
  merge(t8, e7, i12, n14, r2, o) {
    return i12 && (!(i12 instanceof s163 && i12.mark.eq(this.mark)) || t8 && r2 <= 0 || e7 < this.length && o <= 0) ? false : (Rs5(this, t8, e7, i12 ? i12.children : [], r2 - 1, o - 1), this.markDirty(), true);
  }
  split(t8) {
    let e7 = [], i12 = 0, n14 = -1, r2 = 0;
    for (let l11 of this.children) {
      let h3 = i12 + l11.length;
      h3 > t8 && e7.push(i12 < t8 ? l11.split(t8 - i12) : l11), n14 < 0 && i12 >= t8 && (n14 = r2), i12 = h3, r2++;
    }
    let o = this.length - t8;
    return this.length = t8, n14 > -1 && (this.children.length = n14, this.markDirty()), new s163(this.mark, e7, o);
  }
  domAtPos(t8) {
    return Es5(this, t8);
  }
  coordsAt(t8, e7) {
    return Hs(this, t8, e7);
  }
};
function Xn(s212, t8, e7) {
  let i12 = s212.nodeValue.length;
  t8 > i12 && (t8 = i12);
  let n14 = t8, r2 = t8, o = 0;
  t8 == 0 && e7 < 0 || t8 == i12 && e7 >= 0 ? w9.chrome || w9.gecko || (t8 ? (n14--, o = 1) : r2 < i12 && (r2++, o = -1)) : e7 < 0 ? n14-- : r2 < i12 && r2++;
  let l11 = ct3(s212, n14, r2).getClientRects();
  if (!l11.length) return null;
  let h3 = l11[(o ? o < 0 : e7 >= 0) ? 0 : l11.length - 1];
  return w9.safari && !o && h3.width == 0 && (h3 = Array.prototype.find.call(l11, (c3) => c3.width) || h3), o ? Te9(h3, o < 0) : h3 || null;
}
var Wt8 = class s164 extends O12 {
  static create(t8, e7, i12) {
    return new s164(t8, e7, i12);
  }
  constructor(t8, e7, i12) {
    super(), this.widget = t8, this.length = e7, this.side = i12, this.prevWidget = null;
  }
  split(t8) {
    let e7 = s164.create(this.widget, this.length - t8, this.side);
    return this.length -= t8, e7;
  }
  sync(t8) {
    (!this.dom || !this.widget.updateDOM(this.dom, t8)) && (this.dom && this.prevWidget && this.prevWidget.destroy(this.dom), this.prevWidget = null, this.setDOM(this.widget.toDOM(t8)), this.dom.contentEditable = "false");
  }
  getSide() {
    return this.side;
  }
  merge(t8, e7, i12, n14, r2, o) {
    return i12 && (!(i12 instanceof s164) || !this.widget.compare(i12.widget) || t8 > 0 && r2 <= 0 || e7 < this.length && o <= 0) ? false : (this.length = t8 + (i12 ? i12.length : 0) + (this.length - e7), true);
  }
  become(t8) {
    return t8 instanceof s164 && t8.side == this.side && this.widget.constructor == t8.widget.constructor ? (this.widget.compare(t8.widget) || this.markDirty(true), this.dom && !this.prevWidget && (this.prevWidget = this.widget), this.widget = t8.widget, this.length = t8.length, true) : false;
  }
  ignoreMutation() {
    return true;
  }
  ignoreEvent(t8) {
    return this.widget.ignoreEvent(t8);
  }
  get overrideDOMText() {
    if (this.length == 0) return m5.empty;
    let t8 = this;
    for (; t8.parent; ) t8 = t8.parent;
    let { view: e7 } = t8, i12 = e7 && e7.state.doc, n14 = this.posAtStart;
    return i12 ? i12.slice(n14, n14 + this.length) : m5.empty;
  }
  domAtPos(t8) {
    return (this.length ? t8 == 0 : this.side > 0) ? N13.before(this.dom) : N13.after(this.dom, t8 == this.length);
  }
  domBoundsAround() {
    return null;
  }
  coordsAt(t8, e7) {
    let i12 = this.widget.coordsAt(this.dom, t8, e7);
    if (i12) return i12;
    let n14 = this.dom.getClientRects(), r2 = null;
    if (!n14.length) return null;
    let o = this.side ? this.side < 0 : t8 > 0;
    for (let l11 = o ? n14.length - 1 : 0; r2 = n14[l11], !(t8 > 0 ? l11 == 0 : l11 == n14.length - 1 || r2.top < r2.bottom); l11 += o ? -1 : 1) ;
    return Te9(r2, !o);
  }
  get isEditable() {
    return false;
  }
  get isWidget() {
    return true;
  }
  get isHidden() {
    return this.widget.isHidden;
  }
  destroy() {
    super.destroy(), this.dom && this.widget.destroy(this.dom);
  }
};
var Ft8 = class s165 extends O12 {
  constructor(t8) {
    super(), this.side = t8;
  }
  get length() {
    return 0;
  }
  merge() {
    return false;
  }
  become(t8) {
    return t8 instanceof s165 && t8.side == this.side;
  }
  split() {
    return new s165(this.side);
  }
  sync() {
    if (!this.dom) {
      let t8 = document.createElement("img");
      t8.className = "cm-widgetBuffer", t8.setAttribute("aria-hidden", "true"), this.setDOM(t8);
    }
  }
  getSide() {
    return this.side;
  }
  domAtPos(t8) {
    return this.side > 0 ? N13.before(this.dom) : N13.after(this.dom);
  }
  localPosFromDOM() {
    return 0;
  }
  domBoundsAround() {
    return null;
  }
  coordsAt(t8) {
    return this.dom.getBoundingClientRect();
  }
  get overrideDOMText() {
    return m5.empty;
  }
  get isHidden() {
    return true;
  }
};
nt9.prototype.children = Wt8.prototype.children = Ft8.prototype.children = Di;
function Es5(s212, t8) {
  let e7 = s212.dom, { children: i12 } = s212, n14 = 0;
  for (let r2 = 0; n14 < i12.length; n14++) {
    let o = i12[n14], l11 = r2 + o.length;
    if (!(l11 == r2 && o.getSide() <= 0)) {
      if (t8 > r2 && t8 < l11 && o.dom.parentNode == e7) return o.domAtPos(t8 - r2);
      if (t8 <= r2) break;
      r2 = l11;
    }
  }
  for (let r2 = n14; r2 > 0; r2--) {
    let o = i12[r2 - 1];
    if (o.dom.parentNode == e7) return o.domAtPos(o.length);
  }
  for (let r2 = n14; r2 < i12.length; r2++) {
    let o = i12[r2];
    if (o.dom.parentNode == e7) return o.domAtPos(0);
  }
  return new N13(e7, 0);
}
function Ps(s212, t8, e7) {
  let i12, { children: n14 } = s212;
  e7 > 0 && t8 instanceof rt9 && n14.length && (i12 = n14[n14.length - 1]) instanceof rt9 && i12.mark.eq(t8.mark) ? Ps(i12, t8.children[0], e7 - 1) : (n14.push(t8), t8.setParent(s212)), s212.length += t8.length;
}
function Hs(s212, t8, e7) {
  let i12 = null, n14 = -1, r2 = null, o = -1;
  function l11(c3, a2) {
    for (let f6 = 0, d4 = 0; f6 < c3.children.length && d4 <= a2; f6++) {
      let u3 = c3.children[f6], g8 = d4 + u3.length;
      g8 >= a2 && (u3.children.length ? l11(u3, a2 - d4) : (!r2 || r2.isHidden && e7 > 0) && (g8 > a2 || d4 == g8 && u3.getSide() > 0) ? (r2 = u3, o = a2 - d4) : (d4 < a2 || d4 == g8 && u3.getSide() < 0 && !u3.isHidden) && (i12 = u3, n14 = a2 - d4)), d4 = g8;
    }
  }
  l11(s212, t8);
  let h3 = (e7 < 0 ? i12 : r2) || i12 || r2;
  return h3 ? h3.coordsAt(Math.max(0, h3 == i12 ? n14 : o), e7) : Gn(s212);
}
function Gn(s212) {
  let t8 = s212.dom.lastChild;
  if (!t8) return s212.dom.getBoundingClientRect();
  let e7 = xt8(t8);
  return e7[e7.length - 1] || null;
}
function je8(s212, t8) {
  for (let e7 in s212) e7 == "class" && t8.class ? t8.class += " " + s212.class : e7 == "style" && t8.style ? t8.style += ";" + s212.style : t8[e7] = s212[e7];
  return t8;
}
var Wi5 = /* @__PURE__ */ Object.create(null);
function Ti(s212, t8, e7) {
  if (s212 == t8) return true;
  s212 || (s212 = Wi5), t8 || (t8 = Wi5);
  let i12 = Object.keys(s212), n14 = Object.keys(t8);
  if (i12.length - (e7 && i12.indexOf(e7) > -1 ? 1 : 0) != n14.length - (e7 && n14.indexOf(e7) > -1 ? 1 : 0)) return false;
  for (let r2 of i12) if (r2 != e7 && (n14.indexOf(r2) == -1 || s212[r2] !== t8[r2])) return false;
  return true;
}
function Ye9(s212, t8, e7) {
  let i12 = false;
  if (t8) for (let n14 in t8) e7 && n14 in e7 || (i12 = true, n14 == "style" ? s212.style.cssText = "" : s212.removeAttribute(n14));
  if (e7) for (let n14 in e7) t8 && t8[n14] == e7[n14] || (i12 = true, n14 == "style" ? s212.style.cssText = e7[n14] : s212.setAttribute(n14, e7[n14]));
  return i12;
}
function $n(s212) {
  let t8 = /* @__PURE__ */ Object.create(null);
  for (let e7 = 0; e7 < s212.attributes.length; e7++) {
    let i12 = s212.attributes[e7];
    t8[i12.name] = i12.value;
  }
  return t8;
}
var P13 = class s166 extends O12 {
  constructor() {
    super(...arguments), this.children = [], this.length = 0, this.prevAttrs = void 0, this.attrs = null, this.breakAfter = 0;
  }
  merge(t8, e7, i12, n14, r2, o) {
    if (i12) {
      if (!(i12 instanceof s166)) return false;
      this.dom || i12.transferDOM(this);
    }
    return n14 && this.setDeco(i12 ? i12.attrs : null), Rs5(this, t8, e7, i12 ? i12.children : [], r2, o), true;
  }
  split(t8) {
    let e7 = new s166();
    if (e7.breakAfter = this.breakAfter, this.length == 0) return e7;
    let { i: i12, off: n14 } = this.childPos(t8);
    n14 && (e7.append(this.children[i12].split(n14), 0), this.children[i12].merge(n14, this.children[i12].length, null, false, 0, 0), i12++);
    for (let r2 = i12; r2 < this.children.length; r2++) e7.append(this.children[r2], 0);
    for (; i12 > 0 && this.children[i12 - 1].length == 0; ) this.children[--i12].destroy();
    return this.children.length = i12, this.markDirty(), this.length = t8, e7;
  }
  transferDOM(t8) {
    this.dom && (this.markDirty(), t8.setDOM(this.dom), t8.prevAttrs = this.prevAttrs === void 0 ? this.attrs : this.prevAttrs, this.prevAttrs = void 0, this.dom = null);
  }
  setDeco(t8) {
    Ti(this.attrs, t8) || (this.dom && (this.prevAttrs = this.attrs, this.markDirty()), this.attrs = t8);
  }
  append(t8, e7) {
    Ps(this, t8, e7);
  }
  addLineDeco(t8) {
    let e7 = t8.spec.attributes, i12 = t8.spec.class;
    e7 && (this.attrs = je8(e7, this.attrs || {})), i12 && (this.attrs = je8({ class: i12 }, this.attrs || {}));
  }
  domAtPos(t8) {
    return Es5(this, t8);
  }
  reuseDOM(t8) {
    t8.nodeName == "DIV" && (this.setDOM(t8), this.flags |= 6);
  }
  sync(t8, e7) {
    var i12;
    this.dom ? this.flags & 4 && (Ds4(this.dom), this.dom.className = "cm-line", this.prevAttrs = this.attrs ? null : void 0) : (this.setDOM(document.createElement("div")), this.dom.className = "cm-line", this.prevAttrs = this.attrs ? null : void 0), this.prevAttrs !== void 0 && (Ye9(this.dom, this.prevAttrs, this.attrs), this.dom.classList.add("cm-line"), this.prevAttrs = void 0), super.sync(t8, e7);
    let n14 = this.dom.lastChild;
    for (; n14 && O12.get(n14) instanceof rt9; ) n14 = n14.lastChild;
    if (!n14 || !this.length || n14.nodeName != "BR" && ((i12 = O12.get(n14)) === null || i12 === void 0 ? void 0 : i12.isEditable) == false && (!w9.ios || !this.children.some((r2) => r2 instanceof nt9))) {
      let r2 = document.createElement("BR");
      r2.cmIgnore = true, this.dom.appendChild(r2);
    }
  }
  measureTextSize() {
    if (this.children.length == 0 || this.length > 20) return null;
    let t8 = 0, e7;
    for (let i12 of this.children) {
      if (!(i12 instanceof nt9) || /[^ -~]/.test(i12.text)) return null;
      let n14 = xt8(i12.dom);
      if (n14.length != 1) return null;
      t8 += n14[0].width, e7 = n14[0].height;
    }
    return t8 ? { lineHeight: this.dom.getBoundingClientRect().height, charWidth: t8 / this.length, textHeight: e7 } : null;
  }
  coordsAt(t8, e7) {
    let i12 = Hs(this, t8, e7);
    if (!this.children.length && i12 && this.parent) {
      let { heightOracle: n14 } = this.parent.view.viewState, r2 = i12.bottom - i12.top;
      if (Math.abs(r2 - n14.lineHeight) < 2 && n14.textHeight < r2) {
        let o = (r2 - n14.textHeight) / 2;
        return { top: i12.top + o, bottom: i12.bottom - o, left: i12.left, right: i12.left };
      }
    }
    return i12;
  }
  become(t8) {
    return false;
  }
  covers() {
    return true;
  }
  static find(t8, e7) {
    for (let i12 = 0, n14 = 0; i12 < t8.children.length; i12++) {
      let r2 = t8.children[i12], o = n14 + r2.length;
      if (o >= e7) {
        if (r2 instanceof s166) return r2;
        if (o > e7) break;
      }
      n14 = o + r2.breakAfter;
    }
    return null;
  }
};
var yt7 = class s167 extends O12 {
  constructor(t8, e7, i12) {
    super(), this.widget = t8, this.length = e7, this.deco = i12, this.breakAfter = 0, this.prevWidget = null;
  }
  merge(t8, e7, i12, n14, r2, o) {
    return i12 && (!(i12 instanceof s167) || !this.widget.compare(i12.widget) || t8 > 0 && r2 <= 0 || e7 < this.length && o <= 0) ? false : (this.length = t8 + (i12 ? i12.length : 0) + (this.length - e7), true);
  }
  domAtPos(t8) {
    return t8 == 0 ? N13.before(this.dom) : N13.after(this.dom, t8 == this.length);
  }
  split(t8) {
    let e7 = this.length - t8;
    this.length = t8;
    let i12 = new s167(this.widget, e7, this.deco);
    return i12.breakAfter = this.breakAfter, i12;
  }
  get children() {
    return Di;
  }
  sync(t8) {
    (!this.dom || !this.widget.updateDOM(this.dom, t8)) && (this.dom && this.prevWidget && this.prevWidget.destroy(this.dom), this.prevWidget = null, this.setDOM(this.widget.toDOM(t8)), this.dom.contentEditable = "false");
  }
  get overrideDOMText() {
    return this.parent ? this.parent.view.state.doc.slice(this.posAtStart, this.posAtEnd) : m5.empty;
  }
  domBoundsAround() {
    return null;
  }
  become(t8) {
    return t8 instanceof s167 && t8.widget.constructor == this.widget.constructor ? (t8.widget.compare(this.widget) || this.markDirty(true), this.dom && !this.prevWidget && (this.prevWidget = this.widget), this.widget = t8.widget, this.length = t8.length, this.deco = t8.deco, this.breakAfter = t8.breakAfter, true) : false;
  }
  ignoreMutation() {
    return true;
  }
  ignoreEvent(t8) {
    return this.widget.ignoreEvent(t8);
  }
  get isEditable() {
    return false;
  }
  get isWidget() {
    return true;
  }
  coordsAt(t8, e7) {
    return this.widget.coordsAt(this.dom, t8, e7);
  }
  destroy() {
    super.destroy(), this.dom && this.widget.destroy(this.dom);
  }
  covers(t8) {
    let { startSide: e7, endSide: i12 } = this.deco;
    return e7 == i12 ? false : t8 < 0 ? e7 < 0 : i12 > 0;
  }
};
var ot9 = class {
  eq(t8) {
    return false;
  }
  updateDOM(t8, e7) {
    return false;
  }
  compare(t8) {
    return this == t8 || this.constructor == t8.constructor && this.eq(t8);
  }
  get estimatedHeight() {
    return -1;
  }
  get lineBreaks() {
    return 0;
  }
  ignoreEvent(t8) {
    return true;
  }
  coordsAt(t8, e7, i12) {
    return null;
  }
  get isHidden() {
    return false;
  }
  destroy(t8) {
  }
};
var V14 = function(s212) {
  return s212[s212.Text = 0] = "Text", s212[s212.WidgetBefore = 1] = "WidgetBefore", s212[s212.WidgetAfter = 2] = "WidgetAfter", s212[s212.WidgetRange = 3] = "WidgetRange", s212;
}(V14 || (V14 = {}));
var R11 = class extends z11 {
  constructor(t8, e7, i12, n14) {
    super(), this.startSide = t8, this.endSide = e7, this.widget = i12, this.spec = n14;
  }
  get heightRelevant() {
    return false;
  }
  static mark(t8) {
    return new zt7(t8);
  }
  static widget(t8) {
    let e7 = Math.max(-1e4, Math.min(1e4, t8.side || 0)), i12 = !!t8.block;
    return e7 += i12 && !t8.inlineOrder ? e7 > 0 ? 3e8 : -4e8 : e7 > 0 ? 1e8 : -1e8, new lt9(t8, e7, e7, i12, t8.widget || null, false);
  }
  static replace(t8) {
    let e7 = !!t8.block, i12, n14;
    if (t8.isBlockGap) i12 = -5e8, n14 = 4e8;
    else {
      let { start: r2, end: o } = Ns(t8, e7);
      i12 = (r2 ? e7 ? -3e8 : -1 : 5e8) - 1, n14 = (o ? e7 ? 2e8 : 1 : -6e8) + 1;
    }
    return new lt9(t8, i12, n14, e7, t8.widget || null, true);
  }
  static line(t8) {
    return new It8(t8);
  }
  static set(t8, e7 = false) {
    return T11.of(t8, e7);
  }
  hasHeight() {
    return this.widget ? this.widget.estimatedHeight > -1 : false;
  }
};
R11.none = T11.empty;
var zt7 = class s168 extends R11 {
  constructor(t8) {
    let { start: e7, end: i12 } = Ns(t8);
    super(e7 ? -1 : 5e8, i12 ? 1 : -6e8, null, t8), this.tagName = t8.tagName || "span", this.class = t8.class || "", this.attrs = t8.attributes || null;
  }
  eq(t8) {
    var e7, i12;
    return this == t8 || t8 instanceof s168 && this.tagName == t8.tagName && (this.class || ((e7 = this.attrs) === null || e7 === void 0 ? void 0 : e7.class)) == (t8.class || ((i12 = t8.attrs) === null || i12 === void 0 ? void 0 : i12.class)) && Ti(this.attrs, t8.attrs, "class");
  }
  range(t8, e7 = t8) {
    if (t8 >= e7) throw new RangeError("Mark decorations may not be empty");
    return super.range(t8, e7);
  }
};
zt7.prototype.point = false;
var It8 = class s169 extends R11 {
  constructor(t8) {
    super(-2e8, -2e8, null, t8);
  }
  eq(t8) {
    return t8 instanceof s169 && this.spec.class == t8.spec.class && Ti(this.spec.attributes, t8.spec.attributes);
  }
  range(t8, e7 = t8) {
    if (e7 != t8) throw new RangeError("Line decoration ranges must be zero-length");
    return super.range(t8, e7);
  }
};
It8.prototype.mapMode = E6.TrackBefore;
It8.prototype.point = true;
var lt9 = class s170 extends R11 {
  constructor(t8, e7, i12, n14, r2, o) {
    super(e7, i12, r2, t8), this.block = n14, this.isReplace = o, this.mapMode = n14 ? e7 <= 0 ? E6.TrackBefore : E6.TrackAfter : E6.TrackDel;
  }
  get type() {
    return this.startSide != this.endSide ? V14.WidgetRange : this.startSide <= 0 ? V14.WidgetBefore : V14.WidgetAfter;
  }
  get heightRelevant() {
    return this.block || !!this.widget && (this.widget.estimatedHeight >= 5 || this.widget.lineBreaks > 0);
  }
  eq(t8) {
    return t8 instanceof s170 && Un(this.widget, t8.widget) && this.block == t8.block && this.startSide == t8.startSide && this.endSide == t8.endSide;
  }
  range(t8, e7 = t8) {
    if (this.isReplace && (t8 > e7 || t8 == e7 && this.startSide > 0 && this.endSide <= 0)) throw new RangeError("Invalid range for replacement decoration");
    if (!this.isReplace && e7 != t8) throw new RangeError("Widget decorations can only have zero-length ranges");
    return super.range(t8, e7);
  }
};
lt9.prototype.point = true;
function Ns(s212, t8 = false) {
  let { inclusiveStart: e7, inclusiveEnd: i12 } = s212;
  return e7 == null && (e7 = s212.inclusive), i12 == null && (i12 = s212.inclusive), { start: e7 ?? t8, end: i12 ?? t8 };
}
function Un(s212, t8) {
  return s212 == t8 || !!(s212 && t8 && s212.compare(t8));
}
function _e7(s212, t8, e7, i12 = 0) {
  let n14 = e7.length - 1;
  n14 >= 0 && e7[n14] + i12 >= s212 ? e7[n14] = Math.max(e7[n14], t8) : e7.push(s212, t8);
}
var Lt7 = class s171 {
  constructor(t8, e7, i12, n14) {
    this.doc = t8, this.pos = e7, this.end = i12, this.disallowBlockEffectsFor = n14, this.content = [], this.curLine = null, this.breakAtStart = 0, this.pendingBuffer = 0, this.bufferMarks = [], this.atCursorPos = true, this.openStart = -1, this.openEnd = -1, this.text = "", this.textOff = 0, this.cursor = t8.iter(), this.skip = e7;
  }
  posCovered() {
    if (this.content.length == 0) return !this.breakAtStart && this.doc.lineAt(this.pos).from != this.pos;
    let t8 = this.content[this.content.length - 1];
    return !(t8.breakAfter || t8 instanceof yt7 && t8.deco.endSide < 0);
  }
  getLine() {
    return this.curLine || (this.content.push(this.curLine = new P13()), this.atCursorPos = true), this.curLine;
  }
  flushBuffer(t8 = this.bufferMarks) {
    this.pendingBuffer && (this.curLine.append(Jt7(new Ft8(-1), t8), t8.length), this.pendingBuffer = 0);
  }
  addBlockWidget(t8) {
    this.flushBuffer(), this.curLine = null, this.content.push(t8);
  }
  finish(t8) {
    this.pendingBuffer && t8 <= this.bufferMarks.length ? this.flushBuffer() : this.pendingBuffer = 0, !this.posCovered() && !(t8 && this.content.length && this.content[this.content.length - 1] instanceof yt7) && this.getLine();
  }
  buildText(t8, e7, i12) {
    for (; t8 > 0; ) {
      if (this.textOff == this.text.length) {
        let { value: r2, lineBreak: o, done: l11 } = this.cursor.next(this.skip);
        if (this.skip = 0, l11) throw new Error("Ran out of text content when drawing inline views");
        if (o) {
          this.posCovered() || this.getLine(), this.content.length ? this.content[this.content.length - 1].breakAfter = 1 : this.breakAtStart = 1, this.flushBuffer(), this.curLine = null, this.atCursorPos = true, t8--;
          continue;
        } else this.text = r2, this.textOff = 0;
      }
      let n14 = Math.min(this.text.length - this.textOff, t8, 512);
      this.flushBuffer(e7.slice(e7.length - i12)), this.getLine().append(Jt7(new nt9(this.text.slice(this.textOff, this.textOff + n14)), e7), i12), this.atCursorPos = true, this.textOff += n14, t8 -= n14, i12 = 0;
    }
  }
  span(t8, e7, i12, n14) {
    this.buildText(e7 - t8, i12, n14), this.pos = e7, this.openStart < 0 && (this.openStart = n14);
  }
  point(t8, e7, i12, n14, r2, o) {
    if (this.disallowBlockEffectsFor[o] && i12 instanceof lt9) {
      if (i12.block) throw new RangeError("Block decorations may not be specified via plugins");
      if (e7 > this.doc.lineAt(this.pos).to) throw new RangeError("Decorations that replace line breaks may not be specified via plugins");
    }
    let l11 = e7 - t8;
    if (i12 instanceof lt9) if (i12.block) i12.startSide > 0 && !this.posCovered() && this.getLine(), this.addBlockWidget(new yt7(i12.widget || new pe11("div"), l11, i12));
    else {
      let h3 = Wt8.create(i12.widget || new pe11("span"), l11, l11 ? 0 : i12.startSide), c3 = this.atCursorPos && !h3.isEditable && r2 <= n14.length && (t8 < e7 || i12.startSide > 0), a2 = !h3.isEditable && (t8 < e7 || r2 > n14.length || i12.startSide <= 0), f6 = this.getLine();
      this.pendingBuffer == 2 && !c3 && !h3.isEditable && (this.pendingBuffer = 0), this.flushBuffer(n14), c3 && (f6.append(Jt7(new Ft8(1), n14), r2), r2 = n14.length + Math.max(0, r2 - n14.length)), f6.append(Jt7(h3, n14), r2), this.atCursorPos = a2, this.pendingBuffer = a2 ? t8 < e7 || r2 > n14.length ? 1 : 2 : 0, this.pendingBuffer && (this.bufferMarks = n14.slice());
    }
    else this.doc.lineAt(this.pos).from == this.pos && this.getLine().addLineDeco(i12);
    l11 && (this.textOff + l11 <= this.text.length ? this.textOff += l11 : (this.skip += l11 - (this.text.length - this.textOff), this.text = "", this.textOff = 0), this.pos = e7), this.openStart < 0 && (this.openStart = r2);
  }
  static build(t8, e7, i12, n14, r2) {
    let o = new s171(t8, e7, i12, r2);
    return o.openEnd = T11.spans(n14, e7, i12, o), o.openStart < 0 && (o.openStart = o.openEnd), o.finish(o.openEnd), o;
  }
};
function Jt7(s212, t8) {
  for (let e7 of t8) s212 = new rt9(e7, [s212], s212.length);
  return s212;
}
var pe11 = class extends ot9 {
  constructor(t8) {
    super(), this.tag = t8;
  }
  eq(t8) {
    return t8.tag == this.tag;
  }
  toDOM() {
    return document.createElement(this.tag);
  }
  updateDOM(t8) {
    return t8.nodeName.toLowerCase() == this.tag;
  }
  get isHidden() {
    return true;
  }
};
var Vs3 = y11.define();
var Ws5 = y11.define();
var Fs5 = y11.define();
var zs5 = y11.define();
var Xe9 = y11.define();
var Is5 = y11.define();
var Ks5 = y11.define();
var qs5 = y11.define({ combine: (s212) => s212.some((t8) => t8) });
var js5 = y11.define({ combine: (s212) => s212.some((t8) => t8) });
var Bt7 = class s172 {
  constructor(t8, e7 = "nearest", i12 = "nearest", n14 = 5, r2 = 5, o = false) {
    this.range = t8, this.y = e7, this.x = i12, this.yMargin = n14, this.xMargin = r2, this.isSnapshot = o;
  }
  map(t8) {
    return t8.empty ? this : new s172(this.range.map(t8), this.y, this.x, this.yMargin, this.xMargin, this.isSnapshot);
  }
  clip(t8) {
    return this.range.to <= t8.doc.length ? this : new s172(x7.cursor(t8.doc.length), this.y, this.x, this.yMargin, this.xMargin, this.isSnapshot);
  }
};
var Zt7 = v5.define({ map: (s212, t8) => s212.map(t8) });
function it6(s212, t8, e7) {
  let i12 = s212.facet(zs5);
  i12.length ? i12[0](t8) : window.onerror ? window.onerror(String(t8), e7, void 0, void 0, t8) : e7 ? console.error(e7 + ":", t8) : console.error(t8);
}
var Re9 = y11.define({ combine: (s212) => s212.length ? s212[0] : true });
var Jn = 0;
var kt3 = y11.define();
var H5 = class s173 {
  constructor(t8, e7, i12, n14, r2) {
    this.id = t8, this.create = e7, this.domEventHandlers = i12, this.domEventObservers = n14, this.extension = r2(this);
  }
  static define(t8, e7) {
    let { eventHandlers: i12, eventObservers: n14, provide: r2, decorations: o } = e7 || {};
    return new s173(Jn++, t8, i12, n14, (l11) => {
      let h3 = [kt3.of(l11)];
      return o && h3.push(Kt7.of((c3) => {
        let a2 = c3.plugin(l11);
        return a2 ? o(a2) : R11.none;
      })), r2 && h3.push(r2(l11)), h3;
    });
  }
  static fromClass(t8, e7) {
    return s173.define((i12) => new t8(i12), e7);
  }
};
var Et8 = class {
  constructor(t8) {
    this.spec = t8, this.mustUpdate = null, this.value = null;
  }
  update(t8) {
    if (this.value) {
      if (this.mustUpdate) {
        let e7 = this.mustUpdate;
        if (this.mustUpdate = null, this.value.update) try {
          this.value.update(e7);
        } catch (i12) {
          if (it6(e7.state, i12, "CodeMirror plugin crashed"), this.value.destroy) try {
            this.value.destroy();
          } catch {
          }
          this.deactivate();
        }
      }
    } else if (this.spec) try {
      this.value = this.spec.create(t8);
    } catch (e7) {
      it6(t8.state, e7, "CodeMirror plugin crashed"), this.deactivate();
    }
    return this;
  }
  destroy(t8) {
    var e7;
    if (!((e7 = this.value) === null || e7 === void 0) && e7.destroy) try {
      this.value.destroy();
    } catch (i12) {
      it6(t8.state, i12, "CodeMirror plugin crashed");
    }
  }
  deactivate() {
    this.spec = this.value = null;
  }
};
var Ys5 = y11.define();
var Le10 = y11.define();
var Kt7 = y11.define();
var Oi = y11.define();
var _s5 = y11.define();
function Fi5(s212, t8, e7) {
  let i12 = s212.state.facet(_s5);
  if (!i12.length) return i12;
  let n14 = i12.map((o) => o instanceof Function ? o(s212) : o), r2 = [];
  return T11.spans(n14, t8, e7, { point() {
  }, span(o, l11, h3, c3) {
    let a2 = r2;
    for (let f6 = h3.length - 1; f6 >= 0; f6--, c3--) {
      let d4 = h3[f6].spec.bidiIsolate, u3;
      if (d4 != null) if (c3 > 0 && a2.length && (u3 = a2[a2.length - 1]).to == o && u3.direction == d4) u3.to = l11, a2 = u3.inner;
      else {
        let g8 = { from: o, to: l11, direction: d4, inner: [] };
        a2.push(g8), a2 = g8.inner;
      }
    }
  } }), r2;
}
var Xs5 = y11.define();
function Gs5(s212) {
  let t8 = 0, e7 = 0, i12 = 0, n14 = 0;
  for (let r2 of s212.state.facet(Xs5)) {
    let o = r2(s212);
    o && (o.left != null && (t8 = Math.max(t8, o.left)), o.right != null && (e7 = Math.max(e7, o.right)), o.top != null && (i12 = Math.max(i12, o.top)), o.bottom != null && (n14 = Math.max(n14, o.bottom)));
  }
  return { left: t8, right: e7, top: i12, bottom: n14 };
}
var At8 = y11.define();
var K9 = class s174 {
  constructor(t8, e7, i12, n14) {
    this.fromA = t8, this.toA = e7, this.fromB = i12, this.toB = n14;
  }
  join(t8) {
    return new s174(Math.min(this.fromA, t8.fromA), Math.max(this.toA, t8.toA), Math.min(this.fromB, t8.fromB), Math.max(this.toB, t8.toB));
  }
  addToSet(t8) {
    let e7 = t8.length, i12 = this;
    for (; e7 > 0; e7--) {
      let n14 = t8[e7 - 1];
      if (!(n14.fromA > i12.toA)) {
        if (n14.toA < i12.fromA) break;
        i12 = i12.join(n14), t8.splice(e7 - 1, 1);
      }
    }
    return t8.splice(e7, 0, i12), t8;
  }
  static extendWithRanges(t8, e7) {
    if (e7.length == 0) return t8;
    let i12 = [];
    for (let n14 = 0, r2 = 0, o = 0, l11 = 0; ; n14++) {
      let h3 = n14 == t8.length ? null : t8[n14], c3 = o - l11, a2 = h3 ? h3.fromB : 1e9;
      for (; r2 < e7.length && e7[r2] < a2; ) {
        let f6 = e7[r2], d4 = e7[r2 + 1], u3 = Math.max(l11, f6), g8 = Math.min(a2, d4);
        if (u3 <= g8 && new s174(u3 + c3, g8 + c3, u3, g8).addToSet(i12), d4 > a2) break;
        r2 += 2;
      }
      if (!h3) return i12;
      new s174(h3.fromA, h3.toA, h3.fromB, h3.toB).addToSet(i12), o = h3.toA, l11 = h3.toB;
    }
  }
};
var me12 = class s175 {
  constructor(t8, e7, i12) {
    this.view = t8, this.state = e7, this.transactions = i12, this.flags = 0, this.startState = t8.state, this.changes = P12.empty(this.startState.doc.length);
    for (let r2 of i12) this.changes = this.changes.compose(r2.changes);
    let n14 = [];
    this.changes.iterChangedRanges((r2, o, l11, h3) => n14.push(new K9(r2, o, l11, h3))), this.changedRanges = n14;
  }
  static create(t8, e7, i12) {
    return new s175(t8, e7, i12);
  }
  get viewportChanged() {
    return (this.flags & 4) > 0;
  }
  get heightChanged() {
    return (this.flags & 2) > 0;
  }
  get geometryChanged() {
    return this.docChanged || (this.flags & 10) > 0;
  }
  get focusChanged() {
    return (this.flags & 1) > 0;
  }
  get docChanged() {
    return !this.changes.empty;
  }
  get selectionSet() {
    return this.transactions.some((t8) => t8.selection);
  }
  get empty() {
    return this.flags == 0 && this.transactions.length == 0;
  }
};
var B7 = function(s212) {
  return s212[s212.LTR = 0] = "LTR", s212[s212.RTL = 1] = "RTL", s212;
}(B7 || (B7 = {}));
var qt6 = B7.LTR;
var $s5 = B7.RTL;
function Us5(s212) {
  let t8 = [];
  for (let e7 = 0; e7 < s212.length; e7++) t8.push(1 << +s212[e7]);
  return t8;
}
var Zn = Us5("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008");
var Qn2 = Us5("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333");
var Ge9 = /* @__PURE__ */ Object.create(null);
var Y13 = [];
for (let s212 of ["()", "[]", "{}"]) {
  let t8 = s212.charCodeAt(0), e7 = s212.charCodeAt(1);
  Ge9[t8] = e7, Ge9[e7] = -t8;
}
function tr5(s212) {
  return s212 <= 247 ? Zn[s212] : 1424 <= s212 && s212 <= 1524 ? 2 : 1536 <= s212 && s212 <= 1785 ? Qn2[s212 - 1536] : 1774 <= s212 && s212 <= 2220 ? 4 : 8192 <= s212 && s212 <= 8203 ? 256 : 64336 <= s212 && s212 <= 65023 ? 4 : s212 == 8204 ? 256 : 1;
}
var er5 = /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;
var X11 = class {
  get dir() {
    return this.level % 2 ? $s5 : qt6;
  }
  constructor(t8, e7, i12) {
    this.from = t8, this.to = e7, this.level = i12;
  }
  side(t8, e7) {
    return this.dir == e7 == t8 ? this.to : this.from;
  }
  static find(t8, e7, i12, n14) {
    let r2 = -1;
    for (let o = 0; o < t8.length; o++) {
      let l11 = t8[o];
      if (l11.from <= e7 && l11.to >= e7) {
        if (l11.level == i12) return o;
        (r2 < 0 || (n14 != 0 ? n14 < 0 ? l11.from < e7 : l11.to > e7 : t8[r2].level > l11.level)) && (r2 = o);
      }
    }
    if (r2 < 0) throw new RangeError("Index out of range");
    return r2;
  }
};
function Js5(s212, t8) {
  if (s212.length != t8.length) return false;
  for (let e7 = 0; e7 < s212.length; e7++) {
    let i12 = s212[e7], n14 = t8[e7];
    if (i12.from != n14.from || i12.to != n14.to || i12.direction != n14.direction || !Js5(i12.inner, n14.inner)) return false;
  }
  return true;
}
var D9 = [];
function ir5(s212, t8, e7, i12, n14) {
  for (let r2 = 0; r2 <= i12.length; r2++) {
    let o = r2 ? i12[r2 - 1].to : t8, l11 = r2 < i12.length ? i12[r2].from : e7, h3 = r2 ? 256 : n14;
    for (let c3 = o, a2 = h3, f6 = h3; c3 < l11; c3++) {
      let d4 = tr5(s212.charCodeAt(c3));
      d4 == 512 ? d4 = a2 : d4 == 8 && f6 == 4 && (d4 = 16), D9[c3] = d4 == 4 ? 2 : d4, d4 & 7 && (f6 = d4), a2 = d4;
    }
    for (let c3 = o, a2 = h3, f6 = h3; c3 < l11; c3++) {
      let d4 = D9[c3];
      if (d4 == 128) c3 < l11 - 1 && a2 == D9[c3 + 1] && a2 & 24 ? d4 = D9[c3] = a2 : D9[c3] = 256;
      else if (d4 == 64) {
        let u3 = c3 + 1;
        for (; u3 < l11 && D9[u3] == 64; ) u3++;
        let g8 = c3 && a2 == 8 || u3 < e7 && D9[u3] == 8 ? f6 == 1 ? 1 : 8 : 256;
        for (let m11 = c3; m11 < u3; m11++) D9[m11] = g8;
        c3 = u3 - 1;
      } else d4 == 8 && f6 == 1 && (D9[c3] = 1);
      a2 = d4, d4 & 7 && (f6 = d4);
    }
  }
}
function sr5(s212, t8, e7, i12, n14) {
  let r2 = n14 == 1 ? 2 : 1;
  for (let o = 0, l11 = 0, h3 = 0; o <= i12.length; o++) {
    let c3 = o ? i12[o - 1].to : t8, a2 = o < i12.length ? i12[o].from : e7;
    for (let f6 = c3, d4, u3, g8; f6 < a2; f6++) if (u3 = Ge9[d4 = s212.charCodeAt(f6)]) if (u3 < 0) {
      for (let m11 = l11 - 3; m11 >= 0; m11 -= 3) if (Y13[m11 + 1] == -u3) {
        let p3 = Y13[m11 + 2], b12 = p3 & 2 ? n14 : p3 & 4 ? p3 & 1 ? r2 : n14 : 0;
        b12 && (D9[f6] = D9[Y13[m11]] = b12), l11 = m11;
        break;
      }
    } else {
      if (Y13.length == 189) break;
      Y13[l11++] = f6, Y13[l11++] = d4, Y13[l11++] = h3;
    }
    else if ((g8 = D9[f6]) == 2 || g8 == 1) {
      let m11 = g8 == n14;
      h3 = m11 ? 0 : 1;
      for (let p3 = l11 - 3; p3 >= 0; p3 -= 3) {
        let b12 = Y13[p3 + 2];
        if (b12 & 2) break;
        if (m11) Y13[p3 + 2] |= 2;
        else {
          if (b12 & 4) break;
          Y13[p3 + 2] |= 4;
        }
      }
    }
  }
}
function nr5(s212, t8, e7, i12) {
  for (let n14 = 0, r2 = i12; n14 <= e7.length; n14++) {
    let o = n14 ? e7[n14 - 1].to : s212, l11 = n14 < e7.length ? e7[n14].from : t8;
    for (let h3 = o; h3 < l11; ) {
      let c3 = D9[h3];
      if (c3 == 256) {
        let a2 = h3 + 1;
        for (; ; ) if (a2 == l11) {
          if (n14 == e7.length) break;
          a2 = e7[n14++].to, l11 = n14 < e7.length ? e7[n14].from : t8;
        } else if (D9[a2] == 256) a2++;
        else break;
        let f6 = r2 == 1, d4 = (a2 < t8 ? D9[a2] : i12) == 1, u3 = f6 == d4 ? f6 ? 1 : 2 : i12;
        for (let g8 = a2, m11 = n14, p3 = m11 ? e7[m11 - 1].to : s212; g8 > h3; ) g8 == p3 && (g8 = e7[--m11].from, p3 = m11 ? e7[m11 - 1].to : s212), D9[--g8] = u3;
        h3 = a2;
      } else r2 = c3, h3++;
    }
  }
}
function $e11(s212, t8, e7, i12, n14, r2, o) {
  let l11 = i12 % 2 ? 2 : 1;
  if (i12 % 2 == n14 % 2) for (let h3 = t8, c3 = 0; h3 < e7; ) {
    let a2 = true, f6 = false;
    if (c3 == r2.length || h3 < r2[c3].from) {
      let m11 = D9[h3];
      m11 != l11 && (a2 = false, f6 = m11 == 16);
    }
    let d4 = !a2 && l11 == 1 ? [] : null, u3 = a2 ? i12 : i12 + 1, g8 = h3;
    t: for (; ; ) if (c3 < r2.length && g8 == r2[c3].from) {
      if (f6) break t;
      let m11 = r2[c3];
      if (!a2) for (let p3 = m11.to, b12 = c3 + 1; ; ) {
        if (p3 == e7) break t;
        if (b12 < r2.length && r2[b12].from == p3) p3 = r2[b12++].to;
        else {
          if (D9[p3] == l11) break t;
          break;
        }
      }
      if (c3++, d4) d4.push(m11);
      else {
        m11.from > h3 && o.push(new X11(h3, m11.from, u3));
        let p3 = m11.direction == qt6 != !(u3 % 2);
        Ue9(s212, p3 ? i12 + 1 : i12, n14, m11.inner, m11.from, m11.to, o), h3 = m11.to;
      }
      g8 = m11.to;
    } else {
      if (g8 == e7 || (a2 ? D9[g8] != l11 : D9[g8] == l11)) break;
      g8++;
    }
    d4 ? $e11(s212, h3, g8, i12 + 1, n14, d4, o) : h3 < g8 && o.push(new X11(h3, g8, u3)), h3 = g8;
  }
  else for (let h3 = e7, c3 = r2.length; h3 > t8; ) {
    let a2 = true, f6 = false;
    if (!c3 || h3 > r2[c3 - 1].to) {
      let m11 = D9[h3 - 1];
      m11 != l11 && (a2 = false, f6 = m11 == 16);
    }
    let d4 = !a2 && l11 == 1 ? [] : null, u3 = a2 ? i12 : i12 + 1, g8 = h3;
    t: for (; ; ) if (c3 && g8 == r2[c3 - 1].to) {
      if (f6) break t;
      let m11 = r2[--c3];
      if (!a2) for (let p3 = m11.from, b12 = c3; ; ) {
        if (p3 == t8) break t;
        if (b12 && r2[b12 - 1].to == p3) p3 = r2[--b12].from;
        else {
          if (D9[p3 - 1] == l11) break t;
          break;
        }
      }
      if (d4) d4.push(m11);
      else {
        m11.to < h3 && o.push(new X11(m11.to, h3, u3));
        let p3 = m11.direction == qt6 != !(u3 % 2);
        Ue9(s212, p3 ? i12 + 1 : i12, n14, m11.inner, m11.from, m11.to, o), h3 = m11.from;
      }
      g8 = m11.from;
    } else {
      if (g8 == t8 || (a2 ? D9[g8 - 1] != l11 : D9[g8 - 1] == l11)) break;
      g8--;
    }
    d4 ? $e11(s212, g8, h3, i12 + 1, n14, d4, o) : g8 < h3 && o.push(new X11(g8, h3, u3)), h3 = g8;
  }
}
function Ue9(s212, t8, e7, i12, n14, r2, o) {
  let l11 = t8 % 2 ? 2 : 1;
  ir5(s212, n14, r2, i12, l11), sr5(s212, n14, r2, i12, l11), nr5(n14, r2, i12, l11), $e11(s212, n14, r2, t8, e7, i12, o);
}
function Zs5(s212, t8, e7) {
  if (!s212) return [new X11(0, 0, t8 == $s5 ? 1 : 0)];
  if (t8 == qt6 && !e7.length && !er5.test(s212)) return Qs5(s212.length);
  if (e7.length) for (; s212.length > D9.length; ) D9[D9.length] = 256;
  let i12 = [], n14 = t8 == qt6 ? 0 : 1;
  return Ue9(s212, n14, n14, e7, 0, s212.length, i12), i12;
}
function Qs5(s212) {
  return [new X11(0, s212, 0)];
}
var tn7 = "";
function en6(s212, t8, e7, i12, n14) {
  var r2;
  let o = i12.head - s212.from, l11 = -1;
  if (o == 0) {
    if (!n14 || !s212.length) return null;
    t8[0].level != e7 && (o = t8[0].side(false, e7), l11 = 0);
  } else if (o == s212.length) {
    if (n14) return null;
    let d4 = t8[t8.length - 1];
    d4.level != e7 && (o = d4.side(true, e7), l11 = t8.length - 1);
  }
  l11 < 0 && (l11 = X11.find(t8, o, (r2 = i12.bidiLevel) !== null && r2 !== void 0 ? r2 : -1, i12.assoc));
  let h3 = t8[l11];
  o == h3.side(n14, e7) && (h3 = t8[l11 += n14 ? 1 : -1], o = h3.side(!n14, e7));
  let c3 = n14 == (h3.dir == e7), a2 = _11(s212.text, o, c3);
  if (tn7 = s212.text.slice(Math.min(o, a2), Math.max(o, a2)), a2 != h3.side(n14, e7)) return x7.cursor(a2 + s212.from, c3 ? -1 : 1, h3.level);
  let f6 = l11 == (n14 ? t8.length - 1 : 0) ? null : t8[l11 + (n14 ? 1 : -1)];
  return !f6 && h3.level != e7 ? x7.cursor(n14 ? s212.to : s212.from, n14 ? -1 : 1, e7) : f6 && f6.level < h3.level ? x7.cursor(f6.side(!n14, e7) + s212.from, n14 ? 1 : -1, f6.level) : x7.cursor(a2 + s212.from, n14 ? -1 : 1, h3.level);
}
var be12 = class extends O12 {
  get length() {
    return this.view.state.doc.length;
  }
  constructor(t8) {
    super(), this.view = t8, this.decorations = [], this.dynamicDecorationMap = [], this.domChanged = null, this.hasComposition = null, this.markedForComposition = /* @__PURE__ */ new Set(), this.minWidth = 0, this.minWidthFrom = 0, this.minWidthTo = 0, this.impreciseAnchor = null, this.impreciseHead = null, this.forceSelection = false, this.lastUpdate = Date.now(), this.setDOM(t8.contentDOM), this.children = [new P13()], this.children[0].setParent(this), this.updateDeco(), this.updateInner([new K9(0, 0, 0, t8.state.doc.length)], 0, null);
  }
  update(t8) {
    var e7;
    let i12 = t8.changedRanges;
    this.minWidth > 0 && i12.length && (i12.every(({ fromA: c3, toA: a2 }) => a2 < this.minWidthFrom || c3 > this.minWidthTo) ? (this.minWidthFrom = t8.changes.mapPos(this.minWidthFrom, 1), this.minWidthTo = t8.changes.mapPos(this.minWidthTo, 1)) : this.minWidth = this.minWidthFrom = this.minWidthTo = 0);
    let n14 = -1;
    this.view.inputState.composing >= 0 && (!((e7 = this.domChanged) === null || e7 === void 0) && e7.newSel ? n14 = this.domChanged.newSel.head : !fr5(t8.changes, this.hasComposition) && !t8.selectionSet && (n14 = t8.state.selection.main.head));
    let r2 = n14 > -1 ? or5(this.view, t8.changes, n14) : null;
    if (this.domChanged = null, this.hasComposition) {
      this.markedForComposition.clear();
      let { from: c3, to: a2 } = this.hasComposition;
      i12 = new K9(c3, a2, t8.changes.mapPos(c3, -1), t8.changes.mapPos(a2, 1)).addToSet(i12.slice());
    }
    this.hasComposition = r2 ? { from: r2.range.fromB, to: r2.range.toB } : null, (w9.ie || w9.chrome) && !r2 && t8 && t8.state.doc.lines != t8.startState.doc.lines && (this.forceSelection = true);
    let o = this.decorations, l11 = this.updateDeco(), h3 = ar5(o, l11, t8.changes);
    return i12 = K9.extendWithRanges(i12, h3), !(this.flags & 7) && i12.length == 0 ? false : (this.updateInner(i12, t8.startState.doc.length, r2), t8.transactions.length && (this.lastUpdate = Date.now()), true);
  }
  updateInner(t8, e7, i12) {
    this.view.viewState.mustMeasureContent = true, this.updateChildren(t8, e7, i12);
    let { observer: n14 } = this.view;
    n14.ignore(() => {
      this.dom.style.height = this.view.viewState.contentHeight / this.view.scaleY + "px", this.dom.style.flexBasis = this.minWidth ? this.minWidth + "px" : "";
      let o = w9.chrome || w9.ios ? { node: n14.selectionRange.focusNode, written: false } : void 0;
      this.sync(this.view, o), this.flags &= -8, o && (o.written || n14.selectionRange.focusNode != o.node) && (this.forceSelection = true), this.dom.style.height = "";
    }), this.markedForComposition.forEach((o) => o.flags &= -9);
    let r2 = [];
    if (this.view.viewport.from || this.view.viewport.to < this.view.state.doc.length) for (let o of this.children) o instanceof yt7 && o.widget instanceof we12 && r2.push(o.dom);
    n14.updateGaps(r2);
  }
  updateChildren(t8, e7, i12) {
    let n14 = i12 ? i12.range.addToSet(t8.slice()) : t8, r2 = this.childCursor(e7);
    for (let o = n14.length - 1; ; o--) {
      let l11 = o >= 0 ? n14[o] : null;
      if (!l11) break;
      let { fromA: h3, toA: c3, fromB: a2, toB: f6 } = l11, d4, u3, g8, m11;
      if (i12 && i12.range.fromB < f6 && i12.range.toB > a2) {
        let y18 = Lt7.build(this.view.state.doc, a2, i12.range.fromB, this.decorations, this.dynamicDecorationMap), x11 = Lt7.build(this.view.state.doc, i12.range.toB, f6, this.decorations, this.dynamicDecorationMap);
        u3 = y18.breakAtStart, g8 = y18.openStart, m11 = x11.openEnd;
        let C11 = this.compositionView(i12);
        x11.breakAtStart ? C11.breakAfter = 1 : x11.content.length && C11.merge(C11.length, C11.length, x11.content[0], false, x11.openStart, 0) && (C11.breakAfter = x11.content[0].breakAfter, x11.content.shift()), y18.content.length && C11.merge(0, 0, y18.content[y18.content.length - 1], true, 0, y18.openEnd) && y18.content.pop(), d4 = y18.content.concat(C11).concat(x11.content);
      } else ({ content: d4, breakAtStart: u3, openStart: g8, openEnd: m11 } = Lt7.build(this.view.state.doc, a2, f6, this.decorations, this.dynamicDecorationMap));
      let { i: p3, off: b12 } = r2.findPos(c3, 1), { i: v10, off: S17 } = r2.findPos(h3, -1);
      Os5(this, v10, S17, p3, b12, d4, u3, g8, m11);
    }
    i12 && this.fixCompositionDOM(i12);
  }
  compositionView(t8) {
    let e7 = new nt9(t8.text.nodeValue);
    e7.flags |= 8;
    for (let { deco: n14 } of t8.marks) e7 = new rt9(n14, [e7], e7.length);
    let i12 = new P13();
    return i12.append(e7, 0), i12;
  }
  fixCompositionDOM(t8) {
    let e7 = (r2, o) => {
      o.flags |= 8 | (o.children.some((h3) => h3.flags & 7) ? 1 : 0), this.markedForComposition.add(o);
      let l11 = O12.get(r2);
      l11 && l11 != o && (l11.dom = null), o.setDOM(r2);
    }, i12 = this.childPos(t8.range.fromB, 1), n14 = this.children[i12.i];
    e7(t8.line, n14);
    for (let r2 = t8.marks.length - 1; r2 >= -1; r2--) i12 = n14.childPos(i12.off, 1), n14 = n14.children[i12.i], e7(r2 >= 0 ? t8.marks[r2].node : t8.text, n14);
  }
  updateSelection(t8 = false, e7 = false) {
    (t8 || !this.view.observer.selectionRange.focusNode) && this.view.observer.readSelectionRange();
    let i12 = this.view.root.activeElement, n14 = i12 == this.dom, r2 = !n14 && re9(this.dom, this.view.observer.selectionRange) && !(i12 && this.dom.contains(i12));
    if (!(n14 || e7 || r2)) return;
    let o = this.forceSelection;
    this.forceSelection = false;
    let l11 = this.view.state.selection.main, h3 = this.moveToLine(this.domAtPos(l11.anchor)), c3 = l11.empty ? h3 : this.moveToLine(this.domAtPos(l11.head));
    if (w9.gecko && l11.empty && !this.hasComposition && rr5(h3)) {
      let f6 = document.createTextNode("");
      this.view.observer.ignore(() => h3.node.insertBefore(f6, h3.node.childNodes[h3.offset] || null)), h3 = c3 = new N13(f6, 0), o = true;
    }
    let a2 = this.view.observer.selectionRange;
    (o || !a2.focusNode || !ue11(h3.node, h3.offset, a2.anchorNode, a2.anchorOffset) || !ue11(c3.node, c3.offset, a2.focusNode, a2.focusOffset)) && (this.view.observer.ignore(() => {
      w9.android && w9.chrome && this.dom.contains(a2.focusNode) && cr5(a2.focusNode, this.dom) && (this.dom.blur(), this.dom.focus({ preventScroll: true }));
      let f6 = de9(this.view.root);
      if (f6) if (l11.empty) {
        if (w9.gecko) {
          let d4 = lr5(h3.node, h3.offset);
          if (d4 && d4 != 3) {
            let u3 = nn6(h3.node, h3.offset, d4 == 1 ? 1 : -1);
            u3 && (h3 = new N13(u3.node, u3.offset));
          }
        }
        f6.collapse(h3.node, h3.offset), l11.bidiLevel != null && f6.caretBidiLevel !== void 0 && (f6.caretBidiLevel = l11.bidiLevel);
      } else if (f6.extend) {
        f6.collapse(h3.node, h3.offset);
        try {
          f6.extend(c3.node, c3.offset);
        } catch {
        }
      } else {
        let d4 = document.createRange();
        l11.anchor > l11.head && ([h3, c3] = [c3, h3]), d4.setEnd(c3.node, c3.offset), d4.setStart(h3.node, h3.offset), f6.removeAllRanges(), f6.addRange(d4);
      }
      r2 && this.view.root.activeElement == this.dom && (this.dom.blur(), i12 && i12.focus());
    }), this.view.observer.setSelectionRange(h3, c3)), this.impreciseAnchor = h3.precise ? null : new N13(a2.anchorNode, a2.anchorOffset), this.impreciseHead = c3.precise ? null : new N13(a2.focusNode, a2.focusOffset);
  }
  enforceCursorAssoc() {
    if (this.hasComposition) return;
    let { view: t8 } = this, e7 = t8.state.selection.main, i12 = de9(t8.root), { anchorNode: n14, anchorOffset: r2 } = t8.observer.selectionRange;
    if (!i12 || !e7.empty || !e7.assoc || !i12.modify) return;
    let o = P13.find(this, e7.head);
    if (!o) return;
    let l11 = o.posAtStart;
    if (e7.head == l11 || e7.head == l11 + o.length) return;
    let h3 = this.coordsAt(e7.head, -1), c3 = this.coordsAt(e7.head, 1);
    if (!h3 || !c3 || h3.bottom > c3.top) return;
    let a2 = this.domAtPos(e7.head + e7.assoc);
    i12.collapse(a2.node, a2.offset), i12.modify("move", e7.assoc < 0 ? "forward" : "backward", "lineboundary"), t8.observer.readSelectionRange();
    let f6 = t8.observer.selectionRange;
    t8.docView.posFromDOM(f6.anchorNode, f6.anchorOffset) != e7.from && i12.collapse(n14, r2);
  }
  moveToLine(t8) {
    let e7 = this.dom, i12;
    if (t8.node != e7) return t8;
    for (let n14 = t8.offset; !i12 && n14 < e7.childNodes.length; n14++) {
      let r2 = O12.get(e7.childNodes[n14]);
      r2 instanceof P13 && (i12 = r2.domAtPos(0));
    }
    for (let n14 = t8.offset - 1; !i12 && n14 >= 0; n14--) {
      let r2 = O12.get(e7.childNodes[n14]);
      r2 instanceof P13 && (i12 = r2.domAtPos(r2.length));
    }
    return i12 ? new N13(i12.node, i12.offset, true) : t8;
  }
  nearest(t8) {
    for (let e7 = t8; e7; ) {
      let i12 = O12.get(e7);
      if (i12 && i12.rootView == this) return i12;
      e7 = e7.parentNode;
    }
    return null;
  }
  posFromDOM(t8, e7) {
    let i12 = this.nearest(t8);
    if (!i12) throw new RangeError("Trying to find position for a DOM position outside of the document");
    return i12.localPosFromDOM(t8, e7) + i12.posAtStart;
  }
  domAtPos(t8) {
    let { i: e7, off: i12 } = this.childCursor().findPos(t8, -1);
    for (; e7 < this.children.length - 1; ) {
      let n14 = this.children[e7];
      if (i12 < n14.length || n14 instanceof P13) break;
      e7++, i12 = 0;
    }
    return this.children[e7].domAtPos(i12);
  }
  coordsAt(t8, e7) {
    let i12 = null, n14 = 0;
    for (let r2 = this.length, o = this.children.length - 1; o >= 0; o--) {
      let l11 = this.children[o], h3 = r2 - l11.breakAfter, c3 = h3 - l11.length;
      if (h3 < t8) break;
      c3 <= t8 && (c3 < t8 || l11.covers(-1)) && (h3 > t8 || l11.covers(1)) && (!i12 || l11 instanceof P13 && !(i12 instanceof P13 && e7 >= 0)) && (i12 = l11, n14 = c3), r2 = c3;
    }
    return i12 ? i12.coordsAt(t8 - n14, e7) : null;
  }
  coordsForChar(t8) {
    let { i: e7, off: i12 } = this.childPos(t8, 1), n14 = this.children[e7];
    if (!(n14 instanceof P13)) return null;
    for (; n14.children.length; ) {
      let { i: l11, off: h3 } = n14.childPos(i12, 1);
      for (; ; l11++) {
        if (l11 == n14.children.length) return null;
        if ((n14 = n14.children[l11]).length) break;
      }
      i12 = h3;
    }
    if (!(n14 instanceof nt9)) return null;
    let r2 = _11(n14.text, i12);
    if (r2 == i12) return null;
    let o = ct3(n14.dom, i12, r2).getClientRects();
    for (let l11 = 0; l11 < o.length; l11++) {
      let h3 = o[l11];
      if (l11 == o.length - 1 || h3.top < h3.bottom && h3.left < h3.right) return h3;
    }
    return null;
  }
  measureVisibleLineHeights(t8) {
    let e7 = [], { from: i12, to: n14 } = t8, r2 = this.view.contentDOM.clientWidth, o = r2 > Math.max(this.view.scrollDOM.clientWidth, this.minWidth) + 1, l11 = -1, h3 = this.view.textDirection == B7.LTR;
    for (let c3 = 0, a2 = 0; a2 < this.children.length; a2++) {
      let f6 = this.children[a2], d4 = c3 + f6.length;
      if (d4 > n14) break;
      if (c3 >= i12) {
        let u3 = f6.dom.getBoundingClientRect();
        if (e7.push(u3.height), o) {
          let g8 = f6.dom.lastChild, m11 = g8 ? xt8(g8) : [];
          if (m11.length) {
            let p3 = m11[m11.length - 1], b12 = h3 ? p3.right - u3.left : u3.right - p3.left;
            b12 > l11 && (l11 = b12, this.minWidth = r2, this.minWidthFrom = c3, this.minWidthTo = d4);
          }
        }
      }
      c3 = d4 + f6.breakAfter;
    }
    return e7;
  }
  textDirectionAt(t8) {
    let { i: e7 } = this.childPos(t8, 1);
    return getComputedStyle(this.children[e7].dom).direction == "rtl" ? B7.RTL : B7.LTR;
  }
  measureTextSize() {
    for (let r2 of this.children) if (r2 instanceof P13) {
      let o = r2.measureTextSize();
      if (o) return o;
    }
    let t8 = document.createElement("div"), e7, i12, n14;
    return t8.className = "cm-line", t8.style.width = "99999px", t8.style.position = "absolute", t8.textContent = "abc def ghi jkl mno pqr stu", this.view.observer.ignore(() => {
      this.dom.appendChild(t8);
      let r2 = xt8(t8.firstChild)[0];
      e7 = t8.getBoundingClientRect().height, i12 = r2 ? r2.width / 27 : 7, n14 = r2 ? r2.height : e7, t8.remove();
    }), { lineHeight: e7, charWidth: i12, textHeight: n14 };
  }
  childCursor(t8 = this.length) {
    let e7 = this.children.length;
    return e7 && (t8 -= this.children[--e7].length), new ge13(this.children, t8, e7);
  }
  computeBlockGapDeco() {
    let t8 = [], e7 = this.view.viewState;
    for (let i12 = 0, n14 = 0; ; n14++) {
      let r2 = n14 == e7.viewports.length ? null : e7.viewports[n14], o = r2 ? r2.from - 1 : this.length;
      if (o > i12) {
        let l11 = (e7.lineBlockAt(o).bottom - e7.lineBlockAt(i12).top) / this.view.scaleY;
        t8.push(R11.replace({ widget: new we12(l11), block: true, inclusive: true, isBlockGap: true }).range(i12, o));
      }
      if (!r2) break;
      i12 = r2.to + 1;
    }
    return R11.set(t8);
  }
  updateDeco() {
    let t8 = this.view.state.facet(Kt7).map((e7, i12) => (this.dynamicDecorationMap[i12] = typeof e7 == "function") ? e7(this.view) : e7);
    for (let e7 = t8.length; e7 < t8.length + 3; e7++) this.dynamicDecorationMap[e7] = false;
    return this.decorations = [...t8, this.computeBlockGapDeco(), this.view.viewState.lineGapDeco];
  }
  scrollIntoView(t8) {
    if (t8.isSnapshot) {
      let c3 = this.view.viewState.lineBlockAt(t8.range.head);
      this.view.scrollDOM.scrollTop = c3.top - t8.yMargin, this.view.scrollDOM.scrollLeft = t8.xMargin;
      return;
    }
    let { range: e7 } = t8, i12 = this.coordsAt(e7.head, e7.empty ? e7.assoc : e7.head > e7.anchor ? -1 : 1), n14;
    if (!i12) return;
    !e7.empty && (n14 = this.coordsAt(e7.anchor, e7.anchor > e7.head ? -1 : 1)) && (i12 = { left: Math.min(i12.left, n14.left), top: Math.min(i12.top, n14.top), right: Math.max(i12.right, n14.right), bottom: Math.max(i12.bottom, n14.bottom) });
    let r2 = Gs5(this.view), o = { left: i12.left - r2.left, top: i12.top - r2.top, right: i12.right + r2.right, bottom: i12.bottom + r2.bottom }, { offsetWidth: l11, offsetHeight: h3 } = this.view.scrollDOM;
    Kn5(this.view.scrollDOM, o, e7.head < e7.anchor ? -1 : 1, t8.x, t8.y, Math.max(Math.min(t8.xMargin, l11), -l11), Math.max(Math.min(t8.yMargin, h3), -h3), this.view.textDirection == B7.LTR);
  }
};
function rr5(s212) {
  return s212.node.nodeType == 1 && s212.node.firstChild && (s212.offset == 0 || s212.node.childNodes[s212.offset - 1].contentEditable == "false") && (s212.offset == s212.node.childNodes.length || s212.node.childNodes[s212.offset].contentEditable == "false");
}
var we12 = class extends ot9 {
  constructor(t8) {
    super(), this.height = t8;
  }
  toDOM() {
    let t8 = document.createElement("div");
    return this.updateDOM(t8), t8;
  }
  eq(t8) {
    return t8.height == this.height;
  }
  updateDOM(t8) {
    return t8.style.height = this.height + "px", true;
  }
  get estimatedHeight() {
    return this.height;
  }
};
function sn6(s212, t8) {
  let e7 = s212.observer.selectionRange, i12 = e7.focusNode && nn6(e7.focusNode, e7.focusOffset, 0);
  if (!i12) return null;
  let n14 = t8 - i12.offset;
  return { from: n14, to: n14 + i12.node.nodeValue.length, node: i12.node };
}
function or5(s212, t8, e7) {
  let i12 = sn6(s212, e7);
  if (!i12) return null;
  let { node: n14, from: r2, to: o } = i12, l11 = n14.nodeValue;
  if (/[\n\r]/.test(l11) || s212.state.doc.sliceString(i12.from, i12.to) != l11) return null;
  let h3 = t8.invertedDesc, c3 = new K9(h3.mapPos(r2), h3.mapPos(o), r2, o), a2 = [];
  for (let f6 = n14.parentNode; ; f6 = f6.parentNode) {
    let d4 = O12.get(f6);
    if (d4 instanceof rt9) a2.push({ node: f6, deco: d4.mark });
    else {
      if (d4 instanceof P13 || f6.nodeName == "DIV" && f6.parentNode == s212.contentDOM) return { range: c3, text: n14, marks: a2, line: f6 };
      if (f6 != s212.contentDOM) a2.push({ node: f6, deco: new zt7({ inclusive: true, attributes: $n(f6), tagName: f6.tagName.toLowerCase() }) });
      else return null;
    }
  }
}
function nn6(s212, t8, e7) {
  if (e7 <= 0) for (let i12 = s212, n14 = t8; ; ) {
    if (i12.nodeType == 3) return { node: i12, offset: n14 };
    if (i12.nodeType == 1 && n14 > 0) i12 = i12.childNodes[n14 - 1], n14 = Z10(i12);
    else break;
  }
  if (e7 >= 0) for (let i12 = s212, n14 = t8; ; ) {
    if (i12.nodeType == 3) return { node: i12, offset: n14 };
    if (i12.nodeType == 1 && n14 < i12.childNodes.length && e7 >= 0) i12 = i12.childNodes[n14], n14 = 0;
    else break;
  }
  return null;
}
function lr5(s212, t8) {
  return s212.nodeType != 1 ? 0 : (t8 && s212.childNodes[t8 - 1].contentEditable == "false" ? 1 : 0) | (t8 < s212.childNodes.length && s212.childNodes[t8].contentEditable == "false" ? 2 : 0);
}
var hr5 = class {
  constructor() {
    this.changes = [];
  }
  compareRange(t8, e7) {
    _e7(t8, e7, this.changes);
  }
  comparePoint(t8, e7) {
    _e7(t8, e7, this.changes);
  }
};
function ar5(s212, t8, e7) {
  let i12 = new hr5();
  return T11.compare(s212, t8, e7, i12), i12.changes;
}
function cr5(s212, t8) {
  for (let e7 = s212; e7 && e7 != t8; e7 = e7.assignedSlot || e7.parentNode) if (e7.nodeType == 1 && e7.contentEditable == "false") return true;
  return false;
}
function fr5(s212, t8) {
  let e7 = false;
  return t8 && s212.iterChangedRanges((i12, n14) => {
    i12 < t8.to && n14 > t8.from && (e7 = true);
  }), e7;
}
function dr5(s212, t8, e7 = 1) {
  let i12 = s212.charCategorizer(t8), n14 = s212.doc.lineAt(t8), r2 = t8 - n14.from;
  if (n14.length == 0) return x7.cursor(t8);
  r2 == 0 ? e7 = 1 : r2 == n14.length && (e7 = -1);
  let o = r2, l11 = r2;
  e7 < 0 ? o = _11(n14.text, r2, false) : l11 = _11(n14.text, r2);
  let h3 = i12(n14.text.slice(o, l11));
  for (; o > 0; ) {
    let c3 = _11(n14.text, o, false);
    if (i12(n14.text.slice(c3, o)) != h3) break;
    o = c3;
  }
  for (; l11 < n14.length; ) {
    let c3 = _11(n14.text, l11);
    if (i12(n14.text.slice(l11, c3)) != h3) break;
    l11 = c3;
  }
  return x7.range(o + n14.from, l11 + n14.from);
}
function ur5(s212, t8) {
  return t8.left > s212 ? t8.left - s212 : Math.max(0, s212 - t8.right);
}
function gr5(s212, t8) {
  return t8.top > s212 ? t8.top - s212 : Math.max(0, s212 - t8.bottom);
}
function Ee12(s212, t8) {
  return s212.top < t8.bottom - 1 && s212.bottom > t8.top + 1;
}
function zi5(s212, t8) {
  return t8 < s212.top ? { top: t8, left: s212.left, right: s212.right, bottom: s212.bottom } : s212;
}
function Ii5(s212, t8) {
  return t8 > s212.bottom ? { top: s212.top, left: s212.left, right: s212.right, bottom: t8 } : s212;
}
function Je7(s212, t8, e7) {
  let i12, n14, r2, o, l11 = false, h3, c3, a2, f6;
  for (let g8 = s212.firstChild; g8; g8 = g8.nextSibling) {
    let m11 = xt8(g8);
    for (let p3 = 0; p3 < m11.length; p3++) {
      let b12 = m11[p3];
      n14 && Ee12(n14, b12) && (b12 = zi5(Ii5(b12, n14.bottom), n14.top));
      let v10 = ur5(t8, b12), S17 = gr5(e7, b12);
      if (v10 == 0 && S17 == 0) return g8.nodeType == 3 ? Ki5(g8, t8, e7) : Je7(g8, t8, e7);
      if (!i12 || o > S17 || o == S17 && r2 > v10) {
        i12 = g8, n14 = b12, r2 = v10, o = S17;
        let y18 = S17 ? e7 < b12.top ? -1 : 1 : v10 ? t8 < b12.left ? -1 : 1 : 0;
        l11 = !y18 || (y18 > 0 ? p3 < m11.length - 1 : p3 > 0);
      }
      v10 == 0 ? e7 > b12.bottom && (!a2 || a2.bottom < b12.bottom) ? (h3 = g8, a2 = b12) : e7 < b12.top && (!f6 || f6.top > b12.top) && (c3 = g8, f6 = b12) : a2 && Ee12(a2, b12) ? a2 = Ii5(a2, b12.bottom) : f6 && Ee12(f6, b12) && (f6 = zi5(f6, b12.top));
    }
  }
  if (a2 && a2.bottom >= e7 ? (i12 = h3, n14 = a2) : f6 && f6.top <= e7 && (i12 = c3, n14 = f6), !i12) return { node: s212, offset: 0 };
  let d4 = Math.max(n14.left, Math.min(n14.right, t8));
  if (i12.nodeType == 3) return Ki5(i12, d4, e7);
  if (l11 && i12.contentEditable != "false") return Je7(i12, d4, e7);
  let u3 = Array.prototype.indexOf.call(s212.childNodes, i12) + (t8 >= (n14.left + n14.right) / 2 ? 1 : 0);
  return { node: s212, offset: u3 };
}
function Ki5(s212, t8, e7) {
  let i12 = s212.nodeValue.length, n14 = -1, r2 = 1e9, o = 0;
  for (let l11 = 0; l11 < i12; l11++) {
    let h3 = ct3(s212, l11, l11 + 1).getClientRects();
    for (let c3 = 0; c3 < h3.length; c3++) {
      let a2 = h3[c3];
      if (a2.top == a2.bottom) continue;
      o || (o = t8 - a2.left);
      let f6 = (a2.top > e7 ? a2.top - e7 : e7 - a2.bottom) - 1;
      if (a2.left - 1 <= t8 && a2.right + 1 >= t8 && f6 < r2) {
        let d4 = t8 >= (a2.left + a2.right) / 2, u3 = d4;
        if ((w9.chrome || w9.gecko) && ct3(s212, l11).getBoundingClientRect().left == a2.right && (u3 = !d4), f6 <= 0) return { node: s212, offset: l11 + (u3 ? 1 : 0) };
        n14 = l11 + (u3 ? 1 : 0), r2 = f6;
      }
    }
  }
  return { node: s212, offset: n14 > -1 ? n14 : o > 0 ? s212.nodeValue.length : 0 };
}
function rn6(s212, t8, e7, i12 = -1) {
  var n14, r2;
  let o = s212.contentDOM.getBoundingClientRect(), l11 = o.top + s212.viewState.paddingTop, h3, { docHeight: c3 } = s212.viewState, { x: a2, y: f6 } = t8, d4 = f6 - l11;
  if (d4 < 0) return 0;
  if (d4 > c3) return s212.state.doc.length;
  for (let y18 = s212.viewState.heightOracle.textHeight / 2, x11 = false; h3 = s212.elementAtHeight(d4), h3.type != V14.Text; ) for (; d4 = i12 > 0 ? h3.bottom + y18 : h3.top - y18, !(d4 >= 0 && d4 <= c3); ) {
    if (x11) return e7 ? null : 0;
    x11 = true, i12 = -i12;
  }
  f6 = l11 + d4;
  let u3 = h3.from;
  if (u3 < s212.viewport.from) return s212.viewport.from == 0 ? 0 : e7 ? null : qi5(s212, o, h3, a2, f6);
  if (u3 > s212.viewport.to) return s212.viewport.to == s212.state.doc.length ? s212.state.doc.length : e7 ? null : qi5(s212, o, h3, a2, f6);
  let g8 = s212.dom.ownerDocument, m11 = s212.root.elementFromPoint ? s212.root : g8, p3 = m11.elementFromPoint(a2, f6);
  p3 && !s212.contentDOM.contains(p3) && (p3 = null), p3 || (a2 = Math.max(o.left + 1, Math.min(o.right - 1, a2)), p3 = m11.elementFromPoint(a2, f6), p3 && !s212.contentDOM.contains(p3) && (p3 = null));
  let b12, v10 = -1;
  if (p3 && ((n14 = s212.docView.nearest(p3)) === null || n14 === void 0 ? void 0 : n14.isEditable) != false) {
    if (g8.caretPositionFromPoint) {
      let y18 = g8.caretPositionFromPoint(a2, f6);
      y18 && ({ offsetNode: b12, offset: v10 } = y18);
    } else if (g8.caretRangeFromPoint) {
      let y18 = g8.caretRangeFromPoint(a2, f6);
      y18 && ({ startContainer: b12, startOffset: v10 } = y18, (!s212.contentDOM.contains(b12) || w9.safari && pr5(b12, v10, a2) || w9.chrome && mr5(b12, v10, a2)) && (b12 = void 0));
    }
  }
  if (!b12 || !s212.docView.dom.contains(b12)) {
    let y18 = P13.find(s212.docView, u3);
    if (!y18) return d4 > h3.top + h3.height / 2 ? h3.to : h3.from;
    ({ node: b12, offset: v10 } = Je7(y18.dom, a2, f6));
  }
  let S17 = s212.docView.nearest(b12);
  if (!S17) return null;
  if (S17.isWidget && ((r2 = S17.dom) === null || r2 === void 0 ? void 0 : r2.nodeType) == 1) {
    let y18 = S17.dom.getBoundingClientRect();
    return t8.y < y18.top || t8.y <= y18.bottom && t8.x <= (y18.left + y18.right) / 2 ? S17.posAtStart : S17.posAtEnd;
  } else return S17.localPosFromDOM(b12, v10) + S17.posAtStart;
}
function qi5(s212, t8, e7, i12, n14) {
  let r2 = Math.round((i12 - t8.left) * s212.defaultCharacterWidth);
  if (s212.lineWrapping && e7.height > s212.defaultLineHeight * 1.5) {
    let l11 = s212.viewState.heightOracle.textHeight, h3 = Math.floor((n14 - e7.top - (s212.defaultLineHeight - l11) * 0.5) / l11);
    r2 += h3 * s212.viewState.heightOracle.lineLength;
  }
  let o = s212.state.sliceDoc(e7.from, e7.to);
  return e7.from + at9(o, r2, s212.state.tabSize);
}
function pr5(s212, t8, e7) {
  let i12;
  if (s212.nodeType != 3 || t8 != (i12 = s212.nodeValue.length)) return false;
  for (let n14 = s212.nextSibling; n14; n14 = n14.nextSibling) if (n14.nodeType != 1 || n14.nodeName != "BR") return false;
  return ct3(s212, i12 - 1, i12).getBoundingClientRect().left > e7;
}
function mr5(s212, t8, e7) {
  if (t8 != 0) return false;
  for (let n14 = s212; ; ) {
    let r2 = n14.parentNode;
    if (!r2 || r2.nodeType != 1 || r2.firstChild != n14) return false;
    if (r2.classList.contains("cm-line")) break;
    n14 = r2;
  }
  let i12 = s212.nodeType == 1 ? s212.getBoundingClientRect() : ct3(s212, 0, Math.max(s212.nodeValue.length, 1)).getBoundingClientRect();
  return e7 - i12.left > 5;
}
function Ze10(s212, t8) {
  let e7 = s212.lineBlockAt(t8);
  if (Array.isArray(e7.type)) {
    for (let i12 of e7.type) if (i12.to > t8 || i12.to == t8 && (i12.to == e7.to || i12.type == V14.Text)) return i12;
  }
  return e7;
}
function br5(s212, t8, e7, i12) {
  let n14 = Ze10(s212, t8.head), r2 = !i12 || n14.type != V14.Text || !(s212.lineWrapping || n14.widgetLineBreaks) ? null : s212.coordsAtPos(t8.assoc < 0 && t8.head > n14.from ? t8.head - 1 : t8.head);
  if (r2) {
    let o = s212.dom.getBoundingClientRect(), l11 = s212.textDirectionAt(n14.from), h3 = s212.posAtCoords({ x: e7 == (l11 == B7.LTR) ? o.right - 1 : o.left + 1, y: (r2.top + r2.bottom) / 2 });
    if (h3 != null) return x7.cursor(h3, e7 ? -1 : 1);
  }
  return x7.cursor(e7 ? n14.to : n14.from, e7 ? -1 : 1);
}
function ji2(s212, t8, e7, i12) {
  let n14 = s212.state.doc.lineAt(t8.head), r2 = s212.bidiSpans(n14), o = s212.textDirectionAt(n14.from);
  for (let l11 = t8, h3 = null; ; ) {
    let c3 = en6(n14, r2, o, l11, e7), a2 = tn7;
    if (!c3) {
      if (n14.number == (e7 ? s212.state.doc.lines : 1)) return l11;
      a2 = `
`, n14 = s212.state.doc.line(n14.number + (e7 ? 1 : -1)), r2 = s212.bidiSpans(n14), c3 = x7.cursor(e7 ? n14.from : n14.to);
    }
    if (h3) {
      if (!h3(a2)) return l11;
    } else {
      if (!i12) return c3;
      h3 = i12(a2);
    }
    l11 = c3;
  }
}
function wr5(s212, t8, e7) {
  let i12 = s212.state.charCategorizer(t8), n14 = i12(e7);
  return (r2) => {
    let o = i12(r2);
    return n14 == O11.Space && (n14 = o), n14 == o;
  };
}
function yr5(s212, t8, e7, i12) {
  let n14 = t8.head, r2 = e7 ? 1 : -1;
  if (n14 == (e7 ? s212.state.doc.length : 0)) return x7.cursor(n14, t8.assoc);
  let o = t8.goalColumn, l11, h3 = s212.contentDOM.getBoundingClientRect(), c3 = s212.coordsAtPos(n14, t8.assoc || -1), a2 = s212.documentTop;
  if (c3) o == null && (o = c3.left - h3.left), l11 = r2 < 0 ? c3.top : c3.bottom;
  else {
    let u3 = s212.viewState.lineBlockAt(n14);
    o == null && (o = Math.min(h3.right - h3.left, s212.defaultCharacterWidth * (n14 - u3.from))), l11 = (r2 < 0 ? u3.top : u3.bottom) + a2;
  }
  let f6 = h3.left + o, d4 = i12 ?? s212.viewState.heightOracle.textHeight >> 1;
  for (let u3 = 0; ; u3 += 10) {
    let g8 = l11 + (d4 + u3) * r2, m11 = rn6(s212, { x: f6, y: g8 }, false, r2);
    if (g8 < h3.top || g8 > h3.bottom || (r2 < 0 ? m11 < n14 : m11 > n14)) {
      let p3 = s212.docView.coordsForChar(m11), b12 = !p3 || g8 < p3.top ? -1 : 1;
      return x7.cursor(m11, b12, void 0, o);
    }
  }
}
function oe8(s212, t8, e7) {
  for (; ; ) {
    let i12 = 0;
    for (let n14 of s212) n14.between(t8 - 1, t8 + 1, (r2, o, l11) => {
      if (t8 > r2 && t8 < o) {
        let h3 = i12 || e7 || (t8 - r2 < o - t8 ? -1 : 1);
        t8 = h3 < 0 ? r2 : o, i12 = h3;
      }
    });
    if (!i12) return t8;
  }
}
function Pe11(s212, t8, e7) {
  let i12 = oe8(s212.state.facet(Oi).map((n14) => n14(s212)), e7.from, t8.head > e7.from ? -1 : 1);
  return i12 == e7.from ? e7 : x7.cursor(i12, i12 < e7.from ? 1 : -1);
}
var Qe8 = class {
  setSelectionOrigin(t8) {
    this.lastSelectionOrigin = t8, this.lastSelectionTime = Date.now();
  }
  constructor(t8) {
    this.view = t8, this.lastKeyCode = 0, this.lastKeyTime = 0, this.lastTouchTime = 0, this.lastFocusTime = 0, this.lastScrollTop = 0, this.lastScrollLeft = 0, this.pendingIOSKey = void 0, this.lastSelectionOrigin = null, this.lastSelectionTime = 0, this.lastEscPress = 0, this.lastContextMenu = 0, this.scrollHandlers = [], this.handlers = /* @__PURE__ */ Object.create(null), this.composing = -1, this.compositionFirstChange = null, this.compositionEndedAt = 0, this.compositionPendingKey = false, this.compositionPendingChange = false, this.mouseSelection = null, this.draggedContent = null, this.handleEvent = this.handleEvent.bind(this), this.notifiedFocused = t8.hasFocus, w9.safari && t8.contentDOM.addEventListener("input", () => null), w9.gecko && Pr(t8.contentDOM.ownerDocument);
  }
  handleEvent(t8) {
    !Ar(this.view, t8) || this.ignoreDuringComposition(t8) || t8.type == "keydown" && this.keydown(t8) || this.runHandlers(t8.type, t8);
  }
  runHandlers(t8, e7) {
    let i12 = this.handlers[t8];
    if (i12) {
      for (let n14 of i12.observers) n14(this.view, e7);
      for (let n14 of i12.handlers) {
        if (e7.defaultPrevented) break;
        if (n14(this.view, e7)) {
          e7.preventDefault();
          break;
        }
      }
    }
  }
  ensureHandlers(t8) {
    let e7 = vr5(t8), i12 = this.handlers, n14 = this.view.contentDOM;
    for (let r2 in e7) if (r2 != "scroll") {
      let o = !e7[r2].handlers.length, l11 = i12[r2];
      l11 && o != !l11.handlers.length && (n14.removeEventListener(r2, this.handleEvent), l11 = null), l11 || n14.addEventListener(r2, this.handleEvent, { passive: o });
    }
    for (let r2 in i12) r2 != "scroll" && !e7[r2] && n14.removeEventListener(r2, this.handleEvent);
    this.handlers = e7;
  }
  keydown(t8) {
    if (this.lastKeyCode = t8.keyCode, this.lastKeyTime = Date.now(), t8.keyCode == 9 && Date.now() < this.lastEscPress + 2e3) return true;
    if (t8.keyCode != 27 && ln6.indexOf(t8.keyCode) < 0 && (this.view.inputState.lastEscPress = 0), w9.android && w9.chrome && !t8.synthetic && (t8.keyCode == 13 || t8.keyCode == 8)) return this.view.observer.delayAndroidKey(t8.key, t8.keyCode), true;
    let e7;
    return w9.ios && !t8.synthetic && !t8.altKey && !t8.metaKey && ((e7 = on6.find((i12) => i12.keyCode == t8.keyCode)) && !t8.ctrlKey || xr5.indexOf(t8.key) > -1 && t8.ctrlKey && !t8.shiftKey) ? (this.pendingIOSKey = e7 || t8, setTimeout(() => this.flushIOSKey(), 250), true) : (t8.keyCode != 229 && this.view.observer.forceFlush(), false);
  }
  flushIOSKey() {
    let t8 = this.pendingIOSKey;
    return t8 ? (this.pendingIOSKey = void 0, wt4(this.view.contentDOM, t8.key, t8.keyCode)) : false;
  }
  ignoreDuringComposition(t8) {
    return /^key/.test(t8.type) ? this.composing > 0 ? true : w9.safari && !w9.ios && this.compositionPendingKey && Date.now() - this.compositionEndedAt < 100 ? (this.compositionPendingKey = false, true) : false : false;
  }
  startMouseSelection(t8) {
    this.mouseSelection && this.mouseSelection.destroy(), this.mouseSelection = t8;
  }
  update(t8) {
    this.mouseSelection && this.mouseSelection.update(t8), this.draggedContent && t8.docChanged && (this.draggedContent = this.draggedContent.map(t8.changes)), t8.transactions.length && (this.lastKeyCode = this.lastSelectionTime = 0);
  }
  destroy() {
    this.mouseSelection && this.mouseSelection.destroy();
  }
};
function Yi4(s212, t8) {
  return (e7, i12) => {
    try {
      return t8.call(s212, i12, e7);
    } catch (n14) {
      it6(e7.state, n14);
    }
  };
}
function vr5(s212) {
  let t8 = /* @__PURE__ */ Object.create(null);
  function e7(i12) {
    return t8[i12] || (t8[i12] = { observers: [], handlers: [] });
  }
  for (let i12 of s212) {
    let n14 = i12.spec;
    if (n14 && n14.domEventHandlers) for (let r2 in n14.domEventHandlers) {
      let o = n14.domEventHandlers[r2];
      o && e7(r2).handlers.push(Yi4(i12.value, o));
    }
    if (n14 && n14.domEventObservers) for (let r2 in n14.domEventObservers) {
      let o = n14.domEventObservers[r2];
      o && e7(r2).observers.push(Yi4(i12.value, o));
    }
  }
  for (let i12 in q10) e7(i12).handlers.push(q10[i12]);
  for (let i12 in j12) e7(i12).observers.push(j12[i12]);
  return t8;
}
var on6 = [{ key: "Backspace", keyCode: 8, inputType: "deleteContentBackward" }, { key: "Enter", keyCode: 13, inputType: "insertParagraph" }, { key: "Enter", keyCode: 13, inputType: "insertLineBreak" }, { key: "Delete", keyCode: 46, inputType: "deleteContentForward" }];
var xr5 = "dthko";
var ln6 = [16, 17, 18, 20, 91, 92, 224, 225];
var Qt6 = 6;
function te11(s212) {
  return Math.max(0, s212) * 0.7 + 8;
}
function Sr5(s212, t8) {
  return Math.max(Math.abs(s212.clientX - t8.clientX), Math.abs(s212.clientY - t8.clientY));
}
var ti5 = class {
  constructor(t8, e7, i12, n14) {
    this.view = t8, this.startEvent = e7, this.style = i12, this.mustSelect = n14, this.scrollSpeed = { x: 0, y: 0 }, this.scrolling = -1, this.lastEvent = e7, this.scrollParent = qn5(t8.contentDOM), this.atoms = t8.state.facet(Oi).map((o) => o(t8));
    let r2 = t8.contentDOM.ownerDocument;
    r2.addEventListener("mousemove", this.move = this.move.bind(this)), r2.addEventListener("mouseup", this.up = this.up.bind(this)), this.extend = e7.shiftKey, this.multiple = t8.state.facet(I11.allowMultipleSelections) && Cr5(t8, e7), this.dragging = kr5(t8, e7) && fn6(e7) == 1 ? null : false;
  }
  start(t8) {
    this.dragging === false && this.select(t8);
  }
  move(t8) {
    var e7;
    if (t8.buttons == 0) return this.destroy();
    if (this.dragging || this.dragging == null && Sr5(this.startEvent, t8) < 10) return;
    this.select(this.lastEvent = t8);
    let i12 = 0, n14 = 0, r2 = ((e7 = this.scrollParent) === null || e7 === void 0 ? void 0 : e7.getBoundingClientRect()) || { left: 0, top: 0, right: this.view.win.innerWidth, bottom: this.view.win.innerHeight }, o = Gs5(this.view);
    t8.clientX - o.left <= r2.left + Qt6 ? i12 = -te11(r2.left - t8.clientX) : t8.clientX + o.right >= r2.right - Qt6 && (i12 = te11(t8.clientX - r2.right)), t8.clientY - o.top <= r2.top + Qt6 ? n14 = -te11(r2.top - t8.clientY) : t8.clientY + o.bottom >= r2.bottom - Qt6 && (n14 = te11(t8.clientY - r2.bottom)), this.setScrollSpeed(i12, n14);
  }
  up(t8) {
    this.dragging == null && this.select(this.lastEvent), this.dragging || t8.preventDefault(), this.destroy();
  }
  destroy() {
    this.setScrollSpeed(0, 0);
    let t8 = this.view.contentDOM.ownerDocument;
    t8.removeEventListener("mousemove", this.move), t8.removeEventListener("mouseup", this.up), this.view.inputState.mouseSelection = this.view.inputState.draggedContent = null;
  }
  setScrollSpeed(t8, e7) {
    this.scrollSpeed = { x: t8, y: e7 }, t8 || e7 ? this.scrolling < 0 && (this.scrolling = setInterval(() => this.scroll(), 50)) : this.scrolling > -1 && (clearInterval(this.scrolling), this.scrolling = -1);
  }
  scroll() {
    this.scrollParent ? (this.scrollParent.scrollLeft += this.scrollSpeed.x, this.scrollParent.scrollTop += this.scrollSpeed.y) : this.view.win.scrollBy(this.scrollSpeed.x, this.scrollSpeed.y), this.dragging === false && this.select(this.lastEvent);
  }
  skipAtoms(t8) {
    let e7 = null;
    for (let i12 = 0; i12 < t8.ranges.length; i12++) {
      let n14 = t8.ranges[i12], r2 = null;
      if (n14.empty) {
        let o = oe8(this.atoms, n14.from, 0);
        o != n14.from && (r2 = x7.cursor(o, -1));
      } else {
        let o = oe8(this.atoms, n14.from, -1), l11 = oe8(this.atoms, n14.to, 1);
        (o != n14.from || l11 != n14.to) && (r2 = x7.range(n14.from == n14.anchor ? o : l11, n14.from == n14.head ? o : l11));
      }
      r2 && (e7 || (e7 = t8.ranges.slice()), e7[i12] = r2);
    }
    return e7 ? x7.create(e7, t8.mainIndex) : t8;
  }
  select(t8) {
    let { view: e7 } = this, i12 = this.skipAtoms(this.style.get(t8, this.extend, this.multiple));
    (this.mustSelect || !i12.eq(e7.state.selection) || i12.main.assoc != e7.state.selection.main.assoc && this.dragging === false) && this.view.dispatch({ selection: i12, userEvent: "select.pointer" }), this.mustSelect = false;
  }
  update(t8) {
    this.style.update(t8) && setTimeout(() => this.select(this.lastEvent), 20);
  }
};
function Cr5(s212, t8) {
  let e7 = s212.state.facet(Vs3);
  return e7.length ? e7[0](t8) : w9.mac ? t8.metaKey : t8.ctrlKey;
}
function Mr2(s212, t8) {
  let e7 = s212.state.facet(Ws5);
  return e7.length ? e7[0](t8) : w9.mac ? !t8.altKey : !t8.ctrlKey;
}
function kr5(s212, t8) {
  let { main: e7 } = s212.state.selection;
  if (e7.empty) return false;
  let i12 = de9(s212.root);
  if (!i12 || i12.rangeCount == 0) return true;
  let n14 = i12.getRangeAt(0).getClientRects();
  for (let r2 = 0; r2 < n14.length; r2++) {
    let o = n14[r2];
    if (o.left <= t8.clientX && o.right >= t8.clientX && o.top <= t8.clientY && o.bottom >= t8.clientY) return true;
  }
  return false;
}
function Ar(s212, t8) {
  if (!t8.bubbles) return true;
  if (t8.defaultPrevented) return false;
  for (let e7 = t8.target, i12; e7 != s212.contentDOM; e7 = e7.parentNode) if (!e7 || e7.nodeType == 11 || (i12 = O12.get(e7)) && i12.ignoreEvent(t8)) return false;
  return true;
}
var q10 = /* @__PURE__ */ Object.create(null);
var j12 = /* @__PURE__ */ Object.create(null);
var hn5 = w9.ie && w9.ie_version < 15 || w9.ios && w9.webkit_version < 604;
function Dr2(s212) {
  let t8 = s212.dom.parentNode;
  if (!t8) return;
  let e7 = t8.appendChild(document.createElement("textarea"));
  e7.style.cssText = "position: fixed; left: -10000px; top: 10px", e7.focus(), setTimeout(() => {
    s212.focus(), e7.remove(), an5(s212, e7.value);
  }, 50);
}
function an5(s212, t8) {
  let { state: e7 } = s212, i12, n14 = 1, r2 = e7.toText(t8), o = r2.lines == e7.selection.ranges.length;
  if (ei5 != null && e7.selection.ranges.every((h3) => h3.empty) && ei5 == r2.toString()) {
    let h3 = -1;
    i12 = e7.changeByRange((c3) => {
      let a2 = e7.doc.lineAt(c3.from);
      if (a2.from == h3) return { range: c3 };
      h3 = a2.from;
      let f6 = e7.toText((o ? r2.line(n14++).text : t8) + e7.lineBreak);
      return { changes: { from: a2.from, insert: f6 }, range: x7.cursor(c3.from + f6.length) };
    });
  } else o ? i12 = e7.changeByRange((h3) => {
    let c3 = r2.line(n14++);
    return { changes: { from: h3.from, to: h3.to, insert: c3.text }, range: x7.cursor(h3.from + c3.length) };
  }) : i12 = e7.replaceSelection(r2);
  s212.dispatch(i12, { userEvent: "input.paste", scrollIntoView: true });
}
j12.scroll = (s212) => {
  s212.inputState.lastScrollTop = s212.scrollDOM.scrollTop, s212.inputState.lastScrollLeft = s212.scrollDOM.scrollLeft;
};
q10.keydown = (s212, t8) => (s212.inputState.setSelectionOrigin("select"), t8.keyCode == 27 && (s212.inputState.lastEscPress = Date.now()), false);
j12.touchstart = (s212, t8) => {
  s212.inputState.lastTouchTime = Date.now(), s212.inputState.setSelectionOrigin("select.pointer");
};
j12.touchmove = (s212) => {
  s212.inputState.setSelectionOrigin("select.pointer");
};
q10.mousedown = (s212, t8) => {
  if (s212.observer.flush(), s212.inputState.lastTouchTime > Date.now() - 2e3) return false;
  let e7 = null;
  for (let i12 of s212.state.facet(Fs5)) if (e7 = i12(s212, t8), e7) break;
  if (!e7 && t8.button == 0 && (e7 = Rr4(s212, t8)), e7) {
    let i12 = !s212.hasFocus;
    s212.inputState.startMouseSelection(new ti5(s212, t8, e7, i12)), i12 && s212.observer.ignore(() => As2(s212.contentDOM));
    let n14 = s212.inputState.mouseSelection;
    if (n14) return n14.start(t8), n14.dragging === false;
  }
  return false;
};
function _i5(s212, t8, e7, i12) {
  if (i12 == 1) return x7.cursor(t8, e7);
  if (i12 == 2) return dr5(s212.state, t8, e7);
  {
    let n14 = P13.find(s212.docView, t8), r2 = s212.state.doc.lineAt(n14 ? n14.posAtEnd : t8), o = n14 ? n14.posAtStart : r2.from, l11 = n14 ? n14.posAtEnd : r2.to;
    return l11 < s212.state.doc.length && l11 == r2.to && l11++, x7.range(o, l11);
  }
}
var cn6 = (s212, t8) => s212 >= t8.top && s212 <= t8.bottom;
var Xi5 = (s212, t8, e7) => cn6(t8, e7) && s212 >= e7.left && s212 <= e7.right;
function Tr4(s212, t8, e7, i12) {
  let n14 = P13.find(s212.docView, t8);
  if (!n14) return 1;
  let r2 = t8 - n14.posAtStart;
  if (r2 == 0) return 1;
  if (r2 == n14.length) return -1;
  let o = n14.coordsAt(r2, -1);
  if (o && Xi5(e7, i12, o)) return -1;
  let l11 = n14.coordsAt(r2, 1);
  return l11 && Xi5(e7, i12, l11) ? 1 : o && cn6(i12, o) ? -1 : 1;
}
function Gi5(s212, t8) {
  let e7 = s212.posAtCoords({ x: t8.clientX, y: t8.clientY }, false);
  return { pos: e7, bias: Tr4(s212, e7, t8.clientX, t8.clientY) };
}
var Or = w9.ie && w9.ie_version <= 11;
var $i5 = null;
var Ui5 = 0;
var Ji5 = 0;
function fn6(s212) {
  if (!Or) return s212.detail;
  let t8 = $i5, e7 = Ji5;
  return $i5 = s212, Ji5 = Date.now(), Ui5 = !t8 || e7 > Date.now() - 400 && Math.abs(t8.clientX - s212.clientX) < 2 && Math.abs(t8.clientY - s212.clientY) < 2 ? (Ui5 + 1) % 3 : 1;
}
function Rr4(s212, t8) {
  let e7 = Gi5(s212, t8), i12 = fn6(t8), n14 = s212.state.selection;
  return { update(r2) {
    r2.docChanged && (e7.pos = r2.changes.mapPos(e7.pos), n14 = n14.map(r2.changes));
  }, get(r2, o, l11) {
    let h3 = Gi5(s212, r2), c3, a2 = _i5(s212, h3.pos, h3.bias, i12);
    if (e7.pos != h3.pos && !o) {
      let f6 = _i5(s212, e7.pos, e7.bias, i12), d4 = Math.min(f6.from, a2.from), u3 = Math.max(f6.to, a2.to);
      a2 = d4 < a2.from ? x7.range(d4, u3) : x7.range(u3, d4);
    }
    return o ? n14.replaceRange(n14.main.extend(a2.from, a2.to)) : l11 && i12 == 1 && n14.ranges.length > 1 && (c3 = Lr2(n14, h3.pos)) ? c3 : l11 ? n14.addRange(a2) : x7.create([a2]);
  } };
}
function Lr2(s212, t8) {
  for (let e7 = 0; e7 < s212.ranges.length; e7++) {
    let { from: i12, to: n14 } = s212.ranges[e7];
    if (i12 <= t8 && n14 >= t8) return x7.create(s212.ranges.slice(0, e7).concat(s212.ranges.slice(e7 + 1)), s212.mainIndex == e7 ? 0 : s212.mainIndex - (s212.mainIndex > e7 ? 1 : 0));
  }
  return null;
}
q10.dragstart = (s212, t8) => {
  let { selection: { main: e7 } } = s212.state;
  if (t8.target.draggable) {
    let n14 = s212.docView.nearest(t8.target);
    if (n14 && n14.isWidget) {
      let r2 = n14.posAtStart, o = r2 + n14.length;
      (r2 >= e7.to || o <= e7.from) && (e7 = x7.range(r2, o));
    }
  }
  let { inputState: i12 } = s212;
  return i12.mouseSelection && (i12.mouseSelection.dragging = true), i12.draggedContent = e7, t8.dataTransfer && (t8.dataTransfer.setData("Text", s212.state.sliceDoc(e7.from, e7.to)), t8.dataTransfer.effectAllowed = "copyMove"), false;
};
q10.dragend = (s212) => (s212.inputState.draggedContent = null, false);
function Zi5(s212, t8, e7, i12) {
  if (!e7) return;
  let n14 = s212.posAtCoords({ x: t8.clientX, y: t8.clientY }, false), { draggedContent: r2 } = s212.inputState, o = i12 && r2 && Mr2(s212, t8) ? { from: r2.from, to: r2.to } : null, l11 = { from: n14, insert: e7 }, h3 = s212.state.changes(o ? [o, l11] : l11);
  s212.focus(), s212.dispatch({ changes: h3, selection: { anchor: h3.mapPos(n14, -1), head: h3.mapPos(n14, 1) }, userEvent: o ? "move.drop" : "input.drop" }), s212.inputState.draggedContent = null;
}
q10.drop = (s212, t8) => {
  if (!t8.dataTransfer) return false;
  if (s212.state.readOnly) return true;
  let e7 = t8.dataTransfer.files;
  if (e7 && e7.length) {
    let i12 = Array(e7.length), n14 = 0, r2 = () => {
      ++n14 == e7.length && Zi5(s212, t8, i12.filter((o) => o != null).join(s212.state.lineBreak), false);
    };
    for (let o = 0; o < e7.length; o++) {
      let l11 = new FileReader();
      l11.onerror = r2, l11.onload = () => {
        /[\x00-\x08\x0e-\x1f]{2}/.test(l11.result) || (i12[o] = l11.result), r2();
      }, l11.readAsText(e7[o]);
    }
    return true;
  } else {
    let i12 = t8.dataTransfer.getData("Text");
    if (i12) return Zi5(s212, t8, i12, true), true;
  }
  return false;
};
q10.paste = (s212, t8) => {
  if (s212.state.readOnly) return true;
  s212.observer.flush();
  let e7 = hn5 ? null : t8.clipboardData;
  return e7 ? (an5(s212, e7.getData("text/plain") || e7.getData("text/uri-text")), true) : (Dr2(s212), false);
};
function Br(s212, t8) {
  let e7 = s212.dom.parentNode;
  if (!e7) return;
  let i12 = e7.appendChild(document.createElement("textarea"));
  i12.style.cssText = "position: fixed; left: -10000px; top: 10px", i12.value = t8, i12.focus(), i12.selectionEnd = t8.length, i12.selectionStart = 0, setTimeout(() => {
    i12.remove(), s212.focus();
  }, 50);
}
function Er2(s212) {
  let t8 = [], e7 = [], i12 = false;
  for (let n14 of s212.selection.ranges) n14.empty || (t8.push(s212.sliceDoc(n14.from, n14.to)), e7.push(n14));
  if (!t8.length) {
    let n14 = -1;
    for (let { from: r2 } of s212.selection.ranges) {
      let o = s212.doc.lineAt(r2);
      o.number > n14 && (t8.push(o.text), e7.push({ from: o.from, to: Math.min(s212.doc.length, o.to + 1) })), n14 = o.number;
    }
    i12 = true;
  }
  return { text: t8.join(s212.lineBreak), ranges: e7, linewise: i12 };
}
var ei5 = null;
q10.copy = q10.cut = (s212, t8) => {
  let { text: e7, ranges: i12, linewise: n14 } = Er2(s212.state);
  if (!e7 && !n14) return false;
  ei5 = n14 ? e7 : null, t8.type == "cut" && !s212.state.readOnly && s212.dispatch({ changes: i12, scrollIntoView: true, userEvent: "delete.cut" });
  let r2 = hn5 ? null : t8.clipboardData;
  return r2 ? (r2.clearData(), r2.setData("text/plain", e7), true) : (Br(s212, e7), false);
};
var dn5 = J8.define();
function un6(s212, t8) {
  let e7 = [];
  for (let i12 of s212.facet(Ks5)) {
    let n14 = i12(s212, t8);
    n14 && e7.push(n14);
  }
  return e7 ? s212.update({ effects: e7, annotations: dn5.of(true) }) : null;
}
function gn6(s212) {
  setTimeout(() => {
    let t8 = s212.hasFocus;
    if (t8 != s212.inputState.notifiedFocused) {
      let e7 = un6(s212.state, t8);
      e7 ? s212.dispatch(e7) : s212.update([]);
    }
  }, 10);
}
j12.focus = (s212) => {
  s212.inputState.lastFocusTime = Date.now(), !s212.scrollDOM.scrollTop && (s212.inputState.lastScrollTop || s212.inputState.lastScrollLeft) && (s212.scrollDOM.scrollTop = s212.inputState.lastScrollTop, s212.scrollDOM.scrollLeft = s212.inputState.lastScrollLeft), gn6(s212);
};
j12.blur = (s212) => {
  s212.observer.clearSelectionRange(), gn6(s212);
};
j12.compositionstart = j12.compositionupdate = (s212) => {
  s212.inputState.compositionFirstChange == null && (s212.inputState.compositionFirstChange = true), s212.inputState.composing < 0 && (s212.inputState.composing = 0);
};
j12.compositionend = (s212) => {
  s212.inputState.composing = -1, s212.inputState.compositionEndedAt = Date.now(), s212.inputState.compositionPendingKey = true, s212.inputState.compositionPendingChange = s212.observer.pendingRecords().length > 0, s212.inputState.compositionFirstChange = null, w9.chrome && w9.android ? s212.observer.flushSoon() : s212.inputState.compositionPendingChange ? Promise.resolve().then(() => s212.observer.flush()) : setTimeout(() => {
    s212.inputState.composing < 0 && s212.docView.hasComposition && s212.update([]);
  }, 50);
};
j12.contextmenu = (s212) => {
  s212.inputState.lastContextMenu = Date.now();
};
q10.beforeinput = (s212, t8) => {
  var e7;
  let i12;
  if (w9.chrome && w9.android && (i12 = on6.find((n14) => n14.inputType == t8.inputType)) && (s212.observer.delayAndroidKey(i12.key, i12.keyCode), i12.key == "Backspace" || i12.key == "Delete")) {
    let n14 = ((e7 = window.visualViewport) === null || e7 === void 0 ? void 0 : e7.height) || 0;
    setTimeout(() => {
      var r2;
      (((r2 = window.visualViewport) === null || r2 === void 0 ? void 0 : r2.height) || 0) > n14 + 10 && s212.hasFocus && (s212.contentDOM.blur(), s212.focus());
    }, 100);
  }
  return false;
};
var Qi5 = /* @__PURE__ */ new Set();
function Pr(s212) {
  Qi5.has(s212) || (Qi5.add(s212), s212.addEventListener("copy", () => {
  }), s212.addEventListener("cut", () => {
  }));
}
var ts5 = ["pre-wrap", "normal", "pre-line", "break-spaces"];
var ye10 = class {
  constructor(t8) {
    this.lineWrapping = t8, this.doc = m5.empty, this.heightSamples = {}, this.lineHeight = 14, this.charWidth = 7, this.textHeight = 14, this.lineLength = 30, this.heightChanged = false;
  }
  heightForGap(t8, e7) {
    let i12 = this.doc.lineAt(e7).number - this.doc.lineAt(t8).number + 1;
    return this.lineWrapping && (i12 += Math.max(0, Math.ceil((e7 - t8 - i12 * this.lineLength * 0.5) / this.lineLength))), this.lineHeight * i12;
  }
  heightForLine(t8) {
    return this.lineWrapping ? (1 + Math.max(0, Math.ceil((t8 - this.lineLength) / (this.lineLength - 5)))) * this.lineHeight : this.lineHeight;
  }
  setDoc(t8) {
    return this.doc = t8, this;
  }
  mustRefreshForWrapping(t8) {
    return ts5.indexOf(t8) > -1 != this.lineWrapping;
  }
  mustRefreshForHeights(t8) {
    let e7 = false;
    for (let i12 = 0; i12 < t8.length; i12++) {
      let n14 = t8[i12];
      n14 < 0 ? i12++ : this.heightSamples[Math.floor(n14 * 10)] || (e7 = true, this.heightSamples[Math.floor(n14 * 10)] = true);
    }
    return e7;
  }
  refresh(t8, e7, i12, n14, r2, o) {
    let l11 = ts5.indexOf(t8) > -1, h3 = Math.round(e7) != Math.round(this.lineHeight) || this.lineWrapping != l11;
    if (this.lineWrapping = l11, this.lineHeight = e7, this.charWidth = i12, this.textHeight = n14, this.lineLength = r2, h3) {
      this.heightSamples = {};
      for (let c3 = 0; c3 < o.length; c3++) {
        let a2 = o[c3];
        a2 < 0 ? c3++ : this.heightSamples[Math.floor(a2 * 10)] = true;
      }
    }
    return h3;
  }
};
var ve10 = class {
  constructor(t8, e7) {
    this.from = t8, this.heights = e7, this.index = 0;
  }
  get more() {
    return this.index < this.heights.length;
  }
};
var _12 = class s176 {
  constructor(t8, e7, i12, n14, r2) {
    this.from = t8, this.length = e7, this.top = i12, this.height = n14, this._content = r2;
  }
  get type() {
    return typeof this._content == "number" ? V14.Text : Array.isArray(this._content) ? this._content : this._content.type;
  }
  get to() {
    return this.from + this.length;
  }
  get bottom() {
    return this.top + this.height;
  }
  get widget() {
    return this._content instanceof lt9 ? this._content.widget : null;
  }
  get widgetLineBreaks() {
    return typeof this._content == "number" ? this._content : 0;
  }
  join(t8) {
    let e7 = (Array.isArray(this._content) ? this._content : [this]).concat(Array.isArray(t8._content) ? t8._content : [t8]);
    return new s176(this.from, this.length + t8.length, this.top, this.height + t8.height, e7);
  }
};
var T13 = function(s212) {
  return s212[s212.ByPos = 0] = "ByPos", s212[s212.ByHeight = 1] = "ByHeight", s212[s212.ByPosNoHeight = 2] = "ByPosNoHeight", s212;
}(T13 || (T13 = {}));
var le11 = 1e-3;
var F13 = class s177 {
  constructor(t8, e7, i12 = 2) {
    this.length = t8, this.height = e7, this.flags = i12;
  }
  get outdated() {
    return (this.flags & 2) > 0;
  }
  set outdated(t8) {
    this.flags = (t8 ? 2 : 0) | this.flags & -3;
  }
  setHeight(t8, e7) {
    this.height != e7 && (Math.abs(this.height - e7) > le11 && (t8.heightChanged = true), this.height = e7);
  }
  replace(t8, e7, i12) {
    return s177.of(i12);
  }
  decomposeLeft(t8, e7) {
    e7.push(this);
  }
  decomposeRight(t8, e7) {
    e7.push(this);
  }
  applyChanges(t8, e7, i12, n14) {
    let r2 = this, o = i12.doc;
    for (let l11 = n14.length - 1; l11 >= 0; l11--) {
      let { fromA: h3, toA: c3, fromB: a2, toB: f6 } = n14[l11], d4 = r2.lineAt(h3, T13.ByPosNoHeight, i12.setDoc(e7), 0, 0), u3 = d4.to >= c3 ? d4 : r2.lineAt(c3, T13.ByPosNoHeight, i12, 0, 0);
      for (f6 += u3.to - c3, c3 = u3.to; l11 > 0 && d4.from <= n14[l11 - 1].toA; ) h3 = n14[l11 - 1].fromA, a2 = n14[l11 - 1].fromB, l11--, h3 < d4.from && (d4 = r2.lineAt(h3, T13.ByPosNoHeight, i12, 0, 0));
      a2 += d4.from - h3, h3 = d4.from;
      let g8 = si5.build(i12.setDoc(o), t8, a2, f6);
      r2 = r2.replace(h3, c3, g8);
    }
    return r2.updateHeight(i12, 0);
  }
  static empty() {
    return new I12(0, 0);
  }
  static of(t8) {
    if (t8.length == 1) return t8[0];
    let e7 = 0, i12 = t8.length, n14 = 0, r2 = 0;
    for (; ; ) if (e7 == i12) if (n14 > r2 * 2) {
      let l11 = t8[e7 - 1];
      l11.break ? t8.splice(--e7, 1, l11.left, null, l11.right) : t8.splice(--e7, 1, l11.left, l11.right), i12 += 1 + l11.break, n14 -= l11.size;
    } else if (r2 > n14 * 2) {
      let l11 = t8[i12];
      l11.break ? t8.splice(i12, 1, l11.left, null, l11.right) : t8.splice(i12, 1, l11.left, l11.right), i12 += 2 + l11.break, r2 -= l11.size;
    } else break;
    else if (n14 < r2) {
      let l11 = t8[e7++];
      l11 && (n14 += l11.size);
    } else {
      let l11 = t8[--i12];
      l11 && (r2 += l11.size);
    }
    let o = 0;
    return t8[e7 - 1] == null ? (o = 1, e7--) : t8[e7] == null && (o = 1, i12++), new ii5(s177.of(t8.slice(0, e7)), o, s177.of(t8.slice(i12)));
  }
};
F13.prototype.size = 1;
var xe12 = class extends F13 {
  constructor(t8, e7, i12) {
    super(t8, e7), this.deco = i12;
  }
  blockAt(t8, e7, i12, n14) {
    return new _12(n14, this.length, i12, this.height, this.deco || 0);
  }
  lineAt(t8, e7, i12, n14, r2) {
    return this.blockAt(0, i12, n14, r2);
  }
  forEachLine(t8, e7, i12, n14, r2, o) {
    t8 <= r2 + this.length && e7 >= r2 && o(this.blockAt(0, i12, n14, r2));
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    return n14 && n14.from <= e7 && n14.more && this.setHeight(t8, n14.heights[n14.index++]), this.outdated = false, this;
  }
  toString() {
    return `block(${this.length})`;
  }
};
var I12 = class s178 extends xe12 {
  constructor(t8, e7) {
    super(t8, e7, null), this.collapsed = 0, this.widgetHeight = 0, this.breaks = 0;
  }
  blockAt(t8, e7, i12, n14) {
    return new _12(n14, this.length, i12, this.height, this.breaks);
  }
  replace(t8, e7, i12) {
    let n14 = i12[0];
    return i12.length == 1 && (n14 instanceof s178 || n14 instanceof st10 && n14.flags & 4) && Math.abs(this.length - n14.length) < 10 ? (n14 instanceof st10 ? n14 = new s178(n14.length, this.height) : n14.height = this.height, this.outdated || (n14.outdated = false), n14) : F13.of(i12);
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    return n14 && n14.from <= e7 && n14.more ? this.setHeight(t8, n14.heights[n14.index++]) : (i12 || this.outdated) && this.setHeight(t8, Math.max(this.widgetHeight, t8.heightForLine(this.length - this.collapsed)) + this.breaks * t8.lineHeight), this.outdated = false, this;
  }
  toString() {
    return `line(${this.length}${this.collapsed ? -this.collapsed : ""}${this.widgetHeight ? ":" + this.widgetHeight : ""})`;
  }
};
var st10 = class s179 extends F13 {
  constructor(t8) {
    super(t8, 0);
  }
  heightMetrics(t8, e7) {
    let i12 = t8.doc.lineAt(e7).number, n14 = t8.doc.lineAt(e7 + this.length).number, r2 = n14 - i12 + 1, o, l11 = 0;
    if (t8.lineWrapping) {
      let h3 = Math.min(this.height, t8.lineHeight * r2);
      o = h3 / r2, this.length > r2 + 1 && (l11 = (this.height - h3) / (this.length - r2 - 1));
    } else o = this.height / r2;
    return { firstLine: i12, lastLine: n14, perLine: o, perChar: l11 };
  }
  blockAt(t8, e7, i12, n14) {
    let { firstLine: r2, lastLine: o, perLine: l11, perChar: h3 } = this.heightMetrics(e7, n14);
    if (e7.lineWrapping) {
      let c3 = n14 + Math.round(Math.max(0, Math.min(1, (t8 - i12) / this.height)) * this.length), a2 = e7.doc.lineAt(c3), f6 = l11 + a2.length * h3, d4 = Math.max(i12, t8 - f6 / 2);
      return new _12(a2.from, a2.length, d4, f6, 0);
    } else {
      let c3 = Math.max(0, Math.min(o - r2, Math.floor((t8 - i12) / l11))), { from: a2, length: f6 } = e7.doc.line(r2 + c3);
      return new _12(a2, f6, i12 + l11 * c3, l11, 0);
    }
  }
  lineAt(t8, e7, i12, n14, r2) {
    if (e7 == T13.ByHeight) return this.blockAt(t8, i12, n14, r2);
    if (e7 == T13.ByPosNoHeight) {
      let { from: u3, to: g8 } = i12.doc.lineAt(t8);
      return new _12(u3, g8 - u3, 0, 0, 0);
    }
    let { firstLine: o, perLine: l11, perChar: h3 } = this.heightMetrics(i12, r2), c3 = i12.doc.lineAt(t8), a2 = l11 + c3.length * h3, f6 = c3.number - o, d4 = n14 + l11 * f6 + h3 * (c3.from - r2 - f6);
    return new _12(c3.from, c3.length, Math.max(n14, Math.min(d4, n14 + this.height - a2)), a2, 0);
  }
  forEachLine(t8, e7, i12, n14, r2, o) {
    t8 = Math.max(t8, r2), e7 = Math.min(e7, r2 + this.length);
    let { firstLine: l11, perLine: h3, perChar: c3 } = this.heightMetrics(i12, r2);
    for (let a2 = t8, f6 = n14; a2 <= e7; ) {
      let d4 = i12.doc.lineAt(a2);
      if (a2 == t8) {
        let g8 = d4.number - l11;
        f6 += h3 * g8 + c3 * (t8 - r2 - g8);
      }
      let u3 = h3 + c3 * d4.length;
      o(new _12(d4.from, d4.length, f6, u3, 0)), f6 += u3, a2 = d4.to + 1;
    }
  }
  replace(t8, e7, i12) {
    let n14 = this.length - e7;
    if (n14 > 0) {
      let r2 = i12[i12.length - 1];
      r2 instanceof s179 ? i12[i12.length - 1] = new s179(r2.length + n14) : i12.push(null, new s179(n14 - 1));
    }
    if (t8 > 0) {
      let r2 = i12[0];
      r2 instanceof s179 ? i12[0] = new s179(t8 + r2.length) : i12.unshift(new s179(t8 - 1), null);
    }
    return F13.of(i12);
  }
  decomposeLeft(t8, e7) {
    e7.push(new s179(t8 - 1), null);
  }
  decomposeRight(t8, e7) {
    e7.push(null, new s179(this.length - t8 - 1));
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    let r2 = e7 + this.length;
    if (n14 && n14.from <= e7 + this.length && n14.more) {
      let o = [], l11 = Math.max(e7, n14.from), h3 = -1;
      for (n14.from > e7 && o.push(new s179(n14.from - e7 - 1).updateHeight(t8, e7)); l11 <= r2 && n14.more; ) {
        let a2 = t8.doc.lineAt(l11).length;
        o.length && o.push(null);
        let f6 = n14.heights[n14.index++];
        h3 == -1 ? h3 = f6 : Math.abs(f6 - h3) >= le11 && (h3 = -2);
        let d4 = new I12(a2, f6);
        d4.outdated = false, o.push(d4), l11 += a2 + 1;
      }
      l11 <= r2 && o.push(null, new s179(r2 - l11).updateHeight(t8, l11));
      let c3 = F13.of(o);
      return (h3 < 0 || Math.abs(c3.height - this.height) >= le11 || Math.abs(h3 - this.heightMetrics(t8, e7).perLine) >= le11) && (t8.heightChanged = true), c3;
    } else (i12 || this.outdated) && (this.setHeight(t8, t8.heightForGap(e7, e7 + this.length)), this.outdated = false);
    return this;
  }
  toString() {
    return `gap(${this.length})`;
  }
};
var ii5 = class extends F13 {
  constructor(t8, e7, i12) {
    super(t8.length + e7 + i12.length, t8.height + i12.height, e7 | (t8.outdated || i12.outdated ? 2 : 0)), this.left = t8, this.right = i12, this.size = t8.size + i12.size;
  }
  get break() {
    return this.flags & 1;
  }
  blockAt(t8, e7, i12, n14) {
    let r2 = i12 + this.left.height;
    return t8 < r2 ? this.left.blockAt(t8, e7, i12, n14) : this.right.blockAt(t8, e7, r2, n14 + this.left.length + this.break);
  }
  lineAt(t8, e7, i12, n14, r2) {
    let o = n14 + this.left.height, l11 = r2 + this.left.length + this.break, h3 = e7 == T13.ByHeight ? t8 < o : t8 < l11, c3 = h3 ? this.left.lineAt(t8, e7, i12, n14, r2) : this.right.lineAt(t8, e7, i12, o, l11);
    if (this.break || (h3 ? c3.to < l11 : c3.from > l11)) return c3;
    let a2 = e7 == T13.ByPosNoHeight ? T13.ByPosNoHeight : T13.ByPos;
    return h3 ? c3.join(this.right.lineAt(l11, a2, i12, o, l11)) : this.left.lineAt(l11, a2, i12, n14, r2).join(c3);
  }
  forEachLine(t8, e7, i12, n14, r2, o) {
    let l11 = n14 + this.left.height, h3 = r2 + this.left.length + this.break;
    if (this.break) t8 < h3 && this.left.forEachLine(t8, e7, i12, n14, r2, o), e7 >= h3 && this.right.forEachLine(t8, e7, i12, l11, h3, o);
    else {
      let c3 = this.lineAt(h3, T13.ByPos, i12, n14, r2);
      t8 < c3.from && this.left.forEachLine(t8, c3.from - 1, i12, n14, r2, o), c3.to >= t8 && c3.from <= e7 && o(c3), e7 > c3.to && this.right.forEachLine(c3.to + 1, e7, i12, l11, h3, o);
    }
  }
  replace(t8, e7, i12) {
    let n14 = this.left.length + this.break;
    if (e7 < n14) return this.balanced(this.left.replace(t8, e7, i12), this.right);
    if (t8 > this.left.length) return this.balanced(this.left, this.right.replace(t8 - n14, e7 - n14, i12));
    let r2 = [];
    t8 > 0 && this.decomposeLeft(t8, r2);
    let o = r2.length;
    for (let l11 of i12) r2.push(l11);
    if (t8 > 0 && es5(r2, o - 1), e7 < this.length) {
      let l11 = r2.length;
      this.decomposeRight(e7, r2), es5(r2, l11);
    }
    return F13.of(r2);
  }
  decomposeLeft(t8, e7) {
    let i12 = this.left.length;
    if (t8 <= i12) return this.left.decomposeLeft(t8, e7);
    e7.push(this.left), this.break && (i12++, t8 >= i12 && e7.push(null)), t8 > i12 && this.right.decomposeLeft(t8 - i12, e7);
  }
  decomposeRight(t8, e7) {
    let i12 = this.left.length, n14 = i12 + this.break;
    if (t8 >= n14) return this.right.decomposeRight(t8 - n14, e7);
    t8 < i12 && this.left.decomposeRight(t8, e7), this.break && t8 < n14 && e7.push(null), e7.push(this.right);
  }
  balanced(t8, e7) {
    return t8.size > 2 * e7.size || e7.size > 2 * t8.size ? F13.of(this.break ? [t8, null, e7] : [t8, e7]) : (this.left = t8, this.right = e7, this.height = t8.height + e7.height, this.outdated = t8.outdated || e7.outdated, this.size = t8.size + e7.size, this.length = t8.length + this.break + e7.length, this);
  }
  updateHeight(t8, e7 = 0, i12 = false, n14) {
    let { left: r2, right: o } = this, l11 = e7 + r2.length + this.break, h3 = null;
    return n14 && n14.from <= e7 + r2.length && n14.more ? h3 = r2 = r2.updateHeight(t8, e7, i12, n14) : r2.updateHeight(t8, e7, i12), n14 && n14.from <= l11 + o.length && n14.more ? h3 = o = o.updateHeight(t8, l11, i12, n14) : o.updateHeight(t8, l11, i12), h3 ? this.balanced(r2, o) : (this.height = this.left.height + this.right.height, this.outdated = false, this);
  }
  toString() {
    return this.left + (this.break ? " " : "-") + this.right;
  }
};
function es5(s212, t8) {
  let e7, i12;
  s212[t8] == null && (e7 = s212[t8 - 1]) instanceof st10 && (i12 = s212[t8 + 1]) instanceof st10 && s212.splice(t8 - 1, 3, new st10(e7.length + 1 + i12.length));
}
var Hr = 5;
var si5 = class s180 {
  constructor(t8, e7) {
    this.pos = t8, this.oracle = e7, this.nodes = [], this.lineStart = -1, this.lineEnd = -1, this.covering = null, this.writtenTo = t8;
  }
  get isCovered() {
    return this.covering && this.nodes[this.nodes.length - 1] == this.covering;
  }
  span(t8, e7) {
    if (this.lineStart > -1) {
      let i12 = Math.min(e7, this.lineEnd), n14 = this.nodes[this.nodes.length - 1];
      n14 instanceof I12 ? n14.length += i12 - this.pos : (i12 > this.pos || !this.isCovered) && this.nodes.push(new I12(i12 - this.pos, -1)), this.writtenTo = i12, e7 > i12 && (this.nodes.push(null), this.writtenTo++, this.lineStart = -1);
    }
    this.pos = e7;
  }
  point(t8, e7, i12) {
    if (t8 < e7 || i12.heightRelevant) {
      let n14 = i12.widget ? i12.widget.estimatedHeight : 0, r2 = i12.widget ? i12.widget.lineBreaks : 0;
      n14 < 0 && (n14 = this.oracle.lineHeight);
      let o = e7 - t8;
      i12.block ? this.addBlock(new xe12(o, n14, i12)) : (o || r2 || n14 >= Hr) && this.addLineDeco(n14, r2, o);
    } else e7 > t8 && this.span(t8, e7);
    this.lineEnd > -1 && this.lineEnd < this.pos && (this.lineEnd = this.oracle.doc.lineAt(this.pos).to);
  }
  enterLine() {
    if (this.lineStart > -1) return;
    let { from: t8, to: e7 } = this.oracle.doc.lineAt(this.pos);
    this.lineStart = t8, this.lineEnd = e7, this.writtenTo < t8 && ((this.writtenTo < t8 - 1 || this.nodes[this.nodes.length - 1] == null) && this.nodes.push(this.blankContent(this.writtenTo, t8 - 1)), this.nodes.push(null)), this.pos > t8 && this.nodes.push(new I12(this.pos - t8, -1)), this.writtenTo = this.pos;
  }
  blankContent(t8, e7) {
    let i12 = new st10(e7 - t8);
    return this.oracle.doc.lineAt(t8).to == e7 && (i12.flags |= 4), i12;
  }
  ensureLine() {
    this.enterLine();
    let t8 = this.nodes.length ? this.nodes[this.nodes.length - 1] : null;
    if (t8 instanceof I12) return t8;
    let e7 = new I12(0, -1);
    return this.nodes.push(e7), e7;
  }
  addBlock(t8) {
    this.enterLine();
    let e7 = t8.deco;
    e7 && e7.startSide > 0 && !this.isCovered && this.ensureLine(), this.nodes.push(t8), this.writtenTo = this.pos = this.pos + t8.length, e7 && e7.endSide > 0 && (this.covering = t8);
  }
  addLineDeco(t8, e7, i12) {
    let n14 = this.ensureLine();
    n14.length += i12, n14.collapsed += i12, n14.widgetHeight = Math.max(n14.widgetHeight, t8), n14.breaks += e7, this.writtenTo = this.pos = this.pos + i12;
  }
  finish(t8) {
    let e7 = this.nodes.length == 0 ? null : this.nodes[this.nodes.length - 1];
    this.lineStart > -1 && !(e7 instanceof I12) && !this.isCovered ? this.nodes.push(new I12(0, -1)) : (this.writtenTo < this.pos || e7 == null) && this.nodes.push(this.blankContent(this.writtenTo, this.pos));
    let i12 = t8;
    for (let n14 of this.nodes) n14 instanceof I12 && n14.updateHeight(this.oracle, i12), i12 += n14 ? n14.length : 1;
    return this.nodes;
  }
  static build(t8, e7, i12, n14) {
    let r2 = new s180(i12, t8);
    return T11.spans(e7, i12, n14, r2, 0), r2.finish(i12);
  }
};
function Nr4(s212, t8, e7) {
  let i12 = new ni5();
  return T11.compare(s212, t8, e7, i12, 0), i12.changes;
}
var ni5 = class {
  constructor() {
    this.changes = [];
  }
  compareRange() {
  }
  comparePoint(t8, e7, i12, n14) {
    (t8 < e7 || i12 && i12.heightRelevant || n14 && n14.heightRelevant) && _e7(t8, e7, this.changes, 5);
  }
};
function Vr4(s212, t8) {
  let e7 = s212.getBoundingClientRect(), i12 = s212.ownerDocument, n14 = i12.defaultView || window, r2 = Math.max(0, e7.left), o = Math.min(n14.innerWidth, e7.right), l11 = Math.max(0, e7.top), h3 = Math.min(n14.innerHeight, e7.bottom);
  for (let c3 = s212.parentNode; c3 && c3 != i12.body; ) if (c3.nodeType == 1) {
    let a2 = c3, f6 = window.getComputedStyle(a2);
    if ((a2.scrollHeight > a2.clientHeight || a2.scrollWidth > a2.clientWidth) && f6.overflow != "visible") {
      let d4 = a2.getBoundingClientRect();
      r2 = Math.max(r2, d4.left), o = Math.min(o, d4.right), l11 = Math.max(l11, d4.top), h3 = c3 == s212.parentNode ? d4.bottom : Math.min(h3, d4.bottom);
    }
    c3 = f6.position == "absolute" || f6.position == "fixed" ? a2.offsetParent : a2.parentNode;
  } else if (c3.nodeType == 11) c3 = c3.host;
  else break;
  return { left: r2 - e7.left, right: Math.max(r2, o) - e7.left, top: l11 - (e7.top + t8), bottom: Math.max(l11, h3) - (e7.top + t8) };
}
function Wr5(s212, t8) {
  let e7 = s212.getBoundingClientRect();
  return { left: 0, right: e7.right - e7.left, top: t8, bottom: e7.bottom - (e7.top + t8) };
}
var Pt6 = class {
  constructor(t8, e7, i12) {
    this.from = t8, this.to = e7, this.size = i12;
  }
  static same(t8, e7) {
    if (t8.length != e7.length) return false;
    for (let i12 = 0; i12 < t8.length; i12++) {
      let n14 = t8[i12], r2 = e7[i12];
      if (n14.from != r2.from || n14.to != r2.to || n14.size != r2.size) return false;
    }
    return true;
  }
  draw(t8, e7) {
    return R11.replace({ widget: new ri5(this.size * (e7 ? t8.scaleY : t8.scaleX), e7) }).range(this.from, this.to);
  }
};
var ri5 = class extends ot9 {
  constructor(t8, e7) {
    super(), this.size = t8, this.vertical = e7;
  }
  eq(t8) {
    return t8.size == this.size && t8.vertical == this.vertical;
  }
  toDOM() {
    let t8 = document.createElement("div");
    return this.vertical ? t8.style.height = this.size + "px" : (t8.style.width = this.size + "px", t8.style.height = "2px", t8.style.display = "inline-block"), t8;
  }
  get estimatedHeight() {
    return this.vertical ? this.size : -1;
  }
};
var Se8 = class {
  constructor(t8) {
    this.state = t8, this.pixelViewport = { left: 0, right: window.innerWidth, top: 0, bottom: 0 }, this.inView = true, this.paddingTop = 0, this.paddingBottom = 0, this.contentDOMWidth = 0, this.contentDOMHeight = 0, this.editorHeight = 0, this.editorWidth = 0, this.scrollTop = 0, this.scrolledToBottom = true, this.scaleX = 1, this.scaleY = 1, this.scrollAnchorPos = 0, this.scrollAnchorHeight = -1, this.scaler = is5, this.scrollTarget = null, this.printing = false, this.mustMeasureContent = true, this.defaultTextDirection = B7.LTR, this.visibleRanges = [], this.mustEnforceCursorAssoc = false;
    let e7 = t8.facet(Le10).some((i12) => typeof i12 != "function" && i12.class == "cm-lineWrapping");
    this.heightOracle = new ye10(e7), this.stateDeco = t8.facet(Kt7).filter((i12) => typeof i12 != "function"), this.heightMap = F13.empty().applyChanges(this.stateDeco, m5.empty, this.heightOracle.setDoc(t8.doc), [new K9(0, 0, 0, t8.doc.length)]), this.viewport = this.getViewport(0, null), this.updateViewportLines(), this.updateForViewport(), this.lineGaps = this.ensureLineGaps([]), this.lineGapDeco = R11.set(this.lineGaps.map((i12) => i12.draw(this, false))), this.computeVisibleRanges();
  }
  updateForViewport() {
    let t8 = [this.viewport], { main: e7 } = this.state.selection;
    for (let i12 = 0; i12 <= 1; i12++) {
      let n14 = i12 ? e7.head : e7.anchor;
      if (!t8.some(({ from: r2, to: o }) => n14 >= r2 && n14 <= o)) {
        let { from: r2, to: o } = this.lineBlockAt(n14);
        t8.push(new gt7(r2, o));
      }
    }
    this.viewports = t8.sort((i12, n14) => i12.from - n14.from), this.scaler = this.heightMap.height <= 7e6 ? is5 : new oi5(this.heightOracle, this.heightMap, this.viewports);
  }
  updateViewportLines() {
    this.viewportLines = [], this.heightMap.forEachLine(this.viewport.from, this.viewport.to, this.heightOracle.setDoc(this.state.doc), 0, 0, (t8) => {
      this.viewportLines.push(this.scaler.scale == 1 ? t8 : Dt7(t8, this.scaler));
    });
  }
  update(t8, e7 = null) {
    this.state = t8.state;
    let i12 = this.stateDeco;
    this.stateDeco = this.state.facet(Kt7).filter((a2) => typeof a2 != "function");
    let n14 = t8.changedRanges, r2 = K9.extendWithRanges(n14, Nr4(i12, this.stateDeco, t8 ? t8.changes : P12.empty(this.state.doc.length))), o = this.heightMap.height, l11 = this.scrolledToBottom ? null : this.scrollAnchorAt(this.scrollTop);
    this.heightMap = this.heightMap.applyChanges(this.stateDeco, t8.startState.doc, this.heightOracle.setDoc(this.state.doc), r2), this.heightMap.height != o && (t8.flags |= 2), l11 ? (this.scrollAnchorPos = t8.changes.mapPos(l11.from, -1), this.scrollAnchorHeight = l11.top) : (this.scrollAnchorPos = -1, this.scrollAnchorHeight = this.heightMap.height);
    let h3 = r2.length ? this.mapViewport(this.viewport, t8.changes) : this.viewport;
    (e7 && (e7.range.head < h3.from || e7.range.head > h3.to) || !this.viewportIsAppropriate(h3)) && (h3 = this.getViewport(0, e7));
    let c3 = !t8.changes.empty || t8.flags & 2 || h3.from != this.viewport.from || h3.to != this.viewport.to;
    this.viewport = h3, this.updateForViewport(), c3 && this.updateViewportLines(), (this.lineGaps.length || this.viewport.to - this.viewport.from > 4e3) && this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps, t8.changes))), t8.flags |= this.computeVisibleRanges(), e7 && (this.scrollTarget = e7), !this.mustEnforceCursorAssoc && t8.selectionSet && t8.view.lineWrapping && t8.state.selection.main.empty && t8.state.selection.main.assoc && !t8.state.facet(js5) && (this.mustEnforceCursorAssoc = true);
  }
  measure(t8) {
    let e7 = t8.contentDOM, i12 = window.getComputedStyle(e7), n14 = this.heightOracle, r2 = i12.whiteSpace;
    this.defaultTextDirection = i12.direction == "rtl" ? B7.RTL : B7.LTR;
    let o = this.heightOracle.mustRefreshForWrapping(r2), l11 = e7.getBoundingClientRect(), h3 = o || this.mustMeasureContent || this.contentDOMHeight != l11.height;
    this.contentDOMHeight = l11.height, this.mustMeasureContent = false;
    let c3 = 0, a2 = 0;
    if (l11.width && l11.height) {
      let y18 = l11.width / e7.offsetWidth, x11 = l11.height / e7.offsetHeight;
      (y18 > 0.995 && y18 < 1.005 || !isFinite(y18) || Math.abs(l11.width - e7.offsetWidth) < 1) && (y18 = 1), (x11 > 0.995 && x11 < 1.005 || !isFinite(x11) || Math.abs(l11.height - e7.offsetHeight) < 1) && (x11 = 1), (this.scaleX != y18 || this.scaleY != x11) && (this.scaleX = y18, this.scaleY = x11, c3 |= 8, o = h3 = true);
    }
    let f6 = (parseInt(i12.paddingTop) || 0) * this.scaleY, d4 = (parseInt(i12.paddingBottom) || 0) * this.scaleY;
    (this.paddingTop != f6 || this.paddingBottom != d4) && (this.paddingTop = f6, this.paddingBottom = d4, c3 |= 10), this.editorWidth != t8.scrollDOM.clientWidth && (n14.lineWrapping && (h3 = true), this.editorWidth = t8.scrollDOM.clientWidth, c3 |= 8);
    let u3 = t8.scrollDOM.scrollTop * this.scaleY;
    this.scrollTop != u3 && (this.scrollAnchorHeight = -1, this.scrollTop = u3), this.scrolledToBottom = Ts5(t8.scrollDOM);
    let g8 = (this.printing ? Wr5 : Vr4)(e7, this.paddingTop), m11 = g8.top - this.pixelViewport.top, p3 = g8.bottom - this.pixelViewport.bottom;
    this.pixelViewport = g8;
    let b12 = this.pixelViewport.bottom > this.pixelViewport.top && this.pixelViewport.right > this.pixelViewport.left;
    if (b12 != this.inView && (this.inView = b12, b12 && (h3 = true)), !this.inView && !this.scrollTarget) return 0;
    let v10 = l11.width;
    if ((this.contentDOMWidth != v10 || this.editorHeight != t8.scrollDOM.clientHeight) && (this.contentDOMWidth = l11.width, this.editorHeight = t8.scrollDOM.clientHeight, c3 |= 8), h3) {
      let y18 = t8.docView.measureVisibleLineHeights(this.viewport);
      if (n14.mustRefreshForHeights(y18) && (o = true), o || n14.lineWrapping && Math.abs(v10 - this.contentDOMWidth) > n14.charWidth) {
        let { lineHeight: x11, charWidth: C11, textHeight: L19 } = t8.docView.measureTextSize();
        o = x11 > 0 && n14.refresh(r2, x11, C11, L19, v10 / C11, y18), o && (t8.docView.minWidth = 0, c3 |= 8);
      }
      m11 > 0 && p3 > 0 ? a2 = Math.max(m11, p3) : m11 < 0 && p3 < 0 && (a2 = Math.min(m11, p3)), n14.heightChanged = false;
      for (let x11 of this.viewports) {
        let C11 = x11.from == this.viewport.from ? y18 : t8.docView.measureVisibleLineHeights(x11);
        this.heightMap = (o ? F13.empty().applyChanges(this.stateDeco, m5.empty, this.heightOracle, [new K9(0, 0, 0, t8.state.doc.length)]) : this.heightMap).updateHeight(n14, 0, o, new ve10(x11.from, C11));
      }
      n14.heightChanged && (c3 |= 2);
    }
    let S17 = !this.viewportIsAppropriate(this.viewport, a2) || this.scrollTarget && (this.scrollTarget.range.head < this.viewport.from || this.scrollTarget.range.head > this.viewport.to);
    return S17 && (this.viewport = this.getViewport(a2, this.scrollTarget)), this.updateForViewport(), (c3 & 2 || S17) && this.updateViewportLines(), (this.lineGaps.length || this.viewport.to - this.viewport.from > 4e3) && this.updateLineGaps(this.ensureLineGaps(o ? [] : this.lineGaps, t8)), c3 |= this.computeVisibleRanges(), this.mustEnforceCursorAssoc && (this.mustEnforceCursorAssoc = false, t8.docView.enforceCursorAssoc()), c3;
  }
  get visibleTop() {
    return this.scaler.fromDOM(this.pixelViewport.top);
  }
  get visibleBottom() {
    return this.scaler.fromDOM(this.pixelViewport.bottom);
  }
  getViewport(t8, e7) {
    let i12 = 0.5 - Math.max(-0.5, Math.min(0.5, t8 / 1e3 / 2)), n14 = this.heightMap, r2 = this.heightOracle, { visibleTop: o, visibleBottom: l11 } = this, h3 = new gt7(n14.lineAt(o - i12 * 1e3, T13.ByHeight, r2, 0, 0).from, n14.lineAt(l11 + (1 - i12) * 1e3, T13.ByHeight, r2, 0, 0).to);
    if (e7) {
      let { head: c3 } = e7.range;
      if (c3 < h3.from || c3 > h3.to) {
        let a2 = Math.min(this.editorHeight, this.pixelViewport.bottom - this.pixelViewport.top), f6 = n14.lineAt(c3, T13.ByPos, r2, 0, 0), d4;
        e7.y == "center" ? d4 = (f6.top + f6.bottom) / 2 - a2 / 2 : e7.y == "start" || e7.y == "nearest" && c3 < h3.from ? d4 = f6.top : d4 = f6.bottom - a2, h3 = new gt7(n14.lineAt(d4 - 1e3 / 2, T13.ByHeight, r2, 0, 0).from, n14.lineAt(d4 + a2 + 1e3 / 2, T13.ByHeight, r2, 0, 0).to);
      }
    }
    return h3;
  }
  mapViewport(t8, e7) {
    let i12 = e7.mapPos(t8.from, -1), n14 = e7.mapPos(t8.to, 1);
    return new gt7(this.heightMap.lineAt(i12, T13.ByPos, this.heightOracle, 0, 0).from, this.heightMap.lineAt(n14, T13.ByPos, this.heightOracle, 0, 0).to);
  }
  viewportIsAppropriate({ from: t8, to: e7 }, i12 = 0) {
    if (!this.inView) return true;
    let { top: n14 } = this.heightMap.lineAt(t8, T13.ByPos, this.heightOracle, 0, 0), { bottom: r2 } = this.heightMap.lineAt(e7, T13.ByPos, this.heightOracle, 0, 0), { visibleTop: o, visibleBottom: l11 } = this;
    return (t8 == 0 || n14 <= o - Math.max(10, Math.min(-i12, 250))) && (e7 == this.state.doc.length || r2 >= l11 + Math.max(10, Math.min(i12, 250))) && n14 > o - 2 * 1e3 && r2 < l11 + 2 * 1e3;
  }
  mapLineGaps(t8, e7) {
    if (!t8.length || e7.empty) return t8;
    let i12 = [];
    for (let n14 of t8) e7.touchesRange(n14.from, n14.to) || i12.push(new Pt6(e7.mapPos(n14.from), e7.mapPos(n14.to), n14.size));
    return i12;
  }
  ensureLineGaps(t8, e7) {
    let i12 = this.heightOracle.lineWrapping, n14 = i12 ? 1e4 : 2e3, r2 = n14 >> 1, o = n14 << 1;
    if (this.defaultTextDirection != B7.LTR && !i12) return [];
    let l11 = [], h3 = (c3, a2, f6, d4) => {
      if (a2 - c3 < r2) return;
      let u3 = this.state.selection.main, g8 = [u3.from];
      u3.empty || g8.push(u3.to);
      for (let p3 of g8) if (p3 > c3 && p3 < a2) {
        h3(c3, p3 - 10, f6, d4), h3(p3 + 10, a2, f6, d4);
        return;
      }
      let m11 = zr3(t8, (p3) => p3.from >= f6.from && p3.to <= f6.to && Math.abs(p3.from - c3) < r2 && Math.abs(p3.to - a2) < r2 && !g8.some((b12) => p3.from < b12 && p3.to > b12));
      if (!m11) {
        if (a2 < f6.to && e7 && i12 && e7.visibleRanges.some((p3) => p3.from <= a2 && p3.to >= a2)) {
          let p3 = e7.moveToLineBoundary(x7.cursor(a2), false, true).head;
          p3 > c3 && (a2 = p3);
        }
        m11 = new Pt6(c3, a2, this.gapSize(f6, c3, a2, d4));
      }
      l11.push(m11);
    };
    for (let c3 of this.viewportLines) {
      if (c3.length < o) continue;
      let a2 = Fr5(c3.from, c3.to, this.stateDeco);
      if (a2.total < o) continue;
      let f6 = this.scrollTarget ? this.scrollTarget.range.head : null, d4, u3;
      if (i12) {
        let g8 = n14 / this.heightOracle.lineLength * this.heightOracle.lineHeight, m11, p3;
        if (f6 != null) {
          let b12 = ie6(a2, f6), v10 = ((this.visibleBottom - this.visibleTop) / 2 + g8) / c3.height;
          m11 = b12 - v10, p3 = b12 + v10;
        } else m11 = (this.visibleTop - c3.top - g8) / c3.height, p3 = (this.visibleBottom - c3.top + g8) / c3.height;
        d4 = ee8(a2, m11), u3 = ee8(a2, p3);
      } else {
        let g8 = a2.total * this.heightOracle.charWidth, m11 = n14 * this.heightOracle.charWidth, p3, b12;
        if (f6 != null) {
          let v10 = ie6(a2, f6), S17 = ((this.pixelViewport.right - this.pixelViewport.left) / 2 + m11) / g8;
          p3 = v10 - S17, b12 = v10 + S17;
        } else p3 = (this.pixelViewport.left - m11) / g8, b12 = (this.pixelViewport.right + m11) / g8;
        d4 = ee8(a2, p3), u3 = ee8(a2, b12);
      }
      d4 > c3.from && h3(c3.from, d4, c3, a2), u3 < c3.to && h3(u3, c3.to, c3, a2);
    }
    return l11;
  }
  gapSize(t8, e7, i12, n14) {
    let r2 = ie6(n14, i12) - ie6(n14, e7);
    return this.heightOracle.lineWrapping ? t8.height * r2 : n14.total * this.heightOracle.charWidth * r2;
  }
  updateLineGaps(t8) {
    Pt6.same(t8, this.lineGaps) || (this.lineGaps = t8, this.lineGapDeco = R11.set(t8.map((e7) => e7.draw(this, this.heightOracle.lineWrapping))));
  }
  computeVisibleRanges() {
    let t8 = this.stateDeco;
    this.lineGaps.length && (t8 = t8.concat(this.lineGapDeco));
    let e7 = [];
    T11.spans(t8, this.viewport.from, this.viewport.to, { span(n14, r2) {
      e7.push({ from: n14, to: r2 });
    }, point() {
    } }, 20);
    let i12 = e7.length != this.visibleRanges.length || this.visibleRanges.some((n14, r2) => n14.from != e7[r2].from || n14.to != e7[r2].to);
    return this.visibleRanges = e7, i12 ? 4 : 0;
  }
  lineBlockAt(t8) {
    return t8 >= this.viewport.from && t8 <= this.viewport.to && this.viewportLines.find((e7) => e7.from <= t8 && e7.to >= t8) || Dt7(this.heightMap.lineAt(t8, T13.ByPos, this.heightOracle, 0, 0), this.scaler);
  }
  lineBlockAtHeight(t8) {
    return Dt7(this.heightMap.lineAt(this.scaler.fromDOM(t8), T13.ByHeight, this.heightOracle, 0, 0), this.scaler);
  }
  scrollAnchorAt(t8) {
    let e7 = this.lineBlockAtHeight(t8 + 8);
    return e7.from >= this.viewport.from || this.viewportLines[0].top - t8 > 200 ? e7 : this.viewportLines[0];
  }
  elementAtHeight(t8) {
    return Dt7(this.heightMap.blockAt(this.scaler.fromDOM(t8), this.heightOracle, 0, 0), this.scaler);
  }
  get docHeight() {
    return this.scaler.toDOM(this.heightMap.height);
  }
  get contentHeight() {
    return this.docHeight + this.paddingTop + this.paddingBottom;
  }
};
var gt7 = class {
  constructor(t8, e7) {
    this.from = t8, this.to = e7;
  }
};
function Fr5(s212, t8, e7) {
  let i12 = [], n14 = s212, r2 = 0;
  return T11.spans(e7, s212, t8, { span() {
  }, point(o, l11) {
    o > n14 && (i12.push({ from: n14, to: o }), r2 += o - n14), n14 = l11;
  } }, 20), n14 < t8 && (i12.push({ from: n14, to: t8 }), r2 += t8 - n14), { total: r2, ranges: i12 };
}
function ee8({ total: s212, ranges: t8 }, e7) {
  if (e7 <= 0) return t8[0].from;
  if (e7 >= 1) return t8[t8.length - 1].to;
  let i12 = Math.floor(s212 * e7);
  for (let n14 = 0; ; n14++) {
    let { from: r2, to: o } = t8[n14], l11 = o - r2;
    if (i12 <= l11) return r2 + i12;
    i12 -= l11;
  }
}
function ie6(s212, t8) {
  let e7 = 0;
  for (let { from: i12, to: n14 } of s212.ranges) {
    if (t8 <= n14) {
      e7 += t8 - i12;
      break;
    }
    e7 += n14 - i12;
  }
  return e7 / s212.total;
}
function zr3(s212, t8) {
  for (let e7 of s212) if (t8(e7)) return e7;
}
var is5 = { toDOM(s212) {
  return s212;
}, fromDOM(s212) {
  return s212;
}, scale: 1 };
var oi5 = class {
  constructor(t8, e7, i12) {
    let n14 = 0, r2 = 0, o = 0;
    this.viewports = i12.map(({ from: l11, to: h3 }) => {
      let c3 = e7.lineAt(l11, T13.ByPos, t8, 0, 0).top, a2 = e7.lineAt(h3, T13.ByPos, t8, 0, 0).bottom;
      return n14 += a2 - c3, { from: l11, to: h3, top: c3, bottom: a2, domTop: 0, domBottom: 0 };
    }), this.scale = (7e6 - n14) / (e7.height - n14);
    for (let l11 of this.viewports) l11.domTop = o + (l11.top - r2) * this.scale, o = l11.domBottom = l11.domTop + (l11.bottom - l11.top), r2 = l11.bottom;
  }
  toDOM(t8) {
    for (let e7 = 0, i12 = 0, n14 = 0; ; e7++) {
      let r2 = e7 < this.viewports.length ? this.viewports[e7] : null;
      if (!r2 || t8 < r2.top) return n14 + (t8 - i12) * this.scale;
      if (t8 <= r2.bottom) return r2.domTop + (t8 - r2.top);
      i12 = r2.bottom, n14 = r2.domBottom;
    }
  }
  fromDOM(t8) {
    for (let e7 = 0, i12 = 0, n14 = 0; ; e7++) {
      let r2 = e7 < this.viewports.length ? this.viewports[e7] : null;
      if (!r2 || t8 < r2.domTop) return i12 + (t8 - n14) / this.scale;
      if (t8 <= r2.domBottom) return r2.top + (t8 - r2.domTop);
      i12 = r2.bottom, n14 = r2.domBottom;
    }
  }
};
function Dt7(s212, t8) {
  if (t8.scale == 1) return s212;
  let e7 = t8.toDOM(s212.top), i12 = t8.toDOM(s212.bottom);
  return new _12(s212.from, s212.length, e7, i12 - e7, Array.isArray(s212._content) ? s212._content.map((n14) => Dt7(n14, t8)) : s212._content);
}
var se8 = y11.define({ combine: (s212) => s212.join(" ") });
var li5 = y11.define({ combine: (s212) => s212.indexOf(true) > -1 });
var hi5 = b7.newName();
var pn6 = b7.newName();
var mn5 = b7.newName();
var bn5 = { "&light": "." + pn6, "&dark": "." + mn5 };
function ai5(s212, t8, e7) {
  return new b7(t8, { finish(i12) {
    return /&/.test(i12) ? i12.replace(/&\w*/, (n14) => {
      if (n14 == "&") return s212;
      if (!e7 || !e7[n14]) throw new RangeError(`Unsupported selector: ${n14}`);
      return e7[n14];
    }) : s212 + " " + i12;
  } });
}
var Ir3 = ai5("." + hi5, { "&": { position: "relative !important", boxSizing: "border-box", "&.cm-focused": { outline: "1px dotted #212121" }, display: "flex !important", flexDirection: "column" }, ".cm-scroller": { display: "flex !important", alignItems: "flex-start !important", fontFamily: "monospace", lineHeight: 1.4, height: "100%", overflowX: "auto", position: "relative", zIndex: 0 }, ".cm-content": { margin: 0, flexGrow: 2, flexShrink: 0, display: "block", whiteSpace: "pre", wordWrap: "normal", boxSizing: "border-box", minHeight: "100%", padding: "4px 0", outline: "none", "&[contenteditable=true]": { WebkitUserModify: "read-write-plaintext-only" } }, ".cm-lineWrapping": { whiteSpace_fallback: "pre-wrap", whiteSpace: "break-spaces", wordBreak: "break-word", overflowWrap: "anywhere", flexShrink: 1 }, "&light .cm-content": { caretColor: "black" }, "&dark .cm-content": { caretColor: "white" }, ".cm-line": { display: "block", padding: "0 2px 0 6px" }, ".cm-layer": { position: "absolute", left: 0, top: 0, contain: "size style", "& > *": { position: "absolute" } }, "&light .cm-selectionBackground": { background: "#d9d9d9" }, "&dark .cm-selectionBackground": { background: "#222" }, "&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground": { background: "#d7d4f0" }, "&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground": { background: "#233" }, ".cm-cursorLayer": { pointerEvents: "none" }, "&.cm-focused > .cm-scroller > .cm-cursorLayer": { animation: "steps(1) cm-blink 1.2s infinite" }, "@keyframes cm-blink": { "0%": {}, "50%": { opacity: 0 }, "100%": {} }, "@keyframes cm-blink2": { "0%": {}, "50%": { opacity: 0 }, "100%": {} }, ".cm-cursor, .cm-dropCursor": { borderLeft: "1.2px solid black", marginLeft: "-0.6px", pointerEvents: "none" }, ".cm-cursor": { display: "none" }, "&dark .cm-cursor": { borderLeftColor: "#444" }, ".cm-dropCursor": { position: "absolute" }, "&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor": { display: "block" }, "&light .cm-activeLine": { backgroundColor: "#cceeff44" }, "&dark .cm-activeLine": { backgroundColor: "#99eeff33" }, "&light .cm-specialChar": { color: "red" }, "&dark .cm-specialChar": { color: "#f78" }, ".cm-gutters": { flexShrink: 0, display: "flex", height: "100%", boxSizing: "border-box", insetInlineStart: 0, zIndex: 200 }, "&light .cm-gutters": { backgroundColor: "#f5f5f5", color: "#6c6c6c", borderRight: "1px solid #ddd" }, "&dark .cm-gutters": { backgroundColor: "#333338", color: "#ccc" }, ".cm-gutter": { display: "flex !important", flexDirection: "column", flexShrink: 0, boxSizing: "border-box", minHeight: "100%", overflow: "hidden" }, ".cm-gutterElement": { boxSizing: "border-box" }, ".cm-lineNumbers .cm-gutterElement": { padding: "0 3px 0 5px", minWidth: "20px", textAlign: "right", whiteSpace: "nowrap" }, "&light .cm-activeLineGutter": { backgroundColor: "#e2f2ff" }, "&dark .cm-activeLineGutter": { backgroundColor: "#222227" }, ".cm-panels": { boxSizing: "border-box", position: "sticky", left: 0, right: 0 }, "&light .cm-panels": { backgroundColor: "#f5f5f5", color: "black" }, "&light .cm-panels-top": { borderBottom: "1px solid #ddd" }, "&light .cm-panels-bottom": { borderTop: "1px solid #ddd" }, "&dark .cm-panels": { backgroundColor: "#333338", color: "white" }, ".cm-tab": { display: "inline-block", overflow: "hidden", verticalAlign: "bottom" }, ".cm-widgetBuffer": { verticalAlign: "text-top", height: "1em", width: 0, display: "inline" }, ".cm-placeholder": { color: "#888", display: "inline-block", verticalAlign: "top" }, ".cm-highlightSpace:before": { content: "attr(data-display)", position: "absolute", pointerEvents: "none", color: "#888" }, ".cm-highlightTab": { backgroundImage: `url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`, backgroundSize: "auto 100%", backgroundPosition: "right 90%", backgroundRepeat: "no-repeat" }, ".cm-trailingSpace": { backgroundColor: "#ff332255" }, ".cm-button": { verticalAlign: "middle", color: "inherit", fontSize: "70%", padding: ".2em 1em", borderRadius: "1px" }, "&light .cm-button": { backgroundImage: "linear-gradient(#eff1f5, #d9d9df)", border: "1px solid #888", "&:active": { backgroundImage: "linear-gradient(#b4b4b4, #d0d3d6)" } }, "&dark .cm-button": { backgroundImage: "linear-gradient(#393939, #111)", border: "1px solid #888", "&:active": { backgroundImage: "linear-gradient(#111, #333)" } }, ".cm-textfield": { verticalAlign: "middle", color: "inherit", fontSize: "70%", border: "1px solid silver", padding: ".2em .5em" }, "&light .cm-textfield": { backgroundColor: "white" }, "&dark .cm-textfield": { border: "1px solid #555", backgroundColor: "inherit" } }, bn5);
var Tt3 = "ï¿¿";
var ci5 = class {
  constructor(t8, e7) {
    this.points = t8, this.text = "", this.lineSeparator = e7.facet(I11.lineSeparator);
  }
  append(t8) {
    this.text += t8;
  }
  lineBreak() {
    this.text += Tt3;
  }
  readRange(t8, e7) {
    if (!t8) return this;
    let i12 = t8.parentNode;
    for (let n14 = t8; ; ) {
      this.findPointBefore(i12, n14);
      let r2 = this.text.length;
      this.readNode(n14);
      let o = n14.nextSibling;
      if (o == e7) break;
      let l11 = O12.get(n14), h3 = O12.get(o);
      (l11 && h3 ? l11.breakAfter : (l11 ? l11.breakAfter : ss5(n14)) || ss5(o) && (n14.nodeName != "BR" || n14.cmIgnore) && this.text.length > r2) && this.lineBreak(), n14 = o;
    }
    return this.findPointBefore(i12, e7), this;
  }
  readTextNode(t8) {
    let e7 = t8.nodeValue;
    for (let i12 of this.points) i12.node == t8 && (i12.pos = this.text.length + Math.min(i12.offset, e7.length));
    for (let i12 = 0, n14 = this.lineSeparator ? null : /\r\n?|\n/g; ; ) {
      let r2 = -1, o = 1, l11;
      if (this.lineSeparator ? (r2 = e7.indexOf(this.lineSeparator, i12), o = this.lineSeparator.length) : (l11 = n14.exec(e7)) && (r2 = l11.index, o = l11[0].length), this.append(e7.slice(i12, r2 < 0 ? e7.length : r2)), r2 < 0) break;
      if (this.lineBreak(), o > 1) for (let h3 of this.points) h3.node == t8 && h3.pos > this.text.length && (h3.pos -= o - 1);
      i12 = r2 + o;
    }
  }
  readNode(t8) {
    if (t8.cmIgnore) return;
    let e7 = O12.get(t8), i12 = e7 && e7.overrideDOMText;
    if (i12 != null) {
      this.findPointInside(t8, i12.length);
      for (let n14 = i12.iter(); !n14.next().done; ) n14.lineBreak ? this.lineBreak() : this.append(n14.value);
    } else t8.nodeType == 3 ? this.readTextNode(t8) : t8.nodeName == "BR" ? t8.nextSibling && this.lineBreak() : t8.nodeType == 1 && this.readRange(t8.firstChild, null);
  }
  findPointBefore(t8, e7) {
    for (let i12 of this.points) i12.node == t8 && t8.childNodes[i12.offset] == e7 && (i12.pos = this.text.length);
  }
  findPointInside(t8, e7) {
    for (let i12 of this.points) (t8.nodeType == 3 ? i12.node == t8 : t8.contains(i12.node)) && (i12.pos = this.text.length + (Kr4(t8, i12.node, i12.offset) ? e7 : 0));
  }
};
function Kr4(s212, t8, e7) {
  for (; ; ) {
    if (!t8 || e7 < Z10(t8)) return false;
    if (t8 == s212) return true;
    e7 = Vt8(t8) + 1, t8 = t8.parentNode;
  }
}
function ss5(s212) {
  return s212.nodeType == 1 && /^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(s212.nodeName);
}
var Ce7 = class {
  constructor(t8, e7) {
    this.node = t8, this.offset = e7, this.pos = -1;
  }
};
var fi5 = class {
  constructor(t8, e7, i12, n14) {
    this.typeOver = n14, this.bounds = null, this.text = "";
    let { impreciseHead: r2, impreciseAnchor: o } = t8.docView;
    if (t8.state.readOnly && e7 > -1) this.newSel = null;
    else if (e7 > -1 && (this.bounds = t8.docView.domBoundsAround(e7, i12, 0))) {
      let l11 = r2 || o ? [] : Yr4(t8), h3 = new ci5(l11, t8.state);
      h3.readRange(this.bounds.startDOM, this.bounds.endDOM), this.text = h3.text, this.newSel = _r5(l11, this.bounds.from);
    } else {
      let l11 = t8.observer.selectionRange, h3 = r2 && r2.node == l11.focusNode && r2.offset == l11.focusOffset || !Fe11(t8.contentDOM, l11.focusNode) ? t8.state.selection.main.head : t8.docView.posFromDOM(l11.focusNode, l11.focusOffset), c3 = o && o.node == l11.anchorNode && o.offset == l11.anchorOffset || !Fe11(t8.contentDOM, l11.anchorNode) ? t8.state.selection.main.anchor : t8.docView.posFromDOM(l11.anchorNode, l11.anchorOffset);
      this.newSel = x7.single(c3, h3);
    }
  }
};
function wn5(s212, t8) {
  let e7, { newSel: i12 } = t8, n14 = s212.state.selection.main, r2 = s212.inputState.lastKeyTime > Date.now() - 100 ? s212.inputState.lastKeyCode : -1;
  if (t8.bounds) {
    let { from: o, to: l11 } = t8.bounds, h3 = n14.from, c3 = null;
    (r2 === 8 || w9.android && t8.text.length < l11 - o) && (h3 = n14.to, c3 = "end");
    let a2 = jr5(s212.state.doc.sliceString(o, l11, Tt3), t8.text, h3 - o, c3);
    a2 && (w9.chrome && r2 == 13 && a2.toB == a2.from + 2 && t8.text.slice(a2.from, a2.toB) == Tt3 + Tt3 && a2.toB--, e7 = { from: o + a2.from, to: o + a2.toA, insert: m5.of(t8.text.slice(a2.from, a2.toB).split(Tt3)) });
  } else i12 && (!s212.hasFocus && s212.state.facet(Re9) || i12.main.eq(n14)) && (i12 = null);
  if (!e7 && !i12) return false;
  if (!e7 && t8.typeOver && !n14.empty && i12 && i12.main.empty ? e7 = { from: n14.from, to: n14.to, insert: s212.state.doc.slice(n14.from, n14.to) } : e7 && e7.from >= n14.from && e7.to <= n14.to && (e7.from != n14.from || e7.to != n14.to) && n14.to - n14.from - (e7.to - e7.from) <= 4 ? e7 = { from: n14.from, to: n14.to, insert: s212.state.doc.slice(n14.from, e7.from).append(e7.insert).append(s212.state.doc.slice(e7.to, n14.to)) } : (w9.mac || w9.android) && e7 && e7.from == e7.to && e7.from == n14.head - 1 && /^\. ?$/.test(e7.insert.toString()) && s212.contentDOM.getAttribute("autocorrect") == "off" ? (i12 && e7.insert.length == 2 && (i12 = x7.single(i12.main.anchor - 1, i12.main.head - 1)), e7 = { from: n14.from, to: n14.to, insert: m5.of([" "]) }) : w9.chrome && e7 && e7.from == e7.to && e7.from == n14.head && e7.insert.toString() == `
 ` && s212.lineWrapping && (i12 && (i12 = x7.single(i12.main.anchor - 1, i12.main.head - 1)), e7 = { from: n14.from, to: n14.to, insert: m5.of([" "]) }), e7) {
    if (w9.ios && s212.inputState.flushIOSKey() || w9.android && (e7.from == n14.from && e7.to == n14.to && e7.insert.length == 1 && e7.insert.lines == 2 && wt4(s212.contentDOM, "Enter", 13) || (e7.from == n14.from - 1 && e7.to == n14.to && e7.insert.length == 0 || r2 == 8 && e7.insert.length < e7.to - e7.from && e7.to > n14.head) && wt4(s212.contentDOM, "Backspace", 8) || e7.from == n14.from && e7.to == n14.to + 1 && e7.insert.length == 0 && wt4(s212.contentDOM, "Delete", 46))) return true;
    let o = e7.insert.toString();
    s212.inputState.composing >= 0 && s212.inputState.composing++;
    let l11, h3 = () => l11 || (l11 = qr2(s212, e7, i12));
    return s212.state.facet(Is5).some((c3) => c3(s212, e7.from, e7.to, o, h3)) || s212.dispatch(h3()), true;
  } else if (i12 && !i12.main.eq(n14)) {
    let o = false, l11 = "select";
    return s212.inputState.lastSelectionTime > Date.now() - 50 && (s212.inputState.lastSelectionOrigin == "select" && (o = true), l11 = s212.inputState.lastSelectionOrigin), s212.dispatch({ selection: i12, scrollIntoView: o, userEvent: l11 }), true;
  } else return false;
}
function qr2(s212, t8, e7) {
  let i12, n14 = s212.state, r2 = n14.selection.main;
  if (t8.from >= r2.from && t8.to <= r2.to && t8.to - t8.from >= (r2.to - r2.from) / 3 && (!e7 || e7.main.empty && e7.main.from == t8.from + t8.insert.length) && s212.inputState.composing < 0) {
    let l11 = r2.from < t8.from ? n14.sliceDoc(r2.from, t8.from) : "", h3 = r2.to > t8.to ? n14.sliceDoc(t8.to, r2.to) : "";
    i12 = n14.replaceSelection(s212.state.toText(l11 + t8.insert.sliceString(0, void 0, s212.state.lineBreak) + h3));
  } else {
    let l11 = n14.changes(t8), h3 = e7 && e7.main.to <= l11.newLength ? e7.main : void 0;
    if (n14.selection.ranges.length > 1 && s212.inputState.composing >= 0 && t8.to <= r2.to && t8.to >= r2.to - 10) {
      let c3 = s212.state.sliceDoc(t8.from, t8.to), a2, f6 = e7 && sn6(s212, e7.main.head);
      if (f6) {
        let g8 = t8.insert.length - (t8.to - t8.from);
        a2 = { from: f6.from, to: f6.to - g8 };
      } else a2 = s212.state.doc.lineAt(r2.head);
      let d4 = r2.to - t8.to, u3 = r2.to - r2.from;
      i12 = n14.changeByRange((g8) => {
        if (g8.from == r2.from && g8.to == r2.to) return { changes: l11, range: h3 || g8.map(l11) };
        let m11 = g8.to - d4, p3 = m11 - c3.length;
        if (g8.to - g8.from != u3 || s212.state.sliceDoc(p3, m11) != c3 || g8.to >= a2.from && g8.from <= a2.to) return { range: g8 };
        let b12 = n14.changes({ from: p3, to: m11, insert: t8.insert }), v10 = g8.to - r2.to;
        return { changes: b12, range: h3 ? x7.range(Math.max(0, h3.anchor + v10), Math.max(0, h3.head + v10)) : g8.map(b12) };
      });
    } else i12 = { changes: l11, selection: h3 && n14.selection.replaceRange(h3) };
  }
  let o = "input.type";
  return (s212.composing || s212.inputState.compositionPendingChange && s212.inputState.compositionEndedAt > Date.now() - 50) && (s212.inputState.compositionPendingChange = false, o += ".compose", s212.inputState.compositionFirstChange && (o += ".start", s212.inputState.compositionFirstChange = false)), n14.update(i12, { userEvent: o, scrollIntoView: true });
}
function jr5(s212, t8, e7, i12) {
  let n14 = Math.min(s212.length, t8.length), r2 = 0;
  for (; r2 < n14 && s212.charCodeAt(r2) == t8.charCodeAt(r2); ) r2++;
  if (r2 == n14 && s212.length == t8.length) return null;
  let o = s212.length, l11 = t8.length;
  for (; o > 0 && l11 > 0 && s212.charCodeAt(o - 1) == t8.charCodeAt(l11 - 1); ) o--, l11--;
  if (i12 == "end") {
    let h3 = Math.max(0, r2 - Math.min(o, l11));
    e7 -= o + h3 - r2;
  }
  if (o < r2 && s212.length < t8.length) {
    let h3 = e7 <= r2 && e7 >= o ? r2 - e7 : 0;
    r2 -= h3, l11 = r2 + (l11 - o), o = r2;
  } else if (l11 < r2) {
    let h3 = e7 <= r2 && e7 >= l11 ? r2 - e7 : 0;
    r2 -= h3, o = r2 + (o - l11), l11 = r2;
  }
  return { from: r2, toA: o, toB: l11 };
}
function Yr4(s212) {
  let t8 = [];
  if (s212.root.activeElement != s212.contentDOM) return t8;
  let { anchorNode: e7, anchorOffset: i12, focusNode: n14, focusOffset: r2 } = s212.observer.selectionRange;
  return e7 && (t8.push(new Ce7(e7, i12)), (n14 != e7 || r2 != i12) && t8.push(new Ce7(n14, r2))), t8;
}
function _r5(s212, t8) {
  if (s212.length == 0) return null;
  let e7 = s212[0].pos, i12 = s212.length == 2 ? s212[1].pos : e7;
  return e7 > -1 && i12 > -1 ? x7.single(e7 + t8, i12 + t8) : null;
}
var Xr5 = { childList: true, characterData: true, subtree: true, attributes: true, characterDataOldValue: true };
var He8 = w9.ie && w9.ie_version <= 11;
var di5 = class {
  constructor(t8) {
    this.view = t8, this.active = false, this.selectionRange = new ze11(), this.selectionChanged = false, this.delayedFlush = -1, this.resizeTimeout = -1, this.queue = [], this.delayedAndroidKey = null, this.flushingAndroidKey = -1, this.lastChange = 0, this.scrollTargets = [], this.intersection = null, this.resizeScroll = null, this.intersecting = false, this.gapIntersection = null, this.gaps = [], this.parentCheck = -1, this.dom = t8.contentDOM, this.observer = new MutationObserver((e7) => {
      for (let i12 of e7) this.queue.push(i12);
      (w9.ie && w9.ie_version <= 11 || w9.ios && t8.composing) && e7.some((i12) => i12.type == "childList" && i12.removedNodes.length || i12.type == "characterData" && i12.oldValue.length > i12.target.nodeValue.length) ? this.flushSoon() : this.flush();
    }), He8 && (this.onCharData = (e7) => {
      this.queue.push({ target: e7.target, type: "characterData", oldValue: e7.prevValue }), this.flushSoon();
    }), this.onSelectionChange = this.onSelectionChange.bind(this), this.onResize = this.onResize.bind(this), this.onPrint = this.onPrint.bind(this), this.onScroll = this.onScroll.bind(this), typeof ResizeObserver == "function" && (this.resizeScroll = new ResizeObserver(() => {
      var e7;
      ((e7 = this.view.docView) === null || e7 === void 0 ? void 0 : e7.lastUpdate) < Date.now() - 75 && this.onResize();
    }), this.resizeScroll.observe(t8.scrollDOM)), this.addWindowListeners(this.win = t8.win), this.start(), typeof IntersectionObserver == "function" && (this.intersection = new IntersectionObserver((e7) => {
      this.parentCheck < 0 && (this.parentCheck = setTimeout(this.listenForScroll.bind(this), 1e3)), e7.length > 0 && e7[e7.length - 1].intersectionRatio > 0 != this.intersecting && (this.intersecting = !this.intersecting, this.intersecting != this.view.inView && this.onScrollChanged(document.createEvent("Event")));
    }, { threshold: [0, 1e-3] }), this.intersection.observe(this.dom), this.gapIntersection = new IntersectionObserver((e7) => {
      e7.length > 0 && e7[e7.length - 1].intersectionRatio > 0 && this.onScrollChanged(document.createEvent("Event"));
    }, {})), this.listenForScroll(), this.readSelectionRange();
  }
  onScrollChanged(t8) {
    this.view.inputState.runHandlers("scroll", t8), this.intersecting && this.view.measure();
  }
  onScroll(t8) {
    this.intersecting && this.flush(false), this.onScrollChanged(t8);
  }
  onResize() {
    this.resizeTimeout < 0 && (this.resizeTimeout = setTimeout(() => {
      this.resizeTimeout = -1, this.view.requestMeasure();
    }, 50));
  }
  onPrint() {
    this.view.viewState.printing = true, this.view.measure(), setTimeout(() => {
      this.view.viewState.printing = false, this.view.requestMeasure();
    }, 500);
  }
  updateGaps(t8) {
    if (this.gapIntersection && (t8.length != this.gaps.length || this.gaps.some((e7, i12) => e7 != t8[i12]))) {
      this.gapIntersection.disconnect();
      for (let e7 of t8) this.gapIntersection.observe(e7);
      this.gaps = t8;
    }
  }
  onSelectionChange(t8) {
    let e7 = this.selectionChanged;
    if (!this.readSelectionRange() || this.delayedAndroidKey) return;
    let { view: i12 } = this, n14 = this.selectionRange;
    if (i12.state.facet(Re9) ? i12.root.activeElement != this.dom : !re9(i12.dom, n14)) return;
    let r2 = n14.anchorNode && i12.docView.nearest(n14.anchorNode);
    if (r2 && r2.ignoreEvent(t8)) {
      e7 || (this.selectionChanged = false);
      return;
    }
    (w9.ie && w9.ie_version <= 11 || w9.android && w9.chrome) && !i12.state.selection.main.empty && n14.focusNode && ue11(n14.focusNode, n14.focusOffset, n14.anchorNode, n14.anchorOffset) ? this.flushSoon() : this.flush(false);
  }
  readSelectionRange() {
    let { view: t8 } = this, e7 = w9.safari && t8.root.nodeType == 11 && zn5(this.dom.ownerDocument) == this.dom && Gr5(this.view) || de9(t8.root);
    if (!e7 || this.selectionRange.eq(e7)) return false;
    let i12 = re9(this.dom, e7);
    return i12 && !this.selectionChanged && t8.inputState.lastFocusTime > Date.now() - 200 && t8.inputState.lastTouchTime < Date.now() - 300 && Yn4(this.dom, e7) ? (this.view.inputState.lastFocusTime = 0, t8.docView.updateSelection(), false) : (this.selectionRange.setRange(e7), i12 && (this.selectionChanged = true), true);
  }
  setSelectionRange(t8, e7) {
    this.selectionRange.set(t8.node, t8.offset, e7.node, e7.offset), this.selectionChanged = false;
  }
  clearSelectionRange() {
    this.selectionRange.set(null, 0, null, 0);
  }
  listenForScroll() {
    this.parentCheck = -1;
    let t8 = 0, e7 = null;
    for (let i12 = this.dom; i12; ) if (i12.nodeType == 1) !e7 && t8 < this.scrollTargets.length && this.scrollTargets[t8] == i12 ? t8++ : e7 || (e7 = this.scrollTargets.slice(0, t8)), e7 && e7.push(i12), i12 = i12.assignedSlot || i12.parentNode;
    else if (i12.nodeType == 11) i12 = i12.host;
    else break;
    if (t8 < this.scrollTargets.length && !e7 && (e7 = this.scrollTargets.slice(0, t8)), e7) {
      for (let i12 of this.scrollTargets) i12.removeEventListener("scroll", this.onScroll);
      for (let i12 of this.scrollTargets = e7) i12.addEventListener("scroll", this.onScroll);
    }
  }
  ignore(t8) {
    if (!this.active) return t8();
    try {
      return this.stop(), t8();
    } finally {
      this.start(), this.clear();
    }
  }
  start() {
    this.active || (this.observer.observe(this.dom, Xr5), He8 && this.dom.addEventListener("DOMCharacterDataModified", this.onCharData), this.active = true);
  }
  stop() {
    this.active && (this.active = false, this.observer.disconnect(), He8 && this.dom.removeEventListener("DOMCharacterDataModified", this.onCharData));
  }
  clear() {
    this.processRecords(), this.queue.length = 0, this.selectionChanged = false;
  }
  delayAndroidKey(t8, e7) {
    var i12;
    if (!this.delayedAndroidKey) {
      let n14 = () => {
        let r2 = this.delayedAndroidKey;
        r2 && (this.clearDelayedAndroidKey(), this.view.inputState.lastKeyCode = r2.keyCode, this.view.inputState.lastKeyTime = Date.now(), !this.flush() && r2.force && wt4(this.dom, r2.key, r2.keyCode));
      };
      this.flushingAndroidKey = this.view.win.requestAnimationFrame(n14);
    }
    (!this.delayedAndroidKey || t8 == "Enter") && (this.delayedAndroidKey = { key: t8, keyCode: e7, force: this.lastChange < Date.now() - 50 || !!(!((i12 = this.delayedAndroidKey) === null || i12 === void 0) && i12.force) });
  }
  clearDelayedAndroidKey() {
    this.win.cancelAnimationFrame(this.flushingAndroidKey), this.delayedAndroidKey = null, this.flushingAndroidKey = -1;
  }
  flushSoon() {
    this.delayedFlush < 0 && (this.delayedFlush = this.view.win.requestAnimationFrame(() => {
      this.delayedFlush = -1, this.flush();
    }));
  }
  forceFlush() {
    this.delayedFlush >= 0 && (this.view.win.cancelAnimationFrame(this.delayedFlush), this.delayedFlush = -1), this.flush();
  }
  pendingRecords() {
    for (let t8 of this.observer.takeRecords()) this.queue.push(t8);
    return this.queue;
  }
  processRecords() {
    let t8 = this.pendingRecords();
    t8.length && (this.queue = []);
    let e7 = -1, i12 = -1, n14 = false;
    for (let r2 of t8) {
      let o = this.readMutation(r2);
      o && (o.typeOver && (n14 = true), e7 == -1 ? { from: e7, to: i12 } = o : (e7 = Math.min(o.from, e7), i12 = Math.max(o.to, i12)));
    }
    return { from: e7, to: i12, typeOver: n14 };
  }
  readChange() {
    let { from: t8, to: e7, typeOver: i12 } = this.processRecords(), n14 = this.selectionChanged && re9(this.dom, this.selectionRange);
    if (t8 < 0 && !n14) return null;
    t8 > -1 && (this.lastChange = Date.now()), this.view.inputState.lastFocusTime = 0, this.selectionChanged = false;
    let r2 = new fi5(this.view, t8, e7, i12);
    return this.view.docView.domChanged = { newSel: r2.newSel ? r2.newSel.main : null }, r2;
  }
  flush(t8 = true) {
    if (this.delayedFlush >= 0 || this.delayedAndroidKey) return false;
    t8 && this.readSelectionRange();
    let e7 = this.readChange();
    if (!e7) return this.view.requestMeasure(), false;
    let i12 = this.view.state, n14 = wn5(this.view, e7);
    return this.view.state == i12 && this.view.update([]), n14;
  }
  readMutation(t8) {
    let e7 = this.view.docView.nearest(t8.target);
    if (!e7 || e7.ignoreMutation(t8)) return null;
    if (e7.markDirty(t8.type == "attributes"), t8.type == "attributes" && (e7.flags |= 4), t8.type == "childList") {
      let i12 = ns5(e7, t8.previousSibling || t8.target.previousSibling, -1), n14 = ns5(e7, t8.nextSibling || t8.target.nextSibling, 1);
      return { from: i12 ? e7.posAfter(i12) : e7.posAtStart, to: n14 ? e7.posBefore(n14) : e7.posAtEnd, typeOver: false };
    } else return t8.type == "characterData" ? { from: e7.posAtStart, to: e7.posAtEnd, typeOver: t8.target.nodeValue == t8.oldValue } : null;
  }
  setWindow(t8) {
    t8 != this.win && (this.removeWindowListeners(this.win), this.win = t8, this.addWindowListeners(this.win));
  }
  addWindowListeners(t8) {
    t8.addEventListener("resize", this.onResize), t8.addEventListener("beforeprint", this.onPrint), t8.addEventListener("scroll", this.onScroll), t8.document.addEventListener("selectionchange", this.onSelectionChange);
  }
  removeWindowListeners(t8) {
    t8.removeEventListener("scroll", this.onScroll), t8.removeEventListener("resize", this.onResize), t8.removeEventListener("beforeprint", this.onPrint), t8.document.removeEventListener("selectionchange", this.onSelectionChange);
  }
  destroy() {
    var t8, e7, i12;
    this.stop(), (t8 = this.intersection) === null || t8 === void 0 || t8.disconnect(), (e7 = this.gapIntersection) === null || e7 === void 0 || e7.disconnect(), (i12 = this.resizeScroll) === null || i12 === void 0 || i12.disconnect();
    for (let n14 of this.scrollTargets) n14.removeEventListener("scroll", this.onScroll);
    this.removeWindowListeners(this.win), clearTimeout(this.parentCheck), clearTimeout(this.resizeTimeout), this.win.cancelAnimationFrame(this.delayedFlush), this.win.cancelAnimationFrame(this.flushingAndroidKey);
  }
};
function ns5(s212, t8, e7) {
  for (; t8; ) {
    let i12 = O12.get(t8);
    if (i12 && i12.parent == s212) return i12;
    let n14 = t8.parentNode;
    t8 = n14 != s212.dom ? n14 : e7 > 0 ? t8.nextSibling : t8.previousSibling;
  }
  return null;
}
function Gr5(s212) {
  let t8 = null;
  function e7(h3) {
    h3.preventDefault(), h3.stopImmediatePropagation(), t8 = h3.getTargetRanges()[0];
  }
  if (s212.contentDOM.addEventListener("beforeinput", e7, true), s212.dom.ownerDocument.execCommand("indent"), s212.contentDOM.removeEventListener("beforeinput", e7, true), !t8) return null;
  let i12 = t8.startContainer, n14 = t8.startOffset, r2 = t8.endContainer, o = t8.endOffset, l11 = s212.docView.domAtPos(s212.state.selection.main.anchor);
  return ue11(l11.node, l11.offset, r2, o) && ([i12, n14, r2, o] = [r2, o, i12, n14]), { anchorNode: i12, anchorOffset: n14, focusNode: r2, focusOffset: o };
}
var A11 = class s181 {
  get state() {
    return this.viewState.state;
  }
  get viewport() {
    return this.viewState.viewport;
  }
  get visibleRanges() {
    return this.viewState.visibleRanges;
  }
  get inView() {
    return this.viewState.inView;
  }
  get composing() {
    return this.inputState.composing > 0;
  }
  get compositionStarted() {
    return this.inputState.composing >= 0;
  }
  get root() {
    return this._root;
  }
  get win() {
    return this.dom.ownerDocument.defaultView || window;
  }
  constructor(t8 = {}) {
    this.plugins = [], this.pluginMap = /* @__PURE__ */ new Map(), this.editorAttrs = {}, this.contentAttrs = {}, this.bidiCache = [], this.destroyed = false, this.updateState = 2, this.measureScheduled = -1, this.measureRequests = [], this.contentDOM = document.createElement("div"), this.scrollDOM = document.createElement("div"), this.scrollDOM.tabIndex = -1, this.scrollDOM.className = "cm-scroller", this.scrollDOM.appendChild(this.contentDOM), this.announceDOM = document.createElement("div"), this.announceDOM.style.cssText = "position: fixed; top: -10000px", this.announceDOM.setAttribute("aria-live", "polite"), this.dom = document.createElement("div"), this.dom.appendChild(this.announceDOM), this.dom.appendChild(this.scrollDOM);
    let { dispatch: e7 } = t8;
    this.dispatchTransactions = t8.dispatchTransactions || e7 && ((i12) => i12.forEach((n14) => e7(n14, this))) || ((i12) => this.update(i12)), this.dispatch = this.dispatch.bind(this), this._root = t8.root || jn3(t8.parent) || document, this.viewState = new Se8(t8.state || I11.create(t8)), t8.scrollTo && t8.scrollTo.is(Zt7) && (this.viewState.scrollTarget = t8.scrollTo.value.clip(this.viewState.state)), this.plugins = this.state.facet(kt3).map((i12) => new Et8(i12));
    for (let i12 of this.plugins) i12.update(this);
    this.observer = new di5(this), this.inputState = new Qe8(this), this.inputState.ensureHandlers(this.plugins), this.docView = new be12(this), this.mountStyles(), this.updateAttrs(), this.updateState = 0, this.requestMeasure(), t8.parent && t8.parent.appendChild(this.dom);
  }
  dispatch(...t8) {
    let e7 = t8.length == 1 && t8[0] instanceof S10 ? t8 : t8.length == 1 && Array.isArray(t8[0]) ? t8[0] : [this.state.update(...t8)];
    this.dispatchTransactions(e7, this);
  }
  update(t8) {
    if (this.updateState != 0) throw new Error("Calls to EditorView.update are not allowed while an update is in progress");
    let e7 = false, i12 = false, n14, r2 = this.state;
    for (let d4 of t8) {
      if (d4.startState != r2) throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");
      r2 = d4.state;
    }
    if (this.destroyed) {
      this.viewState.state = r2;
      return;
    }
    let o = this.hasFocus, l11 = 0, h3 = null;
    t8.some((d4) => d4.annotation(dn5)) ? (this.inputState.notifiedFocused = o, l11 = 1) : o != this.inputState.notifiedFocused && (this.inputState.notifiedFocused = o, h3 = un6(r2, o), h3 || (l11 = 1));
    let c3 = this.observer.delayedAndroidKey, a2 = null;
    if (c3 ? (this.observer.clearDelayedAndroidKey(), a2 = this.observer.readChange(), (a2 && !this.state.doc.eq(r2.doc) || !this.state.selection.eq(r2.selection)) && (a2 = null)) : this.observer.clear(), r2.facet(I11.phrases) != this.state.facet(I11.phrases)) return this.setState(r2);
    n14 = me12.create(this, r2, t8), n14.flags |= l11;
    let f6 = this.viewState.scrollTarget;
    try {
      this.updateState = 2;
      for (let d4 of t8) {
        if (f6 && (f6 = f6.map(d4.changes)), d4.scrollIntoView) {
          let { main: u3 } = d4.state.selection;
          f6 = new Bt7(u3.empty ? u3 : x7.cursor(u3.head, u3.head > u3.anchor ? -1 : 1));
        }
        for (let u3 of d4.effects) u3.is(Zt7) && (f6 = u3.value.clip(this.state));
      }
      this.viewState.update(n14, f6), this.bidiCache = Me11.update(this.bidiCache, n14.changes), n14.empty || (this.updatePlugins(n14), this.inputState.update(n14)), e7 = this.docView.update(n14), this.state.facet(At8) != this.styleModules && this.mountStyles(), i12 = this.updateAttrs(), this.showAnnouncements(t8), this.docView.updateSelection(e7, t8.some((d4) => d4.isUserEvent("select.pointer")));
    } finally {
      this.updateState = 0;
    }
    if (n14.startState.facet(se8) != n14.state.facet(se8) && (this.viewState.mustMeasureContent = true), (e7 || i12 || f6 || this.viewState.mustEnforceCursorAssoc || this.viewState.mustMeasureContent) && this.requestMeasure(), !n14.empty) for (let d4 of this.state.facet(Xe9)) try {
      d4(n14);
    } catch (u3) {
      it6(this.state, u3, "update listener");
    }
    (h3 || a2) && Promise.resolve().then(() => {
      h3 && this.state == h3.startState && this.dispatch(h3), a2 && !wn5(this, a2) && c3.force && wt4(this.contentDOM, c3.key, c3.keyCode);
    });
  }
  setState(t8) {
    if (this.updateState != 0) throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");
    if (this.destroyed) {
      this.viewState.state = t8;
      return;
    }
    this.updateState = 2;
    let e7 = this.hasFocus;
    try {
      for (let i12 of this.plugins) i12.destroy(this);
      this.viewState = new Se8(t8), this.plugins = t8.facet(kt3).map((i12) => new Et8(i12)), this.pluginMap.clear();
      for (let i12 of this.plugins) i12.update(this);
      this.docView = new be12(this), this.inputState.ensureHandlers(this.plugins), this.mountStyles(), this.updateAttrs(), this.bidiCache = [];
    } finally {
      this.updateState = 0;
    }
    e7 && this.focus(), this.requestMeasure();
  }
  updatePlugins(t8) {
    let e7 = t8.startState.facet(kt3), i12 = t8.state.facet(kt3);
    if (e7 != i12) {
      let n14 = [];
      for (let r2 of i12) {
        let o = e7.indexOf(r2);
        if (o < 0) n14.push(new Et8(r2));
        else {
          let l11 = this.plugins[o];
          l11.mustUpdate = t8, n14.push(l11);
        }
      }
      for (let r2 of this.plugins) r2.mustUpdate != t8 && r2.destroy(this);
      this.plugins = n14, this.pluginMap.clear();
    } else for (let n14 of this.plugins) n14.mustUpdate = t8;
    for (let n14 = 0; n14 < this.plugins.length; n14++) this.plugins[n14].update(this);
    e7 != i12 && this.inputState.ensureHandlers(this.plugins);
  }
  measure(t8 = true) {
    if (this.destroyed) return;
    if (this.measureScheduled > -1 && this.win.cancelAnimationFrame(this.measureScheduled), this.observer.delayedAndroidKey) {
      this.measureScheduled = -1, this.requestMeasure();
      return;
    }
    this.measureScheduled = 0, t8 && this.observer.forceFlush();
    let e7 = null, i12 = this.scrollDOM, n14 = i12.scrollTop * this.scaleY, { scrollAnchorPos: r2, scrollAnchorHeight: o } = this.viewState;
    Math.abs(n14 - this.viewState.scrollTop) > 1 && (o = -1), this.viewState.scrollAnchorHeight = -1;
    try {
      for (let l11 = 0; ; l11++) {
        if (o < 0) if (Ts5(i12)) r2 = -1, o = this.viewState.heightMap.height;
        else {
          let u3 = this.viewState.scrollAnchorAt(n14);
          r2 = u3.from, o = u3.top;
        }
        this.updateState = 1;
        let h3 = this.viewState.measure(this);
        if (!h3 && !this.measureRequests.length && this.viewState.scrollTarget == null) break;
        if (l11 > 5) {
          console.warn(this.measureRequests.length ? "Measure loop restarted more than 5 times" : "Viewport failed to stabilize");
          break;
        }
        let c3 = [];
        h3 & 4 || ([this.measureRequests, c3] = [c3, this.measureRequests]);
        let a2 = c3.map((u3) => {
          try {
            return u3.read(this);
          } catch (g8) {
            return it6(this.state, g8), rs5;
          }
        }), f6 = me12.create(this, this.state, []), d4 = false;
        f6.flags |= h3, e7 ? e7.flags |= h3 : e7 = f6, this.updateState = 2, f6.empty || (this.updatePlugins(f6), this.inputState.update(f6), this.updateAttrs(), d4 = this.docView.update(f6));
        for (let u3 = 0; u3 < c3.length; u3++) if (a2[u3] != rs5) try {
          let g8 = c3[u3];
          g8.write && g8.write(a2[u3], this);
        } catch (g8) {
          it6(this.state, g8);
        }
        if (d4 && this.docView.updateSelection(true), !f6.viewportChanged && this.measureRequests.length == 0) {
          if (this.viewState.editorHeight) if (this.viewState.scrollTarget) {
            this.docView.scrollIntoView(this.viewState.scrollTarget), this.viewState.scrollTarget = null;
            continue;
          } else {
            let g8 = (r2 < 0 ? this.viewState.heightMap.height : this.viewState.lineBlockAt(r2).top) - o;
            if (g8 > 1 || g8 < -1) {
              n14 = n14 + g8, i12.scrollTop = n14 / this.scaleY, o = -1;
              continue;
            }
          }
          break;
        }
      }
    } finally {
      this.updateState = 0, this.measureScheduled = -1;
    }
    if (e7 && !e7.empty) for (let l11 of this.state.facet(Xe9)) l11(e7);
  }
  get themeClasses() {
    return hi5 + " " + (this.state.facet(li5) ? mn5 : pn6) + " " + this.state.facet(se8);
  }
  updateAttrs() {
    let t8 = os5(this, Ys5, { class: "cm-editor" + (this.hasFocus ? " cm-focused " : " ") + this.themeClasses }), e7 = { spellcheck: "false", autocorrect: "off", autocapitalize: "off", translate: "no", contenteditable: this.state.facet(Re9) ? "true" : "false", class: "cm-content", style: `${w9.tabSize}: ${this.state.tabSize}`, role: "textbox", "aria-multiline": "true" };
    this.state.readOnly && (e7["aria-readonly"] = "true"), os5(this, Le10, e7);
    let i12 = this.observer.ignore(() => {
      let n14 = Ye9(this.contentDOM, this.contentAttrs, e7), r2 = Ye9(this.dom, this.editorAttrs, t8);
      return n14 || r2;
    });
    return this.editorAttrs = t8, this.contentAttrs = e7, i12;
  }
  showAnnouncements(t8) {
    let e7 = true;
    for (let i12 of t8) for (let n14 of i12.effects) if (n14.is(s181.announce)) {
      e7 && (this.announceDOM.textContent = ""), e7 = false;
      let r2 = this.announceDOM.appendChild(document.createElement("div"));
      r2.textContent = n14.value;
    }
  }
  mountStyles() {
    this.styleModules = this.state.facet(At8);
    let t8 = this.state.facet(s181.cspNonce);
    b7.mount(this.root, this.styleModules.concat(Ir3).reverse(), t8 ? { nonce: t8 } : void 0);
  }
  readMeasured() {
    if (this.updateState == 2) throw new Error("Reading the editor layout isn't allowed during an update");
    this.updateState == 0 && this.measureScheduled > -1 && this.measure(false);
  }
  requestMeasure(t8) {
    if (this.measureScheduled < 0 && (this.measureScheduled = this.win.requestAnimationFrame(() => this.measure())), t8) {
      if (this.measureRequests.indexOf(t8) > -1) return;
      if (t8.key != null) {
        for (let e7 = 0; e7 < this.measureRequests.length; e7++) if (this.measureRequests[e7].key === t8.key) {
          this.measureRequests[e7] = t8;
          return;
        }
      }
      this.measureRequests.push(t8);
    }
  }
  plugin(t8) {
    let e7 = this.pluginMap.get(t8);
    return (e7 === void 0 || e7 && e7.spec != t8) && this.pluginMap.set(t8, e7 = this.plugins.find((i12) => i12.spec == t8) || null), e7 && e7.update(this).value;
  }
  get documentTop() {
    return this.contentDOM.getBoundingClientRect().top + this.viewState.paddingTop;
  }
  get documentPadding() {
    return { top: this.viewState.paddingTop, bottom: this.viewState.paddingBottom };
  }
  get scaleX() {
    return this.viewState.scaleX;
  }
  get scaleY() {
    return this.viewState.scaleY;
  }
  elementAtHeight(t8) {
    return this.readMeasured(), this.viewState.elementAtHeight(t8);
  }
  lineBlockAtHeight(t8) {
    return this.readMeasured(), this.viewState.lineBlockAtHeight(t8);
  }
  get viewportLineBlocks() {
    return this.viewState.viewportLines;
  }
  lineBlockAt(t8) {
    return this.viewState.lineBlockAt(t8);
  }
  get contentHeight() {
    return this.viewState.contentHeight;
  }
  moveByChar(t8, e7, i12) {
    return Pe11(this, t8, ji2(this, t8, e7, i12));
  }
  moveByGroup(t8, e7) {
    return Pe11(this, t8, ji2(this, t8, e7, (i12) => wr5(this, t8.head, i12)));
  }
  moveToLineBoundary(t8, e7, i12 = true) {
    return br5(this, t8, e7, i12);
  }
  moveVertically(t8, e7, i12) {
    return Pe11(this, t8, yr5(this, t8, e7, i12));
  }
  domAtPos(t8) {
    return this.docView.domAtPos(t8);
  }
  posAtDOM(t8, e7 = 0) {
    return this.docView.posFromDOM(t8, e7);
  }
  posAtCoords(t8, e7 = true) {
    return this.readMeasured(), rn6(this, t8, e7);
  }
  coordsAtPos(t8, e7 = 1) {
    this.readMeasured();
    let i12 = this.docView.coordsAt(t8, e7);
    if (!i12 || i12.left == i12.right) return i12;
    let n14 = this.state.doc.lineAt(t8), r2 = this.bidiSpans(n14), o = r2[X11.find(r2, t8 - n14.from, -1, e7)];
    return Te9(i12, o.dir == B7.LTR == e7 > 0);
  }
  coordsForChar(t8) {
    return this.readMeasured(), this.docView.coordsForChar(t8);
  }
  get defaultCharacterWidth() {
    return this.viewState.heightOracle.charWidth;
  }
  get defaultLineHeight() {
    return this.viewState.heightOracle.lineHeight;
  }
  get textDirection() {
    return this.viewState.defaultTextDirection;
  }
  textDirectionAt(t8) {
    return !this.state.facet(qs5) || t8 < this.viewport.from || t8 > this.viewport.to ? this.textDirection : (this.readMeasured(), this.docView.textDirectionAt(t8));
  }
  get lineWrapping() {
    return this.viewState.heightOracle.lineWrapping;
  }
  bidiSpans(t8) {
    if (t8.length > $r5) return Qs5(t8.length);
    let e7 = this.textDirectionAt(t8.from), i12;
    for (let r2 of this.bidiCache) if (r2.from == t8.from && r2.dir == e7 && (r2.fresh || Js5(r2.isolates, i12 = Fi5(this, t8.from, t8.to)))) return r2.order;
    i12 || (i12 = Fi5(this, t8.from, t8.to));
    let n14 = Zs5(t8.text, e7, i12);
    return this.bidiCache.push(new Me11(t8.from, t8.to, e7, i12, true, n14)), n14;
  }
  get hasFocus() {
    var t8;
    return (this.dom.ownerDocument.hasFocus() || w9.safari && ((t8 = this.inputState) === null || t8 === void 0 ? void 0 : t8.lastContextMenu) > Date.now() - 3e4) && this.root.activeElement == this.contentDOM;
  }
  focus() {
    this.observer.ignore(() => {
      As2(this.contentDOM), this.docView.updateSelection();
    });
  }
  setRoot(t8) {
    this._root != t8 && (this._root = t8, this.observer.setWindow((t8.nodeType == 9 ? t8 : t8.ownerDocument).defaultView || window), this.mountStyles());
  }
  destroy() {
    for (let t8 of this.plugins) t8.destroy(this);
    this.plugins = [], this.inputState.destroy(), this.dom.remove(), this.observer.destroy(), this.measureScheduled > -1 && this.win.cancelAnimationFrame(this.measureScheduled), this.destroyed = true;
  }
  static scrollIntoView(t8, e7 = {}) {
    return Zt7.of(new Bt7(typeof t8 == "number" ? x7.cursor(t8) : t8, e7.y, e7.x, e7.yMargin, e7.xMargin));
  }
  scrollSnapshot() {
    let { scrollTop: t8, scrollLeft: e7 } = this.scrollDOM, i12 = this.viewState.scrollAnchorAt(t8);
    return Zt7.of(new Bt7(x7.cursor(i12.from), "start", "start", i12.top - t8, e7, true));
  }
  static domEventHandlers(t8) {
    return H5.define(() => ({}), { eventHandlers: t8 });
  }
  static domEventObservers(t8) {
    return H5.define(() => ({}), { eventObservers: t8 });
  }
  static theme(t8, e7) {
    let i12 = b7.newName(), n14 = [se8.of(i12), At8.of(ai5(`.${i12}`, t8))];
    return e7 && e7.dark && n14.push(li5.of(true)), n14;
  }
  static baseTheme(t8) {
    return lt8.lowest(At8.of(ai5("." + hi5, t8, bn5)));
  }
  static findFromDOM(t8) {
    var e7;
    let i12 = t8.querySelector(".cm-content"), n14 = i12 && O12.get(i12) || O12.get(t8);
    return ((e7 = n14?.rootView) === null || e7 === void 0 ? void 0 : e7.view) || null;
  }
};
A11.styleModule = At8;
A11.inputHandler = Is5;
A11.focusChangeEffect = Ks5;
A11.perLineTextDirection = qs5;
A11.exceptionSink = zs5;
A11.updateListener = Xe9;
A11.editable = Re9;
A11.mouseSelectionStyle = Fs5;
A11.dragMovesSelection = Ws5;
A11.clickAddsSelectionRange = Vs3;
A11.decorations = Kt7;
A11.atomicRanges = Oi;
A11.bidiIsolatedRanges = _s5;
A11.scrollMargins = Xs5;
A11.darkTheme = li5;
A11.cspNonce = y11.define({ combine: (s212) => s212.length ? s212[0] : "" });
A11.contentAttributes = Le10;
A11.editorAttributes = Ys5;
A11.lineWrapping = A11.contentAttributes.of({ class: "cm-lineWrapping" });
A11.announce = v5.define();
var $r5 = 4096;
var rs5 = {};
var Me11 = class s182 {
  constructor(t8, e7, i12, n14, r2, o) {
    this.from = t8, this.to = e7, this.dir = i12, this.isolates = n14, this.fresh = r2, this.order = o;
  }
  static update(t8, e7) {
    if (e7.empty && !t8.some((r2) => r2.fresh)) return t8;
    let i12 = [], n14 = t8.length ? t8[t8.length - 1].dir : B7.LTR;
    for (let r2 = Math.max(0, t8.length - 10); r2 < t8.length; r2++) {
      let o = t8[r2];
      o.dir == n14 && !e7.touchesRange(o.from, o.to) && i12.push(new s182(e7.mapPos(o.from, 1), e7.mapPos(o.to, -1), o.dir, o.isolates, false, o.order));
    }
    return i12;
  }
};
function os5(s212, t8, e7) {
  for (let i12 = s212.state.facet(t8), n14 = i12.length - 1; n14 >= 0; n14--) {
    let r2 = i12[n14], o = typeof r2 == "function" ? r2(s212) : r2;
    o && je8(o, e7);
  }
  return e7;
}
var Ur5 = w9.mac ? "mac" : w9.windows ? "win" : w9.linux ? "linux" : "key";
function Jr5(s212, t8) {
  let e7 = s212.split(/-(?!$)/), i12 = e7[e7.length - 1];
  i12 == "Space" && (i12 = " ");
  let n14, r2, o, l11;
  for (let h3 = 0; h3 < e7.length - 1; ++h3) {
    let c3 = e7[h3];
    if (/^(cmd|meta|m)$/i.test(c3)) l11 = true;
    else if (/^a(lt)?$/i.test(c3)) n14 = true;
    else if (/^(c|ctrl|control)$/i.test(c3)) r2 = true;
    else if (/^s(hift)?$/i.test(c3)) o = true;
    else if (/^mod$/i.test(c3)) t8 == "mac" ? l11 = true : r2 = true;
    else throw new Error("Unrecognized modifier name: " + c3);
  }
  return n14 && (i12 = "Alt-" + i12), r2 && (i12 = "Ctrl-" + i12), l11 && (i12 = "Meta-" + i12), o && (i12 = "Shift-" + i12), i12;
}
function ne10(s212, t8, e7) {
  return t8.altKey && (s212 = "Alt-" + s212), t8.ctrlKey && (s212 = "Ctrl-" + s212), t8.metaKey && (s212 = "Meta-" + s212), e7 !== false && t8.shiftKey && (s212 = "Shift-" + s212), s212;
}
var Zr5 = lt8.default(A11.domEventHandlers({ keydown(s212, t8) {
  return vn5(yn6(t8.state), s212, t8, "editor");
} }));
var Qr5 = y11.define({ enables: Zr5 });
var ls5 = /* @__PURE__ */ new WeakMap();
function yn6(s212) {
  let t8 = s212.facet(Qr5), e7 = ls5.get(t8);
  return e7 || ls5.set(t8, e7 = eo5(t8.reduce((i12, n14) => i12.concat(n14), []))), e7;
}
function Ko5(s212, t8, e7) {
  return vn5(yn6(s212.state), t8, s212, e7);
}
var et6 = null;
var to4 = 4e3;
function eo5(s212, t8 = Ur5) {
  let e7 = /* @__PURE__ */ Object.create(null), i12 = /* @__PURE__ */ Object.create(null), n14 = (o, l11) => {
    let h3 = i12[o];
    if (h3 == null) i12[o] = l11;
    else if (h3 != l11) throw new Error("Key binding " + o + " is used both as a regular binding and as a multi-stroke prefix");
  }, r2 = (o, l11, h3, c3, a2) => {
    var f6, d4;
    let u3 = e7[o] || (e7[o] = /* @__PURE__ */ Object.create(null)), g8 = l11.split(/ (?!$)/).map((b12) => Jr5(b12, t8));
    for (let b12 = 1; b12 < g8.length; b12++) {
      let v10 = g8.slice(0, b12).join(" ");
      n14(v10, true), u3[v10] || (u3[v10] = { preventDefault: true, stopPropagation: false, run: [(S17) => {
        let y18 = et6 = { view: S17, prefix: v10, scope: o };
        return setTimeout(() => {
          et6 == y18 && (et6 = null);
        }, to4), true;
      }] });
    }
    let m11 = g8.join(" ");
    n14(m11, false);
    let p3 = u3[m11] || (u3[m11] = { preventDefault: false, stopPropagation: false, run: ((d4 = (f6 = u3._any) === null || f6 === void 0 ? void 0 : f6.run) === null || d4 === void 0 ? void 0 : d4.slice()) || [] });
    h3 && p3.run.push(h3), c3 && (p3.preventDefault = true), a2 && (p3.stopPropagation = true);
  };
  for (let o of s212) {
    let l11 = o.scope ? o.scope.split(" ") : ["editor"];
    if (o.any) for (let c3 of l11) {
      let a2 = e7[c3] || (e7[c3] = /* @__PURE__ */ Object.create(null));
      a2._any || (a2._any = { preventDefault: false, stopPropagation: false, run: [] });
      for (let f6 in a2) a2[f6].run.push(o.any);
    }
    let h3 = o[t8] || o.key;
    if (h3) for (let c3 of l11) r2(c3, h3, o.run, o.preventDefault, o.stopPropagation), o.shift && r2(c3, "Shift-" + h3, o.shift, o.preventDefault, o.stopPropagation);
  }
  return e7;
}
function vn5(s212, t8, e7, i12) {
  let n14 = g2(t8), r2 = he10(n14, 0), o = be11(r2) == n14.length && n14 != " ", l11 = "", h3 = false, c3 = false, a2 = false;
  et6 && et6.view == e7 && et6.scope == i12 && (l11 = et6.prefix + " ", ln6.indexOf(t8.keyCode) < 0 && (c3 = true, et6 = null));
  let f6 = /* @__PURE__ */ new Set(), d4 = (p3) => {
    if (p3) {
      for (let b12 of p3.run) if (!f6.has(b12) && (f6.add(b12), b12(e7, t8))) return p3.stopPropagation && (a2 = true), true;
      p3.preventDefault && (p3.stopPropagation && (a2 = true), c3 = true);
    }
    return false;
  }, u3 = s212[i12], g8, m11;
  return u3 && (d4(u3[l11 + ne10(n14, t8, !o)]) ? h3 = true : o && (t8.altKey || t8.metaKey || t8.ctrlKey) && !(w9.windows && t8.ctrlKey && t8.altKey) && (g8 = t[t8.keyCode]) && g8 != n14 ? (d4(u3[l11 + ne10(g8, t8, true)]) || t8.shiftKey && (m11 = i[t8.keyCode]) != n14 && m11 != g8 && d4(u3[l11 + ne10(m11, t8, false)])) && (h3 = true) : o && t8.shiftKey && d4(u3[l11 + ne10(n14, t8, true)]) && (h3 = true), !h3 && d4(u3._any) && (h3 = true)), c3 && (h3 = true), h3 && a2 && t8.stopPropagation(), h3;
}
var jt7 = class s183 {
  constructor(t8, e7, i12, n14, r2) {
    this.className = t8, this.left = e7, this.top = i12, this.width = n14, this.height = r2;
  }
  draw() {
    let t8 = document.createElement("div");
    return t8.className = this.className, this.adjust(t8), t8;
  }
  update(t8, e7) {
    return e7.className != this.className ? false : (this.adjust(t8), true);
  }
  adjust(t8) {
    t8.style.left = this.left + "px", t8.style.top = this.top + "px", this.width != null && (t8.style.width = this.width + "px"), t8.style.height = this.height + "px";
  }
  eq(t8) {
    return this.left == t8.left && this.top == t8.top && this.width == t8.width && this.height == t8.height && this.className == t8.className;
  }
  static forRange(t8, e7, i12) {
    if (i12.empty) {
      let n14 = t8.coordsAtPos(i12.head, i12.assoc || 1);
      if (!n14) return [];
      let r2 = xn5(t8);
      return [new s183(e7, n14.left - r2.left, n14.top - r2.top, null, n14.bottom - n14.top)];
    } else return io5(t8, e7, i12);
  }
};
function xn5(s212) {
  let t8 = s212.scrollDOM.getBoundingClientRect();
  return { left: (s212.textDirection == B7.LTR ? t8.left : t8.right - s212.scrollDOM.clientWidth * s212.scaleX) - s212.scrollDOM.scrollLeft * s212.scaleX, top: t8.top - s212.scrollDOM.scrollTop * s212.scaleY };
}
function hs5(s212, t8, e7) {
  let i12 = x7.cursor(t8);
  return { from: Math.max(e7.from, s212.moveToLineBoundary(i12, false, true).from), to: Math.min(e7.to, s212.moveToLineBoundary(i12, true, true).from), type: V14.Text };
}
function io5(s212, t8, e7) {
  if (e7.to <= s212.viewport.from || e7.from >= s212.viewport.to) return [];
  let i12 = Math.max(e7.from, s212.viewport.from), n14 = Math.min(e7.to, s212.viewport.to), r2 = s212.textDirection == B7.LTR, o = s212.contentDOM, l11 = o.getBoundingClientRect(), h3 = xn5(s212), c3 = o.querySelector(".cm-line"), a2 = c3 && window.getComputedStyle(c3), f6 = l11.left + (a2 ? parseInt(a2.paddingLeft) + Math.min(0, parseInt(a2.textIndent)) : 0), d4 = l11.right - (a2 ? parseInt(a2.paddingRight) : 0), u3 = Ze10(s212, i12), g8 = Ze10(s212, n14), m11 = u3.type == V14.Text ? u3 : null, p3 = g8.type == V14.Text ? g8 : null;
  if (m11 && (s212.lineWrapping || u3.widgetLineBreaks) && (m11 = hs5(s212, i12, m11)), p3 && (s212.lineWrapping || g8.widgetLineBreaks) && (p3 = hs5(s212, n14, p3)), m11 && p3 && m11.from == p3.from) return v10(S17(e7.from, e7.to, m11));
  {
    let x11 = m11 ? S17(e7.from, null, m11) : y18(u3, false), C11 = p3 ? S17(null, e7.to, p3) : y18(g8, true), L19 = [];
    return (m11 || u3).to < (p3 || g8).from - (m11 && p3 ? 1 : 0) || u3.widgetLineBreaks > 1 && x11.bottom + s212.defaultLineHeight / 2 < C11.top ? L19.push(b12(f6, x11.bottom, d4, C11.top)) : x11.bottom < C11.top && s212.elementAtHeight((x11.bottom + C11.top) / 2).type == V14.Text && (x11.bottom = C11.top = (x11.bottom + C11.top) / 2), v10(x11).concat(L19).concat(v10(C11));
  }
  function b12(x11, C11, L19, E11) {
    return new jt7(t8, x11 - h3.left, C11 - h3.top - 0.01, L19 - x11, E11 - C11 + 0.01);
  }
  function v10({ top: x11, bottom: C11, horizontal: L19 }) {
    let E11 = [];
    for (let Q20 = 0; Q20 < L19.length; Q20 += 2) E11.push(b12(L19[Q20], x11, L19[Q20 + 1], C11));
    return E11;
  }
  function S17(x11, C11, L19) {
    let E11 = 1e9, Q20 = -1e9, Gt8 = [];
    function Li5(ht13, tt10, ft8, at13, Ct6) {
      let U21 = s212.coordsAtPos(ht13, ht13 == L19.to ? -2 : 2), J15 = s212.coordsAtPos(ft8, ft8 == L19.from ? 2 : -2);
      !U21 || !J15 || (E11 = Math.min(U21.top, J15.top, E11), Q20 = Math.max(U21.bottom, J15.bottom, Q20), Ct6 == B7.LTR ? Gt8.push(r2 && tt10 ? f6 : U21.left, r2 && at13 ? d4 : J15.right) : Gt8.push(!r2 && at13 ? f6 : J15.left, !r2 && tt10 ? d4 : U21.right));
    }
    let $t12 = x11 ?? L19.from, Ut11 = C11 ?? L19.to;
    for (let ht13 of s212.visibleRanges) if (ht13.to > $t12 && ht13.from < Ut11) for (let tt10 = Math.max(ht13.from, $t12), ft8 = Math.min(ht13.to, Ut11); ; ) {
      let at13 = s212.state.doc.lineAt(tt10);
      for (let Ct6 of s212.bidiSpans(at13)) {
        let U21 = Ct6.from + at13.from, J15 = Ct6.to + at13.from;
        if (U21 >= ft8) break;
        J15 > tt10 && Li5(Math.max(U21, tt10), x11 == null && U21 <= $t12, Math.min(J15, ft8), C11 == null && J15 >= Ut11, Ct6.dir);
      }
      if (tt10 = at13.to + 1, tt10 >= ft8) break;
    }
    return Gt8.length == 0 && Li5($t12, x11 == null, Ut11, C11 == null, s212.textDirection), { top: E11, bottom: Q20, horizontal: Gt8 };
  }
  function y18(x11, C11) {
    let L19 = l11.top + (C11 ? x11.top : x11.bottom);
    return { top: L19, bottom: L19, horizontal: [] };
  }
}
function so5(s212, t8) {
  return s212.constructor == t8.constructor && s212.eq(t8);
}
var ui5 = class {
  constructor(t8, e7) {
    this.view = t8, this.layer = e7, this.drawn = [], this.scaleX = 1, this.scaleY = 1, this.measureReq = { read: this.measure.bind(this), write: this.draw.bind(this) }, this.dom = t8.scrollDOM.appendChild(document.createElement("div")), this.dom.classList.add("cm-layer"), e7.above && this.dom.classList.add("cm-layer-above"), e7.class && this.dom.classList.add(e7.class), this.scale(), this.dom.setAttribute("aria-hidden", "true"), this.setOrder(t8.state), t8.requestMeasure(this.measureReq), e7.mount && e7.mount(this.dom, t8);
  }
  update(t8) {
    t8.startState.facet(he11) != t8.state.facet(he11) && this.setOrder(t8.state), (this.layer.update(t8, this.dom) || t8.geometryChanged) && (this.scale(), t8.view.requestMeasure(this.measureReq));
  }
  setOrder(t8) {
    let e7 = 0, i12 = t8.facet(he11);
    for (; e7 < i12.length && i12[e7] != this.layer; ) e7++;
    this.dom.style.zIndex = String((this.layer.above ? 150 : -1) - e7);
  }
  measure() {
    return this.layer.markers(this.view);
  }
  scale() {
    let { scaleX: t8, scaleY: e7 } = this.view;
    (t8 != this.scaleX || e7 != this.scaleY) && (this.scaleX = t8, this.scaleY = e7, this.dom.style.transform = `scale(${1 / t8}, ${1 / e7})`);
  }
  draw(t8) {
    if (t8.length != this.drawn.length || t8.some((e7, i12) => !so5(e7, this.drawn[i12]))) {
      let e7 = this.dom.firstChild, i12 = 0;
      for (let n14 of t8) n14.update && e7 && n14.constructor && this.drawn[i12].constructor && n14.update(e7, this.drawn[i12]) ? (e7 = e7.nextSibling, i12++) : this.dom.insertBefore(n14.draw(), e7);
      for (; e7; ) {
        let n14 = e7.nextSibling;
        e7.remove(), e7 = n14;
      }
      this.drawn = t8;
    }
  }
  destroy() {
    this.layer.destroy && this.layer.destroy(this.dom, this.view), this.dom.remove();
  }
};
var he11 = y11.define();
function Sn7(s212) {
  return [H5.define((t8) => new ui5(t8, s212)), he11.of(s212)];
}
var Cn6 = !w9.ios;
var St6 = y11.define({ combine(s212) {
  return ht8(s212, { cursorBlinkRate: 1200, drawRangeCursor: true }, { cursorBlinkRate: (t8, e7) => Math.min(t8, e7), drawRangeCursor: (t8, e7) => t8 || e7 });
} });
function qo5(s212 = {}) {
  return [St6.of(s212), no5, ro5, oo5, js5.of(true)];
}
function Mn5(s212) {
  return s212.startState.facet(St6) != s212.state.facet(St6);
}
var no5 = Sn7({ above: true, markers(s212) {
  let { state: t8 } = s212, e7 = t8.facet(St6), i12 = [];
  for (let n14 of t8.selection.ranges) {
    let r2 = n14 == t8.selection.main;
    if (n14.empty ? !r2 || Cn6 : e7.drawRangeCursor) {
      let o = r2 ? "cm-cursor cm-cursor-primary" : "cm-cursor cm-cursor-secondary", l11 = n14.empty ? n14 : x7.cursor(n14.head, n14.head > n14.anchor ? -1 : 1);
      for (let h3 of jt7.forRange(s212, o, l11)) i12.push(h3);
    }
  }
  return i12;
}, update(s212, t8) {
  s212.transactions.some((i12) => i12.selection) && (t8.style.animationName = t8.style.animationName == "cm-blink" ? "cm-blink2" : "cm-blink");
  let e7 = Mn5(s212);
  return e7 && as5(s212.state, t8), s212.docChanged || s212.selectionSet || e7;
}, mount(s212, t8) {
  as5(t8.state, s212);
}, class: "cm-cursorLayer" });
function as5(s212, t8) {
  t8.style.animationDuration = s212.facet(St6).cursorBlinkRate + "ms";
}
var ro5 = Sn7({ above: false, markers(s212) {
  return s212.state.selection.ranges.map((t8) => t8.empty ? [] : jt7.forRange(s212, "cm-selectionBackground", t8)).reduce((t8, e7) => t8.concat(e7));
}, update(s212, t8) {
  return s212.docChanged || s212.selectionSet || s212.viewportChanged || Mn5(s212);
}, class: "cm-selectionLayer" });
var kn6 = { ".cm-line": { "& ::selection": { backgroundColor: "transparent !important" }, "&::selection": { backgroundColor: "transparent !important" } } };
Cn6 && (kn6[".cm-line"].caretColor = "transparent !important");
var oo5 = lt8.highest(A11.theme(kn6));
var An5 = v5.define({ map(s212, t8) {
  return s212 == null ? null : t8.mapPos(s212);
} });
var Ot3 = $9.define({ create() {
  return null;
}, update(s212, t8) {
  return s212 != null && (s212 = t8.changes.mapPos(s212)), t8.effects.reduce((e7, i12) => i12.is(An5) ? i12.value : e7, s212);
} });
var lo5 = H5.fromClass(class {
  constructor(s212) {
    this.view = s212, this.cursor = null, this.measureReq = { read: this.readPos.bind(this), write: this.drawCursor.bind(this) };
  }
  update(s212) {
    var t8;
    let e7 = s212.state.field(Ot3);
    e7 == null ? this.cursor != null && ((t8 = this.cursor) === null || t8 === void 0 || t8.remove(), this.cursor = null) : (this.cursor || (this.cursor = this.view.scrollDOM.appendChild(document.createElement("div")), this.cursor.className = "cm-dropCursor"), (s212.startState.field(Ot3) != e7 || s212.docChanged || s212.geometryChanged) && this.view.requestMeasure(this.measureReq));
  }
  readPos() {
    let { view: s212 } = this, t8 = s212.state.field(Ot3), e7 = t8 != null && s212.coordsAtPos(t8);
    if (!e7) return null;
    let i12 = s212.scrollDOM.getBoundingClientRect();
    return { left: e7.left - i12.left + s212.scrollDOM.scrollLeft * s212.scaleX, top: e7.top - i12.top + s212.scrollDOM.scrollTop * s212.scaleY, height: e7.bottom - e7.top };
  }
  drawCursor(s212) {
    if (this.cursor) {
      let { scaleX: t8, scaleY: e7 } = this.view;
      s212 ? (this.cursor.style.left = s212.left / t8 + "px", this.cursor.style.top = s212.top / e7 + "px", this.cursor.style.height = s212.height / e7 + "px") : this.cursor.style.left = "-100000px";
    }
  }
  destroy() {
    this.cursor && this.cursor.remove();
  }
  setDropPos(s212) {
    this.view.state.field(Ot3) != s212 && this.view.dispatch({ effects: An5.of(s212) });
  }
}, { eventObservers: { dragover(s212) {
  this.setDropPos(this.view.posAtCoords({ x: s212.clientX, y: s212.clientY }));
}, dragleave(s212) {
  (s212.target == this.view.contentDOM || !this.view.contentDOM.contains(s212.relatedTarget)) && this.setDropPos(null);
}, dragend() {
  this.setDropPos(null);
}, drop() {
  this.setDropPos(null);
} } });
function Yo5() {
  return [Ot3, lo5];
}
function cs5(s212, t8, e7, i12, n14) {
  t8.lastIndex = 0;
  for (let r2 = s212.iterRange(e7, i12), o = e7, l11; !r2.next().done; o += r2.value.length) if (!r2.lineBreak) for (; l11 = t8.exec(r2.value); ) n14(o + l11.index, l11);
}
function ho5(s212, t8) {
  let e7 = s212.visibleRanges;
  if (e7.length == 1 && e7[0].from == s212.viewport.from && e7[0].to == s212.viewport.to) return e7;
  let i12 = [];
  for (let { from: n14, to: r2 } of e7) n14 = Math.max(s212.state.doc.lineAt(n14).from, n14 - t8), r2 = Math.min(s212.state.doc.lineAt(r2).to, r2 + t8), i12.length && i12[i12.length - 1].to >= n14 ? i12[i12.length - 1].to = r2 : i12.push({ from: n14, to: r2 });
  return i12;
}
var Yt7 = class {
  constructor(t8) {
    let { regexp: e7, decoration: i12, decorate: n14, boundary: r2, maxLength: o = 1e3 } = t8;
    if (!e7.global) throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");
    if (this.regexp = e7, n14) this.addMatch = (l11, h3, c3, a2) => n14(a2, c3, c3 + l11[0].length, l11, h3);
    else if (typeof i12 == "function") this.addMatch = (l11, h3, c3, a2) => {
      let f6 = i12(l11, h3, c3);
      f6 && a2(c3, c3 + l11[0].length, f6);
    };
    else if (i12) this.addMatch = (l11, h3, c3, a2) => a2(c3, c3 + l11[0].length, i12);
    else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");
    this.boundary = r2, this.maxLength = o;
  }
  createDeco(t8) {
    let e7 = new se7(), i12 = e7.add.bind(e7);
    for (let { from: n14, to: r2 } of ho5(t8, this.maxLength)) cs5(t8.state.doc, this.regexp, n14, r2, (o, l11) => this.addMatch(l11, t8, o, i12));
    return e7.finish();
  }
  updateDeco(t8, e7) {
    let i12 = 1e9, n14 = -1;
    return t8.docChanged && t8.changes.iterChanges((r2, o, l11, h3) => {
      h3 > t8.view.viewport.from && l11 < t8.view.viewport.to && (i12 = Math.min(l11, i12), n14 = Math.max(h3, n14));
    }), t8.viewportChanged || n14 - i12 > 1e3 ? this.createDeco(t8.view) : n14 > -1 ? this.updateRange(t8.view, e7.map(t8.changes), i12, n14) : e7;
  }
  updateRange(t8, e7, i12, n14) {
    for (let r2 of t8.visibleRanges) {
      let o = Math.max(r2.from, i12), l11 = Math.min(r2.to, n14);
      if (l11 > o) {
        let h3 = t8.state.doc.lineAt(o), c3 = h3.to < l11 ? t8.state.doc.lineAt(l11) : h3, a2 = Math.max(r2.from, h3.from), f6 = Math.min(r2.to, c3.to);
        if (this.boundary) {
          for (; o > h3.from; o--) if (this.boundary.test(h3.text[o - 1 - h3.from])) {
            a2 = o;
            break;
          }
          for (; l11 < c3.to; l11++) if (this.boundary.test(c3.text[l11 - c3.from])) {
            f6 = l11;
            break;
          }
        }
        let d4 = [], u3, g8 = (m11, p3, b12) => d4.push(b12.range(m11, p3));
        if (h3 == c3) for (this.regexp.lastIndex = a2 - h3.from; (u3 = this.regexp.exec(h3.text)) && u3.index < f6 - h3.from; ) this.addMatch(u3, t8, u3.index + h3.from, g8);
        else cs5(t8.state.doc, this.regexp, a2, f6, (m11, p3) => this.addMatch(p3, t8, m11, g8));
        e7 = e7.update({ filterFrom: a2, filterTo: f6, filter: (m11, p3) => m11 < a2 || p3 > f6, add: d4 });
      }
    }
    return e7;
  }
};
var gi5 = /x/.unicode != null ? "gu" : "g";
var ao5 = new RegExp(`[\0-\b
--ÂŸÂ­Øœâ€‹â€Žâ€\u2028\u2029â€­â€®â¦â§â©\uFEFFï¿¹-ï¿¼]`, gi5);
var co5 = { 0: "null", 7: "bell", 8: "backspace", 10: "newline", 11: "vertical tab", 13: "carriage return", 27: "escape", 8203: "zero width space", 8204: "zero width non-joiner", 8205: "zero width joiner", 8206: "left-to-right mark", 8207: "right-to-left mark", 8232: "line separator", 8237: "left-to-right override", 8238: "right-to-left override", 8294: "left-to-right isolate", 8295: "right-to-left isolate", 8297: "pop directional isolate", 8233: "paragraph separator", 65279: "zero width no-break space", 65532: "object replacement" };
var Ne13 = null;
function fo5() {
  var s212;
  if (Ne13 == null && typeof document < "u" && document.body) {
    let t8 = document.body.style;
    Ne13 = ((s212 = t8.tabSize) !== null && s212 !== void 0 ? s212 : t8.MozTabSize) != null;
  }
  return Ne13 || false;
}
var ae9 = y11.define({ combine(s212) {
  let t8 = ht8(s212, { render: null, specialChars: ao5, addSpecialChars: null });
  return (t8.replaceTabs = !fo5()) && (t8.specialChars = new RegExp("	|" + t8.specialChars.source, gi5)), t8.addSpecialChars && (t8.specialChars = new RegExp(t8.specialChars.source + "|" + t8.addSpecialChars.source, gi5)), t8;
} });
function _o5(s212 = {}) {
  return [ae9.of(s212), uo5()];
}
var fs5 = null;
function uo5() {
  return fs5 || (fs5 = H5.fromClass(class {
    constructor(s212) {
      this.view = s212, this.decorations = R11.none, this.decorationCache = /* @__PURE__ */ Object.create(null), this.decorator = this.makeDecorator(s212.state.facet(ae9)), this.decorations = this.decorator.createDeco(s212);
    }
    makeDecorator(s212) {
      return new Yt7({ regexp: s212.specialChars, decoration: (t8, e7, i12) => {
        let { doc: n14 } = e7.state, r2 = he10(t8[0], 0);
        if (r2 == 9) {
          let o = n14.lineAt(i12), l11 = e7.state.tabSize, h3 = ot8(o.text, l11, i12 - o.from);
          return R11.replace({ widget: new mi5((l11 - h3 % l11) * this.view.defaultCharacterWidth / this.view.scaleX) });
        }
        return this.decorationCache[r2] || (this.decorationCache[r2] = R11.replace({ widget: new pi5(s212, r2) }));
      }, boundary: s212.replaceTabs ? void 0 : /[^]/ });
    }
    update(s212) {
      let t8 = s212.state.facet(ae9);
      s212.startState.facet(ae9) != t8 ? (this.decorator = this.makeDecorator(t8), this.decorations = this.decorator.createDeco(s212.view)) : this.decorations = this.decorator.updateDeco(s212, this.decorations);
    }
  }, { decorations: (s212) => s212.decorations }));
}
var go5 = "â€¢";
function po5(s212) {
  return s212 >= 32 ? go5 : s212 == 10 ? "â¤" : String.fromCharCode(9216 + s212);
}
var pi5 = class extends ot9 {
  constructor(t8, e7) {
    super(), this.options = t8, this.code = e7;
  }
  eq(t8) {
    return t8.code == this.code;
  }
  toDOM(t8) {
    let e7 = po5(this.code), i12 = t8.state.phrase("Control character") + " " + (co5[this.code] || "0x" + this.code.toString(16)), n14 = this.options.render && this.options.render(this.code, i12, e7);
    if (n14) return n14;
    let r2 = document.createElement("span");
    return r2.textContent = e7, r2.title = i12, r2.setAttribute("aria-label", i12), r2.className = "cm-specialChar", r2;
  }
  ignoreEvent() {
    return false;
  }
};
var mi5 = class extends ot9 {
  constructor(t8) {
    super(), this.width = t8;
  }
  eq(t8) {
    return t8.width == this.width;
  }
  toDOM() {
    let t8 = document.createElement("span");
    return t8.textContent = "	", t8.className = "cm-tab", t8.style.width = this.width + "px", t8;
  }
  ignoreEvent() {
    return false;
  }
};
var ds5 = H5.fromClass(class {
  constructor() {
    this.height = 1e3, this.attrs = { style: "padding-bottom: 1000px" };
  }
  update(s212) {
    let { view: t8 } = s212, e7 = t8.viewState.editorHeight * t8.scaleY - t8.defaultLineHeight - t8.documentPadding.top - 0.5;
    e7 >= 0 && e7 != this.height && (this.height = e7, this.attrs = { style: `padding-bottom: ${e7}px` });
  }
});
function Go5() {
  return bo5;
}
var mo5 = R11.line({ class: "cm-activeLine" });
var bo5 = H5.fromClass(class {
  constructor(s212) {
    this.decorations = this.getDeco(s212);
  }
  update(s212) {
    (s212.docChanged || s212.selectionSet) && (this.decorations = this.getDeco(s212.view));
  }
  getDeco(s212) {
    let t8 = -1, e7 = [];
    for (let i12 of s212.state.selection.ranges) {
      let n14 = s212.lineBlockAt(i12.head);
      n14.from > t8 && (e7.push(mo5.range(n14.from)), t8 = n14.from);
    }
    return R11.set(e7);
  }
}, { decorations: (s212) => s212.decorations });
var wi5 = 2e3;
function wo5(s212, t8, e7) {
  let i12 = Math.min(t8.line, e7.line), n14 = Math.max(t8.line, e7.line), r2 = [];
  if (t8.off > wi5 || e7.off > wi5 || t8.col < 0 || e7.col < 0) {
    let o = Math.min(t8.off, e7.off), l11 = Math.max(t8.off, e7.off);
    for (let h3 = i12; h3 <= n14; h3++) {
      let c3 = s212.doc.line(h3);
      c3.length <= l11 && r2.push(x7.range(c3.from + o, c3.to + l11));
    }
  } else {
    let o = Math.min(t8.col, e7.col), l11 = Math.max(t8.col, e7.col);
    for (let h3 = i12; h3 <= n14; h3++) {
      let c3 = s212.doc.line(h3), a2 = at9(c3.text, o, s212.tabSize, true);
      if (a2 < 0) r2.push(x7.cursor(c3.to));
      else {
        let f6 = at9(c3.text, l11, s212.tabSize);
        r2.push(x7.range(c3.from + a2, c3.from + f6));
      }
    }
  }
  return r2;
}
function yo5(s212, t8) {
  let e7 = s212.coordsAtPos(s212.viewport.from);
  return e7 ? Math.round(Math.abs((e7.left - t8) / s212.defaultCharacterWidth)) : -1;
}
function us5(s212, t8) {
  let e7 = s212.posAtCoords({ x: t8.clientX, y: t8.clientY }, false), i12 = s212.state.doc.lineAt(e7), n14 = e7 - i12.from, r2 = n14 > wi5 ? -1 : n14 == i12.length ? yo5(s212, t8.clientX) : ot8(i12.text, s212.state.tabSize, e7 - i12.from);
  return { line: i12.number, col: r2, off: n14 };
}
function vo5(s212, t8) {
  let e7 = us5(s212, t8), i12 = s212.state.selection;
  return e7 ? { update(n14) {
    if (n14.docChanged) {
      let r2 = n14.changes.mapPos(n14.startState.doc.line(e7.line).from), o = n14.state.doc.lineAt(r2);
      e7 = { line: o.number, col: e7.col, off: Math.min(e7.off, o.length) }, i12 = i12.map(n14.changes);
    }
  }, get(n14, r2, o) {
    let l11 = us5(s212, n14);
    if (!l11) return i12;
    let h3 = wo5(s212.state, e7, l11);
    return h3.length ? o ? x7.create(h3.concat(i12.ranges)) : x7.create(h3) : i12;
  } } : null;
}
function Uo5(s212) {
  let t8 = s212?.eventFilter || ((e7) => e7.altKey && e7.button == 0);
  return A11.mouseSelectionStyle.of((e7, i12) => t8(i12) ? vo5(e7, i12) : null);
}
var xo5 = { Alt: [18, (s212) => !!s212.altKey], Control: [17, (s212) => !!s212.ctrlKey], Shift: [16, (s212) => !!s212.shiftKey], Meta: [91, (s212) => !!s212.metaKey] };
var So5 = { style: "cursor: crosshair" };
function Jo5(s212 = {}) {
  let [t8, e7] = xo5[s212.key || "Alt"], i12 = H5.fromClass(class {
    constructor(n14) {
      this.view = n14, this.isDown = false;
    }
    set(n14) {
      this.isDown != n14 && (this.isDown = n14, this.view.update([]));
    }
  }, { eventObservers: { keydown(n14) {
    this.set(n14.keyCode == t8 || e7(n14));
  }, keyup(n14) {
    (n14.keyCode == t8 || !e7(n14)) && this.set(false);
  }, mousemove(n14) {
    this.set(e7(n14));
  } } });
  return [i12, A11.contentAttributes.of((n14) => {
    var r2;
    return !((r2 = n14.plugin(i12)) === null || r2 === void 0) && r2.isDown ? So5 : null;
  })];
}
var Mt7 = "-10000px";
var ke10 = class {
  constructor(t8, e7, i12) {
    this.facet = e7, this.createTooltipView = i12, this.input = t8.state.facet(e7), this.tooltips = this.input.filter((n14) => n14), this.tooltipViews = this.tooltips.map(i12);
  }
  update(t8, e7) {
    var i12;
    let n14 = t8.state.facet(this.facet), r2 = n14.filter((h3) => h3);
    if (n14 === this.input) {
      for (let h3 of this.tooltipViews) h3.update && h3.update(t8);
      return false;
    }
    let o = [], l11 = e7 ? [] : null;
    for (let h3 = 0; h3 < r2.length; h3++) {
      let c3 = r2[h3], a2 = -1;
      if (c3) {
        for (let f6 = 0; f6 < this.tooltips.length; f6++) {
          let d4 = this.tooltips[f6];
          d4 && d4.create == c3.create && (a2 = f6);
        }
        if (a2 < 0) o[h3] = this.createTooltipView(c3), l11 && (l11[h3] = !!c3.above);
        else {
          let f6 = o[h3] = this.tooltipViews[a2];
          l11 && (l11[h3] = e7[a2]), f6.update && f6.update(t8);
        }
      }
    }
    for (let h3 of this.tooltipViews) o.indexOf(h3) < 0 && (h3.dom.remove(), (i12 = h3.destroy) === null || i12 === void 0 || i12.call(h3));
    return e7 && (l11.forEach((h3, c3) => e7[c3] = h3), e7.length = l11.length), this.input = n14, this.tooltips = r2, this.tooltipViews = o, true;
  }
};
function Co5(s212) {
  let { win: t8 } = s212;
  return { top: 0, left: 0, bottom: t8.innerHeight, right: t8.innerWidth };
}
var ce13 = y11.define({ combine: (s212) => {
  var t8, e7, i12;
  return { position: w9.ios ? "absolute" : ((t8 = s212.find((n14) => n14.position)) === null || t8 === void 0 ? void 0 : t8.position) || "fixed", parent: ((e7 = s212.find((n14) => n14.parent)) === null || e7 === void 0 ? void 0 : e7.parent) || null, tooltipSpace: ((i12 = s212.find((n14) => n14.tooltipSpace)) === null || i12 === void 0 ? void 0 : i12.tooltipSpace) || Co5 };
} });
var gs5 = /* @__PURE__ */ new WeakMap();
var Ri = H5.fromClass(class {
  constructor(s212) {
    this.view = s212, this.above = [], this.inView = true, this.madeAbsolute = false, this.lastTransaction = 0, this.measureTimeout = -1;
    let t8 = s212.state.facet(ce13);
    this.position = t8.position, this.parent = t8.parent, this.classes = s212.themeClasses, this.createContainer(), this.measureReq = { read: this.readMeasure.bind(this), write: this.writeMeasure.bind(this), key: this }, this.manager = new ke10(s212, Dn5, (e7) => this.createTooltip(e7)), this.intersectionObserver = typeof IntersectionObserver == "function" ? new IntersectionObserver((e7) => {
      Date.now() > this.lastTransaction - 50 && e7.length > 0 && e7[e7.length - 1].intersectionRatio < 1 && this.measureSoon();
    }, { threshold: [1] }) : null, this.observeIntersection(), s212.win.addEventListener("resize", this.measureSoon = this.measureSoon.bind(this)), this.maybeMeasure();
  }
  createContainer() {
    this.parent ? (this.container = document.createElement("div"), this.container.style.position = "relative", this.container.className = this.view.themeClasses, this.parent.appendChild(this.container)) : this.container = this.view.dom;
  }
  observeIntersection() {
    if (this.intersectionObserver) {
      this.intersectionObserver.disconnect();
      for (let s212 of this.manager.tooltipViews) this.intersectionObserver.observe(s212.dom);
    }
  }
  measureSoon() {
    this.measureTimeout < 0 && (this.measureTimeout = setTimeout(() => {
      this.measureTimeout = -1, this.maybeMeasure();
    }, 50));
  }
  update(s212) {
    s212.transactions.length && (this.lastTransaction = Date.now());
    let t8 = this.manager.update(s212, this.above);
    t8 && this.observeIntersection();
    let e7 = t8 || s212.geometryChanged, i12 = s212.state.facet(ce13);
    if (i12.position != this.position && !this.madeAbsolute) {
      this.position = i12.position;
      for (let n14 of this.manager.tooltipViews) n14.dom.style.position = this.position;
      e7 = true;
    }
    if (i12.parent != this.parent) {
      this.parent && this.container.remove(), this.parent = i12.parent, this.createContainer();
      for (let n14 of this.manager.tooltipViews) this.container.appendChild(n14.dom);
      e7 = true;
    } else this.parent && this.view.themeClasses != this.classes && (this.classes = this.container.className = this.view.themeClasses);
    e7 && this.maybeMeasure();
  }
  createTooltip(s212) {
    let t8 = s212.create(this.view);
    if (t8.dom.classList.add("cm-tooltip"), s212.arrow && !t8.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")) {
      let e7 = document.createElement("div");
      e7.className = "cm-tooltip-arrow", t8.dom.appendChild(e7);
    }
    return t8.dom.style.position = this.position, t8.dom.style.top = Mt7, t8.dom.style.left = "0px", this.container.appendChild(t8.dom), t8.mount && t8.mount(this.view), t8;
  }
  destroy() {
    var s212, t8;
    this.view.win.removeEventListener("resize", this.measureSoon);
    for (let e7 of this.manager.tooltipViews) e7.dom.remove(), (s212 = e7.destroy) === null || s212 === void 0 || s212.call(e7);
    this.parent && this.container.remove(), (t8 = this.intersectionObserver) === null || t8 === void 0 || t8.disconnect(), clearTimeout(this.measureTimeout);
  }
  readMeasure() {
    let s212 = this.view.dom.getBoundingClientRect(), t8 = 1, e7 = 1, i12 = false;
    if (this.position == "fixed" && this.manager.tooltipViews.length) {
      let { dom: n14 } = this.manager.tooltipViews[0];
      if (w9.gecko) i12 = n14.offsetParent != this.container.ownerDocument.body;
      else if (this.view.scaleX != 1 || this.view.scaleY != 1) i12 = true;
      else if (n14.style.top == Mt7 && n14.style.left == "0px") {
        let r2 = n14.getBoundingClientRect();
        i12 = Math.abs(r2.top + 1e4) > 1 || Math.abs(r2.left) > 1;
      }
    }
    if (i12 || this.position == "absolute") if (this.parent) {
      let n14 = this.parent.getBoundingClientRect();
      n14.width && n14.height && (t8 = n14.width / this.parent.offsetWidth, e7 = n14.height / this.parent.offsetHeight);
    } else ({ scaleX: t8, scaleY: e7 } = this.view.viewState);
    return { editor: s212, parent: this.parent ? this.container.getBoundingClientRect() : s212, pos: this.manager.tooltips.map((n14, r2) => {
      let o = this.manager.tooltipViews[r2];
      return o.getCoords ? o.getCoords(n14.pos) : this.view.coordsAtPos(n14.pos);
    }), size: this.manager.tooltipViews.map(({ dom: n14 }) => n14.getBoundingClientRect()), space: this.view.state.facet(ce13).tooltipSpace(this.view), scaleX: t8, scaleY: e7, makeAbsolute: i12 };
  }
  writeMeasure(s212) {
    var t8;
    if (s212.makeAbsolute) {
      this.madeAbsolute = true, this.position = "absolute";
      for (let l11 of this.manager.tooltipViews) l11.dom.style.position = "absolute";
    }
    let { editor: e7, space: i12, scaleX: n14, scaleY: r2 } = s212, o = [];
    for (let l11 = 0; l11 < this.manager.tooltips.length; l11++) {
      let h3 = this.manager.tooltips[l11], c3 = this.manager.tooltipViews[l11], { dom: a2 } = c3, f6 = s212.pos[l11], d4 = s212.size[l11];
      if (!f6 || f6.bottom <= Math.max(e7.top, i12.top) || f6.top >= Math.min(e7.bottom, i12.bottom) || f6.right < Math.max(e7.left, i12.left) - 0.1 || f6.left > Math.min(e7.right, i12.right) + 0.1) {
        a2.style.top = Mt7;
        continue;
      }
      let u3 = h3.arrow ? c3.dom.querySelector(".cm-tooltip-arrow") : null, g8 = u3 ? 7 : 0, m11 = d4.right - d4.left, p3 = (t8 = gs5.get(c3)) !== null && t8 !== void 0 ? t8 : d4.bottom - d4.top, b12 = c3.offset || ko5, v10 = this.view.textDirection == B7.LTR, S17 = d4.width > i12.right - i12.left ? v10 ? i12.left : i12.right - d4.width : v10 ? Math.min(f6.left - (u3 ? 14 : 0) + b12.x, i12.right - m11) : Math.max(i12.left, f6.left - m11 + (u3 ? 14 : 0) - b12.x), y18 = this.above[l11];
      !h3.strictSide && (y18 ? f6.top - (d4.bottom - d4.top) - b12.y < i12.top : f6.bottom + (d4.bottom - d4.top) + b12.y > i12.bottom) && y18 == i12.bottom - f6.bottom > f6.top - i12.top && (y18 = this.above[l11] = !y18);
      let x11 = (y18 ? f6.top - i12.top : i12.bottom - f6.bottom) - g8;
      if (x11 < p3 && c3.resize !== false) {
        if (x11 < this.view.defaultLineHeight) {
          a2.style.top = Mt7;
          continue;
        }
        gs5.set(c3, p3), a2.style.height = (p3 = x11) / r2 + "px";
      } else a2.style.height && (a2.style.height = "");
      let C11 = y18 ? f6.top - p3 - g8 - b12.y : f6.bottom + g8 + b12.y, L19 = S17 + m11;
      if (c3.overlap !== true) for (let E11 of o) E11.left < L19 && E11.right > S17 && E11.top < C11 + p3 && E11.bottom > C11 && (C11 = y18 ? E11.top - p3 - 2 - g8 : E11.bottom + g8 + 2);
      if (this.position == "absolute" ? (a2.style.top = (C11 - s212.parent.top) / r2 + "px", a2.style.left = (S17 - s212.parent.left) / n14 + "px") : (a2.style.top = C11 / r2 + "px", a2.style.left = S17 / n14 + "px"), u3) {
        let E11 = f6.left + (v10 ? b12.x : -b12.x) - (S17 + 14 - 7);
        u3.style.left = E11 / n14 + "px";
      }
      c3.overlap !== true && o.push({ left: S17, top: C11, right: L19, bottom: C11 + p3 }), a2.classList.toggle("cm-tooltip-above", y18), a2.classList.toggle("cm-tooltip-below", !y18), c3.positioned && c3.positioned(s212.space);
    }
  }
  maybeMeasure() {
    if (this.manager.tooltips.length && (this.view.inView && this.view.requestMeasure(this.measureReq), this.inView != this.view.inView && (this.inView = this.view.inView, !this.inView))) for (let s212 of this.manager.tooltipViews) s212.dom.style.top = Mt7;
  }
}, { eventObservers: { scroll() {
  this.maybeMeasure();
} } });
var Mo5 = A11.baseTheme({ ".cm-tooltip": { zIndex: 100, boxSizing: "border-box" }, "&light .cm-tooltip": { border: "1px solid #bbb", backgroundColor: "#f5f5f5" }, "&light .cm-tooltip-section:not(:first-child)": { borderTop: "1px solid #bbb" }, "&dark .cm-tooltip": { backgroundColor: "#333338", color: "white" }, ".cm-tooltip-arrow": { height: "7px", width: `${7 * 2}px`, position: "absolute", zIndex: -1, overflow: "hidden", "&:before, &:after": { content: "''", position: "absolute", width: 0, height: 0, borderLeft: "7px solid transparent", borderRight: "7px solid transparent" }, ".cm-tooltip-above &": { bottom: "-7px", "&:before": { borderTop: "7px solid #bbb" }, "&:after": { borderTop: "7px solid #f5f5f5", bottom: "1px" } }, ".cm-tooltip-below &": { top: "-7px", "&:before": { borderBottom: "7px solid #bbb" }, "&:after": { borderBottom: "7px solid #f5f5f5", top: "1px" } } }, "&dark .cm-tooltip .cm-tooltip-arrow": { "&:before": { borderTopColor: "#333338", borderBottomColor: "#333338" }, "&:after": { borderTopColor: "transparent", borderBottomColor: "transparent" } } });
var ko5 = { x: 0, y: 0 };
var Dn5 = y11.define({ enables: [Ri, Mo5] });
var _t7 = y11.define();
var yi5 = class s184 {
  static create(t8) {
    return new s184(t8);
  }
  constructor(t8) {
    this.view = t8, this.mounted = false, this.dom = document.createElement("div"), this.dom.classList.add("cm-tooltip-hover"), this.manager = new ke10(t8, _t7, (e7) => this.createHostedView(e7));
  }
  createHostedView(t8) {
    let e7 = t8.create(this.view);
    return e7.dom.classList.add("cm-tooltip-section"), this.dom.appendChild(e7.dom), this.mounted && e7.mount && e7.mount(this.view), e7;
  }
  mount(t8) {
    for (let e7 of this.manager.tooltipViews) e7.mount && e7.mount(t8);
    this.mounted = true;
  }
  positioned(t8) {
    for (let e7 of this.manager.tooltipViews) e7.positioned && e7.positioned(t8);
  }
  update(t8) {
    this.manager.update(t8);
  }
  destroy() {
    var t8;
    for (let e7 of this.manager.tooltipViews) (t8 = e7.destroy) === null || t8 === void 0 || t8.call(e7);
  }
  passProp(t8) {
    let e7;
    for (let i12 of this.manager.tooltipViews) {
      let n14 = i12[t8];
      if (n14 !== void 0) {
        if (e7 === void 0) e7 = n14;
        else if (e7 !== n14) return;
      }
    }
    return e7;
  }
  get offset() {
    return this.passProp("offset");
  }
  get getCoords() {
    return this.passProp("getCoords");
  }
  get overlap() {
    return this.passProp("overlap");
  }
  get resize() {
    return this.passProp("resize");
  }
};
var Ao5 = Dn5.compute([_t7], (s212) => {
  let t8 = s212.facet(_t7).filter((e7) => e7);
  return t8.length === 0 ? null : { pos: Math.min(...t8.map((e7) => e7.pos)), end: Math.max(...t8.filter((e7) => e7.end != null).map((e7) => e7.end)), create: yi5.create, above: t8[0].above, arrow: t8.some((e7) => e7.arrow) };
});
var vi5 = class {
  constructor(t8, e7, i12, n14, r2) {
    this.view = t8, this.source = e7, this.field = i12, this.setHover = n14, this.hoverTime = r2, this.hoverTimeout = -1, this.restartTimeout = -1, this.pending = null, this.lastMove = { x: 0, y: 0, target: t8.dom, time: 0 }, this.checkHover = this.checkHover.bind(this), t8.dom.addEventListener("mouseleave", this.mouseleave = this.mouseleave.bind(this)), t8.dom.addEventListener("mousemove", this.mousemove = this.mousemove.bind(this));
  }
  update() {
    this.pending && (this.pending = null, clearTimeout(this.restartTimeout), this.restartTimeout = setTimeout(() => this.startHover(), 20));
  }
  get active() {
    return this.view.state.field(this.field);
  }
  checkHover() {
    if (this.hoverTimeout = -1, this.active) return;
    let t8 = Date.now() - this.lastMove.time;
    t8 < this.hoverTime ? this.hoverTimeout = setTimeout(this.checkHover, this.hoverTime - t8) : this.startHover();
  }
  startHover() {
    clearTimeout(this.restartTimeout);
    let { view: t8, lastMove: e7 } = this, i12 = t8.docView.nearest(e7.target);
    if (!i12) return;
    let n14, r2 = 1;
    if (i12 instanceof Wt8) n14 = i12.posAtStart;
    else {
      if (n14 = t8.posAtCoords(e7), n14 == null) return;
      let l11 = t8.coordsAtPos(n14);
      if (!l11 || e7.y < l11.top || e7.y > l11.bottom || e7.x < l11.left - t8.defaultCharacterWidth || e7.x > l11.right + t8.defaultCharacterWidth) return;
      let h3 = t8.bidiSpans(t8.state.doc.lineAt(n14)).find((a2) => a2.from <= n14 && a2.to >= n14), c3 = h3 && h3.dir == B7.RTL ? -1 : 1;
      r2 = e7.x < l11.left ? -c3 : c3;
    }
    let o = this.source(t8, n14, r2);
    if (o?.then) {
      let l11 = this.pending = { pos: n14 };
      o.then((h3) => {
        this.pending == l11 && (this.pending = null, h3 && t8.dispatch({ effects: this.setHover.of(h3) }));
      }, (h3) => it6(t8.state, h3, "hover tooltip"));
    } else o && t8.dispatch({ effects: this.setHover.of(o) });
  }
  mousemove(t8) {
    var e7;
    this.lastMove = { x: t8.clientX, y: t8.clientY, target: t8.target, time: Date.now() }, this.hoverTimeout < 0 && (this.hoverTimeout = setTimeout(this.checkHover, this.hoverTime));
    let i12 = this.active;
    if (i12 && !ps5(this.lastMove.target) || this.pending) {
      let { pos: n14 } = i12 || this.pending, r2 = (e7 = i12?.end) !== null && e7 !== void 0 ? e7 : n14;
      (n14 == r2 ? this.view.posAtCoords(this.lastMove) != n14 : !Do5(this.view, n14, r2, t8.clientX, t8.clientY)) && (this.view.dispatch({ effects: this.setHover.of(null) }), this.pending = null);
    }
  }
  mouseleave(t8) {
    clearTimeout(this.hoverTimeout), this.hoverTimeout = -1, this.active && !ps5(t8.relatedTarget) && this.view.dispatch({ effects: this.setHover.of(null) });
  }
  destroy() {
    clearTimeout(this.hoverTimeout), this.view.dom.removeEventListener("mouseleave", this.mouseleave), this.view.dom.removeEventListener("mousemove", this.mousemove);
  }
};
function ps5(s212) {
  for (let t8 = s212; t8; t8 = t8.parentNode) if (t8.nodeType == 1 && t8.classList.contains("cm-tooltip")) return true;
  return false;
}
function Do5(s212, t8, e7, i12, n14, r2) {
  let o = s212.scrollDOM.getBoundingClientRect(), l11 = s212.documentTop + s212.documentPadding.top + s212.contentHeight;
  if (o.left > i12 || o.right < i12 || o.top > n14 || Math.min(o.bottom, l11) < n14) return false;
  let h3 = s212.posAtCoords({ x: i12, y: n14 }, false);
  return h3 >= t8 && h3 <= e7;
}
function Qo5(s212, t8 = {}) {
  let e7 = v5.define(), i12 = $9.define({ create() {
    return null;
  }, update(n14, r2) {
    if (n14 && (t8.hideOnChange && (r2.docChanged || r2.selection) || t8.hideOn && t8.hideOn(r2, n14))) return null;
    if (n14 && r2.docChanged) {
      let o = r2.changes.mapPos(n14.pos, -1, E6.TrackDel);
      if (o == null) return null;
      let l11 = Object.assign(/* @__PURE__ */ Object.create(null), n14);
      l11.pos = o, n14.end != null && (l11.end = r2.changes.mapPos(n14.end)), n14 = l11;
    }
    for (let o of r2.effects) o.is(e7) && (n14 = o.value), o.is(Tn5) && (n14 = null);
    return n14;
  }, provide: (n14) => _t7.from(n14) });
  return [i12, H5.define((n14) => new vi5(n14, s212, i12, e7, t8.hoverTime || 300)), Ao5];
}
function tl5(s212, t8) {
  let e7 = s212.plugin(Ri);
  if (!e7) return null;
  let i12 = e7.manager.tooltips.indexOf(t8);
  return i12 < 0 ? null : e7.manager.tooltipViews[i12];
}
var Tn5 = v5.define();
var il = Tn5.of(null);
var xi5 = y11.define({ combine(s212) {
  let t8, e7;
  for (let i12 of s212) t8 = t8 || i12.topContainer, e7 = e7 || i12.bottomContainer;
  return { topContainer: t8, bottomContainer: e7 };
} });
function rl(s212, t8) {
  let e7 = s212.plugin(On5), i12 = e7 ? e7.specs.indexOf(t8) : -1;
  return i12 > -1 ? e7.panels[i12] : null;
}
var On5 = H5.fromClass(class {
  constructor(s212) {
    this.input = s212.state.facet(bs5), this.specs = this.input.filter((e7) => e7), this.panels = this.specs.map((e7) => e7(s212));
    let t8 = s212.state.facet(xi5);
    this.top = new pt7(s212, true, t8.topContainer), this.bottom = new pt7(s212, false, t8.bottomContainer), this.top.sync(this.panels.filter((e7) => e7.top)), this.bottom.sync(this.panels.filter((e7) => !e7.top));
    for (let e7 of this.panels) e7.dom.classList.add("cm-panel"), e7.mount && e7.mount();
  }
  update(s212) {
    let t8 = s212.state.facet(xi5);
    this.top.container != t8.topContainer && (this.top.sync([]), this.top = new pt7(s212.view, true, t8.topContainer)), this.bottom.container != t8.bottomContainer && (this.bottom.sync([]), this.bottom = new pt7(s212.view, false, t8.bottomContainer)), this.top.syncClasses(), this.bottom.syncClasses();
    let e7 = s212.state.facet(bs5);
    if (e7 != this.input) {
      let i12 = e7.filter((h3) => h3), n14 = [], r2 = [], o = [], l11 = [];
      for (let h3 of i12) {
        let c3 = this.specs.indexOf(h3), a2;
        c3 < 0 ? (a2 = h3(s212.view), l11.push(a2)) : (a2 = this.panels[c3], a2.update && a2.update(s212)), n14.push(a2), (a2.top ? r2 : o).push(a2);
      }
      this.specs = i12, this.panels = n14, this.top.sync(r2), this.bottom.sync(o);
      for (let h3 of l11) h3.dom.classList.add("cm-panel"), h3.mount && h3.mount();
    } else for (let i12 of this.panels) i12.update && i12.update(s212);
  }
  destroy() {
    this.top.sync([]), this.bottom.sync([]);
  }
}, { provide: (s212) => A11.scrollMargins.of((t8) => {
  let e7 = t8.plugin(s212);
  return e7 && { top: e7.top.scrollMargin(), bottom: e7.bottom.scrollMargin() };
}) });
var pt7 = class {
  constructor(t8, e7, i12) {
    this.view = t8, this.top = e7, this.container = i12, this.dom = void 0, this.classes = "", this.panels = [], this.syncClasses();
  }
  sync(t8) {
    for (let e7 of this.panels) e7.destroy && t8.indexOf(e7) < 0 && e7.destroy();
    this.panels = t8, this.syncDOM();
  }
  syncDOM() {
    if (this.panels.length == 0) {
      this.dom && (this.dom.remove(), this.dom = void 0);
      return;
    }
    if (!this.dom) {
      this.dom = document.createElement("div"), this.dom.className = this.top ? "cm-panels cm-panels-top" : "cm-panels cm-panels-bottom", this.dom.style[this.top ? "top" : "bottom"] = "0";
      let e7 = this.container || this.view.dom;
      e7.insertBefore(this.dom, this.top ? e7.firstChild : null);
    }
    let t8 = this.dom.firstChild;
    for (let e7 of this.panels) if (e7.dom.parentNode == this.dom) {
      for (; t8 != e7.dom; ) t8 = ms5(t8);
      t8 = t8.nextSibling;
    } else this.dom.insertBefore(e7.dom, t8);
    for (; t8; ) t8 = ms5(t8);
  }
  scrollMargin() {
    return !this.dom || this.container ? 0 : Math.max(0, this.top ? this.dom.getBoundingClientRect().bottom - Math.max(0, this.view.scrollDOM.getBoundingClientRect().top) : Math.min(innerHeight, this.view.scrollDOM.getBoundingClientRect().bottom) - this.dom.getBoundingClientRect().top);
  }
  syncClasses() {
    if (!(!this.container || this.classes == this.view.themeClasses)) {
      for (let t8 of this.classes.split(" ")) t8 && this.container.classList.remove(t8);
      for (let t8 of (this.classes = this.view.themeClasses).split(" ")) t8 && this.container.classList.add(t8);
    }
  }
};
function ms5(s212) {
  let t8 = s212.nextSibling;
  return s212.remove(), t8;
}
var bs5 = y11.define({ enables: On5 });
var $10 = class extends z11 {
  compare(t8) {
    return this == t8 || this.constructor == t8.constructor && this.eq(t8);
  }
  eq(t8) {
    return false;
  }
  destroy(t8) {
  }
};
$10.prototype.elementClass = "";
$10.prototype.toDOM = void 0;
$10.prototype.mapMode = E6.TrackBefore;
$10.prototype.startSide = $10.prototype.endSide = -1;
$10.prototype.point = true;
var fe12 = y11.define();
var To5 = { class: "", renderEmptyElements: false, elementStyle: "", markers: () => T11.empty, lineMarker: () => null, widgetMarker: () => null, lineMarkerChange: null, initialSpacer: null, updateSpacer: null, domEventHandlers: {} };
var Ht7 = y11.define();
function ol2(s212) {
  return [Rn5(), Ht7.of(Object.assign(Object.assign({}, To5), s212))];
}
var Si5 = y11.define({ combine: (s212) => s212.some((t8) => t8) });
function Rn5(s212) {
  let t8 = [Oo5];
  return s212 && s212.fixed === false && t8.push(Si5.of(true)), t8;
}
var Oo5 = H5.fromClass(class {
  constructor(s212) {
    this.view = s212, this.prevViewport = s212.viewport, this.dom = document.createElement("div"), this.dom.className = "cm-gutters", this.dom.setAttribute("aria-hidden", "true"), this.dom.style.minHeight = this.view.contentHeight / this.view.scaleY + "px", this.gutters = s212.state.facet(Ht7).map((t8) => new Ae8(s212, t8));
    for (let t8 of this.gutters) this.dom.appendChild(t8.dom);
    this.fixed = !s212.state.facet(Si5), this.fixed && (this.dom.style.position = "sticky"), this.syncGutters(false), s212.scrollDOM.insertBefore(this.dom, s212.contentDOM);
  }
  update(s212) {
    if (this.updateGutters(s212)) {
      let t8 = this.prevViewport, e7 = s212.view.viewport, i12 = Math.min(t8.to, e7.to) - Math.max(t8.from, e7.from);
      this.syncGutters(i12 < (e7.to - e7.from) * 0.8);
    }
    s212.geometryChanged && (this.dom.style.minHeight = this.view.contentHeight + "px"), this.view.state.facet(Si5) != !this.fixed && (this.fixed = !this.fixed, this.dom.style.position = this.fixed ? "sticky" : ""), this.prevViewport = s212.view.viewport;
  }
  syncGutters(s212) {
    let t8 = this.dom.nextSibling;
    s212 && this.dom.remove();
    let e7 = T11.iter(this.view.state.facet(fe12), this.view.viewport.from), i12 = [], n14 = this.gutters.map((r2) => new Mi5(r2, this.view.viewport, -this.view.documentPadding.top));
    for (let r2 of this.view.viewportLineBlocks) if (i12.length && (i12 = []), Array.isArray(r2.type)) {
      let o = true;
      for (let l11 of r2.type) if (l11.type == V14.Text && o) {
        Ci5(e7, i12, l11.from);
        for (let h3 of n14) h3.line(this.view, l11, i12);
        o = false;
      } else if (l11.widget) for (let h3 of n14) h3.widget(this.view, l11);
    } else if (r2.type == V14.Text) {
      Ci5(e7, i12, r2.from);
      for (let o of n14) o.line(this.view, r2, i12);
    } else if (r2.widget) for (let o of n14) o.widget(this.view, r2);
    for (let r2 of n14) r2.finish();
    s212 && this.view.scrollDOM.insertBefore(this.dom, t8);
  }
  updateGutters(s212) {
    let t8 = s212.startState.facet(Ht7), e7 = s212.state.facet(Ht7), i12 = s212.docChanged || s212.heightChanged || s212.viewportChanged || !T11.eq(s212.startState.facet(fe12), s212.state.facet(fe12), s212.view.viewport.from, s212.view.viewport.to);
    if (t8 == e7) for (let n14 of this.gutters) n14.update(s212) && (i12 = true);
    else {
      i12 = true;
      let n14 = [];
      for (let r2 of e7) {
        let o = t8.indexOf(r2);
        o < 0 ? n14.push(new Ae8(this.view, r2)) : (this.gutters[o].update(s212), n14.push(this.gutters[o]));
      }
      for (let r2 of this.gutters) r2.dom.remove(), n14.indexOf(r2) < 0 && r2.destroy();
      for (let r2 of n14) this.dom.appendChild(r2.dom);
      this.gutters = n14;
    }
    return i12;
  }
  destroy() {
    for (let s212 of this.gutters) s212.destroy();
    this.dom.remove();
  }
}, { provide: (s212) => A11.scrollMargins.of((t8) => {
  let e7 = t8.plugin(s212);
  return !e7 || e7.gutters.length == 0 || !e7.fixed ? null : t8.textDirection == B7.LTR ? { left: e7.dom.offsetWidth * t8.scaleX } : { right: e7.dom.offsetWidth * t8.scaleX };
}) });
function ws5(s212) {
  return Array.isArray(s212) ? s212 : [s212];
}
function Ci5(s212, t8, e7) {
  for (; s212.value && s212.from <= e7; ) s212.from == e7 && t8.push(s212.value), s212.next();
}
var Mi5 = class {
  constructor(t8, e7, i12) {
    this.gutter = t8, this.height = i12, this.i = 0, this.cursor = T11.iter(t8.markers, e7.from);
  }
  addElement(t8, e7, i12) {
    let { gutter: n14 } = this, r2 = (e7.top - this.height) / t8.scaleY, o = e7.height / t8.scaleY;
    if (this.i == n14.elements.length) {
      let l11 = new De9(t8, o, r2, i12);
      n14.elements.push(l11), n14.dom.appendChild(l11.dom);
    } else n14.elements[this.i].update(t8, o, r2, i12);
    this.height = e7.bottom, this.i++;
  }
  line(t8, e7, i12) {
    let n14 = [];
    Ci5(this.cursor, n14, e7.from), i12.length && (n14 = n14.concat(i12));
    let r2 = this.gutter.config.lineMarker(t8, e7, n14);
    r2 && n14.unshift(r2);
    let o = this.gutter;
    n14.length == 0 && !o.config.renderEmptyElements || this.addElement(t8, e7, n14);
  }
  widget(t8, e7) {
    let i12 = this.gutter.config.widgetMarker(t8, e7.widget, e7);
    i12 && this.addElement(t8, e7, [i12]);
  }
  finish() {
    let t8 = this.gutter;
    for (; t8.elements.length > this.i; ) {
      let e7 = t8.elements.pop();
      t8.dom.removeChild(e7.dom), e7.destroy();
    }
  }
};
var Ae8 = class {
  constructor(t8, e7) {
    this.view = t8, this.config = e7, this.elements = [], this.spacer = null, this.dom = document.createElement("div"), this.dom.className = "cm-gutter" + (this.config.class ? " " + this.config.class : "");
    for (let i12 in e7.domEventHandlers) this.dom.addEventListener(i12, (n14) => {
      let r2 = n14.target, o;
      if (r2 != this.dom && this.dom.contains(r2)) {
        for (; r2.parentNode != this.dom; ) r2 = r2.parentNode;
        let h3 = r2.getBoundingClientRect();
        o = (h3.top + h3.bottom) / 2;
      } else o = n14.clientY;
      let l11 = t8.lineBlockAtHeight(o - t8.documentTop);
      e7.domEventHandlers[i12](t8, l11, n14) && n14.preventDefault();
    });
    this.markers = ws5(e7.markers(t8)), e7.initialSpacer && (this.spacer = new De9(t8, 0, 0, [e7.initialSpacer(t8)]), this.dom.appendChild(this.spacer.dom), this.spacer.dom.style.cssText += "visibility: hidden; pointer-events: none");
  }
  update(t8) {
    let e7 = this.markers;
    if (this.markers = ws5(this.config.markers(t8.view)), this.spacer && this.config.updateSpacer) {
      let n14 = this.config.updateSpacer(this.spacer.markers[0], t8);
      n14 != this.spacer.markers[0] && this.spacer.update(t8.view, 0, 0, [n14]);
    }
    let i12 = t8.view.viewport;
    return !T11.eq(this.markers, e7, i12.from, i12.to) || (this.config.lineMarkerChange ? this.config.lineMarkerChange(t8) : false);
  }
  destroy() {
    for (let t8 of this.elements) t8.destroy();
  }
};
var De9 = class {
  constructor(t8, e7, i12, n14) {
    this.height = -1, this.above = 0, this.markers = [], this.dom = document.createElement("div"), this.dom.className = "cm-gutterElement", this.update(t8, e7, i12, n14);
  }
  update(t8, e7, i12, n14) {
    this.height != e7 && (this.height = e7, this.dom.style.height = e7 + "px"), this.above != i12 && (this.dom.style.marginTop = (this.above = i12) ? i12 + "px" : ""), Ro5(this.markers, n14) || this.setMarkers(t8, n14);
  }
  setMarkers(t8, e7) {
    let i12 = "cm-gutterElement", n14 = this.dom.firstChild;
    for (let r2 = 0, o = 0; ; ) {
      let l11 = o, h3 = r2 < e7.length ? e7[r2++] : null, c3 = false;
      if (h3) {
        let a2 = h3.elementClass;
        a2 && (i12 += " " + a2);
        for (let f6 = o; f6 < this.markers.length; f6++) if (this.markers[f6].compare(h3)) {
          l11 = f6, c3 = true;
          break;
        }
      } else l11 = this.markers.length;
      for (; o < l11; ) {
        let a2 = this.markers[o++];
        if (a2.toDOM) {
          a2.destroy(n14);
          let f6 = n14.nextSibling;
          n14.remove(), n14 = f6;
        }
      }
      if (!h3) break;
      h3.toDOM && (c3 ? n14 = n14.nextSibling : this.dom.insertBefore(h3.toDOM(t8), n14)), c3 && o++;
    }
    this.dom.className = i12, this.markers = e7;
  }
  destroy() {
    this.setMarkers(null, []);
  }
};
function Ro5(s212, t8) {
  if (s212.length != t8.length) return false;
  for (let e7 = 0; e7 < s212.length; e7++) if (!s212[e7].compare(t8[e7])) return false;
  return true;
}
var Lo5 = y11.define();
var mt8 = y11.define({ combine(s212) {
  return ht8(s212, { formatNumber: String, domEventHandlers: {} }, { domEventHandlers(t8, e7) {
    let i12 = Object.assign({}, t8);
    for (let n14 in e7) {
      let r2 = i12[n14], o = e7[n14];
      i12[n14] = r2 ? (l11, h3, c3) => r2(l11, h3, c3) || o(l11, h3, c3) : o;
    }
    return i12;
  } });
} });
var Nt3 = class extends $10 {
  constructor(t8) {
    super(), this.number = t8;
  }
  eq(t8) {
    return this.number == t8.number;
  }
  toDOM() {
    return document.createTextNode(this.number);
  }
};
function Ve10(s212, t8) {
  return s212.state.facet(mt8).formatNumber(t8, s212.state);
}
var Bo5 = Ht7.compute([mt8], (s212) => ({ class: "cm-lineNumbers", renderEmptyElements: false, markers(t8) {
  return t8.state.facet(Lo5);
}, lineMarker(t8, e7, i12) {
  return i12.some((n14) => n14.toDOM) ? null : new Nt3(Ve10(t8, t8.state.doc.lineAt(e7.from).number));
}, widgetMarker: () => null, lineMarkerChange: (t8) => t8.startState.facet(mt8) != t8.state.facet(mt8), initialSpacer(t8) {
  return new Nt3(Ve10(t8, ys5(t8.state.doc.lines)));
}, updateSpacer(t8, e7) {
  let i12 = Ve10(e7.view, ys5(e7.view.state.doc.lines));
  return i12 == t8.number ? t8 : new Nt3(i12);
}, domEventHandlers: s212.facet(mt8).domEventHandlers }));
function ll(s212 = {}) {
  return [mt8.of(s212), Rn5(), Bo5];
}
function ys5(s212) {
  let t8 = 9;
  for (; t8 < s212; ) t8 = t8 * 10 + 9;
  return t8;
}
var Eo5 = new class extends $10 {
  constructor() {
    super(...arguments), this.elementClass = "cm-activeLineGutter";
  }
}();
var Po5 = fe12.compute(["selection"], (s212) => {
  let t8 = [], e7 = -1;
  for (let i12 of s212.selection.ranges) {
    let n14 = s212.doc.lineAt(i12.head).from;
    n14 > e7 && (e7 = n14, t8.push(Eo5.range(n14)));
  }
  return T11.of(t8);
});
function hl() {
  return Po5;
}
var vs5 = /* @__PURE__ */ new Map();
function Ho5(s212) {
  let t8 = vs5.get(s212);
  return t8 || vs5.set(s212, t8 = R11.mark({ attributes: s212 === "	" ? { class: "cm-highlightTab" } : { class: "cm-highlightSpace", "data-display": s212.replace(/ /g, "Â·") } })), t8;
}
function Ln5(s212) {
  return H5.define((t8) => ({ decorations: s212.createDeco(t8), update(e7) {
    this.decorations = s212.updateDeco(e7, this.decorations);
  } }), { decorations: (t8) => t8.decorations });
}
var No5 = Ln5(new Yt7({ regexp: /\t| +/g, decoration: (s212) => Ho5(s212[0]), boundary: /\S/ }));
var Vo5 = Ln5(new Yt7({ regexp: /\s+$/g, decoration: R11.mark({ class: "cm-trailingSpace" }), boundary: /\S/ }));

// https://esm.sh/v135/@codemirror/state@6.3.1/denonext/state.mjs
var m6 = class s185 {
  lineAt(e7) {
    if (e7 < 0 || e7 > this.length) throw new RangeError(`Invalid position ${e7} in document of length ${this.length}`);
    return this.lineInner(e7, false, 1, 0);
  }
  line(e7) {
    if (e7 < 1 || e7 > this.lines) throw new RangeError(`Invalid line number ${e7} in ${this.lines}-line document`);
    return this.lineInner(e7, true, 1, 0);
  }
  replace(e7, t8, n14) {
    let i12 = [];
    return this.decompose(0, e7, i12, 2), n14.length && n14.decompose(0, n14.length, i12, 3), this.decompose(t8, this.length, i12, 1), L11.from(i12, this.length - (t8 - e7) + n14.length);
  }
  append(e7) {
    return this.replace(this.length, this.length, e7);
  }
  slice(e7, t8 = this.length) {
    let n14 = [];
    return this.decompose(e7, t8, n14, 0), L11.from(n14, t8 - e7);
  }
  eq(e7) {
    if (e7 == this) return true;
    if (e7.length != this.length || e7.lines != this.lines) return false;
    let t8 = this.scanIdentical(e7, 1), n14 = this.length - this.scanIdentical(e7, -1), i12 = new B8(this), r2 = new B8(e7);
    for (let l11 = t8, h3 = t8; ; ) {
      if (i12.next(l11), r2.next(l11), l11 = 0, i12.lineBreak != r2.lineBreak || i12.done != r2.done || i12.value != r2.value) return false;
      if (h3 += i12.value.length, i12.done || h3 >= n14) return true;
    }
  }
  iter(e7 = 1) {
    return new B8(this, e7);
  }
  iterRange(e7, t8 = this.length) {
    return new X12(this, e7, t8);
  }
  iterLines(e7, t8) {
    let n14;
    if (e7 == null) n14 = this.iter();
    else {
      t8 == null && (t8 = this.lines + 1);
      let i12 = this.line(e7).from;
      n14 = this.iterRange(i12, Math.max(i12, t8 == this.lines + 1 ? this.length : t8 <= 1 ? 0 : this.line(t8 - 1).to));
    }
    return new Y14(n14);
  }
  toString() {
    return this.sliceString(0);
  }
  toJSON() {
    let e7 = [];
    return this.flatten(e7), e7;
  }
  constructor() {
  }
  static of(e7) {
    if (e7.length == 0) throw new RangeError("A document must have at least one line");
    return e7.length == 1 && !e7[0] ? s185.empty : e7.length <= 32 ? new k8(e7) : L11.from(k8.split(e7, []));
  }
};
var k8 = class s186 extends m6 {
  constructor(e7, t8 = je9(e7)) {
    super(), this.text = e7, this.length = t8;
  }
  get lines() {
    return this.text.length;
  }
  get children() {
    return null;
  }
  lineInner(e7, t8, n14, i12) {
    for (let r2 = 0; ; r2++) {
      let l11 = this.text[r2], h3 = i12 + l11.length;
      if ((t8 ? n14 : h3) >= e7) return new ae10(i12, h3, n14, l11);
      i12 = h3 + 1, n14++;
    }
  }
  decompose(e7, t8, n14, i12) {
    let r2 = e7 <= 0 && t8 >= this.length ? this : new s186(Ie10(this.text, e7, t8), Math.min(t8, this.length) - Math.max(0, e7));
    if (i12 & 1) {
      let l11 = n14.pop(), h3 = Q12(r2.text, l11.text.slice(), 0, r2.length);
      if (h3.length <= 32) n14.push(new s186(h3, l11.length + r2.length));
      else {
        let o = h3.length >> 1;
        n14.push(new s186(h3.slice(0, o)), new s186(h3.slice(o)));
      }
    } else n14.push(r2);
  }
  replace(e7, t8, n14) {
    if (!(n14 instanceof s186)) return super.replace(e7, t8, n14);
    let i12 = Q12(this.text, Q12(n14.text, Ie10(this.text, 0, e7)), t8), r2 = this.length + n14.length - (t8 - e7);
    return i12.length <= 32 ? new s186(i12, r2) : L11.from(s186.split(i12, []), r2);
  }
  sliceString(e7, t8 = this.length, n14 = `
`) {
    let i12 = "";
    for (let r2 = 0, l11 = 0; r2 <= t8 && l11 < this.text.length; l11++) {
      let h3 = this.text[l11], o = r2 + h3.length;
      r2 > e7 && l11 && (i12 += n14), e7 < o && t8 > r2 && (i12 += h3.slice(Math.max(0, e7 - r2), t8 - r2)), r2 = o + 1;
    }
    return i12;
  }
  flatten(e7) {
    for (let t8 of this.text) e7.push(t8);
  }
  scanIdentical() {
    return 0;
  }
  static split(e7, t8) {
    let n14 = [], i12 = -1;
    for (let r2 of e7) n14.push(r2), i12 += r2.length + 1, n14.length == 32 && (t8.push(new s186(n14, i12)), n14 = [], i12 = -1);
    return i12 > -1 && t8.push(new s186(n14, i12)), t8;
  }
};
var L11 = class s187 extends m6 {
  constructor(e7, t8) {
    super(), this.children = e7, this.length = t8, this.lines = 0;
    for (let n14 of e7) this.lines += n14.lines;
  }
  lineInner(e7, t8, n14, i12) {
    for (let r2 = 0; ; r2++) {
      let l11 = this.children[r2], h3 = i12 + l11.length, o = n14 + l11.lines - 1;
      if ((t8 ? o : h3) >= e7) return l11.lineInner(e7, t8, n14, i12);
      i12 = h3 + 1, n14 = o + 1;
    }
  }
  decompose(e7, t8, n14, i12) {
    for (let r2 = 0, l11 = 0; l11 <= t8 && r2 < this.children.length; r2++) {
      let h3 = this.children[r2], o = l11 + h3.length;
      if (e7 <= o && t8 >= l11) {
        let a2 = i12 & ((l11 <= e7 ? 1 : 0) | (o >= t8 ? 2 : 0));
        l11 >= e7 && o <= t8 && !a2 ? n14.push(h3) : h3.decompose(e7 - l11, t8 - l11, n14, a2);
      }
      l11 = o + 1;
    }
  }
  replace(e7, t8, n14) {
    if (n14.lines < this.lines) for (let i12 = 0, r2 = 0; i12 < this.children.length; i12++) {
      let l11 = this.children[i12], h3 = r2 + l11.length;
      if (e7 >= r2 && t8 <= h3) {
        let o = l11.replace(e7 - r2, t8 - r2, n14), a2 = this.lines - l11.lines + o.lines;
        if (o.lines < a2 >> 4 && o.lines > a2 >> 6) {
          let f6 = this.children.slice();
          return f6[i12] = o, new s187(f6, this.length - (t8 - e7) + n14.length);
        }
        return super.replace(r2, h3, o);
      }
      r2 = h3 + 1;
    }
    return super.replace(e7, t8, n14);
  }
  sliceString(e7, t8 = this.length, n14 = `
`) {
    let i12 = "";
    for (let r2 = 0, l11 = 0; r2 < this.children.length && l11 <= t8; r2++) {
      let h3 = this.children[r2], o = l11 + h3.length;
      l11 > e7 && r2 && (i12 += n14), e7 < o && t8 > l11 && (i12 += h3.sliceString(e7 - l11, t8 - l11, n14)), l11 = o + 1;
    }
    return i12;
  }
  flatten(e7) {
    for (let t8 of this.children) t8.flatten(e7);
  }
  scanIdentical(e7, t8) {
    if (!(e7 instanceof s187)) return 0;
    let n14 = 0, [i12, r2, l11, h3] = t8 > 0 ? [0, 0, this.children.length, e7.children.length] : [this.children.length - 1, e7.children.length - 1, -1, -1];
    for (; ; i12 += t8, r2 += t8) {
      if (i12 == l11 || r2 == h3) return n14;
      let o = this.children[i12], a2 = e7.children[r2];
      if (o != a2) return n14 + o.scanIdentical(a2, t8);
      n14 += o.length + 1;
    }
  }
  static from(e7, t8 = e7.reduce((n14, i12) => n14 + i12.length + 1, -1)) {
    let n14 = 0;
    for (let c3 of e7) n14 += c3.lines;
    if (n14 < 32) {
      let c3 = [];
      for (let g8 of e7) g8.flatten(c3);
      return new k8(c3, t8);
    }
    let i12 = Math.max(32, n14 >> 5), r2 = i12 << 1, l11 = i12 >> 1, h3 = [], o = 0, a2 = -1, f6 = [];
    function u3(c3) {
      let g8;
      if (c3.lines > r2 && c3 instanceof s187) for (let A18 of c3.children) u3(A18);
      else c3.lines > l11 && (o > l11 || !o) ? (d4(), h3.push(c3)) : c3 instanceof k8 && o && (g8 = f6[f6.length - 1]) instanceof k8 && c3.lines + g8.lines <= 32 ? (o += c3.lines, a2 += c3.length + 1, f6[f6.length - 1] = new k8(g8.text.concat(c3.text), g8.length + 1 + c3.length)) : (o + c3.lines > i12 && d4(), o += c3.lines, a2 += c3.length + 1, f6.push(c3));
    }
    function d4() {
      o != 0 && (h3.push(f6.length == 1 ? f6[0] : s187.from(f6, a2)), a2 = -1, o = f6.length = 0);
    }
    for (let c3 of e7) u3(c3);
    return d4(), h3.length == 1 ? h3[0] : new s187(h3, t8);
  }
};
m6.empty = new k8([""], 0);
function je9(s212) {
  let e7 = -1;
  for (let t8 of s212) e7 += t8.length + 1;
  return e7;
}
function Q12(s212, e7, t8 = 0, n14 = 1e9) {
  for (let i12 = 0, r2 = 0, l11 = true; r2 < s212.length && i12 <= n14; r2++) {
    let h3 = s212[r2], o = i12 + h3.length;
    o >= t8 && (o > n14 && (h3 = h3.slice(0, n14 - i12)), i12 < t8 && (h3 = h3.slice(t8 - i12)), l11 ? (e7[e7.length - 1] += h3, l11 = false) : e7.push(h3)), i12 = o + 1;
  }
  return e7;
}
function Ie10(s212, e7, t8) {
  return Q12(s212, [""], e7, t8);
}
var B8 = class {
  constructor(e7, t8 = 1) {
    this.dir = t8, this.done = false, this.lineBreak = false, this.value = "", this.nodes = [e7], this.offsets = [t8 > 0 ? 1 : (e7 instanceof k8 ? e7.text.length : e7.children.length) << 1];
  }
  nextInner(e7, t8) {
    for (this.done = this.lineBreak = false; ; ) {
      let n14 = this.nodes.length - 1, i12 = this.nodes[n14], r2 = this.offsets[n14], l11 = r2 >> 1, h3 = i12 instanceof k8 ? i12.text.length : i12.children.length;
      if (l11 == (t8 > 0 ? h3 : 0)) {
        if (n14 == 0) return this.done = true, this.value = "", this;
        t8 > 0 && this.offsets[n14 - 1]++, this.nodes.pop(), this.offsets.pop();
      } else if ((r2 & 1) == (t8 > 0 ? 0 : 1)) {
        if (this.offsets[n14] += t8, e7 == 0) return this.lineBreak = true, this.value = `
`, this;
        e7--;
      } else if (i12 instanceof k8) {
        let o = i12.text[l11 + (t8 < 0 ? -1 : 0)];
        if (this.offsets[n14] += t8, o.length > Math.max(0, e7)) return this.value = e7 == 0 ? o : t8 > 0 ? o.slice(e7) : o.slice(0, o.length - e7), this;
        e7 -= o.length;
      } else {
        let o = i12.children[l11 + (t8 < 0 ? -1 : 0)];
        e7 > o.length ? (e7 -= o.length, this.offsets[n14] += t8) : (t8 < 0 && this.offsets[n14]--, this.nodes.push(o), this.offsets.push(t8 > 0 ? 1 : (o instanceof k8 ? o.text.length : o.children.length) << 1));
      }
    }
  }
  next(e7 = 0) {
    return e7 < 0 && (this.nextInner(-e7, -this.dir), e7 = this.value.length), this.nextInner(e7, this.dir);
  }
};
var X12 = class {
  constructor(e7, t8, n14) {
    this.value = "", this.done = false, this.cursor = new B8(e7, t8 > n14 ? -1 : 1), this.pos = t8 > n14 ? e7.length : 0, this.from = Math.min(t8, n14), this.to = Math.max(t8, n14);
  }
  nextInner(e7, t8) {
    if (t8 < 0 ? this.pos <= this.from : this.pos >= this.to) return this.value = "", this.done = true, this;
    e7 += Math.max(0, t8 < 0 ? this.pos - this.to : this.from - this.pos);
    let n14 = t8 < 0 ? this.pos - this.from : this.to - this.pos;
    e7 > n14 && (e7 = n14), n14 -= e7;
    let { value: i12 } = this.cursor.next(e7);
    return this.pos += (i12.length + e7) * t8, this.value = i12.length <= n14 ? i12 : t8 < 0 ? i12.slice(i12.length - n14) : i12.slice(0, n14), this.done = !this.value, this;
  }
  next(e7 = 0) {
    return e7 < 0 ? e7 = Math.max(e7, this.from - this.pos) : e7 > 0 && (e7 = Math.min(e7, this.to - this.pos)), this.nextInner(e7, this.cursor.dir);
  }
  get lineBreak() {
    return this.cursor.lineBreak && this.value != "";
  }
};
var Y14 = class {
  constructor(e7) {
    this.inner = e7, this.afterBreak = true, this.value = "", this.done = false;
  }
  next(e7 = 0) {
    let { done: t8, lineBreak: n14, value: i12 } = this.inner.next(e7);
    return t8 ? (this.done = true, this.value = "") : n14 ? this.afterBreak ? this.value = "" : (this.afterBreak = true, this.next()) : (this.value = i12, this.afterBreak = false), this;
  }
  get lineBreak() {
    return false;
  }
};
typeof Symbol < "u" && (m6.prototype[Symbol.iterator] = function() {
  return this.iter();
}, B8.prototype[Symbol.iterator] = X12.prototype[Symbol.iterator] = Y14.prototype[Symbol.iterator] = function() {
  return this;
});
var ae10 = class {
  constructor(e7, t8, n14, i12) {
    this.from = e7, this.to = t8, this.number = n14, this.text = i12;
  }
  get length() {
    return this.to - this.from;
  }
};
var D10 = "lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((s212) => s212 ? parseInt(s212, 36) : 1);
for (let s212 = 1; s212 < D10.length; s212++) D10[s212] += D10[s212 - 1];
function He9(s212) {
  for (let e7 = 1; e7 < D10.length; e7 += 2) if (D10[e7] > s212) return D10[e7 - 1] <= s212;
  return false;
}
function Ae9(s212) {
  return s212 >= 127462 && s212 <= 127487;
}
var Pe12 = 8205;
function _13(s212, e7, t8 = true, n14 = true) {
  return (t8 ? Be12 : Ze11)(s212, e7, n14);
}
function Be12(s212, e7, t8) {
  if (e7 == s212.length) return e7;
  e7 && Ce8(s212.charCodeAt(e7)) && Fe12(s212.charCodeAt(e7 - 1)) && e7--;
  let n14 = he12(s212, e7);
  for (e7 += Ee13(n14); e7 < s212.length; ) {
    let i12 = he12(s212, e7);
    if (n14 == Pe12 || i12 == Pe12 || t8 && He9(i12)) e7 += Ee13(i12), n14 = i12;
    else if (Ae9(i12)) {
      let r2 = 0, l11 = e7 - 2;
      for (; l11 >= 0 && Ae9(he12(s212, l11)); ) r2++, l11 -= 2;
      if (r2 % 2 == 0) break;
      e7 += 2;
    } else break;
  }
  return e7;
}
function Ze11(s212, e7, t8) {
  for (; e7 > 0; ) {
    let n14 = Be12(s212, e7 - 2, t8);
    if (n14 < e7) return n14;
    e7--;
  }
  return 0;
}
function Ce8(s212) {
  return s212 >= 56320 && s212 < 57344;
}
function Fe12(s212) {
  return s212 >= 55296 && s212 < 56320;
}
function he12(s212, e7) {
  let t8 = s212.charCodeAt(e7);
  if (!Fe12(t8) || e7 + 1 == s212.length) return t8;
  let n14 = s212.charCodeAt(e7 + 1);
  return Ce8(n14) ? (t8 - 55296 << 10) + (n14 - 56320) + 65536 : t8;
}
function rt10(s212) {
  return s212 <= 65535 ? String.fromCharCode(s212) : (s212 -= 65536, String.fromCharCode((s212 >> 10) + 55296, (s212 & 1023) + 56320));
}
function Ee13(s212) {
  return s212 < 65536 ? 1 : 2;
}
var fe13 = /\r\n?|\n/;
var E7 = function(s212) {
  return s212[s212.Simple = 0] = "Simple", s212[s212.TrackDel = 1] = "TrackDel", s212[s212.TrackBefore = 2] = "TrackBefore", s212[s212.TrackAfter = 3] = "TrackAfter", s212;
}(E7 || (E7 = {}));
var C7 = class s188 {
  constructor(e7) {
    this.sections = e7;
  }
  get length() {
    let e7 = 0;
    for (let t8 = 0; t8 < this.sections.length; t8 += 2) e7 += this.sections[t8];
    return e7;
  }
  get newLength() {
    let e7 = 0;
    for (let t8 = 0; t8 < this.sections.length; t8 += 2) {
      let n14 = this.sections[t8 + 1];
      e7 += n14 < 0 ? this.sections[t8] : n14;
    }
    return e7;
  }
  get empty() {
    return this.sections.length == 0 || this.sections.length == 2 && this.sections[1] < 0;
  }
  iterGaps(e7) {
    for (let t8 = 0, n14 = 0, i12 = 0; t8 < this.sections.length; ) {
      let r2 = this.sections[t8++], l11 = this.sections[t8++];
      l11 < 0 ? (e7(n14, i12, r2), i12 += r2) : i12 += l11, n14 += r2;
    }
  }
  iterChangedRanges(e7, t8 = false) {
    ue12(this, e7, t8);
  }
  get invertedDesc() {
    let e7 = [];
    for (let t8 = 0; t8 < this.sections.length; ) {
      let n14 = this.sections[t8++], i12 = this.sections[t8++];
      i12 < 0 ? e7.push(n14, i12) : e7.push(i12, n14);
    }
    return new s188(e7);
  }
  composeDesc(e7) {
    return this.empty ? e7 : e7.empty ? this : Je8(this, e7);
  }
  mapDesc(e7, t8 = false) {
    return e7.empty ? this : ce14(this, e7, t8);
  }
  mapPos(e7, t8 = -1, n14 = E7.Simple) {
    let i12 = 0, r2 = 0;
    for (let l11 = 0; l11 < this.sections.length; ) {
      let h3 = this.sections[l11++], o = this.sections[l11++], a2 = i12 + h3;
      if (o < 0) {
        if (a2 > e7) return r2 + (e7 - i12);
        r2 += h3;
      } else {
        if (n14 != E7.Simple && a2 >= e7 && (n14 == E7.TrackDel && i12 < e7 && a2 > e7 || n14 == E7.TrackBefore && i12 < e7 || n14 == E7.TrackAfter && a2 > e7)) return null;
        if (a2 > e7 || a2 == e7 && t8 < 0 && !h3) return e7 == i12 || t8 < 0 ? r2 : r2 + o;
        r2 += o;
      }
      i12 = a2;
    }
    if (e7 > i12) throw new RangeError(`Position ${e7} is out of range for changeset of length ${i12}`);
    return r2;
  }
  touchesRange(e7, t8 = e7) {
    for (let n14 = 0, i12 = 0; n14 < this.sections.length && i12 <= t8; ) {
      let r2 = this.sections[n14++], l11 = this.sections[n14++], h3 = i12 + r2;
      if (l11 >= 0 && i12 <= t8 && h3 >= e7) return i12 < e7 && h3 > t8 ? "cover" : true;
      i12 = h3;
    }
    return false;
  }
  toString() {
    let e7 = "";
    for (let t8 = 0; t8 < this.sections.length; ) {
      let n14 = this.sections[t8++], i12 = this.sections[t8++];
      e7 += (e7 ? " " : "") + n14 + (i12 >= 0 ? ":" + i12 : "");
    }
    return e7;
  }
  toJSON() {
    return this.sections;
  }
  static fromJSON(e7) {
    if (!Array.isArray(e7) || e7.length % 2 || e7.some((t8) => typeof t8 != "number")) throw new RangeError("Invalid JSON representation of ChangeDesc");
    return new s188(e7);
  }
  static create(e7) {
    return new s188(e7);
  }
};
var P14 = class s189 extends C7 {
  constructor(e7, t8) {
    super(e7), this.inserted = t8;
  }
  apply(e7) {
    if (this.length != e7.length) throw new RangeError("Applying change set to a document with the wrong length");
    return ue12(this, (t8, n14, i12, r2, l11) => e7 = e7.replace(i12, i12 + (n14 - t8), l11), false), e7;
  }
  mapDesc(e7, t8 = false) {
    return ce14(this, e7, t8, true);
  }
  invert(e7) {
    let t8 = this.sections.slice(), n14 = [];
    for (let i12 = 0, r2 = 0; i12 < t8.length; i12 += 2) {
      let l11 = t8[i12], h3 = t8[i12 + 1];
      if (h3 >= 0) {
        t8[i12] = h3, t8[i12 + 1] = l11;
        let o = i12 >> 1;
        for (; n14.length < o; ) n14.push(m6.empty);
        n14.push(l11 ? e7.slice(r2, r2 + l11) : m6.empty);
      }
      r2 += l11;
    }
    return new s189(t8, n14);
  }
  compose(e7) {
    return this.empty ? e7 : e7.empty ? this : Je8(this, e7, true);
  }
  map(e7, t8 = false) {
    return e7.empty ? this : ce14(this, e7, t8, true);
  }
  iterChanges(e7, t8 = false) {
    ue12(this, e7, t8);
  }
  get desc() {
    return C7.create(this.sections);
  }
  filter(e7) {
    let t8 = [], n14 = [], i12 = [], r2 = new F14(this);
    e: for (let l11 = 0, h3 = 0; ; ) {
      let o = l11 == e7.length ? 1e9 : e7[l11++];
      for (; h3 < o || h3 == o && r2.len == 0; ) {
        if (r2.done) break e;
        let f6 = Math.min(r2.len, o - h3);
        w10(i12, f6, -1);
        let u3 = r2.ins == -1 ? -1 : r2.off == 0 ? r2.ins : 0;
        w10(t8, f6, u3), u3 > 0 && b8(n14, t8, r2.text), r2.forward(f6), h3 += f6;
      }
      let a2 = e7[l11++];
      for (; h3 < a2; ) {
        if (r2.done) break e;
        let f6 = Math.min(r2.len, a2 - h3);
        w10(t8, f6, -1), w10(i12, f6, r2.ins == -1 ? -1 : r2.off == 0 ? r2.ins : 0), r2.forward(f6), h3 += f6;
      }
    }
    return { changes: new s189(t8, n14), filtered: C7.create(i12) };
  }
  toJSON() {
    let e7 = [];
    for (let t8 = 0; t8 < this.sections.length; t8 += 2) {
      let n14 = this.sections[t8], i12 = this.sections[t8 + 1];
      i12 < 0 ? e7.push(n14) : i12 == 0 ? e7.push([n14]) : e7.push([n14].concat(this.inserted[t8 >> 1].toJSON()));
    }
    return e7;
  }
  static of(e7, t8, n14) {
    let i12 = [], r2 = [], l11 = 0, h3 = null;
    function o(f6 = false) {
      if (!f6 && !i12.length) return;
      l11 < t8 && w10(i12, t8 - l11, -1);
      let u3 = new s189(i12, r2);
      h3 = h3 ? h3.compose(u3.map(h3)) : u3, i12 = [], r2 = [], l11 = 0;
    }
    function a2(f6) {
      if (Array.isArray(f6)) for (let u3 of f6) a2(u3);
      else if (f6 instanceof s189) {
        if (f6.length != t8) throw new RangeError(`Mismatched change set length (got ${f6.length}, expected ${t8})`);
        o(), h3 = h3 ? h3.compose(f6.map(h3)) : f6;
      } else {
        let { from: u3, to: d4 = u3, insert: c3 } = f6;
        if (u3 > d4 || u3 < 0 || d4 > t8) throw new RangeError(`Invalid change range ${u3} to ${d4} (in doc of length ${t8})`);
        let g8 = c3 ? typeof c3 == "string" ? m6.of(c3.split(n14 || fe13)) : c3 : m6.empty, A18 = g8.length;
        if (u3 == d4 && A18 == 0) return;
        u3 < l11 && o(), u3 > l11 && w10(i12, u3 - l11, -1), w10(i12, d4 - u3, A18), b8(r2, i12, g8), l11 = d4;
      }
    }
    return a2(e7), o(!h3), h3;
  }
  static empty(e7) {
    return new s189(e7 ? [e7, -1] : [], []);
  }
  static fromJSON(e7) {
    if (!Array.isArray(e7)) throw new RangeError("Invalid JSON representation of ChangeSet");
    let t8 = [], n14 = [];
    for (let i12 = 0; i12 < e7.length; i12++) {
      let r2 = e7[i12];
      if (typeof r2 == "number") t8.push(r2, -1);
      else {
        if (!Array.isArray(r2) || typeof r2[0] != "number" || r2.some((l11, h3) => h3 && typeof l11 != "string")) throw new RangeError("Invalid JSON representation of ChangeSet");
        if (r2.length == 1) t8.push(r2[0], 0);
        else {
          for (; n14.length < i12; ) n14.push(m6.empty);
          n14[i12] = m6.of(r2.slice(1)), t8.push(r2[0], n14[i12].length);
        }
      }
    }
    return new s189(t8, n14);
  }
  static createSet(e7, t8) {
    return new s189(e7, t8);
  }
};
function w10(s212, e7, t8, n14 = false) {
  if (e7 == 0 && t8 <= 0) return;
  let i12 = s212.length - 2;
  i12 >= 0 && t8 <= 0 && t8 == s212[i12 + 1] ? s212[i12] += e7 : e7 == 0 && s212[i12] == 0 ? s212[i12 + 1] += t8 : n14 ? (s212[i12] += e7, s212[i12 + 1] += t8) : s212.push(e7, t8);
}
function b8(s212, e7, t8) {
  if (t8.length == 0) return;
  let n14 = e7.length - 2 >> 1;
  if (n14 < s212.length) s212[s212.length - 1] = s212[s212.length - 1].append(t8);
  else {
    for (; s212.length < n14; ) s212.push(m6.empty);
    s212.push(t8);
  }
}
function ue12(s212, e7, t8) {
  let n14 = s212.inserted;
  for (let i12 = 0, r2 = 0, l11 = 0; l11 < s212.sections.length; ) {
    let h3 = s212.sections[l11++], o = s212.sections[l11++];
    if (o < 0) i12 += h3, r2 += h3;
    else {
      let a2 = i12, f6 = r2, u3 = m6.empty;
      for (; a2 += h3, f6 += o, o && n14 && (u3 = u3.append(n14[l11 - 2 >> 1])), !(t8 || l11 == s212.sections.length || s212.sections[l11 + 1] < 0); ) h3 = s212.sections[l11++], o = s212.sections[l11++];
      e7(i12, a2, r2, f6, u3), i12 = a2, r2 = f6;
    }
  }
}
function ce14(s212, e7, t8, n14 = false) {
  let i12 = [], r2 = n14 ? [] : null, l11 = new F14(s212), h3 = new F14(e7);
  for (let o = -1; ; ) if (l11.ins == -1 && h3.ins == -1) {
    let a2 = Math.min(l11.len, h3.len);
    w10(i12, a2, -1), l11.forward(a2), h3.forward(a2);
  } else if (h3.ins >= 0 && (l11.ins < 0 || o == l11.i || l11.off == 0 && (h3.len < l11.len || h3.len == l11.len && !t8))) {
    let a2 = h3.len;
    for (w10(i12, h3.ins, -1); a2; ) {
      let f6 = Math.min(l11.len, a2);
      l11.ins >= 0 && o < l11.i && l11.len <= f6 && (w10(i12, 0, l11.ins), r2 && b8(r2, i12, l11.text), o = l11.i), l11.forward(f6), a2 -= f6;
    }
    h3.next();
  } else if (l11.ins >= 0) {
    let a2 = 0, f6 = l11.len;
    for (; f6; ) if (h3.ins == -1) {
      let u3 = Math.min(f6, h3.len);
      a2 += u3, f6 -= u3, h3.forward(u3);
    } else if (h3.ins == 0 && h3.len < f6) f6 -= h3.len, h3.next();
    else break;
    w10(i12, a2, o < l11.i ? l11.ins : 0), r2 && o < l11.i && b8(r2, i12, l11.text), o = l11.i, l11.forward(l11.len - f6);
  } else {
    if (l11.done && h3.done) return r2 ? P14.createSet(i12, r2) : C7.create(i12);
    throw new Error("Mismatched change set lengths");
  }
}
function Je8(s212, e7, t8 = false) {
  let n14 = [], i12 = t8 ? [] : null, r2 = new F14(s212), l11 = new F14(e7);
  for (let h3 = false; ; ) {
    if (r2.done && l11.done) return i12 ? P14.createSet(n14, i12) : C7.create(n14);
    if (r2.ins == 0) w10(n14, r2.len, 0, h3), r2.next();
    else if (l11.len == 0 && !l11.done) w10(n14, 0, l11.ins, h3), i12 && b8(i12, n14, l11.text), l11.next();
    else {
      if (r2.done || l11.done) throw new Error("Mismatched change set lengths");
      {
        let o = Math.min(r2.len2, l11.len), a2 = n14.length;
        if (r2.ins == -1) {
          let f6 = l11.ins == -1 ? -1 : l11.off ? 0 : l11.ins;
          w10(n14, o, f6, h3), i12 && f6 && b8(i12, n14, l11.text);
        } else l11.ins == -1 ? (w10(n14, r2.off ? 0 : r2.len, o, h3), i12 && b8(i12, n14, r2.textBit(o))) : (w10(n14, r2.off ? 0 : r2.len, l11.off ? 0 : l11.ins, h3), i12 && !l11.off && b8(i12, n14, l11.text));
        h3 = (r2.ins > o || l11.ins >= 0 && l11.len > o) && (h3 || n14.length > a2), r2.forward2(o), l11.forward(o);
      }
    }
  }
}
var F14 = class {
  constructor(e7) {
    this.set = e7, this.i = 0, this.next();
  }
  next() {
    let { sections: e7 } = this.set;
    this.i < e7.length ? (this.len = e7[this.i++], this.ins = e7[this.i++]) : (this.len = 0, this.ins = -2), this.off = 0;
  }
  get done() {
    return this.ins == -2;
  }
  get len2() {
    return this.ins < 0 ? this.len : this.ins;
  }
  get text() {
    let { inserted: e7 } = this.set, t8 = this.i - 2 >> 1;
    return t8 >= e7.length ? m6.empty : e7[t8];
  }
  textBit(e7) {
    let { inserted: t8 } = this.set, n14 = this.i - 2 >> 1;
    return n14 >= t8.length && !e7 ? m6.empty : t8[n14].slice(this.off, e7 == null ? void 0 : this.off + e7);
  }
  forward(e7) {
    e7 == this.len ? this.next() : (this.len -= e7, this.off += e7);
  }
  forward2(e7) {
    this.ins == -1 ? this.forward(e7) : e7 == this.ins ? this.next() : (this.ins -= e7, this.off += e7);
  }
};
var N14 = class s190 {
  constructor(e7, t8, n14) {
    this.from = e7, this.to = t8, this.flags = n14;
  }
  get anchor() {
    return this.flags & 32 ? this.to : this.from;
  }
  get head() {
    return this.flags & 32 ? this.from : this.to;
  }
  get empty() {
    return this.from == this.to;
  }
  get assoc() {
    return this.flags & 8 ? -1 : this.flags & 16 ? 1 : 0;
  }
  get bidiLevel() {
    let e7 = this.flags & 7;
    return e7 == 7 ? null : e7;
  }
  get goalColumn() {
    let e7 = this.flags >> 6;
    return e7 == 16777215 ? void 0 : e7;
  }
  map(e7, t8 = -1) {
    let n14, i12;
    return this.empty ? n14 = i12 = e7.mapPos(this.from, t8) : (n14 = e7.mapPos(this.from, 1), i12 = e7.mapPos(this.to, -1)), n14 == this.from && i12 == this.to ? this : new s190(n14, i12, this.flags);
  }
  extend(e7, t8 = e7) {
    if (e7 <= this.anchor && t8 >= this.anchor) return x8.range(e7, t8);
    let n14 = Math.abs(e7 - this.anchor) > Math.abs(t8 - this.anchor) ? e7 : t8;
    return x8.range(this.anchor, n14);
  }
  eq(e7) {
    return this.anchor == e7.anchor && this.head == e7.head;
  }
  toJSON() {
    return { anchor: this.anchor, head: this.head };
  }
  static fromJSON(e7) {
    if (!e7 || typeof e7.anchor != "number" || typeof e7.head != "number") throw new RangeError("Invalid JSON representation for SelectionRange");
    return x8.range(e7.anchor, e7.head);
  }
  static create(e7, t8, n14) {
    return new s190(e7, t8, n14);
  }
};
var x8 = class s191 {
  constructor(e7, t8) {
    this.ranges = e7, this.mainIndex = t8;
  }
  map(e7, t8 = -1) {
    return e7.empty ? this : s191.create(this.ranges.map((n14) => n14.map(e7, t8)), this.mainIndex);
  }
  eq(e7) {
    if (this.ranges.length != e7.ranges.length || this.mainIndex != e7.mainIndex) return false;
    for (let t8 = 0; t8 < this.ranges.length; t8++) if (!this.ranges[t8].eq(e7.ranges[t8])) return false;
    return true;
  }
  get main() {
    return this.ranges[this.mainIndex];
  }
  asSingle() {
    return this.ranges.length == 1 ? this : new s191([this.main], 0);
  }
  addRange(e7, t8 = true) {
    return s191.create([e7].concat(this.ranges), t8 ? 0 : this.mainIndex + 1);
  }
  replaceRange(e7, t8 = this.mainIndex) {
    let n14 = this.ranges.slice();
    return n14[t8] = e7, s191.create(n14, this.mainIndex);
  }
  toJSON() {
    return { ranges: this.ranges.map((e7) => e7.toJSON()), main: this.mainIndex };
  }
  static fromJSON(e7) {
    if (!e7 || !Array.isArray(e7.ranges) || typeof e7.main != "number" || e7.main >= e7.ranges.length) throw new RangeError("Invalid JSON representation for EditorSelection");
    return new s191(e7.ranges.map((t8) => N14.fromJSON(t8)), e7.main);
  }
  static single(e7, t8 = e7) {
    return new s191([s191.range(e7, t8)], 0);
  }
  static create(e7, t8 = 0) {
    if (e7.length == 0) throw new RangeError("A selection needs at least one range");
    for (let n14 = 0, i12 = 0; i12 < e7.length; i12++) {
      let r2 = e7[i12];
      if (r2.empty ? r2.from <= n14 : r2.from < n14) return s191.normalized(e7.slice(), t8);
      n14 = r2.to;
    }
    return new s191(e7, t8);
  }
  static cursor(e7, t8 = 0, n14, i12) {
    return N14.create(e7, e7, (t8 == 0 ? 0 : t8 < 0 ? 8 : 16) | (n14 == null ? 7 : Math.min(6, n14)) | (i12 ?? 16777215) << 6);
  }
  static range(e7, t8, n14, i12) {
    let r2 = (n14 ?? 16777215) << 6 | (i12 == null ? 7 : Math.min(6, i12));
    return t8 < e7 ? N14.create(t8, e7, 48 | r2) : N14.create(e7, t8, (t8 > e7 ? 8 : 0) | r2);
  }
  static normalized(e7, t8 = 0) {
    let n14 = e7[t8];
    e7.sort((i12, r2) => i12.from - r2.from), t8 = e7.indexOf(n14);
    for (let i12 = 1; i12 < e7.length; i12++) {
      let r2 = e7[i12], l11 = e7[i12 - 1];
      if (r2.empty ? r2.from <= l11.to : r2.from < l11.to) {
        let h3 = l11.from, o = Math.max(r2.to, l11.to);
        i12 <= t8 && t8--, e7.splice(--i12, 2, r2.anchor > r2.head ? s191.range(o, h3) : s191.range(h3, o));
      }
    }
    return new s191(e7, t8);
  }
};
function Ne14(s212, e7) {
  for (let t8 of s212.ranges) if (t8.to > e7) throw new RangeError("Selection points outside of document");
}
var ye11 = 0;
var y13 = class s192 {
  constructor(e7, t8, n14, i12, r2) {
    this.combine = e7, this.compareInput = t8, this.compare = n14, this.isStatic = i12, this.id = ye11++, this.default = e7([]), this.extensions = typeof r2 == "function" ? r2(this) : r2;
  }
  get reader() {
    return this;
  }
  static define(e7 = {}) {
    return new s192(e7.combine || ((t8) => t8), e7.compareInput || ((t8, n14) => t8 === n14), e7.compare || (e7.combine ? (t8, n14) => t8 === n14 : Se9), !!e7.static, e7.enables);
  }
  of(e7) {
    return new V15([], this, 0, e7);
  }
  compute(e7, t8) {
    if (this.isStatic) throw new Error("Can't compute a static facet");
    return new V15(e7, this, 1, t8);
  }
  computeN(e7, t8) {
    if (this.isStatic) throw new Error("Can't compute a static facet");
    return new V15(e7, this, 2, t8);
  }
  from(e7, t8) {
    return t8 || (t8 = (n14) => n14), this.compute([e7], (n14) => t8(n14.field(e7)));
  }
};
function Se9(s212, e7) {
  return s212 == e7 || s212.length == e7.length && s212.every((t8, n14) => t8 === e7[n14]);
}
var V15 = class {
  constructor(e7, t8, n14, i12) {
    this.dependencies = e7, this.facet = t8, this.type = n14, this.value = i12, this.id = ye11++;
  }
  dynamicSlot(e7) {
    var t8;
    let n14 = this.value, i12 = this.facet.compareInput, r2 = this.id, l11 = e7[r2] >> 1, h3 = this.type == 2, o = false, a2 = false, f6 = [];
    for (let u3 of this.dependencies) u3 == "doc" ? o = true : u3 == "selection" ? a2 = true : ((t8 = e7[u3.id]) !== null && t8 !== void 0 ? t8 : 1) & 1 || f6.push(e7[u3.id]);
    return { create(u3) {
      return u3.values[l11] = n14(u3), 1;
    }, update(u3, d4) {
      if (o && d4.docChanged || a2 && (d4.docChanged || d4.selection) || de10(u3, f6)) {
        let c3 = n14(u3);
        if (h3 ? !be13(c3, u3.values[l11], i12) : !i12(c3, u3.values[l11])) return u3.values[l11] = c3, 1;
      }
      return 0;
    }, reconfigure: (u3, d4) => {
      let c3, g8 = d4.config.address[r2];
      if (g8 != null) {
        let A18 = ie7(d4, g8);
        if (this.dependencies.every((p3) => p3 instanceof y13 ? d4.facet(p3) === u3.facet(p3) : p3 instanceof $11 ? d4.field(p3, false) == u3.field(p3, false) : true) || (h3 ? be13(c3 = n14(u3), A18, i12) : i12(c3 = n14(u3), A18))) return u3.values[l11] = A18, 0;
      } else c3 = n14(u3);
      return u3.values[l11] = c3, 1;
    } };
  }
};
function be13(s212, e7, t8) {
  if (s212.length != e7.length) return false;
  for (let n14 = 0; n14 < s212.length; n14++) if (!t8(s212[n14], e7[n14])) return false;
  return true;
}
function de10(s212, e7) {
  let t8 = false;
  for (let n14 of e7) U13(s212, n14) & 1 && (t8 = true);
  return t8;
}
function Ke11(s212, e7, t8) {
  let n14 = t8.map((o) => s212[o.id]), i12 = t8.map((o) => o.type), r2 = n14.filter((o) => !(o & 1)), l11 = s212[e7.id] >> 1;
  function h3(o) {
    let a2 = [];
    for (let f6 = 0; f6 < n14.length; f6++) {
      let u3 = ie7(o, n14[f6]);
      if (i12[f6] == 2) for (let d4 of u3) a2.push(d4);
      else a2.push(u3);
    }
    return e7.combine(a2);
  }
  return { create(o) {
    for (let a2 of n14) U13(o, a2);
    return o.values[l11] = h3(o), 1;
  }, update(o, a2) {
    if (!de10(o, r2)) return 0;
    let f6 = h3(o);
    return e7.compare(f6, o.values[l11]) ? 0 : (o.values[l11] = f6, 1);
  }, reconfigure(o, a2) {
    let f6 = de10(o, n14), u3 = a2.config.facets[e7.id], d4 = a2.facet(e7);
    if (u3 && !f6 && Se9(t8, u3)) return o.values[l11] = d4, 0;
    let c3 = h3(o);
    return e7.compare(c3, d4) ? (o.values[l11] = d4, 0) : (o.values[l11] = c3, 1);
  } };
}
var Oe9 = y13.define({ static: true });
var $11 = class s193 {
  constructor(e7, t8, n14, i12, r2) {
    this.id = e7, this.createF = t8, this.updateF = n14, this.compareF = i12, this.spec = r2, this.provides = void 0;
  }
  static define(e7) {
    let t8 = new s193(ye11++, e7.create, e7.update, e7.compare || ((n14, i12) => n14 === i12), e7);
    return e7.provide && (t8.provides = e7.provide(t8)), t8;
  }
  create(e7) {
    let t8 = e7.facet(Oe9).find((n14) => n14.field == this);
    return (t8?.create || this.createF)(e7);
  }
  slot(e7) {
    let t8 = e7[this.id] >> 1;
    return { create: (n14) => (n14.values[t8] = this.create(n14), 1), update: (n14, i12) => {
      let r2 = n14.values[t8], l11 = this.updateF(r2, i12);
      return this.compareF(r2, l11) ? 0 : (n14.values[t8] = l11, 1);
    }, reconfigure: (n14, i12) => i12.config.address[this.id] != null ? (n14.values[t8] = i12.field(this), 0) : (n14.values[t8] = this.create(n14), 1) };
  }
  init(e7) {
    return [this, Oe9.of({ field: this, create: e7 })];
  }
  get extension() {
    return this;
  }
};
var R12 = { lowest: 4, low: 3, default: 2, high: 1, highest: 0 };
function W11(s212) {
  return (e7) => new ee9(e7, s212);
}
var lt10 = { highest: W11(R12.highest), high: W11(R12.high), default: W11(R12.default), low: W11(R12.low), lowest: W11(R12.lowest) };
var ee9 = class {
  constructor(e7, t8) {
    this.inner = e7, this.prec = t8;
  }
};
var te12 = class s194 {
  of(e7) {
    return new G13(this, e7);
  }
  reconfigure(e7) {
    return s194.reconfigure.of({ compartment: this, extension: e7 });
  }
  get(e7) {
    return e7.config.compartments.get(this);
  }
};
var G13 = class {
  constructor(e7, t8) {
    this.compartment = e7, this.inner = t8;
  }
};
var ne11 = class s195 {
  constructor(e7, t8, n14, i12, r2, l11) {
    for (this.base = e7, this.compartments = t8, this.dynamicSlots = n14, this.address = i12, this.staticValues = r2, this.facets = l11, this.statusTemplate = []; this.statusTemplate.length < n14.length; ) this.statusTemplate.push(0);
  }
  staticFacet(e7) {
    let t8 = this.address[e7.id];
    return t8 == null ? e7.default : this.staticValues[t8 >> 1];
  }
  static resolve(e7, t8, n14) {
    let i12 = [], r2 = /* @__PURE__ */ Object.create(null), l11 = /* @__PURE__ */ new Map();
    for (let d4 of Qe9(e7, t8, l11)) d4 instanceof $11 ? i12.push(d4) : (r2[d4.facet.id] || (r2[d4.facet.id] = [])).push(d4);
    let h3 = /* @__PURE__ */ Object.create(null), o = [], a2 = [];
    for (let d4 of i12) h3[d4.id] = a2.length << 1, a2.push((c3) => d4.slot(c3));
    let f6 = n14?.config.facets;
    for (let d4 in r2) {
      let c3 = r2[d4], g8 = c3[0].facet, A18 = f6 && f6[d4] || [];
      if (c3.every((p3) => p3.type == 0)) if (h3[g8.id] = o.length << 1 | 1, Se9(A18, c3)) o.push(n14.facet(g8));
      else {
        let p3 = g8.combine(c3.map((le18) => le18.value));
        o.push(n14 && g8.compare(p3, n14.facet(g8)) ? n14.facet(g8) : p3);
      }
      else {
        for (let p3 of c3) p3.type == 0 ? (h3[p3.id] = o.length << 1 | 1, o.push(p3.value)) : (h3[p3.id] = a2.length << 1, a2.push((le18) => p3.dynamicSlot(le18)));
        h3[g8.id] = a2.length << 1, a2.push((p3) => Ke11(p3, g8, c3));
      }
    }
    let u3 = a2.map((d4) => d4(h3));
    return new s195(e7, l11, u3, h3, o, r2);
  }
};
function Qe9(s212, e7, t8) {
  let n14 = [[], [], [], [], []], i12 = /* @__PURE__ */ new Map();
  function r2(l11, h3) {
    let o = i12.get(l11);
    if (o != null) {
      if (o <= h3) return;
      let a2 = n14[o].indexOf(l11);
      a2 > -1 && n14[o].splice(a2, 1), l11 instanceof G13 && t8.delete(l11.compartment);
    }
    if (i12.set(l11, h3), Array.isArray(l11)) for (let a2 of l11) r2(a2, h3);
    else if (l11 instanceof G13) {
      if (t8.has(l11.compartment)) throw new RangeError("Duplicate use of compartment in extensions");
      let a2 = e7.get(l11.compartment) || l11.inner;
      t8.set(l11.compartment, a2), r2(a2, h3);
    } else if (l11 instanceof ee9) r2(l11.inner, l11.prec);
    else if (l11 instanceof $11) n14[h3].push(l11), l11.provides && r2(l11.provides, h3);
    else if (l11 instanceof V15) n14[h3].push(l11), l11.facet.extensions && r2(l11.facet.extensions, R12.default);
    else {
      let a2 = l11.extension;
      if (!a2) throw new Error(`Unrecognized extension value in extension set (${l11}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);
      r2(a2, h3);
    }
  }
  return r2(s212, R12.default), n14.reduce((l11, h3) => l11.concat(h3));
}
function U13(s212, e7) {
  if (e7 & 1) return 2;
  let t8 = e7 >> 1, n14 = s212.status[t8];
  if (n14 == 4) throw new Error("Cyclic dependency between fields and/or facets");
  if (n14 & 2) return n14;
  s212.status[t8] = 4;
  let i12 = s212.computeSlot(s212, s212.config.dynamicSlots[t8]);
  return s212.status[t8] = 2 | i12;
}
function ie7(s212, e7) {
  return e7 & 1 ? s212.config.staticValues[e7 >> 1] : s212.values[e7 >> 1];
}
var Le11 = y13.define();
var De10 = y13.define({ combine: (s212) => s212.some((e7) => e7), static: true });
var Ve11 = y13.define({ combine: (s212) => s212.length ? s212[0] : void 0, static: true });
var qe11 = y13.define();
var $e12 = y13.define();
var ze12 = y13.define();
var We11 = y13.define({ combine: (s212) => s212.length ? s212[0] : false });
var J9 = class {
  constructor(e7, t8) {
    this.type = e7, this.value = t8;
  }
  static define() {
    return new ge14();
  }
};
var ge14 = class {
  of(e7) {
    return new J9(this, e7);
  }
};
var pe12 = class {
  constructor(e7) {
    this.map = e7;
  }
  of(e7) {
    return new v6(this, e7);
  }
};
var v6 = class s196 {
  constructor(e7, t8) {
    this.type = e7, this.value = t8;
  }
  map(e7) {
    let t8 = this.type.map(this.value, e7);
    return t8 === void 0 ? void 0 : t8 == this.value ? this : new s196(this.type, t8);
  }
  is(e7) {
    return this.type == e7;
  }
  static define(e7 = {}) {
    return new pe12(e7.map || ((t8) => t8));
  }
  static mapEffects(e7, t8) {
    if (!e7.length) return e7;
    let n14 = [];
    for (let i12 of e7) {
      let r2 = i12.map(t8);
      r2 && n14.push(r2);
    }
    return n14;
  }
};
v6.reconfigure = v6.define();
v6.appendConfig = v6.define();
var S12 = class s197 {
  constructor(e7, t8, n14, i12, r2, l11) {
    this.startState = e7, this.changes = t8, this.selection = n14, this.effects = i12, this.annotations = r2, this.scrollIntoView = l11, this._doc = null, this._state = null, n14 && Ne14(n14, t8.newLength), r2.some((h3) => h3.type == s197.time) || (this.annotations = r2.concat(s197.time.of(Date.now())));
  }
  static create(e7, t8, n14, i12, r2, l11) {
    return new s197(e7, t8, n14, i12, r2, l11);
  }
  get newDoc() {
    return this._doc || (this._doc = this.changes.apply(this.startState.doc));
  }
  get newSelection() {
    return this.selection || this.startState.selection.map(this.changes);
  }
  get state() {
    return this._state || this.startState.applyTransaction(this), this._state;
  }
  annotation(e7) {
    for (let t8 of this.annotations) if (t8.type == e7) return t8.value;
  }
  get docChanged() {
    return !this.changes.empty;
  }
  get reconfigured() {
    return this.startState.config != this.state.config;
  }
  isUserEvent(e7) {
    let t8 = this.annotation(s197.userEvent);
    return !!(t8 && (t8 == e7 || t8.length > e7.length && t8.slice(0, e7.length) == e7 && t8[e7.length] == "."));
  }
};
S12.time = J9.define();
S12.userEvent = J9.define();
S12.addToHistory = J9.define();
S12.remote = J9.define();
function Xe10(s212, e7) {
  let t8 = [];
  for (let n14 = 0, i12 = 0; ; ) {
    let r2, l11;
    if (n14 < s212.length && (i12 == e7.length || e7[i12] >= s212[n14])) r2 = s212[n14++], l11 = s212[n14++];
    else if (i12 < e7.length) r2 = e7[i12++], l11 = e7[i12++];
    else return t8;
    !t8.length || t8[t8.length - 1] < r2 ? t8.push(r2, l11) : t8[t8.length - 1] < l11 && (t8[t8.length - 1] = l11);
  }
}
function Ue10(s212, e7, t8) {
  var n14;
  let i12, r2, l11;
  return t8 ? (i12 = e7.changes, r2 = P14.empty(e7.changes.length), l11 = s212.changes.compose(e7.changes)) : (i12 = e7.changes.map(s212.changes), r2 = s212.changes.mapDesc(e7.changes, true), l11 = s212.changes.compose(i12)), { changes: l11, selection: e7.selection ? e7.selection.map(r2) : (n14 = s212.selection) === null || n14 === void 0 ? void 0 : n14.map(i12), effects: v6.mapEffects(s212.effects, i12).concat(v6.mapEffects(e7.effects, r2)), annotations: s212.annotations.length ? s212.annotations.concat(e7.annotations) : e7.annotations, scrollIntoView: s212.scrollIntoView || e7.scrollIntoView };
}
function me13(s212, e7, t8) {
  let n14 = e7.selection, i12 = q11(e7.annotations);
  return e7.userEvent && (i12 = i12.concat(S12.userEvent.of(e7.userEvent))), { changes: e7.changes instanceof P14 ? e7.changes : P14.of(e7.changes || [], t8, s212.facet(Ve11)), selection: n14 && (n14 instanceof x8 ? n14 : x8.single(n14.anchor, n14.head)), effects: q11(e7.effects), annotations: i12, scrollIntoView: !!e7.scrollIntoView };
}
function Ge10(s212, e7, t8) {
  let n14 = me13(s212, e7.length ? e7[0] : {}, s212.doc.length);
  e7.length && e7[0].filter === false && (t8 = false);
  for (let r2 = 1; r2 < e7.length; r2++) {
    e7[r2].filter === false && (t8 = false);
    let l11 = !!e7[r2].sequential;
    n14 = Ue10(n14, me13(s212, e7[r2], l11 ? n14.changes.newLength : s212.doc.length), l11);
  }
  let i12 = S12.create(s212, n14.changes, n14.selection, n14.effects, n14.annotations, n14.scrollIntoView);
  return _e8(t8 ? Ye10(i12) : i12);
}
function Ye10(s212) {
  let e7 = s212.startState, t8 = true;
  for (let i12 of e7.facet(qe11)) {
    let r2 = i12(s212);
    if (r2 === false) {
      t8 = false;
      break;
    }
    Array.isArray(r2) && (t8 = t8 === true ? r2 : Xe10(t8, r2));
  }
  if (t8 !== true) {
    let i12, r2;
    if (t8 === false) r2 = s212.changes.invertedDesc, i12 = P14.empty(e7.doc.length);
    else {
      let l11 = s212.changes.filter(t8);
      i12 = l11.changes, r2 = l11.filtered.mapDesc(l11.changes).invertedDesc;
    }
    s212 = S12.create(e7, i12, s212.selection && s212.selection.map(r2), v6.mapEffects(s212.effects, r2), s212.annotations, s212.scrollIntoView);
  }
  let n14 = e7.facet($e12);
  for (let i12 = n14.length - 1; i12 >= 0; i12--) {
    let r2 = n14[i12](s212);
    r2 instanceof S12 ? s212 = r2 : Array.isArray(r2) && r2.length == 1 && r2[0] instanceof S12 ? s212 = r2[0] : s212 = Ge10(e7, q11(r2), false);
  }
  return s212;
}
function _e8(s212) {
  let e7 = s212.startState, t8 = e7.facet(ze12), n14 = s212;
  for (let i12 = t8.length - 1; i12 >= 0; i12--) {
    let r2 = t8[i12](s212);
    r2 && Object.keys(r2).length && (n14 = Ue10(n14, me13(e7, r2, s212.changes.newLength), true));
  }
  return n14 == s212 ? s212 : S12.create(e7, s212.changes, s212.selection, n14.effects, n14.annotations, n14.scrollIntoView);
}
var et7 = [];
function q11(s212) {
  return s212 == null ? et7 : Array.isArray(s212) ? s212 : [s212];
}
var O13 = function(s212) {
  return s212[s212.Word = 0] = "Word", s212[s212.Space = 1] = "Space", s212[s212.Other = 2] = "Other", s212;
}(O13 || (O13 = {}));
var tt6 = /[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;
var we13;
try {
  we13 = new RegExp("[\\p{Alphabetic}\\p{Number}_]", "u");
} catch {
}
function nt10(s212) {
  if (we13) return we13.test(s212);
  for (let e7 = 0; e7 < s212.length; e7++) {
    let t8 = s212[e7];
    if (/\w/.test(t8) || t8 > "Â€" && (t8.toUpperCase() != t8.toLowerCase() || tt6.test(t8))) return true;
  }
  return false;
}
function it7(s212) {
  return (e7) => {
    if (!/\S/.test(e7)) return O13.Space;
    if (nt10(e7)) return O13.Word;
    for (let t8 = 0; t8 < s212.length; t8++) if (e7.indexOf(s212[t8]) > -1) return O13.Word;
    return O13.Other;
  };
}
var I13 = class s198 {
  constructor(e7, t8, n14, i12, r2, l11) {
    this.config = e7, this.doc = t8, this.selection = n14, this.values = i12, this.status = e7.statusTemplate.slice(), this.computeSlot = r2, l11 && (l11._state = this);
    for (let h3 = 0; h3 < this.config.dynamicSlots.length; h3++) U13(this, h3 << 1);
    this.computeSlot = null;
  }
  field(e7, t8 = true) {
    let n14 = this.config.address[e7.id];
    if (n14 == null) {
      if (t8) throw new RangeError("Field is not present in this state");
      return;
    }
    return U13(this, n14), ie7(this, n14);
  }
  update(...e7) {
    return Ge10(this, e7, true);
  }
  applyTransaction(e7) {
    let t8 = this.config, { base: n14, compartments: i12 } = t8;
    for (let l11 of e7.effects) l11.is(te12.reconfigure) ? (t8 && (i12 = /* @__PURE__ */ new Map(), t8.compartments.forEach((h3, o) => i12.set(o, h3)), t8 = null), i12.set(l11.value.compartment, l11.value.extension)) : l11.is(v6.reconfigure) ? (t8 = null, n14 = l11.value) : l11.is(v6.appendConfig) && (t8 = null, n14 = q11(n14).concat(l11.value));
    let r2;
    t8 ? r2 = e7.startState.values.slice() : (t8 = ne11.resolve(n14, i12, this), r2 = new s198(t8, this.doc, this.selection, t8.dynamicSlots.map(() => null), (h3, o) => o.reconfigure(h3, this), null).values), new s198(t8, e7.newDoc, e7.newSelection, r2, (l11, h3) => h3.update(l11, e7), e7);
  }
  replaceSelection(e7) {
    return typeof e7 == "string" && (e7 = this.toText(e7)), this.changeByRange((t8) => ({ changes: { from: t8.from, to: t8.to, insert: e7 }, range: x8.cursor(t8.from + e7.length) }));
  }
  changeByRange(e7) {
    let t8 = this.selection, n14 = e7(t8.ranges[0]), i12 = this.changes(n14.changes), r2 = [n14.range], l11 = q11(n14.effects);
    for (let h3 = 1; h3 < t8.ranges.length; h3++) {
      let o = e7(t8.ranges[h3]), a2 = this.changes(o.changes), f6 = a2.map(i12);
      for (let d4 = 0; d4 < h3; d4++) r2[d4] = r2[d4].map(f6);
      let u3 = i12.mapDesc(a2, true);
      r2.push(o.range.map(u3)), i12 = i12.compose(f6), l11 = v6.mapEffects(l11, f6).concat(v6.mapEffects(q11(o.effects), u3));
    }
    return { changes: i12, selection: x8.create(r2, t8.mainIndex), effects: l11 };
  }
  changes(e7 = []) {
    return e7 instanceof P14 ? e7 : P14.of(e7, this.doc.length, this.facet(s198.lineSeparator));
  }
  toText(e7) {
    return m6.of(e7.split(this.facet(s198.lineSeparator) || fe13));
  }
  sliceDoc(e7 = 0, t8 = this.doc.length) {
    return this.doc.sliceString(e7, t8, this.lineBreak);
  }
  facet(e7) {
    let t8 = this.config.address[e7.id];
    return t8 == null ? e7.default : (U13(this, t8), ie7(this, t8));
  }
  toJSON(e7) {
    let t8 = { doc: this.sliceDoc(), selection: this.selection.toJSON() };
    if (e7) for (let n14 in e7) {
      let i12 = e7[n14];
      i12 instanceof $11 && this.config.address[i12.id] != null && (t8[n14] = i12.spec.toJSON(this.field(e7[n14]), this));
    }
    return t8;
  }
  static fromJSON(e7, t8 = {}, n14) {
    if (!e7 || typeof e7.doc != "string") throw new RangeError("Invalid JSON representation for EditorState");
    let i12 = [];
    if (n14) {
      for (let r2 in n14) if (Object.prototype.hasOwnProperty.call(e7, r2)) {
        let l11 = n14[r2], h3 = e7[r2];
        i12.push(l11.init((o) => l11.spec.fromJSON(h3, o)));
      }
    }
    return s198.create({ doc: e7.doc, selection: x8.fromJSON(e7.selection), extensions: t8.extensions ? i12.concat([t8.extensions]) : i12 });
  }
  static create(e7 = {}) {
    let t8 = ne11.resolve(e7.extensions || [], /* @__PURE__ */ new Map()), n14 = e7.doc instanceof m6 ? e7.doc : m6.of((e7.doc || "").split(t8.staticFacet(s198.lineSeparator) || fe13)), i12 = e7.selection ? e7.selection instanceof x8 ? e7.selection : x8.single(e7.selection.anchor, e7.selection.head) : x8.single(0);
    return Ne14(i12, n14.length), t8.staticFacet(De10) || (i12 = i12.asSingle()), new s198(t8, n14, i12, t8.dynamicSlots.map(() => null), (r2, l11) => l11.create(r2), null);
  }
  get tabSize() {
    return this.facet(s198.tabSize);
  }
  get lineBreak() {
    return this.facet(s198.lineSeparator) || `
`;
  }
  get readOnly() {
    return this.facet(We11);
  }
  phrase(e7, ...t8) {
    for (let n14 of this.facet(s198.phrases)) if (Object.prototype.hasOwnProperty.call(n14, e7)) {
      e7 = n14[e7];
      break;
    }
    return t8.length && (e7 = e7.replace(/\$(\$|\d*)/g, (n14, i12) => {
      if (i12 == "$") return "$";
      let r2 = +(i12 || 1);
      return !r2 || r2 > t8.length ? n14 : t8[r2 - 1];
    })), e7;
  }
  languageDataAt(e7, t8, n14 = -1) {
    let i12 = [];
    for (let r2 of this.facet(Le11)) for (let l11 of r2(this, t8, n14)) Object.prototype.hasOwnProperty.call(l11, e7) && i12.push(l11[e7]);
    return i12;
  }
  charCategorizer(e7) {
    return it7(this.languageDataAt("wordChars", e7).join(""));
  }
  wordAt(e7) {
    let { text: t8, from: n14, length: i12 } = this.doc.lineAt(e7), r2 = this.charCategorizer(e7), l11 = e7 - n14, h3 = e7 - n14;
    for (; l11 > 0; ) {
      let o = _13(t8, l11, false);
      if (r2(t8.slice(o, l11)) != O13.Word) break;
      l11 = o;
    }
    for (; h3 < i12; ) {
      let o = _13(t8, h3);
      if (r2(t8.slice(h3, o)) != O13.Word) break;
      h3 = o;
    }
    return l11 == h3 ? null : x8.range(l11 + n14, h3 + n14);
  }
};
I13.allowMultipleSelections = De10;
I13.tabSize = y13.define({ combine: (s212) => s212.length ? s212[0] : 4 });
I13.lineSeparator = Ve11;
I13.readOnly = We11;
I13.phrases = y13.define({ compare(s212, e7) {
  let t8 = Object.keys(s212), n14 = Object.keys(e7);
  return t8.length == n14.length && t8.every((i12) => s212[i12] == e7[i12]);
} });
I13.languageData = Le11;
I13.changeFilter = qe11;
I13.transactionFilter = $e12;
I13.transactionExtender = ze12;
te12.reconfigure = v6.define();
function ht9(s212, e7, t8 = {}) {
  let n14 = {};
  for (let i12 of s212) for (let r2 of Object.keys(i12)) {
    let l11 = i12[r2], h3 = n14[r2];
    if (h3 === void 0) n14[r2] = l11;
    else if (!(h3 === l11 || l11 === void 0)) if (Object.hasOwnProperty.call(t8, r2)) n14[r2] = t8[r2](h3, l11);
    else throw new Error("Config merge conflict for field " + r2);
  }
  for (let i12 in e7) n14[i12] === void 0 && (n14[i12] = e7[i12]);
  return n14;
}
var z13 = class {
  eq(e7) {
    return this == e7;
  }
  range(e7, t8 = e7) {
    return j13.create(e7, t8, this);
  }
};
z13.prototype.startSide = z13.prototype.endSide = 0;
z13.prototype.point = false;
z13.prototype.mapMode = E7.TrackDel;
var j13 = class s199 {
  constructor(e7, t8, n14) {
    this.from = e7, this.to = t8, this.value = n14;
  }
  static create(e7, t8, n14) {
    return new s199(e7, t8, n14);
  }
};
function ve11(s212, e7) {
  return s212.from - e7.from || s212.value.startSide - e7.value.startSide;
}
var xe13 = class s200 {
  constructor(e7, t8, n14, i12) {
    this.from = e7, this.to = t8, this.value = n14, this.maxPoint = i12;
  }
  get length() {
    return this.to[this.to.length - 1];
  }
  findIndex(e7, t8, n14, i12 = 0) {
    let r2 = n14 ? this.to : this.from;
    for (let l11 = i12, h3 = r2.length; ; ) {
      if (l11 == h3) return l11;
      let o = l11 + h3 >> 1, a2 = r2[o] - e7 || (n14 ? this.value[o].endSide : this.value[o].startSide) - t8;
      if (o == l11) return a2 >= 0 ? l11 : h3;
      a2 >= 0 ? h3 = o : l11 = o + 1;
    }
  }
  between(e7, t8, n14, i12) {
    for (let r2 = this.findIndex(t8, -1e9, true), l11 = this.findIndex(n14, 1e9, false, r2); r2 < l11; r2++) if (i12(this.from[r2] + e7, this.to[r2] + e7, this.value[r2]) === false) return false;
  }
  map(e7, t8) {
    let n14 = [], i12 = [], r2 = [], l11 = -1, h3 = -1;
    for (let o = 0; o < this.value.length; o++) {
      let a2 = this.value[o], f6 = this.from[o] + e7, u3 = this.to[o] + e7, d4, c3;
      if (f6 == u3) {
        let g8 = t8.mapPos(f6, a2.startSide, a2.mapMode);
        if (g8 == null || (d4 = c3 = g8, a2.startSide != a2.endSide && (c3 = t8.mapPos(f6, a2.endSide), c3 < d4))) continue;
      } else if (d4 = t8.mapPos(f6, a2.startSide), c3 = t8.mapPos(u3, a2.endSide), d4 > c3 || d4 == c3 && a2.startSide > 0 && a2.endSide <= 0) continue;
      (c3 - d4 || a2.endSide - a2.startSide) < 0 || (l11 < 0 && (l11 = d4), a2.point && (h3 = Math.max(h3, c3 - d4)), n14.push(a2), i12.push(d4 - l11), r2.push(c3 - l11));
    }
    return { mapped: n14.length ? new s200(i12, r2, n14, h3) : null, pos: l11 };
  }
};
var T14 = class s201 {
  constructor(e7, t8, n14, i12) {
    this.chunkPos = e7, this.chunk = t8, this.nextLayer = n14, this.maxPoint = i12;
  }
  static create(e7, t8, n14, i12) {
    return new s201(e7, t8, n14, i12);
  }
  get length() {
    let e7 = this.chunk.length - 1;
    return e7 < 0 ? 0 : Math.max(this.chunkEnd(e7), this.nextLayer.length);
  }
  get size() {
    if (this.isEmpty) return 0;
    let e7 = this.nextLayer.size;
    for (let t8 of this.chunk) e7 += t8.value.length;
    return e7;
  }
  chunkEnd(e7) {
    return this.chunkPos[e7] + this.chunk[e7].length;
  }
  update(e7) {
    let { add: t8 = [], sort: n14 = false, filterFrom: i12 = 0, filterTo: r2 = this.length } = e7, l11 = e7.filter;
    if (t8.length == 0 && !l11) return this;
    if (n14 && (t8 = t8.slice().sort(ve11)), this.isEmpty) return t8.length ? s201.of(t8) : this;
    let h3 = new re10(this, null, -1).goto(0), o = 0, a2 = [], f6 = new se9();
    for (; h3.value || o < t8.length; ) if (o < t8.length && (h3.from - t8[o].from || h3.startSide - t8[o].value.startSide) >= 0) {
      let u3 = t8[o++];
      f6.addInner(u3.from, u3.to, u3.value) || a2.push(u3);
    } else h3.rangeIndex == 1 && h3.chunkIndex < this.chunk.length && (o == t8.length || this.chunkEnd(h3.chunkIndex) < t8[o].from) && (!l11 || i12 > this.chunkEnd(h3.chunkIndex) || r2 < this.chunkPos[h3.chunkIndex]) && f6.addChunk(this.chunkPos[h3.chunkIndex], this.chunk[h3.chunkIndex]) ? h3.nextChunk() : ((!l11 || i12 > h3.to || r2 < h3.from || l11(h3.from, h3.to, h3.value)) && (f6.addInner(h3.from, h3.to, h3.value) || a2.push(j13.create(h3.from, h3.to, h3.value))), h3.next());
    return f6.finishInner(this.nextLayer.isEmpty && !a2.length ? s201.empty : this.nextLayer.update({ add: a2, filter: l11, filterFrom: i12, filterTo: r2 }));
  }
  map(e7) {
    if (e7.empty || this.isEmpty) return this;
    let t8 = [], n14 = [], i12 = -1;
    for (let l11 = 0; l11 < this.chunk.length; l11++) {
      let h3 = this.chunkPos[l11], o = this.chunk[l11], a2 = e7.touchesRange(h3, h3 + o.length);
      if (a2 === false) i12 = Math.max(i12, o.maxPoint), t8.push(o), n14.push(e7.mapPos(h3));
      else if (a2 === true) {
        let { mapped: f6, pos: u3 } = o.map(h3, e7);
        f6 && (i12 = Math.max(i12, f6.maxPoint), t8.push(f6), n14.push(u3));
      }
    }
    let r2 = this.nextLayer.map(e7);
    return t8.length == 0 ? r2 : new s201(n14, t8, r2 || s201.empty, i12);
  }
  between(e7, t8, n14) {
    if (!this.isEmpty) {
      for (let i12 = 0; i12 < this.chunk.length; i12++) {
        let r2 = this.chunkPos[i12], l11 = this.chunk[i12];
        if (t8 >= r2 && e7 <= r2 + l11.length && l11.between(r2, e7 - r2, t8 - r2, n14) === false) return;
      }
      this.nextLayer.between(e7, t8, n14);
    }
  }
  iter(e7 = 0) {
    return H6.from([this]).goto(e7);
  }
  get isEmpty() {
    return this.nextLayer == this;
  }
  static iter(e7, t8 = 0) {
    return H6.from(e7).goto(t8);
  }
  static compare(e7, t8, n14, i12, r2 = -1) {
    let l11 = e7.filter((u3) => u3.maxPoint > 0 || !u3.isEmpty && u3.maxPoint >= r2), h3 = t8.filter((u3) => u3.maxPoint > 0 || !u3.isEmpty && u3.maxPoint >= r2), o = Te10(l11, h3, n14), a2 = new M6(l11, o, r2), f6 = new M6(h3, o, r2);
    n14.iterGaps((u3, d4, c3) => Re10(a2, u3, f6, d4, c3, i12)), n14.empty && n14.length == 0 && Re10(a2, 0, f6, 0, 0, i12);
  }
  static eq(e7, t8, n14 = 0, i12) {
    i12 == null && (i12 = 999999999);
    let r2 = e7.filter((f6) => !f6.isEmpty && t8.indexOf(f6) < 0), l11 = t8.filter((f6) => !f6.isEmpty && e7.indexOf(f6) < 0);
    if (r2.length != l11.length) return false;
    if (!r2.length) return true;
    let h3 = Te10(r2, l11), o = new M6(r2, h3, 0).goto(n14), a2 = new M6(l11, h3, 0).goto(n14);
    for (; ; ) {
      if (o.to != a2.to || !ke11(o.active, a2.active) || o.point && (!a2.point || !o.point.eq(a2.point))) return false;
      if (o.to > i12) return true;
      o.next(), a2.next();
    }
  }
  static spans(e7, t8, n14, i12, r2 = -1) {
    let l11 = new M6(e7, null, r2).goto(t8), h3 = t8, o = l11.openStart;
    for (; ; ) {
      let a2 = Math.min(l11.to, n14);
      if (l11.point) {
        let f6 = l11.activeForPoint(l11.to), u3 = l11.pointFrom < t8 ? f6.length + 1 : Math.min(f6.length, o);
        i12.point(h3, a2, l11.point, f6, u3, l11.pointRank), o = Math.min(l11.openEnd(a2), f6.length);
      } else a2 > h3 && (i12.span(h3, a2, l11.active, o), o = l11.openEnd(a2));
      if (l11.to > n14) return o + (l11.point && l11.to > n14 ? 1 : 0);
      h3 = l11.to, l11.next();
    }
  }
  static of(e7, t8 = false) {
    let n14 = new se9();
    for (let i12 of e7 instanceof j13 ? [e7] : t8 ? st11(e7) : e7) n14.add(i12.from, i12.to, i12.value);
    return n14.finish();
  }
};
T14.empty = new T14([], [], null, -1);
function st11(s212) {
  if (s212.length > 1) for (let e7 = s212[0], t8 = 1; t8 < s212.length; t8++) {
    let n14 = s212[t8];
    if (ve11(e7, n14) > 0) return s212.slice().sort(ve11);
    e7 = n14;
  }
  return s212;
}
T14.empty.nextLayer = T14.empty;
var se9 = class s202 {
  finishChunk(e7) {
    this.chunks.push(new xe13(this.from, this.to, this.value, this.maxPoint)), this.chunkPos.push(this.chunkStart), this.chunkStart = -1, this.setMaxPoint = Math.max(this.setMaxPoint, this.maxPoint), this.maxPoint = -1, e7 && (this.from = [], this.to = [], this.value = []);
  }
  constructor() {
    this.chunks = [], this.chunkPos = [], this.chunkStart = -1, this.last = null, this.lastFrom = -1e9, this.lastTo = -1e9, this.from = [], this.to = [], this.value = [], this.maxPoint = -1, this.setMaxPoint = -1, this.nextLayer = null;
  }
  add(e7, t8, n14) {
    this.addInner(e7, t8, n14) || (this.nextLayer || (this.nextLayer = new s202())).add(e7, t8, n14);
  }
  addInner(e7, t8, n14) {
    let i12 = e7 - this.lastTo || n14.startSide - this.last.endSide;
    if (i12 <= 0 && (e7 - this.lastFrom || n14.startSide - this.last.startSide) < 0) throw new Error("Ranges must be added sorted by `from` position and `startSide`");
    return i12 < 0 ? false : (this.from.length == 250 && this.finishChunk(true), this.chunkStart < 0 && (this.chunkStart = e7), this.from.push(e7 - this.chunkStart), this.to.push(t8 - this.chunkStart), this.last = n14, this.lastFrom = e7, this.lastTo = t8, this.value.push(n14), n14.point && (this.maxPoint = Math.max(this.maxPoint, t8 - e7)), true);
  }
  addChunk(e7, t8) {
    if ((e7 - this.lastTo || t8.value[0].startSide - this.last.endSide) < 0) return false;
    this.from.length && this.finishChunk(true), this.setMaxPoint = Math.max(this.setMaxPoint, t8.maxPoint), this.chunks.push(t8), this.chunkPos.push(e7);
    let n14 = t8.value.length - 1;
    return this.last = t8.value[n14], this.lastFrom = t8.from[n14] + e7, this.lastTo = t8.to[n14] + e7, true;
  }
  finish() {
    return this.finishInner(T14.empty);
  }
  finishInner(e7) {
    if (this.from.length && this.finishChunk(false), this.chunks.length == 0) return e7;
    let t8 = T14.create(this.chunkPos, this.chunks, this.nextLayer ? this.nextLayer.finishInner(e7) : e7, this.setMaxPoint);
    return this.from = null, t8;
  }
};
function Te10(s212, e7, t8) {
  let n14 = /* @__PURE__ */ new Map();
  for (let r2 of s212) for (let l11 = 0; l11 < r2.chunk.length; l11++) r2.chunk[l11].maxPoint <= 0 && n14.set(r2.chunk[l11], r2.chunkPos[l11]);
  let i12 = /* @__PURE__ */ new Set();
  for (let r2 of e7) for (let l11 = 0; l11 < r2.chunk.length; l11++) {
    let h3 = n14.get(r2.chunk[l11]);
    h3 != null && (t8 ? t8.mapPos(h3) : h3) == r2.chunkPos[l11] && !t8?.touchesRange(h3, h3 + r2.chunk[l11].length) && i12.add(r2.chunk[l11]);
  }
  return i12;
}
var re10 = class {
  constructor(e7, t8, n14, i12 = 0) {
    this.layer = e7, this.skip = t8, this.minPoint = n14, this.rank = i12;
  }
  get startSide() {
    return this.value ? this.value.startSide : 0;
  }
  get endSide() {
    return this.value ? this.value.endSide : 0;
  }
  goto(e7, t8 = -1e9) {
    return this.chunkIndex = this.rangeIndex = 0, this.gotoInner(e7, t8, false), this;
  }
  gotoInner(e7, t8, n14) {
    for (; this.chunkIndex < this.layer.chunk.length; ) {
      let i12 = this.layer.chunk[this.chunkIndex];
      if (!(this.skip && this.skip.has(i12) || this.layer.chunkEnd(this.chunkIndex) < e7 || i12.maxPoint < this.minPoint)) break;
      this.chunkIndex++, n14 = false;
    }
    if (this.chunkIndex < this.layer.chunk.length) {
      let i12 = this.layer.chunk[this.chunkIndex].findIndex(e7 - this.layer.chunkPos[this.chunkIndex], t8, true);
      (!n14 || this.rangeIndex < i12) && this.setRangeIndex(i12);
    }
    this.next();
  }
  forward(e7, t8) {
    (this.to - e7 || this.endSide - t8) < 0 && this.gotoInner(e7, t8, true);
  }
  next() {
    for (; ; ) if (this.chunkIndex == this.layer.chunk.length) {
      this.from = this.to = 1e9, this.value = null;
      break;
    } else {
      let e7 = this.layer.chunkPos[this.chunkIndex], t8 = this.layer.chunk[this.chunkIndex], n14 = e7 + t8.from[this.rangeIndex];
      if (this.from = n14, this.to = e7 + t8.to[this.rangeIndex], this.value = t8.value[this.rangeIndex], this.setRangeIndex(this.rangeIndex + 1), this.minPoint < 0 || this.value.point && this.to - this.from >= this.minPoint) break;
    }
  }
  setRangeIndex(e7) {
    if (e7 == this.layer.chunk[this.chunkIndex].value.length) {
      if (this.chunkIndex++, this.skip) for (; this.chunkIndex < this.layer.chunk.length && this.skip.has(this.layer.chunk[this.chunkIndex]); ) this.chunkIndex++;
      this.rangeIndex = 0;
    } else this.rangeIndex = e7;
  }
  nextChunk() {
    this.chunkIndex++, this.rangeIndex = 0, this.next();
  }
  compare(e7) {
    return this.from - e7.from || this.startSide - e7.startSide || this.rank - e7.rank || this.to - e7.to || this.endSide - e7.endSide;
  }
};
var H6 = class s203 {
  constructor(e7) {
    this.heap = e7;
  }
  static from(e7, t8 = null, n14 = -1) {
    let i12 = [];
    for (let r2 = 0; r2 < e7.length; r2++) for (let l11 = e7[r2]; !l11.isEmpty; l11 = l11.nextLayer) l11.maxPoint >= n14 && i12.push(new re10(l11, t8, n14, r2));
    return i12.length == 1 ? i12[0] : new s203(i12);
  }
  get startSide() {
    return this.value ? this.value.startSide : 0;
  }
  goto(e7, t8 = -1e9) {
    for (let n14 of this.heap) n14.goto(e7, t8);
    for (let n14 = this.heap.length >> 1; n14 >= 0; n14--) oe9(this.heap, n14);
    return this.next(), this;
  }
  forward(e7, t8) {
    for (let n14 of this.heap) n14.forward(e7, t8);
    for (let n14 = this.heap.length >> 1; n14 >= 0; n14--) oe9(this.heap, n14);
    (this.to - e7 || this.value.endSide - t8) < 0 && this.next();
  }
  next() {
    if (this.heap.length == 0) this.from = this.to = 1e9, this.value = null, this.rank = -1;
    else {
      let e7 = this.heap[0];
      this.from = e7.from, this.to = e7.to, this.value = e7.value, this.rank = e7.rank, e7.value && e7.next(), oe9(this.heap, 0);
    }
  }
};
function oe9(s212, e7) {
  for (let t8 = s212[e7]; ; ) {
    let n14 = (e7 << 1) + 1;
    if (n14 >= s212.length) break;
    let i12 = s212[n14];
    if (n14 + 1 < s212.length && i12.compare(s212[n14 + 1]) >= 0 && (i12 = s212[n14 + 1], n14++), t8.compare(i12) < 0) break;
    s212[n14] = t8, s212[e7] = i12, e7 = n14;
  }
}
var M6 = class {
  constructor(e7, t8, n14) {
    this.minPoint = n14, this.active = [], this.activeTo = [], this.activeRank = [], this.minActive = -1, this.point = null, this.pointFrom = 0, this.pointRank = 0, this.to = -1e9, this.endSide = 0, this.openStart = -1, this.cursor = H6.from(e7, t8, n14);
  }
  goto(e7, t8 = -1e9) {
    return this.cursor.goto(e7, t8), this.active.length = this.activeTo.length = this.activeRank.length = 0, this.minActive = -1, this.to = e7, this.endSide = t8, this.openStart = -1, this.next(), this;
  }
  forward(e7, t8) {
    for (; this.minActive > -1 && (this.activeTo[this.minActive] - e7 || this.active[this.minActive].endSide - t8) < 0; ) this.removeActive(this.minActive);
    this.cursor.forward(e7, t8);
  }
  removeActive(e7) {
    Z11(this.active, e7), Z11(this.activeTo, e7), Z11(this.activeRank, e7), this.minActive = Me12(this.active, this.activeTo);
  }
  addActive(e7) {
    let t8 = 0, { value: n14, to: i12, rank: r2 } = this.cursor;
    for (; t8 < this.activeRank.length && this.activeRank[t8] <= r2; ) t8++;
    K10(this.active, t8, n14), K10(this.activeTo, t8, i12), K10(this.activeRank, t8, r2), e7 && K10(e7, t8, this.cursor.from), this.minActive = Me12(this.active, this.activeTo);
  }
  next() {
    let e7 = this.to, t8 = this.point;
    this.point = null;
    let n14 = this.openStart < 0 ? [] : null;
    for (; ; ) {
      let i12 = this.minActive;
      if (i12 > -1 && (this.activeTo[i12] - this.cursor.from || this.active[i12].endSide - this.cursor.startSide) < 0) {
        if (this.activeTo[i12] > e7) {
          this.to = this.activeTo[i12], this.endSide = this.active[i12].endSide;
          break;
        }
        this.removeActive(i12), n14 && Z11(n14, i12);
      } else if (this.cursor.value) if (this.cursor.from > e7) {
        this.to = this.cursor.from, this.endSide = this.cursor.startSide;
        break;
      } else {
        let r2 = this.cursor.value;
        if (!r2.point) this.addActive(n14), this.cursor.next();
        else if (t8 && this.cursor.to == this.to && this.cursor.from < this.cursor.to) this.cursor.next();
        else {
          this.point = r2, this.pointFrom = this.cursor.from, this.pointRank = this.cursor.rank, this.to = this.cursor.to, this.endSide = r2.endSide, this.cursor.next(), this.forward(this.to, this.endSide);
          break;
        }
      }
      else {
        this.to = this.endSide = 1e9;
        break;
      }
    }
    if (n14) {
      this.openStart = 0;
      for (let i12 = n14.length - 1; i12 >= 0 && n14[i12] < e7; i12--) this.openStart++;
    }
  }
  activeForPoint(e7) {
    if (!this.active.length) return this.active;
    let t8 = [];
    for (let n14 = this.active.length - 1; n14 >= 0 && !(this.activeRank[n14] < this.pointRank); n14--) (this.activeTo[n14] > e7 || this.activeTo[n14] == e7 && this.active[n14].endSide >= this.point.endSide) && t8.push(this.active[n14]);
    return t8.reverse();
  }
  openEnd(e7) {
    let t8 = 0;
    for (let n14 = this.activeTo.length - 1; n14 >= 0 && this.activeTo[n14] > e7; n14--) t8++;
    return t8;
  }
};
function Re10(s212, e7, t8, n14, i12, r2) {
  s212.goto(e7), t8.goto(n14);
  let l11 = n14 + i12, h3 = n14, o = n14 - e7;
  for (; ; ) {
    let a2 = s212.to + o - t8.to || s212.endSide - t8.endSide, f6 = a2 < 0 ? s212.to + o : t8.to, u3 = Math.min(f6, l11);
    if (s212.point || t8.point ? s212.point && t8.point && (s212.point == t8.point || s212.point.eq(t8.point)) && ke11(s212.activeForPoint(s212.to), t8.activeForPoint(t8.to)) || r2.comparePoint(h3, u3, s212.point, t8.point) : u3 > h3 && !ke11(s212.active, t8.active) && r2.compareRange(h3, u3, s212.active, t8.active), f6 > l11) break;
    h3 = f6, a2 <= 0 && s212.next(), a2 >= 0 && t8.next();
  }
}
function ke11(s212, e7) {
  if (s212.length != e7.length) return false;
  for (let t8 = 0; t8 < s212.length; t8++) if (s212[t8] != e7[t8] && !s212[t8].eq(e7[t8])) return false;
  return true;
}
function Z11(s212, e7) {
  for (let t8 = e7, n14 = s212.length - 1; t8 < n14; t8++) s212[t8] = s212[t8 + 1];
  s212.pop();
}
function K10(s212, e7, t8) {
  for (let n14 = s212.length - 1; n14 >= e7; n14--) s212[n14 + 1] = s212[n14];
  s212[e7] = t8;
}
function Me12(s212, e7) {
  let t8 = -1, n14 = 1e9;
  for (let i12 = 0; i12 < e7.length; i12++) (e7[i12] - n14 || s212[i12].endSide - s212[t8].endSide) < 0 && (t8 = i12, n14 = e7[i12]);
  return t8;
}

// https://esm.sh/v135/@lezer/common@1.1.0/denonext/common.mjs
var _e9 = 0;
var N15 = class {
  constructor(e7, t8) {
    this.from = e7, this.to = t8;
  }
};
var v7 = class {
  constructor(e7 = {}) {
    this.id = _e9++, this.perNode = !!e7.perNode, this.deserialize = e7.deserialize || (() => {
      throw new Error("This node type doesn't define a deserialize function");
    });
  }
  add(e7) {
    if (this.perNode) throw new RangeError("Can't add per-node props to node types");
    return typeof e7 != "function" && (e7 = T15.match(e7)), (t8) => {
      let r2 = e7(t8);
      return r2 === void 0 ? null : [this, r2];
    };
  }
};
v7.closedBy = new v7({ deserialize: (l11) => l11.split(" ") });
v7.openedBy = new v7({ deserialize: (l11) => l11.split(" ") });
v7.group = new v7({ deserialize: (l11) => l11.split(" ") });
v7.contextHash = new v7({ perNode: true });
v7.lookAhead = new v7({ perNode: true });
v7.mounted = new v7({ perNode: true });
var H7 = class {
  constructor(e7, t8, r2) {
    this.tree = e7, this.overlay = t8, this.parser = r2;
  }
  static get(e7) {
    return e7 && e7.props && e7.props[v7.mounted.id];
  }
};
var Be13 = /* @__PURE__ */ Object.create(null);
var T15 = class l2 {
  constructor(e7, t8, r2, i12 = 0) {
    this.name = e7, this.props = t8, this.id = r2, this.flags = i12;
  }
  static define(e7) {
    let t8 = e7.props && e7.props.length ? /* @__PURE__ */ Object.create(null) : Be13, r2 = (e7.top ? 1 : 0) | (e7.skipped ? 2 : 0) | (e7.error ? 4 : 0) | (e7.name == null ? 8 : 0), i12 = new l2(e7.name || "", t8, e7.id, r2);
    if (e7.props) {
      for (let n14 of e7.props) if (Array.isArray(n14) || (n14 = n14(i12)), n14) {
        if (n14[0].perNode) throw new RangeError("Can't store a per-node prop on a node type");
        t8[n14[0].id] = n14[1];
      }
    }
    return i12;
  }
  prop(e7) {
    return this.props[e7.id];
  }
  get isTop() {
    return (this.flags & 1) > 0;
  }
  get isSkipped() {
    return (this.flags & 2) > 0;
  }
  get isError() {
    return (this.flags & 4) > 0;
  }
  get isAnonymous() {
    return (this.flags & 8) > 0;
  }
  is(e7) {
    if (typeof e7 == "string") {
      if (this.name == e7) return true;
      let t8 = this.prop(v7.group);
      return t8 ? t8.indexOf(e7) > -1 : false;
    }
    return this.id == e7;
  }
  static match(e7) {
    let t8 = /* @__PURE__ */ Object.create(null);
    for (let r2 in e7) for (let i12 of r2.split(" ")) t8[i12] = e7[r2];
    return (r2) => {
      for (let i12 = r2.prop(v7.group), n14 = -1; n14 < (i12 ? i12.length : 0); n14++) {
        let s212 = t8[n14 < 0 ? r2.name : i12[n14]];
        if (s212) return s212;
      }
    };
  }
};
T15.none = new T15("", /* @__PURE__ */ Object.create(null), 0, 8);
var ge15 = class l3 {
  constructor(e7) {
    this.types = e7;
    for (let t8 = 0; t8 < e7.length; t8++) if (e7[t8].id != t8) throw new RangeError("Node type ids should correspond to array positions when creating a node set");
  }
  extend(...e7) {
    let t8 = [];
    for (let r2 of this.types) {
      let i12 = null;
      for (let n14 of e7) {
        let s212 = n14(r2);
        s212 && (i12 || (i12 = Object.assign({}, r2.props)), i12[s212[0].id] = s212[1]);
      }
      t8.push(i12 ? new T15(r2.name, i12, r2.id, r2.flags) : r2);
    }
    return new l3(t8);
  }
};
var Q13 = /* @__PURE__ */ new WeakMap();
var me14 = /* @__PURE__ */ new WeakMap();
var A12;
(function(l11) {
  l11[l11.ExcludeBuffers = 1] = "ExcludeBuffers", l11[l11.IncludeAnonymous = 2] = "IncludeAnonymous", l11[l11.IgnoreMounts = 4] = "IgnoreMounts", l11[l11.IgnoreOverlays = 8] = "IgnoreOverlays";
})(A12 || (A12 = {}));
var z14 = class l4 {
  constructor(e7, t8, r2, i12, n14) {
    if (this.type = e7, this.children = t8, this.positions = r2, this.length = i12, this.props = null, n14 && n14.length) {
      this.props = /* @__PURE__ */ Object.create(null);
      for (let [s212, h3] of n14) this.props[typeof s212 == "number" ? s212 : s212.id] = h3;
    }
  }
  toString() {
    let e7 = H7.get(this);
    if (e7 && !e7.overlay) return e7.tree.toString();
    let t8 = "";
    for (let r2 of this.children) {
      let i12 = r2.toString();
      i12 && (t8 && (t8 += ","), t8 += i12);
    }
    return this.type.name ? (/\W/.test(this.type.name) && !this.type.isError ? JSON.stringify(this.type.name) : this.type.name) + (t8.length ? "(" + t8 + ")" : "") : t8;
  }
  cursor(e7 = 0) {
    return new $12(this.topNode, e7);
  }
  cursorAt(e7, t8 = 0, r2 = 0) {
    let i12 = Q13.get(this) || this.topNode, n14 = new $12(i12);
    return n14.moveTo(e7, t8), Q13.set(this, n14._tree), n14;
  }
  get topNode() {
    return new P15(this, 0, 0, null);
  }
  resolve(e7, t8 = 0) {
    let r2 = q12(Q13.get(this) || this.topNode, e7, t8, false);
    return Q13.set(this, r2), r2;
  }
  resolveInner(e7, t8 = 0) {
    let r2 = q12(me14.get(this) || this.topNode, e7, t8, true);
    return me14.set(this, r2), r2;
  }
  resolveStack(e7, t8 = 0) {
    return Ne15(this, e7, t8);
  }
  iterate(e7) {
    let { enter: t8, leave: r2, from: i12 = 0, to: n14 = this.length } = e7, s212 = e7.mode || 0, h3 = (s212 & A12.IncludeAnonymous) > 0;
    for (let f6 = this.cursor(s212 | A12.IncludeAnonymous); ; ) {
      let u3 = false;
      if (f6.from <= n14 && f6.to >= i12 && (!h3 && f6.type.isAnonymous || t8(f6) !== false)) {
        if (f6.firstChild()) continue;
        u3 = true;
      }
      for (; u3 && r2 && (h3 || !f6.type.isAnonymous) && r2(f6), !f6.nextSibling(); ) {
        if (!f6.parent()) return;
        u3 = true;
      }
    }
  }
  prop(e7) {
    return e7.perNode ? this.props ? this.props[e7.id] : void 0 : this.type.prop(e7);
  }
  get propValues() {
    let e7 = [];
    if (this.props) for (let t8 in this.props) e7.push([+t8, this.props[t8]]);
    return e7;
  }
  balance(e7 = {}) {
    return this.children.length <= 8 ? this : pe13(T15.none, this.children, this.positions, 0, this.children.length, 0, this.length, (t8, r2, i12) => new l4(this.type, t8, r2, i12, this.propValues), e7.makeTree || ((t8, r2, i12) => new l4(T15.none, t8, r2, i12)));
  }
  static build(e7) {
    return Pe13(e7);
  }
};
z14.empty = new z14(T15.none, [], [], 0);
var re11 = class l5 {
  constructor(e7, t8) {
    this.buffer = e7, this.index = t8;
  }
  get id() {
    return this.buffer[this.index - 4];
  }
  get start() {
    return this.buffer[this.index - 3];
  }
  get end() {
    return this.buffer[this.index - 2];
  }
  get size() {
    return this.buffer[this.index - 1];
  }
  get pos() {
    return this.index;
  }
  next() {
    this.index -= 4;
  }
  fork() {
    return new l5(this.buffer, this.index);
  }
};
var U14 = class l6 {
  constructor(e7, t8, r2) {
    this.buffer = e7, this.length = t8, this.set = r2;
  }
  get type() {
    return T15.none;
  }
  toString() {
    let e7 = [];
    for (let t8 = 0; t8 < this.buffer.length; ) e7.push(this.childString(t8)), t8 = this.buffer[t8 + 3];
    return e7.join(",");
  }
  childString(e7) {
    let t8 = this.buffer[e7], r2 = this.buffer[e7 + 3], i12 = this.set.types[t8], n14 = i12.name;
    if (/\W/.test(n14) && !i12.isError && (n14 = JSON.stringify(n14)), e7 += 4, r2 == e7) return n14;
    let s212 = [];
    for (; e7 < r2; ) s212.push(this.childString(e7)), e7 = this.buffer[e7 + 3];
    return n14 + "(" + s212.join(",") + ")";
  }
  findChild(e7, t8, r2, i12, n14) {
    let { buffer: s212 } = this, h3 = -1;
    for (let f6 = e7; f6 != t8 && !(Ce9(n14, i12, s212[f6 + 1], s212[f6 + 2]) && (h3 = f6, r2 > 0)); f6 = s212[f6 + 3]) ;
    return h3;
  }
  slice(e7, t8, r2) {
    let i12 = this.buffer, n14 = new Uint16Array(t8 - e7), s212 = 0;
    for (let h3 = e7, f6 = 0; h3 < t8; ) {
      n14[f6++] = i12[h3++], n14[f6++] = i12[h3++] - r2;
      let u3 = n14[f6++] = i12[h3++] - r2;
      n14[f6++] = i12[h3++] - e7, s212 = Math.max(s212, u3);
    }
    return new l6(n14, s212, this.set);
  }
};
function Ce9(l11, e7, t8, r2) {
  switch (l11) {
    case -2:
      return t8 < e7;
    case -1:
      return r2 >= e7 && t8 < e7;
    case 0:
      return t8 < e7 && r2 > e7;
    case 1:
      return t8 <= e7 && r2 > e7;
    case 2:
      return r2 > e7;
    case 4:
      return true;
  }
}
function q12(l11, e7, t8, r2) {
  for (var i12; l11.from == l11.to || (t8 < 1 ? l11.from >= e7 : l11.from > e7) || (t8 > -1 ? l11.to <= e7 : l11.to < e7); ) {
    let s212 = !r2 && l11 instanceof P15 && l11.index < 0 ? null : l11.parent;
    if (!s212) return l11;
    l11 = s212;
  }
  let n14 = r2 ? 0 : A12.IgnoreOverlays;
  if (r2) for (let s212 = l11, h3 = s212.parent; h3; s212 = h3, h3 = s212.parent) s212 instanceof P15 && s212.index < 0 && ((i12 = h3.enter(e7, t8, n14)) === null || i12 === void 0 ? void 0 : i12.from) != s212.from && (l11 = h3);
  for (; ; ) {
    let s212 = l11.enter(e7, t8, n14);
    if (!s212) return l11;
    l11 = s212;
  }
}
var Y15 = class {
  cursor(e7 = 0) {
    return new $12(this, e7);
  }
  getChild(e7, t8 = null, r2 = null) {
    let i12 = ye12(this, e7, t8, r2);
    return i12.length ? i12[0] : null;
  }
  getChildren(e7, t8 = null, r2 = null) {
    return ye12(this, e7, t8, r2);
  }
  resolve(e7, t8 = 0) {
    return q12(this, e7, t8, false);
  }
  resolveInner(e7, t8 = 0) {
    return q12(this, e7, t8, true);
  }
  matchContext(e7) {
    return ie8(this, e7);
  }
  enterUnfinishedNodesBefore(e7) {
    let t8 = this.childBefore(e7), r2 = this;
    for (; t8; ) {
      let i12 = t8.lastChild;
      if (!i12 || i12.to != t8.to) break;
      i12.type.isError && i12.from == i12.to ? (r2 = t8, t8 = i12.prevSibling) : t8 = i12;
    }
    return r2;
  }
  get node() {
    return this;
  }
  get next() {
    return this.parent;
  }
};
var P15 = class l7 extends Y15 {
  constructor(e7, t8, r2, i12) {
    super(), this._tree = e7, this.from = t8, this.index = r2, this._parent = i12;
  }
  get type() {
    return this._tree.type;
  }
  get name() {
    return this._tree.type.name;
  }
  get to() {
    return this.from + this._tree.length;
  }
  nextChild(e7, t8, r2, i12, n14 = 0) {
    for (let s212 = this; ; ) {
      for (let { children: h3, positions: f6 } = s212._tree, u3 = t8 > 0 ? h3.length : -1; e7 != u3; e7 += t8) {
        let o = h3[e7], c3 = f6[e7] + s212.from;
        if (Ce9(i12, r2, c3, c3 + o.length)) {
          if (o instanceof U14) {
            if (n14 & A12.ExcludeBuffers) continue;
            let a2 = o.findChild(0, o.buffer.length, t8, r2 - c3, i12);
            if (a2 > -1) return new J10(new ne12(s212, o, e7, c3), null, a2);
          } else if (n14 & A12.IncludeAnonymous || !o.type.isAnonymous || ae11(o)) {
            let a2;
            if (!(n14 & A12.IgnoreMounts) && (a2 = H7.get(o)) && !a2.overlay) return new l7(a2.tree, c3, e7, s212);
            let x11 = new l7(o, c3, e7, s212);
            return n14 & A12.IncludeAnonymous || !x11.type.isAnonymous ? x11 : x11.nextChild(t8 < 0 ? o.children.length - 1 : 0, t8, r2, i12);
          }
        }
      }
      if (n14 & A12.IncludeAnonymous || !s212.type.isAnonymous || (s212.index >= 0 ? e7 = s212.index + t8 : e7 = t8 < 0 ? -1 : s212._parent._tree.children.length, s212 = s212._parent, !s212)) return null;
    }
  }
  get firstChild() {
    return this.nextChild(0, 1, 0, 4);
  }
  get lastChild() {
    return this.nextChild(this._tree.children.length - 1, -1, 0, 4);
  }
  childAfter(e7) {
    return this.nextChild(0, 1, e7, 2);
  }
  childBefore(e7) {
    return this.nextChild(this._tree.children.length - 1, -1, e7, -2);
  }
  enter(e7, t8, r2 = 0) {
    let i12;
    if (!(r2 & A12.IgnoreOverlays) && (i12 = H7.get(this._tree)) && i12.overlay) {
      let n14 = e7 - this.from;
      for (let { from: s212, to: h3 } of i12.overlay) if ((t8 > 0 ? s212 <= n14 : s212 < n14) && (t8 < 0 ? h3 >= n14 : h3 > n14)) return new l7(i12.tree, i12.overlay[0].from + this.from, -1, this);
    }
    return this.nextChild(0, 1, e7, t8, r2);
  }
  nextSignificantParent() {
    let e7 = this;
    for (; e7.type.isAnonymous && e7._parent; ) e7 = e7._parent;
    return e7;
  }
  get parent() {
    return this._parent ? this._parent.nextSignificantParent() : null;
  }
  get nextSibling() {
    return this._parent && this.index >= 0 ? this._parent.nextChild(this.index + 1, 1, 0, 4) : null;
  }
  get prevSibling() {
    return this._parent && this.index >= 0 ? this._parent.nextChild(this.index - 1, -1, 0, 4) : null;
  }
  get tree() {
    return this._tree;
  }
  toTree() {
    return this._tree;
  }
  toString() {
    return this._tree.toString();
  }
};
function ye12(l11, e7, t8, r2) {
  let i12 = l11.cursor(), n14 = [];
  if (!i12.firstChild()) return n14;
  if (t8 != null) {
    for (; !i12.type.is(t8); ) if (!i12.nextSibling()) return n14;
  }
  for (; ; ) {
    if (r2 != null && i12.type.is(r2)) return n14;
    if (i12.type.is(e7) && n14.push(i12.node), !i12.nextSibling()) return r2 == null ? n14 : [];
  }
}
function ie8(l11, e7, t8 = e7.length - 1) {
  for (let r2 = l11.parent; t8 >= 0; r2 = r2.parent) {
    if (!r2) return false;
    if (!r2.type.isAnonymous) {
      if (e7[t8] && e7[t8] != r2.name) return false;
      t8--;
    }
  }
  return true;
}
var ne12 = class {
  constructor(e7, t8, r2, i12) {
    this.parent = e7, this.buffer = t8, this.index = r2, this.start = i12;
  }
};
var J10 = class l8 extends Y15 {
  get name() {
    return this.type.name;
  }
  get from() {
    return this.context.start + this.context.buffer.buffer[this.index + 1];
  }
  get to() {
    return this.context.start + this.context.buffer.buffer[this.index + 2];
  }
  constructor(e7, t8, r2) {
    super(), this.context = e7, this._parent = t8, this.index = r2, this.type = e7.buffer.set.types[e7.buffer.buffer[r2]];
  }
  child(e7, t8, r2) {
    let { buffer: i12 } = this.context, n14 = i12.findChild(this.index + 4, i12.buffer[this.index + 3], e7, t8 - this.context.start, r2);
    return n14 < 0 ? null : new l8(this.context, this, n14);
  }
  get firstChild() {
    return this.child(1, 0, 4);
  }
  get lastChild() {
    return this.child(-1, 0, 4);
  }
  childAfter(e7) {
    return this.child(1, e7, 2);
  }
  childBefore(e7) {
    return this.child(-1, e7, -2);
  }
  enter(e7, t8, r2 = 0) {
    if (r2 & A12.ExcludeBuffers) return null;
    let { buffer: i12 } = this.context, n14 = i12.findChild(this.index + 4, i12.buffer[this.index + 3], t8 > 0 ? 1 : -1, e7 - this.context.start, t8);
    return n14 < 0 ? null : new l8(this.context, this, n14);
  }
  get parent() {
    return this._parent || this.context.parent.nextSignificantParent();
  }
  externalSibling(e7) {
    return this._parent ? null : this.context.parent.nextChild(this.context.index + e7, e7, 0, 4);
  }
  get nextSibling() {
    let { buffer: e7 } = this.context, t8 = e7.buffer[this.index + 3];
    return t8 < (this._parent ? e7.buffer[this._parent.index + 3] : e7.buffer.length) ? new l8(this.context, this._parent, t8) : this.externalSibling(1);
  }
  get prevSibling() {
    let { buffer: e7 } = this.context, t8 = this._parent ? this._parent.index + 4 : 0;
    return this.index == t8 ? this.externalSibling(-1) : new l8(this.context, this._parent, e7.findChild(t8, this.index, -1, 0, 4));
  }
  get tree() {
    return null;
  }
  toTree() {
    let e7 = [], t8 = [], { buffer: r2 } = this.context, i12 = this.index + 4, n14 = r2.buffer[this.index + 3];
    if (n14 > i12) {
      let s212 = r2.buffer[this.index + 1];
      e7.push(r2.slice(i12, n14, s212)), t8.push(0);
    }
    return new z14(this.type, e7, t8, this.to - this.from);
  }
  toString() {
    return this.context.buffer.childString(this.index);
  }
};
function Se10(l11) {
  if (!l11.length) return null;
  if (l11.length == 1) return l11[0];
  let e7 = 0, t8 = l11[0];
  for (let n14 = 1; n14 < l11.length; n14++) {
    let s212 = l11[n14];
    (s212.from > t8.from || s212.to < t8.to) && (t8 = s212, e7 = n14);
  }
  let r2 = t8 instanceof P15 && t8.index < 0 ? null : t8.parent, i12 = l11.slice();
  return r2 ? i12[e7] = r2 : i12.splice(e7, 1), new se10(i12, t8);
}
var se10 = class {
  constructor(e7, t8) {
    this.heads = e7, this.node = t8;
  }
  get next() {
    return Se10(this.heads);
  }
};
function Ne15(l11, e7, t8) {
  let r2 = l11.resolveInner(e7, t8), i12 = null;
  for (let n14 = r2 instanceof P15 ? r2 : r2.context.parent; n14; n14 = n14.parent) if (n14.index < 0) {
    let s212 = n14.parent;
    (i12 || (i12 = [r2])).push(s212.resolve(e7, t8)), n14 = s212;
  } else {
    let s212 = H7.get(n14.tree);
    if (s212 && s212.overlay && s212.overlay[0].from <= e7 && s212.overlay[s212.overlay.length - 1].to >= e7) {
      let h3 = new P15(s212.tree, s212.overlay[0].from + n14.from, 0, null);
      (i12 || (i12 = [r2])).push(q12(h3, e7, t8, false));
    }
  }
  return i12 ? Se10(i12) : r2;
}
var $12 = class {
  get name() {
    return this.type.name;
  }
  constructor(e7, t8 = 0) {
    if (this.mode = t8, this.buffer = null, this.stack = [], this.index = 0, this.bufferNode = null, e7 instanceof P15) this.yieldNode(e7);
    else {
      this._tree = e7.context.parent, this.buffer = e7.context;
      for (let r2 = e7._parent; r2; r2 = r2._parent) this.stack.unshift(r2.index);
      this.bufferNode = e7, this.yieldBuf(e7.index);
    }
  }
  yieldNode(e7) {
    return e7 ? (this._tree = e7, this.type = e7.type, this.from = e7.from, this.to = e7.to, true) : false;
  }
  yieldBuf(e7, t8) {
    this.index = e7;
    let { start: r2, buffer: i12 } = this.buffer;
    return this.type = t8 || i12.set.types[i12.buffer[e7]], this.from = r2 + i12.buffer[e7 + 1], this.to = r2 + i12.buffer[e7 + 2], true;
  }
  yield(e7) {
    return e7 ? e7 instanceof P15 ? (this.buffer = null, this.yieldNode(e7)) : (this.buffer = e7.context, this.yieldBuf(e7.index, e7.type)) : false;
  }
  toString() {
    return this.buffer ? this.buffer.buffer.childString(this.index) : this._tree.toString();
  }
  enterChild(e7, t8, r2) {
    if (!this.buffer) return this.yield(this._tree.nextChild(e7 < 0 ? this._tree._tree.children.length - 1 : 0, e7, t8, r2, this.mode));
    let { buffer: i12 } = this.buffer, n14 = i12.findChild(this.index + 4, i12.buffer[this.index + 3], e7, t8 - this.buffer.start, r2);
    return n14 < 0 ? false : (this.stack.push(this.index), this.yieldBuf(n14));
  }
  firstChild() {
    return this.enterChild(1, 0, 4);
  }
  lastChild() {
    return this.enterChild(-1, 0, 4);
  }
  childAfter(e7) {
    return this.enterChild(1, e7, 2);
  }
  childBefore(e7) {
    return this.enterChild(-1, e7, -2);
  }
  enter(e7, t8, r2 = this.mode) {
    return this.buffer ? r2 & A12.ExcludeBuffers ? false : this.enterChild(1, e7, t8) : this.yield(this._tree.enter(e7, t8, r2));
  }
  parent() {
    if (!this.buffer) return this.yieldNode(this.mode & A12.IncludeAnonymous ? this._tree._parent : this._tree.parent);
    if (this.stack.length) return this.yieldBuf(this.stack.pop());
    let e7 = this.mode & A12.IncludeAnonymous ? this.buffer.parent : this.buffer.parent.nextSignificantParent();
    return this.buffer = null, this.yieldNode(e7);
  }
  sibling(e7) {
    if (!this.buffer) return this._tree._parent ? this.yield(this._tree.index < 0 ? null : this._tree._parent.nextChild(this._tree.index + e7, e7, 0, 4, this.mode)) : false;
    let { buffer: t8 } = this.buffer, r2 = this.stack.length - 1;
    if (e7 < 0) {
      let i12 = r2 < 0 ? 0 : this.stack[r2] + 4;
      if (this.index != i12) return this.yieldBuf(t8.findChild(i12, this.index, -1, 0, 4));
    } else {
      let i12 = t8.buffer[this.index + 3];
      if (i12 < (r2 < 0 ? t8.buffer.length : t8.buffer[this.stack[r2] + 3])) return this.yieldBuf(i12);
    }
    return r2 < 0 ? this.yield(this.buffer.parent.nextChild(this.buffer.index + e7, e7, 0, 4, this.mode)) : false;
  }
  nextSibling() {
    return this.sibling(1);
  }
  prevSibling() {
    return this.sibling(-1);
  }
  atLastNode(e7) {
    let t8, r2, { buffer: i12 } = this;
    if (i12) {
      if (e7 > 0) {
        if (this.index < i12.buffer.buffer.length) return false;
      } else for (let n14 = 0; n14 < this.index; n14++) if (i12.buffer.buffer[n14 + 3] < this.index) return false;
      ({ index: t8, parent: r2 } = i12);
    } else ({ index: t8, _parent: r2 } = this._tree);
    for (; r2; { index: t8, _parent: r2 } = r2) if (t8 > -1) for (let n14 = t8 + e7, s212 = e7 < 0 ? -1 : r2._tree.children.length; n14 != s212; n14 += e7) {
      let h3 = r2._tree.children[n14];
      if (this.mode & A12.IncludeAnonymous || h3 instanceof U14 || !h3.type.isAnonymous || ae11(h3)) return false;
    }
    return true;
  }
  move(e7, t8) {
    if (t8 && this.enterChild(e7, 0, 4)) return true;
    for (; ; ) {
      if (this.sibling(e7)) return true;
      if (this.atLastNode(e7) || !this.parent()) return false;
    }
  }
  next(e7 = true) {
    return this.move(1, e7);
  }
  prev(e7 = true) {
    return this.move(-1, e7);
  }
  moveTo(e7, t8 = 0) {
    for (; (this.from == this.to || (t8 < 1 ? this.from >= e7 : this.from > e7) || (t8 > -1 ? this.to <= e7 : this.to < e7)) && this.parent(); ) ;
    for (; this.enterChild(1, e7, t8); ) ;
    return this;
  }
  get node() {
    if (!this.buffer) return this._tree;
    let e7 = this.bufferNode, t8 = null, r2 = 0;
    if (e7 && e7.context == this.buffer) e: for (let i12 = this.index, n14 = this.stack.length; n14 >= 0; ) {
      for (let s212 = e7; s212; s212 = s212._parent) if (s212.index == i12) {
        if (i12 == this.index) return s212;
        t8 = s212, r2 = n14 + 1;
        break e;
      }
      i12 = this.stack[--n14];
    }
    for (let i12 = r2; i12 < this.stack.length; i12++) t8 = new J10(this.buffer, t8, this.stack[i12]);
    return this.bufferNode = new J10(this.buffer, t8, this.index);
  }
  get tree() {
    return this.buffer ? null : this._tree._tree;
  }
  iterate(e7, t8) {
    for (let r2 = 0; ; ) {
      let i12 = false;
      if (this.type.isAnonymous || e7(this) !== false) {
        if (this.firstChild()) {
          r2++;
          continue;
        }
        this.type.isAnonymous || (i12 = true);
      }
      for (; i12 && t8 && t8(this), i12 = this.type.isAnonymous, !this.nextSibling(); ) {
        if (!r2) return;
        this.parent(), r2--, i12 = true;
      }
    }
  }
  matchContext(e7) {
    if (!this.buffer) return ie8(this.node, e7);
    let { buffer: t8 } = this.buffer, { types: r2 } = t8.set;
    for (let i12 = e7.length - 1, n14 = this.stack.length - 1; i12 >= 0; n14--) {
      if (n14 < 0) return ie8(this.node, e7, i12);
      let s212 = r2[t8.buffer[this.stack[n14]]];
      if (!s212.isAnonymous) {
        if (e7[i12] && e7[i12] != s212.name) return false;
        i12--;
      }
    }
    return true;
  }
};
function ae11(l11) {
  return l11.children.some((e7) => e7 instanceof U14 || !e7.type.isAnonymous || ae11(e7));
}
function Pe13(l11) {
  var e7;
  let { buffer: t8, nodeSet: r2, maxBufferLength: i12 = 1024, reused: n14 = [], minRepeatType: s212 = r2.types.length } = l11, h3 = Array.isArray(t8) ? new re11(t8, t8.length) : t8, f6 = r2.types, u3 = 0, o = 0;
  function c3(b12, w14, p3, m11, C11) {
    let { id: y18, start: g8, end: k16, size: B15 } = h3, E11 = o;
    for (; B15 < 0; ) if (h3.next(), B15 == -1) {
      let L19 = n14[y18];
      p3.push(L19), m11.push(g8 - b12);
      return;
    } else if (B15 == -3) {
      u3 = y18;
      return;
    } else if (B15 == -4) {
      o = y18;
      return;
    } else throw new RangeError(`Unrecognized record size: ${B15}`);
    let V22 = f6[y18], R19, F22, ce21 = g8 - b12;
    if (k16 - g8 <= i12 && (F22 = _18(h3.pos - w14, C11))) {
      let L19 = new Uint16Array(F22.size - F22.skip), M12 = h3.pos - F22.size, D14 = L19.length;
      for (; h3.pos > M12; ) D14 = O18(F22.start, L19, D14);
      R19 = new U14(L19, k16 - F22.start, r2), ce21 = F22.start - b12;
    } else {
      let L19 = h3.pos - B15;
      h3.next();
      let M12 = [], D14 = [], W15 = y18 >= s212 ? y18 : -1, G19 = 0, K16 = k16;
      for (; h3.pos > L19; ) W15 >= 0 && h3.id == W15 && h3.size >= 0 ? (h3.end <= K16 - i12 && (x11(M12, D14, g8, G19, h3.end, K16, W15, E11), G19 = M12.length, K16 = h3.end), h3.next()) : c3(g8, L19, M12, D14, W15);
      if (W15 >= 0 && G19 > 0 && G19 < M12.length && x11(M12, D14, g8, G19, g8, K16, W15, E11), M12.reverse(), D14.reverse(), W15 > -1 && G19 > 0) {
        let de18 = a2(V22);
        R19 = pe13(V22, M12, D14, 0, M12.length, 0, k16 - g8, de18, de18);
      } else R19 = d4(V22, M12, D14, k16 - g8, E11 - k16);
    }
    p3.push(R19), m11.push(ce21);
  }
  function a2(b12) {
    return (w14, p3, m11) => {
      let C11 = 0, y18 = w14.length - 1, g8, k16;
      if (y18 >= 0 && (g8 = w14[y18]) instanceof z14) {
        if (!y18 && g8.type == b12 && g8.length == m11) return g8;
        (k16 = g8.prop(v7.lookAhead)) && (C11 = p3[y18] + g8.length + k16);
      }
      return d4(b12, w14, p3, m11, C11);
    };
  }
  function x11(b12, w14, p3, m11, C11, y18, g8, k16) {
    let B15 = [], E11 = [];
    for (; b12.length > m11; ) B15.push(b12.pop()), E11.push(w14.pop() + p3 - C11);
    b12.push(d4(r2.types[g8], B15, E11, y18 - C11, k16 - y18)), w14.push(C11 - p3);
  }
  function d4(b12, w14, p3, m11, C11 = 0, y18) {
    if (u3) {
      let g8 = [v7.contextHash, u3];
      y18 = y18 ? [g8].concat(y18) : [g8];
    }
    if (C11 > 25) {
      let g8 = [v7.lookAhead, C11];
      y18 = y18 ? [g8].concat(y18) : [g8];
    }
    return new z14(b12, w14, p3, m11, y18);
  }
  function _18(b12, w14) {
    let p3 = h3.fork(), m11 = 0, C11 = 0, y18 = 0, g8 = p3.end - i12, k16 = { size: 0, start: 0, skip: 0 };
    e: for (let B15 = p3.pos - b12; p3.pos > B15; ) {
      let E11 = p3.size;
      if (p3.id == w14 && E11 >= 0) {
        k16.size = m11, k16.start = C11, k16.skip = y18, y18 += 4, m11 += 4, p3.next();
        continue;
      }
      let V22 = p3.pos - E11;
      if (E11 < 0 || V22 < B15 || p3.start < g8) break;
      let R19 = p3.id >= s212 ? 4 : 0, F22 = p3.start;
      for (p3.next(); p3.pos > V22; ) {
        if (p3.size < 0) if (p3.size == -3) R19 += 4;
        else break e;
        else p3.id >= s212 && (R19 += 4);
        p3.next();
      }
      C11 = F22, m11 += E11, y18 += R19;
    }
    return (w14 < 0 || m11 == b12) && (k16.size = m11, k16.start = C11, k16.skip = y18), k16.size > 4 ? k16 : void 0;
  }
  function O18(b12, w14, p3) {
    let { id: m11, start: C11, end: y18, size: g8 } = h3;
    if (h3.next(), g8 >= 0 && m11 < s212) {
      let k16 = p3;
      if (g8 > 4) {
        let B15 = h3.pos - (g8 - 4);
        for (; h3.pos > B15; ) p3 = O18(b12, w14, p3);
      }
      w14[--p3] = k16, w14[--p3] = y18 - b12, w14[--p3] = C11 - b12, w14[--p3] = m11;
    } else g8 == -3 ? u3 = m11 : g8 == -4 && (o = m11);
    return p3;
  }
  let I22 = [], j19 = [];
  for (; h3.pos > 0; ) c3(l11.start || 0, l11.bufferStart || 0, I22, j19, -1);
  let S17 = (e7 = l11.length) !== null && e7 !== void 0 ? e7 : I22.length ? j19[0] + I22[0].length : 0;
  return new z14(f6[l11.topID], I22.reverse(), j19.reverse(), S17);
}
var xe14 = /* @__PURE__ */ new WeakMap();
function X13(l11, e7) {
  if (!l11.isAnonymous || e7 instanceof U14 || e7.type != l11) return 1;
  let t8 = xe14.get(e7);
  if (t8 == null) {
    t8 = 1;
    for (let r2 of e7.children) {
      if (r2.type != l11 || !(r2 instanceof z14)) {
        t8 = 1;
        break;
      }
      t8 += X13(l11, r2);
    }
    xe14.set(e7, t8);
  }
  return t8;
}
function pe13(l11, e7, t8, r2, i12, n14, s212, h3, f6) {
  let u3 = 0;
  for (let d4 = r2; d4 < i12; d4++) u3 += X13(l11, e7[d4]);
  let o = Math.ceil(u3 * 1.5 / 8), c3 = [], a2 = [];
  function x11(d4, _18, O18, I22, j19) {
    for (let S17 = O18; S17 < I22; ) {
      let b12 = S17, w14 = _18[S17], p3 = X13(l11, d4[S17]);
      for (S17++; S17 < I22; S17++) {
        let m11 = X13(l11, d4[S17]);
        if (p3 + m11 >= o) break;
        p3 += m11;
      }
      if (S17 == b12 + 1) {
        if (p3 > o) {
          let m11 = d4[b12];
          x11(m11.children, m11.positions, 0, m11.children.length, _18[b12] + j19);
          continue;
        }
        c3.push(d4[b12]);
      } else {
        let m11 = _18[S17 - 1] + d4[S17 - 1].length - w14;
        c3.push(pe13(l11, d4, _18, b12, S17, w14, m11, null, f6));
      }
      a2.push(w14 + j19 - n14);
    }
  }
  return x11(e7, t8, r2, i12, 0), (h3 || f6)(c3, a2, s212);
}
var Z12 = class l9 {
  constructor(e7, t8, r2, i12, n14 = false, s212 = false) {
    this.from = e7, this.to = t8, this.tree = r2, this.offset = i12, this.open = (n14 ? 1 : 0) | (s212 ? 2 : 0);
  }
  get openStart() {
    return (this.open & 1) > 0;
  }
  get openEnd() {
    return (this.open & 2) > 0;
  }
  static addTree(e7, t8 = [], r2 = false) {
    let i12 = [new l9(0, e7.length, e7, 0, false, r2)];
    for (let n14 of t8) n14.to > e7.length && i12.push(n14);
    return i12;
  }
  static applyChanges(e7, t8, r2 = 128) {
    if (!t8.length) return e7;
    let i12 = [], n14 = 1, s212 = e7.length ? e7[0] : null;
    for (let h3 = 0, f6 = 0, u3 = 0; ; h3++) {
      let o = h3 < t8.length ? t8[h3] : null, c3 = o ? o.fromA : 1e9;
      if (c3 - f6 >= r2) for (; s212 && s212.from < c3; ) {
        let a2 = s212;
        if (f6 >= a2.from || c3 <= a2.to || u3) {
          let x11 = Math.max(a2.from, f6) - u3, d4 = Math.min(a2.to, c3) - u3;
          a2 = x11 >= d4 ? null : new l9(x11, d4, a2.tree, a2.offset + u3, h3 > 0, !!o);
        }
        if (a2 && i12.push(a2), s212.to > c3) break;
        s212 = n14 < e7.length ? e7[n14++] : null;
      }
      if (!o) break;
      f6 = o.toA, u3 = o.toA - o.toB;
    }
    return i12;
  }
};
var we14 = class {
  startParse(e7, t8, r2) {
    return typeof e7 == "string" && (e7 = new le12(e7)), r2 = r2 ? r2.length ? r2.map((i12) => new N15(i12.from, i12.to)) : [new N15(0, 0)] : [new N15(0, e7.length)], this.createParse(e7, t8 || [], r2);
  }
  parse(e7, t8, r2) {
    let i12 = this.startParse(e7, t8, r2);
    for (; ; ) {
      let n14 = i12.advance();
      if (n14) return n14;
    }
  }
};
var le12 = class {
  constructor(e7) {
    this.string = e7;
  }
  get length() {
    return this.string.length;
  }
  chunk(e7) {
    return this.string.slice(e7);
  }
  get lineChunks() {
    return false;
  }
  read(e7, t8) {
    return this.string.slice(e7, t8);
  }
};
var fe14 = new v7({ perNode: true });

// https://esm.sh/v135/@lezer/highlight@1.2.0/denonext/highlight.mjs
var G14 = 0;
var y14 = class s204 {
  constructor(t8, a2, i12) {
    this.set = t8, this.base = a2, this.modified = i12, this.id = G14++;
  }
  static define(t8) {
    if (t8?.base) throw new Error("Can not derive from a modified tag");
    let a2 = new s204([], null, []);
    if (a2.set.push(a2), t8) for (let i12 of t8.set) a2.set.push(i12);
    return a2;
  }
  static defineModifier() {
    let t8 = new E8();
    return (a2) => a2.modified.indexOf(t8) > -1 ? a2 : E8.get(a2.base || a2, a2.modified.concat(t8).sort((i12, n14) => i12.id - n14.id));
  }
};
var L12 = 0;
var E8 = class s205 {
  constructor() {
    this.instances = [], this.id = L12++;
  }
  static get(t8, a2) {
    if (!a2.length) return t8;
    let i12 = a2[0].instances.find((o) => o.base == t8 && Q14(a2, o.modified));
    if (i12) return i12;
    let n14 = [], r2 = new y14(n14, t8, a2);
    for (let o of a2) o.instances.push(r2);
    let h3 = U15(a2);
    for (let o of t8.set) if (!o.modified.length) for (let p3 of h3) n14.push(s205.get(o, p3));
    return r2;
  }
};
function Q14(s212, t8) {
  return s212.length == t8.length && s212.every((a2, i12) => a2 == t8[i12]);
}
function U15(s212) {
  let t8 = [[]];
  for (let a2 = 0; a2 < s212.length; a2++) for (let i12 = 0, n14 = t8.length; i12 < n14; i12++) t8.push(t8[i12].concat(s212[a2]));
  return t8.sort((a2, i12) => i12.length - a2.length);
}
function _14(s212) {
  let t8 = /* @__PURE__ */ Object.create(null);
  for (let a2 in s212) {
    let i12 = s212[a2];
    Array.isArray(i12) || (i12 = [i12]);
    for (let n14 of a2.split(" ")) if (n14) {
      let r2 = [], h3 = 2, o = n14;
      for (let f6 = 0; ; ) {
        if (o == "..." && f6 > 0 && f6 + 3 == n14.length) {
          h3 = 1;
          break;
        }
        let c3 = /^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(o);
        if (!c3) throw new RangeError("Invalid path: " + n14);
        if (r2.push(c3[0] == "*" ? "" : c3[0][0] == '"' ? JSON.parse(c3[0]) : c3[0]), f6 += c3[0].length, f6 == n14.length) break;
        let d4 = n14[f6++];
        if (f6 == n14.length && d4 == "!") {
          h3 = 0;
          break;
        }
        if (d4 != "/") throw new RangeError("Invalid path: " + n14);
        o = n14.slice(f6);
      }
      let p3 = r2.length - 1, g8 = r2[p3];
      if (!g8) throw new RangeError("Invalid path: " + n14);
      let b12 = new M7(i12, h3, p3 > 0 ? r2.slice(0, p3) : null);
      t8[g8] = b12.sort(t8[g8]);
    }
  }
  return z15.add(t8);
}
var z15 = new v7();
var M7 = class {
  constructor(t8, a2, i12, n14) {
    this.tags = t8, this.mode = a2, this.context = i12, this.next = n14;
  }
  get opaque() {
    return this.mode == 0;
  }
  get inherit() {
    return this.mode == 1;
  }
  sort(t8) {
    return !t8 || t8.depth < this.depth ? (this.next = t8, this) : (t8.next = this.sort(t8.next), t8);
  }
  get depth() {
    return this.context ? this.context.length : 0;
  }
};
M7.empty = new M7([], 2, null);
function W12(s212, t8) {
  let a2 = /* @__PURE__ */ Object.create(null);
  for (let r2 of s212) if (!Array.isArray(r2.tag)) a2[r2.tag.id] = r2.class;
  else for (let h3 of r2.tag) a2[h3.id] = r2.class;
  let { scope: i12, all: n14 = null } = t8 || {};
  return { style: (r2) => {
    let h3 = n14;
    for (let o of r2) for (let p3 of o.set) {
      let g8 = a2[p3.id];
      if (g8) {
        h3 = h3 ? h3 + " " + g8 : g8;
        break;
      }
    }
    return h3;
  }, scope: i12 };
}
function X14(s212, t8) {
  let a2 = null;
  for (let i12 of s212) {
    let n14 = i12.style(t8);
    n14 && (a2 = a2 ? a2 + " " + n14 : n14);
  }
  return a2;
}
function Y16(s212, t8, a2, i12 = 0, n14 = s212.length) {
  let r2 = new P16(i12, Array.isArray(t8) ? t8 : [t8], a2);
  r2.highlightRange(s212.cursor(), i12, n14, "", r2.highlighters), r2.flush(n14);
}
var P16 = class {
  constructor(t8, a2, i12) {
    this.at = t8, this.highlighters = a2, this.span = i12, this.class = "";
  }
  startSpan(t8, a2) {
    a2 != this.class && (this.flush(t8), t8 > this.at && (this.at = t8), this.class = a2);
  }
  flush(t8) {
    t8 > this.at && this.class && this.span(this.at, t8, this.class);
  }
  highlightRange(t8, a2, i12, n14, r2) {
    let { type: h3, from: o, to: p3 } = t8;
    if (o >= i12 || p3 <= a2) return;
    h3.isTop && (r2 = this.highlighters.filter((d4) => !d4.scope || d4.scope(h3)));
    let g8 = n14, b12 = Z13(t8) || M7.empty, f6 = X14(r2, b12.tags);
    if (f6 && (g8 && (g8 += " "), g8 += f6, b12.mode == 1 && (n14 += (n14 ? " " : "") + f6)), this.startSpan(Math.max(a2, o), g8), b12.opaque) return;
    let c3 = t8.tree && t8.tree.prop(v7.mounted);
    if (c3 && c3.overlay) {
      let d4 = t8.node.enter(c3.overlay[0].from + o, 1), R19 = this.highlighters.filter((v10) => !v10.scope || v10.scope(c3.tree.type)), D14 = t8.firstChild();
      for (let v10 = 0, O18 = o; ; v10++) {
        let S17 = v10 < c3.overlay.length ? c3.overlay[v10] : null, K16 = S17 ? S17.from + o : p3, H12 = Math.max(a2, O18), T22 = Math.min(i12, K16);
        if (H12 < T22 && D14) for (; t8.from < T22 && (this.highlightRange(t8, H12, T22, n14, r2), this.startSpan(Math.min(T22, t8.to), g8), !(t8.to >= K16 || !t8.nextSibling())); ) ;
        if (!S17 || K16 > i12) break;
        O18 = S17.to + o, O18 > a2 && (this.highlightRange(d4.cursor(), Math.max(a2, S17.from + o), Math.min(i12, O18), "", R19), this.startSpan(Math.min(i12, O18), g8));
      }
      D14 && t8.parent();
    } else if (t8.firstChild()) {
      c3 && (n14 = "");
      do
        if (!(t8.to <= a2)) {
          if (t8.from >= i12) break;
          this.highlightRange(t8, a2, i12, n14, r2), this.startSpan(Math.min(i12, t8.to), g8);
        }
      while (t8.nextSibling());
      t8.parent();
    }
  }
};
function Z13(s212) {
  let t8 = s212.type.prop(z15);
  for (; t8 && t8.context && !s212.matchContext(t8.context); ) t8 = t8.next;
  return t8 || null;
}
var e4 = y14.define;
var C8 = e4();
var N16 = e4();
var F15 = e4(N16);
var J11 = e4(N16);
var x9 = e4();
var I14 = e4(x9);
var j14 = e4(x9);
var k9 = e4();
var w11 = e4(k9);
var m7 = e4();
var u2 = e4();
var B9 = e4();
var A13 = e4(B9);
var q13 = e4();
var l10 = { comment: C8, lineComment: e4(C8), blockComment: e4(C8), docComment: e4(C8), name: N16, variableName: e4(N16), typeName: F15, tagName: e4(F15), propertyName: J11, attributeName: e4(J11), className: e4(N16), labelName: e4(N16), namespace: e4(N16), macroName: e4(N16), literal: x9, string: I14, docString: e4(I14), character: e4(I14), attributeValue: e4(I14), number: j14, integer: e4(j14), float: e4(j14), bool: e4(x9), regexp: e4(x9), escape: e4(x9), color: e4(x9), url: e4(x9), keyword: m7, self: e4(m7), null: e4(m7), atom: e4(m7), unit: e4(m7), modifier: e4(m7), operatorKeyword: e4(m7), controlKeyword: e4(m7), definitionKeyword: e4(m7), moduleKeyword: e4(m7), operator: u2, derefOperator: e4(u2), arithmeticOperator: e4(u2), logicOperator: e4(u2), bitwiseOperator: e4(u2), compareOperator: e4(u2), updateOperator: e4(u2), definitionOperator: e4(u2), typeOperator: e4(u2), controlOperator: e4(u2), punctuation: B9, separator: e4(B9), bracket: A13, angleBracket: e4(A13), squareBracket: e4(A13), paren: e4(A13), brace: e4(A13), content: k9, heading: w11, heading1: e4(w11), heading2: e4(w11), heading3: e4(w11), heading4: e4(w11), heading5: e4(w11), heading6: e4(w11), contentSeparator: e4(k9), list: e4(k9), quote: e4(k9), emphasis: e4(k9), strong: e4(k9), link: e4(k9), monospace: e4(k9), strikethrough: e4(k9), inserted: e4(), deleted: e4(), changed: e4(), invalid: e4(), meta: q13, documentMeta: e4(q13), annotation: e4(q13), processingInstruction: e4(q13), definition: y14.defineModifier(), constant: y14.defineModifier(), function: y14.defineModifier(), standard: y14.defineModifier(), local: y14.defineModifier(), special: y14.defineModifier() };
var et8 = W12([{ tag: l10.link, class: "tok-link" }, { tag: l10.heading, class: "tok-heading" }, { tag: l10.emphasis, class: "tok-emphasis" }, { tag: l10.strong, class: "tok-strong" }, { tag: l10.keyword, class: "tok-keyword" }, { tag: l10.atom, class: "tok-atom" }, { tag: l10.bool, class: "tok-bool" }, { tag: l10.url, class: "tok-url" }, { tag: l10.labelName, class: "tok-labelName" }, { tag: l10.inserted, class: "tok-inserted" }, { tag: l10.deleted, class: "tok-deleted" }, { tag: l10.literal, class: "tok-literal" }, { tag: l10.string, class: "tok-string" }, { tag: l10.number, class: "tok-number" }, { tag: [l10.regexp, l10.escape, l10.special(l10.string)], class: "tok-string2" }, { tag: l10.variableName, class: "tok-variableName" }, { tag: l10.local(l10.variableName), class: "tok-variableName tok-local" }, { tag: l10.definition(l10.variableName), class: "tok-variableName tok-definition" }, { tag: l10.special(l10.variableName), class: "tok-variableName2" }, { tag: l10.definition(l10.propertyName), class: "tok-propertyName tok-definition" }, { tag: l10.typeName, class: "tok-typeName" }, { tag: l10.namespace, class: "tok-namespace" }, { tag: l10.className, class: "tok-className" }, { tag: l10.macroName, class: "tok-macroName" }, { tag: l10.propertyName, class: "tok-propertyName" }, { tag: l10.operator, class: "tok-operator" }, { tag: l10.comment, class: "tok-comment" }, { tag: l10.meta, class: "tok-meta" }, { tag: l10.invalid, class: "tok-invalid" }, { tag: l10.punctuation, class: "tok-punctuation" }]);

// https://esm.sh/v135/@codemirror/language@6.9.2/denonext/language.mjs
var K11;
var A14 = new v7();
var oe10 = new v7();
var d2 = class {
  constructor(t8, e7, r2 = [], i12 = "") {
    this.data = t8, this.name = i12, I11.prototype.hasOwnProperty("tree") || Object.defineProperty(I11.prototype, "tree", { get() {
      return k10(this);
    } }), this.parser = e7, this.extension = [S13.of(this), I11.languageData.of((s212, o, l11) => {
      let a2 = pt8(s212, o, l11), h3 = a2.type.prop(A14);
      if (!h3) return [];
      let f6 = s212.facet(h3), c3 = a2.type.prop(oe10);
      if (c3) {
        let g8 = a2.resolve(o - a2.from, l11);
        for (let p3 of c3) if (p3.test(g8, s212)) {
          let y18 = s212.facet(p3.facet);
          return p3.type == "replace" ? y18 : y18.concat(f6);
        }
      }
      return f6;
    })].concat(r2);
  }
  isActiveAt(t8, e7, r2 = -1) {
    return pt8(t8, e7, r2).type.prop(A14) == this.data;
  }
  findRegions(t8) {
    let e7 = t8.facet(S13);
    if (e7?.data == this.data) return [{ from: 0, to: t8.doc.length }];
    if (!e7 || !e7.allowsNesting) return [];
    let r2 = [], i12 = (s212, o) => {
      if (s212.prop(A14) == this.data) {
        r2.push({ from: o, to: o + s212.length });
        return;
      }
      let l11 = s212.prop(v7.mounted);
      if (l11) {
        if (l11.tree.prop(A14) == this.data) {
          if (l11.overlay) for (let a2 of l11.overlay) r2.push({ from: a2.from + o, to: a2.to + o });
          else r2.push({ from: o, to: o + s212.length });
          return;
        } else if (l11.overlay) {
          let a2 = r2.length;
          if (i12(l11.tree, l11.overlay[0].from + o), r2.length > a2) return;
        }
      }
      for (let a2 = 0; a2 < s212.children.length; a2++) {
        let h3 = s212.children[a2];
        h3 instanceof z14 && i12(h3, s212.positions[a2] + o);
      }
    };
    return i12(k10(t8), 0), r2;
  }
  get allowsNesting() {
    return true;
  }
};
d2.setState = v5.define();
function pt8(n14, t8, e7) {
  let r2 = n14.facet(S13), i12 = k10(n14).topNode;
  if (!r2 || r2.allowsNesting) for (let s212 = i12; s212; s212 = s212.enter(t8, e7, A12.ExcludeBuffers)) s212.type.isTop && (i12 = s212);
  return i12;
}
function k10(n14) {
  let t8 = n14.field(d2.state, false);
  return t8 ? t8.tree : z14.empty;
}
var Y17 = class {
  constructor(t8) {
    this.doc = t8, this.cursorPos = 0, this.string = "", this.cursor = t8.iter();
  }
  get length() {
    return this.doc.length;
  }
  syncTo(t8) {
    return this.string = this.cursor.next(t8 - this.cursorPos).value, this.cursorPos = t8 + this.string.length, this.cursorPos - this.string.length;
  }
  chunk(t8) {
    return this.syncTo(t8), this.string;
  }
  get lineChunks() {
    return true;
  }
  read(t8, e7) {
    let r2 = this.cursorPos - this.string.length;
    return t8 < r2 || e7 >= this.cursorPos ? this.doc.sliceString(t8, e7) : this.string.slice(t8 - r2, e7 - r2);
  }
};
var I15 = null;
var N17 = class n6 {
  constructor(t8, e7, r2 = [], i12, s212, o, l11, a2) {
    this.parser = t8, this.state = e7, this.fragments = r2, this.tree = i12, this.treeLen = s212, this.viewport = o, this.skipped = l11, this.scheduleOn = a2, this.parse = null, this.tempSkipped = [];
  }
  static create(t8, e7, r2) {
    return new n6(t8, e7, [], z14.empty, 0, r2, [], null);
  }
  startParse() {
    return this.parser.startParse(new Y17(this.state.doc), this.fragments);
  }
  work(t8, e7) {
    return e7 != null && e7 >= this.state.doc.length && (e7 = void 0), this.tree != z14.empty && this.isDone(e7 ?? this.state.doc.length) ? (this.takeTree(), true) : this.withContext(() => {
      var r2;
      if (typeof t8 == "number") {
        let i12 = Date.now() + t8;
        t8 = () => Date.now() > i12;
      }
      for (this.parse || (this.parse = this.startParse()), e7 != null && (this.parse.stoppedAt == null || this.parse.stoppedAt > e7) && e7 < this.state.doc.length && this.parse.stopAt(e7); ; ) {
        let i12 = this.parse.advance();
        if (i12) if (this.fragments = this.withoutTempSkipped(Z12.addTree(i12, this.fragments, this.parse.stoppedAt != null)), this.treeLen = (r2 = this.parse.stoppedAt) !== null && r2 !== void 0 ? r2 : this.state.doc.length, this.tree = i12, this.parse = null, this.treeLen < (e7 ?? this.state.doc.length)) this.parse = this.startParse();
        else return true;
        if (t8()) return false;
      }
    });
  }
  takeTree() {
    let t8, e7;
    this.parse && (t8 = this.parse.parsedPos) >= this.treeLen && ((this.parse.stoppedAt == null || this.parse.stoppedAt > t8) && this.parse.stopAt(t8), this.withContext(() => {
      for (; !(e7 = this.parse.advance()); ) ;
    }), this.treeLen = t8, this.tree = e7, this.fragments = this.withoutTempSkipped(Z12.addTree(this.tree, this.fragments, true)), this.parse = null);
  }
  withContext(t8) {
    let e7 = I15;
    I15 = this;
    try {
      return t8();
    } finally {
      I15 = e7;
    }
  }
  withoutTempSkipped(t8) {
    for (let e7; e7 = this.tempSkipped.pop(); ) t8 = mt9(t8, e7.from, e7.to);
    return t8;
  }
  changes(t8, e7) {
    let { fragments: r2, tree: i12, treeLen: s212, viewport: o, skipped: l11 } = this;
    if (this.takeTree(), !t8.empty) {
      let a2 = [];
      if (t8.iterChangedRanges((h3, f6, c3, g8) => a2.push({ fromA: h3, toA: f6, fromB: c3, toB: g8 })), r2 = Z12.applyChanges(r2, a2), i12 = z14.empty, s212 = 0, o = { from: t8.mapPos(o.from, -1), to: t8.mapPos(o.to, 1) }, this.skipped.length) {
        l11 = [];
        for (let h3 of this.skipped) {
          let f6 = t8.mapPos(h3.from, 1), c3 = t8.mapPos(h3.to, -1);
          f6 < c3 && l11.push({ from: f6, to: c3 });
        }
      }
    }
    return new n6(this.parser, e7, r2, i12, s212, o, l11, this.scheduleOn);
  }
  updateViewport(t8) {
    if (this.viewport.from == t8.from && this.viewport.to == t8.to) return false;
    this.viewport = t8;
    let e7 = this.skipped.length;
    for (let r2 = 0; r2 < this.skipped.length; r2++) {
      let { from: i12, to: s212 } = this.skipped[r2];
      i12 < t8.to && s212 > t8.from && (this.fragments = mt9(this.fragments, i12, s212), this.skipped.splice(r2--, 1));
    }
    return this.skipped.length >= e7 ? false : (this.reset(), true);
  }
  reset() {
    this.parse && (this.takeTree(), this.parse = null);
  }
  skipUntilInView(t8, e7) {
    this.skipped.push({ from: t8, to: e7 });
  }
  static getSkippingParser(t8) {
    return new class extends we14 {
      createParse(e7, r2, i12) {
        let s212 = i12[0].from, o = i12[i12.length - 1].to;
        return { parsedPos: s212, advance() {
          let a2 = I15;
          if (a2) {
            for (let h3 of i12) a2.tempSkipped.push(h3);
            t8 && (a2.scheduleOn = a2.scheduleOn ? Promise.all([a2.scheduleOn, t8]) : t8);
          }
          return this.parsedPos = o, new z14(T15.none, [], [], o - s212);
        }, stoppedAt: null, stopAt() {
        } };
      }
    }();
  }
  isDone(t8) {
    t8 = Math.min(t8, this.state.doc.length);
    let e7 = this.fragments;
    return this.treeLen >= t8 && e7.length && e7[0].from == 0 && e7[0].to >= t8;
  }
  static get() {
    return I15;
  }
};
function mt9(n14, t8, e7) {
  return Z12.applyChanges(n14, [{ fromA: t8, toA: e7, fromB: t8, toB: e7 }]);
}
var B10 = class n7 {
  constructor(t8) {
    this.context = t8, this.tree = t8.tree;
  }
  apply(t8) {
    if (!t8.docChanged && this.tree == this.context.tree) return this;
    let e7 = this.context.changes(t8.changes, t8.state), r2 = this.context.treeLen == t8.startState.doc.length ? void 0 : Math.max(t8.changes.mapPos(this.context.treeLen), e7.viewport.to);
    return e7.work(20, r2) || e7.takeTree(), new n7(e7);
  }
  static init(t8) {
    let e7 = Math.min(3e3, t8.doc.length), r2 = N17.create(t8.facet(S13).parser, t8, { from: 0, to: e7 });
    return r2.work(20, e7) || r2.takeTree(), new n7(r2);
  }
};
d2.state = $9.define({ create: B10.init, update(n14, t8) {
  for (let e7 of t8.effects) if (e7.is(d2.setState)) return e7.value;
  return t8.startState.facet(S13) != t8.state.facet(S13) ? B10.init(t8.state) : n14.apply(t8);
} });
var Ot4 = (n14) => {
  let t8 = setTimeout(() => n14(), 500);
  return () => clearTimeout(t8);
};
typeof requestIdleCallback < "u" && (Ot4 = (n14) => {
  let t8 = -1, e7 = setTimeout(() => {
    t8 = requestIdleCallback(n14, { timeout: 400 });
  }, 100);
  return () => t8 < 0 ? clearTimeout(e7) : cancelIdleCallback(t8);
});
var Q15 = typeof navigator < "u" && (!((K11 = navigator.scheduling) === null || K11 === void 0) && K11.isInputPending) ? () => navigator.scheduling.isInputPending() : null;
var Nt4 = H5.fromClass(class {
  constructor(t8) {
    this.view = t8, this.working = null, this.workScheduled = 0, this.chunkEnd = -1, this.chunkBudget = -1, this.work = this.work.bind(this), this.scheduleWork();
  }
  update(t8) {
    let e7 = this.view.state.field(d2.state).context;
    (e7.updateViewport(t8.view.viewport) || this.view.viewport.to > e7.treeLen) && this.scheduleWork(), (t8.docChanged || t8.selectionSet) && (this.view.hasFocus && (this.chunkBudget += 50), this.scheduleWork()), this.checkAsyncSchedule(e7);
  }
  scheduleWork() {
    if (this.working) return;
    let { state: t8 } = this.view, e7 = t8.field(d2.state);
    (e7.tree != e7.context.tree || !e7.context.isDone(t8.doc.length)) && (this.working = Ot4(this.work));
  }
  work(t8) {
    this.working = null;
    let e7 = Date.now();
    if (this.chunkEnd < e7 && (this.chunkEnd < 0 || this.view.hasFocus) && (this.chunkEnd = e7 + 3e4, this.chunkBudget = 3e3), this.chunkBudget <= 0) return;
    let { state: r2, viewport: { to: i12 } } = this.view, s212 = r2.field(d2.state);
    if (s212.tree == s212.context.tree && s212.context.isDone(i12 + 1e5)) return;
    let o = Date.now() + Math.min(this.chunkBudget, 100, t8 && !Q15 ? Math.max(25, t8.timeRemaining() - 5) : 1e9), l11 = s212.context.treeLen < i12 && r2.doc.length > i12 + 1e3, a2 = s212.context.work(() => Q15 && Q15() || Date.now() > o, i12 + (l11 ? 0 : 1e5));
    this.chunkBudget -= Date.now() - e7, (a2 || this.chunkBudget <= 0) && (s212.context.takeTree(), this.view.dispatch({ effects: d2.setState.of(new B10(s212.context)) })), this.chunkBudget > 0 && !(a2 && !l11) && this.scheduleWork(), this.checkAsyncSchedule(s212.context);
  }
  checkAsyncSchedule(t8) {
    t8.scheduleOn && (this.workScheduled++, t8.scheduleOn.then(() => this.scheduleWork()).catch((e7) => it6(this.view.state, e7)).then(() => this.workScheduled--), t8.scheduleOn = null);
  }
  destroy() {
    this.working && this.working();
  }
  isWorking() {
    return !!(this.working || this.workScheduled > 0);
  }
}, { eventHandlers: { focus() {
  this.scheduleWork();
} } });
var S13 = y11.define({ combine(n14) {
  return n14.length ? n14[0] : null;
}, enables: (n14) => [d2.state, Nt4, A11.contentAttributes.compute([n14], (t8) => {
  let e7 = t8.facet(n14);
  return e7 && e7.name ? { "data-language": e7.name } : {};
})] });
var Bt8 = y11.define();
var Mt8 = y11.define({ combine: (n14) => {
  if (!n14.length) return "  ";
  let t8 = n14[0];
  if (!t8 || /\S/.test(t8) || Array.from(t8).some((e7) => e7 != t8[0])) throw new Error("Invalid indent unit: " + JSON.stringify(n14[0]));
  return t8;
} });
function V16(n14) {
  let t8 = n14.facet(Mt8);
  return t8.charCodeAt(0) == 9 ? n14.tabSize * t8.length : t8.length;
}
function Et9(n14, t8) {
  let e7 = "", r2 = n14.tabSize, i12 = n14.facet(Mt8)[0];
  if (i12 == "	") {
    for (; t8 >= r2; ) e7 += "	", t8 -= r2;
    i12 = " ";
  }
  for (let s212 = 0; s212 < t8; s212++) e7 += i12;
  return e7;
}
function Ft9(n14, t8) {
  n14 instanceof I11 && (n14 = new M8(n14));
  for (let r2 of n14.state.facet(Bt8)) {
    let i12 = r2(n14, t8);
    if (i12 !== void 0) return i12;
  }
  let e7 = k10(n14.state);
  return e7.length >= t8 ? he13(n14, e7, t8) : null;
}
var M8 = class {
  constructor(t8, e7 = {}) {
    this.state = t8, this.options = e7, this.unit = V16(t8);
  }
  lineAt(t8, e7 = 1) {
    let r2 = this.state.doc.lineAt(t8), { simulateBreak: i12, simulateDoubleBreak: s212 } = this.options;
    return i12 != null && i12 >= r2.from && i12 <= r2.to ? s212 && i12 == t8 ? { text: "", from: t8 } : (e7 < 0 ? i12 < t8 : i12 <= t8) ? { text: r2.text.slice(i12 - r2.from), from: i12 } : { text: r2.text.slice(0, i12 - r2.from), from: r2.from } : r2;
  }
  textAfterPos(t8, e7 = 1) {
    if (this.options.simulateDoubleBreak && t8 == this.options.simulateBreak) return "";
    let { text: r2, from: i12 } = this.lineAt(t8, e7);
    return r2.slice(t8 - i12, Math.min(r2.length, t8 + 100 - i12));
  }
  column(t8, e7 = 1) {
    let { text: r2, from: i12 } = this.lineAt(t8, e7), s212 = this.countColumn(r2, t8 - i12), o = this.options.overrideIndentation ? this.options.overrideIndentation(i12) : -1;
    return o > -1 && (s212 += o - this.countColumn(r2, r2.search(/\S|$/))), s212;
  }
  countColumn(t8, e7 = t8.length) {
    return ot8(t8, this.state.tabSize, e7);
  }
  lineIndent(t8, e7 = 1) {
    let { text: r2, from: i12 } = this.lineAt(t8, e7), s212 = this.options.overrideIndentation;
    if (s212) {
      let o = s212(i12);
      if (o > -1) return o;
    }
    return this.countColumn(r2, r2.search(/\S|$/));
  }
  get simulatedBreak() {
    return this.options.simulateBreak || null;
  }
};
var ae12 = new v7();
function he13(n14, t8, e7) {
  let r2 = t8.resolveStack(e7), i12 = r2.node.enterUnfinishedNodesBefore(e7);
  if (i12 != r2.node) {
    let s212 = [];
    for (let o = i12; o != r2.node; o = o.parent) s212.push(o);
    for (let o = s212.length - 1; o >= 0; o--) r2 = { node: s212[o], next: r2 };
  }
  return Lt8(r2, n14, e7);
}
function Lt8(n14, t8, e7) {
  for (let r2 = n14; r2; r2 = r2.next) {
    let i12 = ue13(r2.node);
    if (i12) return i12(Z14.create(t8, e7, r2));
  }
  return 0;
}
function fe15(n14) {
  return n14.pos == n14.options.simulateBreak && n14.options.simulateDoubleBreak;
}
function ue13(n14) {
  let t8 = n14.type.prop(ae12);
  if (t8) return t8;
  let e7 = n14.firstChild, r2;
  if (e7 && (r2 = e7.type.prop(v7.closedBy))) {
    let i12 = n14.lastChild, s212 = i12 && r2.indexOf(i12.name) > -1;
    return (o) => Rt7(o, true, 1, void 0, s212 && !fe15(o) ? i12.from : void 0);
  }
  return n14.parent == null ? ce15 : null;
}
function ce15() {
  return 0;
}
var Z14 = class n8 extends M8 {
  constructor(t8, e7, r2) {
    super(t8.state, t8.options), this.base = t8, this.pos = e7, this.context = r2;
  }
  get node() {
    return this.context.node;
  }
  static create(t8, e7, r2) {
    return new n8(t8, e7, r2);
  }
  get textAfter() {
    return this.textAfterPos(this.pos);
  }
  get baseIndent() {
    return this.baseIndentFor(this.node);
  }
  baseIndentFor(t8) {
    let e7 = this.state.doc.lineAt(t8.from);
    for (; ; ) {
      let r2 = t8.resolve(e7.from);
      for (; r2.parent && r2.parent.from == r2.from; ) r2 = r2.parent;
      if (de11(r2, t8)) break;
      e7 = this.state.doc.lineAt(r2.from);
    }
    return this.lineIndent(e7.from);
  }
  continue() {
    return Lt8(this.context.next, this.base, this.pos);
  }
};
function de11(n14, t8) {
  for (let e7 = t8; e7; e7 = e7.parent) if (n14 == e7) return true;
  return false;
}
function pe14(n14) {
  let t8 = n14.node, e7 = t8.childAfter(t8.from), r2 = t8.lastChild;
  if (!e7) return null;
  let i12 = n14.options.simulateBreak, s212 = n14.state.doc.lineAt(e7.from), o = i12 == null || i12 <= s212.from ? s212.to : Math.min(s212.to, i12);
  for (let l11 = e7.to; ; ) {
    let a2 = t8.childAfter(l11);
    if (!a2 || a2 == r2) return null;
    if (!a2.type.isSkipped) return a2.from < o ? e7 : null;
    l11 = a2.to;
  }
}
function Rt7(n14, t8, e7, r2, i12) {
  let s212 = n14.textAfter, o = s212.match(/^\s*/)[0].length, l11 = r2 && s212.slice(o, o + r2.length) == r2 || i12 == n14.pos + o, a2 = t8 ? pe14(n14) : null;
  return a2 ? l11 ? n14.column(a2.from) : n14.column(a2.to) : n14.baseIndent + (l11 ? 0 : n14.unit * e7);
}
var ge16 = 200;
function sn7() {
  return I11.transactionFilter.of((n14) => {
    if (!n14.docChanged || !n14.isUserEvent("input.type") && !n14.isUserEvent("input.complete")) return n14;
    let t8 = n14.startState.languageDataAt("indentOnInput", n14.startState.selection.main.head);
    if (!t8.length) return n14;
    let e7 = n14.newDoc, { head: r2 } = n14.newSelection.main, i12 = e7.lineAt(r2);
    if (r2 > i12.from + ge16) return n14;
    let s212 = e7.sliceString(i12.from, r2);
    if (!t8.some((h3) => h3.test(s212))) return n14;
    let { state: o } = n14, l11 = -1, a2 = [];
    for (let { head: h3 } of o.selection.ranges) {
      let f6 = o.doc.lineAt(h3);
      if (f6.from == l11) continue;
      l11 = f6.from;
      let c3 = Ft9(o, f6.from);
      if (c3 == null) continue;
      let g8 = /^\s*/.exec(f6.text)[0], p3 = Et9(o, c3);
      g8 != p3 && a2.push({ from: f6.from, to: f6.from + g8.length, insert: p3 });
    }
    return a2.length ? [n14, { changes: a2, sequential: true }] : n14;
  });
}
var me15 = y11.define();
var ke12 = new v7();
function be14(n14, t8, e7) {
  let r2 = k10(n14);
  if (r2.length < e7) return null;
  let i12 = r2.resolveStack(e7, 1), s212 = null;
  for (let o = i12; o; o = o.next) {
    let l11 = o.node;
    if (l11.to <= e7 || l11.from > e7) continue;
    if (s212 && l11.from < t8) break;
    let a2 = l11.type.prop(ke12);
    if (a2 && (l11.to < r2.length - 50 || r2.length == n14.doc.length || !we15(l11))) {
      let h3 = a2(l11, n14);
      h3 && h3.from <= e7 && h3.from >= t8 && h3.to > e7 && (s212 = h3);
    }
  }
  return s212;
}
function we15(n14) {
  let t8 = n14.lastChild;
  return t8 && t8.to == n14.to && t8.type.isError;
}
function E9(n14, t8, e7) {
  for (let r2 of n14.facet(me15)) {
    let i12 = r2(n14, t8, e7);
    if (i12) return i12;
  }
  return be14(n14, t8, e7);
}
function Ut8(n14, t8) {
  let e7 = t8.mapPos(n14.from, 1), r2 = t8.mapPos(n14.to, -1);
  return e7 >= r2 ? void 0 : { from: e7, to: r2 };
}
var R13 = v5.define({ map: Ut8 });
var T16 = v5.define({ map: Ut8 });
function at10(n14) {
  let t8 = [];
  for (let { head: e7 } of n14.state.selection.ranges) t8.some((r2) => r2.from <= e7 && r2.to >= e7) || t8.push(n14.lineBlockAt(e7));
  return t8;
}
var P17 = $9.define({ create() {
  return R11.none;
}, update(n14, t8) {
  n14 = n14.map(t8.changes);
  for (let e7 of t8.effects) if (e7.is(R13) && !ye13(n14, e7.value.from, e7.value.to)) {
    let { preparePlaceholder: r2 } = t8.state.facet(ft4), i12 = r2 ? R11.replace({ widget: new tt7(r2(t8.state, e7.value)) }) : wt5;
    n14 = n14.update({ add: [i12.range(e7.value.from, e7.value.to)] });
  } else e7.is(T16) && (n14 = n14.update({ filter: (r2, i12) => e7.value.from != r2 || e7.value.to != i12, filterFrom: e7.value.from, filterTo: e7.value.to }));
  if (t8.selection) {
    let e7 = false, { head: r2 } = t8.selection.main;
    n14.between(r2, r2, (i12, s212) => {
      i12 < r2 && s212 > r2 && (e7 = true);
    }), e7 && (n14 = n14.update({ filterFrom: r2, filterTo: r2, filter: (i12, s212) => s212 <= r2 || i12 >= r2 }));
  }
  return n14;
}, provide: (n14) => A11.decorations.from(n14), toJSON(n14, t8) {
  let e7 = [];
  return n14.between(0, t8.doc.length, (r2, i12) => {
    e7.push(r2, i12);
  }), e7;
}, fromJSON(n14) {
  if (!Array.isArray(n14) || n14.length % 2) throw new RangeError("Invalid JSON for fold state");
  let t8 = [];
  for (let e7 = 0; e7 < n14.length; ) {
    let r2 = n14[e7++], i12 = n14[e7++];
    if (typeof r2 != "number" || typeof i12 != "number") throw new RangeError("Invalid JSON for fold state");
    t8.push(wt5.range(r2, i12));
  }
  return R11.set(t8, true);
} });
function F16(n14, t8, e7) {
  var r2;
  let i12 = null;
  return (r2 = n14.field(P17, false)) === null || r2 === void 0 || r2.between(t8, e7, (s212, o) => {
    (!i12 || i12.from > s212) && (i12 = { from: s212, to: o });
  }), i12;
}
function ye13(n14, t8, e7) {
  let r2 = false;
  return n14.between(t8, t8, (i12, s212) => {
    i12 == t8 && s212 == e7 && (r2 = true);
  }), r2;
}
function ht10(n14, t8) {
  return n14.field(P17, false) ? t8 : t8.concat(v5.appendConfig.of(Wt9()));
}
var ve12 = (n14) => {
  for (let t8 of at10(n14)) {
    let e7 = E9(n14.state, t8.from, t8.to);
    if (e7) return n14.dispatch({ effects: ht10(n14.state, [R13.of(e7), H8(n14, e7)]) }), true;
  }
  return false;
};
var xe15 = (n14) => {
  if (!n14.state.field(P17, false)) return false;
  let t8 = [];
  for (let e7 of at10(n14)) {
    let r2 = F16(n14.state, e7.from, e7.to);
    r2 && t8.push(T16.of(r2), H8(n14, r2, false));
  }
  return t8.length && n14.dispatch({ effects: t8 }), t8.length > 0;
};
function H8(n14, t8, e7 = true) {
  let r2 = n14.state.doc.lineAt(t8.from).number, i12 = n14.state.doc.lineAt(t8.to).number;
  return A11.announce.of(`${n14.state.phrase(e7 ? "Folded lines" : "Unfolded lines")} ${r2} ${n14.state.phrase("to")} ${i12}.`);
}
var Se11 = (n14) => {
  let { state: t8 } = n14, e7 = [];
  for (let r2 = 0; r2 < t8.doc.length; ) {
    let i12 = n14.lineBlockAt(r2), s212 = E9(t8, i12.from, i12.to);
    s212 && e7.push(R13.of(s212)), r2 = (s212 ? n14.lineBlockAt(s212.to) : i12).to + 1;
  }
  return e7.length && n14.dispatch({ effects: ht10(n14.state, e7) }), !!e7.length;
};
var Pe14 = (n14) => {
  let t8 = n14.state.field(P17, false);
  if (!t8 || !t8.size) return false;
  let e7 = [];
  return t8.between(0, n14.state.doc.length, (r2, i12) => {
    e7.push(T16.of({ from: r2, to: i12 }));
  }), n14.dispatch({ effects: e7 }), true;
};
var hn6 = [{ key: "Ctrl-Shift-[", mac: "Cmd-Alt-[", run: ve12 }, { key: "Ctrl-Shift-]", mac: "Cmd-Alt-]", run: xe15 }, { key: "Ctrl-Alt-[", run: Se11 }, { key: "Ctrl-Alt-]", run: Pe14 }];
var Ce10 = { placeholderDOM: null, preparePlaceholder: null, placeholderText: "â€¦" };
var ft4 = y11.define({ combine(n14) {
  return ht8(n14, Ce10);
} });
function Wt9(n14) {
  let t8 = [P17, Ie11];
  return n14 && t8.push(ft4.of(n14)), t8;
}
function jt8(n14, t8) {
  let { state: e7 } = n14, r2 = e7.facet(ft4), i12 = (o) => {
    let l11 = n14.lineBlockAt(n14.posAtDOM(o.target)), a2 = F16(n14.state, l11.from, l11.to);
    a2 && n14.dispatch({ effects: T16.of(a2) }), o.preventDefault();
  };
  if (r2.placeholderDOM) return r2.placeholderDOM(n14, i12, t8);
  let s212 = document.createElement("span");
  return s212.textContent = r2.placeholderText, s212.setAttribute("aria-label", e7.phrase("folded code")), s212.title = e7.phrase("unfold"), s212.className = "cm-foldPlaceholder", s212.onclick = i12, s212;
}
var wt5 = R11.replace({ widget: new class extends ot9 {
  toDOM(n14) {
    return jt8(n14, null);
  }
}() });
var tt7 = class extends ot9 {
  constructor(t8) {
    super(), this.value = t8;
  }
  eq(t8) {
    return this.value == t8.value;
  }
  toDOM(t8) {
    return jt8(t8, this.value);
  }
};
var Te11 = { openText: "âŒ„", closedText: "â€º", markerDOM: null, domEventHandlers: {}, foldingChanged: () => false };
var O14 = class extends $10 {
  constructor(t8, e7) {
    super(), this.config = t8, this.open = e7;
  }
  eq(t8) {
    return this.config == t8.config && this.open == t8.open;
  }
  toDOM(t8) {
    if (this.config.markerDOM) return this.config.markerDOM(this.open);
    let e7 = document.createElement("span");
    return e7.textContent = this.open ? this.config.openText : this.config.closedText, e7.title = t8.state.phrase(this.open ? "Fold line" : "Unfold line"), e7;
  }
};
function fn7(n14 = {}) {
  let t8 = Object.assign(Object.assign({}, Te11), n14), e7 = new O14(t8, true), r2 = new O14(t8, false), i12 = H5.fromClass(class {
    constructor(o) {
      this.from = o.viewport.from, this.markers = this.buildMarkers(o);
    }
    update(o) {
      (o.docChanged || o.viewportChanged || o.startState.facet(S13) != o.state.facet(S13) || o.startState.field(P17, false) != o.state.field(P17, false) || k10(o.startState) != k10(o.state) || t8.foldingChanged(o)) && (this.markers = this.buildMarkers(o.view));
    }
    buildMarkers(o) {
      let l11 = new se7();
      for (let a2 of o.viewportLineBlocks) {
        let h3 = F16(o.state, a2.from, a2.to) ? r2 : E9(o.state, a2.from, a2.to) ? e7 : null;
        h3 && l11.add(a2.from, a2.from, h3);
      }
      return l11.finish();
    }
  }), { domEventHandlers: s212 } = t8;
  return [i12, ol2({ class: "cm-foldGutter", markers(o) {
    var l11;
    return ((l11 = o.plugin(i12)) === null || l11 === void 0 ? void 0 : l11.markers) || T11.empty;
  }, initialSpacer() {
    return new O14(t8, false);
  }, domEventHandlers: Object.assign(Object.assign({}, s212), { click: (o, l11, a2) => {
    if (s212.click && s212.click(o, l11, a2)) return true;
    let h3 = F16(o.state, l11.from, l11.to);
    if (h3) return o.dispatch({ effects: T16.of(h3) }), true;
    let f6 = E9(o.state, l11.from, l11.to);
    return f6 ? (o.dispatch({ effects: R13.of(f6) }), true) : false;
  } }) }), Wt9()];
}
var Ie11 = A11.baseTheme({ ".cm-foldPlaceholder": { backgroundColor: "#eee", border: "1px solid #ddd", color: "#888", borderRadius: ".2em", margin: "0 1px", padding: "0 1px", cursor: "pointer" }, ".cm-foldGutter span": { padding: "0 1px", cursor: "pointer" } });
var $13 = class n9 {
  constructor(t8, e7) {
    this.specs = t8;
    let r2;
    function i12(l11) {
      let a2 = b7.newName();
      return (r2 || (r2 = /* @__PURE__ */ Object.create(null)))["." + a2] = l11, a2;
    }
    let s212 = typeof e7.all == "string" ? e7.all : e7.all ? i12(e7.all) : void 0, o = e7.scope;
    this.scope = o instanceof d2 ? (l11) => l11.prop(A14) == o.data : o ? (l11) => l11 == o : void 0, this.style = W12(t8.map((l11) => ({ tag: l11.tag, class: l11.class || i12(Object.assign({}, l11, { tag: null })) })), { all: s212 }).style, this.module = r2 ? new b7(r2) : null, this.themeType = e7.themeType;
  }
  static define(t8, e7) {
    return new n9(t8, e7 || {});
  }
};
var et9 = y11.define();
var Vt9 = y11.define({ combine(n14) {
  return n14.length ? [n14[0]] : null;
} });
function j15(n14) {
  let t8 = n14.facet(et9);
  return t8.length ? t8 : n14.facet(Vt9);
}
function un7(n14, t8) {
  let e7 = [De11], r2;
  return n14 instanceof $13 && (n14.module && e7.push(A11.styleModule.of(n14.module)), r2 = n14.themeType), t8?.fallback ? e7.push(Vt9.of(n14)) : r2 ? e7.push(et9.computeN([A11.darkTheme], (i12) => i12.facet(A11.darkTheme) == (r2 == "dark") ? [n14] : [])) : e7.push(et9.of(n14)), e7;
}
var nt11 = class {
  constructor(t8) {
    this.markCache = /* @__PURE__ */ Object.create(null), this.tree = k10(t8.state), this.decorations = this.buildDeco(t8, j15(t8.state));
  }
  update(t8) {
    let e7 = k10(t8.state), r2 = j15(t8.state), i12 = r2 != j15(t8.startState);
    e7.length < t8.view.viewport.to && !i12 && e7.type == this.tree.type ? this.decorations = this.decorations.map(t8.changes) : (e7 != this.tree || t8.viewportChanged || i12) && (this.tree = e7, this.decorations = this.buildDeco(t8.view, r2));
  }
  buildDeco(t8, e7) {
    if (!e7 || !this.tree.length) return R11.none;
    let r2 = new se7();
    for (let { from: i12, to: s212 } of t8.visibleRanges) Y16(this.tree, e7, (o, l11, a2) => {
      r2.add(o, l11, this.markCache[a2] || (this.markCache[a2] = R11.mark({ class: a2 })));
    }, i12, s212);
    return r2.finish();
  }
};
var De11 = lt8.high(H5.fromClass(nt11, { decorations: (n14) => n14.decorations }));
var dn6 = $13.define([{ tag: l10.meta, color: "#404740" }, { tag: l10.link, textDecoration: "underline" }, { tag: l10.heading, textDecoration: "underline", fontWeight: "bold" }, { tag: l10.emphasis, fontStyle: "italic" }, { tag: l10.strong, fontWeight: "bold" }, { tag: l10.strikethrough, textDecoration: "line-through" }, { tag: l10.keyword, color: "#708" }, { tag: [l10.atom, l10.bool, l10.url, l10.contentSeparator, l10.labelName], color: "#219" }, { tag: [l10.literal, l10.inserted], color: "#164" }, { tag: [l10.string, l10.deleted], color: "#a11" }, { tag: [l10.regexp, l10.escape, l10.special(l10.string)], color: "#e40" }, { tag: l10.definition(l10.variableName), color: "#00f" }, { tag: l10.local(l10.variableName), color: "#30a" }, { tag: [l10.typeName, l10.namespace], color: "#085" }, { tag: l10.className, color: "#167" }, { tag: [l10.special(l10.variableName), l10.macroName], color: "#256" }, { tag: l10.definition(l10.propertyName), color: "#00c" }, { tag: l10.comment, color: "#940" }, { tag: l10.invalid, color: "#f00" }]);
var Oe10 = A11.baseTheme({ "&.cm-focused .cm-matchingBracket": { backgroundColor: "#328c8252" }, "&.cm-focused .cm-nonmatchingBracket": { backgroundColor: "#bb555544" } });
var Ht8 = 1e4;
var $t8 = "()[]{}";
var qt7 = y11.define({ combine(n14) {
  return ht8(n14, { afterCursor: true, brackets: $t8, maxScanDistance: Ht8, renderMatch: Me13 });
} });
var Ne16 = R11.mark({ class: "cm-matchingBracket" });
var Be14 = R11.mark({ class: "cm-nonmatchingBracket" });
function Me13(n14) {
  let t8 = [], e7 = n14.matched ? Ne16 : Be14;
  return t8.push(e7.range(n14.start.from, n14.start.to)), n14.end && t8.push(e7.range(n14.end.from, n14.end.to)), t8;
}
var Ee14 = $9.define({ create() {
  return R11.none;
}, update(n14, t8) {
  if (!t8.docChanged && !t8.selection) return n14;
  let e7 = [], r2 = t8.state.facet(qt7);
  for (let i12 of t8.state.selection.ranges) {
    if (!i12.empty) continue;
    let s212 = U16(t8.state, i12.head, -1, r2) || i12.head > 0 && U16(t8.state, i12.head - 1, 1, r2) || r2.afterCursor && (U16(t8.state, i12.head, 1, r2) || i12.head < t8.state.doc.length && U16(t8.state, i12.head + 1, -1, r2));
    s212 && (e7 = e7.concat(r2.renderMatch(s212, t8.state)));
  }
  return R11.set(e7, true);
}, provide: (n14) => A11.decorations.from(n14) });
var Fe13 = [Ee14, Oe10];
function pn7(n14 = {}) {
  return [qt7.of(n14), Fe13];
}
var Le12 = new v7();
function rt11(n14, t8, e7) {
  let r2 = n14.prop(t8 < 0 ? v7.openedBy : v7.closedBy);
  if (r2) return r2;
  if (n14.name.length == 1) {
    let i12 = e7.indexOf(n14.name);
    if (i12 > -1 && i12 % 2 == (t8 < 0 ? 1 : 0)) return [e7[i12 + t8]];
  }
  return null;
}
function it8(n14) {
  let t8 = n14.type.prop(Le12);
  return t8 ? t8(n14.node) : n14;
}
function U16(n14, t8, e7, r2 = {}) {
  let i12 = r2.maxScanDistance || Ht8, s212 = r2.brackets || $t8, o = k10(n14), l11 = o.resolveInner(t8, e7);
  for (let a2 = l11; a2; a2 = a2.parent) {
    let h3 = rt11(a2.type, e7, s212);
    if (h3 && a2.from < a2.to) {
      let f6 = it8(a2);
      if (f6 && (e7 > 0 ? t8 >= f6.from && t8 < f6.to : t8 > f6.from && t8 <= f6.to)) return Re11(n14, t8, e7, a2, f6, h3, s212);
    }
  }
  return Ue11(n14, t8, e7, o, l11.type, i12, s212);
}
function Re11(n14, t8, e7, r2, i12, s212, o) {
  let l11 = r2.parent, a2 = { from: i12.from, to: i12.to }, h3 = 0, f6 = l11?.cursor();
  if (f6 && (e7 < 0 ? f6.childBefore(r2.from) : f6.childAfter(r2.to))) do
    if (e7 < 0 ? f6.to <= r2.from : f6.from >= r2.to) {
      if (h3 == 0 && s212.indexOf(f6.type.name) > -1 && f6.from < f6.to) {
        let c3 = it8(f6);
        return { start: a2, end: c3 ? { from: c3.from, to: c3.to } : void 0, matched: true };
      } else if (rt11(f6.type, e7, o)) h3++;
      else if (rt11(f6.type, -e7, o)) {
        if (h3 == 0) {
          let c3 = it8(f6);
          return { start: a2, end: c3 && c3.from < c3.to ? { from: c3.from, to: c3.to } : void 0, matched: false };
        }
        h3--;
      }
    }
  while (e7 < 0 ? f6.prevSibling() : f6.nextSibling());
  return { start: a2, matched: false };
}
function Ue11(n14, t8, e7, r2, i12, s212, o) {
  let l11 = e7 < 0 ? n14.sliceDoc(t8 - 1, t8) : n14.sliceDoc(t8, t8 + 1), a2 = o.indexOf(l11);
  if (a2 < 0 || a2 % 2 == 0 != e7 > 0) return null;
  let h3 = { from: e7 < 0 ? t8 - 1 : t8, to: e7 > 0 ? t8 + 1 : t8 }, f6 = n14.doc.iterRange(t8, e7 > 0 ? n14.doc.length : 0), c3 = 0;
  for (let g8 = 0; !f6.next().done && g8 <= s212; ) {
    let p3 = f6.value;
    e7 < 0 && (g8 += p3.length);
    let y18 = t8 + g8 * e7;
    for (let C11 = e7 > 0 ? 0 : p3.length - 1, Kt10 = e7 > 0 ? p3.length : -1; C11 != Kt10; C11 += e7) {
      let _18 = o.indexOf(p3[C11]);
      if (!(_18 < 0 || r2.resolveInner(y18 + C11, 1).type != i12)) if (_18 % 2 == 0 == e7 > 0) c3++;
      else {
        if (c3 == 1) return { start: h3, end: { from: y18 + C11, to: y18 + C11 + 1 }, matched: _18 >> 1 == a2 >> 1 };
        c3--;
      }
    }
    e7 > 0 && (g8 += p3.length);
  }
  return f6.done ? { start: h3, matched: false } : null;
}
var ct4 = /* @__PURE__ */ Object.create(null);
var L13 = [T15.none];
var He10 = new ge15(L13);
var St7 = [];
var Jt8 = /* @__PURE__ */ Object.create(null);
for (let [n14, t8] of [["variable", "variableName"], ["variable-2", "variableName.special"], ["string-2", "string.special"], ["def", "variableName.definition"], ["tag", "tagName"], ["attribute", "attributeName"], ["type", "typeName"], ["builtin", "variableName.standard"], ["qualifier", "modifier"], ["error", "invalid"], ["header", "heading"], ["property", "propertyName"]]) Jt8[n14] = _t8(ct4, t8);
var z16 = class {
  constructor(t8) {
    this.extra = t8, this.table = Object.assign(/* @__PURE__ */ Object.create(null), Jt8);
  }
  resolve(t8) {
    return t8 ? this.table[t8] || (this.table[t8] = _t8(this.extra, t8)) : 0;
  }
};
var $e13 = new z16(ct4);
function X15(n14, t8) {
  St7.indexOf(n14) > -1 || (St7.push(n14), console.warn(t8));
}
function _t8(n14, t8) {
  let e7 = [];
  for (let s212 of t8.split(" ")) {
    let o = [];
    for (let l11 of s212.split(".")) {
      let a2 = n14[l11] || l10[l11];
      a2 ? typeof a2 == "function" ? o.length ? o = o.map(a2) : X15(l11, `Modifier ${l11} used at start of tag`) : o.length ? X15(l11, `Tag ${l11} used as modifier`) : o = Array.isArray(a2) ? a2 : [a2] : X15(l11, `Unknown highlighting tag ${l11}`);
    }
    for (let l11 of o) e7.push(l11);
  }
  if (!e7.length) return 0;
  let r2 = t8.replace(/ /g, "_"), i12 = T15.define({ id: L13.length, name: r2, props: [_14({ [r2]: e7 })] });
  return L13.push(i12), i12.id;
}

// https://esm.sh/v135/@codemirror/language@6.9.3/denonext/language.mjs
var K12;
var A15 = new v7();
var le13 = new v7();
var d3 = class {
  constructor(t8, e7, r2 = [], i12 = "") {
    this.data = t8, this.name = i12, I11.prototype.hasOwnProperty("tree") || Object.defineProperty(I11.prototype, "tree", { get() {
      return k11(this);
    } }), this.parser = e7, this.extension = [S14.of(this), I11.languageData.of((s212, o, a2) => {
      let l11 = pt9(s212, o, a2), h3 = l11.type.prop(A15);
      if (!h3) return [];
      let f6 = s212.facet(h3), c3 = l11.type.prop(le13);
      if (c3) {
        let g8 = l11.resolve(o - l11.from, a2);
        for (let p3 of c3) if (p3.test(g8, s212)) {
          let y18 = s212.facet(p3.facet);
          return p3.type == "replace" ? y18 : y18.concat(f6);
        }
      }
      return f6;
    })].concat(r2);
  }
  isActiveAt(t8, e7, r2 = -1) {
    return pt9(t8, e7, r2).type.prop(A15) == this.data;
  }
  findRegions(t8) {
    let e7 = t8.facet(S14);
    if (e7?.data == this.data) return [{ from: 0, to: t8.doc.length }];
    if (!e7 || !e7.allowsNesting) return [];
    let r2 = [], i12 = (s212, o) => {
      if (s212.prop(A15) == this.data) {
        r2.push({ from: o, to: o + s212.length });
        return;
      }
      let a2 = s212.prop(v7.mounted);
      if (a2) {
        if (a2.tree.prop(A15) == this.data) {
          if (a2.overlay) for (let l11 of a2.overlay) r2.push({ from: l11.from + o, to: l11.to + o });
          else r2.push({ from: o, to: o + s212.length });
          return;
        } else if (a2.overlay) {
          let l11 = r2.length;
          if (i12(a2.tree, a2.overlay[0].from + o), r2.length > l11) return;
        }
      }
      for (let l11 = 0; l11 < s212.children.length; l11++) {
        let h3 = s212.children[l11];
        h3 instanceof z14 && i12(h3, s212.positions[l11] + o);
      }
    };
    return i12(k11(t8), 0), r2;
  }
  get allowsNesting() {
    return true;
  }
};
d3.setState = v5.define();
function pt9(n14, t8, e7) {
  let r2 = n14.facet(S14), i12 = k11(n14).topNode;
  if (!r2 || r2.allowsNesting) for (let s212 = i12; s212; s212 = s212.enter(t8, e7, A12.ExcludeBuffers)) s212.type.isTop && (i12 = s212);
  return i12;
}
function k11(n14) {
  let t8 = n14.field(d3.state, false);
  return t8 ? t8.tree : z14.empty;
}
var Y18 = class {
  constructor(t8) {
    this.doc = t8, this.cursorPos = 0, this.string = "", this.cursor = t8.iter();
  }
  get length() {
    return this.doc.length;
  }
  syncTo(t8) {
    return this.string = this.cursor.next(t8 - this.cursorPos).value, this.cursorPos = t8 + this.string.length, this.cursorPos - this.string.length;
  }
  chunk(t8) {
    return this.syncTo(t8), this.string;
  }
  get lineChunks() {
    return true;
  }
  read(t8, e7) {
    let r2 = this.cursorPos - this.string.length;
    return t8 < r2 || e7 >= this.cursorPos ? this.doc.sliceString(t8, e7) : this.string.slice(t8 - r2, e7 - r2);
  }
};
var I16 = null;
var N18 = class n10 {
  constructor(t8, e7, r2 = [], i12, s212, o, a2, l11) {
    this.parser = t8, this.state = e7, this.fragments = r2, this.tree = i12, this.treeLen = s212, this.viewport = o, this.skipped = a2, this.scheduleOn = l11, this.parse = null, this.tempSkipped = [];
  }
  static create(t8, e7, r2) {
    return new n10(t8, e7, [], z14.empty, 0, r2, [], null);
  }
  startParse() {
    return this.parser.startParse(new Y18(this.state.doc), this.fragments);
  }
  work(t8, e7) {
    return e7 != null && e7 >= this.state.doc.length && (e7 = void 0), this.tree != z14.empty && this.isDone(e7 ?? this.state.doc.length) ? (this.takeTree(), true) : this.withContext(() => {
      var r2;
      if (typeof t8 == "number") {
        let i12 = Date.now() + t8;
        t8 = () => Date.now() > i12;
      }
      for (this.parse || (this.parse = this.startParse()), e7 != null && (this.parse.stoppedAt == null || this.parse.stoppedAt > e7) && e7 < this.state.doc.length && this.parse.stopAt(e7); ; ) {
        let i12 = this.parse.advance();
        if (i12) if (this.fragments = this.withoutTempSkipped(Z12.addTree(i12, this.fragments, this.parse.stoppedAt != null)), this.treeLen = (r2 = this.parse.stoppedAt) !== null && r2 !== void 0 ? r2 : this.state.doc.length, this.tree = i12, this.parse = null, this.treeLen < (e7 ?? this.state.doc.length)) this.parse = this.startParse();
        else return true;
        if (t8()) return false;
      }
    });
  }
  takeTree() {
    let t8, e7;
    this.parse && (t8 = this.parse.parsedPos) >= this.treeLen && ((this.parse.stoppedAt == null || this.parse.stoppedAt > t8) && this.parse.stopAt(t8), this.withContext(() => {
      for (; !(e7 = this.parse.advance()); ) ;
    }), this.treeLen = t8, this.tree = e7, this.fragments = this.withoutTempSkipped(Z12.addTree(this.tree, this.fragments, true)), this.parse = null);
  }
  withContext(t8) {
    let e7 = I16;
    I16 = this;
    try {
      return t8();
    } finally {
      I16 = e7;
    }
  }
  withoutTempSkipped(t8) {
    for (let e7; e7 = this.tempSkipped.pop(); ) t8 = mt10(t8, e7.from, e7.to);
    return t8;
  }
  changes(t8, e7) {
    let { fragments: r2, tree: i12, treeLen: s212, viewport: o, skipped: a2 } = this;
    if (this.takeTree(), !t8.empty) {
      let l11 = [];
      if (t8.iterChangedRanges((h3, f6, c3, g8) => l11.push({ fromA: h3, toA: f6, fromB: c3, toB: g8 })), r2 = Z12.applyChanges(r2, l11), i12 = z14.empty, s212 = 0, o = { from: t8.mapPos(o.from, -1), to: t8.mapPos(o.to, 1) }, this.skipped.length) {
        a2 = [];
        for (let h3 of this.skipped) {
          let f6 = t8.mapPos(h3.from, 1), c3 = t8.mapPos(h3.to, -1);
          f6 < c3 && a2.push({ from: f6, to: c3 });
        }
      }
    }
    return new n10(this.parser, e7, r2, i12, s212, o, a2, this.scheduleOn);
  }
  updateViewport(t8) {
    if (this.viewport.from == t8.from && this.viewport.to == t8.to) return false;
    this.viewport = t8;
    let e7 = this.skipped.length;
    for (let r2 = 0; r2 < this.skipped.length; r2++) {
      let { from: i12, to: s212 } = this.skipped[r2];
      i12 < t8.to && s212 > t8.from && (this.fragments = mt10(this.fragments, i12, s212), this.skipped.splice(r2--, 1));
    }
    return this.skipped.length >= e7 ? false : (this.reset(), true);
  }
  reset() {
    this.parse && (this.takeTree(), this.parse = null);
  }
  skipUntilInView(t8, e7) {
    this.skipped.push({ from: t8, to: e7 });
  }
  static getSkippingParser(t8) {
    return new class extends we14 {
      createParse(e7, r2, i12) {
        let s212 = i12[0].from, o = i12[i12.length - 1].to;
        return { parsedPos: s212, advance() {
          let l11 = I16;
          if (l11) {
            for (let h3 of i12) l11.tempSkipped.push(h3);
            t8 && (l11.scheduleOn = l11.scheduleOn ? Promise.all([l11.scheduleOn, t8]) : t8);
          }
          return this.parsedPos = o, new z14(T15.none, [], [], o - s212);
        }, stoppedAt: null, stopAt() {
        } };
      }
    }();
  }
  isDone(t8) {
    t8 = Math.min(t8, this.state.doc.length);
    let e7 = this.fragments;
    return this.treeLen >= t8 && e7.length && e7[0].from == 0 && e7[0].to >= t8;
  }
  static get() {
    return I16;
  }
};
function mt10(n14, t8, e7) {
  return Z12.applyChanges(n14, [{ fromA: t8, toA: e7, fromB: t8, toB: e7 }]);
}
var B11 = class n11 {
  constructor(t8) {
    this.context = t8, this.tree = t8.tree;
  }
  apply(t8) {
    if (!t8.docChanged && this.tree == this.context.tree) return this;
    let e7 = this.context.changes(t8.changes, t8.state), r2 = this.context.treeLen == t8.startState.doc.length ? void 0 : Math.max(t8.changes.mapPos(this.context.treeLen), e7.viewport.to);
    return e7.work(20, r2) || e7.takeTree(), new n11(e7);
  }
  static init(t8) {
    let e7 = Math.min(3e3, t8.doc.length), r2 = N18.create(t8.facet(S14).parser, t8, { from: 0, to: e7 });
    return r2.work(20, e7) || r2.takeTree(), new n11(r2);
  }
};
d3.state = $9.define({ create: B11.init, update(n14, t8) {
  for (let e7 of t8.effects) if (e7.is(d3.setState)) return e7.value;
  return t8.startState.facet(S14) != t8.state.facet(S14) ? B11.init(t8.state) : n14.apply(t8);
} });
var Nt5 = (n14) => {
  let t8 = setTimeout(() => n14(), 500);
  return () => clearTimeout(t8);
};
typeof requestIdleCallback < "u" && (Nt5 = (n14) => {
  let t8 = -1, e7 = setTimeout(() => {
    t8 = requestIdleCallback(n14, { timeout: 400 });
  }, 100);
  return () => t8 < 0 ? clearTimeout(e7) : cancelIdleCallback(t8);
});
var Q16 = typeof navigator < "u" && (!((K12 = navigator.scheduling) === null || K12 === void 0) && K12.isInputPending) ? () => navigator.scheduling.isInputPending() : null;
var Bt9 = H5.fromClass(class {
  constructor(t8) {
    this.view = t8, this.working = null, this.workScheduled = 0, this.chunkEnd = -1, this.chunkBudget = -1, this.work = this.work.bind(this), this.scheduleWork();
  }
  update(t8) {
    let e7 = this.view.state.field(d3.state).context;
    (e7.updateViewport(t8.view.viewport) || this.view.viewport.to > e7.treeLen) && this.scheduleWork(), (t8.docChanged || t8.selectionSet) && (this.view.hasFocus && (this.chunkBudget += 50), this.scheduleWork()), this.checkAsyncSchedule(e7);
  }
  scheduleWork() {
    if (this.working) return;
    let { state: t8 } = this.view, e7 = t8.field(d3.state);
    (e7.tree != e7.context.tree || !e7.context.isDone(t8.doc.length)) && (this.working = Nt5(this.work));
  }
  work(t8) {
    this.working = null;
    let e7 = Date.now();
    if (this.chunkEnd < e7 && (this.chunkEnd < 0 || this.view.hasFocus) && (this.chunkEnd = e7 + 3e4, this.chunkBudget = 3e3), this.chunkBudget <= 0) return;
    let { state: r2, viewport: { to: i12 } } = this.view, s212 = r2.field(d3.state);
    if (s212.tree == s212.context.tree && s212.context.isDone(i12 + 1e5)) return;
    let o = Date.now() + Math.min(this.chunkBudget, 100, t8 && !Q16 ? Math.max(25, t8.timeRemaining() - 5) : 1e9), a2 = s212.context.treeLen < i12 && r2.doc.length > i12 + 1e3, l11 = s212.context.work(() => Q16 && Q16() || Date.now() > o, i12 + (a2 ? 0 : 1e5));
    this.chunkBudget -= Date.now() - e7, (l11 || this.chunkBudget <= 0) && (s212.context.takeTree(), this.view.dispatch({ effects: d3.setState.of(new B11(s212.context)) })), this.chunkBudget > 0 && !(l11 && !a2) && this.scheduleWork(), this.checkAsyncSchedule(s212.context);
  }
  checkAsyncSchedule(t8) {
    t8.scheduleOn && (this.workScheduled++, t8.scheduleOn.then(() => this.scheduleWork()).catch((e7) => it6(this.view.state, e7)).then(() => this.workScheduled--), t8.scheduleOn = null);
  }
  destroy() {
    this.working && this.working();
  }
  isWorking() {
    return !!(this.working || this.workScheduled > 0);
  }
}, { eventHandlers: { focus() {
  this.scheduleWork();
} } });
var S14 = y11.define({ combine(n14) {
  return n14.length ? n14[0] : null;
}, enables: (n14) => [d3.state, Bt9, A11.contentAttributes.compute([n14], (t8) => {
  let e7 = t8.facet(n14);
  return e7 && e7.name ? { "data-language": e7.name } : {};
})] });
var Mt9 = y11.define();
var Et10 = y11.define({ combine: (n14) => {
  if (!n14.length) return "  ";
  let t8 = n14[0];
  if (!t8 || /\S/.test(t8) || Array.from(t8).some((e7) => e7 != t8[0])) throw new Error("Invalid indent unit: " + JSON.stringify(n14[0]));
  return t8;
} });
function V17(n14) {
  let t8 = n14.facet(Et10);
  return t8.charCodeAt(0) == 9 ? n14.tabSize * t8.length : t8.length;
}
function Ft10(n14, t8) {
  let e7 = "", r2 = n14.tabSize, i12 = n14.facet(Et10)[0];
  if (i12 == "	") {
    for (; t8 >= r2; ) e7 += "	", t8 -= r2;
    i12 = " ";
  }
  for (let s212 = 0; s212 < t8; s212++) e7 += i12;
  return e7;
}
function Lt9(n14, t8) {
  n14 instanceof I11 && (n14 = new M9(n14));
  for (let r2 of n14.state.facet(Mt9)) {
    let i12 = r2(n14, t8);
    if (i12 !== void 0) return i12;
  }
  let e7 = k11(n14.state);
  return e7.length >= t8 ? fe16(n14, e7, t8) : null;
}
var M9 = class {
  constructor(t8, e7 = {}) {
    this.state = t8, this.options = e7, this.unit = V17(t8);
  }
  lineAt(t8, e7 = 1) {
    let r2 = this.state.doc.lineAt(t8), { simulateBreak: i12, simulateDoubleBreak: s212 } = this.options;
    return i12 != null && i12 >= r2.from && i12 <= r2.to ? s212 && i12 == t8 ? { text: "", from: t8 } : (e7 < 0 ? i12 < t8 : i12 <= t8) ? { text: r2.text.slice(i12 - r2.from), from: i12 } : { text: r2.text.slice(0, i12 - r2.from), from: r2.from } : r2;
  }
  textAfterPos(t8, e7 = 1) {
    if (this.options.simulateDoubleBreak && t8 == this.options.simulateBreak) return "";
    let { text: r2, from: i12 } = this.lineAt(t8, e7);
    return r2.slice(t8 - i12, Math.min(r2.length, t8 + 100 - i12));
  }
  column(t8, e7 = 1) {
    let { text: r2, from: i12 } = this.lineAt(t8, e7), s212 = this.countColumn(r2, t8 - i12), o = this.options.overrideIndentation ? this.options.overrideIndentation(i12) : -1;
    return o > -1 && (s212 += o - this.countColumn(r2, r2.search(/\S|$/))), s212;
  }
  countColumn(t8, e7 = t8.length) {
    return ot8(t8, this.state.tabSize, e7);
  }
  lineIndent(t8, e7 = 1) {
    let { text: r2, from: i12 } = this.lineAt(t8, e7), s212 = this.options.overrideIndentation;
    if (s212) {
      let o = s212(i12);
      if (o > -1) return o;
    }
    return this.countColumn(r2, r2.search(/\S|$/));
  }
  get simulatedBreak() {
    return this.options.simulateBreak || null;
  }
};
var he14 = new v7();
function fe16(n14, t8, e7) {
  let r2 = t8.resolveStack(e7), i12 = r2.node.enterUnfinishedNodesBefore(e7);
  if (i12 != r2.node) {
    let s212 = [];
    for (let o = i12; o != r2.node; o = o.parent) s212.push(o);
    for (let o = s212.length - 1; o >= 0; o--) r2 = { node: s212[o], next: r2 };
  }
  return Rt8(r2, n14, e7);
}
function Rt8(n14, t8, e7) {
  for (let r2 = n14; r2; r2 = r2.next) {
    let i12 = ce16(r2.node);
    if (i12) return i12(Z15.create(t8, e7, r2));
  }
  return 0;
}
function ue14(n14) {
  return n14.pos == n14.options.simulateBreak && n14.options.simulateDoubleBreak;
}
function ce16(n14) {
  let t8 = n14.type.prop(he14);
  if (t8) return t8;
  let e7 = n14.firstChild, r2;
  if (e7 && (r2 = e7.type.prop(v7.closedBy))) {
    let i12 = n14.lastChild, s212 = i12 && r2.indexOf(i12.name) > -1;
    return (o) => Ut9(o, true, 1, void 0, s212 && !ue14(o) ? i12.from : void 0);
  }
  return n14.parent == null ? de12 : null;
}
function de12() {
  return 0;
}
var Z15 = class n12 extends M9 {
  constructor(t8, e7, r2) {
    super(t8.state, t8.options), this.base = t8, this.pos = e7, this.context = r2;
  }
  get node() {
    return this.context.node;
  }
  static create(t8, e7, r2) {
    return new n12(t8, e7, r2);
  }
  get textAfter() {
    return this.textAfterPos(this.pos);
  }
  get baseIndent() {
    return this.baseIndentFor(this.node);
  }
  baseIndentFor(t8) {
    let e7 = this.state.doc.lineAt(t8.from);
    for (; ; ) {
      let r2 = t8.resolve(e7.from);
      for (; r2.parent && r2.parent.from == r2.from; ) r2 = r2.parent;
      if (pe15(r2, t8)) break;
      e7 = this.state.doc.lineAt(r2.from);
    }
    return this.lineIndent(e7.from);
  }
  continue() {
    return Rt8(this.context.next, this.base, this.pos);
  }
};
function pe15(n14, t8) {
  for (let e7 = t8; e7; e7 = e7.parent) if (n14 == e7) return true;
  return false;
}
function ge17(n14) {
  let t8 = n14.node, e7 = t8.childAfter(t8.from), r2 = t8.lastChild;
  if (!e7) return null;
  let i12 = n14.options.simulateBreak, s212 = n14.state.doc.lineAt(e7.from), o = i12 == null || i12 <= s212.from ? s212.to : Math.min(s212.to, i12);
  for (let a2 = e7.to; ; ) {
    let l11 = t8.childAfter(a2);
    if (!l11 || l11 == r2) return null;
    if (!l11.type.isSkipped) return l11.from < o ? e7 : null;
    a2 = l11.to;
  }
}
function Ut9(n14, t8, e7, r2, i12) {
  let s212 = n14.textAfter, o = s212.match(/^\s*/)[0].length, a2 = r2 && s212.slice(o, o + r2.length) == r2 || i12 == n14.pos + o, l11 = t8 ? ge17(n14) : null;
  return l11 ? a2 ? n14.column(l11.from) : n14.column(l11.to) : n14.baseIndent + (a2 ? 0 : n14.unit * e7);
}
var ke13 = y11.define();
var be15 = new v7();
function Wt10(n14, t8) {
  let e7 = t8.mapPos(n14.from, 1), r2 = t8.mapPos(n14.to, -1);
  return e7 >= r2 ? void 0 : { from: e7, to: r2 };
}
var R14 = v5.define({ map: Wt10 });
var T17 = v5.define({ map: Wt10 });
var P18 = $9.define({ create() {
  return R11.none;
}, update(n14, t8) {
  n14 = n14.map(t8.changes);
  for (let e7 of t8.effects) if (e7.is(R14) && !ve13(n14, e7.value.from, e7.value.to)) {
    let { preparePlaceholder: r2 } = t8.state.facet(ft5), i12 = r2 ? R11.replace({ widget: new tt8(r2(t8.state, e7.value)) }) : wt6;
    n14 = n14.update({ add: [i12.range(e7.value.from, e7.value.to)] });
  } else e7.is(T17) && (n14 = n14.update({ filter: (r2, i12) => e7.value.from != r2 || e7.value.to != i12, filterFrom: e7.value.from, filterTo: e7.value.to }));
  if (t8.selection) {
    let e7 = false, { head: r2 } = t8.selection.main;
    n14.between(r2, r2, (i12, s212) => {
      i12 < r2 && s212 > r2 && (e7 = true);
    }), e7 && (n14 = n14.update({ filterFrom: r2, filterTo: r2, filter: (i12, s212) => s212 <= r2 || i12 >= r2 }));
  }
  return n14;
}, provide: (n14) => A11.decorations.from(n14), toJSON(n14, t8) {
  let e7 = [];
  return n14.between(0, t8.doc.length, (r2, i12) => {
    e7.push(r2, i12);
  }), e7;
}, fromJSON(n14) {
  if (!Array.isArray(n14) || n14.length % 2) throw new RangeError("Invalid JSON for fold state");
  let t8 = [];
  for (let e7 = 0; e7 < n14.length; ) {
    let r2 = n14[e7++], i12 = n14[e7++];
    if (typeof r2 != "number" || typeof i12 != "number") throw new RangeError("Invalid JSON for fold state");
    t8.push(wt6.range(r2, i12));
  }
  return R11.set(t8, true);
} });
function F17(n14, t8, e7) {
  var r2;
  let i12 = null;
  return (r2 = n14.field(P18, false)) === null || r2 === void 0 || r2.between(t8, e7, (s212, o) => {
    (!i12 || i12.from > s212) && (i12 = { from: s212, to: o });
  }), i12;
}
function ve13(n14, t8, e7) {
  let r2 = false;
  return n14.between(t8, t8, (i12, s212) => {
    i12 == t8 && s212 == e7 && (r2 = true);
  }), r2;
}
var Te12 = { placeholderDOM: null, preparePlaceholder: null, placeholderText: "â€¦" };
var ft5 = y11.define({ combine(n14) {
  return ht8(n14, Te12);
} });
function Vt10(n14, t8) {
  let { state: e7 } = n14, r2 = e7.facet(ft5), i12 = (o) => {
    let a2 = n14.lineBlockAt(n14.posAtDOM(o.target)), l11 = F17(n14.state, a2.from, a2.to);
    l11 && n14.dispatch({ effects: T17.of(l11) }), o.preventDefault();
  };
  if (r2.placeholderDOM) return r2.placeholderDOM(n14, i12, t8);
  let s212 = document.createElement("span");
  return s212.textContent = r2.placeholderText, s212.setAttribute("aria-label", e7.phrase("folded code")), s212.title = e7.phrase("unfold"), s212.className = "cm-foldPlaceholder", s212.onclick = i12, s212;
}
var wt6 = R11.replace({ widget: new class extends ot9 {
  toDOM(n14) {
    return Vt10(n14, null);
  }
}() });
var tt8 = class extends ot9 {
  constructor(t8) {
    super(), this.value = t8;
  }
  eq(t8) {
    return this.value == t8.value;
  }
  toDOM(t8) {
    return Vt10(t8, this.value);
  }
};
var De12 = A11.baseTheme({ ".cm-foldPlaceholder": { backgroundColor: "#eee", border: "1px solid #ddd", color: "#888", borderRadius: ".2em", margin: "0 1px", padding: "0 1px", cursor: "pointer" }, ".cm-foldGutter span": { padding: "0 1px", cursor: "pointer" } });
var $14 = class n13 {
  constructor(t8, e7) {
    this.specs = t8;
    let r2;
    function i12(a2) {
      let l11 = b7.newName();
      return (r2 || (r2 = /* @__PURE__ */ Object.create(null)))["." + l11] = a2, l11;
    }
    let s212 = typeof e7.all == "string" ? e7.all : e7.all ? i12(e7.all) : void 0, o = e7.scope;
    this.scope = o instanceof d3 ? (a2) => a2.prop(A15) == o.data : o ? (a2) => a2 == o : void 0, this.style = W12(t8.map((a2) => ({ tag: a2.tag, class: a2.class || i12(Object.assign({}, a2, { tag: null })) })), { all: s212 }).style, this.module = r2 ? new b7(r2) : null, this.themeType = e7.themeType;
  }
  static define(t8, e7) {
    return new n13(t8, e7 || {});
  }
};
var et10 = y11.define();
var Ht9 = y11.define({ combine(n14) {
  return n14.length ? [n14[0]] : null;
} });
function j16(n14) {
  let t8 = n14.facet(et10);
  return t8.length ? t8 : n14.facet(Ht9);
}
var nt12 = class {
  constructor(t8) {
    this.markCache = /* @__PURE__ */ Object.create(null), this.tree = k11(t8.state), this.decorations = this.buildDeco(t8, j16(t8.state));
  }
  update(t8) {
    let e7 = k11(t8.state), r2 = j16(t8.state), i12 = r2 != j16(t8.startState);
    e7.length < t8.view.viewport.to && !i12 && e7.type == this.tree.type ? this.decorations = this.decorations.map(t8.changes) : (e7 != this.tree || t8.viewportChanged || i12) && (this.tree = e7, this.decorations = this.buildDeco(t8.view, r2));
  }
  buildDeco(t8, e7) {
    if (!e7 || !this.tree.length) return R11.none;
    let r2 = new se7();
    for (let { from: i12, to: s212 } of t8.visibleRanges) Y16(this.tree, e7, (o, a2, l11) => {
      r2.add(o, a2, this.markCache[l11] || (this.markCache[l11] = R11.mark({ class: l11 })));
    }, i12, s212);
    return r2.finish();
  }
};
var Oe11 = lt8.high(H5.fromClass(nt12, { decorations: (n14) => n14.decorations }));
var pn8 = $14.define([{ tag: l10.meta, color: "#404740" }, { tag: l10.link, textDecoration: "underline" }, { tag: l10.heading, textDecoration: "underline", fontWeight: "bold" }, { tag: l10.emphasis, fontStyle: "italic" }, { tag: l10.strong, fontWeight: "bold" }, { tag: l10.strikethrough, textDecoration: "line-through" }, { tag: l10.keyword, color: "#708" }, { tag: [l10.atom, l10.bool, l10.url, l10.contentSeparator, l10.labelName], color: "#219" }, { tag: [l10.literal, l10.inserted], color: "#164" }, { tag: [l10.string, l10.deleted], color: "#a11" }, { tag: [l10.regexp, l10.escape, l10.special(l10.string)], color: "#e40" }, { tag: l10.definition(l10.variableName), color: "#00f" }, { tag: l10.local(l10.variableName), color: "#30a" }, { tag: [l10.typeName, l10.namespace], color: "#085" }, { tag: l10.className, color: "#167" }, { tag: [l10.special(l10.variableName), l10.macroName], color: "#256" }, { tag: l10.definition(l10.propertyName), color: "#00c" }, { tag: l10.comment, color: "#940" }, { tag: l10.invalid, color: "#f00" }]);
var Ne17 = A11.baseTheme({ "&.cm-focused .cm-matchingBracket": { backgroundColor: "#328c8252" }, "&.cm-focused .cm-nonmatchingBracket": { backgroundColor: "#bb555544" } });
var $t9 = 1e4;
var qt8 = "()[]{}";
var zt8 = y11.define({ combine(n14) {
  return ht8(n14, { afterCursor: true, brackets: qt8, maxScanDistance: $t9, renderMatch: Ee15 });
} });
var Be15 = R11.mark({ class: "cm-matchingBracket" });
var Me14 = R11.mark({ class: "cm-nonmatchingBracket" });
function Ee15(n14) {
  let t8 = [], e7 = n14.matched ? Be15 : Me14;
  return t8.push(e7.range(n14.start.from, n14.start.to)), n14.end && t8.push(e7.range(n14.end.from, n14.end.to)), t8;
}
var Fe14 = $9.define({ create() {
  return R11.none;
}, update(n14, t8) {
  if (!t8.docChanged && !t8.selection) return n14;
  let e7 = [], r2 = t8.state.facet(zt8);
  for (let i12 of t8.state.selection.ranges) {
    if (!i12.empty) continue;
    let s212 = U17(t8.state, i12.head, -1, r2) || i12.head > 0 && U17(t8.state, i12.head - 1, 1, r2) || r2.afterCursor && (U17(t8.state, i12.head, 1, r2) || i12.head < t8.state.doc.length && U17(t8.state, i12.head + 1, -1, r2));
    s212 && (e7 = e7.concat(r2.renderMatch(s212, t8.state)));
  }
  return R11.set(e7, true);
}, provide: (n14) => A11.decorations.from(n14) });
var Re12 = new v7();
function rt12(n14, t8, e7) {
  let r2 = n14.prop(t8 < 0 ? v7.openedBy : v7.closedBy);
  if (r2) return r2;
  if (n14.name.length == 1) {
    let i12 = e7.indexOf(n14.name);
    if (i12 > -1 && i12 % 2 == (t8 < 0 ? 1 : 0)) return [e7[i12 + t8]];
  }
  return null;
}
function it9(n14) {
  let t8 = n14.type.prop(Re12);
  return t8 ? t8(n14.node) : n14;
}
function U17(n14, t8, e7, r2 = {}) {
  let i12 = r2.maxScanDistance || $t9, s212 = r2.brackets || qt8, o = k11(n14), a2 = o.resolveInner(t8, e7);
  for (let l11 = a2; l11; l11 = l11.parent) {
    let h3 = rt12(l11.type, e7, s212);
    if (h3 && l11.from < l11.to) {
      let f6 = it9(l11);
      if (f6 && (e7 > 0 ? t8 >= f6.from && t8 < f6.to : t8 > f6.from && t8 <= f6.to)) return Ue12(n14, t8, e7, l11, f6, h3, s212);
    }
  }
  return We12(n14, t8, e7, o, a2.type, i12, s212);
}
function Ue12(n14, t8, e7, r2, i12, s212, o) {
  let a2 = r2.parent, l11 = { from: i12.from, to: i12.to }, h3 = 0, f6 = a2?.cursor();
  if (f6 && (e7 < 0 ? f6.childBefore(r2.from) : f6.childAfter(r2.to))) do
    if (e7 < 0 ? f6.to <= r2.from : f6.from >= r2.to) {
      if (h3 == 0 && s212.indexOf(f6.type.name) > -1 && f6.from < f6.to) {
        let c3 = it9(f6);
        return { start: l11, end: c3 ? { from: c3.from, to: c3.to } : void 0, matched: true };
      } else if (rt12(f6.type, e7, o)) h3++;
      else if (rt12(f6.type, -e7, o)) {
        if (h3 == 0) {
          let c3 = it9(f6);
          return { start: l11, end: c3 && c3.from < c3.to ? { from: c3.from, to: c3.to } : void 0, matched: false };
        }
        h3--;
      }
    }
  while (e7 < 0 ? f6.prevSibling() : f6.nextSibling());
  return { start: l11, matched: false };
}
function We12(n14, t8, e7, r2, i12, s212, o) {
  let a2 = e7 < 0 ? n14.sliceDoc(t8 - 1, t8) : n14.sliceDoc(t8, t8 + 1), l11 = o.indexOf(a2);
  if (l11 < 0 || l11 % 2 == 0 != e7 > 0) return null;
  let h3 = { from: e7 < 0 ? t8 - 1 : t8, to: e7 > 0 ? t8 + 1 : t8 }, f6 = n14.doc.iterRange(t8, e7 > 0 ? n14.doc.length : 0), c3 = 0;
  for (let g8 = 0; !f6.next().done && g8 <= s212; ) {
    let p3 = f6.value;
    e7 < 0 && (g8 += p3.length);
    let y18 = t8 + g8 * e7;
    for (let C11 = e7 > 0 ? 0 : p3.length - 1, Qt9 = e7 > 0 ? p3.length : -1; C11 != Qt9; C11 += e7) {
      let _18 = o.indexOf(p3[C11]);
      if (!(_18 < 0 || r2.resolveInner(y18 + C11, 1).type != i12)) if (_18 % 2 == 0 == e7 > 0) c3++;
      else {
        if (c3 == 1) return { start: h3, end: { from: y18 + C11, to: y18 + C11 + 1 }, matched: _18 >> 1 == l11 >> 1 };
        c3--;
      }
    }
    e7 > 0 && (g8 += p3.length);
  }
  return f6.done ? { start: h3, matched: false } : null;
}
var ct5 = /* @__PURE__ */ Object.create(null);
var L14 = [T15.none];
var $e14 = new ge15(L14);
var St8 = [];
var Pt7 = /* @__PURE__ */ Object.create(null);
var _t9 = /* @__PURE__ */ Object.create(null);
for (let [n14, t8] of [["variable", "variableName"], ["variable-2", "variableName.special"], ["string-2", "string.special"], ["def", "variableName.definition"], ["tag", "tagName"], ["attribute", "attributeName"], ["type", "typeName"], ["builtin", "variableName.standard"], ["qualifier", "modifier"], ["error", "invalid"], ["header", "heading"], ["property", "propertyName"]]) _t9[n14] = Kt8(ct5, t8);
var z17 = class {
  constructor(t8) {
    this.extra = t8, this.table = Object.assign(/* @__PURE__ */ Object.create(null), _t9);
  }
  resolve(t8) {
    return t8 ? this.table[t8] || (this.table[t8] = Kt8(this.extra, t8)) : 0;
  }
};
var qe12 = new z17(ct5);
function X16(n14, t8) {
  St8.indexOf(n14) > -1 || (St8.push(n14), console.warn(t8));
}
function Kt8(n14, t8) {
  let e7 = [];
  for (let a2 of t8.split(" ")) {
    let l11 = [];
    for (let h3 of a2.split(".")) {
      let f6 = n14[h3] || l10[h3];
      f6 ? typeof f6 == "function" ? l11.length ? l11 = l11.map(f6) : X16(h3, `Modifier ${h3} used at start of tag`) : l11.length ? X16(h3, `Tag ${h3} used as modifier`) : l11 = Array.isArray(f6) ? f6 : [f6] : X16(h3, `Unknown highlighting tag ${h3}`);
    }
    for (let h3 of l11) e7.push(h3);
  }
  if (!e7.length) return 0;
  let r2 = t8.replace(/ /g, "_"), i12 = r2 + " " + e7.map((a2) => a2.id), s212 = Pt7[i12];
  if (s212) return s212.id;
  let o = Pt7[i12] = T15.define({ id: L14.length, name: r2, props: [_14({ [r2]: e7 })] });
  return L14.push(o), o.id;
}

// https://esm.sh/v135/@lezer/common@1.1.1/denonext/common.mjs
var Ie12 = 0;
var k12 = class {
  constructor(e7 = {}) {
    this.id = Ie12++, this.perNode = !!e7.perNode, this.deserialize = e7.deserialize || (() => {
      throw new Error("This node type doesn't define a deserialize function");
    });
  }
  add(e7) {
    if (this.perNode) throw new RangeError("Can't add per-node props to node types");
    return typeof e7 != "function" && (e7 = F18.match(e7)), (t8) => {
      let r2 = e7(t8);
      return r2 === void 0 ? null : [this, r2];
    };
  }
};
k12.closedBy = new k12({ deserialize: (s212) => s212.split(" ") });
k12.openedBy = new k12({ deserialize: (s212) => s212.split(" ") });
k12.group = new k12({ deserialize: (s212) => s212.split(" ") });
k12.contextHash = new k12({ perNode: true });
k12.lookAhead = new k12({ perNode: true });
k12.mounted = new k12({ perNode: true });
var V18 = class {
  constructor(e7, t8, r2) {
    this.tree = e7, this.overlay = t8, this.parser = r2;
  }
  static get(e7) {
    return e7 && e7.props && e7.props[k12.mounted.id];
  }
};
var ze13 = /* @__PURE__ */ Object.create(null);
var F18 = class s206 {
  constructor(e7, t8, r2, i12 = 0) {
    this.name = e7, this.props = t8, this.id = r2, this.flags = i12;
  }
  static define(e7) {
    let t8 = e7.props && e7.props.length ? /* @__PURE__ */ Object.create(null) : ze13, r2 = (e7.top ? 1 : 0) | (e7.skipped ? 2 : 0) | (e7.error ? 4 : 0) | (e7.name == null ? 8 : 0), i12 = new s206(e7.name || "", t8, e7.id, r2);
    if (e7.props) {
      for (let n14 of e7.props) if (Array.isArray(n14) || (n14 = n14(i12)), n14) {
        if (n14[0].perNode) throw new RangeError("Can't store a per-node prop on a node type");
        t8[n14[0].id] = n14[1];
      }
    }
    return i12;
  }
  prop(e7) {
    return this.props[e7.id];
  }
  get isTop() {
    return (this.flags & 1) > 0;
  }
  get isSkipped() {
    return (this.flags & 2) > 0;
  }
  get isError() {
    return (this.flags & 4) > 0;
  }
  get isAnonymous() {
    return (this.flags & 8) > 0;
  }
  is(e7) {
    if (typeof e7 == "string") {
      if (this.name == e7) return true;
      let t8 = this.prop(k12.group);
      return t8 ? t8.indexOf(e7) > -1 : false;
    }
    return this.id == e7;
  }
  static match(e7) {
    let t8 = /* @__PURE__ */ Object.create(null);
    for (let r2 in e7) for (let i12 of r2.split(" ")) t8[i12] = e7[r2];
    return (r2) => {
      for (let i12 = r2.prop(k12.group), n14 = -1; n14 < (i12 ? i12.length : 0); n14++) {
        let l11 = t8[n14 < 0 ? r2.name : i12[n14]];
        if (l11) return l11;
      }
    };
  }
};
F18.none = new F18("", /* @__PURE__ */ Object.create(null), 0, 8);
var Y19 = /* @__PURE__ */ new WeakMap();
var xe16 = /* @__PURE__ */ new WeakMap();
var S15;
(function(s212) {
  s212[s212.ExcludeBuffers = 1] = "ExcludeBuffers", s212[s212.IncludeAnonymous = 2] = "IncludeAnonymous", s212[s212.IgnoreMounts = 4] = "IgnoreMounts", s212[s212.IgnoreOverlays = 8] = "IgnoreOverlays";
})(S15 || (S15 = {}));
var O15 = class s207 {
  constructor(e7, t8, r2, i12, n14) {
    if (this.type = e7, this.children = t8, this.positions = r2, this.length = i12, this.props = null, n14 && n14.length) {
      this.props = /* @__PURE__ */ Object.create(null);
      for (let [l11, h3] of n14) this.props[typeof l11 == "number" ? l11 : l11.id] = h3;
    }
  }
  toString() {
    let e7 = V18.get(this);
    if (e7 && !e7.overlay) return e7.tree.toString();
    let t8 = "";
    for (let r2 of this.children) {
      let i12 = r2.toString();
      i12 && (t8 && (t8 += ","), t8 += i12);
    }
    return this.type.name ? (/\W/.test(this.type.name) && !this.type.isError ? JSON.stringify(this.type.name) : this.type.name) + (t8.length ? "(" + t8 + ")" : "") : t8;
  }
  cursor(e7 = 0) {
    return new K13(this.topNode, e7);
  }
  cursorAt(e7, t8 = 0, r2 = 0) {
    let i12 = Y19.get(this) || this.topNode, n14 = new K13(i12);
    return n14.moveTo(e7, t8), Y19.set(this, n14._tree), n14;
  }
  get topNode() {
    return new P19(this, 0, 0, null);
  }
  resolve(e7, t8 = 0) {
    let r2 = Q17(Y19.get(this) || this.topNode, e7, t8, false);
    return Y19.set(this, r2), r2;
  }
  resolveInner(e7, t8 = 0) {
    let r2 = Q17(xe16.get(this) || this.topNode, e7, t8, true);
    return xe16.set(this, r2), r2;
  }
  resolveStack(e7, t8 = 0) {
    return Pe15(this, e7, t8);
  }
  iterate(e7) {
    let { enter: t8, leave: r2, from: i12 = 0, to: n14 = this.length } = e7, l11 = e7.mode || 0, h3 = (l11 & S15.IncludeAnonymous) > 0;
    for (let f6 = this.cursor(l11 | S15.IncludeAnonymous); ; ) {
      let a2 = false;
      if (f6.from <= n14 && f6.to >= i12 && (!h3 && f6.type.isAnonymous || t8(f6) !== false)) {
        if (f6.firstChild()) continue;
        a2 = true;
      }
      for (; a2 && r2 && (h3 || !f6.type.isAnonymous) && r2(f6), !f6.nextSibling(); ) {
        if (!f6.parent()) return;
        a2 = true;
      }
    }
  }
  prop(e7) {
    return e7.perNode ? this.props ? this.props[e7.id] : void 0 : this.type.prop(e7);
  }
  get propValues() {
    let e7 = [];
    if (this.props) for (let t8 in this.props) e7.push([+t8, this.props[t8]]);
    return e7;
  }
  balance(e7 = {}) {
    return this.children.length <= 8 ? this : de13(F18.none, this.children, this.positions, 0, this.children.length, 0, this.length, (t8, r2, i12) => new s207(this.type, t8, r2, i12, this.propValues), e7.makeTree || ((t8, r2, i12) => new s207(F18.none, t8, r2, i12)));
  }
  static build(e7) {
    return Ee16(e7);
  }
};
O15.empty = new O15(F18.none, [], [], 0);
var ne13 = class s208 {
  constructor(e7, t8) {
    this.buffer = e7, this.index = t8;
  }
  get id() {
    return this.buffer[this.index - 4];
  }
  get start() {
    return this.buffer[this.index - 3];
  }
  get end() {
    return this.buffer[this.index - 2];
  }
  get size() {
    return this.buffer[this.index - 1];
  }
  get pos() {
    return this.index;
  }
  next() {
    this.index -= 4;
  }
  fork() {
    return new s208(this.buffer, this.index);
  }
};
var U18 = class s209 {
  constructor(e7, t8, r2) {
    this.buffer = e7, this.length = t8, this.set = r2;
  }
  get type() {
    return F18.none;
  }
  toString() {
    let e7 = [];
    for (let t8 = 0; t8 < this.buffer.length; ) e7.push(this.childString(t8)), t8 = this.buffer[t8 + 3];
    return e7.join(",");
  }
  childString(e7) {
    let t8 = this.buffer[e7], r2 = this.buffer[e7 + 3], i12 = this.set.types[t8], n14 = i12.name;
    if (/\W/.test(n14) && !i12.isError && (n14 = JSON.stringify(n14)), e7 += 4, r2 == e7) return n14;
    let l11 = [];
    for (; e7 < r2; ) l11.push(this.childString(e7)), e7 = this.buffer[e7 + 3];
    return n14 + "(" + l11.join(",") + ")";
  }
  findChild(e7, t8, r2, i12, n14) {
    let { buffer: l11 } = this, h3 = -1;
    for (let f6 = e7; f6 != t8 && !(Ne18(n14, i12, l11[f6 + 1], l11[f6 + 2]) && (h3 = f6, r2 > 0)); f6 = l11[f6 + 3]) ;
    return h3;
  }
  slice(e7, t8, r2) {
    let i12 = this.buffer, n14 = new Uint16Array(t8 - e7), l11 = 0;
    for (let h3 = e7, f6 = 0; h3 < t8; ) {
      n14[f6++] = i12[h3++], n14[f6++] = i12[h3++] - r2;
      let a2 = n14[f6++] = i12[h3++] - r2;
      n14[f6++] = i12[h3++] - e7, l11 = Math.max(l11, a2);
    }
    return new s209(n14, l11, this.set);
  }
};
function Ne18(s212, e7, t8, r2) {
  switch (s212) {
    case -2:
      return t8 < e7;
    case -1:
      return r2 >= e7 && t8 < e7;
    case 0:
      return t8 < e7 && r2 > e7;
    case 1:
      return t8 <= e7 && r2 > e7;
    case 2:
      return r2 > e7;
    case 4:
      return true;
  }
}
function Q17(s212, e7, t8, r2) {
  for (var i12; s212.from == s212.to || (t8 < 1 ? s212.from >= e7 : s212.from > e7) || (t8 > -1 ? s212.to <= e7 : s212.to < e7); ) {
    let l11 = !r2 && s212 instanceof P19 && s212.index < 0 ? null : s212.parent;
    if (!l11) return s212;
    s212 = l11;
  }
  let n14 = r2 ? 0 : S15.IgnoreOverlays;
  if (r2) for (let l11 = s212, h3 = l11.parent; h3; l11 = h3, h3 = l11.parent) l11 instanceof P19 && l11.index < 0 && ((i12 = h3.enter(e7, t8, n14)) === null || i12 === void 0 ? void 0 : i12.from) != l11.from && (s212 = h3);
  for (; ; ) {
    let l11 = s212.enter(e7, t8, n14);
    if (!l11) return s212;
    s212 = l11;
  }
}
var ee10 = class {
  cursor(e7 = 0) {
    return new K13(this, e7);
  }
  getChild(e7, t8 = null, r2 = null) {
    let i12 = be16(this, e7, t8, r2);
    return i12.length ? i12[0] : null;
  }
  getChildren(e7, t8 = null, r2 = null) {
    return be16(this, e7, t8, r2);
  }
  resolve(e7, t8 = 0) {
    return Q17(this, e7, t8, false);
  }
  resolveInner(e7, t8 = 0) {
    return Q17(this, e7, t8, true);
  }
  matchContext(e7) {
    return se11(this, e7);
  }
  enterUnfinishedNodesBefore(e7) {
    let t8 = this.childBefore(e7), r2 = this;
    for (; t8; ) {
      let i12 = t8.lastChild;
      if (!i12 || i12.to != t8.to) break;
      i12.type.isError && i12.from == i12.to ? (r2 = t8, t8 = i12.prevSibling) : t8 = i12;
    }
    return r2;
  }
  get node() {
    return this;
  }
  get next() {
    return this.parent;
  }
};
var P19 = class s210 extends ee10 {
  constructor(e7, t8, r2, i12) {
    super(), this._tree = e7, this.from = t8, this.index = r2, this._parent = i12;
  }
  get type() {
    return this._tree.type;
  }
  get name() {
    return this._tree.type.name;
  }
  get to() {
    return this.from + this._tree.length;
  }
  nextChild(e7, t8, r2, i12, n14 = 0) {
    for (let l11 = this; ; ) {
      for (let { children: h3, positions: f6 } = l11._tree, a2 = t8 > 0 ? h3.length : -1; e7 != a2; e7 += t8) {
        let o = h3[e7], c3 = f6[e7] + l11.from;
        if (Ne18(i12, r2, c3, c3 + o.length)) {
          if (o instanceof U18) {
            if (n14 & S15.ExcludeBuffers) continue;
            let p3 = o.findChild(0, o.buffer.length, t8, r2 - c3, i12);
            if (p3 > -1) return new G15(new le14(l11, o, e7, c3), null, p3);
          } else if (n14 & S15.IncludeAnonymous || !o.type.isAnonymous || ce17(o)) {
            let p3;
            if (!(n14 & S15.IgnoreMounts) && (p3 = V18.get(o)) && !p3.overlay) return new s210(p3.tree, c3, e7, l11);
            let x11 = new s210(o, c3, e7, l11);
            return n14 & S15.IncludeAnonymous || !x11.type.isAnonymous ? x11 : x11.nextChild(t8 < 0 ? o.children.length - 1 : 0, t8, r2, i12);
          }
        }
      }
      if (n14 & S15.IncludeAnonymous || !l11.type.isAnonymous || (l11.index >= 0 ? e7 = l11.index + t8 : e7 = t8 < 0 ? -1 : l11._parent._tree.children.length, l11 = l11._parent, !l11)) return null;
    }
  }
  get firstChild() {
    return this.nextChild(0, 1, 0, 4);
  }
  get lastChild() {
    return this.nextChild(this._tree.children.length - 1, -1, 0, 4);
  }
  childAfter(e7) {
    return this.nextChild(0, 1, e7, 2);
  }
  childBefore(e7) {
    return this.nextChild(this._tree.children.length - 1, -1, e7, -2);
  }
  enter(e7, t8, r2 = 0) {
    let i12;
    if (!(r2 & S15.IgnoreOverlays) && (i12 = V18.get(this._tree)) && i12.overlay) {
      let n14 = e7 - this.from;
      for (let { from: l11, to: h3 } of i12.overlay) if ((t8 > 0 ? l11 <= n14 : l11 < n14) && (t8 < 0 ? h3 >= n14 : h3 > n14)) return new s210(i12.tree, i12.overlay[0].from + this.from, -1, this);
    }
    return this.nextChild(0, 1, e7, t8, r2);
  }
  nextSignificantParent() {
    let e7 = this;
    for (; e7.type.isAnonymous && e7._parent; ) e7 = e7._parent;
    return e7;
  }
  get parent() {
    return this._parent ? this._parent.nextSignificantParent() : null;
  }
  get nextSibling() {
    return this._parent && this.index >= 0 ? this._parent.nextChild(this.index + 1, 1, 0, 4) : null;
  }
  get prevSibling() {
    return this._parent && this.index >= 0 ? this._parent.nextChild(this.index - 1, -1, 0, 4) : null;
  }
  get tree() {
    return this._tree;
  }
  toTree() {
    return this._tree;
  }
  toString() {
    return this._tree.toString();
  }
};
function be16(s212, e7, t8, r2) {
  let i12 = s212.cursor(), n14 = [];
  if (!i12.firstChild()) return n14;
  if (t8 != null) {
    for (; !i12.type.is(t8); ) if (!i12.nextSibling()) return n14;
  }
  for (; ; ) {
    if (r2 != null && i12.type.is(r2)) return n14;
    if (i12.type.is(e7) && n14.push(i12.node), !i12.nextSibling()) return r2 == null ? n14 : [];
  }
}
function se11(s212, e7, t8 = e7.length - 1) {
  for (let r2 = s212.parent; t8 >= 0; r2 = r2.parent) {
    if (!r2) return false;
    if (!r2.type.isAnonymous) {
      if (e7[t8] && e7[t8] != r2.name) return false;
      t8--;
    }
  }
  return true;
}
var le14 = class {
  constructor(e7, t8, r2, i12) {
    this.parent = e7, this.buffer = t8, this.index = r2, this.start = i12;
  }
};
var G15 = class s211 extends ee10 {
  get name() {
    return this.type.name;
  }
  get from() {
    return this.context.start + this.context.buffer.buffer[this.index + 1];
  }
  get to() {
    return this.context.start + this.context.buffer.buffer[this.index + 2];
  }
  constructor(e7, t8, r2) {
    super(), this.context = e7, this._parent = t8, this.index = r2, this.type = e7.buffer.set.types[e7.buffer.buffer[r2]];
  }
  child(e7, t8, r2) {
    let { buffer: i12 } = this.context, n14 = i12.findChild(this.index + 4, i12.buffer[this.index + 3], e7, t8 - this.context.start, r2);
    return n14 < 0 ? null : new s211(this.context, this, n14);
  }
  get firstChild() {
    return this.child(1, 0, 4);
  }
  get lastChild() {
    return this.child(-1, 0, 4);
  }
  childAfter(e7) {
    return this.child(1, e7, 2);
  }
  childBefore(e7) {
    return this.child(-1, e7, -2);
  }
  enter(e7, t8, r2 = 0) {
    if (r2 & S15.ExcludeBuffers) return null;
    let { buffer: i12 } = this.context, n14 = i12.findChild(this.index + 4, i12.buffer[this.index + 3], t8 > 0 ? 1 : -1, e7 - this.context.start, t8);
    return n14 < 0 ? null : new s211(this.context, this, n14);
  }
  get parent() {
    return this._parent || this.context.parent.nextSignificantParent();
  }
  externalSibling(e7) {
    return this._parent ? null : this.context.parent.nextChild(this.context.index + e7, e7, 0, 4);
  }
  get nextSibling() {
    let { buffer: e7 } = this.context, t8 = e7.buffer[this.index + 3];
    return t8 < (this._parent ? e7.buffer[this._parent.index + 3] : e7.buffer.length) ? new s211(this.context, this._parent, t8) : this.externalSibling(1);
  }
  get prevSibling() {
    let { buffer: e7 } = this.context, t8 = this._parent ? this._parent.index + 4 : 0;
    return this.index == t8 ? this.externalSibling(-1) : new s211(this.context, this._parent, e7.findChild(t8, this.index, -1, 0, 4));
  }
  get tree() {
    return null;
  }
  toTree() {
    let e7 = [], t8 = [], { buffer: r2 } = this.context, i12 = this.index + 4, n14 = r2.buffer[this.index + 3];
    if (n14 > i12) {
      let l11 = r2.buffer[this.index + 1];
      e7.push(r2.slice(i12, n14, l11)), t8.push(0);
    }
    return new O15(this.type, e7, t8, this.to - this.from);
  }
  toString() {
    return this.context.buffer.childString(this.index);
  }
};
function Be16(s212) {
  if (!s212.length) return null;
  let e7 = 0, t8 = s212[0];
  for (let n14 = 1; n14 < s212.length; n14++) {
    let l11 = s212[n14];
    (l11.from > t8.from || l11.to < t8.to) && (t8 = l11, e7 = n14);
  }
  let r2 = t8 instanceof P19 && t8.index < 0 ? null : t8.parent, i12 = s212.slice();
  return r2 ? i12[e7] = r2 : i12.splice(e7, 1), new he15(i12, t8);
}
var he15 = class {
  constructor(e7, t8) {
    this.heads = e7, this.node = t8;
  }
  get next() {
    return Be16(this.heads);
  }
};
function Pe15(s212, e7, t8) {
  let r2 = s212.resolveInner(e7, t8), i12 = null;
  for (let n14 = r2 instanceof P19 ? r2 : r2.context.parent; n14; n14 = n14.parent) if (n14.index < 0) {
    let l11 = n14.parent;
    (i12 || (i12 = [r2])).push(l11.resolve(e7, t8)), n14 = l11;
  } else {
    let l11 = V18.get(n14.tree);
    if (l11 && l11.overlay && l11.overlay[0].from <= e7 && l11.overlay[l11.overlay.length - 1].to >= e7) {
      let h3 = new P19(l11.tree, l11.overlay[0].from + n14.from, -1, n14);
      (i12 || (i12 = [r2])).push(Q17(h3, e7, t8, false));
    }
  }
  return i12 ? Be16(i12) : r2;
}
var K13 = class {
  get name() {
    return this.type.name;
  }
  constructor(e7, t8 = 0) {
    if (this.mode = t8, this.buffer = null, this.stack = [], this.index = 0, this.bufferNode = null, e7 instanceof P19) this.yieldNode(e7);
    else {
      this._tree = e7.context.parent, this.buffer = e7.context;
      for (let r2 = e7._parent; r2; r2 = r2._parent) this.stack.unshift(r2.index);
      this.bufferNode = e7, this.yieldBuf(e7.index);
    }
  }
  yieldNode(e7) {
    return e7 ? (this._tree = e7, this.type = e7.type, this.from = e7.from, this.to = e7.to, true) : false;
  }
  yieldBuf(e7, t8) {
    this.index = e7;
    let { start: r2, buffer: i12 } = this.buffer;
    return this.type = t8 || i12.set.types[i12.buffer[e7]], this.from = r2 + i12.buffer[e7 + 1], this.to = r2 + i12.buffer[e7 + 2], true;
  }
  yield(e7) {
    return e7 ? e7 instanceof P19 ? (this.buffer = null, this.yieldNode(e7)) : (this.buffer = e7.context, this.yieldBuf(e7.index, e7.type)) : false;
  }
  toString() {
    return this.buffer ? this.buffer.buffer.childString(this.index) : this._tree.toString();
  }
  enterChild(e7, t8, r2) {
    if (!this.buffer) return this.yield(this._tree.nextChild(e7 < 0 ? this._tree._tree.children.length - 1 : 0, e7, t8, r2, this.mode));
    let { buffer: i12 } = this.buffer, n14 = i12.findChild(this.index + 4, i12.buffer[this.index + 3], e7, t8 - this.buffer.start, r2);
    return n14 < 0 ? false : (this.stack.push(this.index), this.yieldBuf(n14));
  }
  firstChild() {
    return this.enterChild(1, 0, 4);
  }
  lastChild() {
    return this.enterChild(-1, 0, 4);
  }
  childAfter(e7) {
    return this.enterChild(1, e7, 2);
  }
  childBefore(e7) {
    return this.enterChild(-1, e7, -2);
  }
  enter(e7, t8, r2 = this.mode) {
    return this.buffer ? r2 & S15.ExcludeBuffers ? false : this.enterChild(1, e7, t8) : this.yield(this._tree.enter(e7, t8, r2));
  }
  parent() {
    if (!this.buffer) return this.yieldNode(this.mode & S15.IncludeAnonymous ? this._tree._parent : this._tree.parent);
    if (this.stack.length) return this.yieldBuf(this.stack.pop());
    let e7 = this.mode & S15.IncludeAnonymous ? this.buffer.parent : this.buffer.parent.nextSignificantParent();
    return this.buffer = null, this.yieldNode(e7);
  }
  sibling(e7) {
    if (!this.buffer) return this._tree._parent ? this.yield(this._tree.index < 0 ? null : this._tree._parent.nextChild(this._tree.index + e7, e7, 0, 4, this.mode)) : false;
    let { buffer: t8 } = this.buffer, r2 = this.stack.length - 1;
    if (e7 < 0) {
      let i12 = r2 < 0 ? 0 : this.stack[r2] + 4;
      if (this.index != i12) return this.yieldBuf(t8.findChild(i12, this.index, -1, 0, 4));
    } else {
      let i12 = t8.buffer[this.index + 3];
      if (i12 < (r2 < 0 ? t8.buffer.length : t8.buffer[this.stack[r2] + 3])) return this.yieldBuf(i12);
    }
    return r2 < 0 ? this.yield(this.buffer.parent.nextChild(this.buffer.index + e7, e7, 0, 4, this.mode)) : false;
  }
  nextSibling() {
    return this.sibling(1);
  }
  prevSibling() {
    return this.sibling(-1);
  }
  atLastNode(e7) {
    let t8, r2, { buffer: i12 } = this;
    if (i12) {
      if (e7 > 0) {
        if (this.index < i12.buffer.buffer.length) return false;
      } else for (let n14 = 0; n14 < this.index; n14++) if (i12.buffer.buffer[n14 + 3] < this.index) return false;
      ({ index: t8, parent: r2 } = i12);
    } else ({ index: t8, _parent: r2 } = this._tree);
    for (; r2; { index: t8, _parent: r2 } = r2) if (t8 > -1) for (let n14 = t8 + e7, l11 = e7 < 0 ? -1 : r2._tree.children.length; n14 != l11; n14 += e7) {
      let h3 = r2._tree.children[n14];
      if (this.mode & S15.IncludeAnonymous || h3 instanceof U18 || !h3.type.isAnonymous || ce17(h3)) return false;
    }
    return true;
  }
  move(e7, t8) {
    if (t8 && this.enterChild(e7, 0, 4)) return true;
    for (; ; ) {
      if (this.sibling(e7)) return true;
      if (this.atLastNode(e7) || !this.parent()) return false;
    }
  }
  next(e7 = true) {
    return this.move(1, e7);
  }
  prev(e7 = true) {
    return this.move(-1, e7);
  }
  moveTo(e7, t8 = 0) {
    for (; (this.from == this.to || (t8 < 1 ? this.from >= e7 : this.from > e7) || (t8 > -1 ? this.to <= e7 : this.to < e7)) && this.parent(); ) ;
    for (; this.enterChild(1, e7, t8); ) ;
    return this;
  }
  get node() {
    if (!this.buffer) return this._tree;
    let e7 = this.bufferNode, t8 = null, r2 = 0;
    if (e7 && e7.context == this.buffer) e: for (let i12 = this.index, n14 = this.stack.length; n14 >= 0; ) {
      for (let l11 = e7; l11; l11 = l11._parent) if (l11.index == i12) {
        if (i12 == this.index) return l11;
        t8 = l11, r2 = n14 + 1;
        break e;
      }
      i12 = this.stack[--n14];
    }
    for (let i12 = r2; i12 < this.stack.length; i12++) t8 = new G15(this.buffer, t8, this.stack[i12]);
    return this.bufferNode = new G15(this.buffer, t8, this.index);
  }
  get tree() {
    return this.buffer ? null : this._tree._tree;
  }
  iterate(e7, t8) {
    for (let r2 = 0; ; ) {
      let i12 = false;
      if (this.type.isAnonymous || e7(this) !== false) {
        if (this.firstChild()) {
          r2++;
          continue;
        }
        this.type.isAnonymous || (i12 = true);
      }
      for (; i12 && t8 && t8(this), i12 = this.type.isAnonymous, !this.nextSibling(); ) {
        if (!r2) return;
        this.parent(), r2--, i12 = true;
      }
    }
  }
  matchContext(e7) {
    if (!this.buffer) return se11(this.node, e7);
    let { buffer: t8 } = this.buffer, { types: r2 } = t8.set;
    for (let i12 = e7.length - 1, n14 = this.stack.length - 1; i12 >= 0; n14--) {
      if (n14 < 0) return se11(this.node, e7, i12);
      let l11 = r2[t8.buffer[this.stack[n14]]];
      if (!l11.isAnonymous) {
        if (e7[i12] && e7[i12] != l11.name) return false;
        i12--;
      }
    }
    return true;
  }
};
function ce17(s212) {
  return s212.children.some((e7) => e7 instanceof U18 || !e7.type.isAnonymous || ce17(e7));
}
function Ee16(s212) {
  var e7;
  let { buffer: t8, nodeSet: r2, maxBufferLength: i12 = 1024, reused: n14 = [], minRepeatType: l11 = r2.types.length } = s212, h3 = Array.isArray(t8) ? new ne13(t8, t8.length) : t8, f6 = r2.types, a2 = 0, o = 0;
  function c3(y18, w14, u3, A18, b12, m11) {
    let { id: d4, start: g8, end: C11, size: v10 } = h3, I22 = o;
    for (; v10 < 0; ) if (h3.next(), v10 == -1) {
      let L19 = n14[d4];
      u3.push(L19), A18.push(g8 - y18);
      return;
    } else if (v10 == -3) {
      a2 = d4;
      return;
    } else if (v10 == -4) {
      o = d4;
      return;
    } else throw new RangeError(`Unrecognized record size: ${v10}`);
    let W15 = f6[d4], $18, H12, ge20 = g8 - y18;
    if (C11 - g8 <= i12 && (H12 = T22(h3.pos - w14, b12))) {
      let L19 = new Uint16Array(H12.size - H12.skip), M12 = h3.pos - H12.size, D14 = L19.length;
      for (; h3.pos > M12; ) D14 = j19(H12.start, L19, D14);
      $18 = new U18(L19, C11 - H12.start, r2), ge20 = H12.start - y18;
    } else {
      let L19 = h3.pos - v10;
      h3.next();
      let M12 = [], D14 = [], J15 = d4 >= l11 ? d4 : -1, q17 = 0, X19 = C11;
      for (; h3.pos > L19; ) J15 >= 0 && h3.id == J15 && h3.size >= 0 ? (h3.end <= X19 - i12 && (_18(M12, D14, g8, q17, h3.end, X19, J15, I22), q17 = M12.length, X19 = h3.end), h3.next()) : m11 > 2500 ? p3(g8, L19, M12, D14) : c3(g8, L19, M12, D14, J15, m11 + 1);
      if (J15 >= 0 && q17 > 0 && q17 < M12.length && _18(M12, D14, g8, q17, g8, X19, J15, I22), M12.reverse(), D14.reverse(), J15 > -1 && q17 > 0) {
        let me19 = x11(W15);
        $18 = de13(W15, M12, D14, 0, M12.length, 0, C11 - g8, me19, me19);
      } else $18 = B15(W15, M12, D14, C11 - g8, I22 - C11);
    }
    u3.push($18), A18.push(ge20);
  }
  function p3(y18, w14, u3, A18) {
    let b12 = [], m11 = 0, d4 = -1;
    for (; h3.pos > w14; ) {
      let { id: g8, start: C11, end: v10, size: I22 } = h3;
      if (I22 > 4) h3.next();
      else {
        if (d4 > -1 && C11 < d4) break;
        d4 < 0 && (d4 = v10 - i12), b12.push(g8, C11, v10), m11++, h3.next();
      }
    }
    if (m11) {
      let g8 = new Uint16Array(m11 * 4), C11 = b12[b12.length - 2];
      for (let v10 = b12.length - 3, I22 = 0; v10 >= 0; v10 -= 3) g8[I22++] = b12[v10], g8[I22++] = b12[v10 + 1] - C11, g8[I22++] = b12[v10 + 2] - C11, g8[I22++] = I22;
      u3.push(new U18(g8, b12[2] - C11, r2)), A18.push(C11 - y18);
    }
  }
  function x11(y18) {
    return (w14, u3, A18) => {
      let b12 = 0, m11 = w14.length - 1, d4, g8;
      if (m11 >= 0 && (d4 = w14[m11]) instanceof O15) {
        if (!m11 && d4.type == y18 && d4.length == A18) return d4;
        (g8 = d4.prop(k12.lookAhead)) && (b12 = u3[m11] + d4.length + g8);
      }
      return B15(y18, w14, u3, A18, b12);
    };
  }
  function _18(y18, w14, u3, A18, b12, m11, d4, g8) {
    let C11 = [], v10 = [];
    for (; y18.length > A18; ) C11.push(y18.pop()), v10.push(w14.pop() + u3 - b12);
    y18.push(B15(r2.types[d4], C11, v10, m11 - b12, g8 - m11)), w14.push(b12 - u3);
  }
  function B15(y18, w14, u3, A18, b12 = 0, m11) {
    if (a2) {
      let d4 = [k12.contextHash, a2];
      m11 = m11 ? [d4].concat(m11) : [d4];
    }
    if (b12 > 25) {
      let d4 = [k12.lookAhead, b12];
      m11 = m11 ? [d4].concat(m11) : [d4];
    }
    return new O15(y18, w14, u3, A18, m11);
  }
  function T22(y18, w14) {
    let u3 = h3.fork(), A18 = 0, b12 = 0, m11 = 0, d4 = u3.end - i12, g8 = { size: 0, start: 0, skip: 0 };
    e: for (let C11 = u3.pos - y18; u3.pos > C11; ) {
      let v10 = u3.size;
      if (u3.id == w14 && v10 >= 0) {
        g8.size = A18, g8.start = b12, g8.skip = m11, m11 += 4, A18 += 4, u3.next();
        continue;
      }
      let I22 = u3.pos - v10;
      if (v10 < 0 || I22 < C11 || u3.start < d4) break;
      let W15 = u3.id >= l11 ? 4 : 0, $18 = u3.start;
      for (u3.next(); u3.pos > I22; ) {
        if (u3.size < 0) if (u3.size == -3) W15 += 4;
        else break e;
        else u3.id >= l11 && (W15 += 4);
        u3.next();
      }
      b12 = $18, A18 += v10, m11 += W15;
    }
    return (w14 < 0 || A18 == y18) && (g8.size = A18, g8.start = b12, g8.skip = m11), g8.size > 4 ? g8 : void 0;
  }
  function j19(y18, w14, u3) {
    let { id: A18, start: b12, end: m11, size: d4 } = h3;
    if (h3.next(), d4 >= 0 && A18 < l11) {
      let g8 = u3;
      if (d4 > 4) {
        let C11 = h3.pos - (d4 - 4);
        for (; h3.pos > C11; ) u3 = j19(y18, w14, u3);
      }
      w14[--u3] = g8, w14[--u3] = m11 - y18, w14[--u3] = b12 - y18, w14[--u3] = A18;
    } else d4 == -3 ? a2 = A18 : d4 == -4 && (o = A18);
    return u3;
  }
  let E11 = [], N23 = [];
  for (; h3.pos > 0; ) c3(s212.start || 0, s212.bufferStart || 0, E11, N23, -1, 0);
  let R19 = (e7 = s212.length) !== null && e7 !== void 0 ? e7 : E11.length ? N23[0] + E11[0].length : 0;
  return new O15(f6[s212.topID], E11.reverse(), N23.reverse(), R19);
}
var we16 = /* @__PURE__ */ new WeakMap();
function Z16(s212, e7) {
  if (!s212.isAnonymous || e7 instanceof U18 || e7.type != s212) return 1;
  let t8 = we16.get(e7);
  if (t8 == null) {
    t8 = 1;
    for (let r2 of e7.children) {
      if (r2.type != s212 || !(r2 instanceof O15)) {
        t8 = 1;
        break;
      }
      t8 += Z16(s212, r2);
    }
    we16.set(e7, t8);
  }
  return t8;
}
function de13(s212, e7, t8, r2, i12, n14, l11, h3, f6) {
  let a2 = 0;
  for (let _18 = r2; _18 < i12; _18++) a2 += Z16(s212, e7[_18]);
  let o = Math.ceil(a2 * 1.5 / 8), c3 = [], p3 = [];
  function x11(_18, B15, T22, j19, E11) {
    for (let N23 = T22; N23 < j19; ) {
      let R19 = N23, y18 = B15[N23], w14 = Z16(s212, _18[N23]);
      for (N23++; N23 < j19; N23++) {
        let u3 = Z16(s212, _18[N23]);
        if (w14 + u3 >= o) break;
        w14 += u3;
      }
      if (N23 == R19 + 1) {
        if (w14 > o) {
          let u3 = _18[R19];
          x11(u3.children, u3.positions, 0, u3.children.length, B15[R19] + E11);
          continue;
        }
        c3.push(_18[R19]);
      } else {
        let u3 = B15[N23 - 1] + _18[N23 - 1].length - y18;
        c3.push(de13(s212, _18, B15, R19, N23, y18, u3, null, f6));
      }
      p3.push(y18 + E11 - n14);
    }
  }
  return x11(e7, t8, r2, i12, 0), (h3 || f6)(c3, p3, l11);
}
var ue15 = new k12({ perNode: true });

// https://esm.sh/v135/@codemirror/commands@6.3.0/denonext/commands.mjs
var nt13 = (e7) => {
  let { state: t8 } = e7, r2 = t8.doc.lineAt(t8.selection.main.from), n14 = ne14(e7.state, r2.from);
  return n14.line ? rt13(e7) : n14.block ? lt11(e7) : false;
};
function L15(e7, t8) {
  return ({ state: r2, dispatch: n14 }) => {
    if (r2.readOnly) return false;
    let l11 = e7(t8, r2);
    return l11 ? (n14(r2.update(l11)), true) : false;
  };
}
var rt13 = L15(re12, 0);
var dn7 = L15(re12, 1);
var mn6 = L15(re12, 2);
var ot10 = L15(G16, 0);
var pn9 = L15(G16, 1);
var gn7 = L15(G16, 2);
var lt11 = L15((e7, t8) => G16(e7, t8, st12(t8)), 0);
function ne14(e7, t8) {
  let r2 = e7.languageDataAt("commentTokens", t8);
  return r2.length ? r2[0] : {};
}
var T18 = 50;
function ct6(e7, { open: t8, close: r2 }, n14, l11) {
  let o = e7.sliceDoc(n14 - T18, n14), c3 = e7.sliceDoc(l11, l11 + T18), s212 = /\s*$/.exec(o)[0].length, i12 = /^\s*/.exec(c3)[0].length, f6 = o.length - s212;
  if (o.slice(f6 - t8.length, f6) == t8 && c3.slice(i12, i12 + r2.length) == r2) return { open: { pos: n14 - s212, margin: s212 && 1 }, close: { pos: l11 + i12, margin: i12 && 1 } };
  let u3, a2;
  l11 - n14 <= 2 * T18 ? u3 = a2 = e7.sliceDoc(n14, l11) : (u3 = e7.sliceDoc(n14, n14 + T18), a2 = e7.sliceDoc(l11 - T18, l11));
  let d4 = /^\s*/.exec(u3)[0].length, S17 = /\s*$/.exec(a2)[0].length, p3 = a2.length - S17 - r2.length;
  return u3.slice(d4, d4 + t8.length) == t8 && a2.slice(p3, p3 + r2.length) == r2 ? { open: { pos: n14 + d4 + t8.length, margin: /\s/.test(u3.charAt(d4 + t8.length)) ? 1 : 0 }, close: { pos: l11 - S17 - r2.length, margin: /\s/.test(a2.charAt(p3 - 1)) ? 1 : 0 } } : null;
}
function st12(e7) {
  let t8 = [];
  for (let r2 of e7.selection.ranges) {
    let n14 = e7.doc.lineAt(r2.from), l11 = r2.to <= n14.to ? n14 : e7.doc.lineAt(r2.to), o = t8.length - 1;
    o >= 0 && t8[o].to > n14.from ? t8[o].to = l11.to : t8.push({ from: n14.from + /^\s*/.exec(n14.text)[0].length, to: l11.to });
  }
  return t8;
}
function G16(e7, t8, r2 = t8.selection.ranges) {
  let n14 = r2.map((o) => ne14(t8, o.from).block);
  if (!n14.every((o) => o)) return null;
  let l11 = r2.map((o, c3) => ct6(t8, n14[c3], o.from, o.to));
  if (e7 != 2 && !l11.every((o) => o)) return { changes: t8.changes(r2.map((o, c3) => l11[c3] ? [] : [{ from: o.from, insert: n14[c3].open + " " }, { from: o.to, insert: " " + n14[c3].close }])) };
  if (e7 != 1 && l11.some((o) => o)) {
    let o = [];
    for (let c3 = 0, s212; c3 < l11.length; c3++) if (s212 = l11[c3]) {
      let i12 = n14[c3], { open: f6, close: u3 } = s212;
      o.push({ from: f6.pos - i12.open.length, to: f6.pos + f6.margin }, { from: u3.pos - u3.margin, to: u3.pos + i12.close.length });
    }
    return { changes: o };
  }
  return null;
}
function re12(e7, t8, r2 = t8.selection.ranges) {
  let n14 = [], l11 = -1;
  for (let { from: o, to: c3 } of r2) {
    let s212 = n14.length, i12 = 1e9, f6 = ne14(t8, o).line;
    if (f6) {
      for (let u3 = o; u3 <= c3; ) {
        let a2 = t8.doc.lineAt(u3);
        if (a2.from > l11 && (o == c3 || c3 > a2.from)) {
          l11 = a2.from;
          let d4 = /^\s*/.exec(a2.text)[0].length, S17 = d4 == a2.length, p3 = a2.text.slice(d4, d4 + f6.length) == f6 ? d4 : -1;
          d4 < a2.text.length && d4 < i12 && (i12 = d4), n14.push({ line: a2, comment: p3, token: f6, indent: d4, empty: S17, single: false });
        }
        u3 = a2.to + 1;
      }
      if (i12 < 1e9) for (let u3 = s212; u3 < n14.length; u3++) n14[u3].indent < n14[u3].line.text.length && (n14[u3].indent = i12);
      n14.length == s212 + 1 && (n14[s212].single = true);
    }
  }
  if (e7 != 2 && n14.some((o) => o.comment < 0 && (!o.empty || o.single))) {
    let o = [];
    for (let { line: s212, token: i12, indent: f6, empty: u3, single: a2 } of n14) (a2 || !u3) && o.push({ from: s212.from + f6, insert: i12 + " " });
    let c3 = t8.changes(o);
    return { changes: c3, selection: t8.selection.map(c3, 1) };
  } else if (e7 != 1 && n14.some((o) => o.comment >= 0)) {
    let o = [];
    for (let { line: c3, comment: s212, token: i12 } of n14) if (s212 >= 0) {
      let f6 = c3.from + s212, u3 = f6 + i12.length;
      c3.text[u3 - c3.from] == " " && u3++, o.push({ from: f6, to: u3 });
    }
    return { changes: o };
  }
  return null;
}
var X17 = J8.define();
var it10 = J8.define();
var ut7 = y11.define();
var Se12 = y11.define({ combine(e7) {
  return ht8(e7, { minDepth: 100, newGroupDelay: 500, joinToEvent: (t8, r2) => r2 }, { minDepth: Math.max, newGroupDelay: Math.min, joinToEvent: (t8, r2) => (n14, l11) => t8(n14, l11) || r2(n14, l11) });
} });
function ft6(e7) {
  let t8 = 0;
  return e7.iterChangedRanges((r2, n14) => t8 = n14), t8;
}
var w12 = $9.define({ create() {
  return D11.empty;
}, update(e7, t8) {
  let r2 = t8.state.facet(Se12), n14 = t8.annotation(X17);
  if (n14) {
    let i12 = t8.docChanged ? x7.single(ft6(t8.changes)) : void 0, f6 = B12.fromTransaction(t8, i12), u3 = n14.side, a2 = u3 == 0 ? e7.undone : e7.done;
    return f6 ? a2 = V19(a2, a2.length, r2.minDepth, f6) : a2 = De13(a2, t8.startState.selection), new D11(u3 == 0 ? n14.rest : a2, u3 == 0 ? a2 : n14.rest);
  }
  let l11 = t8.annotation(it10);
  if ((l11 == "full" || l11 == "before") && (e7 = e7.isolate()), t8.annotation(S10.addToHistory) === false) return t8.changes.empty ? e7 : e7.addMapping(t8.changes.desc);
  let o = B12.fromTransaction(t8), c3 = t8.annotation(S10.time), s212 = t8.annotation(S10.userEvent);
  return o ? e7 = e7.addChanges(o, c3, s212, r2, t8) : t8.selection && (e7 = e7.addSelection(t8.startState.selection, c3, s212, r2.newGroupDelay)), (l11 == "full" || l11 == "after") && (e7 = e7.isolate()), e7;
}, toJSON(e7) {
  return { done: e7.done.map((t8) => t8.toJSON()), undone: e7.undone.map((t8) => t8.toJSON()) };
}, fromJSON(e7) {
  return new D11(e7.done.map(B12.fromJSON), e7.undone.map(B12.fromJSON));
} });
function yn7(e7 = {}) {
  return [w12, Se12.of(e7), A11.domEventHandlers({ beforeinput(t8, r2) {
    let n14 = t8.inputType == "historyUndo" ? Be17 : t8.inputType == "historyRedo" ? Y20 : null;
    return n14 ? (t8.preventDefault(), n14(r2)) : false;
  } })];
}
function P20(e7, t8) {
  return function({ state: r2, dispatch: n14 }) {
    if (!t8 && r2.readOnly) return false;
    let l11 = r2.field(w12, false);
    if (!l11) return false;
    let o = l11.pop(e7, r2, t8);
    return o ? (n14(o), true) : false;
  };
}
var Be17 = P20(0, false);
var Y20 = P20(1, false);
var at11 = P20(0, true);
var ht11 = P20(1, true);
function Ae10(e7) {
  return function(t8) {
    let r2 = t8.field(w12, false);
    if (!r2) return 0;
    let n14 = e7 == 0 ? r2.done : r2.undone;
    return n14.length - (n14.length && !n14[0].changes ? 1 : 0);
  };
}
var Sn8 = Ae10(0);
var Bn5 = Ae10(1);
var B12 = class e5 {
  constructor(t8, r2, n14, l11, o) {
    this.changes = t8, this.effects = r2, this.mapped = n14, this.startSelection = l11, this.selectionsAfter = o;
  }
  setSelAfter(t8) {
    return new e5(this.changes, this.effects, this.mapped, this.startSelection, t8);
  }
  toJSON() {
    var t8, r2, n14;
    return { changes: (t8 = this.changes) === null || t8 === void 0 ? void 0 : t8.toJSON(), mapped: (r2 = this.mapped) === null || r2 === void 0 ? void 0 : r2.toJSON(), startSelection: (n14 = this.startSelection) === null || n14 === void 0 ? void 0 : n14.toJSON(), selectionsAfter: this.selectionsAfter.map((l11) => l11.toJSON()) };
  }
  static fromJSON(t8) {
    return new e5(t8.changes && P12.fromJSON(t8.changes), [], t8.mapped && C6.fromJSON(t8.mapped), t8.startSelection && x7.fromJSON(t8.startSelection), t8.selectionsAfter.map(x7.fromJSON));
  }
  static fromTransaction(t8, r2) {
    let n14 = y15;
    for (let l11 of t8.startState.facet(ut7)) {
      let o = l11(t8);
      o.length && (n14 = n14.concat(o));
    }
    return !n14.length && t8.changes.empty ? null : new e5(t8.changes.invert(t8.startState.doc), n14, void 0, r2 || t8.startState.selection, y15);
  }
  static selection(t8) {
    return new e5(void 0, y15, void 0, void 0, t8);
  }
};
function V19(e7, t8, r2, n14) {
  let l11 = t8 + 1 > r2 + 20 ? t8 - r2 - 1 : 0, o = e7.slice(l11, t8);
  return o.push(n14), o;
}
function dt9(e7, t8) {
  let r2 = [], n14 = false;
  return e7.iterChangedRanges((l11, o) => r2.push(l11, o)), t8.iterChangedRanges((l11, o, c3, s212) => {
    for (let i12 = 0; i12 < r2.length; ) {
      let f6 = r2[i12++], u3 = r2[i12++];
      s212 >= f6 && c3 <= u3 && (n14 = true);
    }
  }), n14;
}
function mt11(e7, t8) {
  return e7.ranges.length == t8.ranges.length && e7.ranges.filter((r2, n14) => r2.empty != t8.ranges[n14].empty).length === 0;
}
function Ce11(e7, t8) {
  return e7.length ? t8.length ? e7.concat(t8) : e7 : t8;
}
var y15 = [];
var pt10 = 200;
function De13(e7, t8) {
  if (e7.length) {
    let r2 = e7[e7.length - 1], n14 = r2.selectionsAfter.slice(Math.max(0, r2.selectionsAfter.length - pt10));
    return n14.length && n14[n14.length - 1].eq(t8) ? e7 : (n14.push(t8), V19(e7, e7.length - 1, 1e9, r2.setSelAfter(n14)));
  } else return [B12.selection([t8])];
}
function gt8(e7) {
  let t8 = e7[e7.length - 1], r2 = e7.slice();
  return r2[e7.length - 1] = t8.setSelAfter(t8.selectionsAfter.slice(0, t8.selectionsAfter.length - 1)), r2;
}
function K14(e7, t8) {
  if (!e7.length) return e7;
  let r2 = e7.length, n14 = y15;
  for (; r2; ) {
    let l11 = yt8(e7[r2 - 1], t8, n14);
    if (l11.changes && !l11.changes.empty || l11.effects.length) {
      let o = e7.slice(0, r2);
      return o[r2 - 1] = l11, o;
    } else t8 = l11.mapped, r2--, n14 = l11.selectionsAfter;
  }
  return n14.length ? [B12.selection(n14)] : y15;
}
function yt8(e7, t8, r2) {
  let n14 = Ce11(e7.selectionsAfter.length ? e7.selectionsAfter.map((s212) => s212.map(t8)) : y15, r2);
  if (!e7.changes) return B12.selection(n14);
  let l11 = e7.changes.map(t8), o = t8.mapDesc(e7.changes, true), c3 = e7.mapped ? e7.mapped.composeDesc(o) : o;
  return new B12(l11, v5.mapEffects(e7.effects, t8), c3, e7.startSelection.map(o), n14);
}
var kt4 = /^(input\.type|delete)($|\.)/;
var D11 = class e6 {
  constructor(t8, r2, n14 = 0, l11 = void 0) {
    this.done = t8, this.undone = r2, this.prevTime = n14, this.prevUserEvent = l11;
  }
  isolate() {
    return this.prevTime ? new e6(this.done, this.undone) : this;
  }
  addChanges(t8, r2, n14, l11, o) {
    let c3 = this.done, s212 = c3[c3.length - 1];
    return s212 && s212.changes && !s212.changes.empty && t8.changes && (!n14 || kt4.test(n14)) && (!s212.selectionsAfter.length && r2 - this.prevTime < l11.newGroupDelay && l11.joinToEvent(o, dt9(s212.changes, t8.changes)) || n14 == "input.type.compose") ? c3 = V19(c3, c3.length - 1, l11.minDepth, new B12(t8.changes.compose(s212.changes), Ce11(t8.effects, s212.effects), s212.mapped, s212.startSelection, y15)) : c3 = V19(c3, c3.length, l11.minDepth, t8), new e6(c3, y15, r2, n14);
  }
  addSelection(t8, r2, n14, l11) {
    let o = this.done.length ? this.done[this.done.length - 1].selectionsAfter : y15;
    return o.length > 0 && r2 - this.prevTime < l11 && n14 == this.prevUserEvent && n14 && /^select($|\.)/.test(n14) && mt11(o[o.length - 1], t8) ? this : new e6(De13(this.done, t8), this.undone, r2, n14);
  }
  addMapping(t8) {
    return new e6(K14(this.done, t8), K14(this.undone, t8), this.prevTime, this.prevUserEvent);
  }
  pop(t8, r2, n14) {
    let l11 = t8 == 0 ? this.done : this.undone;
    if (l11.length == 0) return null;
    let o = l11[l11.length - 1];
    if (n14 && o.selectionsAfter.length) return r2.update({ selection: o.selectionsAfter[o.selectionsAfter.length - 1], annotations: X17.of({ side: t8, rest: gt8(l11) }), userEvent: t8 == 0 ? "select.undo" : "select.redo", scrollIntoView: true });
    if (o.changes) {
      let c3 = l11.length == 1 ? y15 : l11.slice(0, l11.length - 1);
      return o.mapped && (c3 = K14(c3, o.mapped)), r2.update({ changes: o.changes, selection: o.startSelection, effects: o.effects, annotations: X17.of({ side: t8, rest: c3 }), filter: false, userEvent: t8 == 0 ? "undo" : "redo", scrollIntoView: true });
    } else return null;
  }
};
D11.empty = new D11(y15, y15);
var An6 = [{ key: "Mod-z", run: Be17, preventDefault: true }, { key: "Mod-y", mac: "Mod-Shift-z", run: Y20, preventDefault: true }, { linux: "Ctrl-Shift-z", run: Y20, preventDefault: true }, { key: "Mod-u", run: at11, preventDefault: true }, { key: "Alt-u", mac: "Mod-Shift-u", run: ht11, preventDefault: true }];
function b9(e7, t8) {
  return x7.create(e7.ranges.map(t8), e7.mainIndex);
}
function A16(e7, t8) {
  return e7.update({ selection: t8, scrollIntoView: true, userEvent: "select" });
}
function k13({ state: e7, dispatch: t8 }, r2) {
  let n14 = b9(e7.selection, r2);
  return n14.eq(e7.selection) ? false : (t8(A16(e7, n14)), true);
}
function I17(e7, t8) {
  return x7.cursor(t8 ? e7.to : e7.from);
}
function J12(e7, t8) {
  return k13(e7, (r2) => r2.empty ? e7.moveByChar(r2, t8) : I17(r2, t8));
}
function m8(e7) {
  return e7.textDirectionAt(e7.state.selection.main.head) == B7.LTR;
}
var Le13 = (e7) => J12(e7, !m8(e7));
var xe17 = (e7) => J12(e7, m8(e7));
function F19(e7, t8) {
  return k13(e7, (r2) => r2.empty ? e7.moveByGroup(r2, t8) : I17(r2, t8));
}
var St9 = (e7) => F19(e7, !m8(e7));
var Bt10 = (e7) => F19(e7, m8(e7));
var ce18 = typeof Intl < "u" && Intl.Segmenter ? new Intl.Segmenter(void 0, { granularity: "word" }) : null;
function At9(e7, t8, r2) {
  if (t8.type.prop(r2)) return true;
  let n14 = t8.to - t8.from;
  return n14 && (n14 > 2 || /[^\s,.;:]/.test(e7.sliceDoc(t8.from, t8.to))) || t8.firstChild;
}
function z18(e7, t8, r2) {
  let n14 = k11(e7).resolveInner(t8.head), l11 = r2 ? k12.closedBy : k12.openedBy;
  for (let i12 = t8.head; ; ) {
    let f6 = r2 ? n14.childAfter(i12) : n14.childBefore(i12);
    if (!f6) break;
    At9(e7, f6, l11) ? n14 = f6 : i12 = r2 ? f6.to : f6.from;
  }
  let o = n14.type.prop(l11), c3, s212;
  return o && (c3 = r2 ? U17(e7, n14.from, 1) : U17(e7, n14.to, -1)) && c3.matched ? s212 = r2 ? c3.end.to : c3.end.from : s212 = r2 ? n14.to : n14.from, x7.cursor(s212, r2 ? -1 : 1);
}
var Ct4 = (e7) => k13(e7, (t8) => z18(e7.state, t8, !m8(e7)));
var Dt8 = (e7) => k13(e7, (t8) => z18(e7.state, t8, m8(e7)));
function be17(e7, t8) {
  return k13(e7, (r2) => {
    if (!r2.empty) return I17(r2, t8);
    let n14 = e7.moveVertically(r2, t8);
    return n14.head != r2.head ? n14 : e7.moveToLineBoundary(r2, t8);
  });
}
var Oe12 = (e7) => be17(e7, false);
var Te13 = (e7) => be17(e7, true);
function Ie13(e7) {
  let t8 = e7.scrollDOM.clientHeight < e7.scrollDOM.scrollHeight - 2, r2 = 0, n14 = 0, l11;
  if (t8) {
    for (let o of e7.state.facet(A11.scrollMargins)) {
      let c3 = o(e7);
      c3?.top && (r2 = Math.max(c3?.top, r2)), c3?.bottom && (n14 = Math.max(c3?.bottom, n14));
    }
    l11 = e7.scrollDOM.clientHeight - r2 - n14;
  } else l11 = (e7.dom.ownerDocument.defaultView || window).innerHeight;
  return { marginTop: r2, marginBottom: n14, selfScroll: t8, height: Math.max(e7.defaultLineHeight, l11 - 5) };
}
function ve14(e7, t8) {
  let r2 = Ie13(e7), { state: n14 } = e7, l11 = b9(n14.selection, (c3) => c3.empty ? e7.moveVertically(c3, t8, r2.height) : I17(c3, t8));
  if (l11.eq(n14.selection)) return false;
  let o;
  if (r2.selfScroll) {
    let c3 = e7.coordsAtPos(n14.selection.main.head), s212 = e7.scrollDOM.getBoundingClientRect(), i12 = s212.top + r2.marginTop, f6 = s212.bottom - r2.marginBottom;
    c3 && c3.top > i12 && c3.bottom < f6 && (o = A11.scrollIntoView(l11.main.head, { y: "start", yMargin: c3.top - i12 }));
  }
  return e7.dispatch(A16(n14, l11), { effects: o }), true;
}
var se12 = (e7) => ve14(e7, false);
var Z17 = (e7) => ve14(e7, true);
function C9(e7, t8, r2) {
  let n14 = e7.lineBlockAt(t8.head), l11 = e7.moveToLineBoundary(t8, r2);
  if (l11.head == t8.head && l11.head != (r2 ? n14.to : n14.from) && (l11 = e7.moveToLineBoundary(t8, r2, false)), !r2 && l11.head == n14.from && n14.length) {
    let o = /^\s*/.exec(e7.state.sliceDoc(n14.from, Math.min(n14.from + 100, n14.to)))[0].length;
    o && t8.head != n14.from + o && (l11 = x7.cursor(n14.from + o));
  }
  return l11;
}
var Lt10 = (e7) => k13(e7, (t8) => C9(e7, t8, true));
var xt9 = (e7) => k13(e7, (t8) => C9(e7, t8, false));
var Mt10 = (e7) => k13(e7, (t8) => C9(e7, t8, !m8(e7)));
var Et11 = (e7) => k13(e7, (t8) => C9(e7, t8, m8(e7)));
var bt3 = (e7) => k13(e7, (t8) => x7.cursor(e7.lineBlockAt(t8.head).from, 1));
var Ot5 = (e7) => k13(e7, (t8) => x7.cursor(e7.lineBlockAt(t8.head).to, -1));
function Re13(e7, t8, r2) {
  let n14 = false, l11 = b9(e7.selection, (o) => {
    let c3 = U17(e7, o.head, -1) || U17(e7, o.head, 1) || o.head > 0 && U17(e7, o.head - 1, 1) || o.head < e7.doc.length && U17(e7, o.head + 1, -1);
    if (!c3 || !c3.end) return o;
    n14 = true;
    let s212 = c3.start.from == o.head ? c3.end.to : c3.end.from;
    return r2 ? x7.range(o.anchor, s212) : x7.cursor(s212);
  });
  return n14 ? (t8(A16(e7, l11)), true) : false;
}
var Tt4 = ({ state: e7, dispatch: t8 }) => Re13(e7, t8, false);
function g5(e7, t8) {
  let r2 = b9(e7.state.selection, (n14) => {
    let l11 = t8(n14);
    return x7.range(n14.anchor, l11.head, l11.goalColumn, l11.bidiLevel || void 0);
  });
  return r2.eq(e7.state.selection) ? false : (e7.dispatch(A16(e7.state, r2)), true);
}
function H9(e7, t8) {
  return g5(e7, (r2) => e7.moveByChar(r2, t8));
}
var Ue13 = (e7) => H9(e7, !m8(e7));
var Ne19 = (e7) => H9(e7, m8(e7));
function W13(e7, t8) {
  return g5(e7, (r2) => e7.moveByGroup(r2, t8));
}
var It9 = (e7) => W13(e7, !m8(e7));
var vt7 = (e7) => W13(e7, m8(e7));
var Rt9 = (e7) => g5(e7, (t8) => z18(e7.state, t8, !m8(e7)));
var Ut10 = (e7) => g5(e7, (t8) => z18(e7.state, t8, m8(e7)));
function Ge11(e7, t8) {
  return g5(e7, (r2) => e7.moveVertically(r2, t8));
}
var we17 = (e7) => Ge11(e7, false);
var Pe16 = (e7) => Ge11(e7, true);
function Je9(e7, t8) {
  return g5(e7, (r2) => e7.moveVertically(r2, t8, Ie13(e7).height));
}
var ie9 = (e7) => Je9(e7, false);
var ue16 = (e7) => Je9(e7, true);
var Nt6 = (e7) => g5(e7, (t8) => C9(e7, t8, true));
var Vt11 = (e7) => g5(e7, (t8) => C9(e7, t8, false));
var Gt7 = (e7) => g5(e7, (t8) => C9(e7, t8, !m8(e7)));
var wt7 = (e7) => g5(e7, (t8) => C9(e7, t8, m8(e7)));
var Pt8 = (e7) => g5(e7, (t8) => x7.cursor(e7.lineBlockAt(t8.head).from));
var Jt9 = (e7) => g5(e7, (t8) => x7.cursor(e7.lineBlockAt(t8.head).to));
var fe17 = ({ state: e7, dispatch: t8 }) => (t8(A16(e7, { anchor: 0 })), true);
var ae13 = ({ state: e7, dispatch: t8 }) => (t8(A16(e7, { anchor: e7.doc.length })), true);
var he16 = ({ state: e7, dispatch: t8 }) => (t8(A16(e7, { anchor: e7.selection.main.anchor, head: 0 })), true);
var de14 = ({ state: e7, dispatch: t8 }) => (t8(A16(e7, { anchor: e7.selection.main.anchor, head: e7.doc.length })), true);
var Ft11 = ({ state: e7, dispatch: t8 }) => (t8(e7.update({ selection: { anchor: 0, head: e7.doc.length }, userEvent: "select" })), true);
var zt9 = ({ state: e7, dispatch: t8 }) => {
  let r2 = q14(e7).map(({ from: n14, to: l11 }) => x7.range(n14, Math.min(l11 + 1, e7.doc.length)));
  return t8(e7.update({ selection: x7.create(r2), userEvent: "select" })), true;
};
var Ht10 = ({ state: e7, dispatch: t8 }) => {
  let r2 = b9(e7.selection, (n14) => {
    var l11;
    let o = k11(e7).resolveStack(n14.from, 1);
    for (let c3 = o; c3; c3 = c3.next) {
      let { node: s212 } = c3;
      if ((s212.from < n14.from && s212.to >= n14.to || s212.to > n14.to && s212.from <= n14.from) && (!((l11 = s212.parent) === null || l11 === void 0) && l11.parent)) return x7.range(s212.to, s212.from);
    }
    return n14;
  });
  return t8(A16(e7, r2)), true;
};
var Wt11 = ({ state: e7, dispatch: t8 }) => {
  let r2 = e7.selection, n14 = null;
  return r2.ranges.length > 1 ? n14 = x7.create([r2.main]) : r2.main.empty || (n14 = x7.create([x7.cursor(r2.main.head)])), n14 ? (t8(A16(e7, n14)), true) : false;
};
function O16(e7, t8) {
  if (e7.state.readOnly) return false;
  let r2 = "delete.selection", { state: n14 } = e7, l11 = n14.changeByRange((o) => {
    let { from: c3, to: s212 } = o;
    if (c3 == s212) {
      let i12 = t8(o);
      i12 < c3 ? (r2 = "delete.backward", i12 = R15(e7, i12, false)) : i12 > c3 && (r2 = "delete.forward", i12 = R15(e7, i12, true)), c3 = Math.min(c3, i12), s212 = Math.max(s212, i12);
    } else c3 = R15(e7, c3, false), s212 = R15(e7, s212, true);
    return c3 == s212 ? { range: o } : { changes: { from: c3, to: s212 }, range: x7.cursor(c3, c3 < o.head ? -1 : 1) };
  });
  return l11.changes.empty ? false : (e7.dispatch(n14.update(l11, { scrollIntoView: true, userEvent: r2, effects: r2 == "delete.selection" ? A11.announce.of(n14.phrase("Selection deleted")) : void 0 })), true);
}
function R15(e7, t8, r2) {
  if (e7 instanceof A11) for (let n14 of e7.state.facet(A11.atomicRanges).map((l11) => l11(e7))) n14.between(t8, t8, (l11, o) => {
    l11 < t8 && o > t8 && (t8 = r2 ? o : l11);
  });
  return t8;
}
var Fe15 = (e7, t8) => O16(e7, (r2) => {
  let n14 = r2.from, { state: l11 } = e7, o = l11.doc.lineAt(n14), c3, s212;
  if (!t8 && n14 > o.from && n14 < o.from + 200 && !/[^ \t]/.test(c3 = o.text.slice(0, n14 - o.from))) {
    if (c3[c3.length - 1] == "	") return n14 - 1;
    let i12 = ot8(c3, l11.tabSize), f6 = i12 % V17(l11) || V17(l11);
    for (let u3 = 0; u3 < f6 && c3[c3.length - 1 - u3] == " "; u3++) n14--;
    s212 = n14;
  } else s212 = _11(o.text, n14 - o.from, t8, t8) + o.from, s212 == n14 && o.number != (t8 ? l11.doc.lines : 1) && (s212 += t8 ? 1 : -1);
  return s212;
});
var j17 = (e7) => Fe15(e7, false);
var ze14 = (e7) => Fe15(e7, true);
var He11 = (e7, t8) => O16(e7, (r2) => {
  let n14 = r2.head, { state: l11 } = e7, o = l11.doc.lineAt(n14), c3 = l11.charCategorizer(n14);
  for (let s212 = null; ; ) {
    if (n14 == (t8 ? o.to : o.from)) {
      n14 == r2.head && o.number != (t8 ? l11.doc.lines : 1) && (n14 += t8 ? 1 : -1);
      break;
    }
    let i12 = _11(o.text, n14 - o.from, t8) + o.from, f6 = o.text.slice(Math.min(n14, i12) - o.from, Math.max(n14, i12) - o.from), u3 = c3(f6);
    if (s212 != null && u3 != s212) break;
    (f6 != " " || n14 != r2.head) && (s212 = u3), n14 = i12;
  }
  return n14;
});
var We13 = (e7) => He11(e7, false);
var qt9 = (e7) => He11(e7, true);
var $t10 = (e7) => O16(e7, (t8) => {
  let r2 = e7.lineBlockAt(t8.head).to;
  return t8.head < r2 ? r2 : Math.min(e7.state.doc.length, t8.head + 1);
});
var Kt9 = (e7) => O16(e7, (t8) => {
  let r2 = e7.moveToLineBoundary(t8, false).head;
  return t8.head > r2 ? r2 : Math.max(0, t8.head - 1);
});
var _t10 = (e7) => O16(e7, (t8) => {
  let r2 = e7.moveToLineBoundary(t8, true).head;
  return t8.head < r2 ? r2 : Math.min(e7.state.doc.length, t8.head + 1);
});
var Qt7 = ({ state: e7, dispatch: t8 }) => {
  if (e7.readOnly) return false;
  let r2 = e7.changeByRange((n14) => ({ changes: { from: n14.from, to: n14.to, insert: m5.of(["", ""]) }, range: x7.cursor(n14.from) }));
  return t8(e7.update(r2, { scrollIntoView: true, userEvent: "input" })), true;
};
var Xt6 = ({ state: e7, dispatch: t8 }) => {
  if (e7.readOnly) return false;
  let r2 = e7.changeByRange((n14) => {
    if (!n14.empty || n14.from == 0 || n14.from == e7.doc.length) return { range: n14 };
    let l11 = n14.from, o = e7.doc.lineAt(l11), c3 = l11 == o.from ? l11 - 1 : _11(o.text, l11 - o.from, false) + o.from, s212 = l11 == o.to ? l11 + 1 : _11(o.text, l11 - o.from, true) + o.from;
    return { changes: { from: c3, to: s212, insert: e7.doc.slice(l11, s212).append(e7.doc.slice(c3, l11)) }, range: x7.cursor(s212) };
  });
  return r2.changes.empty ? false : (t8(e7.update(r2, { scrollIntoView: true, userEvent: "move.character" })), true);
};
function q14(e7) {
  let t8 = [], r2 = -1;
  for (let n14 of e7.selection.ranges) {
    let l11 = e7.doc.lineAt(n14.from), o = e7.doc.lineAt(n14.to);
    if (!n14.empty && n14.to == o.from && (o = e7.doc.lineAt(n14.to - 1)), r2 >= l11.number) {
      let c3 = t8[t8.length - 1];
      c3.to = o.to, c3.ranges.push(n14);
    } else t8.push({ from: l11.from, to: o.to, ranges: [n14] });
    r2 = o.number + 1;
  }
  return t8;
}
function qe13(e7, t8, r2) {
  if (e7.readOnly) return false;
  let n14 = [], l11 = [];
  for (let o of q14(e7)) {
    if (r2 ? o.to == e7.doc.length : o.from == 0) continue;
    let c3 = e7.doc.lineAt(r2 ? o.to + 1 : o.from - 1), s212 = c3.length + 1;
    if (r2) {
      n14.push({ from: o.to, to: c3.to }, { from: o.from, insert: c3.text + e7.lineBreak });
      for (let i12 of o.ranges) l11.push(x7.range(Math.min(e7.doc.length, i12.anchor + s212), Math.min(e7.doc.length, i12.head + s212)));
    } else {
      n14.push({ from: c3.from, to: o.from }, { from: o.to, insert: e7.lineBreak + c3.text });
      for (let i12 of o.ranges) l11.push(x7.range(i12.anchor - s212, i12.head - s212));
    }
  }
  return n14.length ? (t8(e7.update({ changes: n14, scrollIntoView: true, selection: x7.create(l11, e7.selection.mainIndex), userEvent: "move.line" })), true) : false;
}
var Yt8 = ({ state: e7, dispatch: t8 }) => qe13(e7, t8, false);
var Zt8 = ({ state: e7, dispatch: t8 }) => qe13(e7, t8, true);
function $e15(e7, t8, r2) {
  if (e7.readOnly) return false;
  let n14 = [];
  for (let l11 of q14(e7)) r2 ? n14.push({ from: l11.from, insert: e7.doc.slice(l11.from, l11.to) + e7.lineBreak }) : n14.push({ from: l11.to, insert: e7.lineBreak + e7.doc.slice(l11.from, l11.to) });
  return t8(e7.update({ changes: n14, scrollIntoView: true, userEvent: "input.copyline" })), true;
}
var jt9 = ({ state: e7, dispatch: t8 }) => $e15(e7, t8, false);
var en7 = ({ state: e7, dispatch: t8 }) => $e15(e7, t8, true);
var tn8 = (e7) => {
  if (e7.state.readOnly) return false;
  let { state: t8 } = e7, r2 = t8.changes(q14(t8).map(({ from: l11, to: o }) => (l11 > 0 ? l11-- : o < t8.doc.length && o++, { from: l11, to: o }))), n14 = b9(t8.selection, (l11) => e7.moveVertically(l11, true)).map(r2);
  return e7.dispatch({ changes: r2, selection: n14, scrollIntoView: true, userEvent: "delete.line" }), true;
};
function nn7(e7, t8) {
  if (/\(\)|\[\]|\{\}/.test(e7.sliceDoc(t8 - 1, t8 + 1))) return { from: t8, to: t8 };
  let r2 = k11(e7).resolveInner(t8), n14 = r2.childBefore(t8), l11 = r2.childAfter(t8), o;
  return n14 && l11 && n14.to <= t8 && l11.from >= t8 && (o = n14.type.prop(k12.closedBy)) && o.indexOf(l11.name) > -1 && e7.doc.lineAt(n14.to).from == e7.doc.lineAt(l11.from).from && !/\S/.test(e7.sliceDoc(n14.to, l11.from)) ? { from: n14.to, to: l11.from } : null;
}
var rn7 = Ke12(false);
var on7 = Ke12(true);
function Ke12(e7) {
  return ({ state: t8, dispatch: r2 }) => {
    if (t8.readOnly) return false;
    let n14 = t8.changeByRange((l11) => {
      let { from: o, to: c3 } = l11, s212 = t8.doc.lineAt(o), i12 = !e7 && o == c3 && nn7(t8, o);
      e7 && (o = c3 = (c3 <= s212.to ? s212 : t8.doc.lineAt(c3)).to);
      let f6 = new M9(t8, { simulateBreak: o, simulateDoubleBreak: !!i12 }), u3 = Lt9(f6, o);
      for (u3 == null && (u3 = ot8(/^\s*/.exec(t8.doc.lineAt(o).text)[0], t8.tabSize)); c3 < s212.to && /\s/.test(s212.text[c3 - s212.from]); ) c3++;
      i12 ? { from: o, to: c3 } = i12 : o > s212.from && o < s212.from + 100 && !/\S/.test(s212.text.slice(0, o)) && (o = s212.from);
      let a2 = ["", Ft10(t8, u3)];
      return i12 && a2.push(Ft10(t8, f6.lineIndent(s212.from, -1))), { changes: { from: o, to: c3, insert: m5.of(a2) }, range: x7.cursor(o + 1 + a2[1].length) };
    });
    return r2(t8.update(n14, { scrollIntoView: true, userEvent: "input" })), true;
  };
}
function oe11(e7, t8) {
  let r2 = -1;
  return e7.changeByRange((n14) => {
    let l11 = [];
    for (let c3 = n14.from; c3 <= n14.to; ) {
      let s212 = e7.doc.lineAt(c3);
      s212.number > r2 && (n14.empty || n14.to > s212.from) && (t8(s212, l11, n14), r2 = s212.number), c3 = s212.to + 1;
    }
    let o = e7.changes(l11);
    return { changes: l11, range: x7.range(o.mapPos(n14.anchor, 1), o.mapPos(n14.head, 1)) };
  });
}
var ln7 = ({ state: e7, dispatch: t8 }) => {
  if (e7.readOnly) return false;
  let r2 = /* @__PURE__ */ Object.create(null), n14 = new M9(e7, { overrideIndentation: (o) => {
    let c3 = r2[o];
    return c3 ?? -1;
  } }), l11 = oe11(e7, (o, c3, s212) => {
    let i12 = Lt9(n14, o.from);
    if (i12 == null) return;
    /\S/.test(o.text) || (i12 = 0);
    let f6 = /^\s*/.exec(o.text)[0], u3 = Ft10(e7, i12);
    (f6 != u3 || s212.from < o.from + f6.length) && (r2[o.from] = i12, c3.push({ from: o.from, to: o.from + f6.length, insert: u3 }));
  });
  return l11.changes.empty || t8(e7.update(l11, { userEvent: "indent" })), true;
};
var le15 = ({ state: e7, dispatch: t8 }) => e7.readOnly ? false : (t8(e7.update(oe11(e7, (r2, n14) => {
  n14.push({ from: r2.from, insert: e7.facet(Et10) });
}), { userEvent: "input.indent" })), true);
var _e10 = ({ state: e7, dispatch: t8 }) => e7.readOnly ? false : (t8(e7.update(oe11(e7, (r2, n14) => {
  let l11 = /^\s*/.exec(r2.text)[0];
  if (!l11) return;
  let o = ot8(l11, e7.tabSize), c3 = 0, s212 = Ft10(e7, Math.max(0, o - V17(e7)));
  for (; c3 < l11.length && c3 < s212.length && l11.charCodeAt(c3) == s212.charCodeAt(c3); ) c3++;
  n14.push({ from: r2.from + c3, to: r2.from + l11.length, insert: s212.slice(c3) });
}), { userEvent: "delete.dedent" })), true);
var cn7 = [{ key: "Ctrl-b", run: Le13, shift: Ue13, preventDefault: true }, { key: "Ctrl-f", run: xe17, shift: Ne19 }, { key: "Ctrl-p", run: Oe12, shift: we17 }, { key: "Ctrl-n", run: Te13, shift: Pe16 }, { key: "Ctrl-a", run: bt3, shift: Pt8 }, { key: "Ctrl-e", run: Ot5, shift: Jt9 }, { key: "Ctrl-d", run: ze14 }, { key: "Ctrl-h", run: j17 }, { key: "Ctrl-k", run: $t10 }, { key: "Ctrl-Alt-h", run: We13 }, { key: "Ctrl-o", run: Qt7 }, { key: "Ctrl-t", run: Xt6 }, { key: "Ctrl-v", run: Z17 }];
var sn8 = [{ key: "ArrowLeft", run: Le13, shift: Ue13, preventDefault: true }, { key: "Mod-ArrowLeft", mac: "Alt-ArrowLeft", run: St9, shift: It9, preventDefault: true }, { mac: "Cmd-ArrowLeft", run: Mt10, shift: Gt7, preventDefault: true }, { key: "ArrowRight", run: xe17, shift: Ne19, preventDefault: true }, { key: "Mod-ArrowRight", mac: "Alt-ArrowRight", run: Bt10, shift: vt7, preventDefault: true }, { mac: "Cmd-ArrowRight", run: Et11, shift: wt7, preventDefault: true }, { key: "ArrowUp", run: Oe12, shift: we17, preventDefault: true }, { mac: "Cmd-ArrowUp", run: fe17, shift: he16 }, { mac: "Ctrl-ArrowUp", run: se12, shift: ie9 }, { key: "ArrowDown", run: Te13, shift: Pe16, preventDefault: true }, { mac: "Cmd-ArrowDown", run: ae13, shift: de14 }, { mac: "Ctrl-ArrowDown", run: Z17, shift: ue16 }, { key: "PageUp", run: se12, shift: ie9 }, { key: "PageDown", run: Z17, shift: ue16 }, { key: "Home", run: xt9, shift: Vt11, preventDefault: true }, { key: "Mod-Home", run: fe17, shift: he16 }, { key: "End", run: Lt10, shift: Nt6, preventDefault: true }, { key: "Mod-End", run: ae13, shift: de14 }, { key: "Enter", run: rn7 }, { key: "Mod-a", run: Ft11 }, { key: "Backspace", run: j17, shift: j17 }, { key: "Delete", run: ze14 }, { key: "Mod-Backspace", mac: "Alt-Backspace", run: We13 }, { key: "Mod-Delete", mac: "Alt-Delete", run: qt9 }, { mac: "Mod-Backspace", run: Kt9 }, { mac: "Mod-Delete", run: _t10 }].concat(cn7.map((e7) => ({ mac: e7.key, run: e7.run, shift: e7.shift })));
var Pn5 = [{ key: "Alt-ArrowLeft", mac: "Ctrl-ArrowLeft", run: Ct4, shift: Rt9 }, { key: "Alt-ArrowRight", mac: "Ctrl-ArrowRight", run: Dt8, shift: Ut10 }, { key: "Alt-ArrowUp", run: Yt8 }, { key: "Shift-Alt-ArrowUp", run: jt9 }, { key: "Alt-ArrowDown", run: Zt8 }, { key: "Shift-Alt-ArrowDown", run: en7 }, { key: "Escape", run: Wt11 }, { key: "Mod-Enter", run: on7 }, { key: "Alt-l", mac: "Ctrl-l", run: zt9 }, { key: "Mod-i", run: Ht10, preventDefault: true }, { key: "Mod-[", run: _e10 }, { key: "Mod-]", run: le15 }, { key: "Mod-Alt-\\", run: ln7 }, { key: "Shift-Mod-k", run: tn8 }, { key: "Shift-Mod-\\", run: Tt4 }, { key: "Mod-/", run: nt13 }, { key: "Alt-A", run: ot10 }].concat(sn8);

// https://esm.sh/v135/@codemirror/search@6.5.4/denonext/search.mjs
var re13 = typeof String.prototype.normalize == "function" ? (t8) => t8.normalize("NFKD") : (t8) => t8;
var S16 = class {
  constructor(e7, n14, r2 = 0, i12 = e7.length, s212, l11) {
    this.test = l11, this.value = { from: 0, to: 0 }, this.done = false, this.matches = [], this.buffer = "", this.bufferPos = 0, this.iter = e7.iterRange(r2, i12), this.bufferStart = r2, this.normalize = s212 ? (o) => s212(re13(o)) : re13, this.query = this.normalize(n14);
  }
  peek() {
    if (this.bufferPos == this.buffer.length) {
      if (this.bufferStart += this.buffer.length, this.iter.next(), this.iter.done) return -1;
      this.bufferPos = 0, this.buffer = this.iter.value;
    }
    return he10(this.buffer, this.bufferPos);
  }
  next() {
    for (; this.matches.length; ) this.matches.pop();
    return this.nextOverlapping();
  }
  nextOverlapping() {
    for (; ; ) {
      let e7 = this.peek();
      if (e7 < 0) return this.done = true, this;
      let n14 = rt8(e7), r2 = this.bufferStart + this.bufferPos;
      this.bufferPos += be11(e7);
      let i12 = this.normalize(n14);
      for (let s212 = 0, l11 = r2; ; s212++) {
        let o = i12.charCodeAt(s212), c3 = this.match(o, l11);
        if (s212 == i12.length - 1) {
          if (c3) return this.value = c3, this;
          break;
        }
        l11 == r2 && s212 < n14.length && n14.charCodeAt(s212) == o && l11++;
      }
    }
  }
  match(e7, n14) {
    let r2 = null;
    for (let i12 = 0; i12 < this.matches.length; i12 += 2) {
      let s212 = this.matches[i12], l11 = false;
      this.query.charCodeAt(s212) == e7 && (s212 == this.query.length - 1 ? r2 = { from: this.matches[i12 + 1], to: n14 + 1 } : (this.matches[i12]++, l11 = true)), l11 || (this.matches.splice(i12, 2), i12 -= 2);
    }
    return this.query.charCodeAt(0) == e7 && (this.query.length == 1 ? r2 = { from: n14, to: n14 + 1 } : this.matches.push(1, n14)), r2 && this.test && !this.test(r2.from, r2.to, this.buffer, this.bufferStart) && (r2 = null), r2;
  }
};
typeof Symbol < "u" && (S16.prototype[Symbol.iterator] = function() {
  return this;
});
var de15 = { from: -1, to: -1, match: /.*/.exec("") };
var X18 = "gm" + (/x/.unicode == null ? "" : "u");
var P21 = class {
  constructor(e7, n14, r2, i12 = 0, s212 = e7.length) {
    if (this.text = e7, this.to = s212, this.curLine = "", this.done = false, this.value = de15, /\\[sWDnr]|\n|\r|\[\^/.test(n14)) return new I18(e7, n14, r2, i12, s212);
    this.re = new RegExp(n14, X18 + (r2?.ignoreCase ? "i" : "")), this.test = r2?.test, this.iter = e7.iter();
    let l11 = e7.lineAt(i12);
    this.curLineStart = l11.from, this.matchPos = w13(e7, i12), this.getLine(this.curLineStart);
  }
  getLine(e7) {
    this.iter.next(e7), this.iter.lineBreak ? this.curLine = "" : (this.curLine = this.iter.value, this.curLineStart + this.curLine.length > this.to && (this.curLine = this.curLine.slice(0, this.to - this.curLineStart)), this.iter.next());
  }
  nextLine() {
    this.curLineStart = this.curLineStart + this.curLine.length + 1, this.curLineStart > this.to ? this.curLine = "" : this.getLine(0);
  }
  next() {
    for (let e7 = this.matchPos - this.curLineStart; ; ) {
      this.re.lastIndex = e7;
      let n14 = this.matchPos <= this.to && this.re.exec(this.curLine);
      if (n14) {
        let r2 = this.curLineStart + n14.index, i12 = r2 + n14[0].length;
        if (this.matchPos = w13(this.text, i12 + (r2 == i12 ? 1 : 0)), r2 == this.curLineStart + this.curLine.length && this.nextLine(), (r2 < i12 || r2 > this.value.to) && (!this.test || this.test(r2, i12, n14))) return this.value = { from: r2, to: i12, match: n14 }, this;
        e7 = this.matchPos - this.curLineStart;
      } else if (this.curLineStart + this.curLine.length < this.to) this.nextLine(), e7 = 0;
      else return this.done = true, this;
    }
  }
};
var K15 = /* @__PURE__ */ new WeakMap();
var R16 = class t5 {
  constructor(e7, n14) {
    this.from = e7, this.text = n14;
  }
  get to() {
    return this.from + this.text.length;
  }
  static get(e7, n14, r2) {
    let i12 = K15.get(e7);
    if (!i12 || i12.from >= r2 || i12.to <= n14) {
      let o = new t5(n14, e7.sliceString(n14, r2));
      return K15.set(e7, o), o;
    }
    if (i12.from == n14 && i12.to == r2) return i12;
    let { text: s212, from: l11 } = i12;
    return l11 > n14 && (s212 = e7.sliceString(n14, l11) + s212, l11 = n14), i12.to < r2 && (s212 += e7.sliceString(i12.to, r2)), K15.set(e7, new t5(l11, s212)), new t5(n14, s212.slice(n14 - l11, r2 - l11));
  }
};
var I18 = class {
  constructor(e7, n14, r2, i12, s212) {
    this.text = e7, this.to = s212, this.done = false, this.value = de15, this.matchPos = w13(e7, i12), this.re = new RegExp(n14, X18 + (r2?.ignoreCase ? "i" : "")), this.test = r2?.test, this.flat = R16.get(e7, i12, this.chunkEnd(i12 + 5e3));
  }
  chunkEnd(e7) {
    return e7 >= this.to ? this.to : this.text.lineAt(e7).to;
  }
  next() {
    for (; ; ) {
      let e7 = this.re.lastIndex = this.matchPos - this.flat.from, n14 = this.re.exec(this.flat.text);
      if (n14 && !n14[0] && n14.index == e7 && (this.re.lastIndex = e7 + 1, n14 = this.re.exec(this.flat.text)), n14) {
        let r2 = this.flat.from + n14.index, i12 = r2 + n14[0].length;
        if ((this.flat.to >= this.to || n14.index + n14[0].length <= this.flat.text.length - 10) && (!this.test || this.test(r2, i12, n14))) return this.value = { from: r2, to: i12, match: n14 }, this.matchPos = w13(this.text, i12 + (r2 == i12 ? 1 : 0)), this;
      }
      if (this.flat.to == this.to) return this.done = true, this;
      this.flat = R16.get(this.text, this.flat.from, this.chunkEnd(this.flat.from + this.flat.text.length * 2));
    }
  }
};
typeof Symbol < "u" && (P21.prototype[Symbol.iterator] = I18.prototype[Symbol.iterator] = function() {
  return this;
});
function We14(t8) {
  try {
    return new RegExp(t8, X18), true;
  } catch {
    return false;
  }
}
function w13(t8, e7) {
  if (e7 >= t8.length) return e7;
  let n14 = t8.lineAt(e7), r2;
  for (; e7 < n14.to && (r2 = n14.text.charCodeAt(e7 - n14.from)) >= 56320 && r2 < 57344; ) e7++;
  return e7;
}
function G17(t8) {
  let e7 = String(t8.state.doc.lineAt(t8.state.selection.main.head).number), n14 = s114("input", { class: "cm-textfield", name: "line", value: e7 }), r2 = s114("form", { class: "cm-gotoLine", onkeydown: (s212) => {
    s212.keyCode == 27 ? (s212.preventDefault(), t8.dispatch({ effects: T19.of(false) }), t8.focus()) : s212.keyCode == 13 && (s212.preventDefault(), i12());
  }, onsubmit: (s212) => {
    s212.preventDefault(), i12();
  } }, s114("label", t8.state.phrase("Go to line"), ": ", n14), " ", s114("button", { class: "cm-button", type: "submit" }, t8.state.phrase("go")));
  function i12() {
    let s212 = /^([+-])?(\d+)?(:\d+)?(%)?$/.exec(n14.value);
    if (!s212) return;
    let { state: l11 } = t8, o = l11.doc.lineAt(l11.selection.main.head), [, c3, a2, u3, x11] = s212, A18 = u3 ? +u3.slice(1) : 0, C11 = a2 ? +a2 : o.number;
    if (a2 && x11) {
      let H12 = C11 / 100;
      c3 && (H12 = H12 * (c3 == "-" ? -1 : 1) + o.number / l11.doc.lines), C11 = Math.round(l11.doc.lines * H12);
    } else a2 && c3 && (C11 = C11 * (c3 == "-" ? -1 : 1) + o.number);
    let te14 = l11.doc.line(Math.max(1, Math.min(l11.doc.lines, C11))), ne15 = x7.cursor(te14.from + Math.max(0, Math.min(A18, te14.length)));
    t8.dispatch({ effects: [T19.of(false), A11.scrollIntoView(ne15.from, { y: "center" })], selection: ne15 }), t8.focus();
  }
  return { dom: r2 };
}
var T19 = v5.define();
var ie10 = $9.define({ create() {
  return true;
}, update(t8, e7) {
  for (let n14 of e7.effects) n14.is(T19) && (t8 = n14.value);
  return t8;
}, provide: (t8) => bs5.from(t8, (e7) => e7 ? G17 : null) });
var Fe16 = (t8) => {
  let e7 = rl(t8, G17);
  if (!e7) {
    let n14 = [T19.of(true)];
    t8.state.field(ie10, false) == null && n14.push(v5.appendConfig.of([ie10, Ae11])), t8.dispatch({ effects: n14 }), e7 = rl(t8, G17);
  }
  return e7 && e7.dom.querySelector("input").select(), true;
};
var Ae11 = A11.baseTheme({ ".cm-panel.cm-gotoLine": { padding: "2px 6px 4px", "& label": { fontSize: "80%" } } });
var De14 = { highlightWordAroundCursor: false, minSelectionLength: 1, maxMatches: 100, wholeWords: false };
var me16 = y11.define({ combine(t8) {
  return ht8(t8, De14, { highlightWordAroundCursor: (e7, n14) => e7 || n14, minSelectionLength: Math.min, maxMatches: Math.min });
} });
function Ue14(t8) {
  let e7 = [Ie14, Re14];
  return t8 && e7.push(me16.of(t8)), e7;
}
var qe14 = R11.mark({ class: "cm-selectionMatch" });
var Ee17 = R11.mark({ class: "cm-selectionMatch cm-selectionMatch-main" });
function se13(t8, e7, n14, r2) {
  return (n14 == 0 || t8(e7.sliceDoc(n14 - 1, n14)) != O11.Word) && (r2 == e7.doc.length || t8(e7.sliceDoc(r2, r2 + 1)) != O11.Word);
}
function Pe17(t8, e7, n14, r2) {
  return t8(e7.sliceDoc(n14, n14 + 1)) == O11.Word && t8(e7.sliceDoc(r2 - 1, r2)) == O11.Word;
}
var Re14 = H5.fromClass(class {
  constructor(t8) {
    this.decorations = this.getDeco(t8);
  }
  update(t8) {
    (t8.selectionSet || t8.docChanged || t8.viewportChanged) && (this.decorations = this.getDeco(t8.view));
  }
  getDeco(t8) {
    let e7 = t8.state.facet(me16), { state: n14 } = t8, r2 = n14.selection;
    if (r2.ranges.length > 1) return R11.none;
    let i12 = r2.main, s212, l11 = null;
    if (i12.empty) {
      if (!e7.highlightWordAroundCursor) return R11.none;
      let c3 = n14.wordAt(i12.head);
      if (!c3) return R11.none;
      l11 = n14.charCategorizer(i12.head), s212 = n14.sliceDoc(c3.from, c3.to);
    } else {
      let c3 = i12.to - i12.from;
      if (c3 < e7.minSelectionLength || c3 > 200) return R11.none;
      if (e7.wholeWords) {
        if (s212 = n14.sliceDoc(i12.from, i12.to), l11 = n14.charCategorizer(i12.head), !(se13(l11, n14, i12.from, i12.to) && Pe17(l11, n14, i12.from, i12.to))) return R11.none;
      } else if (s212 = n14.sliceDoc(i12.from, i12.to).trim(), !s212) return R11.none;
    }
    let o = [];
    for (let c3 of t8.visibleRanges) {
      let a2 = new S16(n14.doc, s212, c3.from, c3.to);
      for (; !a2.next().done; ) {
        let { from: u3, to: x11 } = a2.value;
        if ((!l11 || se13(l11, n14, u3, x11)) && (i12.empty && u3 <= i12.from && x11 >= i12.to ? o.push(Ee17.range(u3, x11)) : (u3 >= i12.to || x11 <= i12.from) && o.push(qe14.range(u3, x11)), o.length > e7.maxMatches)) return R11.none;
      }
    }
    return R11.set(o);
  }
}, { decorations: (t8) => t8.decorations });
var Ie14 = A11.baseTheme({ ".cm-selectionMatch": { backgroundColor: "#99ff7780" }, ".cm-searchMatch .cm-selectionMatch": { backgroundColor: "transparent" } });
var we18 = ({ state: t8, dispatch: e7 }) => {
  let { selection: n14 } = t8, r2 = x7.create(n14.ranges.map((i12) => t8.wordAt(i12.head) || x7.cursor(i12.head)), n14.mainIndex);
  return r2.eq(n14) ? false : (e7(t8.update({ selection: r2 })), true);
};
function Te14(t8, e7) {
  let { main: n14, ranges: r2 } = t8.selection, i12 = t8.wordAt(n14.head), s212 = i12 && i12.from == n14.from && i12.to == n14.to;
  for (let l11 = false, o = new S16(t8.doc, e7, r2[r2.length - 1].to); ; ) if (o.next(), o.done) {
    if (l11) return null;
    o = new S16(t8.doc, e7, 0, Math.max(0, r2[r2.length - 1].from - 1)), l11 = true;
  } else {
    if (l11 && r2.some((c3) => c3.from == o.value.from)) continue;
    if (s212) {
      let c3 = t8.wordAt(o.value.from);
      if (!c3 || c3.from != o.value.from || c3.to != o.value.to) continue;
    }
    return o.value;
  }
}
var Oe13 = ({ state: t8, dispatch: e7 }) => {
  let { ranges: n14 } = t8.selection;
  if (n14.some((s212) => s212.from === s212.to)) return we18({ state: t8, dispatch: e7 });
  let r2 = t8.sliceDoc(n14[0].from, n14[0].to);
  if (t8.selection.ranges.some((s212) => t8.sliceDoc(s212.from, s212.to) != r2)) return false;
  let i12 = Te14(t8, r2);
  return i12 ? (e7(t8.update({ selection: t8.selection.addRange(x7.range(i12.from, i12.to), false), effects: A11.scrollIntoView(i12.to) })), true) : false;
};
var y16 = y11.define({ combine(t8) {
  return ht8(t8, { top: false, caseSensitive: false, literal: false, regexp: false, wholeWord: false, createPanel: (e7) => new J13(e7), scrollToMatch: (e7) => A11.scrollIntoView(e7) });
} });
var O17 = class {
  constructor(e7) {
    this.search = e7.search, this.caseSensitive = !!e7.caseSensitive, this.literal = !!e7.literal, this.regexp = !!e7.regexp, this.replace = e7.replace || "", this.valid = !!this.search && (!this.regexp || We14(this.search)), this.unquoted = this.unquote(this.search), this.wholeWord = !!e7.wholeWord;
  }
  unquote(e7) {
    return this.literal ? e7 : e7.replace(/\\([nrt\\])/g, (n14, r2) => r2 == "n" ? `
` : r2 == "r" ? "\r" : r2 == "t" ? "	" : "\\");
  }
  eq(e7) {
    return this.search == e7.search && this.replace == e7.replace && this.caseSensitive == e7.caseSensitive && this.regexp == e7.regexp && this.wholeWord == e7.wholeWord;
  }
  create() {
    return this.regexp ? new j18(this) : new Q18(this);
  }
  getCursor(e7, n14 = 0, r2) {
    let i12 = e7.doc ? e7 : I11.create({ doc: e7 });
    return r2 == null && (r2 = i12.doc.length), this.regexp ? b10(this, i12, n14, r2) : v8(this, i12, n14, r2);
  }
};
var $15 = class {
  constructor(e7) {
    this.spec = e7;
  }
};
function v8(t8, e7, n14, r2) {
  return new S16(e7.doc, t8.unquoted, n14, r2, t8.caseSensitive ? void 0 : (i12) => i12.toLowerCase(), t8.wholeWord ? $e16(e7.doc, e7.charCategorizer(e7.selection.main.head)) : void 0);
}
function $e16(t8, e7) {
  return (n14, r2, i12, s212) => ((s212 > n14 || s212 + i12.length < r2) && (s212 = Math.max(0, n14 - 2), i12 = t8.sliceString(s212, Math.min(t8.length, r2 + 2))), (e7(_15(i12, n14 - s212)) != O11.Word || e7(z19(i12, n14 - s212)) != O11.Word) && (e7(z19(i12, r2 - s212)) != O11.Word || e7(_15(i12, r2 - s212)) != O11.Word));
}
var Q18 = class extends $15 {
  constructor(e7) {
    super(e7);
  }
  nextMatch(e7, n14, r2) {
    let i12 = v8(this.spec, e7, r2, e7.doc.length).nextOverlapping();
    return i12.done && (i12 = v8(this.spec, e7, 0, n14).nextOverlapping()), i12.done ? null : i12.value;
  }
  prevMatchInRange(e7, n14, r2) {
    for (let i12 = r2; ; ) {
      let s212 = Math.max(n14, i12 - 1e4 - this.spec.unquoted.length), l11 = v8(this.spec, e7, s212, i12), o = null;
      for (; !l11.nextOverlapping().done; ) o = l11.value;
      if (o) return o;
      if (s212 == n14) return null;
      i12 -= 1e4;
    }
  }
  prevMatch(e7, n14, r2) {
    return this.prevMatchInRange(e7, 0, n14) || this.prevMatchInRange(e7, r2, e7.doc.length);
  }
  getReplacement(e7) {
    return this.spec.unquote(this.spec.replace);
  }
  matchAll(e7, n14) {
    let r2 = v8(this.spec, e7, 0, e7.doc.length), i12 = [];
    for (; !r2.next().done; ) {
      if (i12.length >= n14) return null;
      i12.push(r2.value);
    }
    return i12;
  }
  highlight(e7, n14, r2, i12) {
    let s212 = v8(this.spec, e7, Math.max(0, n14 - this.spec.unquoted.length), Math.min(r2 + this.spec.unquoted.length, e7.doc.length));
    for (; !s212.next().done; ) i12(s212.value.from, s212.value.to);
  }
};
function b10(t8, e7, n14, r2) {
  return new P21(e7.doc, t8.search, { ignoreCase: !t8.caseSensitive, test: t8.wholeWord ? _e11(e7.charCategorizer(e7.selection.main.head)) : void 0 }, n14, r2);
}
function _15(t8, e7) {
  return t8.slice(_11(t8, e7, false), e7);
}
function z19(t8, e7) {
  return t8.slice(e7, _11(t8, e7));
}
function _e11(t8) {
  return (e7, n14, r2) => !r2[0].length || (t8(_15(r2.input, r2.index)) != O11.Word || t8(z19(r2.input, r2.index)) != O11.Word) && (t8(z19(r2.input, r2.index + r2[0].length)) != O11.Word || t8(_15(r2.input, r2.index + r2[0].length)) != O11.Word);
}
var j18 = class extends $15 {
  nextMatch(e7, n14, r2) {
    let i12 = b10(this.spec, e7, r2, e7.doc.length).next();
    return i12.done && (i12 = b10(this.spec, e7, 0, n14).next()), i12.done ? null : i12.value;
  }
  prevMatchInRange(e7, n14, r2) {
    for (let i12 = 1; ; i12++) {
      let s212 = Math.max(n14, r2 - i12 * 1e4), l11 = b10(this.spec, e7, s212, r2), o = null;
      for (; !l11.next().done; ) o = l11.value;
      if (o && (s212 == n14 || o.from > s212 + 10)) return o;
      if (s212 == n14) return null;
    }
  }
  prevMatch(e7, n14, r2) {
    return this.prevMatchInRange(e7, 0, n14) || this.prevMatchInRange(e7, r2, e7.doc.length);
  }
  getReplacement(e7) {
    return this.spec.unquote(this.spec.replace.replace(/\$([$&\d+])/g, (n14, r2) => r2 == "$" ? "$" : r2 == "&" ? e7.match[0] : r2 != "0" && +r2 < e7.match.length ? e7.match[r2] : n14));
  }
  matchAll(e7, n14) {
    let r2 = b10(this.spec, e7, 0, e7.doc.length), i12 = [];
    for (; !r2.next().done; ) {
      if (i12.length >= n14) return null;
      i12.push(r2.value);
    }
    return i12;
  }
  highlight(e7, n14, r2, i12) {
    let s212 = b10(this.spec, e7, Math.max(0, n14 - 250), Math.min(r2 + 250, e7.doc.length));
    for (; !s212.next().done; ) i12(s212.value.from, s212.value.to);
  }
};
var L16 = v5.define();
var Y21 = v5.define();
var g6 = $9.define({ create(t8) {
  return new k14(V20(t8).create(), null);
}, update(t8, e7) {
  for (let n14 of e7.effects) n14.is(L16) ? t8 = new k14(n14.value.create(), t8.panel) : n14.is(Y21) && (t8 = new k14(t8.query, n14.value ? Z18 : null));
  return t8;
}, provide: (t8) => bs5.from(t8, (e7) => e7.panel) });
var k14 = class {
  constructor(e7, n14) {
    this.query = e7, this.panel = n14;
  }
};
var ze15 = R11.mark({ class: "cm-searchMatch" });
var Be18 = R11.mark({ class: "cm-searchMatch cm-searchMatch-selected" });
var Ne20 = H5.fromClass(class {
  constructor(t8) {
    this.view = t8, this.decorations = this.highlight(t8.state.field(g6));
  }
  update(t8) {
    let e7 = t8.state.field(g6);
    (e7 != t8.startState.field(g6) || t8.docChanged || t8.selectionSet || t8.viewportChanged) && (this.decorations = this.highlight(e7));
  }
  highlight({ query: t8, panel: e7 }) {
    if (!e7 || !t8.spec.valid) return R11.none;
    let { view: n14 } = this, r2 = new se7();
    for (let i12 = 0, s212 = n14.visibleRanges, l11 = s212.length; i12 < l11; i12++) {
      let { from: o, to: c3 } = s212[i12];
      for (; i12 < l11 - 1 && c3 > s212[i12 + 1].from - 2 * 250; ) c3 = s212[++i12].to;
      t8.highlight(n14.state, o, c3, (a2, u3) => {
        let x11 = n14.state.selection.ranges.some((A18) => A18.from == a2 && A18.to == u3);
        r2.add(a2, u3, x11 ? Be18 : ze15);
      });
    }
    return r2.finish();
  }
}, { decorations: (t8) => t8.decorations });
function F20(t8) {
  return (e7) => {
    let n14 = e7.state.field(g6, false);
    return n14 && n14.query.spec.valid ? t8(e7, n14) : xe18(e7);
  };
}
var B13 = F20((t8, { query: e7 }) => {
  let { to: n14 } = t8.state.selection.main, r2 = e7.nextMatch(t8.state, n14, n14);
  if (!r2) return false;
  let i12 = x7.single(r2.from, r2.to), s212 = t8.state.facet(y16);
  return t8.dispatch({ selection: i12, effects: [ee11(t8, r2), s212.scrollToMatch(i12.main, t8)], userEvent: "select.search" }), ge18(t8), true;
});
var N19 = F20((t8, { query: e7 }) => {
  let { state: n14 } = t8, { from: r2 } = n14.selection.main, i12 = e7.prevMatch(n14, r2, r2);
  if (!i12) return false;
  let s212 = x7.single(i12.from, i12.to), l11 = t8.state.facet(y16);
  return t8.dispatch({ selection: s212, effects: [ee11(t8, i12), l11.scrollToMatch(s212.main, t8)], userEvent: "select.search" }), ge18(t8), true;
});
var Ve12 = F20((t8, { query: e7 }) => {
  let n14 = e7.matchAll(t8.state, 1e3);
  return !n14 || !n14.length ? false : (t8.dispatch({ selection: x7.create(n14.map((r2) => x7.range(r2.from, r2.to))), userEvent: "select.search.matches" }), true);
});
var He12 = ({ state: t8, dispatch: e7 }) => {
  let n14 = t8.selection;
  if (n14.ranges.length > 1 || n14.main.empty) return false;
  let { from: r2, to: i12 } = n14.main, s212 = [], l11 = 0;
  for (let o = new S16(t8.doc, t8.sliceDoc(r2, i12)); !o.next().done; ) {
    if (s212.length > 1e3) return false;
    o.value.from == r2 && (l11 = s212.length), s212.push(x7.range(o.value.from, o.value.to));
  }
  return e7(t8.update({ selection: x7.create(s212, l11), userEvent: "select.search.matches" })), true;
};
var le16 = F20((t8, { query: e7 }) => {
  let { state: n14 } = t8, { from: r2, to: i12 } = n14.selection.main;
  if (n14.readOnly) return false;
  let s212 = e7.nextMatch(n14, r2, r2);
  if (!s212) return false;
  let l11 = [], o, c3, a2 = [];
  if (s212.from == r2 && s212.to == i12 && (c3 = n14.toText(e7.getReplacement(s212)), l11.push({ from: s212.from, to: s212.to, insert: c3 }), s212 = e7.nextMatch(n14, s212.from, s212.to), a2.push(A11.announce.of(n14.phrase("replaced match on line $", n14.doc.lineAt(r2).number) + "."))), s212) {
    let u3 = l11.length == 0 || l11[0].from >= s212.to ? 0 : s212.to - s212.from - c3.length;
    o = x7.single(s212.from - u3, s212.to - u3), a2.push(ee11(t8, s212)), a2.push(n14.facet(y16).scrollToMatch(o.main, t8));
  }
  return t8.dispatch({ changes: l11, selection: o, effects: a2, userEvent: "input.replace" }), true;
});
var Ke13 = F20((t8, { query: e7 }) => {
  if (t8.state.readOnly) return false;
  let n14 = e7.matchAll(t8.state, 1e9).map((i12) => {
    let { from: s212, to: l11 } = i12;
    return { from: s212, to: l11, insert: e7.getReplacement(i12) };
  });
  if (!n14.length) return false;
  let r2 = t8.state.phrase("replaced $ matches", n14.length) + ".";
  return t8.dispatch({ changes: n14, effects: A11.announce.of(r2), userEvent: "input.replace.all" }), true;
});
function Z18(t8) {
  return t8.state.facet(y16).createPanel(t8);
}
function V20(t8, e7) {
  var n14, r2, i12, s212, l11;
  let o = t8.selection.main, c3 = o.empty || o.to > o.from + 100 ? "" : t8.sliceDoc(o.from, o.to);
  if (e7 && !c3) return e7;
  let a2 = t8.facet(y16);
  return new O17({ search: ((n14 = e7?.literal) !== null && n14 !== void 0 ? n14 : a2.literal) ? c3 : c3.replace(/\n/g, "\\n"), caseSensitive: (r2 = e7?.caseSensitive) !== null && r2 !== void 0 ? r2 : a2.caseSensitive, literal: (i12 = e7?.literal) !== null && i12 !== void 0 ? i12 : a2.literal, regexp: (s212 = e7?.regexp) !== null && s212 !== void 0 ? s212 : a2.regexp, wholeWord: (l11 = e7?.wholeWord) !== null && l11 !== void 0 ? l11 : a2.wholeWord });
}
function pe16(t8) {
  let e7 = rl(t8, Z18);
  return e7 && e7.dom.querySelector("[main-field]");
}
function ge18(t8) {
  let e7 = pe16(t8);
  e7 && e7 == t8.root.activeElement && e7.select();
}
var xe18 = (t8) => {
  let e7 = t8.state.field(g6, false);
  if (e7 && e7.panel) {
    let n14 = pe16(t8);
    if (n14 && n14 != t8.root.activeElement) {
      let r2 = V20(t8.state, e7.query.spec);
      r2.valid && t8.dispatch({ effects: L16.of(r2) }), n14.focus(), n14.select();
    }
  } else t8.dispatch({ effects: [Y21.of(true), e7 ? L16.of(V20(t8.state, e7.query.spec)) : v5.appendConfig.of(U19)] });
  return true;
};
var Me15 = (t8) => {
  let e7 = t8.state.field(g6, false);
  if (!e7 || !e7.panel) return false;
  let n14 = rl(t8, Z18);
  return n14 && n14.dom.contains(t8.root.activeElement) && t8.focus(), t8.dispatch({ effects: Y21.of(false) }), true;
};
var et11 = [{ key: "Mod-f", run: xe18, scope: "editor search-panel" }, { key: "F3", run: B13, shift: N19, scope: "editor search-panel", preventDefault: true }, { key: "Mod-g", run: B13, shift: N19, scope: "editor search-panel", preventDefault: true }, { key: "Escape", run: Me15, scope: "editor search-panel" }, { key: "Mod-Shift-l", run: He12 }, { key: "Alt-g", run: Fe16 }, { key: "Mod-d", run: Oe13, preventDefault: true }];
var J13 = class {
  constructor(e7) {
    this.view = e7;
    let n14 = this.query = e7.state.field(g6).query.spec;
    this.commit = this.commit.bind(this), this.searchField = s114("input", { value: n14.search, placeholder: f4(e7, "Find"), "aria-label": f4(e7, "Find"), class: "cm-textfield", name: "search", form: "", "main-field": "true", onchange: this.commit, onkeyup: this.commit }), this.replaceField = s114("input", { value: n14.replace, placeholder: f4(e7, "Replace"), "aria-label": f4(e7, "Replace"), class: "cm-textfield", name: "replace", form: "", onchange: this.commit, onkeyup: this.commit }), this.caseField = s114("input", { type: "checkbox", name: "case", form: "", checked: n14.caseSensitive, onchange: this.commit }), this.reField = s114("input", { type: "checkbox", name: "re", form: "", checked: n14.regexp, onchange: this.commit }), this.wordField = s114("input", { type: "checkbox", name: "word", form: "", checked: n14.wholeWord, onchange: this.commit });
    function r2(i12, s212, l11) {
      return s114("button", { class: "cm-button", name: i12, onclick: s212, type: "button" }, l11);
    }
    this.dom = s114("div", { onkeydown: (i12) => this.keydown(i12), class: "cm-search" }, [this.searchField, r2("next", () => B13(e7), [f4(e7, "next")]), r2("prev", () => N19(e7), [f4(e7, "previous")]), r2("select", () => Ve12(e7), [f4(e7, "all")]), s114("label", null, [this.caseField, f4(e7, "match case")]), s114("label", null, [this.reField, f4(e7, "regexp")]), s114("label", null, [this.wordField, f4(e7, "by word")]), ...e7.state.readOnly ? [] : [s114("br"), this.replaceField, r2("replace", () => le16(e7), [f4(e7, "replace")]), r2("replaceAll", () => Ke13(e7), [f4(e7, "replace all")])], s114("button", { name: "close", onclick: () => Me15(e7), "aria-label": f4(e7, "close"), type: "button" }, ["Ã—"])]);
  }
  commit() {
    let e7 = new O17({ search: this.searchField.value, caseSensitive: this.caseField.checked, regexp: this.reField.checked, wholeWord: this.wordField.checked, replace: this.replaceField.value });
    e7.eq(this.query) || (this.query = e7, this.view.dispatch({ effects: L16.of(e7) }));
  }
  keydown(e7) {
    Ko5(this.view, e7, "search-panel") ? e7.preventDefault() : e7.keyCode == 13 && e7.target == this.searchField ? (e7.preventDefault(), (e7.shiftKey ? N19 : B13)(this.view)) : e7.keyCode == 13 && e7.target == this.replaceField && (e7.preventDefault(), le16(this.view));
  }
  update(e7) {
    for (let n14 of e7.transactions) for (let r2 of n14.effects) r2.is(L16) && !r2.value.eq(this.query) && this.setQuery(r2.value);
  }
  setQuery(e7) {
    this.query = e7, this.searchField.value = e7.search, this.replaceField.value = e7.replace, this.caseField.checked = e7.caseSensitive, this.reField.checked = e7.regexp, this.wordField.checked = e7.wholeWord;
  }
  mount() {
    this.searchField.select();
  }
  get pos() {
    return 80;
  }
  get top() {
    return this.view.state.facet(y16).top;
  }
};
function f4(t8, e7) {
  return t8.state.phrase(e7);
}
var D12 = 30;
var q15 = /[\s\.,:;?!]/;
function ee11(t8, { from: e7, to: n14 }) {
  let r2 = t8.state.doc.lineAt(e7), i12 = t8.state.doc.lineAt(n14).to, s212 = Math.max(r2.from, e7 - D12), l11 = Math.min(i12, n14 + D12), o = t8.state.sliceDoc(s212, l11);
  if (s212 != r2.from) {
    for (let c3 = 0; c3 < D12; c3++) if (!q15.test(o[c3 + 1]) && q15.test(o[c3])) {
      o = o.slice(c3);
      break;
    }
  }
  if (l11 != i12) {
    for (let c3 = o.length - 1; c3 > o.length - D12; c3--) if (!q15.test(o[c3 - 1]) && q15.test(o[c3])) {
      o = o.slice(0, c3);
      break;
    }
  }
  return A11.announce.of(`${t8.state.phrase("current match")}. ${o} ${t8.state.phrase("on line")} ${r2.number}.`);
}
var Ge12 = A11.baseTheme({ ".cm-panel.cm-search": { padding: "2px 6px 4px", position: "relative", "& [name=close]": { position: "absolute", top: "0", right: "4px", backgroundColor: "inherit", border: "none", font: "inherit", padding: 0, margin: 0 }, "& input, & button, & label": { margin: ".2em .6em .2em 0" }, "& input[type=checkbox]": { marginRight: ".2em" }, "& label": { fontSize: "80%", whiteSpace: "pre" } }, "&light .cm-searchMatch": { backgroundColor: "#ffff0054" }, "&dark .cm-searchMatch": { backgroundColor: "#00ffff8a" }, "&light .cm-searchMatch-selected": { backgroundColor: "#ff6a0054" }, "&dark .cm-searchMatch-selected": { backgroundColor: "#ff00ff8a" } });
var U19 = [g6, lt8.low(Ne20), Ge12];

// https://esm.sh/v135/@codemirror/autocomplete@6.11.0/denonext/autocomplete.mjs
var F21 = class {
  constructor(e7, t8, n14) {
    this.state = e7, this.pos = t8, this.explicit = n14, this.abortListeners = [];
  }
  tokenBefore(e7) {
    let t8 = k10(this.state).resolveInner(this.pos, -1);
    for (; t8 && e7.indexOf(t8.name) < 0; ) t8 = t8.parent;
    return t8 ? { from: t8.from, to: this.pos, text: this.state.sliceDoc(t8.from, this.pos), type: t8.type } : null;
  }
  matchBefore(e7) {
    let t8 = this.state.doc.lineAt(this.pos), n14 = Math.max(t8.from, this.pos - 250), o = t8.text.slice(n14 - t8.from, this.pos - t8.from), s212 = o.search(Ae12(e7, false));
    return s212 < 0 ? null : { from: n14 + s212, to: this.pos, text: o.slice(s212) };
  }
  get aborted() {
    return this.abortListeners == null;
  }
  addEventListener(e7, t8) {
    e7 == "abort" && this.abortListeners && this.abortListeners.push(t8);
  }
};
function he17(i12) {
  let e7 = Object.keys(i12).join(""), t8 = /\w/.test(e7);
  return t8 && (e7 = e7.replace(/\w/g, "")), `[${t8 ? "\\w" : ""}${e7.replace(/[^\w\s]/g, "\\$&")}]`;
}
function Ye11(i12) {
  let e7 = /* @__PURE__ */ Object.create(null), t8 = /* @__PURE__ */ Object.create(null);
  for (let { label: o } of i12) {
    e7[o[0]] = true;
    for (let s212 = 1; s212 < o.length; s212++) t8[o[s212]] = true;
  }
  let n14 = he17(e7) + he17(t8) + "*$";
  return [new RegExp("^" + n14), new RegExp(n14)];
}
function Ge13(i12) {
  let e7 = i12.map((o) => typeof o == "string" ? { label: o } : o), [t8, n14] = e7.every((o) => /^\w+$/.test(o.label)) ? [/\w*$/, /\w+$/] : Ye11(e7);
  return (o) => {
    let s212 = o.matchBefore(n14);
    return s212 || o.explicit ? { from: s212 ? s212.from : o.pos, options: e7, validFor: t8 } : null;
  };
}
var N20 = class {
  constructor(e7, t8, n14, o) {
    this.completion = e7, this.source = t8, this.match = n14, this.score = o;
  }
};
function I19(i12) {
  return i12.selection.main.from;
}
function Ae12(i12, e7) {
  var t8;
  let { source: n14 } = i12, o = e7 && n14[0] != "^", s212 = n14[n14.length - 1] != "$";
  return !o && !s212 ? i12 : new RegExp(`${o ? "^" : ""}(?:${n14})${s212 ? "$" : ""}`, (t8 = i12.flags) !== null && t8 !== void 0 ? t8 : i12.ignoreCase ? "i" : "");
}
var Pe18 = J9.define();
function Je10(i12, e7, t8, n14) {
  let { main: o } = i12.selection, s212 = t8 - o.from, l11 = n14 - o.from;
  return Object.assign(Object.assign({}, i12.changeByRange((r2) => r2 != o && t8 != n14 && i12.sliceDoc(r2.from + s212, r2.from + l11) != i12.sliceDoc(t8, n14) ? { range: r2 } : { changes: { from: r2.from + s212, to: n14 == o.from ? r2.to : r2.from + l11, insert: e7 }, range: x8.cursor(r2.from + s212 + e7.length) })), { scrollIntoView: true, userEvent: "input.complete" });
}
var ue17 = /* @__PURE__ */ new WeakMap();
function Ze12(i12) {
  if (!Array.isArray(i12)) return i12;
  let e7 = ue17.get(i12);
  return e7 || ue17.set(i12, e7 = Ge13(i12)), e7;
}
var re14 = v6.define();
var L17 = v6.define();
var J14 = class {
  constructor(e7) {
    this.pattern = e7, this.chars = [], this.folded = [], this.any = [], this.precise = [], this.byWord = [], this.score = 0, this.matched = [];
    for (let t8 = 0; t8 < e7.length; ) {
      let n14 = he12(e7, t8), o = Ee13(n14);
      this.chars.push(n14);
      let s212 = e7.slice(t8, t8 + o), l11 = s212.toUpperCase();
      this.folded.push(he12(l11 == s212 ? s212.toLowerCase() : l11, 0)), t8 += o;
    }
    this.astral = e7.length != this.chars.length;
  }
  ret(e7, t8) {
    return this.score = e7, this.matched = t8, true;
  }
  match(e7) {
    if (this.pattern.length == 0) return this.ret(-100, []);
    if (e7.length < this.pattern.length) return false;
    let { chars: t8, folded: n14, any: o, precise: s212, byWord: l11 } = this;
    if (t8.length == 1) {
      let d4 = he12(e7, 0), P23 = Ee13(d4), w14 = P23 == e7.length ? 0 : -100;
      if (d4 != t8[0]) if (d4 == n14[0]) w14 += -200;
      else return false;
      return this.ret(w14, [0, P23]);
    }
    let r2 = e7.indexOf(this.pattern);
    if (r2 == 0) return this.ret(e7.length == this.pattern.length ? 0 : -100, [0, this.pattern.length]);
    let a2 = t8.length, c3 = 0;
    if (r2 < 0) {
      for (let d4 = 0, P23 = Math.min(e7.length, 200); d4 < P23 && c3 < a2; ) {
        let w14 = he12(e7, d4);
        (w14 == t8[c3] || w14 == n14[c3]) && (o[c3++] = d4), d4 += Ee13(w14);
      }
      if (c3 < a2) return false;
    }
    let f6 = 0, h3 = 0, u3 = false, p3 = 0, x11 = -1, E11 = -1, q17 = /[a-z]/.test(e7), D14 = true;
    for (let d4 = 0, P23 = Math.min(e7.length, 200), w14 = 0; d4 < P23 && h3 < a2; ) {
      let b12 = he12(e7, d4);
      r2 < 0 && (f6 < a2 && b12 == t8[f6] && (s212[f6++] = d4), p3 < a2 && (b12 == t8[p3] || b12 == n14[p3] ? (p3 == 0 && (x11 = d4), E11 = d4 + 1, p3++) : p3 = 0));
      let j19, K16 = b12 < 255 ? b12 >= 48 && b12 <= 57 || b12 >= 97 && b12 <= 122 ? 2 : b12 >= 65 && b12 <= 90 ? 1 : 0 : (j19 = rt10(b12)) != j19.toLowerCase() ? 1 : j19 != j19.toUpperCase() ? 2 : 0;
      (!d4 || K16 == 1 && q17 || w14 == 0 && K16 != 0) && (t8[h3] == b12 || n14[h3] == b12 && (u3 = true) ? l11[h3++] = d4 : l11.length && (D14 = false)), w14 = K16, d4 += Ee13(b12);
    }
    return h3 == a2 && l11[0] == 0 && D14 ? this.result(-100 + (u3 ? -200 : 0), l11, e7) : p3 == a2 && x11 == 0 ? this.ret(-200 - e7.length + (E11 == e7.length ? 0 : -100), [0, E11]) : r2 > -1 ? this.ret(-700 - e7.length, [r2, r2 + this.pattern.length]) : p3 == a2 ? this.ret(-900 - e7.length, [x11, E11]) : h3 == a2 ? this.result(-100 + (u3 ? -200 : 0) + -700 + (D14 ? 0 : -1100), l11, e7) : t8.length == 2 ? false : this.result((o[0] ? -700 : 0) + -200 + -1100, o, e7);
  }
  result(e7, t8, n14) {
    let o = [], s212 = 0;
    for (let l11 of t8) {
      let r2 = l11 + (this.astral ? Ee13(he12(n14, l11)) : 1);
      s212 && o[s212 - 1] == l11 ? o[s212 - 1] = r2 : (o[s212++] = l11, o[s212++] = r2);
    }
    return this.ret(e7 - n14.length, o);
  }
};
var g7 = y13.define({ combine(i12) {
  return ht9(i12, { activateOnTyping: true, selectOnOpen: true, override: null, closeOnBlur: true, maxRenderedOptions: 100, defaultKeymap: true, tooltipClass: () => "", optionClass: () => "", aboveCursor: false, icons: true, addToOptions: [], positionInfo: _e12, compareCompletions: (e7, t8) => e7.label.localeCompare(t8.label), interactionDelay: 75, updateSyncTime: 100 }, { defaultKeymap: (e7, t8) => e7 && t8, closeOnBlur: (e7, t8) => e7 && t8, icons: (e7, t8) => e7 && t8, tooltipClass: (e7, t8) => (n14) => pe17(e7(n14), t8(n14)), optionClass: (e7, t8) => (n14) => pe17(e7(n14), t8(n14)), addToOptions: (e7, t8) => e7.concat(t8) });
} });
function pe17(i12, e7) {
  return i12 ? e7 ? i12 + " " + e7 : i12 : e7;
}
function _e12(i12, e7, t8, n14, o, s212) {
  let l11 = i12.textDirection == B7.RTL, r2 = l11, a2 = false, c3 = "top", f6, h3, u3 = e7.left - o.left, p3 = o.right - e7.right, x11 = n14.right - n14.left, E11 = n14.bottom - n14.top;
  if (r2 && u3 < Math.min(x11, p3) ? r2 = false : !r2 && p3 < Math.min(x11, u3) && (r2 = true), x11 <= (r2 ? u3 : p3)) f6 = Math.max(o.top, Math.min(t8.top, o.bottom - E11)) - e7.top, h3 = Math.min(400, r2 ? u3 : p3);
  else {
    a2 = true, h3 = Math.min(400, (l11 ? e7.right : o.right - e7.left) - 30);
    let d4 = o.bottom - e7.bottom;
    d4 >= E11 || d4 > e7.top ? f6 = t8.bottom - e7.top : (c3 = "bottom", f6 = e7.bottom - t8.top);
  }
  let q17 = (e7.bottom - e7.top) / s212.offsetHeight, D14 = (e7.right - e7.left) / s212.offsetWidth;
  return { style: `${c3}: ${f6 / q17}px; max-width: ${h3 / D14}px`, class: "cm-completionInfo-" + (a2 ? l11 ? "left-narrow" : "right-narrow" : r2 ? "left" : "right") };
}
function et12(i12) {
  let e7 = i12.addToOptions.slice();
  return i12.icons && e7.push({ render(t8) {
    let n14 = document.createElement("div");
    return n14.classList.add("cm-completionIcon"), t8.type && n14.classList.add(...t8.type.split(/\s+/g).map((o) => "cm-completionIcon-" + o)), n14.setAttribute("aria-hidden", "true"), n14;
  }, position: 20 }), e7.push({ render(t8, n14, o, s212) {
    let l11 = document.createElement("span");
    l11.className = "cm-completionLabel";
    let r2 = t8.displayLabel || t8.label, a2 = 0;
    for (let c3 = 0; c3 < s212.length; ) {
      let f6 = s212[c3++], h3 = s212[c3++];
      f6 > a2 && l11.appendChild(document.createTextNode(r2.slice(a2, f6)));
      let u3 = l11.appendChild(document.createElement("span"));
      u3.appendChild(document.createTextNode(r2.slice(f6, h3))), u3.className = "cm-completionMatchedText", a2 = h3;
    }
    return a2 < r2.length && l11.appendChild(document.createTextNode(r2.slice(a2))), l11;
  }, position: 50 }, { render(t8) {
    if (!t8.detail) return null;
    let n14 = document.createElement("span");
    return n14.className = "cm-completionDetail", n14.textContent = t8.detail, n14;
  }, position: 80 }), e7.sort((t8, n14) => t8.position - n14.position).map((t8) => t8.render);
}
function z20(i12, e7, t8) {
  if (i12 <= t8) return { from: 0, to: i12 };
  if (e7 < 0 && (e7 = 0), e7 <= i12 >> 1) {
    let o = Math.floor(e7 / t8);
    return { from: o * t8, to: (o + 1) * t8 };
  }
  let n14 = Math.floor((i12 - e7) / t8);
  return { from: i12 - (n14 + 1) * t8, to: i12 - n14 * t8 };
}
var Z19 = class {
  constructor(e7, t8, n14) {
    this.view = e7, this.stateField = t8, this.applyCompletion = n14, this.info = null, this.infoDestroy = null, this.placeInfoReq = { read: () => this.measureInfo(), write: (a2) => this.placeInfo(a2), key: this }, this.space = null, this.currentClass = "";
    let o = e7.state.field(t8), { options: s212, selected: l11 } = o.open, r2 = e7.state.facet(g7);
    this.optionContent = et12(r2), this.optionClass = r2.optionClass, this.tooltipClass = r2.tooltipClass, this.range = z20(s212.length, l11, r2.maxRenderedOptions), this.dom = document.createElement("div"), this.dom.className = "cm-tooltip-autocomplete", this.updateTooltipClass(e7.state), this.dom.addEventListener("mousedown", (a2) => {
      let { options: c3 } = e7.state.field(t8).open;
      for (let f6 = a2.target, h3; f6 && f6 != this.dom; f6 = f6.parentNode) if (f6.nodeName == "LI" && (h3 = /-(\d+)$/.exec(f6.id)) && +h3[1] < c3.length) {
        this.applyCompletion(e7, c3[+h3[1]]), a2.preventDefault();
        return;
      }
    }), this.dom.addEventListener("focusout", (a2) => {
      let c3 = e7.state.field(this.stateField, false);
      c3 && c3.tooltip && e7.state.facet(g7).closeOnBlur && a2.relatedTarget != e7.contentDOM && e7.dispatch({ effects: L17.of(null) });
    }), this.showOptions(s212, o.id);
  }
  mount() {
    this.updateSel();
  }
  showOptions(e7, t8) {
    this.list && this.list.remove(), this.list = this.dom.appendChild(this.createListBox(e7, t8, this.range)), this.list.addEventListener("scroll", () => {
      this.info && this.view.requestMeasure(this.placeInfoReq);
    });
  }
  update(e7) {
    var t8;
    let n14 = e7.state.field(this.stateField), o = e7.startState.field(this.stateField);
    if (this.updateTooltipClass(e7.state), n14 != o) {
      let { options: s212, selected: l11, disabled: r2 } = n14.open;
      (!o.open || o.open.options != s212) && (this.range = z20(s212.length, l11, e7.state.facet(g7).maxRenderedOptions), this.showOptions(s212, n14.id)), this.updateSel(), r2 != ((t8 = o.open) === null || t8 === void 0 ? void 0 : t8.disabled) && this.dom.classList.toggle("cm-tooltip-autocomplete-disabled", !!r2);
    }
  }
  updateTooltipClass(e7) {
    let t8 = this.tooltipClass(e7);
    if (t8 != this.currentClass) {
      for (let n14 of this.currentClass.split(" ")) n14 && this.dom.classList.remove(n14);
      for (let n14 of t8.split(" ")) n14 && this.dom.classList.add(n14);
      this.currentClass = t8;
    }
  }
  positioned(e7) {
    this.space = e7, this.info && this.view.requestMeasure(this.placeInfoReq);
  }
  updateSel() {
    let e7 = this.view.state.field(this.stateField), t8 = e7.open;
    if ((t8.selected > -1 && t8.selected < this.range.from || t8.selected >= this.range.to) && (this.range = z20(t8.options.length, t8.selected, this.view.state.facet(g7).maxRenderedOptions), this.showOptions(t8.options, e7.id)), this.updateSelectedOption(t8.selected)) {
      this.destroyInfo();
      let { completion: n14 } = t8.options[t8.selected], { info: o } = n14;
      if (!o) return;
      let s212 = typeof o == "string" ? document.createTextNode(o) : o(n14);
      if (!s212) return;
      "then" in s212 ? s212.then((l11) => {
        l11 && this.view.state.field(this.stateField, false) == e7 && this.addInfoPane(l11, n14);
      }).catch((l11) => it6(this.view.state, l11, "completion info")) : this.addInfoPane(s212, n14);
    }
  }
  addInfoPane(e7, t8) {
    this.destroyInfo();
    let n14 = this.info = document.createElement("div");
    if (n14.className = "cm-tooltip cm-completionInfo", e7.nodeType != null) n14.appendChild(e7), this.infoDestroy = null;
    else {
      let { dom: o, destroy: s212 } = e7;
      n14.appendChild(o), this.infoDestroy = s212 || null;
    }
    this.dom.appendChild(n14), this.view.requestMeasure(this.placeInfoReq);
  }
  updateSelectedOption(e7) {
    let t8 = null;
    for (let n14 = this.list.firstChild, o = this.range.from; n14; n14 = n14.nextSibling, o++) n14.nodeName != "LI" || !n14.id ? o-- : o == e7 ? n14.hasAttribute("aria-selected") || (n14.setAttribute("aria-selected", "true"), t8 = n14) : n14.hasAttribute("aria-selected") && n14.removeAttribute("aria-selected");
    return t8 && it11(this.list, t8), t8;
  }
  measureInfo() {
    let e7 = this.dom.querySelector("[aria-selected]");
    if (!e7 || !this.info) return null;
    let t8 = this.dom.getBoundingClientRect(), n14 = this.info.getBoundingClientRect(), o = e7.getBoundingClientRect(), s212 = this.space;
    if (!s212) {
      let l11 = this.dom.ownerDocument.defaultView || window;
      s212 = { left: 0, top: 0, right: l11.innerWidth, bottom: l11.innerHeight };
    }
    return o.top > Math.min(s212.bottom, t8.bottom) - 10 || o.bottom < Math.max(s212.top, t8.top) + 10 ? null : this.view.state.facet(g7).positionInfo(this.view, t8, o, n14, s212, this.dom);
  }
  placeInfo(e7) {
    this.info && (e7 ? (e7.style && (this.info.style.cssText = e7.style), this.info.className = "cm-tooltip cm-completionInfo " + (e7.class || "")) : this.info.style.cssText = "top: -1e6px");
  }
  createListBox(e7, t8, n14) {
    let o = document.createElement("ul");
    o.id = t8, o.setAttribute("role", "listbox"), o.setAttribute("aria-expanded", "true"), o.setAttribute("aria-label", this.view.state.phrase("Completions"));
    let s212 = null;
    for (let l11 = n14.from; l11 < n14.to; l11++) {
      let { completion: r2, match: a2 } = e7[l11], { section: c3 } = r2;
      if (c3) {
        let u3 = typeof c3 == "string" ? c3 : c3.name;
        if (u3 != s212 && (l11 > n14.from || n14.from == 0)) if (s212 = u3, typeof c3 != "string" && c3.header) o.appendChild(c3.header(c3));
        else {
          let p3 = o.appendChild(document.createElement("completion-section"));
          p3.textContent = u3;
        }
      }
      let f6 = o.appendChild(document.createElement("li"));
      f6.id = t8 + "-" + l11, f6.setAttribute("role", "option");
      let h3 = this.optionClass(r2);
      h3 && (f6.className = h3);
      for (let u3 of this.optionContent) {
        let p3 = u3(r2, this.view.state, this.view, a2);
        p3 && f6.appendChild(p3);
      }
    }
    return n14.from && o.classList.add("cm-completionListIncompleteTop"), n14.to < e7.length && o.classList.add("cm-completionListIncompleteBottom"), o;
  }
  destroyInfo() {
    this.info && (this.infoDestroy && this.infoDestroy(), this.info.remove(), this.info = null);
  }
  destroy() {
    this.destroyInfo();
  }
};
function tt9(i12, e7) {
  return (t8) => new Z19(t8, i12, e7);
}
function it11(i12, e7) {
  let t8 = i12.getBoundingClientRect(), n14 = e7.getBoundingClientRect(), o = t8.height / i12.offsetHeight;
  n14.top < t8.top ? i12.scrollTop -= (t8.top - n14.top) / o : n14.bottom > t8.bottom && (i12.scrollTop += (n14.bottom - t8.bottom) / o);
}
function de16(i12) {
  return (i12.boost || 0) * 100 + (i12.apply ? 10 : 0) + (i12.info ? 5 : 0) + (i12.type ? 1 : 0);
}
function nt14(i12, e7) {
  let t8 = [], n14 = null, o = (a2) => {
    t8.push(a2);
    let { section: c3 } = a2.completion;
    if (c3) {
      n14 || (n14 = []);
      let f6 = typeof c3 == "string" ? c3 : c3.name;
      n14.some((h3) => h3.name == f6) || n14.push(typeof c3 == "string" ? { name: f6 } : c3);
    }
  };
  for (let a2 of i12) if (a2.hasResult()) {
    let c3 = a2.result.getMatch;
    if (a2.result.filter === false) for (let f6 of a2.result.options) o(new N20(f6, a2.source, c3 ? c3(f6) : [], 1e9 - t8.length));
    else {
      let f6 = new J14(e7.sliceDoc(a2.from, a2.to));
      for (let h3 of a2.result.options) if (f6.match(h3.label)) {
        let u3 = h3.displayLabel ? c3 ? c3(h3, f6.matched) : [] : f6.matched;
        o(new N20(h3, a2.source, u3, f6.score + (h3.boost || 0)));
      }
    }
  }
  if (n14) {
    let a2 = /* @__PURE__ */ Object.create(null), c3 = 0, f6 = (h3, u3) => {
      var p3, x11;
      return ((p3 = h3.rank) !== null && p3 !== void 0 ? p3 : 1e9) - ((x11 = u3.rank) !== null && x11 !== void 0 ? x11 : 1e9) || (h3.name < u3.name ? -1 : 1);
    };
    for (let h3 of n14.sort(f6)) c3 -= 1e5, a2[h3.name] = c3;
    for (let h3 of t8) {
      let { section: u3 } = h3.completion;
      u3 && (h3.score += a2[typeof u3 == "string" ? u3 : u3.name]);
    }
  }
  let s212 = [], l11 = null, r2 = e7.facet(g7).compareCompletions;
  for (let a2 of t8.sort((c3, f6) => f6.score - c3.score || r2(c3.completion, f6.completion))) {
    let c3 = a2.completion;
    !l11 || l11.label != c3.label || l11.detail != c3.detail || l11.type != null && c3.type != null && l11.type != c3.type || l11.apply != c3.apply || l11.boost != c3.boost ? s212.push(a2) : de16(a2.completion) > de16(l11) && (s212[s212.length - 1] = a2), l11 = a2.completion;
  }
  return s212;
}
var _16 = class i7 {
  constructor(e7, t8, n14, o, s212, l11) {
    this.options = e7, this.attrs = t8, this.tooltip = n14, this.timestamp = o, this.selected = s212, this.disabled = l11;
  }
  setSelected(e7, t8) {
    return e7 == this.selected || e7 >= this.options.length ? this : new i7(this.options, me17(t8, e7), this.tooltip, this.timestamp, e7, this.disabled);
  }
  static build(e7, t8, n14, o, s212) {
    let l11 = nt14(e7, t8);
    if (!l11.length) return o && e7.some((a2) => a2.state == 1) ? new i7(o.options, o.attrs, o.tooltip, o.timestamp, o.selected, true) : null;
    let r2 = t8.facet(g7).selectOnOpen ? 0 : -1;
    if (o && o.selected != r2 && o.selected != -1) {
      let a2 = o.options[o.selected].completion;
      for (let c3 = 0; c3 < l11.length; c3++) if (l11[c3].completion == a2) {
        r2 = c3;
        break;
      }
    }
    return new i7(l11, me17(n14, r2), { pos: e7.reduce((a2, c3) => c3.hasResult() ? Math.min(a2, c3.from) : a2, 1e8), create: at12, above: s212.aboveCursor }, o ? o.timestamp : Date.now(), r2, false);
  }
  map(e7) {
    return new i7(this.options, this.attrs, Object.assign(Object.assign({}, this.tooltip), { pos: e7.mapPos(this.tooltip.pos) }), this.timestamp, this.selected, this.disabled);
  }
};
var ee12 = class i8 {
  constructor(e7, t8, n14) {
    this.active = e7, this.id = t8, this.open = n14;
  }
  static start() {
    return new i8(lt12, "cm-ac-" + Math.floor(Math.random() * 2e6).toString(36), null);
  }
  update(e7) {
    let { state: t8 } = e7, n14 = t8.facet(g7), s212 = (n14.override || t8.languageDataAt("autocomplete", I19(t8)).map(Ze12)).map((r2) => (this.active.find((c3) => c3.source == r2) || new C10(r2, this.active.some((c3) => c3.state != 0) ? 1 : 0)).update(e7, n14));
    s212.length == this.active.length && s212.every((r2, a2) => r2 == this.active[a2]) && (s212 = this.active);
    let l11 = this.open;
    l11 && e7.docChanged && (l11 = l11.map(e7.changes)), e7.selection || s212.some((r2) => r2.hasResult() && e7.changes.touchesRange(r2.from, r2.to)) || !ot11(s212, this.active) ? l11 = _16.build(s212, t8, this.id, l11, n14) : l11 && l11.disabled && !s212.some((r2) => r2.state == 1) && (l11 = null), !l11 && s212.every((r2) => r2.state != 1) && s212.some((r2) => r2.hasResult()) && (s212 = s212.map((r2) => r2.hasResult() ? new C10(r2.source, 0) : r2));
    for (let r2 of e7.effects) r2.is(ae14) && (l11 = l11 && l11.setSelected(r2.value, this.id));
    return s212 == this.active && l11 == this.open ? this : new i8(s212, this.id, l11);
  }
  get tooltip() {
    return this.open ? this.open.tooltip : null;
  }
  get attrs() {
    return this.open ? this.open.attrs : st13;
  }
};
function ot11(i12, e7) {
  if (i12 == e7) return true;
  for (let t8 = 0, n14 = 0; ; ) {
    for (; t8 < i12.length && !i12[t8].hasResult; ) t8++;
    for (; n14 < e7.length && !e7[n14].hasResult; ) n14++;
    let o = t8 == i12.length, s212 = n14 == e7.length;
    if (o || s212) return o == s212;
    if (i12[t8++].result != e7[n14++].result) return false;
  }
}
var st13 = { "aria-autocomplete": "list" };
function me17(i12, e7) {
  let t8 = { "aria-autocomplete": "list", "aria-haspopup": "listbox", "aria-controls": i12 };
  return e7 > -1 && (t8["aria-activedescendant"] = i12 + "-" + e7), t8;
}
var lt12 = [];
function te13(i12) {
  return i12.isUserEvent("input.type") ? "input" : i12.isUserEvent("delete.backward") ? "delete" : null;
}
var C10 = class i9 {
  constructor(e7, t8, n14 = -1) {
    this.source = e7, this.state = t8, this.explicitPos = n14;
  }
  hasResult() {
    return false;
  }
  update(e7, t8) {
    let n14 = te13(e7), o = this;
    n14 ? o = o.handleUserEvent(e7, n14, t8) : e7.docChanged ? o = o.handleChange(e7) : e7.selection && o.state != 0 && (o = new i9(o.source, 0));
    for (let s212 of e7.effects) if (s212.is(re14)) o = new i9(o.source, 1, s212.value ? I19(e7.state) : -1);
    else if (s212.is(L17)) o = new i9(o.source, 0);
    else if (s212.is(Re15)) for (let l11 of s212.value) l11.source == o.source && (o = l11);
    return o;
  }
  handleUserEvent(e7, t8, n14) {
    return t8 == "delete" || !n14.activateOnTyping ? this.map(e7.changes) : new i9(this.source, 1);
  }
  handleChange(e7) {
    return e7.changes.touchesRange(I19(e7.startState)) ? new i9(this.source, 0) : this.map(e7.changes);
  }
  map(e7) {
    return e7.empty || this.explicitPos < 0 ? this : new i9(this.source, this.state, e7.mapPos(this.explicitPos));
  }
};
var U20 = class i10 extends C10 {
  constructor(e7, t8, n14, o, s212) {
    super(e7, 2, t8), this.result = n14, this.from = o, this.to = s212;
  }
  hasResult() {
    return true;
  }
  handleUserEvent(e7, t8, n14) {
    var o;
    let s212 = e7.changes.mapPos(this.from), l11 = e7.changes.mapPos(this.to, 1), r2 = I19(e7.state);
    if ((this.explicitPos < 0 ? r2 <= s212 : r2 < this.from) || r2 > l11 || t8 == "delete" && I19(e7.startState) == this.from) return new C10(this.source, t8 == "input" && n14.activateOnTyping ? 1 : 0);
    let a2 = this.explicitPos < 0 ? -1 : e7.changes.mapPos(this.explicitPos), c3;
    return rt14(this.result.validFor, e7.state, s212, l11) ? new i10(this.source, a2, this.result, s212, l11) : this.result.update && (c3 = this.result.update(this.result, s212, l11, new F21(e7.state, r2, a2 >= 0))) ? new i10(this.source, a2, c3, c3.from, (o = c3.to) !== null && o !== void 0 ? o : I19(e7.state)) : new C10(this.source, 1, a2);
  }
  handleChange(e7) {
    return e7.changes.touchesRange(this.from, this.to) ? new C10(this.source, 0) : this.map(e7.changes);
  }
  map(e7) {
    return e7.empty ? this : new i10(this.source, this.explicitPos < 0 ? -1 : e7.mapPos(this.explicitPos), this.result, e7.mapPos(this.from), e7.mapPos(this.to, 1));
  }
};
function rt14(i12, e7, t8, n14) {
  if (!i12) return false;
  let o = e7.sliceDoc(t8, n14);
  return typeof i12 == "function" ? i12(o, t8, n14, e7) : Ae12(i12, true).test(o);
}
var Re15 = v6.define({ map(i12, e7) {
  return i12.map((t8) => t8.map(e7));
} });
var ae14 = v6.define();
var m9 = $11.define({ create() {
  return ee12.start();
}, update(i12, e7) {
  return i12.update(e7);
}, provide: (i12) => [Dn5.from(i12, (e7) => e7.tooltip), A11.contentAttributes.from(i12, (e7) => e7.attrs)] });
function De15(i12, e7) {
  let t8 = e7.completion.apply || e7.completion.label, n14 = i12.state.field(m9).active.find((o) => o.source == e7.source);
  return n14 instanceof U20 ? (typeof t8 == "string" ? i12.dispatch(Object.assign(Object.assign({}, Je10(i12.state, t8, n14.from, n14.to)), { annotations: Pe18.of(e7.completion) })) : t8(i12, e7.completion, n14.from, n14.to), true) : false;
}
var at12 = tt9(m9, De15);
function W14(i12, e7 = "option") {
  return (t8) => {
    let n14 = t8.state.field(m9, false);
    if (!n14 || !n14.open || n14.open.disabled || Date.now() - n14.open.timestamp < t8.state.facet(g7).interactionDelay) return false;
    let o = 1, s212;
    e7 == "page" && (s212 = tl5(t8, n14.open.tooltip)) && (o = Math.max(2, Math.floor(s212.dom.offsetHeight / s212.dom.querySelector("li").offsetHeight) - 1));
    let { length: l11 } = n14.open.options, r2 = n14.open.selected > -1 ? n14.open.selected + o * (i12 ? 1 : -1) : i12 ? 0 : l11 - 1;
    return r2 < 0 ? r2 = e7 == "page" ? 0 : l11 - 1 : r2 >= l11 && (r2 = e7 == "page" ? l11 - 1 : 0), t8.dispatch({ effects: ae14.of(r2) }), true;
  };
}
var ct7 = (i12) => {
  let e7 = i12.state.field(m9, false);
  return i12.state.readOnly || !e7 || !e7.open || e7.open.selected < 0 || e7.open.disabled || Date.now() - e7.open.timestamp < i12.state.facet(g7).interactionDelay ? false : De15(i12, e7.open.options[e7.open.selected]);
};
var ft7 = (i12) => i12.state.field(m9, false) ? (i12.dispatch({ effects: re14.of(true) }), true) : false;
var ht12 = (i12) => {
  let e7 = i12.state.field(m9, false);
  return !e7 || !e7.active.some((t8) => t8.state != 0) ? false : (i12.dispatch({ effects: L17.of(null) }), true);
};
var ie11 = class {
  constructor(e7, t8) {
    this.active = e7, this.context = t8, this.time = Date.now(), this.updates = [], this.done = void 0;
  }
};
var ut8 = 50;
var pt11 = 1e3;
var dt10 = H5.fromClass(class {
  constructor(i12) {
    this.view = i12, this.debounceUpdate = -1, this.running = [], this.debounceAccept = -1, this.composing = 0;
    for (let e7 of i12.state.field(m9).active) e7.state == 1 && this.startQuery(e7);
  }
  update(i12) {
    let e7 = i12.state.field(m9);
    if (!i12.selectionSet && !i12.docChanged && i12.startState.field(m9) == e7) return;
    let t8 = i12.transactions.some((n14) => (n14.selection || n14.docChanged) && !te13(n14));
    for (let n14 = 0; n14 < this.running.length; n14++) {
      let o = this.running[n14];
      if (t8 || o.updates.length + i12.transactions.length > ut8 && Date.now() - o.time > pt11) {
        for (let s212 of o.context.abortListeners) try {
          s212();
        } catch (l11) {
          it6(this.view.state, l11);
        }
        o.context.abortListeners = null, this.running.splice(n14--, 1);
      } else o.updates.push(...i12.transactions);
    }
    if (this.debounceUpdate > -1 && clearTimeout(this.debounceUpdate), this.debounceUpdate = e7.active.some((n14) => n14.state == 1 && !this.running.some((o) => o.active.source == n14.source)) ? setTimeout(() => this.startUpdate(), 50) : -1, this.composing != 0) for (let n14 of i12.transactions) te13(n14) == "input" ? this.composing = 2 : this.composing == 2 && n14.selection && (this.composing = 3);
  }
  startUpdate() {
    this.debounceUpdate = -1;
    let { state: i12 } = this.view, e7 = i12.field(m9);
    for (let t8 of e7.active) t8.state == 1 && !this.running.some((n14) => n14.active.source == t8.source) && this.startQuery(t8);
  }
  startQuery(i12) {
    let { state: e7 } = this.view, t8 = I19(e7), n14 = new F21(e7, t8, i12.explicitPos == t8), o = new ie11(i12, n14);
    this.running.push(o), Promise.resolve(i12.source(n14)).then((s212) => {
      o.context.aborted || (o.done = s212 || null, this.scheduleAccept());
    }, (s212) => {
      this.view.dispatch({ effects: L17.of(null) }), it6(this.view.state, s212);
    });
  }
  scheduleAccept() {
    this.running.every((i12) => i12.done !== void 0) ? this.accept() : this.debounceAccept < 0 && (this.debounceAccept = setTimeout(() => this.accept(), this.view.state.facet(g7).updateSyncTime));
  }
  accept() {
    var i12;
    this.debounceAccept > -1 && clearTimeout(this.debounceAccept), this.debounceAccept = -1;
    let e7 = [], t8 = this.view.state.facet(g7);
    for (let n14 = 0; n14 < this.running.length; n14++) {
      let o = this.running[n14];
      if (o.done === void 0) continue;
      if (this.running.splice(n14--, 1), o.done) {
        let l11 = new U20(o.active.source, o.active.explicitPos, o.done, o.done.from, (i12 = o.done.to) !== null && i12 !== void 0 ? i12 : I19(o.updates.length ? o.updates[0].startState : this.view.state));
        for (let r2 of o.updates) l11 = l11.update(r2, t8);
        if (l11.hasResult()) {
          e7.push(l11);
          continue;
        }
      }
      let s212 = this.view.state.field(m9).active.find((l11) => l11.source == o.active.source);
      if (s212 && s212.state == 1) if (o.done == null) {
        let l11 = new C10(o.active.source, 0);
        for (let r2 of o.updates) l11 = l11.update(r2, t8);
        l11.state != 1 && e7.push(l11);
      } else this.startQuery(s212);
    }
    e7.length && this.view.dispatch({ effects: Re15.of(e7) });
  }
}, { eventHandlers: { blur(i12) {
  let e7 = this.view.state.field(m9, false);
  if (e7 && e7.tooltip && this.view.state.facet(g7).closeOnBlur) {
    let t8 = e7.open && tl5(this.view, e7.open.tooltip);
    (!t8 || !t8.dom.contains(i12.relatedTarget)) && this.view.dispatch({ effects: L17.of(null) });
  }
}, compositionstart() {
  this.composing = 1;
}, compositionend() {
  this.composing == 3 && setTimeout(() => this.view.dispatch({ effects: re14.of(false) }), 20), this.composing = 0;
} } });
var Le14 = A11.baseTheme({ ".cm-tooltip.cm-tooltip-autocomplete": { "& > ul": { fontFamily: "monospace", whiteSpace: "nowrap", overflow: "hidden auto", maxWidth_fallback: "700px", maxWidth: "min(700px, 95vw)", minWidth: "250px", maxHeight: "10em", height: "100%", listStyle: "none", margin: 0, padding: 0, "& > li, & > completion-section": { padding: "1px 3px", lineHeight: 1.2 }, "& > li": { overflowX: "hidden", textOverflow: "ellipsis", cursor: "pointer" }, "& > completion-section": { display: "list-item", borderBottom: "1px solid silver", paddingLeft: "0.5em", opacity: 0.7 } } }, "&light .cm-tooltip-autocomplete ul li[aria-selected]": { background: "#17c", color: "white" }, "&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]": { background: "#777" }, "&dark .cm-tooltip-autocomplete ul li[aria-selected]": { background: "#347", color: "white" }, "&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]": { background: "#444" }, ".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after": { content: '"Â·Â·Â·"', opacity: 0.5, display: "block", textAlign: "center" }, ".cm-tooltip.cm-completionInfo": { position: "absolute", padding: "3px 9px", width: "max-content", maxWidth: "400px", boxSizing: "border-box" }, ".cm-completionInfo.cm-completionInfo-left": { right: "100%" }, ".cm-completionInfo.cm-completionInfo-right": { left: "100%" }, ".cm-completionInfo.cm-completionInfo-left-narrow": { right: "30px" }, ".cm-completionInfo.cm-completionInfo-right-narrow": { left: "30px" }, "&light .cm-snippetField": { backgroundColor: "#00000022" }, "&dark .cm-snippetField": { backgroundColor: "#ffffff22" }, ".cm-snippetFieldPosition": { verticalAlign: "text-top", width: 0, height: "1.15em", display: "inline-block", margin: "0 -0.7px -.7em", borderLeft: "1.4px dotted #888" }, ".cm-completionMatchedText": { textDecoration: "underline" }, ".cm-completionDetail": { marginLeft: "0.5em", fontStyle: "italic" }, ".cm-completionIcon": { fontSize: "90%", width: ".8em", display: "inline-block", textAlign: "center", paddingRight: ".6em", opacity: "0.6", boxSizing: "content-box" }, ".cm-completionIcon-function, .cm-completionIcon-method": { "&:after": { content: "'Æ’'" } }, ".cm-completionIcon-class": { "&:after": { content: "'â—‹'" } }, ".cm-completionIcon-interface": { "&:after": { content: "'â—Œ'" } }, ".cm-completionIcon-variable": { "&:after": { content: "'ð‘¥'" } }, ".cm-completionIcon-constant": { "&:after": { content: "'ð¶'" } }, ".cm-completionIcon-type": { "&:after": { content: "'ð‘¡'" } }, ".cm-completionIcon-enum": { "&:after": { content: "'âˆª'" } }, ".cm-completionIcon-property": { "&:after": { content: "'â–¡'" } }, ".cm-completionIcon-keyword": { "&:after": { content: "'ðŸ”‘ï¸Ž'" } }, ".cm-completionIcon-namespace": { "&:after": { content: "'â–¢'" } }, ".cm-completionIcon-text": { "&:after": { content: "'abc'", fontSize: "50%", verticalAlign: "middle" } } });
var mt12 = R11.widget({ widget: new class extends ot9 {
  toDOM() {
    let i12 = document.createElement("span");
    return i12.className = "cm-snippetFieldPosition", i12;
  }
  ignoreEvent() {
    return false;
  }
}() });
var gt9 = R11.mark({ class: "cm-snippetField" });
var R17 = class i11 {
  constructor(e7, t8) {
    this.ranges = e7, this.active = t8, this.deco = R11.set(e7.map((n14) => (n14.from == n14.to ? mt12 : gt9).range(n14.from, n14.to)));
  }
  map(e7) {
    let t8 = [];
    for (let n14 of this.ranges) {
      let o = n14.map(e7);
      if (!o) return null;
      t8.push(o);
    }
    return new i11(t8, this.active);
  }
  selectionInsideField(e7) {
    return e7.ranges.every((t8) => this.ranges.some((n14) => n14.field == this.active && n14.from <= t8.from && n14.to >= t8.to));
  }
};
var $16 = v6.define({ map(i12, e7) {
  return i12 && i12.map(e7);
} });
var bt4 = v6.define();
var A17 = $11.define({ create() {
  return null;
}, update(i12, e7) {
  for (let t8 of e7.effects) {
    if (t8.is($16)) return t8.value;
    if (t8.is(bt4) && i12) return new R17(i12.ranges, t8.value);
  }
  return i12 && e7.docChanged && (i12 = i12.map(e7.changes)), i12 && e7.selection && !i12.selectionInsideField(e7.selection) && (i12 = null), i12;
}, provide: (i12) => A11.decorations.from(i12, (e7) => e7 ? e7.deco : R11.none) });
function ce19(i12, e7) {
  return x8.create(i12.filter((t8) => t8.field == e7).map((t8) => x8.range(t8.from, t8.to)));
}
function Me16(i12) {
  return ({ state: e7, dispatch: t8 }) => {
    let n14 = e7.field(A17, false);
    if (!n14 || i12 < 0 && n14.active == 0) return false;
    let o = n14.active + i12, s212 = i12 > 0 && !n14.ranges.some((l11) => l11.field == o + i12);
    return t8(e7.update({ selection: ce19(n14.ranges, o), effects: $16.of(s212 ? null : new R17(n14.ranges, o)), scrollIntoView: true })), true;
  };
}
var xt10 = ({ state: i12, dispatch: e7 }) => i12.field(A17, false) ? (e7(i12.update({ effects: $16.of(null) })), true) : false;
var vt8 = Me16(1);
var wt8 = Me16(-1);
var Ct5 = [{ key: "Tab", run: vt8, shift: wt8 }, { key: "Escape", run: xt10 }];
var ge19 = y13.define({ combine(i12) {
  return i12.length ? i12[0] : Ct5;
} });
var St10 = lt10.highest(Qr5.compute([ge19], (i12) => i12.facet(ge19)));
var It10 = A11.domEventHandlers({ mousedown(i12, e7) {
  let t8 = e7.state.field(A17, false), n14;
  if (!t8 || (n14 = e7.posAtCoords({ x: i12.clientX, y: i12.clientY })) == null) return false;
  let o = t8.ranges.find((s212) => s212.from <= n14 && s212.to >= n14);
  return !o || o.field == t8.active ? false : (e7.dispatch({ selection: ce19(t8.ranges, o.field), effects: $16.of(t8.ranges.some((s212) => s212.field > o.field) ? new R17(t8.ranges, o.field) : null), scrollIntoView: true }), true);
} });
var M10 = { brackets: ["(", "[", "{", "'", '"'], before: ")]}:;>", stringPrefixes: [] };
var T20 = v6.define({ map(i12, e7) {
  let t8 = e7.mapPos(i12, -1, E7.TrackAfter);
  return t8 ?? void 0;
} });
var fe18 = new class extends z13 {
}();
fe18.startSide = 1;
fe18.endSide = -1;
var ke14 = $11.define({ create() {
  return T14.empty;
}, update(i12, e7) {
  if (e7.selection) {
    let t8 = e7.state.doc.lineAt(e7.selection.main.head);
    i12 = i12.update({ filter: (n14) => n14 >= t8.from && n14 <= t8.to });
  }
  i12 = i12.map(e7.changes);
  for (let t8 of e7.effects) t8.is(T20) && (i12 = i12.update({ add: [fe18.range(t8.value, t8.value + 1)] }));
  return i12;
} });
function Qt8() {
  return [At10, ke14];
}
var Q19 = "()[]{}<>";
function $e17(i12) {
  for (let e7 = 0; e7 < Q19.length; e7 += 2) if (Q19.charCodeAt(e7) == i12) return Q19.charAt(e7 + 1);
  return rt10(i12 < 128 ? i12 : i12 + 1);
}
function je10(i12, e7) {
  return i12.languageDataAt("closeBrackets", e7)[0] || M10;
}
var Tt5 = typeof navigator == "object" && /Android\b/.test(navigator.userAgent);
var At10 = A11.inputHandler.of((i12, e7, t8, n14) => {
  if ((Tt5 ? i12.composing : i12.compositionStarted) || i12.state.readOnly) return false;
  let o = i12.state.selection.main;
  if (n14.length > 2 || n14.length == 2 && Ee13(he12(n14, 0)) == 1 || e7 != o.from || t8 != o.to) return false;
  let s212 = Rt10(i12.state, n14);
  return s212 ? (i12.dispatch(s212), true) : false;
});
var Pt9 = ({ state: i12, dispatch: e7 }) => {
  if (i12.readOnly) return false;
  let n14 = je10(i12, i12.selection.main.head).brackets || M10.brackets, o = null, s212 = i12.changeByRange((l11) => {
    if (l11.empty) {
      let r2 = Dt9(i12.doc, l11.head);
      for (let a2 of n14) if (a2 == r2 && H10(i12.doc, l11.head) == $e17(he12(a2, 0))) return { changes: { from: l11.head - a2.length, to: l11.head + a2.length }, range: x8.cursor(l11.head - a2.length) };
    }
    return { range: o = l11 };
  });
  return o || e7(i12.update(s212, { scrollIntoView: true, userEvent: "delete.backward" })), !o;
};
var Xt7 = [{ key: "Backspace", run: Pt9 }];
function Rt10(i12, e7) {
  let t8 = je10(i12, i12.selection.main.head), n14 = t8.brackets || M10.brackets;
  for (let o of n14) {
    let s212 = $e17(he12(o, 0));
    if (e7 == o) return s212 == o ? Bt11(i12, o, n14.indexOf(o + o + o) > -1, t8) : Lt11(i12, o, s212, t8.before || M10.before);
    if (e7 == s212 && We15(i12, i12.selection.main.from)) return Mt11(i12, o, s212);
  }
  return null;
}
function We15(i12, e7) {
  let t8 = false;
  return i12.field(ke14).between(0, i12.doc.length, (n14) => {
    n14 == e7 && (t8 = true);
  }), t8;
}
function H10(i12, e7) {
  let t8 = i12.sliceString(e7, e7 + 2);
  return t8.slice(0, Ee13(he12(t8, 0)));
}
function Dt9(i12, e7) {
  let t8 = i12.sliceString(e7 - 2, e7);
  return Ee13(he12(t8, 0)) == t8.length ? t8 : t8.slice(1);
}
function Lt11(i12, e7, t8, n14) {
  let o = null, s212 = i12.changeByRange((l11) => {
    if (!l11.empty) return { changes: [{ insert: e7, from: l11.from }, { insert: t8, from: l11.to }], effects: T20.of(l11.to + e7.length), range: x8.range(l11.anchor + e7.length, l11.head + e7.length) };
    let r2 = H10(i12.doc, l11.head);
    return !r2 || /\s/.test(r2) || n14.indexOf(r2) > -1 ? { changes: { insert: e7 + t8, from: l11.head }, effects: T20.of(l11.head + e7.length), range: x8.cursor(l11.head + e7.length) } : { range: o = l11 };
  });
  return o ? null : i12.update(s212, { scrollIntoView: true, userEvent: "input.type" });
}
function Mt11(i12, e7, t8) {
  let n14 = null, o = i12.changeByRange((s212) => s212.empty && H10(i12.doc, s212.head) == t8 ? { changes: { from: s212.head, to: s212.head + t8.length, insert: t8 }, range: x8.cursor(s212.head + t8.length) } : n14 = { range: s212 });
  return n14 ? null : i12.update(o, { scrollIntoView: true, userEvent: "input.type" });
}
function Bt11(i12, e7, t8, n14) {
  let o = n14.stringPrefixes || M10.stringPrefixes, s212 = null, l11 = i12.changeByRange((r2) => {
    if (!r2.empty) return { changes: [{ insert: e7, from: r2.from }, { insert: e7, from: r2.to }], effects: T20.of(r2.to + e7.length), range: x8.range(r2.anchor + e7.length, r2.head + e7.length) };
    let a2 = r2.head, c3 = H10(i12.doc, a2), f6;
    if (c3 == e7) {
      if (ve15(i12, a2)) return { changes: { insert: e7 + e7, from: a2 }, effects: T20.of(a2 + e7.length), range: x8.cursor(a2 + e7.length) };
      if (We15(i12, a2)) {
        let u3 = t8 && i12.sliceDoc(a2, a2 + e7.length * 3) == e7 + e7 + e7 ? e7 + e7 + e7 : e7;
        return { changes: { from: a2, to: a2 + u3.length, insert: u3 }, range: x8.cursor(a2 + u3.length) };
      }
    } else {
      if (t8 && i12.sliceDoc(a2 - 2 * e7.length, a2) == e7 + e7 && (f6 = we19(i12, a2 - 2 * e7.length, o)) > -1 && ve15(i12, f6)) return { changes: { insert: e7 + e7 + e7 + e7, from: a2 }, effects: T20.of(a2 + e7.length), range: x8.cursor(a2 + e7.length) };
      if (i12.charCategorizer(a2)(c3) != O13.Word && we19(i12, a2, o) > -1 && !kt5(i12, a2, e7, o)) return { changes: { insert: e7 + e7, from: a2 }, effects: T20.of(a2 + e7.length), range: x8.cursor(a2 + e7.length) };
    }
    return { range: s212 = r2 };
  });
  return s212 ? null : i12.update(l11, { scrollIntoView: true, userEvent: "input.type" });
}
function ve15(i12, e7) {
  let t8 = k10(i12).resolveInner(e7 + 1);
  return t8.parent && t8.from == e7;
}
function kt5(i12, e7, t8, n14) {
  let o = k10(i12).resolveInner(e7, -1), s212 = n14.reduce((l11, r2) => Math.max(l11, r2.length), 0);
  for (let l11 = 0; l11 < 5; l11++) {
    let r2 = i12.sliceDoc(o.from, Math.min(o.to, o.from + t8.length + s212)), a2 = r2.indexOf(t8);
    if (!a2 || a2 > -1 && n14.indexOf(r2.slice(0, a2)) > -1) {
      let f6 = o.firstChild;
      for (; f6 && f6.from == o.from && f6.to - f6.from > t8.length + a2; ) {
        if (i12.sliceDoc(f6.to - t8.length, f6.to) == t8) return false;
        f6 = f6.firstChild;
      }
      return true;
    }
    let c3 = o.to == e7 && o.parent;
    if (!c3) break;
    o = c3;
  }
  return false;
}
function we19(i12, e7, t8) {
  let n14 = i12.charCategorizer(e7);
  if (n14(i12.sliceDoc(e7 - 1, e7)) != O13.Word) return e7;
  for (let o of t8) {
    let s212 = e7 - o.length;
    if (i12.sliceDoc(s212, e7) == o && n14(i12.sliceDoc(s212 - 1, s212)) != O13.Word) return s212;
  }
  return -1;
}
function Yt9(i12 = {}) {
  return [m9, g7.of(i12), dt10, jt10, Le14];
}
var $t11 = [{ key: "Ctrl-Space", run: ft7 }, { key: "Escape", run: ht12 }, { key: "ArrowDown", run: W14(true) }, { key: "ArrowUp", run: W14(false) }, { key: "PageDown", run: W14(true, "page") }, { key: "PageUp", run: W14(false, "page") }, { key: "Enter", run: ct7 }];
var jt10 = lt10.highest(Qr5.computeN([g7], (i12) => i12.facet(g7).defaultKeymap ? [$t11] : []));

// https://esm.sh/v135/@codemirror/lint@6.4.2/denonext/lint.mjs
var P22 = class {
  constructor(e7, n14, i12) {
    this.from = e7, this.to = n14, this.diagnostic = i12;
  }
};
var m10 = class t6 {
  constructor(e7, n14, i12) {
    this.diagnostics = e7, this.panel = n14, this.selected = i12;
  }
  static init(e7, n14, i12) {
    let o = e7, s212 = i12.facet(h2).markerFilter;
    s212 && (o = s212(o));
    let r2 = R11.set(o.map((l11) => l11.from == l11.to || l11.from == l11.to - 1 && i12.doc.lineAt(l11.from).to == l11.from ? R11.widget({ widget: new D13(l11), diagnostic: l11 }).range(l11.from) : R11.mark({ attributes: { class: "cm-lintRange cm-lintRange-" + l11.severity + (l11.markClass ? " " + l11.markClass : "") }, diagnostic: l11 }).range(l11.from, l11.to)), true);
    return new t6(r2, n14, b11(r2));
  }
};
function b11(t8, e7 = null, n14 = 0) {
  let i12 = null;
  return t8.between(n14, 1e9, (o, s212, { spec: r2 }) => {
    if (!(e7 && r2.diagnostic != e7)) return i12 = new P22(o, s212, r2.diagnostic), false;
  }), i12;
}
function G18(t8, e7) {
  let n14 = t8.startState.doc.lineAt(e7.pos);
  return !!(t8.effects.some((i12) => i12.is(T21)) || t8.changes.touchesRange(n14.from, n14.to));
}
function H11(t8, e7) {
  return t8.field(f5, false) ? e7 : e7.concat(v5.appendConfig.of(Z20));
}
function oe12(t8, e7) {
  return { effects: H11(t8, [T21.of(e7)]) };
}
var T21 = v5.define();
var I20 = v5.define();
var $17 = v5.define();
var f5 = $9.define({ create() {
  return new m10(R11.none, null, null);
}, update(t8, e7) {
  if (e7.docChanged) {
    let n14 = t8.diagnostics.map(e7.changes), i12 = null;
    if (t8.selected) {
      let o = e7.changes.mapPos(t8.selected.from, 1);
      i12 = b11(n14, t8.selected.diagnostic, o) || b11(n14, null, o);
    }
    t8 = new m10(n14, t8.panel, i12);
  }
  for (let n14 of e7.effects) n14.is(T21) ? t8 = m10.init(n14.value, t8.panel, e7.state) : n14.is(I20) ? t8 = new m10(t8.diagnostics, n14.value ? y17.open : null, t8.selected) : n14.is($17) && (t8 = new m10(t8.diagnostics, t8.panel, n14.value));
  return t8;
}, provide: (t8) => [bs5.from(t8, (e7) => e7.panel), A11.decorations.from(t8, (e7) => e7.diagnostics)] });
var se14 = R11.mark({ class: "cm-lintRange cm-lintRange-active" });
function le17(t8, e7, n14) {
  let { diagnostics: i12 } = t8.state.field(f5), o = [], s212 = 2e8, r2 = 0;
  i12.between(e7 - (n14 < 0 ? 1 : 0), e7 + (n14 > 0 ? 1 : 0), (a2, c3, { spec: d4 }) => {
    e7 >= a2 && e7 <= c3 && (a2 == c3 || (e7 > a2 || n14 > 0) && (e7 < c3 || n14 < 0)) && (o.push(d4.diagnostic), s212 = Math.min(a2, s212), r2 = Math.max(c3, r2));
  });
  let l11 = t8.state.facet(h2).tooltipFilter;
  return l11 && (o = l11(o)), o.length ? { pos: s212, end: r2, above: t8.state.doc.lineAt(s212).to < r2, create() {
    return { dom: V21(t8, o) };
  } } : null;
}
function V21(t8, e7) {
  return s114("ul", { class: "cm-tooltip-lint" }, e7.map((n14) => Y22(t8, n14, false)));
}
var re15 = (t8) => {
  let e7 = t8.state.field(f5, false);
  (!e7 || !e7.panel) && t8.dispatch({ effects: H11(t8.state, [I20.of(true)]) });
  let n14 = rl(t8, y17.open);
  return n14 && n14.dom.querySelector(".cm-panel-lint ul").focus(), true;
};
var E10 = (t8) => {
  let e7 = t8.state.field(f5, false);
  return !e7 || !e7.panel ? false : (t8.dispatch({ effects: I20.of(false) }), true);
};
var ae15 = (t8) => {
  let e7 = t8.state.field(f5, false);
  if (!e7) return false;
  let n14 = t8.state.selection.main, i12 = e7.diagnostics.iter(n14.to + 1);
  return !i12.value && (i12 = e7.diagnostics.iter(0), !i12.value || i12.from == n14.from && i12.to == n14.to) ? false : (t8.dispatch({ selection: { anchor: i12.from, head: i12.to }, scrollIntoView: true }), true);
};
var xe19 = [{ key: "Mod-Shift-m", run: re15, preventDefault: true }, { key: "F8", run: ae15 }];
var z21 = H5.fromClass(class {
  constructor(t8) {
    this.view = t8, this.timeout = -1, this.set = true;
    let { delay: e7 } = t8.state.facet(h2);
    this.lintTime = Date.now() + e7, this.run = this.run.bind(this), this.timeout = setTimeout(this.run, e7);
  }
  run() {
    let t8 = Date.now();
    if (t8 < this.lintTime - 10) this.timeout = setTimeout(this.run, this.lintTime - t8);
    else {
      this.set = false;
      let { state: e7 } = this.view, { sources: n14 } = e7.facet(h2);
      Promise.all(n14.map((i12) => Promise.resolve(i12(this.view)))).then((i12) => {
        let o = i12.reduce((s212, r2) => s212.concat(r2));
        this.view.state.doc == e7.doc && this.view.dispatch(oe12(this.view.state, o));
      }, (i12) => {
        it6(this.view.state, i12);
      });
    }
  }
  update(t8) {
    let e7 = t8.state.facet(h2);
    (t8.docChanged || e7 != t8.startState.facet(h2) || e7.needsRefresh && e7.needsRefresh(t8)) && (this.lintTime = Date.now() + e7.delay, this.set || (this.set = true, this.timeout = setTimeout(this.run, e7.delay)));
  }
  force() {
    this.set && (this.lintTime = Date.now(), this.run());
  }
  destroy() {
    clearTimeout(this.timeout);
  }
});
var h2 = y11.define({ combine(t8) {
  return Object.assign({ sources: t8.map((e7) => e7.source) }, ht8(t8.map((e7) => e7.config), { delay: 750, markerFilter: null, tooltipFilter: null, needsRefresh: null }, { needsRefresh: (e7, n14) => e7 ? n14 ? (i12) => e7(i12) || n14(i12) : e7 : n14 }));
} });
function N21(t8) {
  let e7 = [];
  if (t8) e: for (let { name: n14 } of t8) {
    for (let i12 = 0; i12 < n14.length; i12++) {
      let o = n14[i12];
      if (/[a-zA-Z]/.test(o) && !e7.some((s212) => s212.toLowerCase() == o.toLowerCase())) {
        e7.push(o);
        continue e;
      }
    }
    e7.push("");
  }
  return e7;
}
function Y22(t8, e7, n14) {
  var i12;
  let o = n14 ? N21(e7.actions) : [];
  return s114("li", { class: "cm-diagnostic cm-diagnostic-" + e7.severity }, s114("span", { class: "cm-diagnosticText" }, e7.renderMessage ? e7.renderMessage() : e7.message), (i12 = e7.actions) === null || i12 === void 0 ? void 0 : i12.map((s212, r2) => {
    let l11 = false, a2 = (K16) => {
      if (K16.preventDefault(), l11) return;
      l11 = true;
      let S17 = b11(t8.state.field(f5).diagnostics, e7);
      S17 && s212.apply(t8, S17.from, S17.to);
    }, { name: c3 } = s212, d4 = o[r2] ? c3.indexOf(o[r2]) : -1, p3 = d4 < 0 ? c3 : [c3.slice(0, d4), s114("u", c3.slice(d4, d4 + 1)), c3.slice(d4 + 1)];
    return s114("button", { type: "button", class: "cm-diagnosticAction", onclick: a2, onmousedown: a2, "aria-label": ` Action: ${c3}${d4 < 0 ? "" : ` (access key "${o[r2]})"`}.` }, p3);
  }), e7.source && s114("div", { class: "cm-diagnosticSource" }, e7.source));
}
var D13 = class extends ot9 {
  constructor(e7) {
    super(), this.diagnostic = e7;
  }
  eq(e7) {
    return e7.diagnostic == this.diagnostic;
  }
  toDOM() {
    return s114("span", { class: "cm-lintPoint cm-lintPoint-" + this.diagnostic.severity });
  }
};
var v9 = class {
  constructor(e7, n14) {
    this.diagnostic = n14, this.id = "item_" + Math.floor(Math.random() * 4294967295).toString(16), this.dom = Y22(e7, n14, true), this.dom.id = this.id, this.dom.setAttribute("role", "option");
  }
};
var y17 = class t7 {
  constructor(e7) {
    this.view = e7, this.items = [];
    let n14 = (o) => {
      if (o.keyCode == 27) E10(this.view), this.view.focus();
      else if (o.keyCode == 38 || o.keyCode == 33) this.moveSelection((this.selectedIndex - 1 + this.items.length) % this.items.length);
      else if (o.keyCode == 40 || o.keyCode == 34) this.moveSelection((this.selectedIndex + 1) % this.items.length);
      else if (o.keyCode == 36) this.moveSelection(0);
      else if (o.keyCode == 35) this.moveSelection(this.items.length - 1);
      else if (o.keyCode == 13) this.view.focus();
      else if (o.keyCode >= 65 && o.keyCode <= 90 && this.selectedIndex >= 0) {
        let { diagnostic: s212 } = this.items[this.selectedIndex], r2 = N21(s212.actions);
        for (let l11 = 0; l11 < r2.length; l11++) if (r2[l11].toUpperCase().charCodeAt(0) == o.keyCode) {
          let a2 = b11(this.view.state.field(f5).diagnostics, s212);
          a2 && s212.actions[l11].apply(e7, a2.from, a2.to);
        }
      } else return;
      o.preventDefault();
    }, i12 = (o) => {
      for (let s212 = 0; s212 < this.items.length; s212++) this.items[s212].dom.contains(o.target) && this.moveSelection(s212);
    };
    this.list = s114("ul", { tabIndex: 0, role: "listbox", "aria-label": this.view.state.phrase("Diagnostics"), onkeydown: n14, onclick: i12 }), this.dom = s114("div", { class: "cm-panel-lint" }, this.list, s114("button", { type: "button", name: "close", "aria-label": this.view.state.phrase("close"), onclick: () => E10(this.view) }, "Ã—")), this.update();
  }
  get selectedIndex() {
    let e7 = this.view.state.field(f5).selected;
    if (!e7) return -1;
    for (let n14 = 0; n14 < this.items.length; n14++) if (this.items[n14].diagnostic == e7.diagnostic) return n14;
    return -1;
  }
  update() {
    let { diagnostics: e7, selected: n14 } = this.view.state.field(f5), i12 = 0, o = false, s212 = null;
    for (e7.between(0, this.view.state.doc.length, (r2, l11, { spec: a2 }) => {
      let c3 = -1, d4;
      for (let p3 = i12; p3 < this.items.length; p3++) if (this.items[p3].diagnostic == a2.diagnostic) {
        c3 = p3;
        break;
      }
      c3 < 0 ? (d4 = new v9(this.view, a2.diagnostic), this.items.splice(i12, 0, d4), o = true) : (d4 = this.items[c3], c3 > i12 && (this.items.splice(i12, c3 - i12), o = true)), n14 && d4.diagnostic == n14.diagnostic ? d4.dom.hasAttribute("aria-selected") || (d4.dom.setAttribute("aria-selected", "true"), s212 = d4) : d4.dom.hasAttribute("aria-selected") && d4.dom.removeAttribute("aria-selected"), i12++;
    }); i12 < this.items.length && !(this.items.length == 1 && this.items[0].diagnostic.from < 0); ) o = true, this.items.pop();
    this.items.length == 0 && (this.items.push(new v9(this.view, { from: -1, to: -1, severity: "info", message: this.view.state.phrase("No diagnostics") })), o = true), s212 ? (this.list.setAttribute("aria-activedescendant", s212.id), this.view.requestMeasure({ key: this, read: () => ({ sel: s212.dom.getBoundingClientRect(), panel: this.list.getBoundingClientRect() }), write: ({ sel: r2, panel: l11 }) => {
      let a2 = l11.height / this.list.offsetHeight;
      r2.top < l11.top ? this.list.scrollTop -= (l11.top - r2.top) / a2 : r2.bottom > l11.bottom && (this.list.scrollTop += (r2.bottom - l11.bottom) / a2);
    } })) : this.selectedIndex < 0 && this.list.removeAttribute("aria-activedescendant"), o && this.sync();
  }
  sync() {
    let e7 = this.list.firstChild;
    function n14() {
      let i12 = e7;
      e7 = i12.nextSibling, i12.remove();
    }
    for (let i12 of this.items) if (i12.dom.parentNode == this.list) {
      for (; e7 != i12.dom; ) n14();
      e7 = i12.dom.nextSibling;
    } else this.list.insertBefore(i12.dom, e7);
    for (; e7; ) n14();
  }
  moveSelection(e7) {
    if (this.selectedIndex < 0) return;
    let n14 = this.view.state.field(f5), i12 = b11(n14.diagnostics, this.items[e7].diagnostic);
    i12 && this.view.dispatch({ selection: { anchor: i12.from, head: i12.to }, scrollIntoView: true, effects: $17.of(i12) });
  }
  static open(e7) {
    return new t7(e7);
  }
};
function x10(t8, e7 = 'viewBox="0 0 40 40"') {
  return `url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e7}>${encodeURIComponent(t8)}</svg>')`;
}
function k15(t8) {
  return x10(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${t8}" fill="none" stroke-width=".7"/>`, 'width="6" height="3"');
}
var ce20 = A11.baseTheme({ ".cm-diagnostic": { padding: "3px 6px 3px 8px", marginLeft: "-1px", display: "block", whiteSpace: "pre-wrap" }, ".cm-diagnostic-error": { borderLeft: "5px solid #d11" }, ".cm-diagnostic-warning": { borderLeft: "5px solid orange" }, ".cm-diagnostic-info": { borderLeft: "5px solid #999" }, ".cm-diagnostic-hint": { borderLeft: "5px solid #66d" }, ".cm-diagnosticAction": { font: "inherit", border: "none", padding: "2px 4px", backgroundColor: "#444", color: "white", borderRadius: "3px", marginLeft: "8px", cursor: "pointer" }, ".cm-diagnosticSource": { fontSize: "70%", opacity: 0.7 }, ".cm-lintRange": { backgroundPosition: "left bottom", backgroundRepeat: "repeat-x", paddingBottom: "0.7px" }, ".cm-lintRange-error": { backgroundImage: k15("#d11") }, ".cm-lintRange-warning": { backgroundImage: k15("orange") }, ".cm-lintRange-info": { backgroundImage: k15("#999") }, ".cm-lintRange-hint": { backgroundImage: k15("#66d") }, ".cm-lintRange-active": { backgroundColor: "#ffdd9980" }, ".cm-tooltip-lint": { padding: 0, margin: 0 }, ".cm-lintPoint": { position: "relative", "&:after": { content: '""', position: "absolute", bottom: 0, left: "-2px", borderLeft: "3px solid transparent", borderRight: "3px solid transparent", borderBottom: "4px solid #d11" } }, ".cm-lintPoint-warning": { "&:after": { borderBottomColor: "orange" } }, ".cm-lintPoint-info": { "&:after": { borderBottomColor: "#999" } }, ".cm-lintPoint-hint": { "&:after": { borderBottomColor: "#66d" } }, ".cm-panel.cm-panel-lint": { position: "relative", "& ul": { maxHeight: "100px", overflowY: "auto", "& [aria-selected]": { backgroundColor: "#ddd", "& u": { textDecoration: "underline" } }, "&:focus [aria-selected]": { background_fallback: "#bdf", backgroundColor: "Highlight", color_fallback: "white", color: "HighlightText" }, "& u": { textDecoration: "none" }, padding: 0, margin: 0 }, "& [name=close]": { position: "absolute", top: "0", right: "2px", background: "inherit", border: "none", font: "inherit", padding: 0, margin: 0 } } });
function B14(t8) {
  return t8 == "error" ? 4 : t8 == "warning" ? 3 : t8 == "info" ? 2 : 1;
}
var L18 = class extends $10 {
  constructor(e7) {
    super(), this.diagnostics = e7, this.severity = e7.reduce((n14, i12) => B14(n14) < B14(i12.severity) ? i12.severity : n14, "hint");
  }
  toDOM(e7) {
    let n14 = document.createElement("div");
    n14.className = "cm-lint-marker cm-lint-marker-" + this.severity;
    let i12 = this.diagnostics, o = e7.state.facet(R18).tooltipFilter;
    return o && (i12 = o(i12)), i12.length && (n14.onmouseover = () => fe19(e7, n14, i12)), n14;
  }
};
function de17(t8, e7) {
  let n14 = (i12) => {
    let o = e7.getBoundingClientRect();
    if (!(i12.clientX > o.left - 10 && i12.clientX < o.right + 10 && i12.clientY > o.top - 10 && i12.clientY < o.bottom + 10)) {
      for (let s212 = i12.target; s212; s212 = s212.parentNode) if (s212.nodeType == 1 && s212.classList.contains("cm-tooltip-lint")) return;
      window.removeEventListener("mousemove", n14), t8.state.field(q16) && t8.dispatch({ effects: M11.of(null) });
    }
  };
  window.addEventListener("mousemove", n14);
}
function fe19(t8, e7, n14) {
  function i12() {
    let r2 = t8.elementAtHeight(e7.getBoundingClientRect().top + 5 - t8.documentTop);
    t8.coordsAtPos(r2.from) && t8.dispatch({ effects: M11.of({ pos: r2.from, above: false, create() {
      return { dom: V21(t8, n14), getCoords: () => e7.getBoundingClientRect() };
    } }) }), e7.onmouseout = e7.onmousemove = null, de17(t8, e7);
  }
  let { hoverTime: o } = t8.state.facet(R18), s212 = setTimeout(i12, o);
  e7.onmouseout = () => {
    clearTimeout(s212), e7.onmouseout = e7.onmousemove = null;
  }, e7.onmousemove = () => {
    clearTimeout(s212), s212 = setTimeout(i12, o);
  };
}
function ue18(t8, e7) {
  let n14 = /* @__PURE__ */ Object.create(null);
  for (let o of e7) {
    let s212 = t8.lineAt(o.from);
    (n14[s212.from] || (n14[s212.from] = [])).push(o);
  }
  let i12 = [];
  for (let o in n14) i12.push(new L18(n14[o]).range(+o));
  return T11.of(i12, true);
}
var me18 = ol2({ class: "cm-gutter-lint", markers: (t8) => t8.state.field(_17) });
var _17 = $9.define({ create() {
  return T11.empty;
}, update(t8, e7) {
  t8 = t8.map(e7.changes);
  let n14 = e7.state.facet(R18).markerFilter;
  for (let i12 of e7.effects) if (i12.is(T21)) {
    let o = i12.value;
    n14 && (o = n14(o || [])), t8 = ue18(e7.state.doc, o.slice(0));
  }
  return t8;
} });
var M11 = v5.define();
var q16 = $9.define({ create() {
  return null;
}, update(t8, e7) {
  return t8 && e7.docChanged && (t8 = G18(e7, t8) ? null : Object.assign(Object.assign({}, t8), { pos: e7.changes.mapPos(t8.pos) })), e7.effects.reduce((n14, i12) => i12.is(M11) ? i12.value : n14, t8);
}, provide: (t8) => Dn5.from(t8) });
var he18 = A11.baseTheme({ ".cm-gutter-lint": { width: "1.4em", "& .cm-gutterElement": { padding: ".2em" } }, ".cm-lint-marker": { width: "1em", height: "1em" }, ".cm-lint-marker-info": { content: x10('<path fill="#aaf" stroke="#77e" stroke-width="6" stroke-linejoin="round" d="M5 5L35 5L35 35L5 35Z"/>') }, ".cm-lint-marker-warning": { content: x10('<path fill="#fe8" stroke="#fd7" stroke-width="6" stroke-linejoin="round" d="M20 6L37 35L3 35Z"/>') }, ".cm-lint-marker-error": { content: x10('<circle cx="20" cy="20" r="15" fill="#f87" stroke="#f43" stroke-width="6"/>') } });
var Z20 = [f5, A11.decorations.compute([f5], (t8) => {
  let { selected: e7, panel: n14 } = t8.field(f5);
  return !e7 || !n14 || e7.from == e7.to ? R11.none : R11.set([se14.range(e7.from, e7.to)]);
}), Qo5(le17, { hideOn: G18 }), ce20];
var R18 = y11.define({ combine(t8) {
  return ht8(t8, { hoverTime: 300, markerFilter: null, tooltipFilter: null });
} });

// https://esm.sh/v135/codemirror@6.0.1/denonext/codemirror.mjs
var I21 = [ll(), hl(), _o5(), yn7(), fn7(), qo5(), Yo5(), I13.allowMultipleSelections.of(true), sn7(), un7(dn6, { fallback: true }), pn7(), Qt8(), Yt9(), Uo5(), Jo5(), Go5(), Ue14(), Qr5.of([...Xt7, ...Pn5, ...et11, ...An6, ...hn6, ...$t11, ...xe19])];
var N22 = [_o5(), yn7(), qo5(), un7(dn6, { fallback: true }), Qr5.of([...Pn5, ...An6])];
export {
  A11 as EditorView,
  I21 as basicSetup,
  N22 as minimalSetup
};
